/*! jQuery v1.12.3 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,(function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.3",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"!==c&&!n.isWindow(a)&&("array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a)}n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,(function(b,c){return a.call(b,c,b)})))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],g!==(c=e[d])&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a))for(c=a.length;c>d&&!1!==b.call(a[d],d,a[d]);d++);else for(d in a)if(!1===b.call(a[d],d,a[d]))break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;)a[e++]=b[d++];if(c!=c)for(;void 0!==b[d];)a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var e=[],f=0,g=a.length,h=!c;g>f;f++)!b(a[f],f)!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)null!=(e=b(a[g],g,c))&&h.push(e);else for(g in a)null!=(e=b(a[g],g,c))&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),(d=function(){return a.apply(b||this,c.concat(e.call(arguments)))}).guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(a,b){i["[object "+b+"]"]=b.toLowerCase()}));var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!=d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){for((k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),h=(r=g(a)).length,l=V.test(k)?"#"+k:"[id='"+k+"']";h--;)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];return function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){for(var c=a.split("|"),e=c.length;e--;)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||1<<31)-(~a.sourceIndex||1<<31);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function la(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha((function(b){return b=+b,ha((function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))}))}))}function oa(a){return a&&void 0!==a.getElementsByTagName&&a}for(b in c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return!!b&&"HTML"!==b.nodeName},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(o=(n=g).documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia((function(a){return a.className="i",!a.getAttribute("className")})),c.getElementsByTagName=ia((function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length})),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia((function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length})),c.getById?(d.find.ID=function(a,b){if(void 0!==b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c=void 0!==a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return void 0!==b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return void 0!==b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia((function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")})),ia((function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")}))),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia((function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)})),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d||(1&(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1)||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);for(c=a;c=c.parentNode;)g.unshift(c);for(c=b;c=c.parentNode;)h.unshift(c);for(;g[d]===h[d];)d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){for(;b=a[f++];)b===a[f]&&(e=d.push(f));for(;e--;)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else for(;b=a[d++];)c+=e(b);return c},(d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,(function(a){return b.test("string"==typeof a.className&&a.className||void 0!==a.getAttribute&&a.getAttribute("class")||"")}))},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:!b||(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b&&(e===c||e.slice(0,c.length+1)===c+"-"))}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){for(;p;){for(m=b;m=m[p];)if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(t=(n=(j=(k=(l=(m=q)[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===w&&j[1])&&j[2],m=n&&q.childNodes[n];m=++n&&m&&m[p]||(t=n=0)||o.pop();)if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(t=n=(j=(k=(l=(m=b)[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]||[])[0]===w&&j[1]),!1===t)for(;(m=++n&&m&&m[p]||(t=n=0)||o.pop())&&((h?m.nodeName.toLowerCase()!==r:1!==m.nodeType)||!++t||(s&&((k=(l=m[u]||(m[u]={}))[m.uniqueID]||(l[m.uniqueID]={}))[a]=[w,t]),m!==b)););return(t-=e)===d||t%d==0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha((function(a,c){for(var d,f=e(a,b),g=f.length;g--;)a[d=J(a,f[g])]=!(c[d]=f[g])})):function(a){return e(a,0,c)}):e}},pseudos:{not:ha((function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha((function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))})):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}})),has:ha((function(a){return function(b){return fa(a,b).length>0}})),contains:ha((function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}})),lang:ha((function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do{if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return(c=c.toLowerCase())===a||0===c.indexOf(a+"-")}while((b=b.parentNode)&&1===b.nodeType);return!1}})),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,!0===a.selected},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na((function(){return[0]})),last:na((function(a,b){return[b-1]})),eq:na((function(a,b,c){return[0>c?c+b:c]})),even:na((function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a})),odd:na((function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a})),lt:na((function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a})),gt:na((function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a}))}}).pseudos.nth=d.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if((h=(i=(j=b[u]||(b[u]={}))[b.uniqueID]||(j[b.uniqueID]={}))[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha((function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||function(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=ua(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)}))}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra((function(a){return a===b}),h,!0),l=ra((function(a){return J(b,a)>-1}),h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if((c=d.filter[a[i].type].apply(null,a[i].matches))[u]){for(e=++i;f>e&&!d.relative[a[e].type];e++);return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){for(o=0,g||l.ownerDocument===n||(m(l),h=!p);q=a[o++];)if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){for(o=0;q=b[o++];)q(t,u,g,h);if(f){if(r>0)for(;s--;)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=d.preFilter;h;){for(g in c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length)),d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)},h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){for(b||(b=g(a)),c=b.length;c--;)(f=wa(b[c]))[u]?d.push(f):e.push(f);(f=A(a,xa(e,d))).selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if((j=o[0]=o[0].slice(0)).length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(!(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0]))return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}for(i=W.needsContext.test(a)?0:j.length;i--&&(k=j[i],!d.relative[l=k.type]);)if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),!(a=f.length&&qa(j)))return H.apply(e,f),e;break}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia((function(a){return 1&a.compareDocumentPosition(n.createElement("div"))})),ia((function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")}))||ja("type|href|height|width",(function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)})),c.attributes&&ia((function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")}))||ja("value",(function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue})),ia((function(a){return null==a.getAttribute("disabled")}))||ja(K,(function(a,b,c){var d;return c?void 0:!0===a[b]?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null})),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,(function(a,d){return!!b.call(a,d,a)!==c}));if(b.nodeType)return n.grep(a,(function(a){return a===b!==c}));if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,(function(a){return n.inArray(a,b)>-1!==c}))}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,(function(a){return 1===a.nodeType})))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter((function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0})));for(b=0;e>b;b++)n.find(a,d[b],c);return(c=this.pushStack(e>1?n.unique(c):c)).selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(!(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a))||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if((f=d.getElementById(e[2]))&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?void 0!==c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))}).prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};function F(a,b){do{a=a[b]}while(a&&1!==a.nodeType);return a}n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter((function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0}))},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},(function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}}));var I,L,G=/\S+/g;function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}for(L in n.Callbacks=function(a){a="string"==typeof a?function(a){var b={};return n.each(a.match(G)||[],(function(a,c){b[c]=!0})),b}(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1)for(c=g.shift();++h<f.length;)!1===f[h].apply(c[0],c[1])&&a.stopOnFalse&&(h=f.length,c=!1);a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,(function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)}))}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,(function(a,b){for(var c;(c=n.inArray(b,f,c))>-1;)f.splice(c,1),h>=c&&h--})),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=[a,(c=c||[]).slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred((function(c){n.each(b,(function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]]((function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)}))})),a=null})).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,(function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add((function(){c=h}),b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith})),d.promise(e),a&&a.call(e,e),e},when:function(a){var i,j,k,b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}};if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}}),n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(!0===a?--n.readyWait:n.isReady)||(n.isReady=!0,!0!==a&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}}),n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise(),n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n((function(){var a,b,c,e;(c=d.getElementsByTagName("body")[0])&&c.style&&(b=d.createElement("div"),(e=d.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),void 0!==b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))})),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return(1===c||9===c)&&(!b||!0!==b&&a.getAttribute("classid")===b)},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if("string"==typeof(c=a.getAttribute(d))){try{c="true"===c||"false"!==c&&("null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c)}catch(e){}n.data(a,b,c)}else c=void 0}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?null==(f=g[b])&&(f=g[n.camelCase(b)]):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:b=(b=n.camelCase(b))in d?[b]:b.split(" "),e=b.length;for(;e--;)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return!!(a=a.nodeType?n.cache[a[n.expando]]:a[n.expando])&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){for(c=g.length;c--;)g[c]&&(0===(d=g[c].name).indexOf("data-")&&P(f,d=n.camelCase(d.slice(5)),e[d]));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each((function(){n.data(this,a)})):arguments.length>1?this.each((function(){n.data(this,a,b)})):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each((function(){n.removeData(this,a)}))}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b);"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,(function(){n.dequeue(a,b)}),f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add((function(){n._removeData(a,b+"queue"),n._removeData(a,c)}))})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each((function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)}))},dequeue:function(a){return this.each((function(){n.dequeue(this,a)}))},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)(c=n._data(f[g],a+"queueHooks"))&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){return null!=a?a:(a=!1,(c=d.getElementsByTagName("body")[0])&&c.style?(b=d.createElement("div"),(e=d.createElement("div")).style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),void 0!==b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0);var b,c,e}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do{k/=f=f||".5",n.style(a,b,k+j)}while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c))for(h in e=!0,c)Y(a,b,h,c[h],!0,f,g);else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),(c=d.createElement("input")).setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};function ea(a,b){var c,d,e=0,f=void 0!==a.getElementsByTagName?a.getElementsByTagName(b||"*"):void 0!==a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if((g=a[r])||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){for(i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];f--;)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody)for(f=(g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild)&&g.childNodes.length;f--;)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k);for(n.merge(q,i.childNodes),i.textContent="";i.firstChild;)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));for(i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;g=q[r++];)if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c)for(f=0;g=i[f++];)_.test(g.type||"")&&c.push(g);return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=!1===e.attributes[c].expando);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){for(h in"string"!=typeof c&&(d=d||c,c=void 0),b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),!1===e)e=qa;else if(!e)return a;return 1===f&&(g=e,(e=function(a){return n().off(a),g.apply(this,arguments)}).guid=g.guid||(g.guid=n.guid++)),a.each((function(){n.event.add(this,b,e,d,c)}))}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){for(c.handler&&(c=(i=c).handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||((k=r.handle=function(a){return void 0===n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)}).elem=a),h=(b=(b||"").match(G)||[""]).length;h--;)o=q=(f=oa.exec(b[h])||[])[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||((m=g[o]=[]).delegateCount=0,j.setup&&!1!==j.setup.call(a,d,p,k)||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){for(j=(b=(b||"").match(G)||[""]).length;j--;)if(o=q=(h=oa.exec(b[j])||[])[1],p=(h[2]||"").split(".").sort(),o){for(l=n.event.special[o]||{},m=k[o=(d?l.delegateType:l.bindType)||o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&!1!==l.teardown.call(a,p,r.handle)||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,(b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b)).isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||!1!==l.trigger.apply(e,c))){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}for(o=0;(i=p[o++])&&!b.isPropagationStopped();)b.type=o>1?j:l.bindType||q,(g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"))&&g.apply(i,c),(g=h&&i[h])&&g.apply&&M(i)&&(b.result=g.apply(i,c),!1===b.result&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||!1===l._default.apply(p.pop(),c))&&M(e)&&h&&e[q]&&!n.isWindow(e)){(m=e[h])&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||!1!==k.preDispatch.call(this,a)){for(h=n.event.handlers.call(this,a,j),b=0;(f=h[b++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,c=0;(g=f.handlers[c++])&&!a.isImmediatePropagationStopped();)a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,void 0!==(d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i))&&!1===(a.result=d)&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(!0!==i.disabled||"click"!==a.type)){for(d=[],c=0;h>c;c++)void 0===d[e=(f=b[c]).selector+" "]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];for(h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;b--;)a[c=e[b]]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(f=(e=a.target.ownerDocument||d).documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&(void 0===a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}})),l.submit||(n.event.special.submit={setup:function(){return!n.nodeName(this,"form")&&void n.event.add(this,"click._submit keypress._submit",(function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",(function(a){a._submitBubble=!0})),n._data(c,"submit",!0))}))},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return!n.nodeName(this,"form")&&void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",(function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)})),n.event.add(this,"click._change",(function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)}))),!1):void n.event.add(this,"beforeactivate._change",(function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",(function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)})),n._data(b,"change",!0))}))},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},(function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}})),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return!1!==b&&"function"!=typeof b||(c=b,b=void 0),!1===c&&(c=qa),this.each((function(){n.event.remove(this,a,c,b)}))},trigger:function(a,b){return this.each((function(){n.event.trigger(a,b,this)}))},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ba=ca(d).appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h)for(c in delete g.handle,g.events={},h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d]);g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){for(d in(e=n._data(b)).events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each((function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)}));if(o&&(e=(k=ja(b,a[0].ownerDocument,!1,a,d)).firstChild,1===k.childNodes.length&&(k=e),e||d)){for(h=(i=n.map(ea(k,"script"),Da)).length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return(d=ea(f,"script")).length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(g=(f=d[i])&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||void 0===d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,(function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))}),null,a,arguments.length)},append:function(){return Ha(this,arguments,(function(a){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ca(this,a).appendChild(a)}))},prepend:function(){return Ha(this,arguments,(function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}}))},before:function(){return Ha(this,arguments,(function(a){this.parentNode&&this.parentNode.insertBefore(a,this)}))},after:function(){return Ha(this,arguments,(function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)}))},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&n.cleanData(ea(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null!=a&&a,b=null==b?a:b,this.map((function(){return n.clone(this,a,b)}))},html:function(a){return Y(this,(function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)1===(b=this[c]||{}).nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)}),null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,(function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))}),a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}}));var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||("none"!==(c=La(a,b))&&c||((b=((Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement))[0].contentWindow||Ja[0].contentDocument).document).write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];for(f in e=c.apply(a,d||[]),b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,(k=j.appendChild(d.createElement("div"))).style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",(f=0===j.getClientRects().length)&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(k=j.getElementsByTagName("td"))[0].style.cssText="margin:0;border:0;padding:0;display:none",(f=0===k[0].offsetHeight)&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,(i=d.createElement("div")).style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}})}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return""!==(g=(c=c||Ra(a))?c.getPropertyValue(b)||c[b]:void 0)&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return null==(g=(c=c||Ra(a))?c[b]:void 0)&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,(f=(e=a.runtimeStyle)&&e.left)&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;for(var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;c--;)if((a=_a[c]+b)in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)(d=a[g]).style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)(d=a[g]).style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(b,c,e){var f=!0,g="width"===c?b.offsetWidth:b.offsetHeight,h=Ra(b),i=l.boxSizing&&"border-box"===n.css(b,"boxSizing",!1,h);if(d.msFullscreenElement&&a.top!==a&&b.getClientRects().length&&(g=Math.round(100*b.getBoundingClientRect()[c])),0>=g||null==g){if((0>(g=Sa(b,c,h))||null==g)&&(g=b.style[c]),Oa.test(g))return g;f=i&&(l.boxSizingReliable()||g===b.style[c]),g=parseFloat(g)||0}return g+eb(b,c,e||(i?"border":"content"),f,h)+"px"}function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if("string"===(f=typeof c)&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c==c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!g||!("set"in g)||void 0!==(c=g.set(a,c,d))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),(g=n.cssHooks[b]||n.cssHooks[h])&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),!0===c||isFinite(e)?e||0:f):f}}),n.each(["height","width"],(function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,(function(){return fb(a,b,d)})):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(0,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}})),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,(function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0})),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,(function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{marginLeft:0},(function(){return a.getBoundingClientRect().left})):0))+"px":void 0})),n.each({margin:"",padding:"",border:"Width"},(function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)})),n.fn.extend({css:function(a,b){return Y(this,(function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)}),a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each((function(){W(this)?n(this).show():n(this).hide()}))}}),n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""))&&"auto"!==b?b:0},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout((function(){hb=void 0})),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)d["margin"+(c=V[e])]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always((function(){delete i.elem})),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),f=1-(c/j.duration||0),g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(function(a,b){var c,d,e,f,g;for(c in a)if(e=b[d=n.camelCase(c)],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),(g=n.cssHooks[d])&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[function(a,b,c){var d,e,f,g,h,i,j,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");for(d in c.queue||(null==(h=n._queueHooks(a,"fx")).unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always((function(){m.always((function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()}))}))),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===("none"===(j=n.css(a,"display"))?n._data(a,"olddisplay")||Ma(a.nodeName):j)&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always((function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}))),b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else for(d in r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done((function(){n(a).hide()})),m.done((function(){var b;for(b in n._removeData(a,"fxshow"),o)n.style(a,b,o[b])})),o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&!0!==d.queue||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||!1===f.queue?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&!1!==a&&this.queue(a||"fx",[]),this.each((function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)}))},finish:function(a){return!1!==a&&(a=a||"fx"),this.each((function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish}))}}),n.each(["toggle","show","hide"],(function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}})),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}})),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)(a=b[c])()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx&&n.fx.speeds[b]||b,c=c||"fx",this.queue(c,(function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}}))},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));(c=d.createElement("div")).setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),(a=c.getElementsByTagName("a")[0]).style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,(b=d.createElement("input")).setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];return arguments.length?(d=n.isFunction(a),this.each((function(c){var e;1===this.nodeType&&(null==(e=d?a.call(this,c,n(this).val()):a)?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,(function(a){return null==a?"":a+""}))),(b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()])&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))}))):e?(b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()])&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:"string"==typeof(c=e.value)?c.replace(rb,""):null==c?"":c:void 0}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(((c=d[i]).selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=n.makeArray(b),g=e.length;g--;)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],(function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}));var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each((function(){n.removeAttr(this,a)}))}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return void 0===a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:null==(d=n.find.attr(a,b))?void 0:d)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)for(;c=f[e++];)d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return!1===b?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),(function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}})),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""!==b&&b,c)}},n.each(["width","height"],(function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}}))),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each((function(){try{this[a]=void 0,delete this[a]}catch(b){}}))}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),l.hrefNormalized||n.each(["href","src"],(function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}})),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){n.propFix[this.toLowerCase()]=this})),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each((function(b){n(this).addClass(a.call(this,b,Cb(this)))}));if("string"==typeof a&&a)for(b=a.match(G)||[];c=this[i++];)if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){for(g=0;f=b[g++];)d.indexOf(" "+f+" ")<0&&(d+=f+" ");e!==(h=n.trim(d))&&n.attr(c,"class",h)}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each((function(b){n(this).removeClass(a.call(this,b,Cb(this)))}));if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a)for(b=a.match(G)||[];c=this[i++];)if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){for(g=0;f=b[g++];)for(;d.indexOf(" "+f+" ")>-1;)d=d.replace(" "+f+" "," ");e!==(h=n.trim(d))&&n.attr(c,"class",h)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each((function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)})):this.each((function(){var b,d,e,f;if("string"===c)for(d=0,e=n(this),f=a.match(G)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else void 0!==a&&"boolean"!==c||((b=Cb(this))&&n._data(this,"__className__",b),n.attr(this,"class",b||!1===a?"":n._data(this,"__className__")||""))}))},hasClass:function(a){var b,c,d=0;for(b=" "+a+" ";c=this[d++];)if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),(function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}})),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,(function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")})))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c;if(!b||"string"!=typeof b)return null;try{a.DOMParser?c=(new a.DOMParser).parseFromString(b,"text/xml"):((c=new a.ActiveXObject("Microsoft.XMLDOM")).async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))for(;d=f[e++];)"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],(function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)})),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Yb(a){return a.style&&a.style.display||n.css(a,"display")}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k)for(k={};b=Jb.exec(g);)k[b[1].toLowerCase()]=b[2];b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;for(e in(i=n.event&&l.global)&&0==n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),!1===l.cache&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&!1!==l.contentType||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]),l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(!1===l.beforeSend.call(m,w,l)||2===u))return w.abort();for(e in v="abort",{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout((function(){w.abort("timeout")}),l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=function(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}(l,w,d)),v=function(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(!(g=j[i+" "+f]||j["* "+f]))for(e in j)if((h=e.split(" "))[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){!0===g?g=j[e]:!0!==j[e]&&(f=h[0],k.unshift(h[1]));break}if(!0!==g)if(g&&a.throws)b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}(l,v,w,k),k?(l.ifModified&&((x=w.getResponseHeader("Last-Modified"))&&(n.lastModified[f]=x),(x=w.getResponseHeader("etag"))&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,k=!(t=v.error))):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],(function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}})),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each((function(b){n(this).wrapAll(a.call(this,b))}));if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map((function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a})).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each((function(b){n(this).wrapInner(a.call(this,b))})):this.each((function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)}))},wrap:function(a){var b=n.isFunction(a);return this.each((function(c){n(this).wrapAll(b?a.call(this,c):a)}))},unwrap:function(){return this.parent().each((function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)})).end()}}),n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:function(a){for(;a&&1===a.nodeType;){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,(function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)}));else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,(function(){e(this.name,this.value)}));else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this})).filter((function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))})).map((function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,(function(a){return{name:b.name,value:a.replace(ac,"\r\n")}})):{name:b.name,value:c.replace(ac,"\r\n")}})).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}a.attachEvent&&a.attachEvent("onunload",(function(){for(var a in fc)fc[a](void 0,!0)})),l.cors=!!gc&&"withCredentials"in gc,(gc=l.ajax=!!gc)&&n.ajaxTransport((function(b){var c;if(!b.crossDomain||l.cors)return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];for(f in b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest"),d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}})),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",(function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)})),n.ajaxTransport("script",(function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){(b=d.createElement("script")).async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}}));var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",(function(b,c,d){var e,f,g,h=!1!==b.jsonp&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):!1!==b.jsonp&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always((function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0})),"script"):void 0})),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;function mc(a){return n.isWindow(a)?a:9===a.nodeType&&(a.defaultView||a.parentWindow)}n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done((function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)})).always(c&&function(a,b){g.each((function(){c.apply(this,f||[a.responseText,b,a])}))}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(a,b){n.fn[b]=function(a){return this.on(b,a)}})),n.expr.filters.animated=function(a){return n.grep(n.timers,(function(b){return a===b.elem})).length},n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1?(g=(d=l.position()).top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each((function(b){n.offset.setOffset(this,a,b)}));var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;return f?(b=f.documentElement,n.contains(b,e)?(void 0!==e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d):void 0},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var a=this.offsetParent;a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position");)a=a.offsetParent;return a||Qa}))}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,(function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)}),a,d,arguments.length,null)}})),n.each(["top","left"],(function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,(function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0}))})),n.each({Height:"height",Width:"width"},(function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},(function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(!0===d||!0===e?"margin":"border");return Y(this,(function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)}),b,f?d:void 0,f,null)}}))})),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],(function(){return n}));var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n}));var Board=function(){"use strict";function Board(){}return Board.Radius=225,Board.Rings=[6.35,16,99,107,162,170],Board.Sectors=[20,5,12,9,14,11,8,16,7,19,3,17,2,15,10,6,13,4,18,1],Board.SectorWidth=2*Math.PI/Board.Sectors.length,Board.RadiansToDegrees=function(radians){return radians*(180/Math.PI)},Board.GetSectorValue=function(sectorIndex){return Board.Sectors[sectorIndex]},Board.GetSectorIndex=function(sectorValue){for(var i=0;i<Board.Sectors.length;i++)if(Board.Sectors[i]===sectorValue)return i;throw"No sector on the board has this value "+sectorValue},Board.GetHit=function(point){var pi2=2*Math.PI,rotateAngle=Math.PI/2-Board.SectorWidth/2,nAngle=point.Angle-rotateAngle;Math.abs(nAngle)>pi2&&(nAngle%=pi2),nAngle<0&&(nAngle=pi2+nAngle);for(var sectorIndex=Math.floor(nAngle/Board.SectorWidth),ring=RingType.OOB,r=0;r<Board.Rings.length;r++)if(Board.Rings[r]>point.Radius){ring=r;break}return new Hit(sectorIndex,ring,point)},Board.GetTargetPoint=function(sector,ring){var targetBound=Board.SectorWidth*sector+Board.SectorWidth/2;targetBound+=Math.PI/2-Math.PI/Board.Sectors.length;var radius=Board.GetRingCenter(ring);return new PolarPoint(radius,targetBound)},Board.GetRingCenter=function(ring){if(ring===RingType.DoubleBull||ring===RingType.SingleBull)return 0;if(ring===RingType.OOB)return Board.Rings[Board.Rings.length-1]+5;var thisRing=Board.Rings[ring],lastRing=Board.Rings[ring-1];return(thisRing-lastRing)/2+lastRing},Board.GetHitPoints=function(hit){var points=Board.GetSectorValue(hit.SectorIndex),mult=Board.GetRingMultiple(hit.Ring),thin=RingType.ThinSingle,fat=RingType.FatSingle;if(hit.Ring===RingType.OOB)mult=0;else if(hit.Ring===RingType.Double)mult=2;else if(hit.Ring===RingType.Treble)mult=3;else if(hit.Ring===RingType.SingleBull)mult=1;else if(hit.Ring===RingType.DoubleBull)mult=2;else{if(hit.Ring!==thin&&hit.Ring!==fat)throw"Invalid Segment Type";mult=1}return hit.Ring===RingType.SingleBull?25:hit.Ring===RingType.DoubleBull?50:points*mult},Board.GetRingMultiple=function(ring){var mult=1;if(ring===RingType.OOB)mult=0;else if(ring===RingType.Double)mult=2;else if(ring===RingType.Treble)mult=3;else if(ring===RingType.SingleBull)mult=1;else if(ring===RingType.DoubleBull)mult=2;else{if(ring!==RingType.FatSingle&&ring!==RingType.ThinSingle)throw"Invalid Segment Type";mult=1}return mult},Board}(),RingType={DoubleBull:0,SingleBull:1,ThinSingle:2,Treble:3,FatSingle:4,Double:5,OOB:6},Hit=function(){"use strict";function Hit(sector,ring,point){this.SectorIndex=sector,this.Ring=ring,this.Point=point||Board.GetTargetPoint(sector,ring)}return Hit.prototype.IsDouble=function(){return this.Ring===RingType.Double||this.Ring===RingType.DoubleBull},Hit.prototype.toString=function(){if(this.Ring===RingType.DoubleBull)return"DB";if(this.Ring===RingType.SingleBull)return"SB";if(this.Ring===RingType.OOB)return"OOB";var s=[];s[RingType.ThinSingle]="S",s[RingType.Treble]="T",s[RingType.FatSingle]="S",s[RingType.Double]="D";var str=s[this.Ring];return str+=Board.GetSectorValue(this.SectorIndex)},Hit.prototype.equals=function(hit){return this.Ring===hit.Ring&&(this.Ring===RingType.DoubleBull||(this.Ring===RingType.SingleBull||(this.Ring===RingType.OOB||this.SectorIndex===hit.SectorIndex)))},Hit}(),PolarPoint=function(){"use strict";function PolarPoint(radius,angle){this.Radius=radius,this.Angle=angle}return PolarPoint.GetCartesian=function(point){return{X:PolarPoint.GetCartesianX(point),Y:PolarPoint.GetCartesianY(point)}},PolarPoint.GetCartesianX=function(point){return point.Radius*Math.cos(point.Angle)},PolarPoint.GetCartesianY=function(point){return point.Radius*Math.sin(point.Angle)},PolarPoint.GetFromCartesian=function(x,y){var radiusHit=Math.sqrt(x*x+y*y),angleHit=Math.atan2(y,x);return radiusHit<0&&(radiusHit=Math.abs(radiusHit),angleHit+=Math.PI),angleHit<0&&(angleHit+=2*Math.PI),new PolarPoint(radiusHit,angleHit)},PolarPoint.AddPoints=function(point1,point2){var xOff=PolarPoint.GetCartesianX(point2),yOff=PolarPoint.GetCartesianY(point2),xHit=PolarPoint.GetCartesianX(point1)+xOff,yHit=PolarPoint.GetCartesianY(point1)+yOff;return PolarPoint.GetFromCartesian(xHit,yHit)},PolarPoint}(),Random=function(){function Random(){}return Random.GetUniform=function(){return Math.random()},Random.GetNormal=function(mean,stdev){var u1=Random.GetUniform(),u2=Random.GetUniform(),r=Math.sqrt(-2*Math.log(u1)),theta=2*Math.PI*u2,normal=r*Math.sin(theta);return normal=mean+stdev*normal},Random.GetLognormal=function(mean,stdev){var normal=Random.GetNormal(mean,stdev);return Math.exp(normal)},Random}();!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.moment=t()}(this,(function(){"use strict";var H;function f(){return H.apply(null,arguments)}function a(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function F(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(c(e,t))return;return 1}function o(e){return void 0===e}function u(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function V(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function G(e,t){for(var n=[],s=e.length,i=0;i<s;++i)n.push(t(e[i],i));return n}function E(e,t){for(var n in t)c(t,n)&&(e[n]=t[n]);return c(t,"toString")&&(e.toString=t.toString),c(t,"valueOf")&&(e.valueOf=t.valueOf),e}function l(e,t,n,s){return Pt(e,t,n,s,!0).utc()}function m(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function A(e){if(null==e._isValid){var t=m(e),n=j.call(t.parsedDateParts,(function(e){return null!=e}));n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function I(e){var t=l(NaN);return null!=e?E(m(t),e):m(t).userInvalidated=!0,t}var j=Array.prototype.some||function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return!0;return!1},Z=f.momentProperties=[],z=!1;function $(e,t){var n,s,i,r=Z.length;if(o(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),o(t._i)||(e._i=t._i),o(t._f)||(e._f=t._f),o(t._l)||(e._l=t._l),o(t._strict)||(e._strict=t._strict),o(t._tzm)||(e._tzm=t._tzm),o(t._isUTC)||(e._isUTC=t._isUTC),o(t._offset)||(e._offset=t._offset),o(t._pf)||(e._pf=m(t)),o(t._locale)||(e._locale=t._locale),0<r)for(n=0;n<r;n++)o(i=t[s=Z[n]])||(e[s]=i);return e}function q(e){$(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===z&&(z=!0,f.updateOffset(this),z=!1)}function h(e){return e instanceof q||null!=e&&null!=e._isAMomentObject}function B(e){!1===f.suppressDeprecationWarnings&&void 0!==console&&console.warn&&console.warn("Deprecation warning: "+e)}function e(r,a){var o=!0;return E((function(){if(null!=f.deprecationHandler&&f.deprecationHandler(null,r),o){for(var e,t,n=[],s=arguments.length,i=0;i<s;i++){if(e="","object"==typeof arguments[i]){for(t in e+="\n["+i+"] ",arguments[0])c(arguments[0],t)&&(e+=t+": "+arguments[0][t]+", ");e=e.slice(0,-2)}else e=arguments[i];n.push(e)}B(r+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),o=!1}return a.apply(this,arguments)}),a)}var J={};function Q(e,t){null!=f.deprecationHandler&&f.deprecationHandler(e,t),J[e]||(B(t),J[e]=!0)}function d(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function X(e,t){var n,s=E({},e);for(n in t)c(t,n)&&(F(e[n])&&F(t[n])?(s[n]={},E(s[n],e[n]),E(s[n],t[n])):null!=t[n]?s[n]=t[n]:delete s[n]);for(n in e)c(e,n)&&!c(t,n)&&F(e[n])&&(s[n]=E({},s[n]));return s}function K(e){null!=e&&this.set(e)}f.suppressDeprecationWarnings=!1,f.deprecationHandler=null;var ee=Object.keys||function(e){var t,n=[];for(t in e)c(e,t)&&n.push(t);return n};function r(e,t,n){var s=""+Math.abs(e);return(0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,t-s.length)).toString().substr(1)+s}var te=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,ne=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,se={},ie={};function s(e,t,n,s){var i="string"==typeof s?function(){return this[s]()}:s;e&&(ie[e]=i),t&&(ie[t[0]]=function(){return r(i.apply(this,arguments),t[1],t[2])}),n&&(ie[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function re(e,t){return e.isValid()?(t=ae(t,e.localeData()),se[t]=se[t]||function(s){for(var e,i=s.match(te),t=0,r=i.length;t<r;t++)ie[i[t]]?i[t]=ie[i[t]]:i[t]=(e=i[t]).match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"");return function(e){for(var t="",n=0;n<r;n++)t+=d(i[n])?i[n].call(e,s):i[n];return t}}(t),se[t](e)):e.localeData().invalidDate()}function ae(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(ne.lastIndex=0;0<=n&&ne.test(e);)e=e.replace(ne,s),ne.lastIndex=0,--n;return e}var oe={};function t(e,t){var n=e.toLowerCase();oe[n]=oe[n+"s"]=oe[t]=e}function _(e){return"string"==typeof e?oe[e]||oe[e.toLowerCase()]:void 0}function ue(e){var t,n,s={};for(n in e)c(e,n)&&(t=_(n))&&(s[t]=e[n]);return s}var le={};function n(e,t){le[e]=t}function he(e){return e%4==0&&e%100!=0||e%400==0}function y(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function g(e){var t=0;return 0!=(e=+e)&&isFinite(e)?y(e):t}function de(t,n){return function(e){return null!=e?(fe(this,t,e),f.updateOffset(this,n),this):ce(this,t)}}function ce(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function fe(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&he(e.year())&&1===e.month()&&29===e.date()?(n=g(n),e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),We(n,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](n))}var i=/\d/,w=/\d\d/,me=/\d{3}/,_e=/\d{4}/,ye=/[+-]?\d{6}/,p=/\d\d?/,ge=/\d\d\d\d?/,we=/\d\d\d\d\d\d?/,pe=/\d{1,3}/,ke=/\d{1,4}/,ve=/[+-]?\d{1,6}/,Me=/\d+/,De=/[+-]?\d+/,Se=/Z|[+-]\d\d:?\d\d/gi,Ye=/Z|[+-]\d\d(?::?\d\d)?/gi,k=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function v(e,n,s){be[e]=d(n)?n:function(e,t){return e&&s?s:n}}function Oe(e,t){return c(be,e)?be[e](t._strict,t._locale):new RegExp(M(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,n,s,i){return t||n||s||i}))))}function M(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var be={},xe={};function D(e,n){var t,s,i=n;for("string"==typeof e&&(e=[e]),u(n)&&(i=function(e,t){t[n]=g(e)}),s=e.length,t=0;t<s;t++)xe[e[t]]=i}function Te(e,i){D(e,(function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)}))}var S;function We(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=(t%(n=12)+n)%n;return e+=(t-n)/12,1==n?he(e)?29:28:31-n%7%2}S=Array.prototype.indexOf||function(e){for(var t=0;t<this.length;++t)if(this[t]===e)return t;return-1},s("M",["MM",2],"Mo",(function(){return this.month()+1})),s("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)})),s("MMMM",0,0,(function(e){return this.localeData().months(this,e)})),t("month","M"),n("month",8),v("M",p),v("MM",p,w),v("MMM",(function(e,t){return t.monthsShortRegex(e)})),v("MMMM",(function(e,t){return t.monthsRegex(e)})),D(["M","MM"],(function(e,t){t[1]=g(e)-1})),D(["MMM","MMMM"],(function(e,t,n,s){null!=(s=n._locale.monthsParse(e,s,n._strict))?t[1]=s:m(n).invalidMonth=e}));var Ce="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ue="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),He=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Fe=k,Le=k;function Ve(e,t){var n;if(e.isValid()){if("string"==typeof t)if(/^\d+$/.test(t))t=g(t);else if(!u(t=e.localeData().monthsParse(t)))return;n=Math.min(e.date(),We(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n)}}function Ge(e){return null!=e?(Ve(this,e),f.updateOffset(this,!0),this):ce(this,"Month")}function Ee(){function e(e,t){return t.length-e.length}for(var t,n=[],s=[],i=[],r=0;r<12;r++)t=l([2e3,r]),n.push(this.monthsShort(t,"")),s.push(this.months(t,"")),i.push(this.months(t,"")),i.push(this.monthsShort(t,""));for(n.sort(e),s.sort(e),i.sort(e),r=0;r<12;r++)n[r]=M(n[r]),s[r]=M(s[r]);for(r=0;r<24;r++)i[r]=M(i[r]);this._monthsRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+n.join("|")+")","i")}function Ae(e){return he(e)?366:365}s("Y",0,0,(function(){var e=this.year();return e<=9999?r(e,4):"+"+e})),s(0,["YY",2],0,(function(){return this.year()%100})),s(0,["YYYY",4],0,"year"),s(0,["YYYYY",5],0,"year"),s(0,["YYYYYY",6,!0],0,"year"),t("year","y"),n("year",1),v("Y",De),v("YY",p,w),v("YYYY",ke,_e),v("YYYYY",ve,ye),v("YYYYYY",ve,ye),D(["YYYYY","YYYYYY"],0),D("YYYY",(function(e,t){t[0]=2===e.length?f.parseTwoDigitYear(e):g(e)})),D("YY",(function(e,t){t[0]=f.parseTwoDigitYear(e)})),D("Y",(function(e,t){t[0]=parseInt(e,10)})),f.parseTwoDigitYear=function(e){return g(e)+(68<g(e)?1900:2e3)};var Ie=de("FullYear",!0);function je(e,t,n,s,i,r,a){var o;return e<100&&0<=e?(o=new Date(e+400,t,n,s,i,r,a),isFinite(o.getFullYear())&&o.setFullYear(e)):o=new Date(e,t,n,s,i,r,a),o}function Ze(e){var t;return e<100&&0<=e?((t=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,t)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function ze(e,t,n){return(n=7+t-n)-(7+Ze(e,0,n).getUTCDay()-t)%7-1}function $e(e,t,n,s,i){var r;n=(t=1+7*(t-1)+(7+n-s)%7+ze(e,s,i))<=0?Ae(r=e-1)+t:t>Ae(e)?(r=e+1,t-Ae(e)):(r=e,t);return{year:r,dayOfYear:n}}function qe(e,t,n){var s,i,r=ze(e.year(),t,n);return(r=Math.floor((e.dayOfYear()-r-1)/7)+1)<1?s=r+P(i=e.year()-1,t,n):r>P(e.year(),t,n)?(s=r-P(e.year(),t,n),i=e.year()+1):(i=e.year(),s=r),{week:s,year:i}}function P(e,t,n){var s=ze(e,t,n);t=ze(e+1,t,n);return(Ae(e)-s+t)/7}function Be(e,t){return e.slice(t,7).concat(e.slice(0,t))}s("w",["ww",2],"wo","week"),s("W",["WW",2],"Wo","isoWeek"),t("week","w"),t("isoWeek","W"),n("week",5),n("isoWeek",5),v("w",p),v("ww",p,w),v("W",p),v("WW",p,w),Te(["w","ww","W","WW"],(function(e,t,n,s){t[s.substr(0,1)]=g(e)})),s("d",0,"do","day"),s("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)})),s("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)})),s("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)})),s("e",0,0,"weekday"),s("E",0,0,"isoWeekday"),t("day","d"),t("weekday","e"),t("isoWeekday","E"),n("day",11),n("weekday",11),n("isoWeekday",11),v("d",p),v("e",p),v("E",p),v("dd",(function(e,t){return t.weekdaysMinRegex(e)})),v("ddd",(function(e,t){return t.weekdaysShortRegex(e)})),v("dddd",(function(e,t){return t.weekdaysRegex(e)})),Te(["dd","ddd","dddd"],(function(e,t,n,s){null!=(s=n._locale.weekdaysParse(e,s,n._strict))?t.d=s:m(n).invalidWeekday=e})),Te(["d","e","E"],(function(e,t,n,s){t[s]=g(e)}));var Je="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Qe="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Xe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ke=k,et=k,tt=k;function nt(){function e(e,t){return t.length-e.length}for(var t,n,s,i=[],r=[],a=[],o=[],u=0;u<7;u++)s=l([2e3,1]).day(u),t=M(this.weekdaysMin(s,"")),n=M(this.weekdaysShort(s,"")),s=M(this.weekdays(s,"")),i.push(t),r.push(n),a.push(s),o.push(t),o.push(n),o.push(s);i.sort(e),r.sort(e),a.sort(e),o.sort(e),this._weekdaysRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function st(){return this.hours()%12||12}function it(e,t){s(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}function rt(e,t){return t._meridiemParse}s("H",["HH",2],0,"hour"),s("h",["hh",2],0,st),s("k",["kk",2],0,(function(){return this.hours()||24})),s("hmm",0,0,(function(){return""+st.apply(this)+r(this.minutes(),2)})),s("hmmss",0,0,(function(){return""+st.apply(this)+r(this.minutes(),2)+r(this.seconds(),2)})),s("Hmm",0,0,(function(){return""+this.hours()+r(this.minutes(),2)})),s("Hmmss",0,0,(function(){return""+this.hours()+r(this.minutes(),2)+r(this.seconds(),2)})),it("a",!0),it("A",!1),t("hour","h"),n("hour",13),v("a",rt),v("A",rt),v("H",p),v("h",p),v("k",p),v("HH",p,w),v("hh",p,w),v("kk",p,w),v("hmm",ge),v("hmmss",we),v("Hmm",ge),v("Hmmss",we),D(["H","HH"],3),D(["k","kk"],(function(e,t,n){e=g(e),t[3]=24===e?0:e})),D(["a","A"],(function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e})),D(["h","hh"],(function(e,t,n){t[3]=g(e),m(n).bigHour=!0})),D("hmm",(function(e,t,n){var s=e.length-2;t[3]=g(e.substr(0,s)),t[4]=g(e.substr(s)),m(n).bigHour=!0})),D("hmmss",(function(e,t,n){var s=e.length-4,i=e.length-2;t[3]=g(e.substr(0,s)),t[4]=g(e.substr(s,2)),t[5]=g(e.substr(i)),m(n).bigHour=!0})),D("Hmm",(function(e,t,n){var s=e.length-2;t[3]=g(e.substr(0,s)),t[4]=g(e.substr(s))})),D("Hmmss",(function(e,t,n){var s=e.length-4,i=e.length-2;t[3]=g(e.substr(0,s)),t[4]=g(e.substr(s,2)),t[5]=g(e.substr(i))})),k=de("Hours",!0);var at,ot={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Ce,monthsShort:Ue,week:{dow:0,doy:6},weekdays:Je,weekdaysMin:Xe,weekdaysShort:Qe,meridiemParse:/[ap]\.?m?\.?/i},R={},ut={};function lt(e){return e&&e.toLowerCase().replace("_","-")}function dt(t){var e;if(void 0===R[t]&&"undefined"!=typeof module&&module&&module.exports&&null!=t.match("^[^/\\\\]*$"))try{e=at._abbr,require("./locale/"+t),ct(e)}catch(e){R[t]=null}return R[t]}function ct(e,t){return e&&((t=o(t)?mt(e):ft(e,t))?at=t:void 0!==console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),at._abbr}function ft(e,t){if(null===t)return delete R[e],null;var n,s=ot;if(t.abbr=e,null!=R[e])Q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=R[e]._config;else if(null!=t.parentLocale)if(null!=R[t.parentLocale])s=R[t.parentLocale]._config;else{if(null==(n=dt(t.parentLocale)))return ut[t.parentLocale]||(ut[t.parentLocale]=[]),ut[t.parentLocale].push({name:e,config:t}),null;s=n._config}return R[e]=new K(X(s,t)),ut[e]&&ut[e].forEach((function(e){ft(e.name,e.config)})),ct(e),R[e]}function mt(e){var t;if(!(e=e&&e._locale&&e._locale._abbr?e._locale._abbr:e))return at;if(!a(e)){if(t=dt(e))return t;e=[e]}return function(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=lt(e[r]).split("-")).length,n=(n=lt(e[r+1]))?n.split("-"):null;0<t;){if(s=dt(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&function(e,t){for(var n=Math.min(e.length,t.length),s=0;s<n;s+=1)if(e[s]!==t[s])return s;return n}(i,n)>=t-1)break;t--}r++}return at}(e)}function _t(e){var t=e._a;return t&&-2===m(e).overflow&&(t=t[1]<0||11<t[1]?1:t[2]<1||t[2]>We(t[0],t[1])?2:t[3]<0||24<t[3]||24===t[3]&&(0!==t[4]||0!==t[5]||0!==t[6])?3:t[4]<0||59<t[4]?4:t[5]<0||59<t[5]?5:t[6]<0||999<t[6]?6:-1,m(e)._overflowDayOfYear&&(t<0||2<t)&&(t=2),m(e)._overflowWeeks&&-1===t&&(t=7),m(e)._overflowWeekday&&-1===t&&(t=8),m(e).overflow=t),e}var yt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,wt=/Z|[+-]\d\d(?::?\d\d)?/,pt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],kt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],vt=/^\/?Date\((-?\d+)/i,Mt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Dt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function St(e){var t,n,s,i,r,a,o=e._i,u=yt.exec(o)||gt.exec(o),l=(o=pt.length,kt.length);if(u){for(m(e).iso=!0,t=0,n=o;t<n;t++)if(pt[t][1].exec(u[1])){i=pt[t][0],s=!1!==pt[t][2];break}if(null==i)e._isValid=!1;else{if(u[3]){for(t=0,n=l;t<n;t++)if(kt[t][1].exec(u[3])){r=(u[2]||" ")+kt[t][0];break}if(null==r)return void(e._isValid=!1)}if(s||null==r){if(u[4]){if(!wt.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),Tt(e)}else e._isValid=!1}}else e._isValid=!1}function Ot(e){var t,n,s,i,r=Mt.exec(e._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));r?(s=t=function(e,t,n,s,i,r){return e=[function(e){return(e=parseInt(e,10))<=49?2e3+e:e<=999?1900+e:e}(e),Ue.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)],r&&e.push(parseInt(r,10)),e}(r[4],r[3],r[2],r[5],r[6],r[7]),i=e,(n=r[1])&&Qe.indexOf(n)!==new Date(s[0],s[1],s[2]).getDay()?(m(i).weekdayMismatch=!0,i._isValid=!1):(e._a=t,e._tzm=(n=r[8],s=r[9],i=r[10],n?Dt[n]:s?0:((n=parseInt(i,10))-(s=n%100))/100*60+s),e._d=Ze.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),m(e).rfc2822=!0)):e._isValid=!1}function bt(e,t,n){return null!=e?e:null!=t?t:n}function xt(e){var t,n,s,i,r,a,o,u,l,h,d,c=[];if(!e._d){for(s=e,i=new Date(f.now()),n=s._useUTC?[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()]:[i.getFullYear(),i.getMonth(),i.getDate()],e._w&&null==e._a[2]&&null==e._a[1]&&(null!=(i=(s=e)._w).GG||null!=i.W||null!=i.E?(u=1,l=4,r=bt(i.GG,s._a[0],qe(W(),1,4).year),a=bt(i.W,1),((o=bt(i.E,1))<1||7<o)&&(h=!0)):(u=s._locale._week.dow,l=s._locale._week.doy,d=qe(W(),u,l),r=bt(i.gg,s._a[0],d.year),a=bt(i.w,d.week),null!=i.d?((o=i.d)<0||6<o)&&(h=!0):null!=i.e?(o=i.e+u,(i.e<0||6<i.e)&&(h=!0)):o=u),a<1||a>P(r,u,l)?m(s)._overflowWeeks=!0:null!=h?m(s)._overflowWeekday=!0:(d=$e(r,a,o,u,l),s._a[0]=d.year,s._dayOfYear=d.dayOfYear)),null!=e._dayOfYear&&(i=bt(e._a[0],n[0]),(e._dayOfYear>Ae(i)||0===e._dayOfYear)&&(m(e)._overflowDayOfYear=!0),h=Ze(i,0,e._dayOfYear),e._a[1]=h.getUTCMonth(),e._a[2]=h.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=c[t]=n[t];for(;t<7;t++)e._a[t]=c[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[3]&&0===e._a[4]&&0===e._a[5]&&0===e._a[6]&&(e._nextDay=!0,e._a[3]=0),e._d=(e._useUTC?Ze:je).apply(null,c),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[3]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(m(e).weekdayMismatch=!0)}}function Tt(e){if(e._f===f.ISO_8601)St(e);else if(e._f===f.RFC_2822)Ot(e);else{e._a=[],m(e).empty=!0;for(var t,n,s,i,r,a=""+e._i,o=a.length,u=0,l=ae(e._f,e._locale).match(te)||[],h=l.length,d=0;d<h;d++)n=l[d],(t=(a.match(Oe(n,e))||[])[0])&&(0<(s=a.substr(0,a.indexOf(t))).length&&m(e).unusedInput.push(s),a=a.slice(a.indexOf(t)+t.length),u+=t.length),ie[n]?(t?m(e).empty=!1:m(e).unusedTokens.push(n),s=n,r=e,null!=(i=t)&&c(xe,s)&&xe[s](i,r._a,r,s)):e._strict&&!t&&m(e).unusedTokens.push(n);m(e).charsLeftOver=o-u,0<a.length&&m(e).unusedInput.push(a),e._a[3]<=12&&!0===m(e).bigHour&&0<e._a[3]&&(m(e).bigHour=void 0),m(e).parsedDateParts=e._a.slice(0),m(e).meridiem=e._meridiem,e._a[3]=function(e,t,n){return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((e=e.isPM(n))&&t<12&&(t+=12),t=e||12!==t?t:0):t}(e._locale,e._a[3],e._meridiem),null!==(o=m(e).era)&&(e._a[0]=e._locale.erasConvertYear(o,e._a[0])),xt(e),_t(e)}}function Nt(e){var t,n,s,i=e._i,r=e._f;return e._locale=e._locale||mt(e._l),null===i||void 0===r&&""===i?I({nullInput:!0}):("string"==typeof i&&(e._i=i=e._locale.preparse(i)),h(i)?new q(_t(i)):(V(i)?e._d=i:a(r)?function(e){var t,n,s,i,r,a,o=!1,u=e._f.length;if(0===u)return m(e).invalidFormat=!0,e._d=new Date(NaN);for(i=0;i<u;i++)r=0,a=!1,t=$({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[i],Tt(t),A(t)&&(a=!0),r=(r+=m(t).charsLeftOver)+10*m(t).unusedTokens.length,m(t).score=r,o?r<s&&(s=r,n=t):(null==s||r<s||a)&&(s=r,n=t,a&&(o=!0));E(e,n||t)}(e):r?Tt(e):o(r=(i=e)._i)?i._d=new Date(f.now()):V(r)?i._d=new Date(r.valueOf()):"string"==typeof r?(n=i,null!==(t=vt.exec(n._i))?n._d=new Date(+t[1]):(St(n),!1===n._isValid&&(delete n._isValid,Ot(n),!1===n._isValid&&(delete n._isValid,n._strict?n._isValid=!1:f.createFromInputFallback(n))))):a(r)?(i._a=G(r.slice(0),(function(e){return parseInt(e,10)})),xt(i)):F(r)?(t=i)._d||(s=void 0===(n=ue(t._i)).day?n.date:n.day,t._a=G([n.year,n.month,s,n.hour,n.minute,n.second,n.millisecond],(function(e){return e&&parseInt(e,10)})),xt(t)):u(r)?i._d=new Date(r):f.createFromInputFallback(i),A(e)||(e._d=null),e))}function Pt(e,t,n,s,i){var r={};return!0!==t&&!1!==t||(s=t,t=void 0),!0!==n&&!1!==n||(s=n,n=void 0),(F(e)&&L(e)||a(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=i,r._l=n,r._i=e,r._f=t,r._strict=s,(i=new q(_t(Nt(i=r))))._nextDay&&(i.add(1,"d"),i._nextDay=void 0),i}function W(e,t,n,s){return Pt(e,t,n,s,!1)}function Rt(e,t){var n,s;if(!(t=1===t.length&&a(t[0])?t[0]:t).length)return W();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}f.createFromInputFallback=e("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))})),f.ISO_8601=function(){},f.RFC_2822=function(){},ge=e("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=W.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:I()})),we=e("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=W.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:I()}));var Wt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ct(e){var t=(e=ue(e)).year||0,n=e.quarter||0,s=e.month||0,i=e.week||e.isoWeek||0,r=e.day||0,a=e.hour||0,o=e.minute||0,u=e.second||0,l=e.millisecond||0;this._isValid=function(e){var t,n,s=!1,i=Wt.length;for(t in e)if(c(e,t)&&(-1===S.call(Wt,t)||null!=e[t]&&isNaN(e[t])))return!1;for(n=0;n<i;++n)if(e[Wt[n]]){if(s)return!1;parseFloat(e[Wt[n]])!==g(e[Wt[n]])&&(s=!0)}return!0}(e),this._milliseconds=+l+1e3*u+6e4*o+1e3*a*60*60,this._days=+r+7*i,this._months=+s+3*n+12*t,this._data={},this._locale=mt(),this._bubble()}function Ut(e){return e instanceof Ct}function Ht(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){s(e,0,0,(function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+r(~~(e/60),2)+n+r(~~e%60,2)}))}Ft("Z",":"),Ft("ZZ",""),v("Z",Ye),v("ZZ",Ye),D(["Z","ZZ"],(function(e,t,n){n._useUTC=!0,n._tzm=Vt(Ye,e)}));var Lt=/([\+\-]|\d\d)/gi;function Vt(e,t){return null===(t=(t||"").match(e))?null:0===(t=60*(e=((t[t.length-1]||[])+"").match(Lt)||["-",0,0])[1]+g(e[2]))?0:"+"===e[0]?t:-t}function Gt(e,t){var n;return t._isUTC?(t=t.clone(),n=(h(e)||V(e)?e:W(e)).valueOf()-t.valueOf(),t._d.setTime(t._d.valueOf()+n),f.updateOffset(t,!1),t):W(e).local()}function Et(e){return-Math.round(e._d.getTimezoneOffset())}function At(){return!!this.isValid()&&this._isUTC&&0===this._offset}f.updateOffset=function(){};var It=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,jt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function C(e,t){var n,s=e,i=null;return Ut(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:u(e)||!isNaN(+e)?(s={},t?s[t]=+e:s.milliseconds=+e):(i=It.exec(e))?(n="-"===i[1]?-1:1,s={y:0,d:g(i[2])*n,h:g(i[3])*n,m:g(i[4])*n,s:g(i[5])*n,ms:g(Ht(1e3*i[6]))*n}):(i=jt.exec(e))?(n="-"===i[1]?-1:1,s={y:Zt(i[2],n),M:Zt(i[3],n),w:Zt(i[4],n),d:Zt(i[5],n),h:Zt(i[6],n),m:Zt(i[7],n),s:Zt(i[8],n)}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(t=function(e,t){var n;return e.isValid()&&t.isValid()?(t=Gt(t,e),e.isBefore(t)?n=zt(e,t):((n=zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}(W(s.from),W(s.to)),(s={}).ms=t.milliseconds,s.M=t.months),i=new Ct(s),Ut(e)&&c(e,"_locale")&&(i._locale=e._locale),Ut(e)&&c(e,"_isValid")&&(i._isValid=e._isValid),i}function Zt(e,t){return e=e&&parseFloat(e.replace(",",".")),(isNaN(e)?0:e)*t}function zt(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function $t(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(Q(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),qt(this,C(e,t),s),this}}function qt(e,t,n,s){var i=t._milliseconds,r=Ht(t._days);t=Ht(t._months);e.isValid()&&(s=null==s||s,t&&Ve(e,ce(e,"Month")+t*n),r&&fe(e,"Date",ce(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s&&f.updateOffset(e,r||t))}function Bt(e){return"string"==typeof e||e instanceof String}function Jt(e){return h(e)||V(e)||Bt(e)||u(e)||function(t){var e=a(t),n=!1;return e&&(n=0===t.filter((function(e){return!u(e)&&Bt(t)})).length),e&&n}(e)||function(e){var t,s=F(e)&&!L(e),i=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],a=r.length;for(t=0;t<a;t+=1)i=i||c(e,r[t]);return s&&i}(e)||null==e}function Qt(e,t){if(e.date()<t.date())return-Qt(t,e);var n=12*(t.year()-e.year())+(t.month()-e.month()),s=e.clone().add(n,"months");return-(n+(t=t-s<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(1+n,"months")-s)))||0}function Xt(e){return void 0===e?this._locale._abbr:(null!=(e=mt(e))&&(this._locale=e),this)}function Kt(){return this._locale}C.fn=Ct.prototype,C.invalid=function(){return C(NaN)},Ce=$t(1,"add"),Je=$t(-1,"subtract"),f.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",f.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]",Xe=e("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){return void 0===e?this.localeData():this.locale(e)}));var en=126227808e5;function tn(e,t){return(e%t+t)%t}function nn(e,t,n){return e<100&&0<=e?new Date(e+400,t,n)-en:new Date(e,t,n).valueOf()}function sn(e,t,n){return e<100&&0<=e?Date.UTC(e+400,t,n)-en:Date.UTC(e,t,n)}function rn(e,t){return t.erasAbbrRegex(e)}function an(){for(var e=[],t=[],n=[],s=[],i=this.eras(),r=0,a=i.length;r<a;++r)t.push(M(i[r].name)),e.push(M(i[r].abbr)),n.push(M(i[r].narrow)),s.push(M(i[r].name)),s.push(M(i[r].abbr)),s.push(M(i[r].narrow));this._erasRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+t.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+e.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+n.join("|")+")","i")}function on(e,t){s(0,[e,e.length],0,t)}function un(e,t,n,s,i){var r;return null==e?qe(this,s,i).year:(r=P(e,s,i),function(e,t,n,s,i){return t=Ze((e=$e(e,t,n,s,i)).year,0,e.dayOfYear),this.year(t.getUTCFullYear()),this.month(t.getUTCMonth()),this.date(t.getUTCDate()),this}.call(this,e,t=r<t?r:t,n,s,i))}s("N",0,0,"eraAbbr"),s("NN",0,0,"eraAbbr"),s("NNN",0,0,"eraAbbr"),s("NNNN",0,0,"eraName"),s("NNNNN",0,0,"eraNarrow"),s("y",["y",1],"yo","eraYear"),s("y",["yy",2],0,"eraYear"),s("y",["yyy",3],0,"eraYear"),s("y",["yyyy",4],0,"eraYear"),v("N",rn),v("NN",rn),v("NNN",rn),v("NNNN",(function(e,t){return t.erasNameRegex(e)})),v("NNNNN",(function(e,t){return t.erasNarrowRegex(e)})),D(["N","NN","NNN","NNNN","NNNNN"],(function(e,t,n,s){(s=n._locale.erasParse(e,s,n._strict))?m(n).era=s:m(n).invalidEra=e})),v("y",Me),v("yy",Me),v("yyy",Me),v("yyyy",Me),v("yo",(function(e,t){return t._eraYearOrdinalRegex||Me})),D(["y","yy","yyy","yyyy"],0),D(["yo"],(function(e,t,n,s){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?t[0]=n._locale.eraYearOrdinalParse(e,i):t[0]=parseInt(e,10)})),s(0,["gg",2],0,(function(){return this.weekYear()%100})),s(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),on("gggg","weekYear"),on("ggggg","weekYear"),on("GGGG","isoWeekYear"),on("GGGGG","isoWeekYear"),t("weekYear","gg"),t("isoWeekYear","GG"),n("weekYear",1),n("isoWeekYear",1),v("G",De),v("g",De),v("GG",p,w),v("gg",p,w),v("GGGG",ke,_e),v("gggg",ke,_e),v("GGGGG",ve,ye),v("ggggg",ve,ye),Te(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,n,s){t[s.substr(0,2)]=g(e)})),Te(["gg","GG"],(function(e,t,n,s){t[s]=f.parseTwoDigitYear(e)})),s("Q",0,"Qo","quarter"),t("quarter","Q"),n("quarter",7),v("Q",i),D("Q",(function(e,t){t[1]=3*(g(e)-1)})),s("D",["DD",2],"Do","date"),t("date","D"),n("date",9),v("D",p),v("DD",p,w),v("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient})),D(["D","DD"],2),D("Do",(function(e,t){t[2]=g(e.match(p)[0])})),ke=de("Date",!0),s("DDD",["DDDD",3],"DDDo","dayOfYear"),t("dayOfYear","DDD"),n("dayOfYear",4),v("DDD",pe),v("DDDD",me),D(["DDD","DDDD"],(function(e,t,n){n._dayOfYear=g(e)})),s("m",["mm",2],0,"minute"),t("minute","m"),n("minute",14),v("m",p),v("mm",p,w),D(["m","mm"],4);var ln;_e=de("Minutes",!1),s("s",["ss",2],0,"second"),t("second","s"),n("second",15),v("s",p),v("ss",p,w),D(["s","ss"],5),ve=de("Seconds",!1);for(s("S",0,0,(function(){return~~(this.millisecond()/100)})),s(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),s(0,["SSS",3],0,"millisecond"),s(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),s(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),s(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),s(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),s(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),s(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),t("millisecond","ms"),n("millisecond",16),v("S",pe,i),v("SS",pe,w),v("SSS",pe,me),ln="SSSS";ln.length<=9;ln+="S")v(ln,Me);function hn(e,t){t[6]=g(1e3*("0."+e))}for(ln="S";ln.length<=9;ln+="S")D(ln,hn);function dn(e){return e}function cn(e,t,n,s){var i=mt();s=l().set(s,t);return i[n](s,e)}function fn(e,t,n){if(u(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");for(var s=[],i=0;i<12;i++)s[i]=cn(e,i,n,"month");return s}function mn(e,t,n,s){"boolean"==typeof e?u(t)&&(n=t,t=void 0):(t=e,e=!1,u(n=t)&&(n=t,t=void 0)),t=t||"";var i,r=mt(),a=e?r._week.dow:0,o=[];if(null!=n)return cn(t,(n+a)%7,s,"day");for(i=0;i<7;i++)o[i]=cn(t,(i+a)%7,s,"day");return o}ye=de("Milliseconds",!1),s("z",0,0,"zoneAbbr"),s("zz",0,0,"zoneName"),(i=q.prototype).add=Ce,i.calendar=function(e,t){1===arguments.length&&(arguments[0]?Jt(arguments[0])?(e=arguments[0],t=void 0):function(e){for(var t=F(e)&&!L(e),n=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i=0;i<s.length;i+=1)n=n||c(e,s[i]);return t&&n}(arguments[0])&&(t=arguments[0],e=void 0):t=e=void 0);var n=Gt(e=e||W(),this).startOf("day");n=f.calendarFormat(this,n)||"sameElse",t=t&&(d(t[n])?t[n].call(this,e):t[n]);return this.format(t||this.localeData().calendar(n,this,W(e)))},i.clone=function(){return new q(this)},i.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Gt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=_(t)){case"year":r=Qt(this,s)/12;break;case"month":r=Qt(this,s);break;case"quarter":r=Qt(this,s)/3;break;case"second":r=(this-s)/1e3;break;case"minute":r=(this-s)/6e4;break;case"hour":r=(this-s)/36e5;break;case"day":r=(this-s-i)/864e5;break;case"week":r=(this-s-i)/6048e5;break;default:r=this-s}return n?r:y(r)},i.endOf=function(e){var t,n;if(void 0===(e=_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?sn:nn,e){case"year":t=n(this.year()+1,0,1)-1;break;case"quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=n(this.year(),this.month()+1,1)-1;break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=n(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-tn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-tn(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-tn(t,1e3)-1}return this._d.setTime(t),f.updateOffset(this,!0),this},i.format=function(e){return e=re(this,e=e||(this.isUtc()?f.defaultFormatUtc:f.defaultFormat)),this.localeData().postformat(e)},i.from=function(e,t){return this.isValid()&&(h(e)&&e.isValid()||W(e).isValid())?C({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},i.fromNow=function(e){return this.from(W(),e)},i.to=function(e,t){return this.isValid()&&(h(e)&&e.isValid()||W(e).isValid())?C({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},i.toNow=function(e){return this.to(W(),e)},i.get=function(e){return d(this[e=_(e)])?this[e]():this},i.invalidAt=function(){return m(this).overflow},i.isAfter=function(e,t){return e=h(e)?e:W(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(t).valueOf())},i.isBefore=function(e,t){return e=h(e)?e:W(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()<e.valueOf():this.clone().endOf(t).valueOf()<e.valueOf())},i.isBetween=function(e,t,n,s){return e=h(e)?e:W(e),t=h(t)?t:W(t),!!(this.isValid()&&e.isValid()&&t.isValid())&&("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},i.isSame=function(e,t){e=h(e)?e:W(e);return!(!this.isValid()||!e.isValid())&&("millisecond"===(t=_(t)||"millisecond")?this.valueOf()===e.valueOf():(e=e.valueOf(),this.clone().startOf(t).valueOf()<=e&&e<=this.clone().endOf(t).valueOf()))},i.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},i.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},i.isValid=function(){return A(this)},i.lang=Xe,i.locale=Xt,i.localeData=Kt,i.max=we,i.min=ge,i.parsingFlags=function(){return E({},m(this))},i.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t,n=[];for(t in e)c(e,t)&&n.push({unit:t,priority:le[t]});return n.sort((function(e,t){return e.priority-t.priority})),n}(e=ue(e)),s=n.length,i=0;i<s;i++)this[n[i].unit](e[n[i].unit]);else if(d(this[e=_(e)]))return this[e](t);return this},i.startOf=function(e){var t,n;if(void 0===(e=_(e))||"millisecond"===e||!this.isValid())return this;switch(n=this._isUTC?sn:nn,e){case"year":t=n(this.year(),0,1);break;case"quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case"month":t=n(this.year(),this.month(),1);break;case"week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=n(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=tn(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=tn(t,6e4);break;case"second":t=this._d.valueOf(),t-=tn(t,1e3)}return this._d.setTime(t),f.updateOffset(this,!0),this},i.subtract=Je,i.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},i.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},i.toDate=function(){return new Date(this.valueOf())},i.toISOString=function(e){if(!this.isValid())return null;var t=(e=!0!==e)?this.clone().utc():this;return t.year()<0||9999<t.year()?re(t,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):d(Date.prototype.toISOString)?e?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",re(t,"Z")):re(t,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},i.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t="moment",n="";return this.isLocal()||(t=0===this.utcOffset()?"moment.utc":"moment.parseZone",n="Z"),t="["+t+'("]',e=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",this.format(t+e+"-MM-DD[T]HH:mm:ss.SSS"+n+'[")]')},"undefined"!=typeof Symbol&&null!=Symbol.for&&(i[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),i.toJSON=function(){return this.isValid()?this.toISOString():null},i.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},i.unix=function(){return Math.floor(this.valueOf()/1e3)},i.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},i.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},i.eraName=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].name;if(t[n].until<=e&&e<=t[n].since)return t[n].name}return""},i.eraNarrow=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].narrow;if(t[n].until<=e&&e<=t[n].since)return t[n].narrow}return""},i.eraAbbr=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].abbr;if(t[n].until<=e&&e<=t[n].since)return t[n].abbr}return""},i.eraYear=function(){for(var e,t,n=this.localeData().eras(),s=0,i=n.length;s<i;++s)if(e=n[s].since<=n[s].until?1:-1,t=this.clone().startOf("day").valueOf(),n[s].since<=t&&t<=n[s].until||n[s].until<=t&&t<=n[s].since)return(this.year()-f(n[s].since).year())*e+n[s].offset;return this.year()},i.year=Ie,i.isLeapYear=function(){return he(this.year())},i.weekYear=function(e){return un.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},i.isoWeekYear=function(e){return un.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},i.quarter=i.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},i.month=Ge,i.daysInMonth=function(){return We(this.year(),this.month())},i.week=i.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},i.isoWeek=i.isoWeeks=function(e){var t=qe(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},i.weeksInYear=function(){var e=this.localeData()._week;return P(this.year(),e.dow,e.doy)},i.weeksInWeekYear=function(){var e=this.localeData()._week;return P(this.weekYear(),e.dow,e.doy)},i.isoWeeksInYear=function(){return P(this.year(),1,4)},i.isoWeeksInISOWeekYear=function(){return P(this.isoWeekYear(),1,4)},i.date=ke,i.day=i.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,n,s=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,n=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=n.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-s,"d")):s},i.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},i.isoWeekday=function(e){return this.isValid()?null!=e?(t=e,n=this.localeData(),n="string"==typeof t?n.weekdaysParse(t)%7||7:isNaN(t)?null:t,this.day(this.day()%7?n:n-7)):this.day()||7:null!=e?this:NaN;var t,n},i.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},i.hour=i.hours=k,i.minute=i.minutes=_e,i.second=i.seconds=ve,i.millisecond=i.milliseconds=ye,i.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?i:Et(this);if("string"==typeof e){if(null===(e=Vt(Ye,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return!this._isUTC&&t&&(s=Et(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?qt(this,C(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,f.updateOffset(this,!0),this._changeInProgress=null)),this},i.utc=function(e){return this.utcOffset(0,e)},i.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Et(this),"m")),this},i.parseZone=function(){var e;return null!=this._tzm?this.utcOffset(this._tzm,!1,!0):"string"==typeof this._i&&(null!=(e=Vt(Se,this._i))?this.utcOffset(e):this.utcOffset(0,!0)),this},i.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?W(e).utcOffset():0,(this.utcOffset()-e)%60==0)},i.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},i.isLocal=function(){return!!this.isValid()&&!this._isUTC},i.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},i.isUtc=At,i.isUTC=At,i.zoneAbbr=function(){return this._isUTC?"UTC":""},i.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},i.dates=e("dates accessor is deprecated. Use date instead.",ke),i.months=e("months accessor is deprecated. Use month instead",Ge),i.years=e("years accessor is deprecated. Use year instead",Ie),i.zone=e("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function(e,t){return null!=e?(this.utcOffset(e="string"!=typeof e?-e:e,t),this):-this.utcOffset()})),i.isDSTShifted=e("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function(){if(!o(this._isDSTShifted))return this._isDSTShifted;var e,t={};return $(t,this),(t=Nt(t))._a?(e=(t._isUTC?l:W)(t._a),this._isDSTShifted=this.isValid()&&0<function(e,t,n){for(var s=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),r=0,a=0;a<s;a++)g(e[a])!==g(t[a])&&r++;return r+i}(t._a,e.toArray())):this._isDSTShifted=!1,this._isDSTShifted})),(w=K.prototype).calendar=function(e,t,n){return d(e=this._calendar[e]||this._calendar.sameElse)?e.call(t,n):e},w.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(te).map((function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e})).join(""),this._longDateFormat[e])},w.invalidDate=function(){return this._invalidDate},w.ordinal=function(e){return this._ordinal.replace("%d",e)},w.preparse=dn,w.postformat=dn,w.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return d(i)?i(e,t,n,s):i.replace(/%d/i,e)},w.pastFuture=function(e,t){return d(e=this._relativeTime[0<e?"future":"past"])?e(t):e.replace(/%s/i,t)},w.set=function(e){var t,n;for(n in e)c(e,n)&&(d(t=e[n])?this[n]=t:this["_"+n]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},w.eras=function(e,t){for(var n,s=this._eras||mt("en")._eras,i=0,r=s.length;i<r;++i){switch(typeof s[i].since){case"string":n=f(s[i].since).startOf("day"),s[i].since=n.valueOf()}switch(typeof s[i].until){case"undefined":s[i].until=1/0;break;case"string":n=f(s[i].until).startOf("day").valueOf(),s[i].until=n.valueOf()}}return s},w.erasParse=function(e,t,n){var s,i,r,a,o,u=this.eras();for(e=e.toUpperCase(),s=0,i=u.length;s<i;++s)if(r=u[s].name.toUpperCase(),a=u[s].abbr.toUpperCase(),o=u[s].narrow.toUpperCase(),n)switch(t){case"N":case"NN":case"NNN":if(a===e)return u[s];break;case"NNNN":if(r===e)return u[s];break;case"NNNNN":if(o===e)return u[s]}else if(0<=[r,a,o].indexOf(e))return u[s]},w.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?f(e.since).year():f(e.since).year()+(t-e.offset)*n},w.erasAbbrRegex=function(e){return c(this,"_erasAbbrRegex")||an.call(this),e?this._erasAbbrRegex:this._erasRegex},w.erasNameRegex=function(e){return c(this,"_erasNameRegex")||an.call(this),e?this._erasNameRegex:this._erasRegex},w.erasNarrowRegex=function(e){return c(this,"_erasNarrowRegex")||an.call(this),e?this._erasNarrowRegex:this._erasRegex},w.months=function(e,t){return e?(a(this._months)?this._months:this._months[(this._months.isFormat||He).test(t)?"format":"standalone"])[e.month()]:a(this._months)?this._months:this._months.standalone},w.monthsShort=function(e,t){return e?(a(this._monthsShort)?this._monthsShort:this._monthsShort[He.test(t)?"format":"standalone"])[e.month()]:a(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},w.monthsParse=function(e,t,n){var s,i;if(this._monthsParseExact)return function(e,t,n){var s,i,r;e=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=l([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=S.call(this._shortMonthsParse,e))?i:null:-1!==(i=S.call(this._longMonthsParse,e))?i:null:"MMM"===t?-1!==(i=S.call(this._shortMonthsParse,e))||-1!==(i=S.call(this._longMonthsParse,e))?i:null:-1!==(i=S.call(this._longMonthsParse,e))||-1!==(i=S.call(this._shortMonthsParse,e))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=l([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(i="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},w.monthsRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ee.call(this),e?this._monthsStrictRegex:this._monthsRegex):(c(this,"_monthsRegex")||(this._monthsRegex=Le),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},w.monthsShortRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ee.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(c(this,"_monthsShortRegex")||(this._monthsShortRegex=Fe),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},w.week=function(e){return qe(e,this._week.dow,this._week.doy).week},w.firstDayOfYear=function(){return this._week.doy},w.firstDayOfWeek=function(){return this._week.dow},w.weekdays=function(e,t){return t=a(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"],!0===e?Be(t,this._week.dow):e?t[e.day()]:t},w.weekdaysMin=function(e){return!0===e?Be(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},w.weekdaysShort=function(e){return!0===e?Be(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},w.weekdaysParse=function(e,t,n){var s,i;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r;e=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=l([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=S.call(this._weekdaysParse,e))?i:null:"ddd"===t?-1!==(i=S.call(this._shortWeekdaysParse,e))?i:null:-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:"dddd"===t?-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._shortWeekdaysParse,e))||-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:"ddd"===t?-1!==(i=S.call(this._shortWeekdaysParse,e))||-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._minWeekdaysParse,e))?i:null:-1!==(i=S.call(this._minWeekdaysParse,e))||-1!==(i=S.call(this._weekdaysParse,e))||-1!==(i=S.call(this._shortWeekdaysParse,e))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=l([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(i="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(i.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},w.weekdaysRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(c(this,"_weekdaysRegex")||(this._weekdaysRegex=Ke),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},w.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(c(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=et),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},w.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||nt.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(c(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=tt),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},w.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},w.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ct("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===g(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th")}}),f.lang=e("moment.lang is deprecated. Use moment.locale instead.",ct),f.langData=e("moment.langData is deprecated. Use moment.localeData instead.",mt);var _n=Math.abs;function yn(e,t,n,s){return t=C(t,n),e._milliseconds+=s*t._milliseconds,e._days+=s*t._days,e._months+=s*t._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function wn(e){return 4800*e/146097}function pn(e){return 146097*e/4800}function kn(e){return function(){return this.as(e)}}function vn(e){return function(){return this.isValid()?this._data[e]:NaN}}pe=kn("ms"),me=kn("s"),Ce=kn("m"),we=kn("h"),ge=kn("d"),Je=kn("w"),k=kn("M"),_e=kn("Q"),ve=kn("y");ye=vn("milliseconds"),ke=vn("seconds"),Ie=vn("minutes"),w=vn("hours");var Mn=vn("days"),Dn=vn("months"),Sn=vn("years"),Yn=Math.round,On={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};var xn=Math.abs;function Tn(e){return(0<e)-(e<0)||+e}function Nn(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,s,i,r,a,o=xn(this._milliseconds)/1e3,u=xn(this._days),l=xn(this._months),h=this.asSeconds();return h?(e=y(o/60),t=y(e/60),o%=60,e%=60,n=y(l/12),l%=12,s=o?o.toFixed(3).replace(/\.?0+$/,""):"",i=Tn(this._months)!==Tn(h)?"-":"",r=Tn(this._days)!==Tn(h)?"-":"",a=Tn(this._milliseconds)!==Tn(h)?"-":"",(h<0?"-":"")+"P"+(n?i+n+"Y":"")+(l?i+l+"M":"")+(u?r+u+"D":"")+(t||e||o?"T":"")+(t?a+t+"H":"")+(e?a+e+"M":"")+(o?a+s+"S":"")):"P0D"}var U=Ct.prototype;return U.isValid=function(){return this._isValid},U.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},U.add=function(e,t){return yn(this,e,t,1)},U.subtract=function(e,t){return yn(this,e,t,-1)},U.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=_(e))||"quarter"===e||"year"===e)switch(t=this._days+s/864e5,n=this._months+wn(t),e){case"month":return n;case"quarter":return n/3;case"year":return n/12}else switch(t=this._days+Math.round(pn(this._months)),e){case"week":return t/7+s/6048e5;case"day":return t+s/864e5;case"hour":return 24*t+s/36e5;case"minute":return 1440*t+s/6e4;case"second":return 86400*t+s/1e3;case"millisecond":return Math.floor(864e5*t)+s;default:throw new Error("Unknown unit "+e)}},U.asMilliseconds=pe,U.asSeconds=me,U.asMinutes=Ce,U.asHours=we,U.asDays=ge,U.asWeeks=Je,U.asMonths=k,U.asQuarters=_e,U.asYears=ve,U.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*g(this._months/12):NaN},U._bubble=function(){var e=this._milliseconds,t=this._days,n=this._months,s=this._data;return 0<=e&&0<=t&&0<=n||e<=0&&t<=0&&n<=0||(e+=864e5*gn(pn(n)+t),n=t=0),s.milliseconds=e%1e3,e=y(e/1e3),s.seconds=e%60,e=y(e/60),s.minutes=e%60,e=y(e/60),s.hours=e%24,t+=y(e/24),n+=e=y(wn(t)),t-=gn(pn(e)),e=y(n/12),n%=12,s.days=t,s.months=n,s.years=e,this},U.clone=function(){return C(this)},U.get=function(e){return e=_(e),this.isValid()?this[e+"s"]():NaN},U.milliseconds=ye,U.seconds=ke,U.minutes=Ie,U.hours=w,U.days=Mn,U.weeks=function(){return y(this.days()/7)},U.months=Dn,U.years=Sn,U.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var n=!1,s=On;return"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(n=e),"object"==typeof t&&(s=Object.assign({},On,t),null!=t.s&&null==t.ss&&(s.ss=t.s-1)),t=function(e,t,n,s){var i=C(e).abs(),r=Yn(i.as("s")),a=Yn(i.as("m")),o=Yn(i.as("h")),u=Yn(i.as("d")),l=Yn(i.as("M")),h=Yn(i.as("w"));return i=Yn(i.as("y")),r=(r<=n.ss?["s",r]:r<n.s&&["ss",r])||a<=1&&["m"]||a<n.m&&["mm",a]||o<=1&&["h"]||o<n.h&&["hh",o]||u<=1&&["d"]||u<n.d&&["dd",u],(r=(r=null!=n.w?r||h<=1&&["w"]||h<n.w&&["ww",h]:r)||l<=1&&["M"]||l<n.M&&["MM",l]||i<=1&&["y"]||["yy",i])[2]=t,r[3]=0<+e,r[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,r)}(this,!n,s,e=this.localeData()),n&&(t=e.pastFuture(+this,t)),e.postformat(t)},U.toISOString=Nn,U.toString=Nn,U.toJSON=Nn,U.locale=Xt,U.localeData=Kt,U.toIsoString=e("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Nn),U.lang=Xe,s("X",0,0,"unix"),s("x",0,0,"valueOf"),v("x",De),v("X",/[+-]?\d+(\.\d{1,3})?/),D("X",(function(e,t,n){n._d=new Date(1e3*parseFloat(e))})),D("x",(function(e,t,n){n._d=new Date(g(e))})),f.version="2.29.4",H=W,f.fn=i,f.min=function(){return Rt("isBefore",[].slice.call(arguments,0))},f.max=function(){return Rt("isAfter",[].slice.call(arguments,0))},f.now=function(){return Date.now?Date.now():+new Date},f.utc=l,f.unix=function(e){return W(1e3*e)},f.months=function(e,t){return fn(e,t,"months")},f.isDate=V,f.locale=ct,f.invalid=I,f.duration=C,f.isMoment=h,f.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},f.parseZone=function(){return W.apply(null,arguments).parseZone()},f.localeData=mt,f.isDuration=Ut,f.monthsShort=function(e,t){return fn(e,t,"monthsShort")},f.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},f.defineLocale=ft,f.updateLocale=function(e,t){var n,s;return null!=t?(s=ot,null!=R[e]&&null!=R[e].parentLocale?R[e].set(X(R[e]._config,t)):(t=X(s=null!=(n=dt(e))?n._config:s,t),null==n&&(t.abbr=e),(s=new K(t)).parentLocale=R[e],R[e]=s),ct(e)):null!=R[e]&&(null!=R[e].parentLocale?(R[e]=R[e].parentLocale,e===ct()&&ct(e)):null!=R[e]&&delete R[e]),R[e]},f.locales=function(){return ee(R)},f.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},f.normalizeUnits=_,f.relativeTimeRounding=function(e){return void 0===e?Yn:"function"==typeof e&&(Yn=e,!0)},f.relativeTimeThreshold=function(e,t){return void 0!==On[e]&&(void 0===t?On[e]:(On[e]=t,"s"===e&&(On.ss=t-1),!0))},f.calendarFormat=function(e,t){return(e=e.diff(t,"days",!0))<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse"},f.prototype=i,f.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},f})),function(t,e){"use strict";"object"==typeof module&&module.exports?module.exports=e(require("moment")):"function"==typeof define&&define.amd?define(["moment"],e):e(t.moment)}(this,(function(r){"use strict";void 0===r.version&&r.default&&(r=r.default);var e,a={},s={},i={},c={},l={},n=+(t=(r&&"string"==typeof r.version||D("Moment Timezone requires Moment.js. See https://momentjs.com/timezone/docs/#/use-it/browser/"),r.version.split(".")))[0],o=+t[1];function f(t){return 96<t?t-87:64<t?t-29:t-48}function u(t){var e=0,o=(n=t.split("."))[0],r=n[1]||"",s=1,i=0,n=1;for(45===t.charCodeAt(0)&&(n=-(e=1));e<o.length;e++)i=60*i+f(o.charCodeAt(e));for(e=0;e<r.length;e++)s/=60,i+=f(r.charCodeAt(e))*s;return i*n}function h(t){for(var e=0;e<t.length;e++)t[e]=u(t[e])}function p(t,e){for(var n=[],o=0;o<e.length;o++)n[o]=t[e[o]];return n}function m(t){for(var e=(t=t.split("|"))[2].split(" "),n=t[3].split(""),o=t[4].split(" "),r=(h(e),h(n),h(o),o),s=n.length,i=0;i<s;i++)r[i]=Math.round((r[i-1]||0)+6e4*r[i]);return r[s-1]=1/0,{name:t[0],abbrs:p(t[1].split(" "),n),offsets:p(e,n),untils:o,population:0|t[5]}}function d(t){t&&this._set(m(t))}function z(t,e){this.name=t,this.zones=e}function v(t){var e=t.toTimeString(),n=e.match(/\([a-z ]+\)/i);"GMT"===(n=n&&n[0]?(n=n[0].match(/[A-Z]/g))?n.join(""):void 0:(n=e.match(/[A-Z]{3,5}/g))?n[0]:void 0)&&(n=void 0),this.at=+t,this.abbr=n,this.offset=t.getTimezoneOffset()}function b(t){this.zone=t,this.offsetScore=0,this.abbrScore=0}function _(t,e){return t.offsetScore!==e.offsetScore?t.offsetScore-e.offsetScore:t.abbrScore!==e.abbrScore?t.abbrScore-e.abbrScore:t.zone.population!==e.zone.population?e.zone.population-t.zone.population:e.zone.name.localeCompare(t.zone.name)}function w(){try{var t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(t&&3<t.length){var e=c[y(t)];if(e)return e;D("Moment Timezone found "+t+" from the Intl api, but did not have that data loaded.")}}catch(t){}for(var n,o,r=function(){for(var t,e,n=(new Date).getFullYear()-2,o=new v(new Date(n,0,1)),r=[o],s=1;s<48;s++)(e=new v(new Date(n,s,1))).offset!==o.offset&&(t=function(t,e){for(var n;n=6e4*((e.at-t.at)/12e4|0);)(n=new v(new Date(t.at+n))).offset===t.offset?t=n:e=n;return t}(o,e),r.push(t),r.push(new v(new Date(t.at+6e4)))),o=e;for(s=0;s<4;s++)r.push(new v(new Date(n+s,0,1))),r.push(new v(new Date(n+s,6,1)));return r}(),s=r.length,i=function(t){for(var e,n,o=t.length,r={},s=[],i=0;i<o;i++)for(e in n=l[t[i].offset]||{})n.hasOwnProperty(e)&&(r[e]=!0);for(i in r)r.hasOwnProperty(i)&&s.push(c[i]);return s}(r),f=[],u=0;u<i.length;u++){for(n=new b(S(i[u])),o=0;o<s;o++)n.scoreOffsetAt(r[o]);f.push(n)}return f.sort(_),0<f.length?f[0].zone.name:void 0}function y(t){return(t||"").toLowerCase().replace(/\//g,"_")}function O(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++){r=y(n=(o=t[e].split("|"))[0]),a[r]=t[e],c[r]=n,i=s=void 0;var s,i,f=r,u=o[2].split(" ");for(h(u),s=0;s<u.length;s++)i=u[s],l[i]=l[i]||{},l[i][f]=!0}}function S(t,e){t=y(t);var n=a[t];return n instanceof d?n:"string"==typeof n?(n=new d(n),a[t]=n):s[t]&&e!==S&&(e=S(s[t],S))?((n=a[t]=new d)._set(e),n.name=c[t],n):null}function M(t){var e,n,o,r;for("string"==typeof t&&(t=[t]),e=0;e<t.length;e++)o=y((n=t[e].split("|"))[0]),r=y(n[1]),s[o]=r,c[o]=n[0],s[r]=o,c[r]=n[1]}function A(t){var e="X"===t._f||"x"===t._f;return!(!t._a||void 0!==t._tzm||e)}function D(t){void 0!==console&&"function"==typeof console.error&&console.error(t)}function T(t){var e=Array.prototype.slice.call(arguments,0,-1),n=arguments[arguments.length-1],o=S(n);e=r.utc.apply(null,e);return o&&!r.isMoment(t)&&A(e)&&e.add(o.parse(e),"minutes"),e.tz(n),e}(n<2||2==n&&o<6)&&D("Moment Timezone requires Moment.js >= 2.6.0. You are using Moment.js "+r.version+". See momentjs.com"),d.prototype={_set:function(t){this.name=t.name,this.abbrs=t.abbrs,this.untils=t.untils,this.offsets=t.offsets,this.population=t.population},_index:function(t){for(var e=+t,n=this.untils,o=0;o<n.length;o++)if(e<n[o])return o},countries:function(){var e=this.name;return Object.keys(i).filter((function(t){return-1!==i[t].zones.indexOf(e)}))},parse:function(t){for(var e,n,o,r=+t,s=this.offsets,i=this.untils,f=i.length-1,u=0;u<f;u++)if(e=s[u],n=s[u+1],o=s[u&&u-1],e<n&&T.moveAmbiguousForward?e=n:o<e&&T.moveInvalidForward&&(e=o),r<i[u]-6e4*e)return s[u];return s[f]},abbr:function(t){return this.abbrs[this._index(t)]},offset:function(t){return D("zone.offset has been deprecated in favor of zone.utcOffset"),this.offsets[this._index(t)]},utcOffset:function(t){return this.offsets[this._index(t)]}},b.prototype.scoreOffsetAt=function(t){this.offsetScore+=Math.abs(this.zone.utcOffset(t.at)-t.offset),this.zone.abbr(t.at).replace(/[^A-Z]/g,"")!==t.abbr&&this.abbrScore++},T.version="0.5.43",T.dataVersion="",T._zones=a,T._links=s,T._names=c,T._countries=i,T.add=O,T.link=M,T.load=function(t){O(t.zones),M(t.links);var e,n,o,r=t.countries;if(r&&r.length)for(e=0;e<r.length;e++)n=(o=r[e].split("|"))[0].toUpperCase(),o=o[1].split(" "),i[n]=new z(n,o);T.dataVersion=t.version},T.zone=S,T.zoneExists=function j(t){return j.didShowError||(j.didShowError=!0,D("moment.tz.zoneExists('"+t+"') has been deprecated in favor of !moment.tz.zone('"+t+"')")),!!S(t)},T.guess=function(t){return e=e&&!t?e:w()},T.names=function(){var t,e=[];for(t in c)c.hasOwnProperty(t)&&(a[t]||a[s[t]])&&c[t]&&e.push(c[t]);return e.sort()},T.Zone=d,T.unpack=m,T.unpackBase60=u,T.needsOffset=A,T.moveInvalidForward=!0,T.moveAmbiguousForward=!1,T.countries=function(){return Object.keys(i)},T.zonesForCountry=function(t,e){var n;return n=(n=t).toUpperCase(),(t=i[n]||null)?(n=t.zones.sort(),e?n.map((function(t){return{name:t,offset:S(t).utcOffset(new Date)}})):n):null};var x,t=r.fn;function C(t){return function(){return this._z?this._z.abbr(this):t.call(this)}}function Z(t){return function(){return this._z=null,t.apply(this,arguments)}}return r.tz=T,r.defaultZone=null,r.updateOffset=function(t,e){var n,o=r.defaultZone;void 0===t._z&&(o&&A(t)&&!t._isUTC&&(t._d=r.utc(t._a)._d,t.utc().add(o.parse(t),"minutes")),t._z=o),t._z&&(o=t._z.utcOffset(t),Math.abs(o)<16&&(o/=60),void 0!==t.utcOffset?(n=t._z,t.utcOffset(-o,e),t._z=n):t.zone(o,e))},t.tz=function(t,e){if(t){if("string"!=typeof t)throw new Error("Time zone name must be a string, got "+t+" ["+typeof t+"]");return this._z=S(t),this._z?r.updateOffset(this,e):D("Moment Timezone has no data for "+t+". See http://momentjs.com/timezone/docs/#/data-loading/."),this}if(this._z)return this._z.name},t.zoneName=C(t.zoneName),t.zoneAbbr=C(t.zoneAbbr),t.utc=Z(t.utc),t.local=Z(t.local),t.utcOffset=(x=t.utcOffset,function(){return 0<arguments.length&&(this._z=null),x.apply(this,arguments)}),r.tz.setDefault=function(t){return(n<2||2==n&&o<9)&&D("Moment Timezone setDefault() requires Moment.js >= 2.9.0. You are using Moment.js "+r.version+"."),r.defaultZone=t?S(t):null,r},t=r.momentProperties,"[object Array]"===Object.prototype.toString.call(t)?(t.push("_z"),t.push("_a")):t&&(t._z=null),r}));var BBAT={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],getDayName:function(in_date_obj){return BBAT.days[in_date_obj.getDay()]},getMonthName:function(in_date_obj){return BBAT.months[in_date_obj.getMonth()]},formatTime:function(in_date_obj,in_format,in_24hr){var ampm,d,hr,min,sec,txt;switch(hr=(d=in_date_obj).getHours(),in_24hr?ampm="":(ampm=hr<12?"AM":"PM",hr=""+(0==hr?12:hr>12?hr-12:hr)),min=(" 00"+d.getMinutes()).slice(-2),sec=(" 00"+d.getSeconds()).slice(-2),in_format){case"HMS":txt=hr+":"+min+":"+sec+" "+ampm;break;case"HM":txt=hr+":"+min;break;default:txt="??"}return txt.trim()},formatElapsedMilliseconds:function(in_ms,in_format){var milliseconds,seconds,minutes,hours,days,sec,min;function prefix(in_number,in_prefix_count){switch(in_prefix_count){case 2:return("00"+in_number).right(2);case 3:return("000"+in_number).right(3)}}switch(days=(hours=(minutes=(seconds=(milliseconds=in_ms)/1e3)/60)/60)/24,""+prefix(Math.floor(milliseconds%1e3),3),sec=""+prefix(Math.floor(seconds%60),2),min=""+prefix(Math.floor(minutes%60),2),""+Math.floor(hours%24),""+Math.floor(days),in_format){case"HMS":return Math.floor(hours)+":"+min+":"+sec;case"MS":return Math.floor(minutes)+":"+sec;default:return days+" days = "+hours+" hours = "+minutes+" minutes = "+seconds+" seconds"}},isValidEmailFormat:function(in_email){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w\w+)+$/.test(in_email)},repeat:function(in_pattern,in_count){for(var result="";in_count>0;)1&in_count&&(result+=in_pattern),in_count>>=1,in_pattern+=in_pattern;return result},killDOMEvent:function(in_event_obj){return in_event_obj.cancelBubble=!0,in_event_obj.preventDefault(),in_event_obj.stopPropagation(),!1},sleep:function(in_milliseconds){var now,sleep_start=new Date;do{now=new Date}while(now-sleep_start<in_milliseconds)},storeData:function(in_obj){for(var key in in_obj)if(null==in_obj[key])localStorage.removeItem(key);else try{localStorage.setItem(key,JSON.stringify(in_obj[key]))}catch(e){alert("LocalStorage Error: "+JSON.stringify(in_obj))}},fetchData:function(in_key){var val;try{val=JSON.parse(window.localStorage.getItem(in_key))}catch(e){val=null}return val},flushData:function(){for(var i=0;i<arguments.length;i++)window.localStorage.removeItem(arguments[i])},isNumeric:function(in_str){var str=""+in_str;return(str<=0||str>0)&&str.trim().length>0},isInteger:function(in_str){return""+in_str==""+parseInt(in_str)},isEven:function(in_number){if(!BBAT.isNumeric(in_number))throw new Error("isEven: invalid input!");return in_number%2==0},nullTo:function(in_obj,in_to){return null==in_obj?in_to:in_obj},NaNTo:function(in_obj,in_to){return BBAT.isNumeric(in_obj)?in_obj:in_to},round:function(in_number,in_decimals){if(!BBAT.isNumeric(in_number)||!BBAT.isInteger(in_decimals))throw new Error("round: invalid input!");var scaler=Math.pow(10,in_decimals);return Math.round(in_number*scaler)/scaler},truncate:function(in_number,in_decimals){if(!BBAT.isNumeric(in_number)||!BBAT.isInteger(in_decimals))throw new Error("truncate: invalid input!");var scaler=Math.pow(10,in_decimals);return in_number<0?Math.ceil(in_number*scaler)/scaler:Math.floor(in_number*scaler)/scaler},getUniqueFrequencies:function(in_array){var i,counts={},len=in_array.length;for(i=0;i<len;++i)counts[in_array[i]]||(counts[in_array[i]]=0),counts[in_array[i]]++;return counts},createRandomID:function(in_prefix){var id_str=in_prefix||String.fromCharCode(Math.floor(25*Math.random()+65));do{var ascii_code=Math.floor(42*Math.random()+48);(ascii_code<58||ascii_code>64)&&(id_str+=String.fromCharCode(ascii_code))}while(id_str.length<16);return id_str},objectHasProperties:function(in_object){for(var p in in_object)return!0;return!1},objectClone:function(in_object){var clonedObjectsArray=[],originalObjectsArray=[],next_objid=0;function objectId(in_object){return null==in_object?null:(null==in_object.__obj_id&&(in_object.__obj_id=next_objid++,originalObjectsArray[in_object.__obj_id]=in_object),in_object.__obj_id)}for(var cloneObj=function cloneRecursive(in_object){if(null==in_object||"string"==typeof in_object||"number"==typeof in_object||"boolean"==typeof in_object)return in_object;if(in_object instanceof Date)return(copy=new Date).setTime(in_object.getTime()),copy;if(in_object instanceof Array){for(var copy=[],i=0;i<in_object.length;++i)copy[i]=cloneRecursive(in_object[i]);return copy}if(in_object instanceof Object){if(null!=clonedObjectsArray[objectId(in_object)])return clonedObjectsArray[objectId(in_object)];for(var attr in copy=in_object instanceof Function?function(){return in_object.apply(this,arguments)}:{},clonedObjectsArray[objectId(in_object)]=copy,in_object)"__obj_id"!=attr&&in_object.hasOwnProperty(attr)&&(copy[attr]=cloneRecursive(in_object[attr]));return copy}throw new Error("Unable to copy object! Its type isn't supported.")}(in_object),i=0;i<originalObjectsArray.length;i++)delete originalObjectsArray[i].__obj_id;return cloneObj}};Array.prototype.isEquivalent=function(in_array){if(!in_array)return!1;if(this.length!=in_array.length)return!1;for(var i=0;i<this.length;i++)if(this[i]instanceof Array&&in_array[i]instanceof Array){if(!this[i].isEquivalent(in_array[i]))return!1}else if(this[i]!=in_array[i])return!1;return!0},String.prototype.right=function(in_num_chars){var len;return in_num_chars>(len=this.length)?""+this:this.substr(len-in_num_chars,in_num_chars)},String.prototype.left=function(in_num_chars){return in_num_chars>this.length?""+this:this.substr(0,in_num_chars)},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.urlDecode=function(){return decodeURIComponent((this+"").replace(/\+/g,"%20"))},function($){var scrollbarWidth=0;$.getScrollbarWidth=function(){if(!scrollbarWidth)if(window.ActiveXObject||"ActiveXObject"in window){var $textarea1=$('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),$textarea2=$('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");scrollbarWidth=$textarea1.width()-$textarea2.width(),$textarea1.add($textarea2).remove()}else{var $div=$("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});scrollbarWidth=100-$div.width(),$div.parent().remove()}return scrollbarWidth}}(jQuery),jQuery.extend({parseQuerystring:function(){var nvpair={},pairs=window.location.search.replace("?","").split("&");return $.each(pairs,(function(i,v){var pair=v.split("=");nvpair[pair[0]]=pair[1]})),nvpair}});var WS={path:null,socket:null,isAlive:!1,reconnect_delay:2e3,reconnect_timer:null,getSessionInfo:null,debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="WS: ";message+=msg,console.log(message)}},init:function(in_getSessionInfo){WS.path=WS.getUrl(),WS.getSessionInfo=in_getSessionInfo,WS.reconnect_delay=2e3+Math.floor(8e3*Math.random())},getUrl:function(){var subDomain=window.location.hostname;return"localhost"!==window.location.hostname&&"local.dartconnect.com"!==window.location.hostname||(subDomain="testapp.dartconnect.red"),"wss://"+subDomain+"/"},open:function(in_reqmode){var mode=in_reqmode||"new",info=WS.getSessionInfo();WS.socket=new WebSocket(WS.path+"ws?member_id="+info.member_id+"&member_level="+info.member_level+"&device_token="+info.device_token+"&alley_id="+info.alley_id+"&mode="+mode),WS.socket.onopen=function(){WS.log("[WS] Open"),WS.isAlive=!0},WS.socket.onclose=function(){WS.log("[WS] Closed"),WS.retry()},WS.socket.onerror=function(event){WS.log("[WS] Error connecting"),WS.retry()},WS.socket.onmessage=function(msg){if("ping"===msg.data)WS.socket.send("pong");else try{var wsCall=JSON.parse(msg.data);WS.socket.handleMessage(wsCall)}catch(e){WS.log("[WS] Server error: "+msg.data)}},WS.socket.handleMessage=function(call){if(call.subscription)switch(WS.log("[WS]"+call.subscription),call.subscriptionMsg&&WS.log("[WS]"+JSON.stringify(call.subscriptionMsg)),call.subscription){case"onlineMatchConnectionHandshake":var sess=APP.session;switch((callData=call.subscriptionMsg).step){case"STATUS_UPDATE":if("ALL_PLAYERS_READY"===callData.status)return 1==APP.magiconnect.isActive?void("HOST"===callData.yourRole&&APP.magiconnect.getAlleyCode()):("HOST"===callData.yourRole?APP.session.showAutoConnectWaiting({role:"HOST",step:"READY"}):APP.session.showAutoConnectWaiting({role:"GUEST",step:"READY"}),void("HOST"===callData.yourRole&&window.setTimeout((function(){APP.session.autoConnectGetAlleyCode()}),2e3)));sess.doAutoConnect(callData);break;case"STATUS_ERROR":var error="An error has occurred, please try again";if(callData.errorMsg&&(error=callData.errorMsg),1==APP.magiconnect.isActive)return void APP.magiconnect.logError(error);var exitOnly=!1;"Dupe Player Selection"==error&&(error="It appears that both participants have selected the same player. Please reset the match and select your name.",exitOnly=!0),sess.autoConnectError(error,exitOnly);break;case"CODE_SHARE":if(1==APP.magiconnect.isActive)return void APP.magiconnect.setAlleyCode(callData);sess.autoConnectSetAlleyCode(callData)}break;case"bracketMatchUpdates":sess=APP.session;switch((callData=call.subscriptionMsg).dataset){case"MATCHES":APP.session.webSocketBracketMatchUpdate(callData),APP.cif.data.pageNo&&APP.cif.checkChalkerUpdate(callData);break;case"SCORE_UPDATE":APP.session.webSocketBracketScoreUpdate(callData)}break;case"onlineMatchWatchers":case"onlineMatchOffers":case"matchAcceptances":APP.lobby.handleWebSockets(call);break;case"general":switch(call.subscriptionMsg.dataset){case"guestEnteredMatch":APP.lobby.data.mode&&APP.lobby.confirmGameHost()}break;case"playerMessage":var callData=call.subscriptionMsg;if(WS.log("Player Message Received"),callData.action)switch(callData.action){case"LOBBY_GUEST_EXIT":if(!APP.lobby.data.isInMatch)return;callData.use_close_icon=!1;var optionArr=[{title:"Back to Lobby",class_list:"button-green",callback:function(){APP.session.exitLobbyMatch("pss-exit")}}];$("#confirm").is(":visible")&&APP.confirm.hide(),APP.lobby.data.oppoLeftMsg=!0,APP.message.init(callData,optionArr);break;case"OPPONENT__MSG":APP.message.receive.userMessage(callData);break;case"EDIT_MESSAGE":APP.message.receive.editMessage(callData);break;case"TACTICS_MESSAGE":APP.message.receive.tacticsMessage(callData);break;case"OFFER_LOBBY_REMATCH_MSG":case"OFFER_LOBBY_REMATCH_GUEST_MSG":APP.message.receive.lobbyRematchMessage(callData);break;case"ACCEPT_LOBBY_REMATCH_MSG":APP.lobby.startRematch();break;case"DECLINE_LOBBY_REMATCH_MSG":APP.lobby.declineRematch();break;case"LOBBY_REMATCH_ACCEPTED_MSG":APP.lobby.informGuestRematch();break;case"LOBBY_REMATCH_FAILED_MSG":APP.message.receive.lobbyRematchMessage(callData);break;case"PLAYER_LINEUP_MSG":if("Player Lineup Received"!=callData.msg)return void APP.message.receive.playerLineUpMessage(callData);APP.starpubs.confirmLineUpReceived(),APP.starpubs.checkLineUpsComplete()&&APP.starpubs.startMatch();break;default:APP.message.log("No Hook Provided for: "+callData.action),APP.message.init(callData)}else APP.message.init(callData);break;default:WS.log("[WS] Server: "+call.subscription+" no handler available")}else WS.log("[WS] Server: "+JSON.stringify(call))}},close:function(){WS.socket&&WS.socket.close()},retry:function(){WS.socket=null,WS.isAlive=!1,WS.reconnect_timer&&clearTimeout(WS.reconnect_timer),WS.reconnect_timer=setTimeout((function(){WS.open("reconnect"),WS.reconnect_timer=null,APP.lobby.reconnectWS()}),WS.reconnect_delay)}},CMON={dflt_data:null,error_count:0,frequency:3e3,is_busy:!1,on_error:null,on_ping:null,on_success:null,on_timeout:null,success_time:0,success_count:0,success_average_time:0,timeout:1e4,timeout_count:0,timer:null,xhr:null,configure:function(in_spec){CMON.dflt_data=in_spec.dflt_data||CMON.dflt_data,CMON.frequency=in_spec.frequency||CMON.frequency,CMON.on_error=in_spec.on_error||CMON.on_error,CMON.on_ping=in_spec.on_ping||CMON.on_ping,CMON.on_success=in_spec.on_success||CMON.on_success,CMON.on_timeout=in_spec.on_timeout||CMON.on_timeout,CMON.timeout=in_spec.timeout||CMON.timeout},start:function(){CMON.timer&&CMON.stop(),CMON.success_count=0,CMON.timeout_count=0,CMON.error_count=0,CMON.ping(),CMON.timer=setInterval(CMON.ping,CMON.frequency)},stop:function(){clearInterval(CMON.timer),CMON.timer=null,CMON.xhr&&CMON.xhr.abort(),CMON.xhr=null,CMON.is_busy=!1},pause:function(in_pause_time){CMON.stop(),setTimeout(CMON.start,in_pause_time)},ping:function(){var start_time,data;if(!CMON.is_busy){CMON.is_busy=!0,data="function"==typeof CMON.on_ping?CMON.on_ping():CMON.dflt_data;try{CMON.xhr=new XMLHttpRequest}catch(e){return window.stop&&window.stop(),void alert("Browser not supported")}CMON.xhr.open("POST",(APP.server.api_url||"")+"/ping",!0),CMON.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),CMON.xhr.timeout=CMON.timeout,CMON.xhr.onreadystatechange=function(){var ping_time,callback,callback_data;if(4==CMON.xhr.readyState){if(ping_time=new Date-start_time,200!=CMON.xhr.status&&304!=CMON.xhr.status)return ping_time>=CMON.timeout?(CMON.timeout_count++,"function"==typeof CMON.on_timeout&&(callback=CMON.on_timeout,callback_data=CMON.timeout_count,setTimeout((function(){callback(callback_data)}),5))):(CMON.error_count++,"function"==typeof CMON.on_error&&(callback=CMON.on_error,callback_data=CMON.error_count,setTimeout((function(){callback(callback_data)}),5))),void(CMON.is_busy=!1);CMON.success_average_time=Math.round((CMON.success_count*CMON.success_average_time+ping_time)/(CMON.success_count+1),0),CMON.success_time=ping_time,CMON.success_count++,"function"==typeof CMON.on_success?(callback=CMON.on_success,callback_data=JSON.parse(CMON.xhr.response),setTimeout((function(){callback(callback_data)}),5)):JSON.parse(CMON.xhr.response).status_text&&WS.log("\t\tCMON.ping-RESPONSE: "+JSON.parse(CMON.xhr.response).status_text),CMON.timeout_count=0,CMON.error_count=0,CMON.is_busy=!1}},start_time=new Date,CMON.xhr.send(data)}}},console=console||{};console.watch=function(oObj,sProp){var sPrivateProp="$_"+sProp+"_$";oObj[sPrivateProp]=oObj[sProp],Object.defineProperty(oObj,sProp,{get:function(){return oObj[sPrivateProp]},set:function(value){oObj[sPrivateProp]=value}})};try{var loginLink=localStorage.getItem("loginLink");loginLink&&(loginLink=JSON.parse(loginLink),loginLink.token&&loginLink.memberId&&window.setTimeout((function(){APP.loginLink.tryPatLogin(loginLink.token,loginLink.memberId)}),100))}catch(e){}var _scroll=0;document.addEventListener("touchstart",(function(e){_scroll=document.body.scrollTop})),document.addEventListener("touchend",(function(e){if(_scroll==document.body.scrollTop){var node=e.target.nodeName.toString().toUpperCase();if(("INPUT"==node||"TEXTAREA"==node||"SELECT"==node)&&(e.preventDefault(),e.target.focus(),"SELECT"!=node)){if("file"==e.target.type)return void e.target.click();if("email"!==e.target.type){var textLength=e.target.value.length;e.target.setSelectionRange(textLength,textLength)}}}})),window.onerror=function(in_error_msg,in_url,in_line_number){var message=in_error_msg+" (App.v"+APP.version+":"+in_url+":"+in_line_number+")";return APP.recordError(message),!0};var newErrorReport=function(in_message,in_description,in_user_initiated,callback){if("object"==typeof in_message&&(in_message=in_message.message?in_message.message:JSON.stringify(in_message)),"custom"!==in_message){if(in_message==BBAT.fetchData("prev_error_message"))return;if("(closeAlley) Missing input parameter"==in_message)return}if(!in_message||"No API URL - unable to broadcast"!=in_message||!BBAT.fetchData("exit_lobby")){var json_data,json_obj={},lc=in_message.toLowerCase();if(!(APP&&APP.user_options&&APP.user_options.offline)&&(in_user_initiated||!(lc.indexOf("timeout")>=0||lc.indexOf("internal server error")>=0||lc.indexOf("game is stale")>=0||lc.indexOf("not open")>=0||lc.indexOf("is not valid")>=0||lc.indexOf("invalid checkin")>=0||lc.indexOf("device not registered")>=0||lc.indexOf("is not currently the host")>=0||lc.indexOf("no device on alley to receive chalk")>=0||lc.indexOf("profile not found")>=0||lc.indexOf("match is closed")>=0)))try{for(i=0;key=window.localStorage.key(i);i++)try{json_obj[key]=JSON.parse(window.localStorage.getItem(key))}catch(e){}var online_data={alley_id:APP.server?APP.server.alley_id:0,game_id:APP.server?APP.server.game_id:0,device_role:APP.device?APP.device.role:"n/a",cmd_seq:APP.cmd_seq||0,game_master:APP.game_master},callerName=APP.getCallerName(in_message);json_data=JSON.stringify({bug_description:in_description||!1,user_initiated:!!in_user_initiated,error_message:in_message||!1,error_type:"ERROR",version_number:APP.version,device_token:APP.device.token||"n/a",device_time:new Date,device_timezone:APP.device?APP.device.timezone:"n/a",member_id:APP.user?APP.user.member_id:"n/a",caller_name:callerName,online_data:JSON.stringify(online_data),state_data:JSON.stringify(json_obj)}),in_user_initiated||console.log("!!!"+in_message);var url="";switch(window.location.hostname){case"app.dartconnect.com":url="https://logs.dartconnect.com";break;case"testapp.dartconnect.red":url="https://testlogs.dartconnect.red";break;case"train.app.dartconnect.com":url="https://train.logs.dartconnect.com";break;case"dev.app.dartconnect.red":url="https://dev.logs.dartconnect.red";break;default:url=""}url+="/corsapi/logScoringAppErr",$.ajax({url:url,type:"POST",cache:!1,timeout:0,dataType:"json",data:json_data,success:function(data){BBAT.fetchData("prev_error_message")!=in_message&&BBAT.storeData({prev_error_message:in_message}),callback&&callback(data)}})}catch(e){}}},blockerErrorReport=function(in_message,callback){var json_data;APP.device.showSpinnerOverlay();var json_obj={};in_message.toLowerCase();if(!(APP&&APP.user_options&&APP.user_options.offline))try{for(i=0;key=window.localStorage.key(i);i++)try{json_obj[key]=JSON.parse(window.localStorage.getItem(key))}catch(e){}var online_data={alley_id:APP.server?APP.server.alley_id:0,game_id:APP.server?APP.server.game_id:0,device_role:APP.device?APP.device.role:"n/a",cmd_seq:APP.cmd_seq||0,game_master:APP.game_master};json_data=JSON.stringify({bug_description:!1,user_initiated:!1,error_message:in_message||!1,error_type:"ERROR",version_number:APP.version,device_token:APP.device.token||"n/a",device_time:new Date,device_timezone:APP.device?APP.device.timezone:"n/a",member_id:APP.user?APP.user.member_id:"n/a",online_data:JSON.stringify(online_data),state_data:JSON.stringify(json_obj)}),in_message&&console.log("!!!"+in_message);var url="";switch(window.location.hostname){case"app.dartconnect.com":url="https://logs.dartconnect.com";break;case"testapp.dartconnect.red":url="https://testlogs.dartconnect.red";break;case"train.app.dartconnect.com":url="https://train.logs.dartconnect.com";break;case"dev.app.dartconnect.red":url="https://dev.logs.dartconnect.red";break;default:url=""}url+="/corsapi/logScoringAppErr",$.ajax({url:url,type:"POST",cache:!1,timeout:0,dataType:"json",data:json_data,success:function(data){BBAT.fetchData("prev_error_message")!=in_message&&BBAT.storeData({prev_error_message:in_message}),APP.device.hideSpinnerOverlay(),callback&&callback()}})}catch(e){APP.device.hideSpinnerOverlay(),callback&&callback()}};if(!window.name){var prefix="";"dev."==location.host.slice(0,4).toLowerCase()?prefix="DEV":"test."==location.host.slice(0,5).toLowerCase()&&(prefix="TST"),window.name=prefix+"DCAPP"+(new Date).valueOf(),BBAT.storeData({window_name:window.name})}$("input").on("input",(function(e){var el=$("#"+e.target.id);el.val().match(/[^ -~]/g)&&el.val(el.val().replace(/[^ -~]/g,""))}));var APP={allow_game_library:null,cmd_seq:0,err:[],game_master:null,goto_new_game:null,live_play_paused:null,is_reloading:!1,mode:null,settings_version:0,uicmd_seq:0,user:null,dartbot_timer:null,timer_id:null,last_event_time:new Date,user_options:null,fbl_new_match:{},fbl_in_match:{},was_game_deleted:!1,version:"3.24.13",location:"live",inject101:!1,isLocal:!1,data_version_number:2,sleepTimerCheck:!1,sleepTimer:0,finishEndOfSetReload:!1,checkEndOfSet:!1,dcConnect:null,isOffline:function(){try{return APP.user_options.offline}catch(e){var callerName=APP.getCallerName(e);newErrorReport("[uoOffline Err]",callerName,!1)}},updateOffline:function(val){try{"boolean"!=typeof val&&(val=!1),APP.user_options.offline=val}catch(e){var callerName=APP.getCallerName(e);newErrorReport("[uoOffline Update Err]",callerName,!1)}},getCallerName:function(err){try{var match=err.stack.split("\n")[2].match(/at\s+(.*?)\s+\(/);return match?match[1]:"anonymous or native"}catch(e){return"unknown"}},sleepTournamentCheck:function(){var sess=APP.session;sess.isBracketMatch()&&!sess.isBracketPracticeMatch()&&(APP.session.getBracketBoardId()||APP.server.getDCTVTourneyInfo(sess.tournament_id))},sleepCheck:function(){var now=(new Date).getTime();now-APP.sleepTimer>3e3&&APP.sleepTournamentCheck(),APP.sleepTimer=now,clearInterval(APP.sleepTimerCheck),APP.sleepTimerCheck=setInterval(APP.sleepCheck,1e3)},handlePostReloading:function(){APP.game.plugin&&"function"==typeof APP.game.plugin.handlePostReloading&&APP.game.plugin.handlePostReloading()},getMembershipName:function(in_member_level){switch(in_member_level){case"B":return"Basic";case"D":return"Demo";case"G":return"Guest";case"P":return APP.user.pa?"Proxy":"Premium";case"S":return"Super User";default:return in_member_level}},cheapHash:function(in_string){var i,len,hash=0;if(0==in_string.length)return hash;for(len=in_string.length,i=0;i<len;i++)hash=(hash<<5)-hash+in_string.charCodeAt(i),hash|=0;return hash},blockFeatures:function(in_list){var len,i;for(len=in_list.length,i=0;i<len;i++)APP.fbl_new_match[in_list[i]]=!0,APP.fbl_in_match[in_list[i]]=!0},unblockFeatures:function(in_list,instant_update){var len,i;for(len=in_list.length,i=0;i<len;i++)delete APP.fbl_new_match[in_list[i]],delete APP.fbl_in_match[in_list[i]];instant_update&&APP.unblockUIControls(in_list)},buildFeatureBlockLists:function(){var fnm,fim,uml;function block(in_fbl,in_list){var len,i;for(len=in_list.length,i=0;i<len;i++)in_fbl[in_list[i]]=!0}switch(fnm=APP.fbl_new_match,fim=APP.fbl_in_match,"S"!=(uml=APP.user.member_level)&&$("#drm-practice").removeClass("button"),uml){case"S":break;case"D":block(fnm,["drm-league","drm-tournament","drm-practice","drm-log","drm-guest-connect","gs-library","oph-bb-library","oph-bb-forfeit","reveal-options","pss-score","pcm-compete-host-button","header-name","killTempPlayers"]),$.extend(fim,fnm),block(fim,["bb-o-reload","bb-o-connect","gsp-new-set","reveal-chalk","reveal-settings","bb-e-alley"]);break;case"G":block(fnm,["drm-quick-play","drm-play","drm-practice","gs-library"]),$.extend(fim,fnm);break;case"B":block(fnm,["drm-league","drm-practice","gs-library","bb-o-reload","bb-o-connect","oph-bb-forfeit","header-score","hdr-score-0","hdr-score-1","reveal-chalk","bb-e-alley"]),$.extend(fim,fnm);break;case"P":block(fnm,["drm-practice","gs-library"]),$.extend(fim,fnm);break;default:block(fnm,["button","field"]),$.extend(fim,fnm)}},getGame:function(getSets){try{var sess=APP.session;return getSets?sess.matches[sess.current_match].sets:sess.matches[sess.current_match].sets[sess.matches[sess.current_match].sets.length-1]}catch(e){return!1}},getMatch:function(){try{var sess=APP.session;return sess.matches[sess.current_match]}catch(e){return!1}},isOnlineMatch:function(){return"HOST"!=APP.device.role||"SERVER"==APP.game_master},blockUIControls:function(){var el,key;for(key in APP.session.isNewMatch()?APP.fbl_new_match:APP.fbl_in_match)(el=$("#"+key))&&(el.hasClass("button")?APP.device.disableButton(key):el.hasClass("field")&&APP.device.disableFieldID(key)),(el=$("."+key))&&(el.hasClass("button")?APP.device.disableButtonClass(key):el.hasClass("field")&&APP.device.disableFieldClass(key))},unblockUIControls:function(fbl){var el;if(fbl)try{for(var i=0;i<fbl.length;i++){var key=fbl[i];(el=$("#"+key))&&(el.hasClass("button")?APP.device.enableButton(key):el.hasClass("field")&&APP.device.enableFieldID(key)),(el=$("."+key))&&(el.hasClass("button")?APP.device.enableButtonClass(key):el.hasClass("field")&&APP.device.enableFieldClass(key))}}catch(e){}},isFeatureBlocked:function(in_name){return!!(APP.session.isNewMatch()?APP.fbl_new_match:APP.fbl_in_match)[in_name]},loadCheck:{init:function(){console.log("Load Check:"),this.testsPassed()?(-1===navigator.userAgent.indexOf("Mobile/8F190")&&-1===navigator.userAgent.indexOf("Mobile/9B206")||this.incompatibleDevice(),console.log("Load Check Passed"),BBAT.storeData({load_check_done:"true"})):(console.log("Houston..."),this.isAndroid()?console.log("Android"):this.isIOS()&&console.log("iOS"),this.incompatibleBrowser())},checkUpdates:function(){this.androidSamsungBrowserCheck()&&BBAT.flushData("load_check_done")},androidWebViewCheck:function(){return-1!==navigator.userAgent.indexOf("; wv")},androidSamsungBrowserCheck:function(){return-1!==navigator.userAgent.indexOf("SamsungBrowser")},facebookBrowserCheck:function(){return-1!==navigator.userAgent.indexOf("FBAV")||-1!==navigator.userAgent.indexOf("FBAN")},mediaCheck:function(){if(!this.isIOS())return!0;if("Safari"===this.getBrowserDetails("browserName")&&this.getBrowserDetails("majorVersion")<11)return!0;if(this.isWebApp())return!0;if(navigator.userAgent.match("CriOS")||navigator.userAgent.match("FxiOS")||navigator.userAgent.match("OPiOS"))return!0;var mediaCheckPassed=!1;try{navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(mediaCheckPassed=!0)}catch(e){mediaCheckPassed=!1}return mediaCheckPassed},isAndroid:function(){return!!/android/i.test(navigator.userAgent)},isIOS:function(){return!(!/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream)||!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform))},getBrowserDetails:function(type){navigator.appVersion;var nameOffset,verOffset,ix,nAgt=navigator.userAgent,browserName=navigator.appName,fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10);switch(-1!=(verOffset=nAgt.indexOf("OPR/"))?(browserName="Opera",fullVersion=nAgt.substring(verOffset+4)):-1!=(verOffset=nAgt.indexOf("Opera"))?(browserName="Opera",fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("MSIE"))?(browserName="Microsoft Internet Explorer",fullVersion=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(browserName="Safari",fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()==browserName.toUpperCase()&&(browserName=navigator.appName)),-1!=(ix=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,ix)),-1!=(ix=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10)),type){case"browserName":return browserName;case"fullVersion":return fullVersion;case"majorVersion":return majorVersion;default:return browserName+" "+fullVersion}},isWebApp:function(){return!(!this.isIOS()&&!this.isAndroid())&&(!!window.navigator.standalone||(!!window.matchMedia("(display-mode: fullscreen)").matches||(!!window.matchMedia("(display-mode: minimal-ui)").matches||!!window.matchMedia("(display-mode: standalone)").matches)))},testsPassed:function(){var passed=!0;return this.mediaCheck()||(passed=!1),(this.androidWebViewCheck()||this.facebookBrowserCheck()||this.androidSamsungBrowserCheck())&&(passed=!1),passed},getLoadCheckObj:function(){return{isIOS:this.isIOS(),mediaCheckPassed:this.mediaCheck(),isAndroid:this.isAndroid(),isWebView:this.androidWebViewCheck(),isWebApp:this.isWebApp(),isFacebookIAB:this.facebookBrowserCheck(),testPassed:this.testsPassed(),browserVersion:this.getBrowserDetails()}},incompatibleDevice:function(){APP.alert.show('<h4 style=\'padding:0.67em\'>Unfortunately, the manufacture of this device is no longer providing updates to support current web standards. Therefore, it no longer meets the minimum requirements to run DartConnect\'s advanced features. Please try running the application on another device.</h4><a href="https://www.dartconnect.com/how-to/#compatibility" style="color:#0000FF; text-decoration: underline">Learn More</a>',(function(){}),!1,"Outdated Device"),$("#alert-title").css("background","red")},incompatibleBrowser:function(){var platform=null;APP.loadCheck.isAndroid()&&(platform="android"),APP.loadCheck.isIOS()&&(platform="iOS");switch(platform){case"android":message="<h4 style='padding:0.67em'>This browser has not been approved for DartConnect and may lead to inconsistent behavior. Please proceed to the Google Play Store and download the <span class='bold'>Google Chrome Browser</span>.</h4>";break;case"iOS":message="<h4 style='padding:0.67em'>This browser has not been approved for DartConnect and may lead to inconsistent behavior. DartConnect recommends Apple Safari or Google Chrome</h4>";break;default:message="<h4 style='padding:0.67em'>This browser has not been approved for DartConnect and may lead to inconsistent behavior. DartConnect recommends Google Chrome or Apple Safari.</h4>"}message+='<a href="https://www.dartconnect.com/how-to/#compatibility" style="color:#0000FF; text-decoration: underline">Learn More</a>',$("#alert-title").css("background","red"),APP.alert.show(message,(function(){}),!1,"Incompatible Browser"),window.setTimeout((function(){$("#device-role-menu").hide(),$("#home-menu").hide(),$("#popup-login").hide(),$("#splash-bottom").hide(),$("#alert-ok").hide()}),100)}},init:function(){if(APP.device.isLocalStorageOK()){moment.tz.add("America/New_York|EST EDT|50 40|0101|1Lz50 1zb0 Op0");var host=location.host;switch(-1===(host=host.split(":")[0]).indexOf("192.168.")&&-1===host.indexOf("10.")||(host="local.dartconnect.com",APP.isLocal=!0),host){case"testapp.dartconnect.red":case"local.dartconnect.com":"local.dartconnect.com"==host&&$("#app-overlay").hide();"TEST Scoring App"!==document.title&&(document.title="TEST Scoring App"),APP.location="test",$(".splash").addClass("test");break;case"dev.app.dartconnect.red":APP.location="dev";break;case"train.app.dartconnect.com":APP.location="train";"Use the login listed in the control panel of the member site</p>","<p><span class='font-weight: bold'>Pro Tip:</span> ","Create a split screen to show the the scoring app and the member site at the same time</p>",$(".pl-extra").empty().append("<p><span class='font-weight: bold'>Login:</span> Use the login listed in the control panel of the member site</p><p><span class='font-weight: bold'>Pro Tip:</span> Create a split screen to show the the scoring app and the member site at the same time</p>"),$(".splash").addClass("train");break;default:APP.location="live"}BBAT.storeData({app_version:APP.version});try{APP.user_options.backup_tablet&&$("html").addClass("backup-tablet")}catch(e){}if(APP.loadCheck.checkUpdates(),!BBAT.fetchData("load_check_done"))try{APP.loadCheck.init()}catch(e){}APP.timer_id=setInterval(APP.checkState,100),APP.device.addButtonHandler(["pl-ok"],APP.handleLoginOption),APP.isTimeToFlushUIEvents()&&APP.flushUIEvents(),$("#pl-password-link").attr("href",APP.getDomain("MEMBERS")+"/#passwordhelp"),$("#pl-signup-link").attr("href",APP.getDomain("MEMBERS")+"/#signup"),$("#hdr-logo").attr("href",APP.getDomain("MEMBERS")),$("#pp-refresh").attr("href",location.href),APP.device.addButtonHandler(["pw-close"],APP.hideWarning),APP.device.addFieldHandler(["popup-warning"],APP.hideWarning),APP.loginMember()}else alert("Error: Local Storage limit met...")},getSessionInfo:function(){return{member_id:APP.user.member_id,member_level:APP.user.member_level,alley_id:APP.user.home_alley_id,device_token:APP.device.token}},continueInit:function(){var now=new Date;WS.init(APP.getSessionInfo);var isOffline=APP.isOffline();if(APP.device.goOffline(isOffline),BBAT.storeData({seen_warning:"YES"}),"OL".indexOf(APP.user.member_level)>=0&&(APP.user.member_level="P",BBAT.storeData({user:APP.user})),"A"==APP.user.member_level&&(APP.user.member_level="S",BBAT.storeData({user:APP.user})),APP.mode=BBAT.fetchData("app_mode")||"PRE-ROLE",APP.userOptions.startSync(),"PRE-ROLE"==APP.mode){APP.session.startNew("GAME");try{BBAT.fetchData("is_broadcasting")&&(APP.nlf.data.railsReturn||APP.revertToLocalPlay())}catch(e){}APP.dartbot.clearExactBot(),_syncs.init()}if(APP.dartbot.loadExactBot(),APP.device.is_broadcasting&&APP.message_bar.promo.active&&APP.session.isNewMatch()&&(APP.nlf.data.railsReturn||APP.message_bar.showPromo(null,null,null,!1,!0)),APP.device.role=BBAT.fetchData("device_role"),APP.session.updateMatchRole(APP.device.role),"TOURNAMENT"==APP.session.getMatchMode()&&(APP.fbl_in_match["bb-e-new-players"]=!0),"PRE-ROLE"==APP.mode){var mcache=BBAT.fetchData("mcache");mcache&&(APP.user.member_level=mcache.l,APP.user.med=mcache.e,BBAT.storeData({user:APP.user})),BBAT.flushData("mcache"),BBAT.flushData("other_game"),APP.proxyflow.tryToLaunch(1)&&APP.proxyflow.init(),APP.server.memberCheckin((function(in_payload){if(!APP.user||!APP.user.token||now>new Date(APP.user.token_expire_date)&&"PRE-ROLE"==BBAT.fetchData("app_mode"))APP.bootUser();else{var new_med=new Date(in_payload.membership_expires).valueOf();if(APP.user.first_name=in_payload.first_name,APP.user.last_name=in_payload.last_name,APP.user.email=in_payload.email,APP.user.premium_pay_type=in_payload.premium_pay_type,APP.user.token_expire_date=new Date(in_payload.user_token_expires).valueOf(),APP.user.subscription_payment_method_is_valid=in_payload.subscription_payment_method_is_valid,APP.user.subscription_status=in_payload.subscription_status,void 0!==in_payload.lobby_guest_access&&(APP.user.lobbyGuestAccess=in_payload.lobby_guest_access),void 0!==in_payload.recap_status_bot&&(APP.user.recap_status_bot=in_payload.recap_status_bot),APP.flushLeagueDirectories(),in_payload.league_associations){APP.user.league_associations=in_payload.league_associations.slice(0);for(var lalen=in_payload.league_associations.length,i=0;i<lalen;i++){var l=in_payload.league_associations[i],key="_"+l.league_division_guid+"_"+l.season_status;if("I"!=l.access_status){var d=in_payload.directory_divisions[key];if(d){d.league_guid=l.league_guid,d.season_status=l.season_status,d.edit_date=null,"TEAM"==l.league_type&&d.teams.unshift({});var obj={};obj["directory_division"+key]=d,BBAT.storeData(obj)}}}}else delete APP.user.league_associations;if(in_payload.lobby_leagues?APP.user.lobby_leagues=in_payload.lobby_leagues:delete APP.user.lobby_leagues,APP.lobby.data.accessLevel=APP.lobby.lobbyAccessLevel(),BBAT.storeData({user:APP.user}),in_payload.tournaments){APP.session.tournaments={};var len=in_payload.tournaments.length;for(i=0;i<len;i++){var t=in_payload.tournaments[i];APP.session.tournaments[t.id]={active:t.active,start_date:t.start_date,promo_line_1:t.promo_line_1,promo_line_2:t.promo_line_2,promo_line_3:t.promo_line_3,menu_title:t.menu_title,menu_description:t.menu_description,match_description:t.match_description,reset_match_format:t.reset_match_format,bracket_interface:t.bracket_interface,tournament_type:t.tournament_type,checkin_tagline:t.checkin_tagline,checkin_type:t.checkin_type,expiration_date:t.expiration_date,tablet:t.tablet,checkin_start_date:t.checkin_start_date,proxy_account:t.proxy_account,start_timestamp:t.start_timestamp,expiration_timestamp:t.expiration_timestamp,show_all_matches_override:!1,org_name:t.org_name,city:t.city,country:t.country,country_code:t.country_code,state:t.state,region:t.region,venue:t.venue,event_number_label:t.event_number_label,bracket_api_url:t.bracket_api_url,new_scoreboard_only:t.new_scoreboard_only,opt_proxy_flow:t.opt_proxy_flow,optimized_roster:t.optimized_roster}}BBAT.storeData({tournaments:APP.session.tournaments})}in_payload.member_level==APP.user.member_level&&new_med==APP.user.med||(BBAT.storeData({mcache:{l:in_payload.member_level,e:new_med}}),APP.user.med=new_med);var now=new Date,time_left=new Date(APP.user.token_expire_date)-now,autoRenew=!1;if("non_renewing"!==APP.user.subscription_status&&APP.user.subscription_payment_method_is_valid&&(autoRenew=!0),time_left<6048e5&&!autoRenew){var last_warning=BBAT.fetchData("last_login_warning")||0;if(now-new Date(last_warning)>864e5){var days_left=Math.ceil(time_left/864e5);if(APP.user.token_expire_date==new_med)if(APP.user.pa){var pMessage="This temporary login will expire after the event is completed.";APP.user.pa&&"L"===APP.user.pt&&(pMessage="This temporary login will remain active until the league season is completed."),APP.alert.show(pMessage);new Timer({name:"hideAlertTimer",runTime:2,callback:function(){APP.alert.hide()},eachTick:function(){},debugMode:!1})}else APP.alert.show("Your Membership will expire in "+days_left+' days.<p>To continue enjoying uninterrupted service,<br /><a href="https://my.dartconnect.com/membership" target="_blank" style="color:cornflowerblue;">please renew your membership</a>.');else APP.alert.show("Your App login  will expire in "+days_left+" days.<p>At your earliest convenience, please connect this device to the Internet to renew your login.");BBAT.storeData({last_login_warning:now})}}if(APP.user.pa)try{APP.session.tournaments&&Object.keys(APP.session.tournaments).length&&APP.unblockFeatures(["drm-tournament"],!0),APP.user.league_associations&&APP.user.league_associations.length&&APP.unblockFeatures(["drm-guest-connect","drm-league"])}catch(e){}APP.starpubs.init(),APP.proxyflow.tryToLaunch(2)&&APP.proxyflow.init()}}))}"PRE-ROLE"!=APP.mode&&APP.header.fetchDirectory(),APP.buildFeatureBlockLists(),APP.blockUIControls(),APP.user&&APP.user.seba&&(APP.blockFeatures(["drm-tournament","drm-practice","drm-guest-connect"]),APP.blockUIControls()),APP.user&&(APP.user.chx||APP.user.tx)&&(APP.blockFeatures(["drm-guest-connect"]),APP.blockUIControls());var proxy_type=null;if(APP.user.pa&&(proxy_type="PT","L"===APP.user.pt&&(proxy_type="PL")),APP.user&&proxy_type&&("PT"===proxy_type?APP.blockFeatures(["drm-quick-play","drm-play","drm-league","drm-guest-connect"]):APP.blockFeatures(["drm-quick-play","drm-play","drm-tournament"]),APP.blockUIControls()),APP.reveal.updateSetStatus(),"PRE-ROLE"==APP.mode&&BBAT.fetchData("game_postbroadcast")&&BBAT.flushData("game_postbroadcast"),APP.header.opponent_type="TEAM"==APP.session.getMatchMode()?"TEAM":"PLAYER",APP.device.addButtonHandler(["pc-pause"],APP.handleCountdownOption),APP.device.addButtonHandler(["bb-g-rejoin","bb-g-exit","match-control-button"],APP.handleGuestButtonBarOption),APP.device.addButtonHandler(["bb-g-stats"],APP.handleEOGMenuOption),APP.device.addButtonHandler(["esp-close"],APP.handleGameStatsOption),APP.device.addButtonHandler(["prg-info","prg-close","prg-opponent-0","prg-opponent-1","prg-opponentff-0","prg-opponentff-1","prg-delete"],APP.handleResetGameOption),APP.device.addButtonHandler(["peog-close","peog-swd","peog-newgame"],APP.handleEOGOption),APP.device.addButtonHandler(["bb-e-new-players","bb-e-reload","bb-e-alley"],APP.handleMatchOption),APP.device.addButtonHandler(["pcm-close-button","pcm-info-button","pcm-continue-button","pcm-broadcast-start-button","pcm-broadcast-end-button","pcm-broadcast-share-button","pcm-compete-host-button","pcm-compete-host-chalk-button","pcm-compete-share-button","pcm-disconnect-host-button","pcm-disconnect-participant-button"],APP.handleAlleyOption),APP.device.addButtonHandler(["eom-info","eom-close","eom-screen-saver","eom-connect","eom-match","eom-end-match","eom-abandon-format","eom-stats","eom-edit","eom-flag"],APP.handleEOGMenuOption),APP.device.addButtonHandler(["efe-close","efe-save"],APP.handleGameNoteEditor),APP.device.addButtonHandler(["pgc-close","pgc-continue"],APP.handleGuestConnect),APP.device.addButtonHandler(["pgc-host","pgc-join","pgc-compete-share-button","pgc-select-game","pgc-open-lobby","pgc-open-league-lobby","pgc-cancel"],APP.guestConnectDisplay),APP.device.addButtonHandler(["pom-info","pom-close","pom-about","pom-apply","pom-default-play","pom-default-league","pom-default-tourney","pom-all-intros","pom-cricket-cues","pom-set-setup","pom-notables","pom-offline","pom-running-3da","pom-pro-speed-keys","pom-auto-leg","pom-game-shot","pom-fast-finish-flights","pom-do-attempts","pom-suggested-out-standard","pom-suggested-out-numeric","pom-suggested-out-left","pom-suggested-out-right","pom-big-ui","pom-remote-score-update","pom-speed-keys-basic","pom-speed-keys-advanced","pom-speed-keys-pro","pom-auto-balance"],APP.handleOptionsMenu),APP.device.addButtonHandler(["pcc-close","pcc-continue-broadcast","pcc-continue-hosting","pcc-continue"],APP.handleCloseConnection),APP.device.addButtonHandler(["pp-cancel","pp-ok"],APP.handleExitPassword),APP.device.addButtonHandler(["pa-close"],APP.handleAbout),APP.device.addButtonHandler(["par-resume","par-restart"],APP.handleAutoRestart),APP.device.addButtonHandler(["pli-close"],APP.hideLeagueIntro),APP.device.addButtonHandler(["emergency-exit"],APP.emergencyExit),APP.device.addFieldHandler(["pi-close"],APP.hideIntro),APP.device.addFieldHandler(["pli-dont-show"],APP.hideLeagueIntro),$("#hdr-version").text("v"+APP.version),APP.isGameStale()&&APP.flushGameEvents(),APP.game_master=APP.game_master||BBAT.fetchData("game_master")||"SERVER",APP.uicmd_seq=BBAT.fetchData("uicmd_seq")||0,APP.device.disableButton("bb-g-stats"),APP.device.disableButton("bb-g-rejoin"),window.scrollTo(0,0),"PRE-ROLE"==APP.mode){if(APP.flushGameEvents(),BBAT.fetchData("keep_alley_open"))if(APP.device.role="HOST",APP.device.has_chalk=BBAT.fetchData("has_chalk"),APP.game_master="SERVER",APP.server.alley_id=BBAT.fetchData("alley_id"),APP.server.participant_device_key=BBAT.fetchData("participant_device_key"),APP.server.spectator_device_key=BBAT.fetchData("spectator_device_key"),APP.nlf.data.railsReturn&&APP.nlf.data.railsReturn.game_master)APP.game_master=APP.nlf.data.railsReturn.game_master;else if(APP.nlf.data.railsReturn&&!APP.nlf.data.railsReturn.game_master);else try{APP.nlf.rails.data.rails&&APP.nlf.exit(!0)}catch(e){}else APP.flushState(),APP.device.role="HOST",APP.game_master="DEVICE",APP.device.is_broadcasting=!1,APP.device.has_chalk=!1,APP.server.alley_id=null,APP.server.participant_device_key=null,APP.server.spectator_device_key=null,APP.device.is_broadcasting=!1,APP.server.alley_key=null;if(APP.storeState(),APP.user&&APP.user.first_name&&!APP.user.pa)$("#drm-practice").html('Welcome<br /><span class="player-name">'+APP.user.first_name+" "+APP.user.last_name+"!</span>");else{var displayWelcome="Welcome!";APP.user.home_alley_id&&(displayWelcome+=`\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<span class="proxy-msg">Your DCTV Tablet ID is </span>\n\t\t\t\t\t\t<span class="player-name bold">${APP.user.home_alley_id}</span>\n\t\t\t\t\t`),$("#drm-practice").html(displayWelcome)}APP.user&&"G"==APP.user.member_level?($("#drm-member-link").html('<span style="color:white;">Access all Options:</span> Upgrade Now').addClass("noPad"),$("#view-help").hide()):$("#drm-member-link").html("My DartConnect"),$("#drm-member-link").attr("href",APP.getDomain("MEMBERS")+"/membership"),$("#drm-leaderboard-link").attr("href",APP.getDomain("LEADERBOARD")+"#p-"+APP.user.member_id),APP.popup.show("device-role-menu"),APP.server.updateSyncMessages();var last_seen=BBAT.fetchData("intro_last_seen")||0;now=(new Date).valueOf();(!last_seen||now-last_seen>6048e5)&&BBAT.storeData({intro_last_seen:now}),$("#splash-bottom").show(0),$("#splash-version").html("DartConnect v <span>"+APP.version+"</span> - "+APP.getMembershipName(APP.user.member_level)),APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.reveal.updateSetStatus()}else if(APP.mode="PRE-GAME",APP.is_reloading=!0,"TOURNAMENT"==APP.session.getMatchMode()&&APP.session.setUpTournamentDefaults(),"DEVICE"==APP.game_master)reloadFromLocal(),APP.reveal.updateDCTVKey();else switch(APP.device.role){case"HOST":APP.reveal.updateDCTVKey(),APP.device.is_hosting?reloadFromServer():(reloadFromLocal(),null==APP.server.game_id&&APP.server.setGameSettings());break;case"PARTICIPANT":APP.device.disableButton("bb-e-alley"),APP.server.alley_key=BBAT.fetchData("alley_key"),reloadFromServer()}function reloadFromLocal(){APP.practicePopup.start(),APP.device.has_chalk=!0,APP.processGameSettings(BBAT.fetchData("game_settings")),APP.chalkboard.unshield(),APP.game_selector.show(),APP.reveal.showButtonBar("button-bar-match","","",!0),APP.processGameEvents(),APP.tacticsResize.reloadToggle(),APP.game.started?(APP.header.hideSetSetup(),APP.game.hasAnyoneScored()?APP.session.hideChangePlayerDiv():APP.session.showChangePlayerDiv()):APP.plugin_cricket.isPrevGameTactics()&&(APP.quickplay.addTacticsToGameMenu(),BBAT.flushData("prev_game_tactics")),APP.game.started&&!APP.game.finished||(APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.game.finished||APP.reveal.updateSetStatus()),APP.is_reloading=!1,APP.processShortcut(),APP.reveal.setChalkButton(),APP.handlePostReloading(),BBAT.fetchData("prior_leg_reload")&&(APP.scoreboard.unshield(),delete localStorage.prior_leg_reload),APP.session.tournament_crash_caught&&(APP.exitTournament(),BBAT.flushData("bracket"),BBAT.flushData("tournaments"),APP.reload())}function reloadFromServer(){APP.server.getGameSettings({spinner:!1,success:function(in_payload){$("#emergency-exit").hide(),APP.device.has_chalk=in_payload.chalk_owner==APP.device.token,APP.processGameSettings(in_payload.game_settings),APP.storeState(),APP.server.option.shared_control=BBAT.fetchData("shared_control"),APP.reveal.setChalkButton(),APP.flushGameEvents(),APP.chalkboard.unshield(),APP.device.has_chalk?(APP.reveal.setBackButton("HOST"==APP.device.role?null:"EXIT"),in_payload.game_started?(advLog.doLog({type:"App Refresh"}),APP.checkEndOfSet=!0,APP.server.getGameEvents({spinner:!0,success:function(){APP.processGameEvents(),APP.server.startTimer("SEND"),APP.continueReloadFromServer()}})):(APP.game_selector.show(),!APP.game.started&&APP.device.has_chalk&&APP.plugin_cricket.isPrevGameTactics()&&(APP.quickplay.addTacticsToGameMenu(),BBAT.flushData("prev_game_tactics")),APP.session.showNewSetLegSelectorLeague(),APP.reveal.showButtonBar("button-bar-match"),APP.server.startTimer("SEND"),APP.continueReloadFromServer())):(APP.device.is_hosting&&"PRE-GAME"==APP.mode&&$("#match-control-button").show(0),APP.reveal.setBackButton("EXIT"),in_payload.game_started?(advLog.doLog({type:"App Refresh"}),APP.server.getGameEvents({spinner:!0,success:function(){APP.processGameEvents(),APP.setupForSpectating(),APP.game.started&&!APP.game.finished||(APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.game.finished||APP.reveal.updateSetStatus()),APP.is_reloading=!1,APP.reveal.setChalkButton(),APP.handlePostReloading()}})):(APP.setupForSpectating(),APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.reveal.updateSetStatus(),APP.is_reloading=!1,APP.reveal.setChalkButton(),APP.handlePostReloading()))},error:function(){$("#emergency-exit").show(),window.setTimeout((function(){reloadFromServer()}),2e3)}})}"PRE-ROLE"==APP.mode?APP.session.reloadOnlineBracket():(BBAT.flushData("reload_bracket_board"),BBAT.flushData("reload_bracket")),APP.lobby.reloadCheck(),APP.nlf.reloadCheck(),APP.qp2.reloadCheck(),APP.cif.reloadCheck(),APP.magiconnect.reloadCheck(),APP.dcConnect=new DCConnect,APP.starpubs.reloadCheck();var initTestbot=!1;try{"test"==APP.location&&(initTestbot=!0),localStorage.testbot_data&&(initTestbot=!0)}catch(e){}initTestbot&&testbot.init(),"PRE-GAME"==APP.mode&&(APP.zanis.masterCheck("Reload"),APP.session.checkPlayerMidSetChange()),APP.server.checkSendMatchScoreToPlatform(),APP.ffwd._doCheck()},continueReloadFromServer:function(){BBAT.fetchData("chalk_pickup_pending")?APP.server.pickupChalk({spinner:!0,success:function(){APP.is_reloading=!1,APP.reveal.setChalkButton(),APP.processShortcut(),APP.handlePostReloading()},error:function(){APP.is_reloading=!1,APP.reveal.setChalkButton(),APP.processShortcut(),APP.handlePostReloading()}}):BBAT.fetchData("chalk_release_pending")?(APP.device.has_chalk=!1,APP.reveal.setChalkButton(),APP.is_reloading=!1,APP.server.releaseChalk(),APP.handlePostReloading()):(APP.is_reloading=!1,APP.reveal.setChalkButton(),APP.processShortcut(),APP.handlePostReloading(),APP.device.hideSpinnerOverlay()),"Cricket"==APP.game.name&&APP.scoreboard_cricket.enableGameSettings(),BBAT.fetchData("board_taken")&&(BBAT.flushData("board_taken"),"SERVER"!=APP.game_master||"IN-GAME"!=APP.mode||APP.game.finished||APP.alert.show("You are now scoring "+APP.game.opponent[APP.game.active_opponent].getChalkboardName()+"'s turn.<p>To edit prior turns, use the [BACK] button.")),BBAT.fetchData("updating_host_device")?(APP.server.sendHostGameFinish(!0),APP.server.guestGameEndOfSet&&(APP.server.hostGameEnableOptions=!0)):APP.scoreboard.eolOverlayOff()},isRevertingToLocal:!1,revertToLocalPlay:function(){APP.game_master="DEVICE",APP.server.stopTimer(),APP.server.spectator_device_key=null,APP.server.participant_device_key=null,APP.device.is_broadcasting=!1,APP.device.is_hosting=!1,APP.device.has_chalk=!0,APP.reveal.setChalkButton(),APP.storeState(),APP.reveal.updateDCTVKey(),APP.reveal.setBackButton("IN-GAME"==APP.mode?"RESET":"EXIT")},flushLeagueDirectories:function(){var key;for(key in window.localStorage)key.match(/^directory_division_.*/gi)&&BBAT.flushData(key)},getAssociatedLeagueSeason:function(in_league_division_guid){var i,len,ula=(APP.user?APP.user.league_associations:null)||[];for(len=ula.length,i=0;i<len;i++)if(ula[i].league_division_guid==in_league_division_guid)return ula[i];throw new Error("Missing League Association:"+in_league_division_guid)},showLeagueIntro:function(){$("#popup-league-intro-overlay").show(0),$("#popup-league-intro").show(0)},hideLeagueIntro:function(in_id){"pli-dont-show"==in_id&&(APP.user_options.skip_league_intro=!0,APP.storeUserOptions()),$("#popup-league-intro").hide(0),$("#popup-league-intro-overlay").hide(0)},showMessagingIntro:function(){},hideMessagingIntro:function(in_id){APP.info.hide("info-topic-messaging"),in_id&&(APP.user_options.skip_messaging_intro=!0,APP.storeUserOptions())},showWarning:function(){$("#popup-warning-overlay").show(0),$("#popup-warning").show(0)},hideWarning:function(in_id){$("#popup-warning").hide(0),$("#popup-warning-overlay").hide(0)},showIntro:function(){$("#popup-intro-overlay").show(0),$("#popup-intro").show(0)},hideIntro:function(in_id){$("#popup-intro").hide(0),$("#popup-intro-overlay").hide(0)},isAutoLegAllowed:function(){return!1},last_connectivity_issue:null,updateConnectivityMonitor:function(in_stats){0==$("#reveal-key span").length&&($("#reveal-key").text().length||$("#reveal-key").append("<span />")),in_stats?in_stats.error_count+in_stats.timeout_count>=1?(APP.device.is_hosting||APP.device.is_broadcasting?$("#reveal-connectivity").attr("class","").addClass("solid-red"):$("#reveal-connectivity").attr("class","").addClass("red"),!0,$("#reveal-key span").text("NO WIFI"),APP.session.isBracketMatchListing&&(APP.session.updateBracketMatchTimer=!1,APP.eventBoardSelector.goOffline()),APP.session.bracket&&APP.session.checkBracketConnectivity()):in_stats.success_average_time>1500||in_stats.success_time>2e3?(APP.device.is_hosting||APP.device.is_broadcasting?$("#reveal-connectivity").attr("class","").addClass("solid-yellow"):$("#reveal-connectivity").attr("class","").addClass("yellow"),!0,$("#reveal-key span").text("LO WIFI")):(APP.device.is_hosting||APP.device.is_broadcasting?$("#reveal-connectivity").attr("class","").addClass("solid-green"):$("#reveal-connectivity").attr("class","").addClass("green"),!1,$("#reveal-key span").text("WIFI"),APP.session.isBracketMatchListing&&(APP.eventBoardSelector.goOnline(),APP.session.updateBracketMatchTimer||(APP.session.updateBracketMatchTimer=!0,APP.session.updateBracketMatchListing()))):$("#reveal-connectivity").attr("class","").addClass("solid-gray")},eventBoardSelector:{inited:!1,contentHeight:0,userClosed:!1,isOffline:!1,ele:{optsDiv:$("#pbml-board-opts"),onlineContent:$("#pbml-board-select"),offlineContent:$("#pbml-board-offline")},goOffline:function(){this.inited||(this.inited=!0,APP.fns.activateBtn(["pbml-board-offline-close"],(function(){APP.eventBoardSelector.closeOffline()})),APP.fns.activateBtn(["pbml-board-offline-help"],(function(){APP.eventBoardSelector.offlineHelp.init()}))),this.userClosed||this.isOffline||(this.contentHeight=this.ele.onlineContent.height(),this.ele.optsDiv.addClass("danger"),this.ele.onlineContent.addClass("hide"),this.ele.offlineContent.css("min-height",this.contentHeight+"px"),this.ele.offlineContent.removeClass("hide"),this.isOffline=!0)},goOnline:function(){this.ele.optsDiv.removeClass("danger"),this.ele.onlineContent.removeClass("hide"),this.ele.offlineContent.addClass("hide"),this.isOffline=!1},closeOffline:function(){this.goOnline(),this.userClosed=!0},offlineHelp:{init:function(pageNo){this.flowData.pageNo=pageNo||"offlineHelp",this.flow=new UIFlow(this.flowData)},flow:null,flowData:{name:"offlineHelp",pageNo:"offlineHelp",usePageNames:!0,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{offlineHelp:{hideFooter:!1,hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t\t\t\t<div class="highlight-box primary pMd">\n\t\t\t\t\t\t\t\t\t<h3 class="header text-gold">Reset the Internet Connection</h3>\n\t\t\t\t\t\t\t\t\t<svg class="svg-icon left text-red" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-wifi"></use>\n\t\t\t\t\t\t\t\t\t</svg> \n\t\t\t\t\t\t\t\t\t<p>This tablet is NOT responding to the DC server. This may be because it is connected to the local WiFi, but not to the internet.</p>\n\t\t\t\t\t\t\t\t\t<p><span class="bold">Note:</span> If the tablet is offline, matches can still be played, but the results will not be reported, and new match assignments will not be displayed on this tablet.<p>\n\t\t\t\t\t\t\t\t\t<p><span class="bold text-gold">Solution: Reset WiFi and Test Internet Connectivity</span></p>\n\t\t\t\t\t\t\t\t\t<ol>\n\t\t\t\t\t\t\t\t\t\t<li>Access the device settings on this tablet.</li>\n\t\t\t\t\t\t\t\t\t\t<li>Toggle the WiFi option off/on.</li>\n\t\t\t\t\t\t\t\t\t\t<li>Test internet access by going to a popular web site. If successful, close the browser tab and return to the DC scoring app.</li>\n\t\t\t\t\t\t\t\t\t</ol>\n\t\t\t\t\t\t\t\t\t<p>If unsuccessful, replace this tablet with a new device until the issue with this device can be resolved.</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t'},addFooter:function(scope){scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t\t\t<table class="footer-table" width="100%" align="center">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\t\tid="close-offline-help"\n\t\t\t\t\t\t\t\t\t\t\t\tclass="button button-md button-red round-corners img-center"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tClose\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t'),APP.fns.activateBtn(["close-offline-help"],(function(){scope.exit()}))},init:function(scope){this.addFooter(scope),scope.ele.main.find(".popup-title span").text("Offline Help")}}}}}},handleAbout:function(in_id){$("#popup-about").hide(0),$("#popup-about-overlay").hide(0)},showAbout:function(){var em,user=APP.user||{},now=new Date,exp=new Date(user.token_expire_date),exp_days=Math.ceil((exp-now)/24/60/60/1e3);user.login.indexOf("@")>=0?(em=user.login.split("@"),$("#pa-login-email").html(em[0]+"<br />@"+em[1])):$("#pa-login-email").html(user.login),$("#pa-login-expires").text(exp_days+" days"),$("#pa-member-id").text(user.member_id),$("#pa-membership").text(APP.getMembershipName(user.member_level)),$("#pa-membership-expires").text(user.med?new Date(user.med).toLocaleString().split(",")[0]:"?"),$("#pa-app-version").text("v"+APP.version),$("#pa-dc-system").text(APP.getEnvironment()),$("#pa-match-mode").text(APP.session.getMatchMode()),$("#popup-about-overlay").show(0),$("#popup-about").show(0)},storeUserOptions:function(userUpdated,noSync){if(BBAT.storeData({user_options:APP.user_options}),!noSync)try{!userUpdated||APP.session.isLeaguePlay()||APP.session.isBracketMatch()||APP.userOptions&&APP.userOptions.nSync&&APP.userOptions.nSync.updateData(APP.user_options)}catch(e){}},fetchUserOptions:function(){APP.user_options=BBAT.fetchData("user_options"),APP.user_options||(APP.user_options={intros:!0,big_ui:!1,bust_darts:!1,cricket_cues:!0,fast_finish_flights:!0,do_attempts:!1,game_shot:!0,quick_play:!1,dartbot_adaptive_play:!1,dartbot_auto_alt_start:!1,dartbot_quick_play:!1,dartbot_suppress_email:!0,hints_01:!1,marksman:!0,notables:!0,pro_speed_keys:!1,speed_keys:1,running_3da:!1,running_1da:!1,set_setup:!0,suggested_out_numeric:!1,suggested_out_standard:!1,suggested_out_left:!1,suggested_out_right:!1,tactics_resize:!0,force_full_screen:!1,tournament_mode:null,tournament_leg_max:null,tournament_leg_mode:null,tournament_set_mode:null,tournament_set_limit:null,tournament_next_game:null,tournament_next_game_options:null,tournament_same_game:null,tournament_same_legs:null,floating_set_score:!1,backup_tablet:!1}),void 0===APP.user_options.tactics_resize&&(APP.user_options.tactics_resize=!0),void 0===APP.user_options.force_full_screen&&(APP.user_options.force_full_screen=!1),void 0===APP.user_options.backup_tablet&&(APP.user_options.backup_tablet=!1)},refreshOptionsMenu:function(){var uo=APP.user_options;if($(".pom-check").removeClass("pom-check-on"),uo.skip_basic_intro||uo.skip_league_intro||$("#pom-check-all-intros").addClass("pom-check-on"),uo.set_setup&&$("#pom-check-set-setup").addClass("pom-check-on"),uo.fast_finish_flights&&$("#pom-check-fast-finish-flights").addClass("pom-check-on"),uo.auto_balance&&$("#pom-check-auto-balance").addClass("pom-check-on"),uo.do_attempts&&$("#pom-check-do-attempts").addClass("pom-check-on"),uo.game_shot&&$("#pom-check-game-shot").addClass("pom-check-on"),uo.remote_score_update&&$("#pom-check-remote-score-update").addClass("pom-check-on"),uo.cricket_cues&&$("#pom-check-cricket-cues").addClass("pom-check-on"),uo.notables&&$("#pom-check-notables").addClass("pom-check-on"),uo.suggested_out_standard&&$("#pom-check-suggested-out-standard").addClass("pom-check-on"),uo.suggested_out_numeric&&$("#pom-check-suggested-out-numeric").addClass("pom-check-on"),uo.suggested_out_left&&$("#pom-check-suggested-out-left").addClass("pom-check-on"),uo.suggested_out_right&&$("#pom-check-suggested-out-right").addClass("pom-check-on"),void 0!==uo.speed_keys){for(var skArr=["#pom-check-speed-keys-basic","#pom-check-speed-keys-advanced","#pom-check-speed-keys-pro"],i=0;i<skArr.length;i++)$(skArr[i]).removeClass("pom-check-on");switch(uo.speed_keys){case 0:$("#pom-check-speed-keys-basic").addClass("pom-check-on");break;case 1:$("#pom-check-speed-keys-advanced").addClass("pom-check-on");break;case 2:$("#pom-check-speed-keys-pro").addClass("pom-check-on");break;default:$("#pom-check-speed-keys-basic").addClass("pom-check-on")}}uo.hints_01&&$("#pom-check-hints-01").addClass("pom-check-on"),uo.running_3da&&$("#pom-check-running-3da").addClass("pom-check-on"),uo.big_ui&&$("#pom-check-big-ui").addClass("pom-check-on"),uo.offline&&$("#pom-check-offline").addClass("pom-check-on")},handleOptionsMenu:function(in_id){var uo=APP.user_options;function closeMenu(){$("#popup-options-menu").hide(0),$("#options-menu-overlay").hide(0),"IN-GAME"!=APP.mode&&APP.game.plugin.refreshGamePanel()}function enableApply(){APP.device.enableButton("pom-apply",!0)}function refreshStandardOuts(in_type){var on_left=$("#pom-check-suggested-out-left").hasClass("pom-check-on"),on_right=$("#pom-check-suggested-out-right").hasClass("pom-check-on"),on_std=$("#pom-check-suggested-out-standard").hasClass("pom-check-on"),on_num=$("#pom-check-suggested-out-numeric").hasClass("pom-check-on");"SIDES"==in_type?on_left||on_right?on_std||on_num||$("#pom-check-suggested-out-standard").addClass("pom-check-on"):($("#pom-check-suggested-out-standard").removeClass("pom-check-on"),$("#pom-check-suggested-out-numeric").removeClass("pom-check-on")):on_std||on_num?on_left||on_right||($("#pom-check-suggested-out-left").addClass("pom-check-on"),$("#pom-check-suggested-out-right").addClass("pom-check-on")):($("#pom-check-suggested-out-left").removeClass("pom-check-on"),$("#pom-check-suggested-out-right").removeClass("pom-check-on"))}switch(in_id){case"pom-info":APP.info.show("info-text-user-settings","User Settings");break;case"pom-close":closeMenu();break;case"pom-set-setup":$("#pom-check-set-setup").toggleClass("pom-check-on"),enableApply();break;case"pom-about":APP.showAbout();break;case"pom-apply":var request_offline=$("#pom-check-offline").hasClass("pom-check-on");$("#pom-check-all-intros").hasClass("pom-check-on")&&(uo.skip_player_details=!1,uo.skip_league_intro=!1,uo.skip_basic_intro=!1,uo.skip_messaging_intro=!1);var isAutoBalanceActive=APP.user_options.auto_balance;uo.auto_balance=$("#pom-check-auto-balance").hasClass("pom-check-on"),uo.fast_finish_flights=$("#pom-check-fast-finish-flights").hasClass("pom-check-on"),uo.do_attempts=$("#pom-check-do-attempts").hasClass("pom-check-on"),uo.game_shot=$("#pom-check-game-shot").hasClass("pom-check-on"),uo.cricket_cues=$("#pom-check-cricket-cues").hasClass("pom-check-on"),uo.remote_score_update=$("#pom-check-remote-score-update").hasClass("pom-check-on"),uo.notables=$("#pom-check-notables").hasClass("pom-check-on"),uo.suggested_out_standard=$("#pom-check-suggested-out-standard").hasClass("pom-check-on"),uo.suggested_out_numeric=$("#pom-check-suggested-out-numeric").hasClass("pom-check-on"),uo.suggested_out_left=$("#pom-check-suggested-out-left").hasClass("pom-check-on"),uo.suggested_out_right=$("#pom-check-suggested-out-right").hasClass("pom-check-on"),uo.big_ui=$("#pom-check-big-ui").hasClass("pom-check-on"),uo.hints_01=$("#pom-check-hints-01").hasClass("pom-check-on"),uo.pro_speed_keys=$("#pom-check-pro-speed-keys").hasClass("pom-check-on"),$("#pom-check-speed-keys-basic").hasClass("pom-check-on")&&(uo.speed_keys=0),$("#pom-check-speed-keys-advanced").hasClass("pom-check-on")&&(uo.speed_keys=1),$("#pom-check-speed-keys-pro").hasClass("pom-check-on")&&(uo.speed_keys=2),uo.running_3da=$("#pom-check-running-3da").hasClass("pom-check-on"),uo.set_setup=$("#pom-check-set-setup").hasClass("pom-check-on"),APP.storeUserOptions(),APP.plugin_cricket.storeSettings(!0),closeMenu(),APP.keypad_points.setSpeedKeys(),uo.offline!=request_offline&&APP.device.goOffline(request_offline),uo.auto_balance&&(isAutoBalanceActive||APP.game.setInitialAutoBalanceHandicap()),APP.reload();break;case"pom-default-play":$("#pom-check-all-intros").removeClass("pom-check-on"),$("#pom-check-game-selector").addClass("pom-check-on"),$("#pom-check-notables").addClass("pom-check-on"),$("#pom-check-running-3da").addClass("pom-check-on"),$("#pom-check-cricket-cues").addClass("pom-check-on"),$("#pom-check-fast-finish-flights").addClass("pom-check-on"),$("#pom-check-do-attempts").removeClass("pom-check-on"),$("#pom-check-game-shot").addClass("pom-check-on"),$("#pom-check-auto-leg").removeClass("pom-check-on"),enableApply();break;case"pom-default-league":$("#pom-check-all-intros").removeClass("pom-check-on"),$("#pom-check-game-selector").addClass("pom-check-on"),$("#pom-check-notables").removeClass("pom-check-on"),$("#pom-check-running-3da").removeClass("pom-check-on"),$("#pom-check-cricket-cues").addClass("pom-check-on"),$("#pom-check-fast-finish-flights").addClass("pom-check-on"),$("#pom-check-do-attempts").removeClass("pom-check-on"),$("#pom-check-game-shot").addClass("pom-check-on"),$("#pom-check-suggested-out-left").removeClass("pom-check-on"),$("#pom-check-suggested-out-right").removeClass("pom-check-on"),$("#pom-check-suggested-out-standard").removeClass("pom-check-on"),$("#pom-check-suggested-out-numeric").removeClass("pom-check-on"),$("#pom-check-auto-leg").removeClass("pom-check-on"),enableApply();break;case"pom-default-tourney":$("#pom-check-all-intros").removeClass("pom-check-on"),$("#pom-check-game-selector").removeClass("pom-check-on"),$("#pom-check-notables").removeClass("pom-check-on"),$("#pom-check-running-3da").removeClass("pom-check-on"),$("#pom-check-cricket-cues").removeClass("pom-check-on"),$("#pom-check-speed-keys-basic").removeClass("pom-check-on"),$("#pom-check-speed-keys-advanced").addClass("pom-check-on"),$("#pom-check-speed-keys-pro").removeClass("pom-check-on"),$("#pom-check-fast-finish-flights").addClass("pom-check-on"),$("#pom-check-do-attempts").removeClass("pom-check-on"),$("#pom-check-game-shot").addClass("pom-check-on"),$("#pom-check-suggested-out-left").removeClass("pom-check-on"),$("#pom-check-suggested-out-right").removeClass("pom-check-on"),$("#pom-check-suggested-out-standard").removeClass("pom-check-on"),$("#pom-check-suggested-out-numeric").removeClass("pom-check-on"),$("#pom-check-auto-leg").removeClass("pom-check-on"),enableApply();break;case"pom-all-intros":$("#pom-check-all-intros").toggleClass("pom-check-on"),enableApply();break;case"pom-fast-finish-flights":$("#pom-check-fast-finish-flights").toggleClass("pom-check-on"),enableApply();break;case"pom-do-attempts":$("#pom-check-do-attempts").toggleClass("pom-check-on"),enableApply();break;case"pom-auto-leg":$("#pom-check-auto-leg").toggleClass("pom-check-on"),enableApply();break;case"pom-game-shot":$("#pom-check-game-shot").toggleClass("pom-check-on"),enableApply();break;case"pom-cricket-cues":$("#pom-check-cricket-cues").toggleClass("pom-check-on"),enableApply();break;case"pom-pro-speed-keys":$("#pom-check-pro-speed-keys").toggleClass("pom-check-on"),enableApply();break;case"pom-speed-keys-basic":case"pom-speed-keys-advanced":case"pom-speed-keys-pro":!function(in_id){for(var skArr=["#pom-check-speed-keys-basic","#pom-check-speed-keys-advanced","#pom-check-speed-keys-pro"],i=0;i<skArr.length;i++)$(skArr[i]).removeClass("pom-check-on");switch(in_id){case"pom-speed-keys-basic":$("#pom-check-speed-keys-basic").addClass("pom-check-on");break;case"pom-speed-keys-advanced":$("#pom-check-speed-keys-advanced").addClass("pom-check-on");break;case"pom-speed-keys-pro":$("#pom-check-speed-keys-pro").addClass("pom-check-on");break;default:$("#pom-check-speed-keys-basic").addClass("pom-check-on")}}(in_id),enableApply();break;case"pom-running-3da":$("#pom-check-running-3da").toggleClass("pom-check-on"),enableApply();break;case"pom-offline":$("#pom-check-offline").toggleClass("pom-check-on"),enableApply();break;case"pom-remote-score-update":$("#pom-check-remote-score-update").toggleClass("pom-check-on"),enableApply();break;case"pom-notables":$("#pom-check-notables").toggleClass("pom-check-on"),enableApply();break;case"pom-suggested-out-standard":$("#pom-check-suggested-out-numeric").removeClass("pom-check-on"),$("#pom-check-suggested-out-standard").toggleClass("pom-check-on"),refreshStandardOuts("STYLE"),enableApply();break;case"pom-suggested-out-numeric":$("#pom-check-suggested-out-standard").removeClass("pom-check-on"),$("#pom-check-suggested-out-numeric").toggleClass("pom-check-on"),refreshStandardOuts("STYLE"),enableApply();break;case"pom-suggested-out-left":$("#pom-check-suggested-out-left").toggleClass("pom-check-on"),refreshStandardOuts("SIDES"),enableApply();break;case"pom-suggested-out-right":$("#pom-check-suggested-out-right").toggleClass("pom-check-on"),refreshStandardOuts("SIDES"),enableApply();break;case"pom-auto-balance":$("#pom-check-auto-balance").toggleClass("pom-check-on"),enableApply();break;case"pom-big-ui":$("#pom-check-big-ui").toggleClass("pom-check-on"),enableApply()}},markMatchAsBackup:function(){if(APP.user_options.backup_tablet){try{if(testbot.matchData&&testbot.matchData.length)return!1}catch(e){}return!0}return!1},markEvent:function(){APP.last_event_time=new Date},getDomain:function(in_subdomain){var base="dartconnect.com",host=location.host.toLowerCase(),prefix="",is_dev_dot="dev."==host.slice(0,4),is_dev=!is_dev_dot&&"dev"==host.slice(0,3),is_test_dot="test."==host.slice(0,5),is_test=!is_test_dot&&"test"==host.slice(0,4);switch(is_dev_dot?prefix="dev.":is_dev?prefix="dev":is_test_dot?prefix="test.":is_test&&(prefix="test"),in_subdomain){case"TV":return"http://"+prefix+"tv."+base;case"LEADERBOARD":return is_dev||is_dev_dot||is_test||is_test_dot?"https://leaderboard.dartconnect.red/leaderboard":"https://leaderboard.dartconnect.com/leaderboard";case"WEB":return"http://www."+base;case"MEMBERS":return"https://"+prefix+"my."+base;case"APP":return"https://"+prefix+"app."+base}},getEnvironment:function(){var host=location.host.toLowerCase(),is_dev="dev."==host.slice(0,4),is_test="test."==host.slice(0,5);return"localhost:3000"!==host&&"local.dartconnect.com:3000"!==host||(is_test=!0),is_dev?"Development":is_test?"Test":"Production"},email:function(in_spec){var src="mailto:",delim="?";in_spec.to&&(src+=in_spec.to),in_spec.subject&&(src+=delim+"subject="+encodeURIComponent(in_spec.subject),delim="&"),in_spec.body&&(src+=delim+"body="+encodeURIComponent(in_spec.body)),setTimeout((function(){$('<iframe id="email-iframe" src="'+src+'">').appendTo("body").css("display","none"),setTimeout((function(){$("#email-iframe").remove()}),3e3)}),100)},checkState:function(){var now=new Date,wn=BBAT.fetchData("window_name");if("test"===APP.location&&"localhost"===location.hostname);else if(wn&&wn!=window.name)return window.name="",clearInterval(APP.timer_id),void location.replace("tabcheck.html");now-APP.last_event_time>12e4&&(APP.markEvent(),"D"!=(APP.user?APP.user.member_level:"")||"none"!=$("#league-game-selector").css("display")&&"block"!=$("#opponents-panel").css("display")&&"block"!=$("#popup-session-summary").css("display")&&"block"!=$("#popup-connect-menu").css("display")&&"block"!=$("#popup-options-menu").css("display")&&"block"!=$("#info-overlay").css("display")&&"block"!=$("#debug").css("display")?APP.message_bar.promo.active&&("PRE-GAME"==APP.mode||APP.game.finished)&&"none"==$("#match-options-menu").css("display")&&"none"==$("#popup-promo").css("display")&&"none"==$("#debug").css("display")&&APP.message_bar.showPromo():APP.startAutoRestart())},startAutoRestart:function(){var countdown=30,el=$("#par-countdown");el.text(countdown),$("#popup-auto-restart-overlay").show(0),$("#popup-auto-restart").show(0),APP.restart_timer=setInterval((function(){countdown<=0?APP.autoRestart():(el.text(countdown),countdown--)}),1e3)},handleAutoRestart:function(in_id){switch(in_id){case"par-resume":clearInterval(APP.restart_timer),$("#popup-auto-restart").hide(0),$("#popup-auto-restart-overlay").hide(0);break;case"par-restart":APP.autoRestart()}},autoRestart:function(){APP.session.handleDemoOpponent("lgs-demo-player"),APP.game.finished?APP.newGame():APP.newGame("DELETE")},processShortcut:function(){var shortcut,mf=APP.session.getMatchFormat()||{};if(shortcut=BBAT.fetchData("shortcut"),BBAT.flushData("shortcut"),shortcut&&!APP.ffwd._checkFFWDActive())switch(1==APP.game.opponent_count&&(shortcut="PLAY_AGAIN"),shortcut){case"DELETE":APP.was_game_deleted=!0,APP.header.hideSetSetup();break;case"NEW_PLAYERS":if(APP.starpubs.isStarPubsMatch())return APP.starpubs.checkForTiebreaker()?void APP.starpubs.continueTiebreaker():(APP.header.startOpponentChange(!0,!0),void APP.starpubs.continueMatch());APP.header.startOpponentChange(!0);break;case"PLAY_AGAIN":APP.session.handleBullShoot("bs-opponent-0");break;case"SELECT_SAME_GAME":case"SELECT":APP.game_selector.selectGame("gs-select"),!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit?APP.session.showBullShoot():APP.header.showSetSetup({callback:function(){APP.session.showBullShoot()}});break;case"CORK_SAME_GAME":case"CORK":APP.game_selector.selectGame("gs-cork-calls"),!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit?APP.session.showBullShoot():APP.header.showSetSetup({callback:function(){APP.session.showBullShoot()}});break;case"ALTERNATE_SAME_GAME":APP.game.plugin.handleGameOption("gsp-opponent-ag");break;case"ALTERNATE":case"ALTERNATE_SET":if("ALTERNATE_SET"==shortcut)var ps=0==APP.session.getPrevSetStartingOpponent()?1:0;else ps=0==APP.session.getPrevGameStartingOpponent()?1:0;!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit?APP.game.setBullShootWinner(ps,!1):APP.header.showSetSetup({callback:function(){APP.game.setBullShootWinner(ps,!1)}});break;case"ALTERNATE_SET_SAME_GAME":!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit?APP.game.plugin.handleGameOption("gsp-opponent-as"):APP.header.showSetSetup({callback:function(){APP.game.plugin.handleGameOption("gsp-opponent-as")}});break;case"RANDOM":APP.game.plugin.handleGameOption("gsp-opponent-x");break;case"MUGS_AWAY":APP.game.setBullShootWinner(0==APP.session.getPrevGameWinningOpponent()?1:0,!1);break;case"MUGS_AWAY_SAME_GAME":APP.game.plugin.handleGameOption("gsp-opponent-m");break;case"MUGS_AWAY_SET_SELECT":case"MUGS_AWAY_SET_SAME_GAME":APP.game.setBullShootWinner(0==APP.session.getPrevSetWinningOpponent()?1:0,!1)}},setupForSpectating:function(){if(APP.header.disableEditing(),APP.is_reloading||APP.popup.show("popup-notice","Waiting for Game Start"),APP.reveal.setChalkButton(),APP.server.startTimer("RECEIVE"),APP.starpubs.isStarPubsMatch()){if(APP.game.started||!APP.starpubs.isAway())return;APP.starpubs.reloadGuest(),APP.starpubs.checkLineUpsComplete()||(APP.starpubs.data.match.home.lineup=[],APP.starpubs.data.match.home.confirmed=!1,APP.starpubs.data.match.away.lineup=[],APP.starpubs.data.match.away.confirmed=!1,APP.starpubs.save(),APP.starpubs.showSelectPlayers())}},handleLoginOption:function(in_id){var login=$("#pl-email-login").val().toLowerCase(),pwd=$("#pl-password").val();switch($("#pl-email-login").blur(),$("#pl-password").blur(),in_id){case"pl-ok":$("#pl-message").html("Login in progress.").removeClass("white-on-red").show(0),APP.server.loginMember({login:login,password:pwd,on_success:function(in_data){APP.user={},APP.user.login=login,APP.user.last_name=in_data.payload.last_name,APP.user.first_name=in_data.payload.first_name,APP.user.home_alley_id=in_data.payload.home_alley_id,APP.user.member_id=in_data.payload.member_id,APP.user.member_level=in_data.payload.member_level,APP.user.token=in_data.payload.user_token,APP.user.token_expire_date=new Date(in_data.payload.token_expire_date).valueOf(),APP.user.subscription_payment_method_is_valid=in_data.payload.subscription_payment_method_is_valid,APP.user.subscription_status=in_data.payload.subscription_status,APP.user.seba=login.search(/^EV\d{1,}$/i)>=0,APP.user.chx=login.search(/^CH\d{1,}$/i)>=0,APP.user.tx=login.search(/^T\d{1,}$/i)>=0,APP.user.pa="Y"==in_data.payload.proxy_account,APP.user.hash=APP.user.tx?APP.cheapHash(pwd):null,APP.user.pt=in_data.payload.proxy_type,BBAT.storeData({user:APP.user}),APP.header.forceRestoreProfile(),APP.popup.hide("popup-login"),APP.continueInit()},on_error:function(in_why){APP.user=null,BBAT.flushData("user"),APP.loginMember(in_why)}})}},loginMember:function(in_why){var now=new Date;in_why?"BAD_INPUT"==in_why?$("#pl-message").html("Login failed. Please try again.").removeClass("white-on-red").show(0):$("#pl-message").html("Unable to reach the DartConnect server.<br />Please check your Internet connection.").addClass("white-on-red").show(0):($("#pl-message").removeClass("white-on-red").hide(0),BBAT.fetchData("seen_warning"),APP.user=BBAT.fetchData("user")||{},!APP.user||!APP.user.token||now>new Date(APP.user.token_expire_date)&&"PRE-ROLE"==BBAT.fetchData("app_mode")?APP.bootUser():APP.continueInit()),$("#pl-password").val(""),$("#pl-email-login").focus()},bootUser:function(){APP.device.setKeyboardHandler(null),$("#popup-login").on("keydown",(function(e){if(13==e.which)return BBAT.killDOMEvent(e),APP.handleLoginOption("pl-ok"),!1})),APP.user=null,BBAT.flushData("user"),APP.popup.show("popup-login")},handleGameStatsOption:function(in_id){switch(in_id){case"esp-close":APP.popup.hide()}},handleGameNoteEditor:function(in_id){function hideEditor(){$("#efe-game-notes").val("").blur(),$("#efe-match-notes").val("").blur(),$("#eog-flag-editor").hide(0),$("#eog-flag-editor-overlay").hide(0),APP.device.resumeKeyboardHandler()}switch(in_id){case"efe-close":hideEditor();break;case"efe-save":"block"==$("#popup-match-score").css("display")?(APP.session.setMatchNotes($("#efe-match-notes").val()),hideEditor()):APP.game.isEOGFinal()&&!$("#efe-game-notes").attr("disabled")?$("#efe-game-notes").attr("disabled","disabled").val(APP.session.getGameNotes($("#efe-game-notes"))):(APP.game.isEOGFinal()||APP.session.setGameNotes($("#efe-game-notes").val()),APP.session.setMatchNotes($("#efe-match-notes").val(),!0),hideEditor())}},showGameNoteEditor:function(in_suppress_game_notes){var cm,s,s_len,cs,g,g_len,cg,el_g=$("#efe-game-notes"),el_s=$("#efe-scroll-box"),sess=APP.session,delim="",g_count=0,g_notes="";if(APP.device.pauseKeyboardHandler(),$("#efe-match-notes").val(APP.session.getMatchNotes()),$("#efe-game-notes-label").show(0),in_suppress_game_notes||"block"==$("#popup-match-score").css("display"))el_g.hide(0),$("#efe-game-notes-label").hide(0);else if("block"==$("#popup-match-score").css("display")){for(el_g.val("").hide(0),s_len=(cm=sess.matches[sess.current_match]).sets.length,s=0;s<s_len;s++)for(g_len=(cs=cm.sets[s]).games.length,g=0;g<g_len;g++)g_count++,(cg=cs.games[g]).notes&&(g_notes+=delim+"Game "+g_count+": "+cg.notes,delim="<br />");el_s.html(g_notes||"No Game Notes Recorded...").show(0)}else el_s.html("").hide(0),!APP.game.isEOGFinal()&&APP.game.started||el_g.attr("disabled","disabled"),el_g.val(APP.session.getGameNotes()).show(0);$("#eog-flag-editor-overlay").show(0),$("#eog-flag-editor").show(0)},handleEOGMenuOption:function(in_id){APP.session.getMatchFormat();switch(APP.scoreboard.play_again_option=$("#seo-bb-option-menu").hasClass("button-red")?"MENU":"GAME",in_id){case"seo-bb-players":case"seo-bb-next-new-players":case"seo-bb-change-players":APP.reveal.handleEOMMenu("peom-change");break;case"seo-sb-lineup":case"seo-sb-players":case"seo-sb-next-new-players":APP.reveal.handleEOMMenu("peom-change");break;case"seo-bb-select":"MENU"==APP.scoreboard.play_again_option?APP.newGame("SELECT"):APP.newGame("SELECT_SAME_GAME");break;case"seo-bb-alternate":"MENU"==APP.scoreboard.play_again_option?APP.newGame("ALTERNATE"):APP.newGame("ALTERNATE_SAME_GAME");break;case"seo-bb-mugs":"MENU"==APP.scoreboard.play_again_option?APP.newGame("MUGS_AWAY"):APP.newGame("MUGS_AWAY_SAME_GAME");break;case"seo-bb-cork":"MENU"==APP.scoreboard.play_again_option?APP.newGame("CORK"):APP.newGame("CORK_SAME_GAME");break;case"seo-bb-option-again":$(".seo-bb-option").addClass("button-gray").removeClass("button-red"),$("#seo-bb-option-again").addClass("button-red").removeClass("button-gray"),APP.scoreboard.play_again_option="GAME",APP.scoreboard.showEOGStatus();break;case"seo-bb-option-menu":$(".seo-bb-option").addClass("button-gray").removeClass("button-red"),$("#seo-bb-option-menu").addClass("button-red").removeClass("button-gray"),APP.scoreboard.play_again_option="MENU",APP.scoreboard.showEOGStatus();break;case"seo-sb-next-new-game":switch(APP.session.addSet(),$("#seo-sb-next-game").data("data-option")){case"ALTERNATE":APP.newGame("ALT_SET");break;case"CORK":APP.newGame("CORK");break;case"SELECT":case"MENU":APP.newGame("SELECT")}break;case"seo-sb-new-set":APP.session.isSameGameAgain()?(APP.session.addSet(APP.game.name),APP.newGame("SELECT_SAME_GAME")):(APP.session.addSet(),APP.newGame());break;case"seo-sb-change-game":APP.session.addSet(),APP.newGame();break;case"seo-sb-next-alternate":APP.session.isSameGameAgain()?(APP.session.addSet(APP.game.name),APP.newGame("ALTERNATE_SET_SAME_GAME")):(APP.session.addSet(),APP.newGame("ALTERNATE_SET"));break;case"seo-sb-next-game":switch(APP.session.addSet(APP.session.isSameGameAgain()?APP.game.name:null),$("#seo-sb-next-game").data("data-option")){case"ALTERNATE":APP.newGame(APP.session.isSameGameAgain()?"ALTERNATE_SET_SAME_GAME":"ALTERNATE_SET");break;case"CORK":APP.newGame(APP.session.isSameGameAgain()?"CORK_SAME_GAME":"CORK");break;case"SELECT":case"MENU":APP.newGame(APP.session.isSameGameAgain()?"SELECT_SAME_GAME":"SELECT");break;case"MUGS_AWAY":APP.newGame(APP.session.isSameGameAgain()?"MUGS_AWAY_SET_SAME_GAME":"MUGS_AWAY_SET_SELECT");break;case"MUGS_AWAY_SET_SAME_GAME":APP.newGame("MUGS_AWAY_SET_SAME_GAME");break;case"MUGS_AWAY_SET_SELECT":APP.newGame("MUGS_AWAY_SET_SELECT")}break;case"eom-info":APP.info.show("info-text-eog-options","End of Game Options Menu");break;case"eom-close":APP.popup.hide();break;case"eom-connect":APP.handleMatchOption("bb-e-alley");break;case"eom-screen-saver":APP.popup.hide(),APP.message_bar.showPromo();break;case"message-bar-status":case"bb-g-stats":case"eom-stats":APP.popup.hide(),APP.reveal.is_down?(APP.scoreboard.hideEOGStatus(),$("#eog-stats-panel").css("height",$("#scoreboard").height()).on("scroll",APP.markEvent),$("#bb-g-stats").html("Game"),$("#eom-stats").html("Game"),APP.reveal.showPanel("eog-stats-panel")):(APP.scoreboard.showEOGStatus(),$("#bb-g-stats").html("Stats"),$("#eom-stats").html("Stats"),APP.reveal.hidePanel());break;case"eom-edit":var isBotTurn=!1;try{isBotTurn=APP.game.opponent[APP.game.winning_opponent].isBotTurn(APP.game.active_round)}catch(e){isBotTurn=!1}APP.game.isEOGFinal()||isBotTurn?(APP.device.disableButton("eom-edit"),$("#eom-game-hint").html("Game Saved")):(APP.popup.hide(),APP.game.plugin.cancelEOG());break;case"eom-flag":APP.showGameNoteEditor();break;case"seo-box-1-info":APP.info.show("info-text-next-game","Next Game");break;case"seo-sb-edit-points":APP.session.buildSummary(),APP.session.showSummary(!0);break;case"seo-sb-match-end":APP.nlf.data.rails&&($("#seo-sb-match-end").addClass("button-disabled"),APP.device.showSpinnerOverlay()),APP.session.buildSummary(),APP.session.showSummary(),APP.session.handleMatchScore("pms-save",!0);break;case"seo-menu-switch":APP.user_options.eog_menu_option="BASIC"==APP.user_options.eog_menu_option?"FULL":"BASIC",APP.storeUserOptions(),APP.scoreboard.showEOGStatus();break;case"seo-set-control":if(APP.nlf.data.rails)return void $("#seo-set-control").hide();$("#seo-set-control").data("data-cancel-save")?APP.scoreboard.showEOGStatus({is_set_end:!0,is_match_end:!0}):$("#seo-set-control").html().indexOf("Edit Match Settings")>=0?APP.header.showSetSetup():$("#seo-set-control").data("data-match-end")||$("#seo-set-control").html().indexOf("New Set or End Match")>=0?($("#bb-eg-end-clone").length&&$("#bb-eg-end-clone").show(),APP.scoreboard.showEOGStatus({is_set_end:!0,is_match_end:!1})):APP.scoreboard.showEOGStatus({is_set_end:!1,is_match_end:!1});break;case"eom-abandon-format":APP.popup.hide(),APP.session.setMatchFormat(null),APP.storeState({settings_change:!0,callback:APP.reload});break;case"eom-end-match":if(APP.session.isOnlineBracketMatch()&&(APP.session.killBracket(),APP.exitTournament(!0)),"PARTICIPANT"==APP.device.role)return void(APP.device.has_chalk?(APP.device.showSpinnerOverlay(),APP.device.releaseChalk(!1,APP.exitAlley)):APP.exitAlley());APP.popup.hide(),APP.storeState({settings_change:!0}),"TOURNAMENT"==APP.session.getMatchMode()||APP.session.isPartyPlay()?(APP.session.buildSummary(),APP.session.showSummary(),APP.session.showMatchScore()):(APP.session.buildSummary(),APP.session.showSummary(APP.session.isLeaguePlay()));break;case"eom-match":APP.popup.hide(),APP.session.buildSummary(),APP.session.showSummary()}},handleGuestButtonBarOption:function(in_id){switch(in_id){case"match-control-button":APP.device.confirmTakeChalk();break;case"bb-g-rejoin":"HOST"==APP.device.role&&$("#bb-g-rejoin").text().indexOf("Control")>=0?APP.device.confirmTakeChalk():APP.newGame();break;case"bb-g-exit":APP.exitAlley({show_summary:"PARTICIPANT"==APP.device.role})}},isMatchStale:function(){var last_time=BBAT.fetchData("timestamp");return!last_time||(new Date-new Date(last_time))/6e4>720},isGameStale:function(){return!1},flushSettings:function(){BBAT.flushData("settings_01","settings_cricket","settings_library")},flushState:function(){var key;for(key in window.localStorage)switch(key){case"api_url":case"app_version":case"bracket":case"device_token":case"directory_tournament":case"directory_user":case"intro_last_seen":case"last_login_warning":case"match_description_template":case"mcache":case"no_player_warning":case"other_game":case"promo":case"seen_warning":case"settings_01":case"settings_cricket":case"settings_library":case"tournament_id":case"tournaments":case"user":case"user_options":case"window_name":case"load_check_done":case"reload_bracket":case"reload_bracket_board":case"lobby_data":case"nlf_data":case"exit_lobby":case"updating_host_device":case"vc_vars":case"testbot_data":case"testclick_data":case"prev_error_message":case"advlog_data":case"advlog_logs":case"prev_game_tactics":case"game_postbroadcast":case"send_match_score":case"change_player_set":case"change_player_set_starting_player":case"magiconnect_data":case"qp2_data":case"checkin_data":case"auto_balance":case"starpubs_data":case"keep_alley_open":case"custom_speed_keys":case"tr_seen":case"pr_tooltip_seen":case"pr_seen":case"dc_connect":case"exactbot_data":case"l_open_alley":case"l_err_sent":case"ffwd_data":case"dctv_data":break;default:key.match(/^directory_division_.*/gi)||key.match(/^matches_\d*$/gi)||key.match(/^nsync-.*/gi)||BBAT.flushData(key)}},storeState:function(in_params){var is_server_update=!1;if(APP.markEvent(),!APP.is_reloading){switch((in_params=in_params||{}).settings_change&&APP.device.has_chalk&&(APP.settings_version++,"SERVER"!=APP.game_master||!APP.device.is_hosting&&"PARTICIPANT"!=APP.device.role||(is_server_update=!0,APP.server.setGameSettings({success:in_params.callback,error:in_params.callback}))),APP.mode){case"PRE-ROLE":BBAT.storeData({app_mode:APP.mode,timestamp:new Date});break;case"PRE-GAME":BBAT.storeData({app_mode:APP.mode,timestamp:new Date,user:APP.user,game_master:APP.game_master,device_role:APP.device.role,alley_id:APP.server.alley_id,alley_key:APP.server.alley_key,has_chalk:APP.device.has_chalk,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,spectator_device_key:APP.server.spectator_device_key,participant_device_key:APP.server.participant_device_key,shared_control:APP.server.option.shared_control,game_settings:APP.packageGameSettings()});break;case"IN-GAME":BBAT.storeData({app_mode:APP.mode,timestamp:new Date,game_master:APP.game_master,device_role:APP.device.role,alley_id:APP.server.alley_id,alley_key:APP.server.alley_key,has_chalk:APP.device.has_chalk,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,spectator_device_key:APP.server.spectator_device_key,participant_device_key:APP.server.participant_device_key,shared_control:APP.server.option.shared_control,finish_time:APP.game.finish_time,chalking_opponent:APP.server.chalking_opponent,chalking_round:APP.server.chalking_round,game_settings:APP.packageGameSettings()})}try{APP.nlf.data.rails&&BBAT.storeData({alley_id:APP.server.alley_id,alley_key:APP.server.alley_key,has_chalk:APP.device.has_chalk,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,spectator_device_key:APP.server.spectator_device_key,participant_device_key:APP.server.participant_device_key})}catch(e){}in_params.callback&&!is_server_update&&in_params.callback()}},recordError:function(in_message){newErrorReport(in_message)},processGameSettings:function(in_gs){if(in_gs){if(!APP.is_reloading&&"SERVER"==APP.game_master&&"PRE-GAME"==APP.mode&&in_gs.reload_count>0)return void APP.reload();if(APP.settings_version=in_gs.settings_version,APP.server.game_id=in_gs.game_id,APP.game.reload_count=in_gs.reload_count||0,APP.game.opponent_count=in_gs.opponent_count,APP.game.opponent[0].setTeam(in_gs.team_0,APP.session.getMatchMode()),APP.game.opponent[0].setStartingScore(in_gs.starting_score_0),APP.game.opponent[0].player_tracking=in_gs.player_tracking_0,APP.game.opponent[1].setTeam(in_gs.team_1,APP.session.getMatchMode()),APP.game.opponent[1].setStartingScore(in_gs.starting_score_1),APP.game.opponent[1].player_tracking=in_gs.player_tracking_1,APP.updateSetPlayers(in_gs),APP.header.players_checked_in=in_gs.players_checked_in,BBAT.storeData({players_checked_in:APP.header.players_checked_in}),APP.game_selector.selectGame(in_gs.game_name),APP.game.opponent[0].handicap_marks.length=0,APP.game.opponent[0].handicap_marks=in_gs.handicap_marks_0,APP.game.opponent[1].handicap_marks.length=0,APP.game.opponent[1].handicap_marks=in_gs.handicap_marks_1,"01"==in_gs.game_name){try{if(APP.game.isAutoBalanceActive()){var handicaps=APP.game.calculateAutoBalance();in_gs.handicap_0=handicaps[0],in_gs.handicap_1=handicaps[1]}}catch(e){newErrorReport(e,"Auto Balance Bug",!1)}APP.game.opponent[0].setHandicap(in_gs.handicap_0),APP.game.opponent[1].setHandicap(in_gs.handicap_1)}APP.game.shooting_for_bull=in_gs.shooting_for_bull,APP.game.bull_shoot_winner=in_gs.bull_shoot_winner,APP.game.shot_for_bull=in_gs.shot_for_bull,APP.game.options=in_gs.options,"Cricket"==in_gs.game_name&&(APP.user_options.marksman=in_gs.options.marksman_scoring,BBAT.storeData({user_options:APP.user_options})),APP.device.has_chalk||(APP.game.plugin.storeSettings(),APP.game.plugin.initGamePanel())}},updateSetPlayers:function(in_gs){try{if(!APP.session.isLeaguePlay())return;if("TEAM"==!APP.getMatch().mode)return;var set=APP.getMatch().sets[APP.getMatch().sets.length-1];if(!set)return;for(var teams=set.teams,i=0;i<teams.length;i++){set.teams[i].team_guid||(0==i?in_gs.team_0&&(set.teams[i]=APP.game.cloneTeam(in_gs.team_0),set.chalkboard_names[i]=set.teams[i].chalkboard_name):in_gs.team_1&&(set.teams[i]=APP.game.cloneTeam(in_gs.team_1),set.chalkboard_names[i]=set.teams[i].chalkboard_name))}}catch(e){}},handleCountdownOption:function(in_id){switch(in_id){case"pc-pause":$("#bb-g-rejoin").removeClass("button-gold").addClass("button-green").html("Rejoin Match"),APP.device.enableButton("bb-g-rejoin",!0),APP.live_play_paused=!0,APP.popup.hide("popup-countdown")}},countDown:function(in_sec){window.setTimeout((function(){APP.live_play_paused||(0==in_sec?APP.newGame():(APP.popup.show("popup-countdown","New Game Starting in "+in_sec),APP.countDown(in_sec-1)))}),1e3)},debugCmdSession:function(in_func_name,in_seq,in_cmd,in_data){var lc=sessionStorage.getItem("lc")||0;lc++,sessionStorage.setItem("cmd_"+("000000"+lc).right(6),APP.server.game_id+":"+in_seq+":"+in_func_name+":"+in_cmd+":"+(in_data.code?in_data.code:"")),sessionStorage.setItem("lc",lc)},processGameEvents:function(){var obj,seq,oppo,notes;for(seq=APP.cmd_seq+1,obj=BBAT.fetchData(APP.formatCmd(seq));obj;){try{if(advLog.enabled&&obj){var logObj={type:"PR: "+seq,data:obj.cmd_data};obj.cmd&&(logObj.cmd=obj.cmd),advLog.doLog(logObj)}}catch(e){}switch(APP.cmd_seq=seq,APP.device.has_chalk||(!0!==obj.cmd_data.fast_finish_flights||APP.user_options.fast_finish_flights?!1===obj.cmd_data.fast_finish_flights&&APP.user_options.fast_finish_flights&&(APP.user_options.fast_finish_flights=!1,APP.storeUserOptions()):(APP.user_options.fast_finish_flights=!0,APP.storeUserOptions()),!0!==obj.cmd_data.do_attempts||APP.user_options.do_attempts?!1===obj.cmd_data.do_attempts&&APP.user_options.do_attempts&&(APP.user_options.do_attempts=!1,APP.storeUserOptions()):(APP.user_options.do_attempts=!0,APP.storeUserOptions()),!0!==obj.cmd_data.game_shot||APP.user_options.game_shot?!1===obj.cmd_data.game_shot&&APP.user_options.game_shot&&(APP.user_options.game_shot=!1,APP.storeUserOptions()):(APP.user_options.game_shot=!0,APP.storeUserOptions())),obj.cmd){case"START_GAME":APP.game.start(obj.cmd_data.opponent,new Date(obj.cmd_data.start_time));break;case"GOTO":APP.game.plugin.gotoTurn(obj.cmd_data.turn_id);break;case"KEY":APP.game.plugin.handleUserInput(obj.cmd_data.code,obj.cmd_data.shift_key,!0);break;case"SWAP_OPPONENTS":APP.header.swapOpponents();break;case"SET_PLAYER_ORDER":APP.game.opponent[obj.cmd_data.opponent].loadPlayerOrder(obj.cmd_data.player_order),APP.header.hidePlayerOrderMenu(obj.cmd_data.opponent),APP.header.refresh();break;case"DO_ATTEMPTS":if(void 0===obj.cmd_data.opponent_index)return;if(null===obj.cmd_data.opponent_index)return;APP.game.processDoubleOutAttempts(obj.cmd_data);break;case"BUST_DARTS":if(void 0===obj.cmd_data.opponent_index)return;if(null===obj.cmd_data.opponent_index)return;APP.game.processBustDarts(obj.cmd_data);break;case"HANDICAP":APP.game.plugin.handleRemoteHandicap(obj.cmd_data);break;case"IN_OPTION":APP.game.plugin.handleInOption();break;case"SCORING_OPTION":APP.game.plugin.handleScoringOption&&APP.game.plugin.handleScoringOption();break;case"CANCEL_EOG":APP.game.plugin.cancelEOG(obj.cmd_data.cancel_gsw,BBAT.fetchData(APP.formatCmd(seq+1)));break;case"START_SWD":APP.game.plugin.startSWD(obj.cmd_data.winning_opponent);break;case"FINISH_GAME":var mm=APP.session.getMatchMode(),mf=APP.session.getMatchFormat();if(!mf&&"BASIC GAME"==mm)return APP.newGame("DELETE"),void APP.reload();"TOURNAMENT"!=mm||mf||(obj.cmd_data.is_match_end=!1,obj.cmd_data.is_set_end=!1),notes=APP.session.getGameNotes(),"HOST"!=APP.device.role&&APP.session.loadMatchSummary({payload:obj.cmd_data.match_summary,retain_current_format:!0}),APP.device.has_chalk||APP.scoreboard.showEOGStatus({is_set_end:obj.cmd_data.is_set_end,is_match_end:obj.cmd_data.is_match_end}),void 0!==obj.cmd_data.leg_forfeit&&(APP.game.leg_forfeit=obj.cmd_data.leg_forfeit),APP.game.finish(obj.cmd_data.dart,new Date(obj.cmd_data.finish_time),obj.cmd_data.winning_opponent,BBAT.fetchData(APP.formatCmd(seq+1)),obj),APP.session.setGameNotes(notes),APP.device.is_hosting&&"HOST"==APP.device.role&&!APP.server.isConfGameFinished&&(APP.server.isConfGameFinished=!1,APP.server.confGameFinish(),APP.checkEndOfSet&&(APP.finishEndOfSetReload=!0));break;case"RESET_GAME":return"SERVER"!=APP.game_master||APP.game.finished||"HOST"!==APP.device.role||APP.saveCurrentLegAsError(),APP.server.stopTimer(),APP.goto_new_game=!0,void APP.countDown((APP.game.winning_dart,0))}seq=APP.cmd_seq+1,obj=BBAT.fetchData(APP.formatCmd(seq))}oppo=APP.game.opponent[APP.game.active_opponent],APP.game.started&&APP.device.has_chalk&&oppo.team.players[0]&&oppo.team.players[0].is_bot&&APP.game.plugin.handleUserInput("bot-enter"),APP.finishEndOfSetReload&&(APP.is_reloading=!1)},flushGameEvents:function(){for(var seq=1,key=APP.formatCmd(seq);BBAT.fetchData(key);)BBAT.flushData(key),seq+=1,key=APP.formatCmd(seq);BBAT.flushData("server_settings_version"),APP.server.confirmed_settings_version=0,BBAT.flushData("server_cmd_seq"),APP.server.confirmed_cmd_seq=0},storeGameEvent:function(in_cmd_obj,in_success){var ls_obj={};APP.markEvent(),APP.device.has_chalk||APP.server.chalk_release_timer_id?APP.is_reloading?"function"==typeof in_success&&in_success():(APP.cmd_seq++,ls_obj[APP.formatCmd(APP.cmd_seq)]=in_cmd_obj,ls_obj.timestamp=new Date,BBAT.storeData(ls_obj),"SERVER"==APP.game_master&&APP.device.has_chalk?APP.server.submitGameEvent({cmd_seq:APP.cmd_seq,success:in_success}):"function"==typeof in_success&&in_success()):"function"==typeof in_success&&in_success()},isTimeToFlushUIEvents:function(){var last_time=BBAT.fetchData("timestamp");return!last_time||(new Date-new Date(last_time))/6e4>60},flushUIEvents:function(){for(var seq=1,key=APP.formatUICmd(seq);BBAT.fetchData(key);)BBAT.flushData(key),seq+=1,key=APP.formatUICmd(seq);APP.uicmd_seq=0,BBAT.flushData("uicmd_seq")},storeUIEvent:function(in_cmd_obj){var cmd_key,ls_obj={};APP.uicmd_seq++,cmd_key=APP.formatUICmd(APP.uicmd_seq),in_cmd_obj.time=new Date,in_cmd_obj.cmd_seq=APP.cmd_seq,in_cmd_obj.ui_active=APP.device.ui_active,ls_obj[cmd_key]=in_cmd_obj,ls_obj.uicmd_seq=APP.uicmd_seq,BBAT.storeData(ls_obj),APP.uicmd_seq>50&&BBAT.flushData(APP.formatUICmd(APP.uicmd_seq-50))},listUICmds:function(){for(var uiCmdSeqArr=[],i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(-1!==key.indexOf("__uicmd")){var cmd=JSON.parse(localStorage.getItem(localStorage.key(i)));uiCmdSeqArr[parseFloat(key.replace(/^\D+/g,""))]=cmd}}console.table(uiCmdSeqArr)},listCmds:function(){for(var cmdSeqArr=[],i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(-1!==key.indexOf("__cmd")){var cmd=JSON.parse(localStorage.getItem(localStorage.key(i)));cmdSeqArr[parseFloat(key.replace(/^\D+/g,""))]=cmd}}console.table(cmdSeqArr)},showGuestConnect:function(){APP.guestConnectDisplay(),APP.device.pauseKeyboardHandler(),$("#popup-guest-connect").on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.handleGuestConnect("pgc-continue"),!1):27==e.which?(BBAT.killDOMEvent(e),APP.handleGuestConnect("pgc-close"),!1):void 0})),$("#pgc-participant-input").val(""),APP.popup.show("popup-guest-connect-overlay"),APP.popup.show("popup-guest-connect"),$("#pgc-participant-input").focus()},showOnlineSelector:function(){window.self===window.top&&APP.lobby.isLobbyPermitted()?(APP.popup.show("popup-online-selector-overlay"),APP.popup.show("popup-online-selector"),APP.device.addButtonHandler(["pos-close","pos-dc-only","pos-vc-only","pos-dc-vc"],APP.handleOnlineSelector)):APP.showGuestConnect()},handleOnlineSelector:function(in_id){function closePopup(){APP.popup.hide("popup-online-selector-overlay"),APP.popup.hide("popup-online-selector")}var vcUrl;switch(APP.location){case"test":vcUrl="https://testapp.dartconnect.red/vc/";break;case"train":vcUrl="https://train.app.dartconnect.com/vc/";break;case"live":vcUrl="https://app.dartconnect.com/vc/"}switch(in_id){case"pos-close":closePopup();break;case"pos-dc-only":APP.showGuestConnect();break;case"pos-vc-only":location.href=vcUrl+"#mode=0";break;case"pos-dc-vc":window.open(vcUrl+"#mode=1","_blank")}closePopup()},handleGuestConnect:function(in_id){var code;switch(in_id){case"pgc-close":APP.device.resumeKeyboardHandler(),APP.popup.hide("popup-guest-connect"),APP.popup.hide("popup-guest-connect-overlay"),APP.unblockFeatures(["bb-o-reload","bb-o-connect","oph-bb-library","oph-bb-forfeit","op-right-Pdartbot","op-button-left-add-player","header-score","hdr-score-0","hdr-score-1","bb-e-alley","pss-score"],!0);break;case"pgc-continue":code=$("#pgc-participant-input").val().replace("-",""),APP.server.alley_key=code,APP.server.registerDevice({success:function(){APP.game_master="SERVER",APP.device.has_chalk=!1,APP.changeMode("PRE-GAME"),window.location.reload()},error:function(e){APP.server.alley_key=null,function(e){-1===e.indexOf("Alley already has a PARTICIPANT")?"Key did not fit any open alley on server"!=e?APP.alert.show("Login Failed... Please try again",(function(){$("#pgc-participant-input").focus()}),null,"Connection Notice!"):APP.alert.show("This does not appear to be a valid Online Connect Code.<br /><br /> Please check with the match HOST to confirm the code.",(function(){$("#pgc-participant-input").focus()}),null,"Connection Notice!"):APP.alert.show("DartConnect is unable to connect you with the match HOST.<br /><br /> To resolve this issue, have the HOST cancel the current Online Connect Code and generate a new one to resume this match.",(function(){$("#pgc-participant-input").focus()}),null,"Connection Notice!")}(e)}})}},guestConnectDisplay:function(in_id){switch(in_id){case"pgc-host":APP.handleGuestConnect("pgc-close"),APP.popup.hide("popup-guest-connect"),$("#popup-guest-connect-overlay").hide(0),APP.device.handleRoleSelection("drm-quick-play-online");break;case"pgc-join":$("#pgc-join").addClass("button-disabled"),$("#pgc-host").addClass("hidden"),$("#pgc-connect-code").removeClass("hidden"),$("#pgc-codes").addClass("hidden");break;case"pgc-cancel":$("#pgc-join").removeClass("button-disabled").removeClass("button-down"),$("#pgc-host").removeClass("hidden"),$("#pgc-connect-code").addClass("hidden"),$("#pgc-codes").removeClass("hidden");break;case"pgc-compete-share-button":APP.email({subject:"Compete on DartConnect!",body:"Ready to compete online?\n\r\n\r1) Log into DartConnect\n\r\n\r2) Select 'Guest Connect'\n\r\n\r3) Enter this code:\n\r\n\r"+APP.server.participant_device_key+"\n\r\n\rDon't have your Free Guest Membership yet?\n\r\n\rGet yours today!\n\r\n\r"+APP.getDomain("WEB")});break;case"pgc-open-lobby":APP.popup.hide("popup-guest-connect"),$("#popup-guest-connect-overlay").hide(0),APP.lobby.getLeagues()&&(APP.lobby.data.hasLeagues=!0),APP.lobby.init(1);break;case"pgc-open-league-lobby":APP.popup.hide("popup-guest-connect"),$("#popup-guest-connect-overlay").hide(0),APP.lobby.getLeagues()&&(APP.lobby.data.hasLeagues=!0),APP.lobby.init(8);break;default:$(".pgc-blurb").show(),$("#pgc-join").removeClass("button-disabled"),$("#pgc-join").removeClass("button-down"),$("#pgc-host").removeClass("button-disabled"),$("#pgc-host").removeClass("button-down"),$("#pgc-host").removeClass("hidden"),$("#pgc-join").removeClass("hidden"),$("#pgc-connect-code").addClass("hidden"),$("#pgc-compete-on").addClass("hidden"),$("#pgc-select-game").addClass("hidden"),$("#pgc-compete-code").html("")}"none"===APP.lobby.data.accessLevel&&($("#pgc-host").addClass("button-disabled"),$("#pgc-open-lobby").addClass("button-disabled"))},setConnectMenuControls:function(){$("#pcm-broadcast-off").hide(0),$("#pcm-broadcast-on").hide(0),$(".pcm-broadcast-code").html(""),$(".pcm-compete-code").html(""),$("#pcm-compete-off").hide(0),$("#pcm-compete-on").hide(0),$("#pcm-event-off").hide(0),$("#pcm-event-on").hide(0),$("#pcm-compete-host-button").show(0),$("#pcm-compete-off .pcm-helper-text").addClass("hidden"),APP.device.is_broadcasting?($("#pcm-broadcast-on").show(0),$(".pcm-broadcast-code").html(APP.server.spectator_device_key)):$("#pcm-broadcast-off").show(0),APP.device.is_hosting?(APP.game.started&&!APP.device.has_chalk?APP.device.enableButton("pcm-compete-host-chalk-button",!0):APP.device.disableButton("pcm-compete-host-chalk-button"),$(".pcm-compete-code").html(APP.server.participant_device_key),$("#pcm-compete-on").show(0)):APP.game.isBotPlaying()||APP.header.roster_right&&APP.header.roster_right.hasBotPlayer()||($("#pcm-compete-off").show(0),APP.game.started?(APP.device.disableButton("pcm-compete-host-button"),$("#pcm-compete-host-button").hide(),$("#pcm-compete-off .pcm-helper-text").removeClass("hidden")):(APP.device.enableButton("pcm-compete-host-button",!0),$("#pcm-compete-host-button").show())),!APP.session.isBracketPrescribedMatch()||APP.game.isBotPlaying()||APP.header.roster_right&&APP.header.roster_right.hasBotPlayer()||($("#pcm-compete-off").show(0),APP.game.started?(APP.device.disableButton("pcm-compete-host-button"),$("#pcm-compete-host-button").hide(),$("#pcm-compete-off .pcm-helper-text").removeClass("hidden")):(APP.device.enableButton("pcm-compete-host-button",!0),$("#pcm-compete-host-button").show()))},showCloseConnection:function(){$(".pcc-option").removeClass("pcc-option-on"),APP.device.is_broadcasting?(APP.device.enableButton("pcc-continue-broadcast"),"TOURNAMENT"==APP.session.getMatchMode()?$("#pcc-continue-broadcast").addClass("pcc-option-on"):$("#pcc-continue-broadcast").removeClass("pcc-option-on")):APP.device.disableButton("pcc-continue-broadcast"),APP.device.is_hosting?(APP.device.enableButton("pcc-continue-hosting"),$("#pcc-continue-hosting").removeClass("pcc-option-on")):APP.device.disableButton("pcc-continue-hosting"),$("#popup-close-connection-overlay").show(0),$("#popup-close-connection").show(0)},handleCloseConnection:function(in_id){var stop_b,stop_h,is_b,is_h;function closeMenu(in_exit_alley){$("#popup-close-connection").hide(0),$("#popup-close-connection-overlay").hide(0),in_exit_alley&&APP.exitAlley({new_match_mode:!0})}switch(in_id){case"pcc-close":closeMenu();break;case"pcc-continue-broadcast":$("#pcc-continue-broadcast").toggleClass("pcc-option-on");break;case"pcc-continue-hosting":$("#pcc-continue-hosting").toggleClass("pcc-option-on");break;case"pcc-continue":stop_b=!$("#pcc-continue-broadcast").hasClass("pcc-option-on"),stop_h=!$("#pcc-continue-hosting").hasClass("pcc-option-on"),is_b=APP.device.is_broadcasting,is_h=APP.device.is_hosting,!stop_b&&is_b||!stop_h&&is_h?stop_b?APP.handleAlleyOption("pcm-broadcast-end-button",(function(){closeMenu(!0)})):stop_h?APP.handleAlleyOption("pcm-disconnect-host-button",(function(){closeMenu(!0)})):closeMenu(!0):(APP.revertToLocalPlay(),APP.server.closeAlley({success:function(){closeMenu(!0)},error:function(){closeMenu(!0)}}))}},handleAlleyOption:function(in_id,in_callback,in_error_callback){function closeMenu(){"PRE-ROLE"==APP.mode?($("#popup-connect-menu-overlay").hide(0),APP.popup.hide("popup-connect-menu"),APP.storeState()):(APP.chalkboard.unshield(),$("#popup-connect-menu-overlay").hide(0),APP.popup.hide("popup-connect-menu"),APP.reveal.setChalkButton(),APP.storeState(),"none"!=$("#opponents-panel").css("display")&&APP.header.refreshOpponentsPanel())}function openAlley(in_open_call_id,in_success,in_error){var fail_msg,requesting_broadcast=in_open_call_id.indexOf("broadcast")>=0;fail_msg="Unable to connect to the DartConnect Server. Your match will not be broadcast on DCTV. Check your WiFi and use the Connect Menu to try again later.",APP.server.openAlley({requesting_broadcast:requesting_broadcast,callback:function(in_status,in_text){if("OK"==in_status)APP.game_master=in_open_call_id.indexOf("broadcast")>=0?"DEVICE":"SERVER",APP.device.role="HOST",APP.server.startTimer("SEND"),in_success();else{if(in_text){if(in_text.indexOf("already open")>=0)return void APP.confirm.show({title:"Connection Notice!",msg:"You have connections open on<br />another device/session.<br />Do you want to force them closed?",ok_text:"Yes, Close Them",cancel_text:"No, Leave Them Open",ok:function(){APP.server.closeAlley({force_close:!0,success:function(){APP.handleAlleyOption(in_open_call_id)}})}});in_text.indexOf("No alleys available")>=0?(closeMenu(),APP.alert.show("Due to high demand, on-line match play and DCTV broadcasting are unavailable. Please try again shortly. This does NOT affect in-person or computer play.",null,null,"Connection Notice!")):(closeMenu(),APP.alert.show('An unexpected error has occurred<br /> Please try again later or email <a href="mailto:customerservice@dartconnect.com">customerservice@dartconnect.com</a>',null,null,"Connection Notice!"))}else{if(in_error)if("function"==typeof in_error)return in_error(),APP.isOffline()||closeMenu(),APP.revertToLocalPlay(),void APP.reveal.setChalkButton();APP.isOffline()||(closeMenu(),APP.alert.show(fail_msg))}APP.revertToLocalPlay(),APP.reveal.setChalkButton()}}})}function closeAlley(){APP.revertToLocalPlay(),APP.server.closeAlley(),closeMenu()}switch("pcm-compete-host-chalk-button"==in_id&&advLog.doLog({type:"Take Control",code:APP.device.is_hosting?"Host":"Guest"}),in_id){case"pcm-close-button":closeMenu();break;case"pcm-info-button":APP.info.show("info-text-connect","Connect Options");break;case"pcm-continue-button":if(closeMenu(),!APP.was_hosting&&APP.device.is_hosting){if(APP.starpubs.isStarPubsMatch())return void(APP.starpubs.checkLineUpsComplete()||(APP.starpubs.data.match.home.lineup=[],APP.starpubs.data.match.home.confirmed=!1,APP.starpubs.data.match.away.lineup=[],APP.starpubs.data.match.away.confirmed=!1,APP.starpubs.save(),APP.starpubs.showSelectPlayers()));APP.session.isBracketPrescribedMatch()||APP.header.startOpponentChange(!0)}break;case"pcm-broadcast-start-button":APP.device.is_hosting?(APP.device.is_broadcasting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.reveal.updateDCTVKey(),APP.message_bar.promo.active&&APP.session.isNewMatch()&&APP.message_bar.showPromo(null,null,null,!1,!0)):openAlley(in_id,(function(){APP.device.has_chalk=!0,APP.device.is_broadcasting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.reveal.updateDCTVKey(),APP.message_bar.promo.active&&APP.session.isNewMatch()&&APP.message_bar.showPromo(null,null,null,!1,!0),APP.game.started&&APP.game.initGameBroadcast(),in_callback&&"function"==typeof in_callback&&in_callback()}),in_error_callback);break;case"pcm-broadcast-share-button":APP.email({subject:"Watch me on DartConnect TV",body:"I'm getting ready to play DartConnect and you can follow my game online.\n\r\n\rMy Connect Code is:\n\r\n\r"+APP.server.spectator_device_key+"\n\r\n\rEnter this code at DartConnect TV:\n\r\n\r"+APP.getDomain("TV")+"\n\r\n\r\n\rHave you experienced DartConnect?\n\r\n\rFind out how you can Score, Track, and Connect to take your game to the next level.\n\r\n\r"+APP.getDomain("WEB")+"\n\r\n\rPerfect Your Game"});break;case"pcm-broadcast-end-button":try{APP.nlf.data.railsRetry&&(APP.nlf.data.railsRetry=!1,APP.nlf.save())}catch(e){}var save_reveal_back=APP.reveal.getBackButtonOption();APP.server.spectator_device_key="",APP.device.is_broadcasting=!1,APP.storeState(),APP.setConnectMenuControls(),APP.reveal.updateDCTVKey(),APP.device.is_hosting?APP.server.updateAlleyKey({key_type:"SPECTATOR",quietly:!0,callback:function(in_status){"OK"==in_status&&APP.storeState(),APP.reveal.setBackButton(save_reveal_back),"function"==typeof in_callback&&in_callback()}}):(closeAlley(),APP.reveal.setBackButton(save_reveal_back));break;case"pcm-compete-host-button":APP.device.is_broadcasting?(APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.game_master="SERVER",APP.storeState(),APP.setConnectMenuControls(),APP.server.startTimer("SEND")):openAlley("pcm-compete-host-button",(function(){APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.storeState(),APP.setConnectMenuControls(),$("#pcm-compete-host-button").hide()}));break;case"pcm-compete-host-chalk-button":APP.device.confirmTakeChalk();break;case"pcm-compete-share-button":APP.email({subject:"Compete on DartConnect!",body:"Ready to compete online?\n\r\n\r1) Log into DartConnect\n\r\n\r2) Select 'Guest Connect'\n\r\n\r3) Enter this code:\n\r\n\r"+APP.server.participant_device_key+"\n\r\n\rDon't have your Free Guest Membership yet?\n\r\n\rGet yours today!\n\r\n\r"+APP.getDomain("WEB")});break;case"pcm-disconnect-host-button":APP.device.is_broadcasting?(APP.game_master,APP.server.participant_device_key="",APP.device.is_hosting=!1,APP.device.has_chalk=!0,APP.storeState(),APP.setConnectMenuControls(),$("#pcm-compete-host-button").show(),APP.device.enableButton("pcm-compete-host-button"),APP.server.updateAlleyKey({key_type:"PARTICIPANT",quietly:!0,callback:function(in_status){"OK"==in_status&&APP.storeState(),"function"==typeof in_callback&&in_callback()}})):closeAlley()}},handleEOGOption:function(in_id){switch(APP.popup.hide("popup-eog"),in_id){case"peog-close":APP.chalkboard.unshield();break;case"peog-newgame":APP.newGame();break;case"peog-swd":APP.chalkboard.unshield(),APP.game.plugin.cancelEOG()}},eosAutoForward:!1,eosTournaments:["dutchopen23"],attemptEOSAutoForward:function(){APP.eosAutoForward&&(-1!==APP.eosTournaments.indexOf(APP.session.getTournamentID())&&window.setTimeout((function(){APP.handleEOGMenuOption("seo-sb-next-game")}),1e3),APP.ffwd.isActive&&window.setTimeout((function(){APP.handleEOGMenuOption("seo-sb-next-game")}),100))},attemptEOGAutoForward:function(){if(APP.session.isSetDone())return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;if(APP.scoreboard.isCorkLastLeg()&&APP.session.isDecidingLeg())return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;var mf=APP.session.getMatchFormat();if(APP.session.isSameGameAgain())switch(mf.next_game){case"ALTERNATE":case"ALTERNATE_SAME_GAME":APP.newGame("ALTERNATE_SAME_GAME");break;case"MUGS_AWAY":"PER-MATCH"==mf.same_game||"PER-SET"==mf.same_game?APP.newGame("MUGS_AWAY_SAME_GAME"):APP.newGame("MUGS_AWAY");break;case"MUGS_AWAY_SAME_GAME":APP.newGame("MUGS_AWAY_SAME_GAME");break;case"CORK":"PER-MATCH"==mf.same_game||"PER-SET"==mf.same_game?APP.newGame("CORK_SAME_GAME"):APP.newGame("CORK");break;case"MENU":return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;default:APP.newGame("SELECT")}else switch(mf.next_game){case"ALTERNATE":APP.newGame("ALTERNATE");break;case"MUGS_AWAY":APP.newGame("MUGS_AWAY");break;case"CORK":APP.newGame("CORK");break;case"MENU":return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;default:APP.newGame("SELECT")}},forceEOGAutoForward:function(){var mf=APP.session.getMatchFormat();if(APP.session.isSameGameAgain())switch(mf.next_game){case"ALTERNATE":case"ALTERNATE_SAME_GAME":APP.newGame("ALTERNATE_SAME_GAME");break;case"MUGS_AWAY":"PER-MATCH"==mf.same_game||"PER-SET"==mf.same_game?APP.newGame("MUGS_AWAY_SAME_GAME"):APP.newGame("MUGS_AWAY");break;case"MUGS_AWAY_SAME_GAME":APP.newGame("MUGS_AWAY_SAME_GAME");break;case"CORK":"PER-MATCH"==mf.same_game||"PER-SET"==mf.same_game?APP.newGame("CORK_SAME_GAME"):APP.newGame("CORK");break;case"MENU":return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;default:APP.newGame("SELECT")}else switch(mf.next_game){case"ALTERNATE":APP.newGame("ALTERNATE");break;case"MUGS_AWAY":APP.newGame("MUGS_AWAY");break;case"CORK":APP.newGame("CORK");break;case"MENU":return APP.scoreboard.eolOverlayOff(),APP.alert.hide(),!1;default:APP.newGame("SELECT")}},cleanEmail:function(in_email){return in_email.replace("@","")},handleResetGameOption:function(in_id){function done(){APP.popup.hide("popup-reset-game"),APP.chalkboard.unshield()}switch(advLog.doLog({type:"Reset Game",code:in_id}),in_id){case"prg-info":APP.info.show("info-text-end-game","End Game");break;case"prg-close":done();break;case"prg-opponent-0":case"prg-opponent-1":done(),APP.confirm.show({title:"Player Wins",msg:'<p>This will award a leg win to the player and <span class="text-bold">SAVE</span> both player\'s game data for this leg.</p>',ok:function(){APP.game.winning_opponent=APP.extractLastNumberSegment(in_id),APP.game.sudden_death_win=!0,APP.game.finish(3)}});break;case"prg-opponentff-0":case"prg-opponentff-1":done(),APP.confirm.show({title:"Forfeit Leg",msg:'<p>This will award a forfeit leg win to the opponent and <span class="text-bold">DELETE</span> both player\'s game data for this leg.</p>',ok:function(){var forfeiter=APP.extractLastNumberSegment(in_id);forfeiter=0==forfeiter?1:0,APP.game.winning_opponent=forfeiter,APP.game.sudden_death_win=!0,APP.game.leg_forfeit=forfeiter,APP.game.finish(3)}});break;case"prg-delete":done(),APP.confirm.show({msg:"This will erase the current game&apos;s data!<br />This cannot be undone.<br />Continue?",ok:function(){APP.newGame("DELETE")}})}},resetGame:function(){APP.game.finished&&APP.device.has_chalk&&!APP.is_reloading?APP.popup.show("popup-eog"):"IN-GAME"==APP.mode&&APP.device.has_chalk&&!APP.is_reloading&&APP.game.started_scoring?($("#prg-opponent-0").html(APP.game.opponent[0].getChalkboardName()+" wins"),$("#prg-opponent-1").html(APP.game.opponent[1].getChalkboardName()+" wins"),$("#prg-opponentff-0").html("Forfeit "+APP.game.opponent[0].getChalkboardName()),$("#prg-opponentff-1").html("Forfeit "+APP.game.opponent[1].getChalkboardName()),APP.game.plugin.is_edit_mode?(APP.device.disableButton("prg-opponent-0"),APP.device.disableButton("prg-opponent-1"),APP.device.disableButton("prg-opponentff-0"),APP.device.disableButton("prg-opponentff-1")):(APP.device.enableButton("prg-opponent-0"),APP.device.enableButton("prg-opponent-1"),APP.device.enableButton("prg-opponentff-0"),APP.device.enableButton("prg-opponentff-1")),0==APP.game.reload_count?APP.device.enableButton("prg-delete",!0):APP.device.disableButton("prg-delete"),APP.popup.show("popup-reset-game"),isSolo501()&&($(".prg-header").hide(),$("#prg-opponent-0").hide(),$("#prg-opponent-1").hide(),$("#prg-opponentff-0").hide(),$("#prg-opponentff-1").hide())):APP.newGame("DELETE")},reload:function(update){update&&BBAT.flushData("load_check_done"),location.reload()},kickDeviceOut:function(msg){$("#emergency-exit").hide();msg=msg||"Opponent has left the match.";BBAT.flushData("prev_game_tactics"),"HOST"==APP.device.role?(APP.is_reloading=!1,APP.revertToLocalPlay(),BBAT.fetchData("reload_bracket")||APP.alert.show(msg,APP.reload,null,"Connection Notice!")):(APP.session.buildSummary(),APP.session.showSummary(),APP.device.disableButton("pss-close"),APP.device.enableButton("pss-exit",!0),APP.device.has_chalk=!1,APP.server.stopTimer(),APP.chalkboard.shield(),APP.flushGameEvents(),APP.flushState(),APP.changeMode("PRE-ROLE"),APP.session.isOnlineBracketMatch(!0)&&APP.game.finished?APP.session.startAutoExit():BBAT.fetchData("reload_bracket")||APP.alert.show(msg,null,null,"Connection Notice!"))},emergencyExit:function(){$("#emergency-exit").hide(),BBAT.flushData("prev_game_tactics"),"HOST"==APP.device.role?(APP.is_reloading=!1,APP.revertToLocalPlay(),BBAT.fetchData("reload_bracket")):(APP.session.buildSummary(),APP.session.showSummary(),APP.device.disableButton("pss-close"),APP.device.enableButton("pss-exit",!0),APP.device.has_chalk=!1,APP.server.stopTimer(),APP.chalkboard.shield(),APP.flushGameEvents(),APP.flushState(),APP.changeMode("PRE-ROLE"),APP.session.isOnlineBracketMatch(!0)&&APP.game.finished?APP.session.startAutoExit():BBAT.fetchData("reload_bracket")),APP.reload()},newGame:function(in_option){APP.device.showSpinnerOverlay(),advLog.doLog({type:"New Game",code:in_option}),advLog.completeLog();APP.session.getMatchFormat();var last_set_winner,next_set_starter,gs=BBAT.fetchData("game_settings");if("DELETE"==in_option)!0,APP.session.isNewMatch()&&"O"==APP.session.getMatchBroadcastStatus()&&APP.session.setMatchBroadcastStatus("W");else if(APP.game.started_scoring&&!APP.game.finished){var deviceText="HOST";APP.device.is_hosting||(deviceText="GUEST");blockerErrorReport("Null Legs Bug | "+deviceText,(function(){APP.session.addGameResults({abandoned:!0,start_time:APP.game.start_time,ending_scores:[APP.game.opponent[0].current_score,APP.game.opponent[1].current_score],game_name:APP.game.getGameName(),game_type:APP.game.name,starting_opponent:APP.game.opponent_order[0],starting_scores:[APP.game.opponent[0].starting_score,APP.game.opponent[1].starting_score],three_da:[null,null],winning_opponent:null,rounds_played:APP.game.opponent[0].turn.length,track_do_attempts:APP.user_options.do_attempts,game:APP.game})}))}if("SERVER"==APP.game_master&&(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)&&APP.device.has_chalk&&APP.game.finished&&APP.server.squeue.GAME.length>0)setTimeout((function(){APP.newGame(in_option)}),1e3);else{if(APP.device.hideSpinnerOverlay(!0),$("#game-selector").text(""),APP.flushGameEvents(),APP.settings_version=APP.device.has_chalk?1:0,APP.server.game_id=null,APP.game.reload_count=0,APP.game.setShootForBull(!1,!0),in_option&&BBAT.storeData({shortcut:in_option}),APP.game.isBotPlaying(!0)&&!APP.is_reloading&&null!=APP.game.winning_opponent){var p=APP.game.opponent[1].team.players[0];0==APP.game.winning_opponent?p.bot_skill=APP.dartbot.promoteSkill(p.bot_skill):p.bot_skill=APP.dartbot.demoteSkill(p.bot_skill),APP.storeState()}switch(in_option){case"SELECT_SAME_GAME":case"CORK_SAME_GAME":case"MUGS_AWAY_SAME_GAME":case"ALTERNATE_SAME_GAME":case"ALTERNATE_SET_SAME_GAME":APP.game_selector.selectGame(APP.game.name,gs.options);break;case"SELECT":case"CORK":default:APP.game_selector.selectGame();break;case"MUGS_AWAY_SET_SAME_GAME":-1!==(last_set_winner=APP.session.getLastSetWinner())&&(next_set_starter=1,last_set_winner&&(next_set_starter=0),APP.game.setBullShootWinner(next_set_starter)),APP.game_selector.selectGame(APP.game.name,gs.options);break;case"MUGS_AWAY_SET_SELECT":-1!==(last_set_winner=APP.session.getLastSetWinner())&&(next_set_starter=1,last_set_winner&&(next_set_starter=0),APP.game.setBullShootWinner(next_set_starter)),APP.game_selector.selectGame()}$("#chalk-overlay").fadeIn(150),APP.changeMode("PRE-GAME"),APP.device.has_chalk&&(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)?APP.server.setGameSettings({spinner:!0,show_network_message:!0,success:APP.reload,error:APP.reload}):APP.reload()}},exit_password_test:null,showExitPassword:function(){APP.exit_password_test=null,APP.device.pauseKeyboardHandler(),$("#popup-password").on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.handleExitPassword("pp-ok"),!1):27==e.which?(BBAT.killDOMEvent(e),APP.handleExitPassword("pp-cancel"),!1):void 0})),$("#pp-message").hide(0),$("#popup-password").show(0),$("#pp-password").val("").focus()},handleExitPassword:function(in_id){function closeMenu(){$("#pp-password").val("").blur(),$("#popup-password").hide(0),APP.device.resumeKeyboardHandler()}switch(in_id){case"pp-cancel":closeMenu();break;case"pp-ok":var p=$("#pp-password").val();"TOURNAMENT"==APP.session.getMatchMode()&&APP.user.tx&&APP.cheapHash(p)==APP.user.hash||!APP.user.tx&&"monkey1"==p?(APP.exit_password_test="PASSED",closeMenu()):($("#pp-message").show(0),$("#pp-password").val("").focus())}},exitAlley:function(in_params){function doit(){if(APP.flushState(),APP.flushSettings(),BBAT.flushData("no_player_warning"),APP.session.isOnlineBracketMatch())return"HOST"==APP.device.role&&(BBAT.flushData("bracket"),APP.header.killTempPlayers(),APP.header.resetDirectory(),BBAT.flushData("directory_tournament")),APP.changeMode("PRE-ROLE"),APP.session.startNew("BASIC GAME"),APP.message_bar.turnOffPromo(),void finish();try{"TOURNAMENT"!=APP.session.getMatchMode()||in_params.new_match_mode?("HOST"==APP.device.role&&(BBAT.flushData("bracket"),APP.header.killTempPlayers(),APP.header.resetDirectory(),BBAT.flushData("directory_tournament")),APP.changeMode("PRE-ROLE"),APP.session.startNew("BASIC GAME"),APP.message_bar.turnOffPromo(),finish()):(APP.changeMode("PRE-GAME"),APP.session.tournament_id=APP.session.getTournamentID(),APP.session.startNew("TOURNAMENT"),BBAT.flushData("game_settings"),APP.server.getTournamentPlayers({spinner:!0,tournament_id:APP.session.getTournamentID(),on_success:function(in_players){APP.header.loadTournamentDirectory(in_players),finish()},on_error:function(){finish()}}))}catch(e){finish()}}function finish(){if(BBAT.flushData("updating_host_device"),APP.session.isOnlineBracketMatch())return APP.server.game_id=null,void APP.reload();APP.device.is_broadcasting||APP.device.is_hosting?(APP.server.game_id=null,BBAT.storeData({keep_alley_open:!0,game_id:APP.server.game_id,alley_id:APP.server.alley_id,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,participant_device_key:APP.server.participant_device_key,spectator_device_key:APP.server.spectator_device_key}),APP.device.has_chalk?APP.device.is_hosting?(BBAT.storeData({has_chalk:APP.device.has_chalk}),APP.server.setGameSettings({spinner:!0,show_network_message:!0,success:APP.reload,error:APP.reload})):APP.reload():APP.server.takeChalk({success:function(){BBAT.storeData({has_chalk:APP.device.has_chalk}),APP.server.setGameSettings({spinner:!0,show_network_message:!0,success:APP.reload,error:APP.reload})}})):APP.reload()}if((in_params=in_params||{}).show_summary&&APP.session.matches.length)return APP.session.setDefaultMatchScore(!0),APP.session.buildSummary(),"PARTICIPANT"==APP.device.role&&APP.device.enableButton("pss-exit",!0),void APP.session.showSummary();APP.device.is_hosting||APP.device.is_broadcasting?(APP.device.is_broadcasting&&APP.server.postBroadcast({other_data:{match_over:!0}}),"TOURNAMENT"==APP.session.getMatchMode()?doit():(APP.revertToLocalPlay(),APP.server.closeAlley({success:function(){doit()},error:function(){doit()}}))):doit()},logoutMember:function(in_forced){var sync_pending=APP.server.hasPendingFinishedGames(!0)||APP.server.hasPendingFinishedMatches(!0);function doIt(){var key;for(key in WS.close(),APP.user_options.offline=!1,APP.storeUserOptions(),window.localStorage)switch(key){case"app_version":case"device_token":case"window_name":break;default:key.match(/^matches_\d*$/gi)||BBAT.flushData(key)}APP.server.logoutMember({member_id:APP.user.member_id}),"SERVER"==APP.game_master&&"HOST"==APP.device.role?(APP.revertToLocalPlay(),APP.server.closeAlley(),setTimeout(APP.reload,2e3)):APP.reload()}in_forced?doIt():APP.confirm.show({msg:sync_pending?"FYI... Match data still needs to be synced to the DartConnect server.<br />Please connect to the Internet at your earliest opportunity to finish syncing.":"Logout?<br />&nbsp;<br />WiFi is required to log back in and download your player library.",ok:doIt})},reset:function(){var key,go_ahead=!0;if((APP.server.hasPendingFinishedGames(!0)||APP.server.hasPendingFinishedMatches(!0))&&(go_ahead=confirm("WARNING!\nGame data has NOT been synced.\nResetting the app will result is data loss.\nContinue?")),go_ahead&&confirm("This will RESET the app...\nMake sure you have a good Internet Connection.\nAny data not synced to the server will be LOST.")){for(key in"SERVER"==APP.game_master&&"HOST"==APP.device.role&&(APP.revertToLocalPlay(),APP.server.closeAlley()),window.localStorage)switch(key){case"app_version":case"directory_user":case"user":case"window_name":break;default:key.match(/^directory_division_.*/gi)||BBAT.flushData(key)}location.replace("installer.html")}},noZero:function(in_number){return"0."==(""+in_number).left(2)?(""+in_number).substr(1):in_number},extractSegment:function(in_str,in_segment,in_delim){var ar;return in_segment<=(ar=in_str.split(in_delim)).length?ar[in_segment-1]:null},extractFirstNumberSegment:function(in_str){return parseInt(in_str.match(/\d+/).toString(),10)},extractLastNumberSegment:function(in_str){return parseInt(in_str.match(/\d+$/).toString(),10)},extractLastSegment:function(in_str){return in_str.substr(in_str.lastIndexOf("-")+1)},formatCmd:function(in_seq){return"__cmd_"+("0000"+in_seq).right(4)},formatUICmd:function(in_seq){return"__uicmd_"+("000000"+in_seq).right(6)},changeMode:function(in_mode){APP.mode=in_mode,APP.storeState()},packageAttempted:!1,packageGameSettings:function(){if(APP.isRevertingToLocal&&!APP.packageAttempted&&!APP.game.name)try{APP.packageAttempted=!0,APP.processGameSettings(BBAT.fetchData("game_settings"))}catch(e){return void APP.reveal.handleButtons("reveal-exit")}var gn=APP.game.name,oppo_0=APP.game.opponent[0],oppo_1=APP.game.opponent[1];if(!APP.is_reloading&&APP.device.is_broadcasting){gn=APP.game.name?$("#gsp-settings-title").html():"";"Cricket"==APP.game.name&&"Cricket"!=gn&&(gn+=" Cricket"),APP.game.finished&&APP.message_bar.refreshStatusMessage()}return{game_id:APP.server.game_id,reload_count:APP.game.reload_count,shooting_for_bull:APP.game.shooting_for_bull,bull_shoot_winner:APP.game.bull_shoot_winner,shot_for_bull:APP.game.shot_for_bull,settings_version:APP.settings_version,game_name:APP.game.name,opponent_count:APP.game.opponent_count,team_0:oppo_0.getTeam(),player_tracking_0:oppo_0.player_tracking,starting_score_0:oppo_0.getStartingScore(),handicap_marks_0:"Cricket"==gn&&oppo_0.handicap_marks?oppo_0.handicap_marks.slice(0):[],handicap_0:"01"==gn?oppo_0.getHandicap():0,team_1:oppo_1.getTeam(),player_tracking_1:oppo_1.player_tracking,starting_score_1:oppo_1.getStartingScore(),handicap_marks_1:"Cricket"==gn&&oppo_1.handicap_marks?oppo_1.handicap_marks.slice(0):[],handicap_1:"01"==gn?oppo_1.getHandicap():0,players_checked_in:APP.header.players_checked_in||!1,options:APP.game.options}},exitTournament:function(noReload){APP.user_options.tournament_mode=null,APP.user_options.tournament_leg_max=null,APP.user_options.tournament_leg_mode=null,APP.user_options.tournament_set_mode=null,APP.user_options.tournament_set_limit=null,APP.user_options.tournament_next_game=null,APP.user_options.tournament_next_game_options=null,APP.user_options.tournament_same_game=null,APP.user_options.tournament_same_legs=null,APP.user_options.floating_set_score=!1,APP.storeUserOptions(),noReload?APP.session.bracket=null:(APP.userOptions.restoreFromBackup(),APP.exitAlley({new_match_mode:!0})),APP.message_bar.resetPromo()},flushTournaments:function(){BBAT.flushData("tournaments"),APP.session.tournaments={}},handleMatchOption:function(in_id){switch(in_id){case"bb-e-new-players":APP.header.startOpponentChange("",!0);break;case"bb-e-reload":"HOST"==APP.device.role?APP.confirm.show({msg:"Reload/Replay the Prior Leg?",ok:APP.session.reloadPriorLeg}):APP.popup.show("popup-notify","To access prior leg, have the host device control the match",8e3,.95);break;case"bb-e-new-match":if(APP.session.isNewMatch()){if("TOURNAMENT"==APP.session.getMatchMode()){if(APP.user.tx&&"PASSED"!=APP.exit_password_test)return void APP.showExitPassword();var tournamentName="";try{tournamentName=':<br /><span class="text-bold">'+APP.session.tournaments[APP.session.getTournamentID()].promo_line_1+"</span>"}catch(e){}return void APP.confirm.show({msg:"Exit Tournament"+tournamentName+"?",ok_text:"Yes",cancel_text:"No",ok:function(){APP.session.resetBracketBoard(),APP.server.alley_id&&(APP.server.closeAlley(),APP.revertToLocalPlay()),APP.exitTournament();APP.session;var cMatch=APP.getMatch();if(cMatch&&cMatch.tournament_id&&0==cMatch.game_time)try{BBAT.flushData("matches_"+APP.session.current_match)}catch(e){}}})}if(APP.session.bracket&&(APP.exitTournament(!0),BBAT.flushData("bracket"),APP.server.alley_id&&(APP.server.closeAlley(),APP.revertToLocalPlay())),APP.nlf.data.rails)return APP.nlf.rails.earlySetExit(),APP.nlf.rails.saveOnlineState(),void APP.reload();APP.exitAlley({new_match_mode:!0})}else"TOURNAMENT"==APP.session.getMatchMode()?(APP.session.setDefaultMatchScore(!0),APP.session.buildSummary(),APP.session.showSummary(),APP.session.showMatchScore()):(APP.session.setDefaultMatchScore(!0),APP.session.buildSummary(),APP.session.showSummary(!0));break;case"bb-e-alley":if($("#bb-e-alley").hasClass("button-alternate-function"))APP.alert.show("Go Pro!");else{APP.setConnectMenuControls(),APP.was_hosting=APP.device.is_hosting,$(".pcm-broadcast-wrap").show();var league=APP.session.getCurrentLeague();league&&"N"==league.can_broadcast&&$(".pcm-broadcast-wrap").hide(0),$("#popup-connect-menu-overlay").show(0),$("#popup-connect-menu").show(0)}}},saveCurrentLegAsError:function(reason){reason||(reason="Leg was forwarded before finishing");try{var matches=APP.session.matches,cMatch=matches[matches.length-1],i=matches.length-1,sets=cMatch.sets,games=sets[sets.length-1].games,cGame=games[games.length-1],errorData={timestamp:(new Date).valueOf(),server_error:reason,leg:cGame,server_down:!1,set_count:sets.length-1,leg_count:games.length-1};cMatch.error_legs.push(errorData),APP.session.store(i)}catch(e){}},getApi2Url:function(){switch(this.location){case"test":switch(location.host.split(".")[0]){case"local":return"/_api2_/"}return"https://testapi2.dartconnect.red/api/app/";case"train":case"train":return"https://train.api2.dartconnect.com/api/app/";case"live":default:return"https://api2.dartconnect.com/api/app/"}},x01Settings:{init:function(pageNo){this.flowData.pageNo=pageNo||"x01Settings",this.flow=new UIFlow(this.flowData)},flow:null,gameStart:null,gameEnd:null,startingScore:null,customStartingScore:null,flowData:{name:"x01Settings",pageNo:"x01Settings",usePageNames:!0,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{x01Settings:{hideFooter:!1,hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t\t\t<div id=\'qp2-game-mode\'>\n\t\t\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t\t\t<h4 class="header mNoneTop mMdBottom">Game Start</h4>\n\t\t\t\t\t\t\t\t\t<div id="x01-settings-game-start"></div>\n\n\t\t\t\t\t\t\t\t\t<h4 class="header mNoneTop mMdBottom">Game End</h4>\n\t\t\t\t\t\t\t\t\t<div id="x01-settings-game-end"></div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t\t\t<h4 class="header mNoneTop mMdBottom">Starting Score</h4>\n\t\t\t\t\t\t\t\t\t<div id="x01-starting-score"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'},addFooter:function(scope){scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t\t<table class="footer-table" width="100%" align="center">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tid="x01-save-settings"\n\t\t\t\t\t\t\t\t\t\t\tclass="button button-md button-green round-corners img-center"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tContinue\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t'),APP.fns.activateBtn(["x01-save-settings"],(function(){APP.x01Settings.fns.applyCustomMatch(),APP.x01Settings.flow.exit()}))},init:function(scope){this.addFooter(scope),APP.x01Settings.gameStart=new RadioList({ele:"#x01-settings-game-start",opts:[{content:"Straight In",name:"straight-in",active:!0},{content:"Double In",name:"double-in",active:!1},{content:"All Players Double In",name:"all-players-double-in",active:!1}],callbacks:{selected:function(scope,r){},deselected:function(r){}}}),APP.x01Settings.gameEnd=new RadioList({ele:"#x01-settings-game-end",class:"mSmBottom",opts:[{content:"Double Out",name:"double-out",active:!0},{content:"Straight Out",name:"straight-out",active:!1},{content:"Master Out",name:"master-out",active:!1}],callbacks:{selected:function(scope,r){},deselected:function(r){}}});APP.x01Settings.startingScore=new SpiceSelector({id:"x01ss",ele:"#x01-starting-score",min:1,max:1,spices:[{content:"301",class:"dual-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"301"},{content:"501",class:"dual-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"501",active:!0},{content:"101",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"101"},{content:"201",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"201"},{content:"401",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"401"},{content:"601",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"601"},{content:"701",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"701"},{content:"801",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"801"},{content:"901",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button",name:"901"},{content:"1001",class:"quad-button-list round-corners button-white pSmTop pSmBottom ss-button mMdBottom",name:"1001"},{content:"Custom",class:"clearfix button-md round-corners button-gold pSmTop pSmBottom ss-button button-center",name:"custom"}],defaultClass:"button-white",highlightClass:"button-info",callbacks:{preInit:function(){},postInit:function(self){self.selectionArr.push("ss_x01ss_501"),self.forceUpdate()},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){"ss_x01ss_custom"==selectedSpice&&APP.prompt.show({title:"Custom",msg:"Enter Custom Starting Score",use_close_icon:!0,type:"number",maxlength:4,post_display:function(){},close:function(r){if(r)if("number"==typeof(r=parseFloat(r)))if(/^\d+$/.test(r))if("0"!=r.toString().left(1))if(r<=1)showError("Please enter a number higher than 1");else{if(!(r.toString().length>40))return APP.x01Settings.customStartingScore=r,$("#ss_x01ss_custom").text("Custom: "+r),!0;showError("Please enter a number with a maximum of 4 digits")}else showError("Please enter a number without leading 0s");else showError("Please enter numbers only");else showError("Please enter a number");else showError("Please enter a number");function showError(reason){$("#ss_x01ss_custom").text(),self.selectionArr=["ss_x01ss_501"],self.forceUpdate(),APP.prompt.hide(),APP.alert.show(reason)}}})},deselected:function(self,selectedSpice){$("#ss_x01ss_custom").removeClass("button-white")}}}),scope.ele.main.find(".popup-title span").text("x01 Settings")}}}},fns:{applyCustomMatch:function(){var gameStart=APP.x01Settings.gameStart.returnSelected(),gameEnd=APP.x01Settings.gameEnd.returnSelected(),double_in=!1,all_player_double_in=!1,double_out=!0,master_out=!1,starting_score=501;switch(gameStart){case"straight-in":double_in=!1;break;case"double-in":double_in=!0;break;case"all-players-double-in":all_player_double_in=!0}switch(gameEnd){case"double-out":double_out=!0;break;case"straight-out":double_out=!1;break;case"master-out":double_out=!0,master_out=!0}var selectedSpice=APP.x01Settings.startingScore.returnSelected()[0].name;starting_score="custom"==selectedSpice?APP.x01Settings.customStartingScore:selectedSpice;var options={double_in:double_in,all_player_double_in:all_player_double_in,double_out:double_out,master_out:master_out,hint32:!1,starting_score:starting_score=parseInt(starting_score)};APP.game.resetScores(starting_score),APP.game.setOptions(options),APP.plugin_01.storeSettings(),APP.plugin_01.refreshGamePanel(),APP.header.refresh();var lbl=starting_score;lbl+=all_player_double_in?" ADI":double_in?" DI":" SI";var outText=double_out?"DO":"SO";master_out&&(outText="MO"),lbl+=outText,BBAT.storeData({other_game:{type:"01",label:lbl,starting_score:starting_score,all_player_double_in:all_player_double_in,double_in:double_in,double_out:double_out,master_out:master_out,ascending_score:!1,custom:!0}}),window.setTimeout((function(){APP.game_selector.refreshGamePanel(),$("#game-selector").show()}),100)}}},ffwd:{debugMode:!0,log:function(msg,force){if(APP.ffwd.debugMode||force){var message="APP.FFwd: ";message+="string"==typeof msg?msg:JSON.stringify(msg),console.log(message)}},isActive:!1,boombox:null,_doCheck:function(){try{if("PRE-GAME"==APP.mode||"IN-GAME"==APP.mode){var ffwdData=BBAT.fetchData("ffwd_data"),DCTVData=BBAT.fetchData("dctv_data");return void(ffwdData?(APP.ffwd.log("FFwd: Found FFwd data"),APP.ffwd.boombox=new FastForward({data:ffwdData,callbacks:{mongoComplete:function(){APP.ffwd._showLoader(!0),window.setTimeout((function(){APP.ffwd._checkDCTV()}),100)}}}),APP.ffwd.boombox.debugMode&&APP.ffwd._hideLoader()):DCTVData&&(APP.ffwd.log("FFwd: Found DCTV data"),APP.ffwd.boombox=new FastForward({data:DCTVData,dctv:!0}),APP.ffwd.boombox.debugMode&&APP.ffwd._hideLoader()))}}catch(e){}BBAT.flushData("ffwd_data")},_checkFFWDActive:function(){try{if("PRE-GAME"==APP.mode||"IN-GAME"==APP.mode){var ffwdData=BBAT.fetchData("ffwd_data"),DCTVData=BBAT.fetchData("dctv_data");return ffwdData?(APP.ffwd.log("FFwd: Found FFwd data"),!0):!!DCTVData&&(APP.ffwd.log("FFwd: Found DCTV data"),!0)}}catch(e){}return!1},data:{matchId:null,eventId:null},_getData:function(matchId,eventId){if(matchId&&eventId){APP.ffwd.data.matchId=matchId,APP.ffwd.data.eventId=eventId;var _this=APP.ffwd;_this._showLoader(),window.setTimeout((function(){APP.session.ffwd_no_score?_this._checkDCTV():_this._doPlatformCall()}),100)}else APP.alert.show("Error: Missing matchId or eventId")},_doTestPlatformCall:function(){var matchId=APP.getMatch().bracket_match_id,eventId=APP.getMatch().bracket_event_id;if(matchId&&eventId){var data={bracket_match_id:matchId,bracket_event_id:eventId};APP.fns.doOldCall("/corsform/getBracketMatchLegs",data,(function(r){APP.ffwd.log(r,!0)}))}else APP.alert.show("Error: Missing matchId or eventId")},_doPlatformCall:function(){var _this=APP.ffwd,callback=function(r){APP.ffwd._handlePlatformCall(r)},data={bracket_match_id:_this.data.matchId,bracket_event_id:_this.data.eventId};APP.fns.doOldCall("/corsform/getBracketMatchLegs",data,callback,callback)},_handlePlatformCall:function(r){var hasError=!1;try{if(r){if(r.legs)return BBAT.storeData({ffwd_data:r}),newErrorReport("FFwd Data Retrieved","FFwd data successfully retrieved from platform for matchId: "+this.data.matchId+" eventId: "+this.data.eventId),void APP.ffwd._doCheck()}else hasError=!0}catch(e){hasError=!0}if(hasError)APP.alert.show("Error: Unable to get data, please try again");else{APP.alert.show("\n\t\t\t\t\tUnfortunately, this device was unable to retrieve any match data. Players will need to re-enter each turn or replay the leg(s).\n\t\t\t\t")}APP.fns.newLoader.hide()},_showLoader:function(dctvSearch){var options={message:"Preparing Match for Download&hellip;",waitMessage:'\n\t\t\t\t\tDepending on WiFi speed this may take a minute.\n\t\t\t\t\t<div id="newSpinner"></div>\n\t\t\t\t'};dctvSearch&&(options.message="Searching for DCTV data&hellip;"),APP.fns.newLoader.show(options)},_hideLoader:function(){APP.fns.newLoader.hide()},_checkDCTV:function(){var mMsg="\n\t\t\t\tThis device was unable to retrieve data for the most recent leg. Players will need to re-enter each turn or replay the leg.\n\t\t\t";try{var url=APP.getApi2Url()+"broadcast-match",data={bracket_match_id:APP.getMatch().bracket_match_id,event_id:APP.getMatch().tournament_id};APP.fns.doCall(url,data,"POST",(function(r){if(r&&r.payload&&r.payload.extended_details&&r.payload.extended_details.contents)return BBAT.storeData({dctv_data:r.payload.extended_details.contents}),void APP.ffwd._doCheck();APP.alert.show(mMsg,(function(){APP.reload()}))}),(function(e){APP.alert.show(mMsg,(function(){APP.reload()}))}),{Authorization:"Bearer DacslVVURVO11d5i2ZIQYlfqlR9lrcqgVJWvdV6rLJnNtVpjC1VqpCzvD2xypila"})}catch(e){APP.alert.show(mMsg,(function(){APP.reload()}))}}}};APP.logoutManager={config:{storageKeysToKeep:["app_version","device_token","window_name"],matchesPattern:/^matches_\d*$/i,reloadDelay:100,callMax:3e3},init:function(force){var hasPendingSync=this._checkPendingSync();force?this._doLogout():this._showConfirmation(hasPendingSync)},_checkPendingSync:function(){var hasPendingFinishedGames=APP.server.hasPendingFinishedGames(!0),hasPendingFinishedMatches=APP.server.hasPendingFinishedMatches(!0);return hasPendingFinishedGames||hasPendingFinishedMatches},_showConfirmation:function(hasPendingSync){var message="Logout?<br /> <br />WiFi is required to log back in and download your player library.";hasPendingSync&&(message="FYI... Match data still needs to be synced to the DartConnect server.<br />Please connect to the Internet at your earliest opportunity to finish syncing."),APP.confirm.show({msg:message,ok:APP.logoutManager._doLogout})},_doLogout:function(){var _this=APP.logoutManager;_this._showLoader(),_this._cleanupSession(),window.setTimeout((function(){_this._doPlatformLogout()}),100)},_cleanupSession:function(){try{WS.close(),APP.user_options.offline=!1,APP.storeUserOptions(),this._clearLocalStorage()}catch(e){this._clearLocalStorage()}},_clearLocalStorage:function(){var key;for(key in window.localStorage)this.config.storageKeysToKeep.includes(key)||key.match(this.config.matchesPattern)||BBAT.flushData(key)},_doPlatformLogout:function(){var _this=APP.logoutManager,callback=function(){APP.logoutManager._handlePostLogout()},memberId=!1;try{memberId=APP.user.member_id}catch(e){}if(memberId){var data={device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:memberId};APP.fns.doOldCall("/memberLogout",data,callback,_this._handleLogoutFailure,!1,_this.config.callMax)}else callback()},_handlePostLogout:function(){var _this=APP.logoutManager;"SERVER"===APP.game_master&&"HOST"===APP.device.role?(APP.revertToLocalPlay(),_this._closeAlley()):APP.reload()},_closeAlley:function(){var _this=APP.logoutManager;try{var data={device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,force_close:"Y"};return void APP.fns.doOldCall("/closeAlley",data,(function(){APP.server.resetApiUrl(),setTimeout(APP.reload,_this.config.reloadDelay)}),(function(){APP.server.resetApiUrl(),setTimeout(APP.reload,_this.config.reloadDelay)}),!1,_this.config.callMax)}catch(e){}APP.server.resetApiUrl(),setTimeout(APP.reload,_this.config.reloadDelay)},_handleLogoutFailure:function(error){APP.logoutManager._handlePostLogout()},_showLoader:function(){var options={message:"Logging out&hellip;",waitMessage:"\n\t\t\t\tPlease be patient while we log you out.\n\t\t\t"};APP.fns.newLoader.show(options)}},$(document).ready((function(){setTimeout((function(){APP.session.init(),APP.server.init(),APP.device.init(),APP.game.init(),APP.alert.init(),APP.confirm.init(),APP.info.init(),APP.popup.init(),APP.header.init(),APP.reveal.init(),APP.plugin_01.init(),APP.plugin_cricket.init(),APP.plugin_library.init(),APP.game_selector.init(),APP.message_bar.init(),APP.equation.init(),APP.scoreboard.init(),APP.sleepTimerCheck||(APP.sleepTimerCheck=setInterval(APP.sleepCheck,1e3)),$("#app-overlay").fadeOut(200),APP.init(),$("#hdr-round").on("click",(function(){APP.device.pauseKeyboardHandler(),$("#debug").show(0)})),$("#tactics-shield").on("click",(function(){APP.tacticsResize.toggle(!0)})),$("#debug-close").on("click",(function(){$("#debug").hide(0),APP.device.resumeKeyboardHandler()})),$("#debug-submit").on("click",(function(){var descr=$("#debug-description").val();if("testbot"==descr)return $("#debug-description").hide(),void testbot.loadExcelReader();descr.length?($("#debug-description").val("").blur(),$("#debug").hide(0),newErrorReport("custom",descr,!0,(function(r){var msg='<span class="bold">Thanks for your help!</span>';r&&r.payload&&r.payload.message&&(msg+=`\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t${r.payload.message}\n\t\t\t\t\t\t`),APP.alert.show(msg,null,null,"Bug Report Submitted")}))):alert('Please provide a description of the "bug."')})),APP.enableTestFlow()}),500)}));var Timer=function(timerVars){var _this=this;if(this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="Timer: ";message+=msg,console.log(message)}},this.timer=0,this.runTime=0,this.hasStopped=!1,this.forceClose=!1,this.wasRemoved=!1,this.name="Default Timer",this.manuallyStopped=!1,this.accurateTimer=null,this.accurateTimerStarted=!1,this.accurateTimerEnded=!1,!timerVars)return console.log("Timer: No Vars sent"),!1;if(!timerVars.name)return console.log("Timer: No name sent"),!1;if(this.name=timerVars.name,timerVars.manualStop)this.runTime=1/0;else{if(!timerVars.runTime)return console.log("Timer: No runTime sent"),!1;if(!parseFloat(timerVars.runTime))return console.log("Timer: Runtime not numerical"),!1;if(timerVars.runTime<1)return console.log("Timer: Runtime must be positive number"),!1;this.runTime=timerVars.runTime+1}if(!timerVars.callback)return console.log("Timer: No callback sent"),!1;timerVars.eachTick&&(this.eachTickCallback=timerVars.eachTick),timerVars.debugMode&&(this.debugMode=timerVars.debugMode),timerVars.returnMinutes&&(this.returnMinutes=timerVars.returnMinutes),timerVars.returnHours&&(this.returnHours=timerVars.returnHours),timerVars.forceClose&&(this.forceClose=timerVars.forceClose),this.init=function(){if(!_timers.addTimer(this)){if(!this.forceClose)return void this.log("Timer "+this.name+" is already running",!0);_timers.removeTimer(this.name),_timers.addTimer(this)}this.log("Init "+this.name+" timer for "+this.runTime+" seconds"),this.countDown()};var AdjustingInterval=function(workFunc,interval){var expected,timeout,that=this;function step(){if(!_this.accurateTimerEnded){var drift=Date.now()-expected;workFunc(),expected+=that.interval,timeout=setTimeout(step,Math.max(0,that.interval-drift))}}this.interval=interval,this.start=function(){expected=Date.now()+this.interval,timeout=setTimeout(step,this.interval)},this.stop=function(){clearTimeout(timeout)}};this.countDown=function(){this.accurateTimer=new AdjustingInterval(this.countDownCallback,1e3),this.accurateTimerStarted||(this.accurateTimer.start(),this.accurateTimerStarted=!0)},this.countDownCallback=function(){_this.timer++,_this.timer>=_this.runTime?(_this.callback(),_this.accurateTimer&&(_this.accurateTimerEnded=!0),_this.hasStopped=!0,_this.wasRemoved||_timers.removeTimer(_this.name)):_this.eachTick()},this.eachTick=function(){this.debugCount(),this.eachTickCallback&&this.eachTickCallback()},this.debugCount=function(){this.log(this.name+" timer: "+this.timer+" seconds of "+this.runTime+" seconds")},this.callback=function(){this.log("Timer Finished"),timerVars.callback&&timerVars.callback(this.manuallyStopped)},this.getCountDown=function(){var countDown=this.runTime-this.timer;return this.returnHours?this.calculateHourDisplay(countDown):this.returnMinutes?this.calculateMinuteDisplay(countDown):countDown},this.calculateHourDisplay=function(timer){if(timer>59&&timer<3600)return this.calculateMinuteDisplay(timer);var hourDisplay=Math.floor(timer/3600);hourDisplay+=":";var minuteDisplay=Math.floor(timer%3600/60);minuteDisplay>9||(hourDisplay+="0"),hourDisplay+=minuteDisplay,hourDisplay+=":";var secondDisplay=timer%60;return secondDisplay>9||(hourDisplay+="0"),hourDisplay+=secondDisplay},this.calculateMinuteDisplay=function(timer){var minuteDisplay;return timer>59?(minuteDisplay=Math.floor(timer/60),minuteDisplay+=":",timer%60>9||(minuteDisplay+="0"),minuteDisplay+=timer%60):(minuteDisplay="0:",timer>9||(minuteDisplay+="0"),minuteDisplay+=timer),minuteDisplay},this.getRunTime=function(){return this.returnHours?this.calculateHourDisplay(this.timer):this.returnMinutes?this.calculateMinuteDisplay(this.timer):this.timer},this.stopTimer=function(removed){this.manuallyStopped=!0,this.hasStopped=!0,this.wasRemoved=removed,this.wasRemoved||_timers.removeTimer(_this.name),this.runTime=this.timer},this.init()},_timers={arr:[],addTimer:function(timer){return-1===_timers.findTimerByName(timer.name)&&(_timers.arr.push(timer),!0)},removeTimer:function(name){for(var i=_timers.arr.length-1;i>=0;i--){_timers.arr[i].name==name&&(_timers.arr[i].hasStopped||_timers.arr[0].stopTimer(!0),_timers.arr.splice(i,1))}},findTimerByName:function(name){for(var found=-1,i=0;i<_timers.arr.length;i++){_timers.arr[i].name==name&&(found=i)}return found}},_flows={zindex:1,open:function(ele){ele.css("z-index",this.zindex),this.zindex++},arr:[],addFlow:function(flow){return-1===_flows.findFlowByName(flow.name)&&(_flows.arr.push(flow),!0)},removeFlow:function(name){for(var i=_flows.arr.length-1;i>=0;i--){_flows.arr[i].name==name&&_flows.arr.splice(i,1)}},findFlowByName:function(name){for(var found=-1,i=0;i<_flows.arr.length;i++){_flows.arr[i].name==name&&(found=i)}return found},closeAll:function(){for(var i=_flows.arr.length-1;i>=0;i--){var myFlow=_flows.arr[i];myFlow.exit(),_flows.removeFlow(myFlow.name)}},bringToFront:function(name){var myFlow=this.findFlowByName(name);if(-1!==myFlow)try{_flows.open(_flows.arr[myFlow].ele.main)}catch(e){}}},_syncs={arr:[],add:function(obj){return-1===this.findByName(obj.name)&&(this.arr.push(obj),!0)},remove:function(name,callback){for(var i=this.arr.length-1;i>=0;i--){var myObj=this.arr[i];myObj.name==name&&(callback&&callback(myObj),this.arr.splice(i,1))}},findByName:function(name){for(var found=-1,i=0;i<this.arr.length;i++){this.arr[i].name==name&&(found=i)}return found},processing:!1,manualStop:!1,init:function(){this.manualStop=!1,this.startTimer()},startTimer:function(ext){if(!this.processing&&!this.manualStop){this.processing=!0;var attemptTime=4e3;ext&&(attemptTime=8e3),window.setTimeout((function(){_syncs.checkSync()}),attemptTime)}},stopTimer:function(){this.manualStop=!0,this.processing=!1},checkSync:function(){if(!this.arr.length)return this.processing=!1,void this.startTimer(!0);for(var mySync,i=0;i<this.arr.length;i++)if(!this.arr[i].offline&&this.arr[i].syncNeeded){mySync=this.arr[i];break}if(!mySync)return this.processing=!1,void this.startTimer(!0);this.doSync(mySync)},doSync:function(mySync){try{if(this.manualStop)return;if(APP.isOffline())return;if(mySync.callbacks("prePlatformSync"),mySync.pauseSyncing)return;var mData=mySync.data,data={member_id:APP.user.member_id,obj_name:"playerOptions",data:mData,_ts:Date.now().toString()},url=APP.getApi2Url();url+=mySync.postUrl,data=JSON.stringify(data),$.ajax({url:url,type:"POST",cache:!1,timeout:0,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(data){mySync.syncComplete(),mySync.callbacks("PlatformSyncSuccess"),_syncs.processing=!1,_syncs.startTimer()},error:function(e){mySync.callbacks("PlatformSyncError"),_syncs.processing=!1,0!==e.status&&newErrorReport("NSync Sync Bug | "+mySync.name);var failSync=_syncs.arr.splice(0,1)[0];_syncs.arr.push(failSync),_syncs.startTimer(!0)}})}catch(e){}}};function sendTestMessages(){var message={title:"Incoming Message",msg:"<p>Here's a test message with options</p> <hr />"},optionArr=[{title:"A Red Test Button",class_list:"button-red",callback:function(){alert("This callback will close the message")}},{title:"A Gold Test Button - no close",class_list:"button-gold",keep_open:!0,callback:function(){alert("This callback won't close the message")}}];APP.message.init(message,optionArr),message={title:"Incoming Message",msg:"<p>Here's a basic message</p>"},APP.message.init(message),message={title:"Incoming Message",msg:"<p>Here's a test message with a single button</p> <hr />"},optionArr=[{title:"A Test Button",class_list:"button-green",callback:function(){alert("This is another callback")}}],APP.message.init(message,optionArr)}APP.popOver={zindex:99991,open:function(ele,header,footer,callback,wrap,noCloseBtn){ele.find(".po_autoWrap").length&&ele.find(".po_autoWrap").contents().unwrap(),this.zindex++;var headerContent=this.buildHeader(header);if(ele.find(".pop-header").remove(),ele.find(".pop-over-close").remove(),ele.find(".pop-content").prepend(headerContent),ele.removeClass("hasFooter"),ele.find(".pop-footer").remove(),footer){ele.addClass("hasFooter");var footerContent=this.buildFooter();ele.append(footerContent)}wrap&&(ele.find(".pop-content .container").length||ele.find(".pop-content").wrapInner('<div class="container po_autoWrap" />')),ele.find(".pop-footer .container").length||ele.find(".pop-footer").wrapInner('<div class="container po_autoWrap" />'),ele.find(".pop-footer .btn-complete").off("click"),ele.find(".pop-footer .btn-complete").on("click",(function(){callback?callback(!0):APP.popOver.close()})),ele.find(".pop-footer .btn-cancel").off("click"),ele.find(".pop-footer .btn-cancel").on("click",(function(){callback?callback(!1):APP.popOver.close()})),ele.show(),$("body").addClass("pop-on"),ele.find(".pop-content").scrollTop(0),ele.css("z-index",this.zindex),$(".pop-over-close").off("click"),$(".pop-over-close").on("click",(function(){callback?callback(!1):APP.popOver.close()})),noCloseBtn&&ele.find(".pop-over-close").hide()},buildHeader:function(header){var headerContent;return header&&(headerContent=`\n\t\t\t\t<div class="pop-header">\n\t\t\t\t\t<button type="button" class="pop-over-close close"></button>\n\t\t\t\t\t<h3>${header}</h3>\n\t\t\t\t </div>\n\t\t\t`),headerContent},buildFooter:function(){return content="\n\t\t\t<div class=\"pop-footer\">\n\t\t\t\t<div class='btn-cancel btn btn-danger'>\n\t\t\t\t\tCancel\n\t\t\t\t</div>\n\t\t\t\t<div class='btn-complete btn floatRight btn-success'>\n\t\t\t\t\tOK\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t",content},close:function(ele){ele?ele.hide():$(".pop-over").hide(),$(".pop-over:visible").length||$("body").removeClass("pop-on"),$("#iframe iframe").remove()}},APP.closeIframePopOver=function(callback){APP.popOver.close($("#iframe")),$("#iframe .btn-cancel").show(),callback&&callback();var ifrm=document.createElement("iframe");ifrm.setAttribute("style","border: none"),ifrm.setAttribute("height","100%"),ifrm.setAttribute("width","100%"),$("#iframe .pop-container").append(ifrm)},APP.showIframePopOver=function(url,title,callback){if(url)if($("#iframe").length<1)console.log("Show Iframe PopOver: No target available");else{var popIframe=$("#iframe iframe");popIframe.hide(),APP.popOver.open($("#iframe"),title,!1,APP.closeIframePopOver);var frameUrl=url;-1===url.indexOf("?")?frameUrl+="?iframe=true":frameUrl+="&iframe=true",popIframe.attr("src",frameUrl,!0),$("#iframe .pop-header").wrapInner('<div class="container"></div>'),popIframe.on("load",(function(){popIframe.show()}))}else console.log("Show Iframe PopOver: No URL sent")},APP.receiveMessage=function(event){var message=event.data;if(message){try{message=JSON.parse(message)}catch(e){return}switch(message.type){case"dctv":if("IFRAME_EXIT"==message.data)return void APP.closeIframePopOver();break;default:console.log("Unknown iframe cmd - "+JSON.stringify(message))}}},APP.versionCheck={current:APP.version,debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="VersionCheck: ";message+=msg,console.log(message)}},compare:function(min){if(!min)return this.log("Min version no supplied"),!1;var major,minor,revision,minMajor,minMinor,minRevision,currentSplit=this.current.split(".");major=parseFloat(currentSplit[0]),minor=parseFloat(currentSplit[1]),revision=parseFloat(currentSplit[2]),this.log("Major = "+major),this.log("Minor = "+minor),this.log("Revision = "+revision);var minSplit=min.split(".");return 3!==minSplit.length?(this.log("Min Version incorrectly formated: "+min),!1):(minMajor=parseFloat(minSplit[0]),minMinor=parseFloat(minSplit[1]),minRevision=parseFloat(minSplit[2]),this.log("Min Major = "+minMajor),this.log("Min Minor = "+minMinor),this.log("Min Revision = "+minRevision),major>minMajor?(this.log("App version is upto date or newer"),!0):major<minMajor?(this.log("Major is older: "+major+" vs. "+minMajor),!1):minor>minMinor?(this.log("App version is upto date or newer"),!0):minor<minMinor?(this.log("Minor is older: "+minor+" vs. "+minMinor),!1):minor>minRevision?(this.log("App version is upto date or newer"),!0):revision<minRevision?(this.log("Revision is older: "+revision+" vs. "+minRevision),!1):(this.log("App version is upto date or newer"),!0))}},APP.cleanBasicMatches=function(){for(var basicMatchCount=0,ms=APP.session.matches,i=0;i<ms.length;i++){var match=ms[i];APP.matchIsLegit(match)||(match.closed=!0,basicMatchCount++)}basicMatchCount&&(APP.session.cleanUpClosedMatches(),APP.server.updateSyncMessages())},APP.matchIsLegit=function(match){try{if("BASIC GAME"!=match.mode)return!0;if(null!=match.start_time)return!0;if(null!=match.title)return!0;if(match.sets&&match.sets.length>1)return!0;if(match.sets[0].games&&match.sets[0].games.length)return!0}catch(e){return!0}return!1},APP.perfTest={oldFn:function(){},newFn:function(){},run:function(qty){var then,now,i;for(then=new Date,i=0;i<qty;i++)this.oldFn(qty);for(now=new Date,console.log("Old Fn:"+(now-then)/1e3),then=new Date,i=0;i<qty;i++)this.newFn(qty);now=new Date,console.log("New Fn:"+(now-then)/1e3)},b:null,go:function(){this.b=performance.now()},stop:function(name){console.log("PERFTEST - "+name+" "+(performance.now()-this.b))}},APP.findInObjArray=function(prop,obj,needle,position){for(var returnObj=[],i=0;i<obj.length;i++){if(!obj[i])return;if(obj[i].hasOwnProperty(prop)){if(needle==obj[i][prop]){position?returnObj.push(i):returnObj.push(obj[i]);break}if(returnObj.length)return returnObj}}return returnObj},APP.stringToHtml=function(str){try{var tempContent=document.createElement("div");return tempContent.innerHTML=str,tempContent}catch(e){return!1}},APP.htmlToString=function(html){return html.innerHTML},APP.enableTestFlow=function(){return},window.addEventListener("message",APP.receiveMessage,!1),APP.fns={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="Fns: ";message+=msg,console.log(message)}},doCall:function(url,data,type,success,error,headers){if(data){type||(type="POST"),headers||(headers={}),data.device_token=APP.device.token,data.member_id=APP.user?APP.user.member_id:"n/a",data=data._emptyData&&1==data._emptyData?null:JSON.stringify(data);var srvr=APP.server;$.ajax({url:url,type:type,cache:!1,timeout:srvr.dflt_timeout,dataType:"json",contentType:"application/json",processData:!1,headers:headers,data:data||"",success:function(in_data){"OK"==in_data.status?success(in_data):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){error("FAILED",in_a,in_b,in_c)}})}else this.log("Data Not Sent")},doOldCall:function(url,data,success,error,useLoader,timeout){useLoader&&APP.device.showSpinnerOverlay();var srvr=APP.server;window.setTimeout((function(){$.ajax({url:url,type:"POST",cache:!1,timeout:timeout||srvr.dflt_timeout,dataType:"json",jsonp:!1,data:data,success:function(in_response){useLoader&&APP.device.hideSpinnerOverlay(),success&&success(in_response.payload)},error:function(in_a,in_b,in_c){useLoader&&APP.device.hideSpinnerOverlay(),error&&error(in_a,in_b,in_c)}})}),100)},activateBtn:function(ids,callback){Array.isArray(ids)||(ids=[ids]),APP.device.addButtonHandler(ids,callback);for(var i=0;i<ids.length;i++){var id="#"+ids[i];APP.device.setButtonEvents(id)}},activateInput:function(classNames,callback){Array.isArray(classNames)||(classNames=[classNames]);try{for(var i=0;i<classNames.length;i++)for(var inputs=document.querySelectorAll("."+classNames[i]),j=0;j<inputs.length;j++)!function(input){input._forceFocusHandler&&(input.removeEventListener("touchstart",input._forceFocusHandler,{passive:!1}),input.removeEventListener("click",input._forceFocusHandler)),input._forceFocusHandler=function(e){if("click"!==e.type||!input._touched){e.cancelable&&e.preventDefault(),input.focus();try{var t=input.type||"";if(/^(text|search|tel|url|password|email|number)$/i.test(t)){var len=input.value?input.value.length:0;input.setSelectionRange(len,len)}}catch(_){}"function"==typeof callback&&callback(input),input._touched=0===e.type.indexOf("touch")}},input.addEventListener("touchstart",input._forceFocusHandler,{passive:!1}),input.addEventListener("click",input._forceFocusHandler)}(inputs[j])}catch(e){alert(e.message)}},createOptions:function(data,buttonMode){var isMultiLevel=!1;if(data)if(data.options)if(data.callback)if(data.title)if(data.defaultText)if(buttonMode||void 0!==data.saveData){if(data.multiLevel&&(isMultiLevel=!0),APP.fns.activateBtn(data.id,(function(){var buttonIds;if(isMultiLevel){var content=data.options();if(content.isError)return APP.alert.show(content.errorMsg),!1;APP.dialog.show({title:data.title,msg:APP.fns.buildOptionBtns(content.options)}),buttonIds=APP.fns.createBtnIds(content.options),data.onLoad&&data.onLoad()}else APP.dialog.show({title:data.title,msg:APP.fns.buildOptionBtns(data.options)}),buttonIds=APP.fns.createBtnIds(data.options),data.onLoad&&data.onLoad();APP.fns.activateBtn(buttonIds,(function(e){var btn=$("#"+e),val=btn.attr("data-value"),display=btn.attr("data-display");data.callback(val,display),buttonMode||(-1!=btn.attr("data-value")?$("#"+data.id).html(display).removeClass("button-gray").addClass("button-white"):$("#"+data.id).html(data.defaultText).removeClass("button-white").addClass("button-gray")),APP.dialog.hide()}))})),null!==data.saveData){var optionList=data.options;isMultiLevel&&(optionList=data.options()).options&&(optionList=optionList.options);for(var i=0;i<optionList.length;i++){var option=optionList[i];option.value==data.saveData&&$("#"+data.id).html(option.display).removeClass("button-gray").addClass("button-white")}}}else this.log("Create Options - Check Save Data");else this.log("Create Options - Check default text");else this.log("Create Options - Check title");else this.log("Create Options - Check callback");else this.log("Create Options - Check options");else this.log("Create Options - No data passed")},buildOptionBtns:function(options){for(var content="",i=0;i<options.length;i++){var option=options[i];if("_insert"!=option.value){var btnClass="dialogBtn button button-menu button-gray round-corners";option.class&&(btnClass=option.class),content+=`\n\t\t\t\t<div class="${btnClass}"\n\t\t\t\t\tdata-value="${option.value}"\n\t\t\t\t\tdata-display="${option.display}"\n\t\t\t\t\tid="optionBtn-${i}"\n\t\t\t\t>\n\t\t\t\t\t${option.display}\n\t\t\t\t</div>\n\t\t\t`}else content+=option.display}return content+='\n\t\t\t<div class="dialogBtn button button-menu button-red round-corners"\n\t\t\t\t\tdata-value="-1"\n\t\t\t\t\tid="optionBtnCancel">\n\t\t\t\tCancel\n\t\t\t</div>\n\t\t'},createBtnIds:function(options){for(var buttonIds=["optionBtnCancel"],i=0;i<options.length;i++)"_insert"!==options.value&&buttonIds.push("optionBtn-"+i);return buttonIds},myTabCounter:0,createMyTabs:function(ele,headerArr,contentArr,callback){if(!this.validateMyTabs(ele,headerArr,contentArr))return this.log("Create myTabs is Invalid",!0),!1;var content=this.createMyTabNav(ele,headerArr);content+=this.createMyTabContent(ele,contentArr),$(ele).empty().append(content),this.activateMyTabs(headerArr.length,callback),this.myTabCounter++},validateMyTabs:function(ele,headerArr,contentArr){return ele&&headerArr&&contentArr?"string"!=typeof ele?(this.log("myTabs Ele wrong type",!0),!1):$(ele).length?Array.isArray(headerArr)?Array.isArray(contentArr)?headerArr.length===contentArr.length||(this.log("myTabs headerArr and contentArr must match lengths",!0),!1):(this.log("myTabs contentArr wrong type",!0),!1):(this.log("myTabs headerArr wrong type",!0),!1):(this.log("myTabs Ele not found",!0),!1):(this.log("Tab vars incomplete",!0),!1)},createMyTabNav:function(ele,headerArr){for(var content='<div class="tab-options">',i=0;i<headerArr.length;i++)content+=`\n\t\t\t\t<div \n\t\t\t\t\tclass="button ${0==i?"active":""}"\n\t\t\t\t\tdata-ele="${ele}"\n\t\t\t\t\tdata-opt="${i}"\n\t\t\t\t\tid="my-tab-opt-${this.myTabCounter}-${i}"\n\t\t\t\t>\n\t\t\t\t\t${headerArr[i]}\n\t\t\t\t</div>\n\t\t\t`;return content+="</div>"},createMyTabContent:function(ele,contentArr){for(var content='<div class="tab-content">',i=0;i<contentArr.length;i++)content+=`\n\t\t\t\t<div \n\t\t\t\t\t${0==i?"class='active'":""}\n\t\t\t\t\tdata-ele="${ele}"\n\t\t\t\t\tdata-opt="${i}"\n\t\t\t\t>\n\t\t\t\t\t${contentArr[i]}\n\t\t\t\t</div>\n\t\t\t`;return content+="</div>"},activateMyTabs:function(tabQty,callback){for(var i=0;i<tabQty;i++){var tabNavId=`my-tab-opt-${this.myTabCounter}-${i}`;callback&&"function"==typeof callback?APP.fns.activateBtn(tabNavId,(function(e){callback(e),APP.fns.switchMyTabs(e)})):APP.fns.activateBtn(tabNavId,this.switchMyTabs)}},switchMyTabs:function(tabId){try{var tab=$("#"+tabId);if(!tab)return void this.log("myTabs not found",!0);var eleAttr=tab.attr("data-ele");if(!eleAttr)return void this.log("myTabs eleAttr not found",!0);var myEle=$(eleAttr);if(!myEle.length)return void this.log("myTabs myEle not found",!0);var navOpt=tab.attr("data-opt");if(!navOpt)return void this.log("myTabs navOpt not found",!0);myEle.find(".tab-options .button").removeClass("active"),tab.addClass("active"),myEle.find(".tab-content > div").each((function(){var thisTab=$(this);thisTab.attr("data-opt")==navOpt?thisTab.addClass("active"):thisTab.removeClass("active")}))}catch(e){this.log("myTabs switchMyTabs not working",!0)}},toggleAccordion:function(ele){$("#"+ele).parent().toggleClass("open")},checkPlayersExistInRoster:function(matchObj){var homePlayers=matchObj.home_players,awayPlayers=matchObj.away_players,playerIdArr=[];try{for(var i=0;i<homePlayers.length;i++)playerIdArr.push(homePlayers[i].dc_tournament_player_id);for(i=0;i<awayPlayers.length;i++)playerIdArr.push(awayPlayers[i].dc_tournament_player_id);for(i=0;i<APP.header.teams[0].players.length;i++){var player=APP.header.teams[0].players[i];if(player&&player.player_guid)for(var j=playerIdArr.length-1;j>=0;j--){if(playerIdArr[j]==player.player_guid&&playerIdArr.splice(j,1),!playerIdArr.length)break}}}catch(e){}return!playerIdArr.length},replaceText:function(ele,before,after){var label=document.querySelector(ele);label&&(label.innerHTML=label.innerHTML.replace(before,after))},buildLocalDate:function(year,month,day){var dateString="";try{var d=new Date(year,month,day);dateString=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()]+" "+d.getDate()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][d.getMonth()]}catch(e){}return dateString},buildMatchRace:function(match,type){var raceInfo="";try{switch(type){default:case 1:try{var race=match.legs_limit,firstRaceVal=match.legs_limit,maxRace=match.legs_limit;if("BEST-OF"==match.legs_mode?(race=Math.round(race/2),firstRaceVal%2==0?raceInfo=`First to ${race+1} - Best of ${maxRace}`:(raceInfo="First to "+race+" leg",raceInfo+=race>1?"s":"")):(raceInfo="Play "+race+" leg",raceInfo+=race>1?"s":""),m.sets_limit&&m.sets_limit>1)raceInfo=`First to ${Math.round(m.sets_limit/2)} sets`+" ("+raceInfo+")"}catch(e){}}}catch(e){}return raceInfo},checkLegsAndSets:function(){try{var mf=APP.getMatch().format;if(mf.legs.mode&&mf.legs.limit&&mf.sets.mode&&mf.sets.limit)return!0}catch(e){}return!1},checkForProxy:function(returnType){try{if(APP.user.pa)return!returnType||APP.user.pt}catch(e){}return!1},appendToMatch:function(data){if(data&&data.var&&data.val)try{APP.session.matches[APP.session.current_match][data.var]=data.val,APP.session.store(APP.session.current_match)}catch(e){return void this.log("Append to Match - Error appending data",!0)}else this.log("Append to Match - Invalid data",!0)},newLoader:{flow:null,flowData:{name:"newLoader",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},scope:this,pages:{page1:{hideFooter:!0,hideBackBtn:!0,content:function(){var options=APP.fns.newLoader.options,content="\n\t\t\t\t\t\t\t<div id='new-loader'>\n\t\t\t\t\t\t";return options.dcLogo&&(content+='\n\t\t\t\t\t\t\t\t<svg class="svg-icon" viewBox="0 0 40 28" style="height: 6em; width: 12em;">\n\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t\t\t</svg>\n\n\t\t\t\t\t\t\t\t<div id="pp-red-line" style="width: 100%; font-size: 0.3em;">&nbsp;</div>\n\t\t\t\t\t\t\t'),content+=`\n\t\t\t\t\t\t\t\t<div class="highlight-box mLgTop primary">\n\t\t\t\t\t\t\t\t\t<h4 class="text-gold subheading noMargin">\n\t\t\t\t\t\t\t\t\t\t${options.message}\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t`,options.waitMessage&&(content+=`\n\t\t\t\t\t\t\t\t<h4 style="font-weight: normal; margin: 0.3em 0 0 0;">\n\t\t\t\t\t\t\t\t\t${options.waitMessage}\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t`),content+="\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"},addFooter:function(scope){},init:function(scope){var _this=APP.fns.newLoader;APP.boards.beta&&$("#newLoader").addClass("primary-grad"),$("#newLoader-header").html("&nbsp;");var btnCount=0;if(_this.options.reloadBtn&&btnCount++,_this.options.closeBtn&&btnCount++,_this.options.closeBtn){$("#newLoader-header.popup-title").append('\n\t\t\t\t\t\t\t\t<img id="new-loader-close" class="button popup-icon-close" src="images/icon_close.png">\n\t\t\t\t\t\t\t'),$("#new-loader-close").on("click",(function(){_this.options.closeFn&&"function"==typeof _this.options.closeFn?_this.options.closeFn():_this.hide(!0)}))}if(_this.options.reloadBtn){var reloadBtn=`\n\t\t\t\t\t\t\t\t\t<a id="new-loader-reload" href='javascript:void(0); delete localStorage.ffwd_data; delete localStorage.dctv_data; APP.reload();' class="button popup-header-svg-button ${btnCount>1?"left":"right"} button-info">\n\t\t\t\t\t\t\t\t\t\t<svg class="svg-icon" viewBox="0 0 40 28" style="height: 1em; width: 1em;">\n\t\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-reload"></use>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t`;$("#newLoader-header.popup-title").append(reloadBtn)}$("#newLoader-header").css("background-color","#000000").css("border","none")}}}},options:{message:"Loading",waitMessage:"Please Wait&hellip;",dcLogo:!0,reloadBtn:!0,closeBtn:!1,closeFn:null},resetOptions:{message:"Loading",waitMessage:"Please Wait&hellip;",dcLogo:!0,reloadBtn:!0,closeBtn:!1,closeFn:null},show:function(options){if(this.options=JSON.parse(JSON.stringify(this.resetOptions)),options&&"object"==typeof options)for(var key in options)void 0!==this.options[key]&&(this.options[key]=options[key]);this.flow=new UIFlow(this.flowData)},hide:function(fade){fade?$("#popup-newLoader").fadeOut("slow",(function(){APP.fns.newLoader.flow.exit()})):this.flow&&this.flow.exit()}}},APP.chalkboard={unshield:function(){var el=$("#chalkboard-overlay");el.hasClass("splash")&&(el.removeClass("splash").addClass("overlay"),$("#splash-bottom").css("display","none"),$("#splash-logo").css("display","none")),el.hide(0)},shield:function(){$("#chalkboard-overlay").show(0)}},APP.reveal={is_down:null,current_panel_id:null,force_no_animate:!1,init:function(){APP.reveal.is_down=!0,APP.device.addButtonHandler(["reveal-reset","reveal-exit","reveal-back","reveal-center","reveal-screen-saver","reveal-settings","reveal-info","reveal-help","reveal-chalk","reveal-cancel","reveal-options","bb-eg-back","bb-eg-end","bb-eg-board-menu","reveal-message"],APP.reveal.handleButtons),APP.device.addButtonHandler(["peom-close","peom-return","peom-change","peom-end"],APP.reveal.handleEOMMenu),APP.session.isBracketMatch()&&($("#reveal-info").hide(),$("#reveal-help").show())},handleButtons:function(in_id){APP.session;switch(in_id){case"reveal-options":1==APP.game.opponent_count?(APP.device.disableButtonClass("eom-next-game-group"),APP.device.disableButton("eom-alt-set")):(APP.device.enableButtonClass("eom-next-game-group"),APP.device.enableButton("eom-alt-set"));var isBotTurn=!1;try{isBotTurn=APP.game.opponent[APP.game.winning_opponent]}catch(e){}APP.game.isEOGFinal()||isBotTurn?(APP.device.disableButton("eom-edit"),$("#eom-game-hint").html("Game Saved")):(APP.device.enableButton("eom-edit",!0),$("#eom-game-hint").html("")),APP.popup.hide("popup-notable"),"HOST"==APP.device.role?$("#eom-end-match").html("End &amp; Save Match"):$("#eom-end-match").html("Exit Match"),$("#eom-next-game-label").html("Play "+APP.game.getGameName()+" Again"),!APP.session.lockMatchFormat()&&"HOST"==APP.device.role&&APP.session.getMatchFormat()?APP.device.enableButton("eom-abandon-format",!0):APP.device.disableButton("eom-abandon-format"),"PARTICIPANT"==APP.device.role&&(APP.device.disableButton("eom-connect"),APP.device.disableButton("eom-flag")),APP.popup.show("eog-options-menu");break;case"bb-eg-board-menu":var el=$("#bb-eg-board-menu");APP.reveal.is_down||($("#bb-g-stats").html("Stats"),$("#eom-stats").html("Stats"),APP.reveal.hidePanel()),el.text().indexOf("Review")>=0?APP.scoreboard.hideEOGStatus():APP.scoreboard.showEOGStatus();break;case"reveal-center":APP.session.buildSummary(null,!0),APP.session.showSummary(!1,!0);break;case"reveal-help":APP.message.helpMessage.init();break;case"reveal-reset":if(APP.session.isOnlineBracketMatch())return void APP.session.showOnlineBracketOptions();if(APP.lobby.isLobbyMatch())return void APP.session.showOnlineBracketOptions(!0);APP.resetGame();break;case"reveal-info":switch(APP.mode){case"PRE-GAME":return void("none"!=$("#opponents-panel").css("display")?APP.info.show("info-topic-select-players"):"none"!=$("#keypad-points-panel").css("display")||"none"!=$("#swd-menu-panel").css("display")||"none"!=$("#eog-stats-panel").css("display")||($("#info-topic-orientation-basics-gotit").hide(0),APP.info.show("info-topic-orientation-basics")));case"IN-GAME":if(!APP.game.finished){switch(APP.game.name){case"01":if(APP.plugin_01.is_edit_mode){if($("#bb-ig-restore").html().indexOf("Insert")>=0)return void APP.info.show("info-topic-editing-basic-01");if($("#mb-ig-funcl").html().indexOf("Replay")>=0)return void APP.info.show("info-topic-editing-replay-01");if($("#bb-ig-restore").html().indexOf("Restore")>=0)return void APP.info.show("info-topic-editing-process-01")}else{if(APP.game.select_winning_dart&&!APP.game.finished)return $("#mb-ig-funcr").html().indexOf("BUST")>=0?void APP.info.show("info-topic-swd-01-bust"):void APP.info.show("info-topic-swd-no-bust");if($("#mb-ig-funcr").html().indexOf("MISS")>=0)return $("#kp-p-00").html().indexOf("BUST")>=0?void APP.info.show("info-topic-scoring-bust-01"):void APP.info.show("info-topic-scoring-basic-01");if($("#mb-ig-funcr").html().indexOf("ENTER")>=0)return void APP.info.show("info-topic-scoring-process-01")}break;case"Cricket":if("none"!=$("#button-bar-map-edit").css("display")){if($("#bb-me-restore").html().indexOf("Insert MISS")>=0)return void APP.info.show("info-topic-editing-basic-CR");if($("#mb-ig-funcl").html().indexOf("Replay")>=0)return void APP.info.show("info-topic-editing-replay-CR");if($("#bb-me-restore").html().indexOf("Restore")>=0)return void APP.info.show("info-topic-editing-process-CR")}if(APP.game.select_winning_dart&&!APP.game.finished)return void APP.info.show("info-topic-swd-no-bust");if(APP.game.getOption("marksman_scoring")){if($("#mb-ig-funcr").html().indexOf("MISS")>=0)return void(APP.user_options.cricket_cues?APP.info.show("info-topic-scoring-basic-CRX"):APP.info.show("info-topic-scoring-basic-CRX-tips-off"));if($("#mb-ig-funcr").html().indexOf("ENTER")>=0)return void APP.info.show("info-topic-scoring-process-CRX")}else{if($("#mb-ig-funcr").html().indexOf("MISS")>=0)return void(APP.user_options.cricket_cues?APP.info.show("info-topic-scoring-basic-CR"):APP.info.show("info-topic-scoring-basic-CR-tips-off"));if($("#mb-ig-funcr").html().indexOf("ENTER")>=0)return void APP.info.show("info-topic-scoring-process-CR")}}break}if($("#bb-eg-board-menu").html().indexOf("Next")>=0)return void APP.info.show("info-topic-end-of-game-next");if($("#bb-eg-board-menu").html().indexOf("Review")>=0)return void APP.info.show("info-topic-end-of-game-review")}break;case"bb-eg-end":if($("#bb-eg-end").html().indexOf("End Match")>=0||$("#bb-eg-end").html().indexOf("End League Match")>=0)"PARTICIPANT"==APP.device.role&&APP.device.has_chalk?(APP.device.showSpinnerOverlay(),APP.storeGameEvent({cmd:"FINISH_GAME",cmd_data:{dart:APP.game.winning_dart,finish_time:APP.game.finish_time,winning_opponent:APP.game.winning_opponent,is_set_end:!0,is_match_end:!0,match_summary:APP.session.packageMatchSummary()}},(function(){APP.device.releaseChalk(!1,APP.reload)}))):APP.scoreboard.showEOGStatus({is_set_end:!0,is_match_end:!0});else if(APP.session.getMatchFormat()){APP.confirm.show({msg:"Your match settings will be reset. You will have to manually end the match.",ok_text:"Continue",ok:function(){APP.handleEOGMenuOption("eom-abandon-format")}})}else APP.scoreboard.showEOGStatus({is_set_end:$("#bb-eg-end").html().indexOf("Continue Match")>=0,is_match_end:!1});break;case"bb-eg-back":isBotTurn=!1;try{isBotTurn=APP.game.opponent[APP.game.winning_opponent].isBotTurn(APP.game.active_round)}catch(e){isBotTurn=!1}APP.game.isEOGFinal()||null!=APP.game.winning_opponent&&isBotTurn?APP.device.disableButton("bb-eg-back"):APP.game.plugin.cancelEOG();break;case"reveal-exit":"PARTICIPANT"==APP.device.role?APP.exitAlley({show_summary:!0}):APP.handleMatchOption("bb-e-new-match");break;case"reveal-back":if(APP.session.isBracketMatch()){var wasPractice=APP.session.isBracketPracticeMatch(),matchObj=APP.session.getBracketMatchObject();if(matchObj){var params={tournament_id:APP.session.getTournamentID(),match_id:matchObj.bracket_match_id,event_id:matchObj.bracket_event_id,board_number:matchObj.board_number};APP.server.abandonBracketMatch(params)}if(APP.game.name||APP.session.getLegsCount()>0)APP.game_selector.selectGame(null),APP.game_selector.refreshGamePanel(),APP.session.showGameSelector();else{var closeAlley=!1;if(APP.session.isOnlineBracketMatch()&&(closeAlley=!0),APP.session.resetBracketMatch(),APP.session.setMatchFormat(null),APP.message_bar.resetPromo(),closeAlley)return void APP.session.exitOnlineBracketMatch();BBAT.flushData("players_checked_in"),BBAT.storeData({reload_bracket:APP.session.tournament_id}),BBAT.storeData({reload_bracket_board:APP.session.bracket.board_id}),wasPractice&&!APP.session.bracket.board_id&&(BBAT.flushData("reload_bracket"),BBAT.flushData("reload_bracket_board")),APP.exitAlley()}}else APP.game.shooting_for_bull?(APP.game.setShootForBull(!1),APP.game_selector.selectGame(null),APP.game_selector.refreshGamePanel(),APP.session.showGameSelector()):APP.game.shot_for_bull?APP.nlf.data.rails?APP.session.showGameSelector():(APP.game_selector.selectGame("gs-cork-calls"),APP.session.showBullShoot()):APP.game.name?(APP.game_selector.selectGame(null),APP.game_selector.refreshGamePanel(),APP.session.showGameSelector()):APP.session.showGameSelector();break;case"reveal-settings":APP.session.getMatchFormat();if("TOURNAMENT"==APP.session.getMatchMode()&&APP.user.tx&&null!=APP.session.isSameGameAgain())return void APP.alert.show("User Settings not currently available.");APP.userOptions.init();break;case"reveal-chalk":APP.handleMatchOption("bb-e-alley");break;case"reveal-message":APP.message.userMessage.init();break;case"reveal-cancel":APP.header.cancelOpponentChange()}},handleEOMMenu:function(in_id){var sess=APP.session;switch($("#popup-eom-menu").hide(0),$("#popup-eom-menu-overlay").hide(0),in_id){case"peom-end":"TOURNAMENT"==sess.getMatchMode()?(sess.buildSummary(),sess.showSummary(),APP.session.showMatchScore()):sess.isLeaguePlay()?(sess.buildSummary(),sess.showSummary(!0)):(sess.buildSummary(),sess.showSummary());break;case"peom-change":if("TOURNAMENT"==sess.getMatchMode())sess.buildSummary(),sess.showSummary(),APP.session.showMatchScore();else if(1==APP.game.opponent_count)APP.newGame("PLAY_AGAIN");else{var gn=APP.session.isSameGameAgain()?APP.game.name:null;"MATCH"!=sess.getMatchMode()||sess.isNewMatch()?(sess.addSet(gn),APP.newGame("NEW_PLAYERS")):APP.header.confirmSwitchToGameMode((function(){sess.addSet(gn),APP.newGame("NEW_PLAYERS")}))}}},showEOMMenu:function(){APP.game.opponent[0],APP.game.opponent[1];$("#popup-eom-menu-overlay").show(0),$("#popup-eom-menu").show(0)},setChalkButton:function(){switch(APP.device.role){case"HOST":$("#reveal-chalk").addClass("button"),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("local"),"DEVICE"==APP.game_master?(APP.device.enableButton("mb-ig-funcl"),APP.device.enableButton("mb-ig-funcr"),APP.message.userMessage.changeBtn(!1)):(APP.message.userMessage.changeBtn(!0),APP.device.is_hosting&&(APP.device.disableButton("mb-ig-funcr"),APP.device.disableButton("mb-ig-funcl")),APP.device.has_chalk?(APP.device.is_hosting&&(APP.device.enableButton("reveal-settings",!0),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("on")),APP.device.enableButton("mb-ig-funcl"),APP.device.enableButton("mb-ig-funcr")):APP.server.chalk_release_timer_id?(APP.device.enableButton("mb-ig-funcl",!0),APP.device.is_hosting&&(APP.device.disableButton("reveal-settings"),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("warning"))):APP.device.is_hosting&&(APP.device.disableButton("reveal-settings"),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("off")));break;case"PARTICIPANT":APP.device.disableButton("mb-ig-funcl"),APP.device.disableButton("mb-ig-funcr"),$("#reveal-chalk").removeClass("button"),APP.message.userMessage.changeBtn(!0),APP.device.has_chalk?(APP.device.enableButton("reveal-settings",!0),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("on"),APP.device.enableButton("mb-ig-funcl"),APP.device.enableButton("mb-ig-funcr")):APP.server.chalk_release_timer_id?(APP.device.disableButton("reveal-settings"),APP.device.enableButton("mb-ig-funcl",!0),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("warning")):(APP.device.disableButton("reveal-settings"),$("#reveal-chalk").parent().attr("class",""),$("#reveal-chalk").parent().addClass("off"))}},getBackButtonOption:function(){return $("#reveal-back").is(":visible")?"BACK":$("#reveal-cancel").is(":visible")?"CANCEL":$("#reveal-exit").is(":visible")?"EXIT":$("#reveal-reset").is(":visible")?"RESET":$("#reveal-options").is(":visible")?"OPTIONS":void 0},setBackButton:function(in_option){var b=$("#reveal-back"),c=$("#reveal-cancel"),e=$("#reveal-exit"),r=$("#reveal-reset"),o=$("#reveal-options");switch(b.hide(0),c.hide(0),e.hide(0),o.hide(0),r.hide(0),(APP.session.isOnlineBracketMatch()||APP.lobby.isLobbyMatch())&&(in_option="RESET"),in_option){case"OPTIONS":o.show(0);break;case"RESET":r.show(0);break;case"BACK":b.show(0);break;case"EXIT":e.show(0);break;case"CANCEL":c.show(0)}},setNewSetButton:function(){APP.session.isNewMatch()||APP.session.isPreviousSetForfeit()?APP.device.disableButton("gsp-new-set"):(APP.device.enableButton("gsp-new-set"),APP.session.isNewSet()?$("#gsp-new-set").removeClass("button-green").addClass("button-gold").html("Undo Set"):$("#gsp-new-set").removeClass("button-gold").addClass("button-green").html("New Set"))},updateDCTVKey:function(){if("PARTICIPANT"!=APP.device.role)if(APP.device.is_broadcasting)$("#reveal-key").html(APP.server.spectator_device_key).css("display","inline-block").show(0);else{APP.isOffline();$("#reveal-key").html('<span style="color:dimgray;">WIFI</span>')}else APP.server.spectator_device_key?$("#reveal-key").html(APP.server.spectator_device_key).css("display","inline-block").show(0):$("#reveal-key").html("")},updateSetStatus:function(){var cs=null==APP.session.current_set?1:APP.session.current_set+1,score=APP.session.getLegsStanding(),score1=score.split(" - ")[0],score2=score.split(" - ")[1];$("#sb-floating-set-score #score1").text(score1),$("#sb-floating-set-score #score2").text(score2),$("#sb-floating-set-score #set-marker").text(APP.session.getMatchFormatSummaryFirstTo()),$("#reveal-center").html('<div style="padding:0 0.5em;margin:0 auto;display:inline-block;">Set '+cs+'</div><div style="padding:0 0.5em;margin:0 auto;display:inline-block;">'+APP.session.getLegsStanding()+"</div>")},showGameTime:function(in_text){$("#reveal-center").text(in_text)},resetEOGStatsPanel:function(){$("#eog-stats > tr").each((function(index,el){$(el).hasClass("template")||$(el).remove()}))},buildEOGStatsPanel:function(){var g,i,j,cm,s,len,da0,da1,db0,db1,stat0,stat1,r3da_0,r3da_1,oppo_0,oppo_1,initials_0,initials_1,first_peak_r3da_0,first_peak_r3da_1,solo,o_data=[{},{}],cr=APP.game.current_round,dist_row=(APP.game.winning_opponent,APP.game.getHighestPoints(),0),mark_row=0;function getOpponentData(in_data,in_oppo,in_index){var d,i,p,f,l,len;for((d=in_data[in_index]).ss=in_oppo.getStartingScore(),d.cs=in_oppo.getCurrentScore(),d.names=[],len=in_oppo.team.players.length,i=0;i<len;i++)f=(p=in_oppo.team.players[i]).first_name,l=p.last_name||"",d.names.push({first:f,last:l})}function countPoints(in_oppo,in_start_points,in_end_points){var i,p,cr=APP.game.current_round,cnt=0,val=0;for(i=0;i<=cr;i++)null!=(p=in_oppo.turn[i].points)&&p>=in_start_points&&p<=in_end_points&&(val+=p,cnt++);return{count:cnt,value:val}}function countBulls(in_oppo,in_bulls,in_bull_target_index){var i,cr=APP.game.current_round,cnt=0;for(i=0;i<=cr;i++)in_oppo.turn[i].target_marks[in_bull_target_index]==in_bulls&&cnt++;return{count:cnt,value:cnt*in_bulls}}function countMarks(in_oppo,in_start_marks,in_end_marks){var i,m,cr=APP.game.current_round,cnt=0,val=0;for(i=0;i<=cr;i++)null!=(m=in_oppo.turn[i].marks_scored)&&m>=in_start_marks&&m<=in_end_marks&&(cnt++,val+=m);return{count:cnt,value:val}}function countColor(in_oppo,in_color){var i,cr=APP.game.current_round,cnt=0;for(i=0;i<=cr;i++)in_oppo.turn[i].color==in_color&&cnt++;return{count:cnt,value:0}}function percent(in_a,in_b){return in_a&&in_b?parseFloat((in_a/in_b*100).toFixed(2)):0}function formatTDA(in_tda,in_missing_text){return null==in_tda?null==in_missing_text?"":in_missing_text:in_tda.toFixed(1)}function highlightRecap(in_opponent,in_row){$("#esp-r-"+in_row+" > .esp-r-"+in_opponent).addClass("esp-r-highlight")}function addRecapRow(in_row,in_value_0,in_initials_0,in_r3da_0,in_value_1,in_initials_1,in_r3da_1){var id,st,tda_decimals;st=g.getOption("stats_type"),id="esp-r-"+in_row,$("#esp-r-x").clone(!0).attr("id",id).appendTo("#esp-recap").removeClass("template"),in_row%2==0?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),tda_decimals="MARKS"==st?1:0,$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).html(null==in_r3da_0?"":parseFloat(in_r3da_0).toFixed(tda_decimals));break;case 1:$(el).html(null==in_value_0?"":in_initials_0);break;case 2:$(el).html(null==in_value_0?"":in_value_0),"MARKS"==st?$(el).addClass("esp-r-score-marks-0"):$(el).addClass("esp-r-score-points-0");break;case 3:$(el).html(in_row+1);break;case 4:$(el).html(null==in_value_1?"":""+in_value_1),"MARKS"==st?$(el).addClass("esp-r-score-marks-1"):$(el).addClass("esp-r-score-points-1");break;case 5:$(el).html(null==in_value_1?"":in_initials_1);break;case 6:$(el).html(null==in_r3da_1?"":parseFloat(in_r3da_1).toFixed(tda_decimals))}}))}function addDistRow(in_label,in_data_0,in_data_1,in_percent_0,in_percent_1){var id;""!==in_label&&function(in_label,in_data_0,in_data_1,in_percent_0,in_percent_1){APP.game.opponent[0].stats.distributions[in_label]={count:""==in_data_0.count?0:in_data_0.count,value:""==in_data_0.value?0:in_data_0.value,percent:""==in_percent_0?0:in_percent_0},APP.game.opponent[1].stats.distributions[in_label]={count:""==in_data_1.count?0:in_data_1.count,value:""==in_data_1.value?0:in_data_1.value,percent:""==in_percent_1?0:in_percent_1}}(in_label,in_data_0,in_data_1,in_percent_0,in_percent_1),id="esp-d-"+ ++dist_row,$("#esp-d-x").clone(!0).attr("id",id).appendTo("#esp-dist").removeClass("template"),dist_row%2==0?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),""!==in_label?$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).html(null==in_data_0.count?"n/a":""==in_data_0.count||0==in_data_0.value?"":in_data_0.value);break;case 1:$(el).html(null==in_percent_0?"n/a":""==in_percent_0?"":in_percent_0.toFixed(0)+"%");break;case 2:$(el).html(null==in_data_0.count?"n/a":""==in_data_0.count?"":in_data_0.count);break;case 3:$(el).html(in_label);break;case 4:$(el).html(null==in_data_1.count?"n/a":""==in_data_1.count?"":in_data_1.count);break;case 5:$(el).html(null==in_percent_1?"n/a":""==in_percent_1?"":in_percent_1.toFixed(0)+"%");break;case 6:$(el).html(null==in_data_1.count?"n/a":""==in_data_1.count||0==in_data_1.value?"":in_data_1.value)}})):$("#"+id+" > .esp-d-label").html("&nbsp;")}function addMarksRow(in_label,in_data_0,in_data_1,in_percent_0,in_percent_1){var id;id="esp-m-"+ ++mark_row,$("#esp-m-x").clone(!0).attr("id",id).appendTo("#esp-marks").removeClass("template"),mark_row%2==0?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),""!=in_label?$("#"+id+" > td").each((function(index,el){switch(index){case 1:$(el).html(null==in_percent_0?"n/a":""==in_percent_0?"":in_percent_0.toFixed(0)+"%");break;case 2:$(el).html(null==in_data_0?"n/a":""==in_data_0?"":in_data_0);break;case 3:$(el).html(in_label);break;case 4:$(el).html(null==in_data_1?"n/a":""==in_data_1?"":in_data_1);break;case 5:$(el).html(null==in_percent_1?"n/a":""==in_percent_1?"":in_percent_1.toFixed(0)+"%")}})):$("#"+id+" > .esp-m-label").html("&nbsp;")}function formatTopThree(in_value){return in_value||""}function formatNA(in_value,in_na_text){return in_value||in_na_text}for(cm=APP.session.matches[APP.session.current_match],solo=1==(g=APP.game).opponent_count,oppo_0=g.opponent[0],oppo_1=g.opponent[1],oppo_0.stats.distributions={},oppo_1.stats.distributions={},getOpponentData(o_data,oppo_0,0),getOpponentData(o_data,oppo_1,1),0,0,len=(s=cm.sets).length,i=0;i<len;i++)s[i].game_results.length,i==len-1&&s[i].game_results.length;if($("#esp-h-formal-game-name").html(APP.game.getGameName(!0)),$("#esp-h-f3-w"+APP.game.opponent_order[0]).html(APP.game.shot_for_bull?'<span class="text-gold">Cork</span>':"Start"),$("#esp-h-f3-v0").html(oppo_0.stats.tda_first_3),$("#esp-h-f3-v1").html(solo?"":formatTDA(oppo_1.stats.tda_first_3)),oppo_0.handicap>0&&$("#esp-h-b3-w0").html("HC "+oppo_0.handicap),$("#esp-h-b3-v0").html(formatTDA(oppo_0.stats.tda_others,"n/a")),$("#esp-h-b3-v1").html(solo?"":formatTDA(oppo_1.stats.tda_others,"n/a")),oppo_1.handicap>0&&$("#esp-h-b3-w1").html("HC "+oppo_1.handicap),$("#esp-h-l3-w"+APP.game.winning_opponent).html("Win"),$("#esp-h-l3-v0").html(oppo_0.stats.tda_last_3),$("#esp-h-l3-v1").html(solo?"":formatTDA(oppo_1.stats.tda_last_3)),$("#esp-h-t1-v0").html(formatTopThree(oppo_0.stats.top_three[0])),$("#esp-h-t1-v1").html(solo?"":formatTopThree(oppo_1.stats.top_three[0])),$("#esp-h-t2-v0").html(formatTopThree(oppo_0.stats.top_three[1])),$("#esp-h-t2-v1").html(solo?"":formatTopThree(oppo_1.stats.top_three[1])),$("#esp-h-t3-v0").html(formatTopThree(oppo_0.stats.top_three[2])),$("#esp-h-t3-v1").html(solo?"":formatTopThree(oppo_1.stats.top_three[2])),$("#esp-h-t2-w0").html(oppo_0.stats.top_three[0]+oppo_0.stats.top_three[1]+oppo_0.stats.top_three[2]),$("#esp-h-t2-w1").html(solo?"":oppo_1.stats.top_three[0]+oppo_1.stats.top_three[1]+oppo_1.stats.top_three[2]),"POINTS"==g.getOption("stats_type")){for("Library"==APP.game.name?($("#esp-notables").hide(0),$("#esp-3da").hide(0)):($("#esp-h-3da-label-0").html("Points Per Round"),$("#esp-h-3da-value-0").html(oppo_0.stats.darts_thrown?(oppo_0.stats.points/oppo_0.stats.darts_thrown).toFixed(1)+" PPD":"0 PPD"),1==g.opponent_count?($("#esp-h-3da-label-1").html(""),$("#esp-h-3da-value-1").html("")):($("#esp-h-3da-label-1").html("Points Per Round"),$("#esp-h-3da-value-1").html(oppo_1.stats.darts_thrown?(oppo_1.stats.points/oppo_1.stats.darts_thrown).toFixed(1)+" PPD":"0 PPD")),$("#esp-h-scored-label").html("Points Scored"),$("#esp-h-scored-0").html(oppo_0.stats.points),$("#esp-h-scored-1").html(oppo_1.stats.points),$("#esp-h-darts-0").html(oppo_0.stats.darts_thrown),$("#esp-h-darts-1").html(oppo_1.stats.darts_thrown),$("#esp-h-v1-label").html("Miss Turns"),$("#esp-h-v1-v0").html(oppo_0.stats.turns_miss),$("#esp-h-v1-v1").html(solo?"":oppo_1.stats.turns_miss),$("#esp-h-v2-label").html("Bust Turns"),$("#esp-h-v2-v0").html(oppo_0.stats.turns_bust),$("#esp-h-v2-v1").html(solo?"":oppo_1.stats.turns_bust),$("#esp-h-v3-label").html("DI 3DA"),$("#esp-h-v3-v0").html(formatTDA(oppo_0.stats.double_in_3da,"n/a")),$("#esp-h-v3-v1").html(solo?"":formatTDA(oppo_1.stats.double_in_3da,"n/a")),$(".esp-3-wing").html(""),$("#esp-3-label").html("Points Per Round (3DA)"),$("#esp-3-fv-0").html(formatTDA(oppo_0.stats.tda_first_3)),$("#esp-3-bv-0").html(formatTDA(oppo_0.stats.tda_others)),$("#esp-3-lv-0").html(formatTDA(oppo_0.stats.tda_last_3)),$("#esp-3-gv-0").html(formatTDA(oppo_0.stats.ppr)),$("#esp-3-fv-1").html(formatTDA(oppo_1.stats.tda_first_3)),$("#esp-3-bv-1").html(formatTDA(oppo_1.stats.tda_others)),$("#esp-3-lv-1").html(formatTDA(oppo_1.stats.tda_last_3)),$("#esp-3-gv-1").html(formatTDA(oppo_1.stats.ppr)),$("#esp-3-bav-0").html(oppo_0.stats.points),$("#esp-3-lav-0").html(oppo_0.stats.darts_thrown),$("#esp-3-gav-0").html(formatTDA(oppo_0.stats.ppd)),$("#esp-3-bal-0").html("Points"),$("#esp-3-lal-0").html("Darts"),$("#esp-3-gal-0").html("PPD"),$("#esp-3-bav-1").html(oppo_1.stats.points),$("#esp-3-lav-1").html(oppo_1.stats.darts_thrown),$("#esp-3-gav-1").html(formatTDA(oppo_1.stats.ppd)),$("#esp-3-bal-1").html("Points"),$("#esp-3-lal-1").html("Darts"),$("#esp-3-gal-1").html("PPD")),$(".esp-r-wing").html("01"==APP.game.name?"PPR":""),first_peak_r3da_0=0,first_peak_r3da_1=0,i=0;i<=cr;i++)da0=0==(da0=oppo_0.getTurnPoints(i))?oppo_0.getTurnColor(i):da0,r3da_0=oppo_0.turn[i].r3da,initials_0=oppo_0.getPlayerInitials(oppo_0.turn[i].player_index),r3da_0>oppo_0.turn[first_peak_r3da_0].r3da&&(first_peak_r3da_0=i),da1=0==(da1=oppo_1.getTurnPoints(i))?oppo_1.getTurnColor(i):da1,r3da_1=oppo_1.turn[i].r3da,initials_1=oppo_1.getPlayerInitials(oppo_1.turn[i].player_index),r3da_1>oppo_1.turn[first_peak_r3da_1].r3da&&(first_peak_r3da_1=i),addRecapRow(i,da0,initials_0,r3da_0,da1,initials_1,r3da_1);highlightRecap(0,first_peak_r3da_0),highlightRecap(1,first_peak_r3da_1),"Library"==APP.game.name?$("#esp-dist").hide(0):($(".esp-d-wing").html("T.Points"),db0=oppo_0.getStat("turns_played"),db1=oppo_1.getStat("turns_played"),da0=countPoints(oppo_0,180,9999),da1=countPoints(oppo_1,180,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("180",da0,da1,stat0,stat1),da0=countPoints(oppo_0,140,9999),da1=countPoints(oppo_1,140,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("140+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,100,9999),da1=countPoints(oppo_1,100,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("100+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,95,9999),da1=countPoints(oppo_1,95,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("95+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,60,9999),da1=countPoints(oppo_1,60,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("60+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,20,9999),da1=countPoints(oppo_1,20,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("20+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,10,9999),da1=countPoints(oppo_1,10,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("10+",da0,da1,stat0,stat1),da0=countPoints(oppo_0,1,9999),da1=countPoints(oppo_1,1,9999),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("1+",da0,da1,stat0,stat1),da0=countColor(oppo_0,"MISS"),da1=countColor(oppo_1,"MISS"),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("Miss",da0,da1,stat0,stat1),da0=countColor(oppo_0,"BUST"),da1=countColor(oppo_1,"BUST"),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("Bust",da0,da1,stat0,stat1),addDistRow(""),da0=countPoints(oppo_0,180,180),da1=countPoints(oppo_1,180,180),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("180",da0,da1,stat0,stat1),da0=countPoints(oppo_0,140,179),da1=countPoints(oppo_1,140,179),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("140-179",da0,da1,stat0,stat1),da0=countPoints(oppo_0,100,139),da1=countPoints(oppo_1,100,139),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("100-139",da0,da1,stat0,stat1),da0=countPoints(oppo_0,60,99),da1=countPoints(oppo_1,60,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("60-99",da0,da1,stat0,stat1),da0=countPoints(oppo_0,20,59),da1=countPoints(oppo_1,20,59),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("20-59",da0,da1,stat0,stat1),da0=countPoints(oppo_0,10,19),da1=countPoints(oppo_1,10,19),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("10-19",da0,da1,stat0,stat1),da0=countPoints(oppo_0,1,9),da1=countPoints(oppo_1,1,9),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("1-9",da0,da1,stat0,stat1),da0=countPoints(oppo_0,0,0),da1=countPoints(oppo_1,0,0),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("0",da0,da1,stat0,stat1))}if("MARKS"==g.getOption("stats_type")){if("Library"==APP.game.name)$("#esp-notables").hide(0),$("#esp-3da").hide(0);else{$("#esp-h-3da-label-0").html("Marks Per Round"),$("#esp-h-3da-value-0").html(oppo_0.stats.darts_thrown?(oppo_0.stats.marks_scored/oppo_0.stats.darts_thrown).toFixed(2)+" MPD":"0 MPD"),1==g.opponent_count?($("#esp-h-3da-label-1").html(""),$("#esp-h-3da-value-1").html("")):($("#esp-h-3da-label-1").html("Marks Per Round"),$("#esp-h-3da-value-1").html(oppo_1.stats.darts_thrown?(oppo_1.stats.marks_scored/oppo_1.stats.darts_thrown).toFixed(2)+" MPD":"0 MPD")),$("#esp-h-scored-label").html("Marks Scored"),$("#esp-h-scored-0").html(oppo_0.stats.marks_scored),$("#esp-h-scored-1").html(oppo_1.stats.marks_scored),$("#esp-h-darts-0").html(oppo_0.stats.darts_thrown),$("#esp-h-darts-1").html(oppo_1.stats.darts_thrown),$("#esp-h-v1-label").html("Miss Turns"),$("#esp-h-v1-v0").html(oppo_0.stats.turns_miss),$("#esp-h-v1-v1").html(oppo_1.stats.turns_miss);var na_text=g.options.marksman_scoring?"0":"n/a";$("#esp-h-v2-label").html("Missed Darts"),$("#esp-h-v2-v0").html(formatNA(oppo_0.stats.darts_missed,na_text)),$("#esp-h-v2-v1").html(formatNA(oppo_1.stats.darts_missed,1==g.opponent_count?"":na_text)),$("#esp-h-v3-label").html("Scored Triples"),$("#esp-h-v3-v0").html(formatNA(oppo_0.stats.darts_triples,na_text)),$("#esp-h-v3-v1").html(formatNA(oppo_1.stats.darts_triples,1==g.opponent_count?"":na_text)),$(".esp-3-wing").html(""),$("#esp-3-label").html("Marks Per Round (3DA)"),$("#esp-3-fv-0").html(formatTDA(oppo_0.stats.tda_first_3)),$("#esp-3-bv-0").html(formatTDA(oppo_0.stats.tda_others)),$("#esp-3-lv-0").html(formatTDA(oppo_0.stats.tda_last_3)),$("#esp-3-gv-0").html(formatTDA(oppo_0.stats.mpr)),$("#esp-3-fv-1").html(formatTDA(oppo_1.stats.tda_first_3)),$("#esp-3-bv-1").html(formatTDA(oppo_1.stats.tda_others)),$("#esp-3-lv-1").html(formatTDA(oppo_1.stats.tda_last_3)),$("#esp-3-gv-1").html(formatTDA(oppo_1.stats.mpr)),$("#esp-3-bav-0").html(oppo_0.stats.marks_scored),$("#esp-3-lav-0").html(oppo_0.stats.darts_thrown),$("#esp-3-gav-0").html(formatTDA(oppo_0.stats.mpd)),$("#esp-3-bal-0").html("Marks"),$("#esp-3-lal-0").html("Darts"),$("#esp-3-gal-0").html("MPD"),$("#esp-3-bav-1").html(oppo_1.stats.marks_scored),$("#esp-3-lav-1").html(oppo_1.stats.darts_thrown),$("#esp-3-gav-1").html(formatTDA(oppo_1.stats.mpd)),$("#esp-3-bal-1").html("Marks"),$("#esp-3-lal-1").html("Darts"),$("#esp-3-gal-1").html("MPD"),g.getOption("marksman_scoring")&&($("#esp-marks").removeClass("disabled"),db0=oppo_0.getStat("darts_thrown"),db1=oppo_1.getStat("darts_thrown"),da0=oppo_0.getStat("darts_missed"),da1=oppo_1.getStat("darts_missed"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Missed Darts",da0,da1=0==da1?"":da1,stat0,stat1),da0=oppo_0.getStat("darts_triples"),da1=oppo_1.getStat("darts_triples"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Triples",da0,da1=0==da1?"":da1,stat0,stat1),da0=oppo_0.getStat("darts_singles"),da1=oppo_1.getStat("darts_singles"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Singles",da0,da1=0==da1?"":da1,stat0,stat1),da0=oppo_0.getStat("darts_doubles"),da1=oppo_1.getStat("darts_doubles"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Doubles",da0,da1=0==da1?"":da1,stat0,stat1),da0=oppo_0.getStat("darts_single_bulls"),da1=oppo_1.getStat("darts_single_bulls"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Single Bulls",da0,da1=0==da1?"":da1,stat0,stat1),da0=oppo_0.getStat("darts_double_bulls"),da1=oppo_1.getStat("darts_double_bulls"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Double Bulls",da0,da1=0==da1?"":da1,stat0,stat1),addMarksRow(""),addMarksRow("Marks Recorded",da0=0==(da0=oppo_0.getStat("marks_recorded"))?"":da0,da1=0==(da1=oppo_1.getStat("marks_recorded"))?"":da1,"",""),db0=oppo_0.getStat("marks_recorded"),db1=oppo_1.getStat("marks_recorded"),da0=oppo_0.getStat("marks_scored"),da1=oppo_1.getStat("marks_scored"),stat0=0==da0?"":percent(da0,db0),da0=0==da0?"":da0,stat1=0==da1?"":percent(da1,db1),addMarksRow("Marks Scored",da0,da1=0==da1?"":da1,stat0,stat1))}for($(".esp-r-wing").html("Cricket"==APP.game.name?"MPR":""),first_peak_r3da_0=0,first_peak_r3da_1=0,i=0;i<=cr;i++)try{da0=oppo_0.getUserInput(i),da0="Library"==APP.game.name?"0"==da0[0]?oppo_0.getTurnColor(i):APP.message_bar.formatValueFactors(da0):"0"==da0[0]?oppo_0.getTurnColor(i):APP.message_bar.formatTargetHits(da0),r3da_0=oppo_0.turn[i].r3da,initials_0=oppo_0.getPlayerInitials(oppo_0.turn[i].player_index),r3da_0>oppo_0.turn[first_peak_r3da_0].r3da&&(first_peak_r3da_0=i),da1=oppo_1.getUserInput(i),da1="Library"==APP.game.name?"0"==da1[0]?oppo_1.getTurnColor(i):APP.message_bar.formatValueFactors(da1):"0"==da1[0]?oppo_1.getTurnColor(i):APP.message_bar.formatTargetHits(da1),r3da_1=oppo_1.turn[i].r3da,initials_1=oppo_1.getPlayerInitials(oppo_1.turn[i].player_index),r3da_1>oppo_1.turn[first_peak_r3da_1].r3da&&(first_peak_r3da_1=i),addRecapRow(i,da0,initials_0,r3da_0,da1,initials_1,r3da_1)}catch(e){}if(highlightRecap(0,first_peak_r3da_0),highlightRecap(1,first_peak_r3da_1),"Library"==APP.game.name)$("#esp-dist").hide(0);else{for($(".esp-d-wing").html("T.Marks"),db0=oppo_0.getStat("turns_played"),db1=oppo_1.getStat("turns_played"),da0=countMarks(oppo_0,9,99),da1=countMarks(oppo_1,9,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("9",da0,da1,stat0,stat1),da0=countMarks(oppo_0,8,99),da1=countMarks(oppo_1,8,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("8+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,7,99),da1=countMarks(oppo_1,7,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("7+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,6,99),da1=countMarks(oppo_1,6,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("6+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,5,99),da1=countMarks(oppo_1,5,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("5+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,4,99),da1=countMarks(oppo_1,4,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("4+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,3,99),da1=countMarks(oppo_1,3,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("3+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,2,99),da1=countMarks(oppo_1,2,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("2+",da0,da1,stat0,stat1),da0=countMarks(oppo_0,1,99),da1=countMarks(oppo_1,1,99),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("1+",da0,da1,stat0,stat1),da0=countColor(oppo_0,"MISS"),da1=countColor(oppo_1,"MISS"),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow("Miss Turns",da0,da1,stat0,stat1),addDistRow(""),j=9;j>=0;j--)da0=countMarks(oppo_0,j,j),da1=countMarks(oppo_1,j,j),stat0=0==da0.count?"":percent(da0.count,db0),da0.count=0==da0.count?"":da0.count,stat1=0==da1.count?"":percent(da1.count,db1),da1.count=0==da1.count?"":da1.count,addDistRow(j,da0,da1,stat0,stat1);if(!APP.game.getOption("no_bull")){var bull_index=function(){var i,t=APP.game.target;for(i=t.length-1;i>=0;i--)if("B"==t[i].label)return i;return null}();for(addDistRow(""),j=6;j>0;j--)da0=countBulls(oppo_0,j,bull_index),da1=countBulls(oppo_1,j,bull_index),da0.count=0==da0.count?"":da0.count,da1.count=0==da1.count?"":da1.count,addDistRow(j+" Bull"+(1==j?"":"s"),da0,da1,"","")}}}},slideUpPanel:function(in_panel_id,in_callback,no_animate){no_animate||APP.reveal.force_no_animate&&(no_animate=!0);var el=$("#"+in_panel_id),elt=$("#reveal-bar").height()+$("#button-bar").outerHeight(!0)+$("#message-bar").outerHeight(!0),rh=$("#reveal").height(),animationTime=250;(APP.is_reloading||no_animate)&&(animationTime=0),(APP.device.has_chalk||APP.game.finished)&&APP.reveal.showPanel(APP.reveal.current_panel_id,(function(){el.css("height",rh-elt).css("bottom",-rh).show(0).animate({bottom:0},{duration:animationTime,queue:!1,complete:function(){"function"==typeof in_callback&&in_callback()}})}))},slideDownPanel:function(in_panel_id,in_callback,no_animate){no_animate||APP.reveal.force_no_animate&&(no_animate=!0);var el=$("#"+in_panel_id),animationTime=250;(APP.is_reloading||no_animate)&&(animationTime=0),el.animate({bottom:-el.height()},{duration:animationTime,queue:!1,complete:function(){el.hide(0),"function"==typeof in_callback&&in_callback()}})},showButtonBar:function(in_button_bar_id,in_cancel_label,in_callback,no_animate){no_animate||APP.reveal.force_no_animate&&(no_animate=!0);var el_height,rvl,rvl_height,sb,sb_height,bba=$(".button-bar-active"),el=$("#"+in_button_bar_id),pending=1;function checkIn(){--pending||"function"!=typeof in_callback||in_callback()}if(APP.reveal.setNewSetButton(),"button-bar-match"==in_button_bar_id&&(APP.device.disableButton("bb-e-reload"),APP.session.allowReloadPriorLeg()&&APP.device.enableButton("bb-e-reload",!0)),(APP.device.has_chalk||"button-bar-guest"==in_button_bar_id)&&!el.hasClass("button-bar-active")){if("button-bar-ingame"==in_button_bar_id&&$("#bb-ig-cancel").text(in_cancel_label),APP.is_reloading&&(no_animate=!0),bba.length)return bba.removeClass("button-bar-active").hide(0),el.addClass("button-bar-active").fadeIn(no_animate?0:250),void("function"==typeof in_callback&&in_callback());sb_height=(sb=$("#scoreboard")).height(),el.show(0).addClass("button-bar-active"),el_height=el.outerHeight(!0),null!=APP.reveal.current_panel_id&&pending++,rvl_height=(rvl=$("#reveal")).height(),rvl.animate({height:rvl_height+el_height},{duration:no_animate?0:125,queue:!1,complete:function(){checkIn()}}),$("#button-bar").animate({height:el_height},{duration:no_animate?0:125,queue:!1,complete:function(){checkIn()}}),sb_height>0&&(pending++,sb.animate({height:sb_height-el_height},{duration:no_animate?0:125,queue:!1,complete:function(){checkIn()}}))}},hideButtonBar:function(in_callback,in_override_chalk,no_animate){var rvl,rvl_height,sb,sb_height,el_height;no_animate||APP.reveal.force_no_animate&&(no_animate=!0);var el=$(".button-bar-active"),pending=2;if(!el.length)return pending=1,void checkIn();function checkIn(){--pending||"function"!=typeof in_callback||in_callback()}APP.is_reloading&&(no_animate=!0),(APP.device.has_chalk||in_override_chalk)&&el.length&&(sb_height=(sb=$("#scoreboard")).height(),el_height=el.outerHeight(!0),null!=APP.reveal.current_panel_id&&(pending++,rvl_height=(rvl=$("#reveal")).height(),rvl.animate({height:rvl_height-el_height},{duration:no_animate?0:125,queue:!1,complete:function(){checkIn()}})),$("#button-bar").animate({height:0},{duration:no_animate?0:125,queue:!1,complete:function(){checkIn(),el.removeClass("button-bar-active").hide(0)}}),sb.animate({height:sb_height+el_height},{duration:no_animate?0:125,queue:!1,complete:function(){APP.scoreboard.enableScrolling(),checkIn()}}))},showPanel:function(in_panel_id,in_callback,no_animate){var el,sb,target,sb_height,el_height,rvl_height;no_animate||APP.reveal.force_no_animate&&(no_animate=!0),APP.reveal.is_down?(target=in_panel_id||APP.reveal.current_panel_id,el=$("#"+target),sb_height=(sb=$("#scoreboard")).height(),el.show(0),el_height=el.height(),rvl_height=$("#reveal-bar").height()+$("#button-bar").outerHeight(!0)+$("#message-bar").outerHeight(!0)+el_height,$("#reveal").css("height",rvl_height),"HOST"==APP.device.role||"PARTICIPANT"==APP.device.role||APP.game.finished?no_animate?(sb.height(sb_height-el_height),APP.reveal.current_panel_id=target,APP.reveal.is_down=!1,"function"==typeof in_callback&&in_callback()):sb.animate({height:sb_height-el_height},{duration:APP.is_reloading?0:250,queue:!1,complete:function(){APP.reveal.current_panel_id=target,APP.reveal.is_down=!1,"function"==typeof in_callback&&in_callback()}}):APP.reveal.current_panel_id=target):"function"==typeof in_callback&&in_callback()},hidePanel:function(in_callback,no_animate){no_animate||APP.reveal.force_no_animate&&(no_animate=!0);var rvl_height,cb=$("#chalkboard"),hd=$("#header"),sb=$("#scoreboard"),el=$("#"+APP.reveal.current_panel_id);if("opponents-panel"==APP.reveal.current_panel_id&&$("#header").show(0),APP.reveal.is_down)"function"==typeof in_callback&&in_callback();else{rvl_height=$("#reveal-bar").height()+$("#button-bar").outerHeight(!0)+$("#message-bar").outerHeight(!0);var duration=250;(APP.is_reloading||APP.starpubs.isStarPubsMatch())&&(duration=0),no_animate?(sb.height(cb.outerHeight()-hd.outerHeight()-rvl_height),el.hide(0),$("#reveal").css("height",rvl_height),APP.reveal.is_down=!0,"function"==typeof in_callback&&in_callback()):sb.animate({height:cb.outerHeight()-hd.outerHeight()-rvl_height},{duration:duration,queue:!1,complete:function(){el.hide(0),$("#reveal").css("height",rvl_height),APP.reveal.is_down=!0,"function"==typeof in_callback&&in_callback()}})}},clearAllPanels:function(in_callback){APP.reveal.hidePanel((function(){$(".reveal-panel").hide(0),APP.reveal.current_panel_id=null,"function"==typeof in_callback&&in_callback()}))}},APP.message_bar={prev_funcl:{time:null,func:null},prev_funcr:{time:null,func:null},pregame_message:"",promo:null,pause_promo:!1,isPromoActive:!1,init:function(){APP.message_bar.promo=BBAT.fetchData("promo")||{},APP.device.addFieldHandler(["message-bar-status"],APP.handleEOGMenuOption),APP.device.addFieldHandler(["popup-promo"],APP.message_bar.hidePromo),APP.device.addFieldHandler(["custom-popup-promo"],APP.message_bar.hideCustomPromo),APP.device.addButtonHandler(["mb-s-m3da-0","mb-s-m3da-1"],(function(in_id){APP.session.buildSummary(null,!0),APP.session.showSummary(),"mb-s-set"==in_id?$("#pss-scroll-box").scrollTop(0):$("#pss-scroll-box").scrollTop(999999)}))},customPromoArr:["pdceuqs23s1e1","pdcukqs23s1e1","pdceuqs23fse2","pdcukqs23fse2","pdceuqs23s1e3","pdcukqs23s1e3","pdceuqs23fse4","pdcukqs23fse4","pdceuqs23fse3","pdcukqs23fse3","pdceuqs23fse2","pdcukqs23fse2","pdceuqs23fse1","pdcukqs23fse1"],customPromo:function(){if(!$("#custom-popup-promo:visible").length){$("#cpp-loading").show(),$("#cpp-img").hide();$("#custom-popup-promo").fadeIn(500),$("#cpp-img").attr("src","https://dartconnect.com/b/app-2023-pdc-q-school.jpg?v=1"),$("#cpp-img")[0].naturalWidth?($("#cpp-loading").hide(),$("#cpp-img").show()):$("#cpp-img").on("load",(function(){$("#cpp-loading").hide(),$("#cpp-img").show()}))}},customLeaguePromo:function(){if(!$("#custom-popup-promo:visible").length){var imgUrl;$("#cpp-loading").show(),$("#cpp-img").hide();var leagueHasSchedule=!1;try{APP.nlf.data.league.league_schedule&&(leagueHasSchedule=!0)}catch(e){}imgUrl=leagueHasSchedule?"https://dartconnect.com/b/app-go-premium-scheduled-optimized.jpg":"https://dartconnect.com/b/app-go-premium-unscheduled-optimized.jpg",$("#custom-popup-promo").fadeIn(500),$("#cpp-img").attr("src",imgUrl),$("#cpp-img")[0].naturalWidth?($("#cpp-loading").hide(),$("#cpp-img").show()):$("#cpp-img").on("load",(function(){$("#cpp-loading").hide(),$("#cpp-img").show()}))}},leaguePromoCheck:function(){return!1},showPromo:function(in_test_1,in_test_2,in_test_3,in_preview,in_dctv_only){if(!APP.message_bar.pause_promo&&!APP.practicePopup.isShowing&&!(APP.cif.data.pageNo>0||APP.nlf.data.rails&&"PRE-ROLE"!==APP.mode||APP.session.isBracketMatchListing&&$(".pbml-button").length)){if($("#pp-line-1").attr("data-preview",in_preview?"T":"F"),APP.session.isSummaryShowing()?($("#pp-logo").hide(0),$("#pp-opponent-0").html($("#pss-name-0").text()),$("#pp-opponent-1").html($("#pss-name-1").text()),$("#pp-opponent-section").show(0)):APP.header.players_checked_in?($("#pp-logo").hide(0),$("#pp-opponent-0").html(APP.game.opponent[0].chalkboard_name),$("#pp-opponent-1").html(APP.game.opponent[1].chalkboard_name),$("#pp-opponent-section").show(0)):($("#pp-logo").show(0),$("#pp-opponent-section").hide(0)),in_preview?($("#pp-line-1").html(in_test_1),$("#pp-line-2").html(in_test_2),$("#pp-line-3").html(in_test_3)):($("#pp-line-1").html(APP.message_bar.promo.line_1),$("#pp-line-2").html(APP.message_bar.promo.line_2),$("#pp-line-3").html(APP.message_bar.promo.line_3)),!in_dctv_only){var cpArr=APP.message_bar.customPromoArr;if(cpArr.length)for(var i=0;i<cpArr.length;i++){var tournamentId=cpArr[i];if(APP.session.getTournamentID()==tournamentId)return void APP.message_bar.customPromo()}if(APP.message_bar.leaguePromoCheck())return APP.message_bar.customLeaguePromo(),void(APP.device.is_broadcasting&&!in_preview&&APP.server.postBroadcast({screen_saver:$("#popup-promo").html()}));$("#popup-promo").fadeIn(500)}APP.device.is_broadcasting&&!in_preview&&APP.server.postBroadcast({screen_saver:$("#popup-promo").html()}),APP.message_bar.isPromoActive=!0}},hidePromo:function(){$("#popup-promo").hide(0),APP.device.is_broadcasting&&"F"==$("#pp-line-1").attr("data-preview")&&APP.server.postBroadcast({screen_saver:""}),APP.message_bar.isPromoActive=!1},hideCustomPromo:function(){$("#custom-popup-promo").hide(0),APP.device.is_broadcasting&&"F"==$("#pp-line-1").attr("data-preview")&&APP.server.postBroadcast({screen_saver:""})},turnOffPromo:function(){var p=APP.message_bar.promo;p.active=!1,BBAT.storeData({promo:p})},resetPromo:function(){var mbr=APP.message_bar;mbr.promo.line_1="",mbr.promo.line_2="",mbr.promo.line_3="",mbr.promo.active=!1,BBAT.flushData("promo")},show:function(in_message_bar_id){$("#message-bar > div").hide(0),$("#"+in_message_bar_id).show(0)},showQuickFinish:function(in_handler,in_min_dart){var i;for(APP.message_bar.display(""),i=1;i<=3;i++)$("#qf-dart-x").clone(!0).appendTo("#mb-ig-message").attr("id","qf-dart-"+i).html(i).removeClass("template");switch(APP.device.addButtonHandler(["qf-dart-1","qf-dart-2","qf-dart-3"],in_handler),APP.device.disableButtonClass("qf-dart"),in_min_dart){case 1:APP.device.enableButtonClass("qf-dart");break;case 2:APP.device.enableButton("qf-dart-2"),APP.device.enableButton("qf-dart-3");break;case 3:APP.device.enableButton("qf-dart-3")}},fakePrevFuncr:function(in_func){var prev=APP.message_bar.prev_funcr;prev.func=in_func,prev.time=new Date},getFunc:function(in_func_name,in_test_transition_only){var ms,new_func,new_time,old_func,old_time,prev,el;if("funcl"==in_func_name?(el=$("#mb-ig-funcl"),prev=APP.message_bar.prev_funcl,new_func=el.hasClass("message-bar-backspace")?"backspace":el.hasClass("message-bar-back")?"back":"delete"):(el=$("#mb-ig-funcr"),prev=APP.message_bar.prev_funcr,new_func=el.hasClass("message-bar-enter")?"enter":el.hasClass("message-bar-bust")?"bust":"miss"),old_func=prev.func,testbot.isRunning)return new_func;if(old_time=prev.time||0,ms=(new_time=new Date)-old_time,in_test_transition_only){if(new_func!=old_func&&ms<1e3)return null}else if(ms<1e3)return null;return prev.func=new_func,prev.time=new_time,new_func},setLeftFunc:function(in_function,in_enabled){switch($("#mb-ig-funcl").removeClass("button-gold"),in_function){case"back":$("#mb-ig-funcl").removeClass("message-bar-backspace").removeClass("message-bar-delete").addClass("message-bar-back").addClass("button").text("BACK"),APP.game.started&&!APP.game.hasAnyoneScored()&&$("#mb-ig-funcl").addClass("button-gold");break;case"backspace":$("#mb-ig-funcl").removeClass("message-bar-delete").removeClass("message-bar-back").addClass("message-bar-backspace").addClass("button").text("UNDO");break;case"delete":$("#mb-ig-funcl").removeClass("message-bar-backspace").removeClass("message-bar-back").addClass("message-bar-delete").addClass("button").html("Replay<br />Turn");break;default:$("#mb-ig-funcl").removeClass("message-bar-backspace").removeClass("message-bar-delete").removeClass("message-bar-back").removeClass("button-up").removeClass("button").text("")}!1===in_enabled?APP.device.disableButton("mb-ig-funcl"):APP.device.enableButton("mb-ig-funcl")},setRightFunc:function(in_function,in_enabled){var miss_txt;switch(in_function){case"miss":miss_txt=1==APP.game.getOption("miss_half")?"1/2":"MISS",$("#mb-ig-funcr").removeClass("button-down").removeClass("message-bar-enter").removeClass("message-bar-bust").addClass("message-bar-miss").addClass("button").text(miss_txt);break;case"enter":$("#mb-ig-funcr").removeClass("button-down").removeClass("message-bar-miss").removeClass("message-bar-bust").addClass("message-bar-enter").addClass("button").text("ENTER");break;case"bust":$("#mb-ig-funcr").removeClass("button-down").removeClass("message-bar-enter").removeClass("message-bar-miss").addClass("message-bar-bust").addClass("button").text("BUST");break;default:$("#mb-ig-funcr").removeClass("button-down").removeClass("message-bar-enter").removeClass("message-bar-miss").removeClass("message-bar-bust").removeClass("button-up").removeClass("button").text("")}!1===in_enabled?APP.device.disableButton("mb-ig-funcr"):APP.device.enableButton("mb-ig-funcr")},enableFuncs:function(){$(".message-bar-function").removeClass("button-disabled")},disableFuncs:function(){$(".message-bar-function").addClass("button-disabled")},clear:function(){$("#mb-h-message").html(""),$("#mb-ig-message").html("&nbsp;")},display:function(in_content,override){if(override)try{if(APP.nlf.data.rails&&APP.nlf.rails.checkWdfRules()){var matchSetUp,setNumber=APP.nlf.data.railsChapter.set_number,chapter=APP.nlf.data.railsChapter,isPairs=!1;"pairs"==APP.nlf.data.league.season_label.toLowerCase()&&(isPairs=!0),isPairs?(matchSetUp=APP.nlf.rails.wdfRules.getDoublesMatchUp(setNumber),chapter&&matchSetUp&&(in_content=`\n\t\t\t\t\t\t\t\t<span class="bold text-gold">\n\t\t\t\t\t\t\t\t\t${matchSetUp[0][0]} - ${matchSetUp[0][1]}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t<span class="text-hint text-gray pSmLeft pSmRight">vs</span>\n\t\t\t\t\t\t\t\t<span class="bold text-gold">\n\t\t\t\t\t\t\t\t\t${matchSetUp[1][0]} - ${matchSetUp[1][1]}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t`)):(matchSetUp=APP.nlf.rails.wdfRules.getMatchUp(setNumber),chapter&&matchSetUp&&(in_content=`\n\t\t\t\t\t\t\t\tSet ${setNumber} &#183; <span class="bold text-gold">${matchSetUp[0]} vs ${matchSetUp[1]}</span>\n\t\t\t\t\t\t\t`))}}catch(e){}$("#mb-h-message").html(in_content),$("#mb-ig-message").html(in_content||"&nbsp;")},displayEOGStat:function(in_opponent,in_html){$("#mb-s-stat-"+in_opponent).html(in_html)},refreshStatusMessage:function(){var sess=APP.session,mbr=APP.message_bar,mf=APP.session.getMatchFormat(),cs=sess.current_set;$("#mb-s-set").html(sess.getLegsStanding()),APP.game.finished?(APP.device.enableFieldID("message-bar-status"),$(".mb-s-stat").addClass("text-white")):(APP.device.disableFieldID("message-bar-status"),$("#mb-s-stat-0").html("S"+(cs?cs+1:1)),$("#mb-s-stat-1").html(mf&&mf.legs&&mf.legs.limit?"("+mf.legs.limit+")":"(0)"),$(".mb-s-stat").removeClass("text-white")),mbr.displayM3DA(0,sess.getM3DA("POINTS",0),sess.getM3DA("MARKS",0)),mbr.displayM3DA(1,sess.getM3DA("POINTS",1),sess.getM3DA("MARKS",1))},displayM3DA:function(in_opponent,in_points_3da,in_marks_3da){var html=in_points_3da.toFixed(0)+" / "+in_marks_3da.toFixed(1)+"<br />"+("TEAM"==APP.session.getMatchMode()?"Team":"Match");$(".mb-m3da-"+in_opponent).html(html)},displayEquation:function(in_user_input,in_options){var html,is_miss="0"==in_user_input[0];0==in_user_input.length?html=!0===in_options.show_hint?in_options.hint_text||"Enter Score":"":is_miss&&!0===in_options.show_miss?html='<span class="mb-ig-miss">MISS</span>':(html=APP.equation.buildText(in_user_input).right(15),html+=in_options.value_suffix||""),!0!==in_options.editing_flag||is_miss||(html='<span class="mb-ig-editing">'+(html||"&nbsp;")+"</span>"),$("#mb-ig-message").html(html||"&nbsp;")},formatValueFactors:function(in_user_input,in_editing_flag,in_show_hint){var counts,key,html="",is_miss="0"==in_user_input[0];if(0==in_user_input.length)html=in_show_hint?"Enter Score":"";else if(is_miss)html='<span class="mb-ig-miss">MISS</span>';else for(key in counts=BBAT.getUniqueFrequencies(in_user_input))"-"==key?html="-"+html:"+"!=key&&(html=counts[key]>1?key+'<span style="font-size:0.75em">x'+counts[key]+"</span>":key);return in_editing_flag&&!is_miss&&(html='<span class="mb-ig-editing">'+(html||"&nbsp;")+"</span>"),html},displayValueFactors:function(in_user_input,in_editing_flag,in_show_hint){var html=APP.message_bar.formatValueFactors(in_user_input,in_editing_flag,in_show_hint);$("#mb-ig-message").html(html||"&nbsp;")},formatTargetHits:function(in_user_input,in_editing_flag){var counts,delim,entry,html,i,len,modifier,multiplier,target_index;if(html=0==(len=in_user_input.length)&&in_editing_flag?"Enter Score":"",APP.game.getOption("marksman_scoring"))for(html="",delim="",i=0;i<len;i++)"S"!=(modifier=(entry=in_user_input[i]).right(1))&&"0"!=modifier||(modifier=""),target_index=parseInt(entry,10),html=html+delim+modifier+APP.game.getTargetLabel(target_index),delim=", ";else if(counts=BBAT.getUniqueFrequencies(in_user_input),BBAT.objectHasProperties(counts))for(entry in html="",delim="",counts)target_index=parseInt(entry,10),html=html+delim+APP.game.getTargetLabel(target_index),(multiplier=counts[target_index])>1&&(html=html+'<span style="font-size:0.75em">x'+multiplier+"</span>"),delim=", ";return in_editing_flag&&(html='<span class="mb-ig-editing">'+(html||"&nbsp;")+"</span>"),html},displayTargetHits:function(in_user_input,in_editing_flag){var html=APP.message_bar.formatTargetHits(in_user_input,in_editing_flag);$("#mb-ig-message").html(html||"&nbsp;")}},APP.alert={ok_handler:null,fade_timer:null,init:function(){APP.device.addButtonHandler(["alert-ok"],APP.alert.handleOption)},show:function(in_message,in_ok_handler,in_fade_out,in_title){var el=$("#alert");APP.device.pauseKeyboardHandler(),APP.alert.ok_handler=in_ok_handler,window.clearTimeout(APP.alert.fade_timer),el.queue().length&&el.stop().hide(0),in_fade_out?APP.alert.fade_timer=window.setTimeout((function(){el.fadeOut(3500),APP.device.resumeKeyboardHandler()}),500):$("#alert-overlay").show(0),$("#alert-title").html(in_title||"Notice!"),$("#alert-message").html(in_message),el.show(0)},hide:function(){var el=$("#alert");APP.alert.ok_handler=null,el.queue().length&&el.stop().hide(0),el.hide(0),$("#alert-overlay").hide(0),APP.device.resumeKeyboardHandler()},handleOption:function(in_id){switch(in_id){case"alert-ok":"function"==typeof APP.alert.ok_handler&&APP.alert.ok_handler()}APP.alert.hide()}},APP.confirm={ok_handler:null,cancel_handler:null,init:function(){APP.device.addButtonHandler(["confirm-ok","confirm-cancel","confirm-close"],APP.confirm.handleOption)},show:function(in_spec){$("#confirm-reload").addClass("hide"),APP.device.pauseKeyboardHandler(),APP.confirm.ok_handler=in_spec.ok,APP.confirm.cancel_handler=in_spec.cancel,APP.confirm.close_handler=in_spec.close,APP.confirm.post_display_handler=in_spec.post_display,in_spec.show_reload&&$("#confirm-reload").removeClass("hide"),in_spec.use_close_icon?$("#confirm-close").show(0):$("#confirm-close").hide(0),$("#confirm-title").html(in_spec.title||"Confirm!"),$("#confirm-message").html(in_spec.msg),$("#confirm-ok").html(in_spec.ok_text||"OK"),$("#confirm-cancel").html(in_spec.cancel_text||"Cancel"),$("#confirm-overlay").show(0),$("#confirm").show(0),"function"==typeof in_spec.post_display&&in_spec.post_display()},hide:function(){APP.confirm.ok_handler=null,APP.confirm.cancel_handler=null,APP.confirm.close_handler=null,$("#confirm").hide(0),$("#confirm-overlay").hide(0),APP.device.resumeKeyboardHandler()},handleOption:function(in_id){switch(in_id){case"confirm-close":"function"==typeof APP.confirm.close_handler&&APP.confirm.close_handler();break;case"confirm-ok":"function"==typeof APP.confirm.ok_handler&&APP.confirm.ok_handler();break;case"confirm-cancel":"function"==typeof APP.confirm.cancel_handler&&APP.confirm.cancel_handler()}APP.confirm.hide()}},APP.dialog={init:function(){APP.device.addButtonHandler(["dialog-close"],APP.dialog.handleOption)},show:function(in_spec){in_spec||(in_spec={}),"boolean"!=typeof in_spec.use_close_icon&&(in_spec.use_close_icon=!0),APP.dialog.close_handler=in_spec.close,APP.dialog.post_display_handler=in_spec.post_display,in_spec.use_close_icon?$("#dialog-close").show(0):$("#dialog-close").hide(0),$("#dialog-title").html(in_spec.title||""),$("#dialog-message").html(in_spec.msg),$("#dialog-overlay").show(0),$("#dialog").show(0),"function"==typeof in_spec.post_display&&in_spec.post_display(),this.init()},hide:function(){APP.dialog.close_handler=null,$("#dialog").hide(0),$("#dialog-overlay").hide(0)},handleOption:function(in_id){switch(in_id){case"dialog-close":"function"==typeof APP.dialog.close_handler&&APP.dialog.close_handler()}APP.dialog.hide()}},APP.prompt={init:function(){APP.device.addButtonHandler(["prompt-close","prompt-ok","prompt-cancel"],APP.prompt.handleOption),window.setTimeout((function(){$("#prompt-input").focus()}),100)},show:function(in_spec){if($("#prompt-cancel").addClass("hide"),in_spec.type)if(in_spec.close&&"function"==typeof in_spec.close){in_spec||(in_spec={});var content="",maxlength="";switch(in_spec.maxlength&&"number"==typeof in_spec.maxlength&&(maxlength+=` maxlength="${in_spec.maxlength}"`),in_spec.type){case"text":content+='\n\t\t\t\t\t<input id="prompt-input" type="text" placeholder="" value="" autocapitalize="off" autocorrect="off" autocomplete="off">\n\t\t\t\t';break;case"number":default:content+=`\n\t\t\t\t\t<input id="prompt-input" type="tel" placeholder="#" value="" autocapitalize="off" autocorrect="off" autocomplete="off" ${maxlength}>\n\t\t\t\t`}"boolean"!=typeof in_spec.use_close_icon&&(in_spec.use_close_icon=!0),APP.prompt.close_handler=in_spec.close,APP.prompt.post_display_handler=in_spec.post_display,in_spec.use_close_icon?$("#prompt-close").show(0):$("#prompt-close").hide(0),$("#prompt-title").html(in_spec.title||""),in_spec.msg?$("#prompt-message").html("<p>"+in_spec.msg+"</p>"+content):$("#prompt-message").html(content),$("#prompt-overlay").show(0),$("#prompt").show(0),"function"==typeof in_spec.post_display&&in_spec.post_display(),in_spec.show_cancel&&$("#prompt-cancel").removeClass("hide"),this.init()}else console.log("Prompt requires callback function");else console.log("Prompt requires type")},hide:function(){APP.prompt.close_handler=null,$("#prompt").hide(0),$("#prompt-overlay").hide(0)},handleOption:function(in_id){switch(in_id){case"prompt-close":case"prompt-cancel":"function"==typeof APP.prompt.close_handler&&APP.prompt.close_handler(!1);break;case"prompt-ok":if("function"==typeof APP.prompt.close_handler){var retValue=!!$("#prompt-input").val()&&$("#prompt-input").val();if(!APP.prompt.close_handler(retValue))return}}APP.prompt.hide()}},APP.popup={init:function(){APP.device.addButtonHandler(["popup-notable","popup-notify"],APP.popup.hide)},show:function(in_popup_id,in_option,in_time,in_opacity){var el=$("#"+in_popup_id);if(el.hasClass("modal")&&APP.chalkboard.shield(),"popup-notify"==in_popup_id){if(el=$("#popup-notify-shell"),APP.is_reloading)return;APP.popup.hide("popup-notify-shell"),$("#popup-notify").html(in_option).css("opacity",in_opacity||.75),window.setTimeout((function(){$("#popup-notify-shell").fadeOut(in_time||4e3)}),500)}if("popup-notable"!=in_popup_id)"popup-countdown"==in_popup_id&&$("#pc-message").html(in_option),"popup-auto-start-countdown"==in_popup_id&&$("#pasc-message").html(in_option),"popup-notice"==in_popup_id&&el.html(in_option),el.show(0);else{if(APP.is_reloading)return;APP.popup.hide(in_popup_id),el.html(in_option),window.setTimeout((function(){$("#popup-notable").fadeOut(3e3)}),1e3),el.css("left","auto").css("right","auto").show(0);var horiz=Math.floor(($("#chalkboard").width()-$("#popup-notable").outerWidth())/2)-1;el.css("left",horiz).css("right",horiz)}},hide:function(in_panel_id){in_panel_id?("popup-notify"==in_panel_id?$("#popup-notify-shell"):$("#"+in_panel_id)).stop(!0,!0).hide(0):($(".popup").hide(0),APP.chalkboard.unshield())}},APP.info={init:function(){var ids=[];$(".info-topic").each((function(index){ids.push(this.id)})),APP.device.addFieldHandler(ids,APP.info.hide),APP.device.addFieldHandler(["info-topic-orientation-basics-gotit","info-topic-player-details-gotit"],APP.info.hide),APP.device.addButtonHandler(["info-text-close"],APP.info.hide)},show:function(in_topic_id,in_text_title){var txt=$("#info-text");APP.device.pauseKeyboardHandler(),in_text_title?($(".info-text-content-show").removeClass("info-text-content-show"),$("#"+in_topic_id).addClass("info-text-content-show"),$("#info-text-title-text").html(in_text_title),txt.show(0),$("#info-text-scroll-box").height(Math.ceil(txt.height())-Math.ceil($("#info-text-title").outerHeight())),$("#info-text-scroll-box").scrollTop(0)):$("#"+in_topic_id).show(0),$("#info-overlay").show(0)},hide:function(in_id){"info-topic-orientation-basics-gotit"==in_id&&(APP.user_options.skip_basic_intro=!0,APP.storeUserOptions()),"info-topic-player-details-gotit"==in_id&&(APP.user_options.skip_player_details=!0,APP.storeUserOptions()),$("#info-overlay").hide(0),$(".info-topic").hide(0),$("#info-text").hide(0),$(".info-text-content-show").removeClass("info-text-content-show"),APP.device.resumeKeyboardHandler()}},APP.device={big_ui:!1,button_handler:{},touch_target:null,clock_time:new Date-1e3,field_handler:{},has_chalk:!1,is_broadcasting:!1,is_firefox:-1!=navigator.userAgent.indexOf("Firefox"),is_hosting:!1,keyboard_handler:null,keyboard_handler_active:null,mouse_target:null,orientation:null,role:null,token:null,ui_active:!1,spinner:null,spinner_count:0,touch_y:0,scrollbar_width:0,timezone:"n/a",touch_active:!1,fixStuckButtons:function(){APP.device.ui_active=!1,$(".button-down").removeClass("button-down")},init:function(){var d=$(document),f=$(".field");APP.device.timezone=(new Date).toString().substr(25),APP.device.token=BBAT.fetchData("device_token"),APP.device.token,APP.device.spinner||(APP.device.spinner=new Spinner({color:"#fff",length:30,radius:30,width:12})),APP.device.is_broadcasting=BBAT.fetchData("is_broadcasting")||!1,APP.device.is_hosting=BBAT.fetchData("is_hosting")||!1,APP.fetchUserOptions(),APP.user_options.big_ui&&(APP.device.big_ui=!0,$("#deadzone").addClass("deadzone-big"),$(".header-score").addClass("header-score-big"),$("#reveal-bar").addClass("reveal-bar-big"),$("#reveal-resize").attr("src","images/icon_resize.png"),$(".keypad-p-gutter").text("").removeClass("button").addClass("keypad-p-gutter-big"),$(".keypad-p-number").addClass("keypad-p-number-big"),$(".keypad-p-operator").addClass("keypad-p-operator-big"),$(".sb-c-game").addClass("sb-c-game-big"),$(".sb-c-achieve").addClass("sb-c-achieve-big")),$("#app-overlay-image").hide(0),APP.device.sizeUI(),$(window).on("orientationchange resize",(function(e){return BBAT.killDOMEvent(e),window.scrollTo(0,1),!1})),d.on("keydown",(function(e){if("function"==typeof APP.device.keyboard_handler&&APP.device.keyboard_handler_active)return APP.device.has_chalk&&window.setTimeout((function(){61==e.which&&APP.device.is_firefox?APP.device.keyboard_handler(187,e.shiftKey):APP.device.keyboard_handler(e.which,e.shiftKey)}),5),BBAT.killDOMEvent(e)})),d.on("keypress keyup",(function(e){if("function"==typeof APP.device.keyboard_handler&&APP.device.keyboard_handler_active)return BBAT.killDOMEvent(e)})),d.on("mouseup",(function(e){var el=null;return window.scrollTo(0,0),BBAT.killDOMEvent(e),APP.markEvent(),APP.storeUIEvent({id:e.currentTarget.id,event:e.type}),APP.device.ui_active&&APP.device.mouse_target&&(!(el=$(APP.device.mouse_target)).hasClass("button-disabled")&&el.hasClass("button")&&el.removeClass("button-down").addClass("button-up"),APP.device.mouse_target=null,APP.device.ui_active=!1),!1})),d.on("touchmove",(function(e){return window.scrollTo(0,0),BBAT.killDOMEvent(e),!1})),$("#ppl-container").on("touchstart touchend touchmove",(function(e){var sb=$("#ppl-container"),c=$($("#ppl-results")[0]),viewport=Math.floor(sb.height()-$("#ppl-message").height()),scroll_max=Math.ceil(c.outerHeight())-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#info-text-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#info-text-scroll-box"),c=$($(".info-text-content-show")[0]),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(c.outerHeight())+Math.ceil(parseFloat(c.css("margin-top")))+Math.ceil(parseFloat(c.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#plm-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#plm-scroll-box"),l=$("#plm-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#pbml-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#pbml-scroll-box"),l=$("#pbml-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#ptl-scroll-box").on("touchstart touchend touchmove",(function(e){if("ptl-link"!=e.target.id){var sb=$("#ptl-scroll-box"),l=$("#ptl-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0}})),$("#league-game-selector").on("touchstart touchend touchmove",(function(e){var lgs=$("#league-game-selector"),lgc=$("#lgs-game-container"),viewport=Math.floor(lgs.height()),available=Math.floor(viewport-$("#lgs-league-description").height()-$("#lgs-league-abbrev").height()),needed=Math.floor(lgc.height()+parseFloat(lgc.css("margin-top"))+parseFloat(lgc.css("margin-bottom"))),scroll_max=Math.floor(needed-available),scroll_current=lgs.scrollTop();if(needed<0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#pol-list").on("touchstart touchend touchmove",(function(e){var pl=$("#pol-list").height(),mc=$("#pol-list .menu-col-a").height(),st=$("#pol-list").scrollTop();if(mc<pl)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st==mc-pl)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#psd-scroll-box").on("touchstart touchend touchmove",(function(e){var st=$("#psd-scroll-box").scrollTop(),sb=$("#psd-scroll-box").height(),sbi=$("#psd-scroll-box-internal").height();if(sbi<sb)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st>=sbi-sb)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#pss-scroll-box").on("touchstart touchend touchmove",(function(e){var st=$("#pss-scroll-box").scrollTop(),sb=$("#pss-scroll-box").height(),sbi=$("#pss-scroll-box-internal").height();if(sbi<sb)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st>=sbi-sb)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#scoreboard-center").on("touchstart touchend touchmove",(function(e){var sb=$("#scoreboard").height(),sc=$("#scoreboard-center").height(),st=$("#scoreboard").scrollTop();if(sc<sb)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":var delta=e.originalEvent.targetTouches[0].pageY-APP.device.touch_y;if(delta>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st-delta>sc-200)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#eog-stats-panel").on("touchstart touchend touchmove",(function(e){var esp=$("#eog-stats-panel").height(),esc=$("#eog-stats-center").height(),st=$("#eog-stats-panel").scrollTop();if(esc<esp)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":var delta=e.originalEvent.targetTouches[0].pageY-APP.device.touch_y;if(delta>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st-delta>esc-200)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#opponents-panel-list").on("touchstart touchend touchmove",(function(e){var op=$("#opponents-panel-list").height(),opl=$("#op-col-left").height(),st=$("#opponents-panel-list").scrollTop();if(opl<op)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==st)return BBAT.killDOMEvent(e)}else if(st>=opl-op)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#pqp-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#pqp-scroll-box"),l=$("#pqp-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$("#pcem-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#pcem-scroll-box"),l=$("#pcem-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),$(".overlay").on("touchstart touchend touchmove click mousedown mouseup",(function(e){return BBAT.killDOMEvent(e),!1})),APP.device.setButtonEvents(".button"),f.on("touchmove click",(function(e){if("A"!=e.target.nodeName)return BBAT.killDOMEvent(e),!1})),f.on("mousedown touchstart",(function(e){if("A"!=e.target.nodeName)return BBAT.killDOMEvent(e),APP.markEvent(),APP.storeUIEvent({id:e.currentTarget.id,event:e.type}),APP.device.ui_active||(APP.device.ui_active=!0,"mousedown"==e.type?APP.device.mouse_target=e.currentTarget:APP.device.touch_target=e.currentTarget),!1})),f.on("mouseup touchend",(function(e){var el,id;if("A"!=e.target.nodeName){if(BBAT.killDOMEvent(e),APP.markEvent(),APP.storeUIEvent({id:e.currentTarget.id,event:e.type}),"mouseup"==e.type){if(!APP.device.mouse_target)return APP.device.ui_active=!1,APP.device.mouse_target=null,!1;id=APP.device.mouse_target.id,el=$(APP.device.mouse_target),APP.device.mouse_target=null}else{if(e.currentTarget.id!=APP.device.touch_target.id)return!1;id=e.currentTarget.id,el=$(e.currentTarget)}return el.hasClass("field-enabled")?window.setTimeout((function(){"function"==typeof APP.device.field_handler[id]?window.setTimeout((function(){APP.session.stopAutoSave(),APP.device.field_handler[id](id),APP.device.ui_active=!1}),5):APP.device.ui_active=!1}),5):APP.device.ui_active=!1,!1}})),APP.device.addButtonHandler(["drm-quick-play","drm-play","drm-league","drm-tournament","drm-practice","drm-guest-connect","drm-logout","drm-log","drm-user-options"],APP.device.handleRoleSelection),APP.device.addButtonHandler(["gcm-close","gcm-pass","gcm-take","gcm-keep"],APP.device.handleGameControlOption),APP.device.addButtonHandler(["pak-close"],APP.device.handleAlleyKeysOption)},setButtonEvents:function(in_selector){var selection=$(in_selector);selection.off("touchmove click"),selection.off("mousedown touchstart"),selection.off("mouseup touchend"),selection.on("touchmove click",(function(e){return BBAT.killDOMEvent(e),!1})),selection.on("mousedown touchstart",(function(e){if(!APP.device.touch_active){"touchstart"==e.type&&(APP.device.touch_active=!0);var sb,sb_id,el=$(e.currentTarget);return BBAT.killDOMEvent(e),APP.markEvent(),APP.storeUIEvent({id:e.currentTarget.id,event:e.type}),APP.device.ui_active?!1:(APP.device.ui_active=!0,"mousedown"==e.type?APP.device.mouse_target=e.currentTarget:APP.device.touch_target=e.currentTarget,!el.hasClass("button-disabled")&&el.hasClass("button")&&window.setTimeout((function(){el.removeClass("button-up").addClass("button-down"),(sb_id=el.attr("data-shadow-button"))&&!(sb=$("#"+sb_id)).hasClass("button-disabled")&&sb.hasClass("button")&&sb.removeClass("button-up").addClass("button-down")}),5),!1)}APP.device.fixStuckButtons()})),selection.on("mouseup touchend",(function(e){var el,id,sb,sb_id;if("touchend"==e.type&&(APP.device.touch_active=!1),!APP.device.touch_active){if("touchstart"==e.type&&(APP.device.touch_active=!0),BBAT.killDOMEvent(e),APP.markEvent(),APP.storeUIEvent({id:e.currentTarget.id,event:e.type}),"mouseup"==e.type){if(!APP.device.mouse_target)return APP.device.ui_active=!1,APP.device.mouse_target=null,!1;id=APP.device.mouse_target.id,el=$(APP.device.mouse_target),APP.device.mouse_target=null}else{if(e.currentTarget.id!=APP.device.touch_target.id)return!1;id=e.currentTarget.id,el=$(e.currentTarget)}return!el.hasClass("button-disabled")&&el.hasClass("button")&&"function"==typeof APP.device.button_handler[id]?window.setTimeout((function(){APP.session.stopAutoSave(),APP.device.button_handler[id](id),APP.device.ui_active=!1}),5):APP.device.ui_active=!1,window.setTimeout((function(){!el.hasClass("button-disabled")&&el.hasClass("button")&&el.removeClass("button-down").addClass("button-up"),(sb_id=el.attr("data-shadow-button"))&&!(sb=$("#"+sb_id)).hasClass("button-disabled")&&sb.hasClass("button")&&sb.removeClass("button-down").addClass("button-up")}),5),!1}}))},showOfflineMessage:function(){APP.confirm.show({title:"DartConnect is Offline",msg:"<p>Games cannot be saved to your account and match recaps cannot be delivered to players.",ok_text:"Take DC Online",cancel_text:"Keep DC Offline",ok:function(){APP.device.goOffline(!1)}})},goOffline:function(in_offline){function goOffline(){WS.close(),APP.updateConnectivityMonitor(null),APP.device.disableButton("reveal-chalk"),APP.device.disableButton("bb-e-alley"),APP.device.disableButton("bb-o-connect"),"TOURNAMENT"==APP.session.getMatchMode()?(APP.device.disableButton("oph-bb-library"),APP.device.disableButton("op-button-left-add-player")):(APP.device.enableButton("oph-bb-library",!0),APP.device.enableButton("op-button-left-add-player",!0)),APP.message.userMessage.changeBtn(),APP.updateOffline(!0),APP.storeUserOptions(),APP.reveal.updateDCTVKey()}in_offline?APP.device.is_broadcasting||APP.device.is_hosting?(APP.revertToLocalPlay(),APP.server.closeAlley({success:goOffline,error:goOffline})):goOffline():(WS.open(),APP.device.enableButton("reveal-chalk",!0),APP.device.enableButton("bb-e-alley",!0),APP.device.enableButton("bb-o-connect",!0),APP.device.enableButton("oph-bb-library",!0),APP.device.enableButton("op-button-left-add-player",!0),APP.message.userMessage.changeBtn(!0),APP.updateOffline(!1),APP.storeUserOptions(),APP.reveal.updateDCTVKey()),APP.header.setBackupRestoreButtons()},isLocalStorageOK:function(){var ok=!0;try{localStorage.setItem("test_block",Array(20481).join("a"))}catch(e){ok=!1}finally{localStorage.removeItem("test_block")}return ok},showSpinnerOverlay:function(in_callback){var devc=APP.device,spinner=APP.device.spinner;devc.spinner_count++,1==devc.spinner_count&&($("#spinner-overlay").show(0),spinner.opts.top="40%",spinner.spin(document.getElementById("spinner-overlay"))),in_callback&&in_callback()},hideSpinnerOverlay:function(in_hide_all){var devc=APP.device,spinner=APP.device.spinner;in_hide_all?devc.spinner_count=0:devc.spinner_count--,0==devc.spinner_count&&(spinner.stop(),$("#spinner-overlay").hide(0))},handleAlleyKeysOption:function(in_id){switch(in_id){case"pak-close":APP.popup.hide()}},pauseKeyboardHandler:function(){APP.device.keyboard_handler_active=!1},resumeKeyboardHandler:function(){APP.device.keyboard_handler_active=!0},setKeyboardHandler:function(in_handler){APP.device.keyboard_handler=in_handler,APP.device.keyboard_handler_active=!0},addButtonHandler:function(in_id_array,in_handler){var i,len=in_id_array.length;for(i=0;i<len;i+=1)APP.device.button_handler[in_id_array[i]]=in_handler},addFieldHandler:function(in_id_array,in_handler){var i,len=in_id_array.length;for(i=0;i<len;i+=1)APP.device.field_handler[in_id_array[i]]=in_handler},sizeUI:function(){var ah,apw,arf,aw,cb,dzh,factor,hd,mbi_h,mbm,rb_height,rv,sb,sbar_width,sbc,sbc_margin,sbc_width,w1,w2,wh,ww;wh=(apw=$("#app-window")).height(),ww=apw.width(),APP.device.orientation="PORTRAIT",arf=wh/ww,$("#scoreboard").show(0),$("#reveal").show(0),arf>=1.78?arf=1.78:arf<=1.3&&(arf=1.3),ww>=wh/arf?(ah=wh,aw=Math.round(wh/arf)):(ah=Math.round(ww*arf),aw=ww),dzh=$("#deadzone").height();try{APP.user_options.force_full_screen&&(ah=$("#app-window").height())}catch(e){}(cb=$("#chalkboard")).css("height",ah-dzh).css("min-height",ah-dzh).css("max-height",ah-dzh).css("width",aw).css("min-width",aw).css("max-width",aw),$("#sb-floating-set-score").css("width",aw).css("min-width",aw).css("max-width",aw),factor=aw/600,w2=aw-2*(w1=Math.round(260*factor)),$("body").css("font-size",Math.round(14*factor)),$(".header-opponent").css("width",w1).css("max-width",w1),$("#hdr-center").css("width",w2).css("max-width",w2),(rv=$("#reveal")).css("width",aw).css("max-width",aw),rb_height=$("#reveal-bar").height(),$("#reveal-bar").css("height",Math.round(rb_height*factor)),mbm=$("#mb-ig-message"),$(".message-bar-function").css("line-height",mbm.css("line-height")).css("height",mbm.css("line-height")).css("padding-top",mbm.css("padding-top")).css("padding-bottom",mbm.css("padding-bottom")).css("border-width",mbm.css("border-width")).css("top",mbm.position().top),$("#mb-ig-control").css("line-height",mbm.css("line-height")).css("height",mbm.css("line-height")).css("padding-top",mbm.css("padding-top")).css("padding-bottom",mbm.css("padding-bottom")).css("border-width",mbm.css("border-width")).css("top",mbm.position().top),mbi_h=$("#message-bar-ingame").height(),$("#message-bar-ingame").css("height",mbi_h),$("#message-bar-header").css("height",mbi_h),$("#message-bar-status").css("height",mbi_h),hd=$("#header"),(sb=$("#scoreboard")).css("height",cb.height()-hd.height()-rv.height()),sb.height(),sb.width(),APP.device.scrollbar_width=$.getScrollbarWidth(),sbc=$("#scoreboard-center"),sbc_margin=parseFloat(sbc.css("margin-left")),sbar_width=APP.device.scrollbar_width,sbc.css("margin-left",sbc_margin+sbar_width),sbc_margin=parseFloat(sbc.css("margin-left")),sbc_width=sbc.width(),sbc.css("width",sbc_width-sbar_width),$("#scoreboard-points").css("width",sbc_width-sbar_width-1),$("#scoreboard-cricket").css("width",sbc_width-sbar_width-1),$("#eog-stats-center").css("margin-right",sbc_margin/1.15),$("#eog-stats-center").css("margin-left",sbc_margin/1.15),window.scrollTo(0,1)},needToReleaseChalk:function(){return!!APP.device.has_chalk&&(!APP.is_reloading&&(!APP.game.plugin.is_rebuilding_scoring&&(!BBAT.isNumeric(APP.game.winning_opponent)&&(!(APP.game.deep_editing||APP.game.getTurnsFromCurrent()>0)&&("HOST"==APP.device.role&&1==APP.game.active_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.active_opponent)))))},releaseChalk:function(in_delay_release,in_on_success){if(("HOST"!=APP.device.role||APP.device.is_hosting)&&!APP.is_reloading){if("SERVER"==APP.game_master){var releaseTime=3e3;return"Test"===APP.getEnvironment()&&(releaseTime=500),BBAT.storeData({chalk_release_pending:!0}),APP.device.has_chalk=!1,APP.server.chalk_release_timer_id=window.setTimeout((function(){APP.server.releaseChalk(in_on_success),APP.server.chalk_release_timer_id=null}),in_delay_release?releaseTime:1),void APP.device.disableChalkControls()}"DEVICE"==APP.game_master&&in_on_success&&in_on_success()}},disableChalkControls:function(){APP.reveal.setChalkButton(),APP.scoreboard.disableEditing(),APP.reveal.setBackButton("EXIT"),APP.header.disablePlayerOrderProcessing(0),APP.header.disablePlayerOrderProcessing(1),APP.header.enablePlayerOrderProcessing(0),APP.header.enablePlayerOrderProcessing(1),"01"==APP.game.name&&(APP.plugin_01.setUserControls(),APP.scoreboard_points.enableGameSettings(!1),APP.plugin_01.setUserMessage()),"Cricket"==APP.game.name&&APP.scoreboard_cricket.enableGameSettings(),"Library"==APP.game.name&&APP.game.started_scoring&&(APP.device.disableButton("hdr-eog-0"),APP.device.disableButton("hdr-eog-1"))},enableChalkControls:function(){APP.reveal.setChalkButton(),APP.scoreboard.enableEditing(),APP.reveal.setBackButton("RESET"),APP.header.disablePlayerOrderProcessing(0),APP.header.disablePlayerOrderProcessing(1),APP.header.enablePlayerOrderProcessing(0),APP.header.enablePlayerOrderProcessing(1),"01"==APP.game.name&&(APP.plugin_01.setUserControls(),APP.plugin_01.setUserMessage()),"Cricket"==APP.game.name&&(APP.plugin_cricket.setUserControls(),APP.scoreboard_cricket.enableGameSettings()),"Library"==APP.game.name&&APP.game.started_scoring&&(APP.device.enableButton("hdr-eog-0",!0),APP.device.enableButton("hdr-eog-1",!0))},setButtonAttrs:function(in_id,in_attrs){var el=$("#"+in_id);in_attrs.label&&el.html(in_attrs.label),in_attrs.color&&el.removeClass("button-red").removeClass("button-gray").removeClass("button-gold").removeClass("button-green").addClass("button-"+in_attrs.color)},showButton:function(in_id){$("#"+in_id).show(0)},hideButton:function(in_id){$("#"+in_id).hide(0)},enableFieldID:function(in_id){return!APP.isFeatureBlocked(in_id)&&($("#"+in_id).addClass("field-enabled"),!0)},enableFieldClass:function(in_class){return!APP.isFeatureBlocked(in_class)&&($("."+in_class).addClass("field-enabled"),!0)},disableFieldID:function(in_id){APP.device.disableFieldSelector("#"+in_id)},disableFieldClass:function(in_class){APP.device.disableFieldSelector("."+in_class)},disableFieldSelector:function(in_selector){$(in_selector).removeClass("field-enabled")},enableButton:function(in_id,in_force_it){APP.isFeatureBlocked(in_id)||(in_force_it||"PRE-ROLE"==APP.mode||APP.device.has_chalk||APP.game.finished)&&$("#"+in_id).removeClass("button-up").removeClass("button-down").removeClass("button-disabled")},disableButton:function(in_id){$("#"+in_id).removeClass("button-up").removeClass("button-down").addClass("button-disabled")},isButtonEnabled:function(in_id){return!$("#"+in_id).hasClass("button-disabled")},enableButtonClass:function(in_class){var coll,len,i;for(len=(coll=$("."+in_class)).length,i=0;i<len;i++)APP.device.enableButton(coll[i].id)},enableButtonSelector:function(in_selector){var coll,len,i;for(len=(coll=$(in_selector)).length,i=0;i<len;i++)APP.isFeatureBlocked(coll[i].id)?APP.device.disableButton(coll[i].id):APP.device.enableButton(coll[i].id)},disableButtonClass:function(in_class){var coll,len,i;for(len=(coll=$("."+in_class)).length,i=0;i<len;i++)APP.device.disableButton(coll[i].id)},handleRoleSelection:function(in_id,no_animate){switch(in_id){case"drm-tournament":APP.session.showTournamentListing();break;case"drm-user-options":APP.userOptions.init();break;case"drm-play":case"drm-practice":APP.device.has_chalk=!0,APP.changeMode("PRE-GAME"),APP.header.fetchDirectory(),APP.chalkboard.unshield(),APP.popup.hide(),"drm-play"==in_id?(APP.reveal.showButtonBar("button-bar-match",null,(function(){}),no_animate),APP.session.startNew("D"==APP.user.member_level?"PLAY":"MATCH")):(APP.reveal.showButtonBar("button-bar-match"),APP.session.startNew("SOLO")),APP.game_selector.show(!0),APP.header.refresh(),APP.reveal.setChalkButton(),APP.message_bar.resetPromo(),APP.user&&APP.user.seba&&APP.handleAlleyOption("pcm-broadcast-start-button");break;case"drm-quick-play":APP.qp2.init();break;case"drm-quick-play-online":APP.session.showQuickPlayListing(!0);break;case"drm-league":APP.session.leagueMenu.show(),APP.session.enableLeagueLookup(),APP.blockFeatures(["op-button-left-add-player","op-right-Pdartbot"]),APP.blockUIControls();break;case"drm-guest-connect":APP.blockFeatures(["gs-library","bb-o-reload","bb-o-connect","oph-bb-library","oph-bb-forfeit","op-right-Pdartbot","op-button-left-add-player","header-score","hdr-score-0","hdr-score-1","bb-e-alley","pss-score"]),APP.lobby.isLobbyPermitted()||($("#pgc-lobby").hide(),$(".pgc-blurb p.subtext.first").hide()),APP.blockUIControls(),APP.showOnlineSelector();break;case"drm-logout":APP.logoutManager.init();break;case"drm-log":APP.session.buildDeviceLog(),APP.popup.show("popup-device-log");var popup=$("#popup-device-log").height(),title=$("#popup-device-log .popup-title").height(),hint=$("#popup-device-log .pdl-hint").height();$("#pdl-scroll-box").css("height",.9*(popup-title-hint)),APP.server.updateSyncMessages(),APP.isOffline()&&APP.device.showOfflineMessage()}},takeChalk:function(){APP.is_reloading||"SERVER"!=APP.game_master||APP.device.has_chalk||(APP.device.showSpinnerOverlay(),APP.server.takeChalk({success:function(){BBAT.storeData({board_taken:!0}),APP.reload()}}))},confirmTakeChalk:function(){APP.device.has_chalk||APP.confirm.show({msg:"Take the board?",ok:APP.device.takeChalk})}},APP.server={init:function(){var srvr=APP.server;srvr.debugMode=!1,srvr.log=function(msg,force){if(APP.server.debugMode||force){var message=(new Date).toLocaleTimeString()+" - SRVR: ";message+=msg,console.log(message)}},srvr.sync_spinner=new Spinner({color:"#fff",top:"50%",left:"7%",length:3,width:3,radius:6}),srvr.api_url=BBAT.fetchData("api_url")||"",srvr.pingAlley(),srvr.sync_match_index=null,srvr.sync_pending=0,srvr.history_delay=2e3,srvr.alley_id=null,srvr.alley_key=null,srvr.chalk_last_asked=new Date,srvr.chalk_release_timer_id=null,srvr.chalking_opponent=null,srvr.chalking_round=null,srvr.game_id=null,srvr.confirmed_cmd_seq=0,srvr.confirmed_settings_version=0,srvr.mode=null,srvr.option={alley_open:null,shared_control:null},srvr.participant_device_key=null,srvr.spectator_device_key=null,srvr.timer=null,srvr.dflt_timeout=15e3,srvr.last_received_event=null,srvr.ajax_calls=[],srvr.ajax_stats={},APP.server.alley_id=BBAT.fetchData("alley_id"),APP.server.spectator_device_key=BBAT.fetchData("spectator_device_key"),APP.server.participant_device_key=BBAT.fetchData("participant_device_key"),srvr.last_network_message=new Date,srvr.init_broadcast_match_pending=0,srvr.set_game_settings_pending=0,srvr.submit_game_events_pending=0,srvr.get_game_settings_pending=0,srvr.get_game_events_pending=0,srvr.last_forward_attempt_time=0,srvr.is_unloading=!1,window.addEventListener("beforeunload",(function(event){APP.server.is_unloading=!0})),srvr.confirmed_settings_version=BBAT.fetchData("server_settings_version")||0,BBAT.flushData("server_settings_version"),srvr.confirmed_cmd_seq=BBAT.fetchData("server_cmd_seq")||0,BBAT.flushData("server_cmd_seq"),srvr.fetchAjaxData(),CMON.configure({on_ping:function(){return APP.updateConnectivityMonitor({timeout_count:CMON.timeout_count,error_count:CMON.error_count,success_time:CMON.success_time,success_average_time:CMON.success_average_time}),"SERVER"==APP.game_master&&APP.device.has_chalk?"device_token="+encodeURI(APP.device.token)+"&member_id="+encodeURI(APP.user?APP.user.member_id:"n/a")+"&user_token="+encodeURI(APP.user.token)+"&alley_id="+encodeURI(APP.server.alley_id):null},on_success:function(in_response){"OK"!=in_response.status&&(-1!=in_response.status_text.indexOf("not registered")?APP.kickDeviceOut():-1!=in_response.status_text.indexOf("not the current chalker")&&(APP.device.has_chalk=!1,APP.reload()))},on_timeout:function(in_count){in_count>2&&(CMON.pause(2e4),srvr.checkNetworkConnection())},on_error:function(in_count){in_count>2&&srvr.checkNetworkConnection()}}),srvr.squeue.timer=setInterval(srvr.squeue.process,3e3)},checkGamePostBroadcast:function(){try{var gamePostBroadCast=BBAT.fetchData("game_postbroadcast");if(!gamePostBroadCast)return;APP.server.postBroadcast(gamePostBroadCast,"","",(function(){BBAT.flushData("game_postbroadcast"),APP.server.squeue.fake_delay=!0}))}catch(e){}},checkSendMatchScoreToPlatform:function(){try{var sendMatchScore=BBAT.fetchData("send_match_score");if(!sendMatchScore)return;APP.server.squeue.enQueue({type:"HISTORY",caller:"forwardFinishedGames",url:APP.getApi2Url()+"update-tournament-match/"+sendMatchScore.match.bracket_event_id,process_data:!1,data:JSON.stringify(sendMatchScore),is_api2:!0,on_success:function(in_data){BBAT.flushData("send_match_score")},on_error:function(in_a,in_b,in_c){}})}catch(e){}},checkNetworkConnection:function(in_force_it){APP.server,new Date,APP.mode,APP.device.role},getTournamentPlayers:function(in_params){in_params.spinner&&APP.device.showSpinnerOverlay(),!APP.session.isOptimizedBracketRoster()||in_params.force?$.ajax({url:"/tournamentPlayers",type:"POST",cache:!1,timeout:2e4,dataType:"json",jsonp:!1,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,tournament_id:in_params.tournament_id},success:function(in_data){in_params.spinner&&APP.device.hideSpinnerOverlay(),"OK"==in_data.status?in_params.on_success(in_data.payload.players):(APP.recordError("(getTournamentPlayers) "+in_data.status_text),"function"==typeof in_params.on_error&&setTimeout(in_params.on_error,5))},error:function(in_a,in_b,in_c){return in_params.spinner&&APP.device.hideSpinnerOverlay(),"function"==typeof in_params.on_error&&setTimeout(in_params.on_error,5),!1}}):window.setTimeout((function(){APP.device.hideSpinnerOverlay(),in_params.on_success([])}),100)},getDCTVTourneyInfo:function(tournamentId){$.ajax({url:"/ajax/getDctvTournyInfo",type:"POST",cache:!1,timeout:2e4,dataType:"json",jsonp:!1,data:{id:tournamentId},success:function(in_data){"OK"===in_data.status&&"Y"===in_data.payload[0].closed&&(APP.revertToLocalPlay(),APP.server.closeAlley({success:APP.exitTournament,error:APP.exitTournament}))},error:function(in_a,in_b,in_c){"timeout"==in_b||0==in_a.status||APP.recordError("(getDCTVTourneyInfo) "+in_a.status+":"+in_a.statusText)}})},backupProfile:function(in_data,in_callback){APP.isOffline()||(APP.device.showSpinnerOverlay(),$.ajax({url:"/profileUpdate",type:"POST",cache:!1,timeout:0,dataType:"json",jsonp:!1,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user.member_id,players_lib_json:JSON.stringify(in_data.library)},success:function(in_response){APP.device.hideSpinnerOverlay(),in_callback(in_response)},error:function(in_a,in_b,in_c){APP.device.hideSpinnerOverlay(),"timeout"==in_b||0==in_a.status?alert("Unable to connect to DartConnect.\nPlease check your Internet connection."):(APP.recordError("(backupProfile) "+in_a.status+":"+in_a.statusText),alert("Library backup failed."))}}))},restoreProfile:function(in_callback,hide_errors){APP.isOffline()||(APP.device.showSpinnerOverlay(),$.ajax({url:"/profileFetch",type:"POST",cache:!1,timeout:0,dataType:"json",jsonp:!1,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user.member_id},success:function(in_response){APP.device.hideSpinnerOverlay(),in_callback(in_response)},error:function(in_a,in_b,in_c){APP.device.hideSpinnerOverlay(),"timeout"==in_b||0==in_a.status?hide_errors||alert("Unable to connect to DartConnect.\nPlease check your Internet connection."):(APP.recordError("(restoreProfile) "+in_a.status+":"+in_a.statusText),hide_errors||alert("Library restore failed."))}}))},memberCheckin:function(in_callback,error_callback){$.ajax({url:"/memberCheckin?cacheBust="+Date.now(),type:"POST",cache:!1,timeout:0,dataType:"json",jsonp:!1,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,user_token:APP.user.token,member_id:APP.user.member_id,data_version_number:APP.data_version_number},success:function(in_response){if("OK"==in_response.status)in_callback(in_response.payload);else if("FORCE_UPDATE"==in_response.status){APP.alert.show(in_response.status_text,(function(){APP.reload()})),$("#alert-ok").html("Please wait&hellip;"),$("#alert-ok").addClass("button-disabled");new Timer({name:"updateCheckTimer",forceClose:!0,runTime:5,callback:function(){$("#alert-ok").html("OK"),$("#alert-ok").removeClass("button-disabled")},eachTick:function(){$("#alert-ok").html("Updating ("+this.getCountDown()+")")},debugMode:!1})}else{if(in_response.status_text&&"Server paused for restart"==in_response.status_text)return;APP.recordError("(memberCheckin) "+in_response.status_text),APP.alert.show("There seems to be a problem<br />with your account...<br />&nbsp;<br />Please check your membership status<br />and/or try logging in again.",(function(){APP.logoutManager.init(!0)}))}},error:function(in_a,in_b,in_c){"timeout"==in_b||0==in_a.status||APP.recordError("(memberCheckin) "+in_a.status+":"+in_a.statusText),error_callback&&"function"==typeof error_callback&&error_callback()}})},lookupEmail:function(in_search_name,in_search_email,in_callback){APP.isOffline()||$.ajax({url:"/emailLookup",type:"POST",cache:!1,timeout:0,dataType:"json",jsonp:!1,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,name_search:in_search_name,email_search:in_search_email,result_max:10},success:function(in_response){in_callback(in_response.payload)}})},squeue:{is_busy:!1,timer:null,has_delay:!1,fake_delay:!1,EVENTSCORE:[],ALLEY:[],BROADCAST:[],GAME:[],CHALK:[],HISTORY:[],REGISTER:[],STATS:[],LOBBY:[],API2:[],enQueue:function(in_spec){var q=APP.server.squeue;if(APP.isOffline())"function"==typeof in_spec.on_error&&in_spec.on_error();else{if(!q[in_spec.type])throw"Invalid Queue Type!";in_spec.retry_count||(in_spec.retry_count=0),q[in_spec.type].push(in_spec),q.process()}},process:function(){var srvr=APP.server,q=APP.server.squeue;if(q.is_busy)APP.server.log("Q is busy");else if(APP.server.log("Q attempting to process"),q.REGISTER.length>0)deQueue(q.REGISTER);else if(APP.user&&q.EVENTSCORE.length>0)deQueue(q.EVENTSCORE);else if(APP.user&&q.GAME.length>0)deQueue(q.GAME);else if(APP.user&&q.LOBBY.length>0)deQueue(q.LOBBY);else if(APP.user&&q.HISTORY.length>0)deQueue(q.HISTORY);else if(APP.user&&q.BROADCAST.length>0)deQueue(q.BROADCAST);else if(APP.user&&q.ALLEY.length>0)deQueue(q.ALLEY);else if(q.STATS.length>0)deQueue(q.STATS);else if(APP.user&&q.API2.length>0)deQueue(q.API2);else if(!APP.is_reloading){APP.server.log("Q is idle");var now=new Date;now-srvr.last_forward_attempt_time>srvr.history_delay&&(srvr.last_forward_attempt_time=now,srvr.hasPendingFinishedGames()?(APP.server.log("Q forwarding finished games"),srvr.forwardFinishedGames()):srvr.hasPendingFinishedMatches()?(APP.server.log("Q forwarding finished matches"),srvr.forwardFinishedMatches()):srvr.hasPendingAjaxStats()&&(APP.server.log("Q forwarding ajax stats"),srvr.forwardAjaxStats()))}function finish(in_request){if(APP.server.log("Q finished processing"),APP.server.squeue.fake_delay){APP.server.log("Q fake delay");new Timer({name:"queueBlocker",runTime:2,callback:function(){APP.server.log("Q fake delay finished"),APP.server.squeue.fake_delay=!1,APP.server.squeue.is_busy=!1,APP.server.squeue.process()},eachTick:function(){},debugMode:!1})}else{var type=!1,caller=!1;try{type=in_request.type,caller=in_request.caller}catch(e){}"BROADCAST"==type&&"postBroadcast"==caller?window.setTimeout((function(){q.is_busy=!1,q.process()}),1e3):(q.is_busy=!1,q.process())}}function deQueue(in_type_q){var ajax_id;APP.server.log("deQueue type: "+in_type_q[0].type+" length: "+in_type_q.length);var request=in_type_q[0];q.is_busy=!0;try{if(advLog.enabled)for(var i=0;i<in_type_q.length;i++){var myQ=in_type_q[i];if("GAME"===myQ.type)if("submitGameEvent"==myQ.caller){var cmd_key=APP.formatCmd(APP.cmd_seq),cmd_data=BBAT.fetchData(cmd_key),logObj={type:"DQ: "+APP.cmd_seq,data:cmd_data.cmd_data};cmd_data.cmd&&(logObj.cmd=cmd_data.cmd),advLog.doLog(logObj)}else if("releaseChalk"==myQ.caller||"pickupChalk"==myQ.caller){logObj={type:"CH: "+APP.cmd_seq,data:myQ};advLog.doLog(logObj)}myQ.caller}}catch(e){}if(request.on_process&&!request.on_process(request.data))return in_type_q.shift(),void finish(request);function doIt(){advLog.checkTournament()&&(request.data.log=1),request.is_api2||(request.is_api2=!1),"API2"==request.type&&(request.is_api2=!0);var type="POST";request.mode&&(type=request.mode);var headers={};"API2"==request.type&&(headers={Authorization:"Bearer DacslVVURVO11d5i2ZIQYlfqlR9lrcqgVJWvdV6rLJnNtVpjC1VqpCzvD2xypila"}),request.headers&&(headers=request.headers),$.ajax({url:request.url,type:type,cache:!1,headers:headers,timeout:srvr.dflt_timeout,dataType:"json",jsonp:!1,processData:0!=request.process_data,contentType:request.is_api2?"application/json":"application/x-www-form-urlencoded; charset=UTF-8",data:request.data,success:function(in_response_data){request.spinner&&APP.device.hideSpinnerOverlay();try{if(in_response_data.payload.service_disabled)return APP.server.squeue.has_delay=!0,APP.recordError("(serviceUnavailable) server is down"),void finish(request)}catch(e){}srvr.recordAjaxSuccess(ajax_id),"function"==typeof request.on_success&&request.on_success(in_response_data),in_type_q.shift(),finish(request)},error:function(in_a,in_b,in_c){request.spinner&&APP.device.hideSpinnerOverlay(),APP.server.recordAjaxError(ajax_id,in_a,in_b,in_c),"timeout"==in_b||0==in_a.status?srvr.checkNetworkConnection(request.show_network_message):APP.recordError("("+request.caller+") "+in_a.status+":"+in_a.statusText),request.retry_count=(request.retry_count||0)+1,request.max_retries&&request.retry_count>=request.max_retries?in_type_q.shift():"function"==typeof request.on_error&&(request.on_error(in_a,in_b,in_c)||in_type_q.shift()),finish(request)}})}ajax_id=srvr.startAjaxCall(request.type,request.caller),request.spinner?(APP.device.showSpinnerOverlay(),1==APP.server.squeue.has_delay?setTimeout(doIt,2250):setTimeout(doIt,250)):1==APP.server.squeue.has_delay?setTimeout(doIt,2005):setTimeout(doIt,5)}}},initBroadcastMatch:function(in_params){if(!APP.user_options.backup_tablet){var srvr=APP.server;srvr.init_broadcast_match_pending>=1||(srvr.init_broadcast_match_pending++,srvr.squeue.enQueue({type:"BROADCAST",caller:"initBroadcastMatch",url:APP.server.api_url+"/initBroadcastMatch",show_network_message:!0,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",alley_id:srvr.alley_id,spectator_key:srvr.spectator_device_key,settings:JSON.stringify(in_params.settings),board_number:APP.session.getBracketBoardId()},on_success:function(in_data){if(srvr.init_broadcast_match_pending--,"OK"==in_data.status)in_params.on_success(in_data);else{var alleyError=!1;-1!==["not open","Error finding open alley"].indexOf(in_data.status_text)&&(alleyError=!0);for(var partialErrors=["not open","device not registered on alley"],i=0;i<partialErrors.length;i++){var partialError=partialErrors[i];if(-1!==in_data.status_text.indexOf(partialError)){alleyError=!0;break}}"FAILED"==in_data.status&&alleyError&&APP.handleAlleyOption("pcm-broadcast-end-button")}},on_error:function(in_a,in_b,in_c){return srvr.init_broadcast_match_pending--,!1}}))}},postBroadcast:function(in_broadcast,in_o_list,in_p_list,success_callback){if(!APP.user_options.backup_tablet){if(!APP.server.api_url)try{BBAT.fetchData("l_err_sent")||(newErrorReport("No API URL - unable to broadcast"),BBAT.storeData({l_err_sent:1}),BBAT.flushData("l_open_alley"))}catch(e){}var oi,o_list,p_list,p,op_list,op_len,op_i,op,t_id,l_id,b_start,b_status,b_id,do_listing,sess=APP.session,prevMatchCall=!1;try{in_broadcast.force_match_broadcast_id&&(prevMatchCall=!0)}catch(e){}if(!APP.isOffline()){b_start=sess.setgetMatchBroadcastStart(),b_id=sess.getMatchBroadcastID(),b_status=sess.getMatchBroadcastStatus();var is_special=APP.user&&APP.user.seba;is_special||(t_id=sess.getTournamentID(),l_id=(l_id=sess.getMatchLeagueKey()||{}).league_id||null);var isChallengeLeague=!1,lobbyLeague=APP.lobby.data.activeLeague;if(lobbyLeague&&"Y"==lobbyLeague.is_challenge_league&&(l_id=APP.lobby.data.activeLeague.league_id,isChallengeLeague=!0),do_listing=(do_listing=(do_listing="O"!=b_status)&&(null!=in_o_list&&null!=in_p_list||APP.game.started))&&(is_special||null!=l_id||null!=t_id&&"epic"!=t_id)){if(in_o_list)o_list=in_o_list,p_list=in_p_list;else if(o_list=[],p_list=[],"Home"==APP.game.opponent[0].chalkboard_name||"Away"==APP.game.opponent[1].chalkboard_name)sess.resetMatchBroadcast(),do_listing=!1;else for(oi=0;oi<2;oi++)for(o_list[oi]=APP.game.opponent[oi].chalkboard_name,op_len=(op_list=APP.game.opponent[oi].team.players).length,op_i=0;op_i<op_len;op_i++)p={opponent_index:oi,last_name:"*"==(op=op_list[op_i]).last_name?"":op.last_name,first_name:"*"==op.first_name?"":op.first_name,iso2_country:op.iso2_country,iso3_country:op.iso3_country,email:op.email},p_list.push(p);do_listing?(isChallengeLeague&&(l_id=APP.lobby.data.activeLeague.league_id),prevMatchCall||APP.server.initBroadcastMatch({settings:{broadcast_matches_id:b_id,broadcast_type:is_special?"E":t_id?"T":"L",event_id:is_special?null:t_id||l_id,status:APP.game.started?"O":"W",match_start:b_start?moment(b_start).format("YYYY-MM-DD HH:mm:ss"):null,tournament_desc:t_id?sess.tournaments[t_id].promo_line_1:null,bracket_event_id:sess.bracket?sess.bracket.event_id:"",bracket_match_id:sess.bracket?sess.bracket.match_id:"",money_round:t_id?sess.getMatchMoney():null,tiebreaker:!!t_id&&sess.getTiebreaker(),tournament_event_type:t_id?sess.getTournamentEventType():null,league_mode:l_id?sess.getMatchMode():null,opponents:o_list,players:p_list,league_data:APP.session.getLeagueMatchInfo(),is_set_play:APP.session.isSetPlay()},on_success:function(in_data){sess.setMatchBroadcastID(in_data.payload.broadcast_matches_id),sess.setMatchBroadcastStatus(in_data.payload.status),postIt(in_broadcast)}})):postIt(in_broadcast)}else postIt(in_broadcast)}}function postIt(in_broadcast){if(in_broadcast){var broadcastId=sess.getMatchBroadcastID();try{in_broadcast.force_match_broadcast_id&&(broadcastId=in_broadcast.force_match_broadcast_id)}catch(e){}APP.server.squeue.enQueue({type:"BROADCAST",caller:"postBroadcast",url:APP.server.api_url+"/postBroadcast",show_network_message:!0,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",alley_id:APP.server.alley_id,status:sess.getMatchBroadcastStatus(),broadcast_matches_id:broadcastId,broadcast:JSON.stringify(APP.server.cleanForBroadcast(in_broadcast))},on_success:function(in_data){if("OK"==in_data.status)success_callback&&success_callback();else{var msg;if("Server paused for restart"===in_data.status_text)return;if(msg=(in_data.status_text.indexOf("not open"),!1),APP.lobby.data.mode>0)return void APP.handleAlleyOption("pcm-broadcast-end-button");if($("#alert").is(":visible"))if($("#alert-message").text().toLocaleLowerCase().indexOf("opponent has left")>-1)return;msg&&APP.alert.show(msg,(function(){APP.handleAlleyOption("pcm-broadcast-end-button")}));var alleyError=!1;-1!==["not open","Error finding open alley"].indexOf(in_data.status_text)&&(alleyError=!0);for(var partialErrors=["finding alley","not open","device not registered on alley","Error updating alley: ","bad input parameters","Server Error"],i=0;i<partialErrors.length;i++){var partialError=partialErrors[i];if(-1!==in_data.status_text.indexOf(partialError)){alleyError=!0;break}}"FAILED"==in_data.status&&alleyError&&APP.handleAlleyOption("pcm-broadcast-end-button")}},on_error:function(in_a,in_b,in_c){return!0}})}}},cleanForBroadcast:function(in_obj){var html;for(var key in in_obj)"string"==typeof in_obj[key]&&(html=(html=(html=(html=(html=(html=(html=in_obj[key]).replace(/sb-turn-enabled/g,"")).replace(/field-enabled/g,"")).replace(/([^-])field(?!(\w|-))/g,"$1")).replace(/button-down/g,"")).replace(/button-up/g,"")).replace(/([^-])button(?!(\w|-))/g,"$1"),in_obj[key]=html);var noHtml=APP.session.getFromTournament("new_scoreboard_only");noHtml&&"Y"===noHtml&&(in_obj.header&&delete in_obj.header,in_obj.eog_stats&&delete in_obj.eog_stats,in_obj.message_bar&&delete in_obj.message_bar,in_obj.scoreboard&&delete in_obj.scoreboard,in_obj.set_details&&delete in_obj.set_details),in_obj.is_practice_match=APP.session.isBracketPracticeMatch(),in_obj.bracket_match_info=APP.session.getBracketMatchInfo(),in_obj.league_match_info=APP.session.getLeagueLobbyMatchInfo();try{in_obj.average_info=APP.session.getMatchAverages()}catch(e){}return in_obj.hasOwnProperty("extended_details")||(in_obj.extended_details=APP.session.getExtendedBroadcastDetails()),in_obj},requestDeviceToken:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"requestDeviceToken",url:"/requestDeviceToken",spinner:"50%",show_network_message:!0,data:{},on_success:function(in_data){"OK"==in_data.status?(APP.device.token=in_data.payload.device_token,BBAT.storeData({device_token:APP.device.token}),in_params.on_success()):(APP.recordError("(requestDeviceToken) "+in_data.status_text),in_params.on_error())},on_error:function(in_a,in_b,in_c){return in_params.on_error(),!1}})},loginMember:function(in_spec){APP.server.squeue.enQueue({type:"REGISTER",caller:"loginMember",url:"/memberLogin",spinner:"70%",show_network_message:!0,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,email:in_spec.login,password:in_spec.password},on_success:function(in_data){"OK"==in_data.status?in_spec.on_success(in_data):in_spec.on_error("BAD_INPUT")},on_error:function(in_a,in_b,in_c){return in_spec.on_error("BAD_CONNECTION"),!1}})},logoutMember:function(in_spec){APP.server.squeue.enQueue({type:"REGISTER",caller:"logoutMember",url:"/memberLogout",spinner:null,show_network_message:!1,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:in_spec.member_id}})},pingAlley:function(){APP.server.api_url?CMON.start():CMON.stop()},setApiUrl:function(in_url){APP.server.api_url=in_url,BBAT.storeData({api_url:in_url}),APP.server.pingAlley()},resetApiUrl:function(){APP.server.api_url="",BBAT.flushData("api_url"),APP.server.pingAlley()},registerDevice:function(in_params){APP.server.squeue.enQueue({type:"ALLEY",caller:"registerDevice",url:"/registerDevice",spinner:"50%",show_network_message:!0,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_key:APP.server.alley_key},on_success:function(in_data){if("OK"==in_data.status){if("SPECTATOR"===in_data.payload.device_role)return void in_params.error();APP.server.setApiUrl(in_data.payload.alleyServerUrl),APP.server.alley_id=in_data.payload.alley_id,APP.device.role=in_data.payload.device_role,in_params.success()}else in_params.error(in_data.status_text)},on_error:function(in_a,in_b,in_c){return alert("Unable to connect to DartConnect.\nPlease check your Internet connection."),!1}})},openAlley:function(in_params){var obj;(obj=APP.packageGameSettings()).match_summary=APP.session.packageMatchSummary(),APP.server.alley_id=APP.user.home_alley_id;var spinner="70%";in_params.spinner&&(spinner=in_params.spinner),(in_params.no_spinner||APP.magiconnect.isActive)&&(spinner=!1),APP.server.squeue.enQueue({type:"ALLEY",caller:"openAlley",url:"/openAlley",spinner:spinner,show_network_message:!0,data:{initial_request:in_params.requesting_broadcast?"broadcast":"remote_play",device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,game_settings:JSON.stringify(obj),tournament_id:APP.session.getTournamentID()},on_success:function(in_data){try{BBAT.storeData({l_open_alley:in_data,type:"ok"})}catch(e){}"OK"==in_data.status?(APP.server.setApiUrl(in_data.payload.alleyServerUrl),APP.server.game_id=in_data.payload.game_id,APP.server.spectator_device_key=in_data.payload.spectator_device_key.toUpperCase(),APP.server.participant_device_key=in_data.payload.participant_device_key.substr(0,3)+"-"+in_data.payload.participant_device_key.substr(3),APP.server.confirmed_settings_version=in_data.payload.settings_version,BBAT.storeData({server_settings_version:APP.server.confirmed_settings_version}),in_params.callback("OK")):in_params.callback("FAILED",in_data.status_text)},on_error:function(in_a,in_b,in_c){try{BBAT.storeData({l_open_alley:[in_a,in_b,in_c],type:"error"})}catch(e){}return in_params.callback("FAILED"),!1}})},updateAlleyKey:function(in_spec){APP.server.squeue.enQueue({type:"ALLEY",caller:"updateAlleyKey",url:APP.server.api_url+"/updateAlleyKey",spinner:in_spec.quietly?null:"70%",show_network_message:!0,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,key_type:in_spec.key_type},on_success:function(in_data){"OK"==in_data.status?("PARTICIPANT"==in_spec.key_type?APP.server.participant_device_key=in_data.payload.new_key.substr(0,3)+"-"+in_data.payload.new_key.substr(3):APP.server.spectator_device_key=in_data.payload.new_key.toUpperCase(),in_spec.callback("OK")):APP.recordError("(updateAlleyKey) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return!1}})},closeAlley:function(in_params){APP.server.squeue.enQueue({type:"ALLEY",caller:"closeAlley",url:"/closeAlley",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,force_close:in_params&&in_params.force_close?"Y":""},on_success:function(in_data){APP.server.resetApiUrl(),"OK"==in_data.status?in_params&&"function"==typeof in_params.success&&in_params.success():(APP.recordError("(closeAlley) "+in_data.status_text),in_params&&"function"==typeof in_params.error&&in_params.error())},on_error:function(in_a,in_b,in_c){return!1}})},set_game_settings_success:null,set_game_settings_error:null,setGameSettings:function(in_params){var srvr=APP.server;APP.is_reloading||(APP.server.set_game_settings_success=in_params&&in_params.success?in_params.success:null,APP.server.set_game_settings_error=in_params&&in_params.error?in_params.error:null,srvr.set_game_settings_pending>=2||(srvr.set_game_settings_pending++,APP.server.squeue.enQueue({type:"GAME",caller:"setGameSettings",url:APP.server.api_url+"/setGameSettings",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,game_settings:null},spinner:in_params&&in_params.spinner||null,show_network_message:in_params&&in_params.show_network_message||!1,on_process:function(in_data){var obj;APP.server;return(obj=APP.packageGameSettings()).match_summary=APP.session.packageMatchSummary(),obj.team_pool=APP.header.packageTeamPool(),obj.dctv_key=APP.device.is_broadcasting?APP.server.spectator_device_key:null,in_data.game_settings=JSON.stringify(obj),!0},on_success:function(in_data){srvr.set_game_settings_pending--,"OK"==in_data.status?(APP.server.game_id=in_data.payload.game_id,APP.server.confirmed_settings_version=in_data.payload.settings_version,BBAT.storeData({game_settings:APP.packageGameSettings()}),"function"==typeof APP.server.set_game_settings_success&&APP.server.set_game_settings_success()):-1!=in_data.status_text.indexOf("does not")?(APP.server.resetApiUrl(),APP.kickDeviceOut()):-1!=in_data.status_text.indexOf("not open")?("function"==typeof APP.server.set_game_settings_error&&APP.server.set_game_settings_error(),APP.server.resetApiUrl(),APP.revertToLocalPlay()):APP.recordError("(setGameSettings) "+in_data.status_text),APP.server.set_game_settings_success=null,APP.server.set_game_settings_error=null},on_error:function(in_a,in_b,in_c){return srvr.set_game_settings_pending--,APP.server.set_game_settings_success=null,APP.server.set_game_settings_error=null,!0}})))},submitGameEvent:function(in_params){var srvr=APP.server;srvr.submit_game_events_pending++,APP.server.squeue.enQueue({type:"GAME",caller:"submitGameEvent",url:APP.server.api_url+"/submitGameEvent",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,game_id:null,trans:null},on_process:function(in_data){var cmd_key,cmd_obj,srvr=APP.server,trans=[];if(srvr.confirmed_cmd_seq==APP.cmd_seq)return!1;for(in_data.game_id=srvr.game_id,i=srvr.confirmed_cmd_seq+1;i<=APP.cmd_seq;i++)if(cmd_key=APP.formatCmd(i),cmd_obj=BBAT.fetchData(cmd_key)){cmd_obj.cmd_data.dctv_key=APP.device.is_broadcasting?APP.server.spectator_device_key:null,cmd_obj.cmd_data.fast_finish_flights=!!APP.user_options.fast_finish_flights,cmd_obj.cmd_data.do_attempts=!!APP.user_options.do_attempts,cmd_obj.cmd_data.game_shot=!!APP.user_options.game_shot,cmd_obj.cmd&&"FINISH_GAME"===cmd_obj.cmd&&null!==APP.game.leg_forfeit&&(cmd_obj.cmd_data.leg_forfeit=APP.game.leg_forfeit);try{if(advLog.enabled){var logObj={type:"PR: "+i,data:cmd_obj.cmd_data};cmd_data.cmd&&(logObj.cmd=cmd_data.cmd),advLog.doLog(logObj)}}catch(e){}trans.push({cmd_seq:i,cmd:cmd_obj.cmd,cmd_data:JSON.stringify(cmd_obj.cmd_data)})}if(0==trans.length)return!1;if("PARTICIPANT"===APP.device.role)for(var i=0;i<trans.length;i++)"FINISH_GAME"===trans[i].cmd&&APP.server.sendHostGameFinish();return in_data.trans=JSON.stringify(trans),!0},on_success:function(in_data){srvr.submit_game_events_pending--,"OK"==in_data.status?(APP.server.confirmed_cmd_seq=in_data.payload.cur_cmd_seq,BBAT.storeData({server_cmd_seq:APP.server.confirmed_cmd_seq}),"function"==typeof in_params.success&&in_params.success()):-1!=in_data.status_text.indexOf("no chalk")?(APP.device.has_chalk=!1,APP.newGame()):-1!=in_data.status_text.indexOf("device not registered")?(APP.server.resetApiUrl(),APP.kickDeviceOut()):APP.game.isBotPlaying()||APP.recordError("(submitGameEvent) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return!0}})},getGameSettings:function(in_params){var srvr=APP.server;srvr.get_game_settings_pending>=1||(srvr.get_game_settings_pending++,APP.server.squeue.enQueue({type:"GAME",caller:"getGameSettings",url:APP.server.api_url+"/getGameSettings",spinner:in_params.spinner,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,alley_key:APP.server.alley_key,settings_version:APP.settings_version},on_success:function(in_data){var now=new Date;if(srvr.get_game_settings_pending--,"OK"==in_data.status){if(in_data.payload.game_settings&&in_data.payload.game_settings.match_summary)if("HOST"==APP.device.role){if("GAME"==in_data.payload.game_settings.match_summary.mode&&"MATCH"==APP.session.getMatchMode()&&APP.session.switchToGameMode(),in_data.payload.game_settings.match_summary.sets.length==APP.session.current_set+2)APP.session.addSet(in_data.payload.game_settings.game_name);else if(in_data.payload.game_settings.match_summary.sets.length==APP.session.current_set)APP.session.popSet();else if(in_data.payload.game_settings.match_summary.sets.length!=APP.session.current_set+1)throw"getGameSettings: Host set count is out of sync with Remote.";APP.session.setMatchFormat(in_data.payload.game_settings.match_summary.format)}else{in_data.payload.game_started||in_data.payload.chalk_owner===APP.device.token||APP.popup.show("popup-notice","Waiting for Game Start");var current_board=-1;try{in_data.payload.game_settings.current_board&&(current_board=in_data.payload.game_settings.current_board)}catch(e){}if(-1!=current_board){return void APP.kickDeviceOut('\n\t\t\t\t\t\t\t\t\tThis match is being played on a different board.\n\t\t\t\t\t\t\t\t\tPlease use <span class="bold">DC Preview</span> and connect with your opponent.\n\t\t\t\t\t\t\t\t')}APP.message_bar.refreshStatusMessage(),APP.server.spectator_device_key=in_data.payload.game_settings.dctv_key,APP.reveal.updateDCTVKey(),APP.session.loadMatchSummary({payload:in_data.payload.game_settings.match_summary}),APP.header.loadTeamPool(in_data.payload.game_settings.team_pool)}if(APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.reveal.updateSetStatus(),in_params.success(in_data.payload),in_data.payload.chalker_offline){if(APP.lobby.data.oppoLeftMsg)return;if(now-APP.server.chalk_last_asked>15e3){if(APP.server.chalk_last_asked=new Date,APP.starpubs.isSelectingPlayers||APP.starpubs.isSelectingTiebreaker)return;APP.confirm.show({title:"Connection Notice!",msg:"Connectivity Issues Detected.",ok_text:"Score the Current Turn",cancel_text:"Wait for your Opponent<br />to Reconnect",ok:function(){APP.server.chalk_last_asked=new Date,APP.server.takeChalk({success:APP.reload})},cancel:function(){APP.server.chalk_last_asked=new Date}})}}}else-1!=in_data.status_text.indexOf("not open")?(APP.isRevertingToLocal=!0,APP.server.resetApiUrl(),APP.kickDeviceOut()):APP.recordError("(getGameSettings) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return in_params.error&&in_params.error(in_a,in_b,in_c),srvr.get_game_settings_pending--,!1}}))},getGameEvents:function(in_params){var srvr=APP.server;BBAT.fetchData("chalk_pickup_pending")||srvr.get_game_events_pending>=1||(srvr.get_game_events_pending++,APP.server.squeue.enQueue({type:"GAME",caller:"getGameEvents",url:APP.server.api_url+"/getGameEvents?cacheBust="+Date.now(),spinner:in_params.spinner,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,alley_key:APP.server.alley_key,device_role:APP.device.role,game_id:APP.server.game_id,last_cmd_seq:APP.cmd_seq},on_success:function(in_data){var obj,cmd_key,cmd_value,now=new Date;if(srvr.get_game_events_pending--,"OK"==in_data.status){for(obj={},i=0;i<in_data.payload.length;i++)if(APP.server.last_received_event=now,"CHALKER_OFFLINE"==in_data.payload[i].cmd){if(APP.lobby.data.oppoLeftMsg)return;if(now-APP.server.chalk_last_asked>15e3){if(APP.server.chalk_last_asked=new Date,APP.lobby.data.blockFirstErrorLobby)return APP.lobby.data.blockFirstErrorLobby=!1,APP.lobby.save(),void APP.lobby.log("Suppressed Connectivity Error");APP.confirm.show({title:"Connection Notice!",msg:"Connectivity Issues Detected.",ok_text:"Score the Current Turn",cancel_text:"Wait for your Opponent<br />to Reconnect",ok:function(){APP.server.chalk_last_asked=new Date,APP.server.takeChalk({success:APP.reload})},cancel:function(){APP.server.chalk_last_asked=new Date}})}}else"CHALK_AVAILABLE"==in_data.payload[i].cmd?in_data.payload[i].cmd_data!=APP.device.token&&APP.server.pickupChalk():("PARTICIPANT"==APP.device.role&&(APP.server.spectator_device_key=JSON.parse(in_data.payload[i].cmd_data).dctv_key,APP.reveal.updateDCTVKey()),"RESET_GAME"==in_data.payload[i].cmd?cmd_key=APP.formatCmd(parseInt(APP.cmd_seq+1)):(cmd_key=APP.formatCmd(in_data.payload[i].cmd_seq),APP.server.confirmed_cmd_seq=parseInt(in_data.payload[i].cmd_seq),BBAT.storeData({server_cmd_seq:APP.server.confirmed_cmd_seq})),cmd_value={cmd:in_data.payload[i].cmd,cmd_data:JSON.parse(in_data.payload[i].cmd_data)},obj[cmd_key]=cmd_value);obj&&BBAT.storeData(obj),in_params.success();for(var i=0;i<in_data.payload.length;i++)"CANCEL_EOG"===in_data.payload[i].cmd&&!0===APP.is_reloading&&(APP.device.has_chalk?APP.server.startTimer("SEND"):APP.server.startTimer("RECEIVE"))}else{if(-1!=in_data.status_text.indexOf("Device not registered on alley"))return void APP.alert.show("Another Device has joined this match",(function(){APP.server.resetApiUrl(),APP.kickDeviceOut()}),null,"Connection Notice!");-1!=in_data.status_text.indexOf("not open")?(APP.server.resetApiUrl(),APP.kickDeviceOut()):in_data.status_text.indexOf("is stale")>=0?APP.game.finished||(APP.saveCurrentLegAsError("Received is stale from server"),APP.newGame("DELETE")):APP.recordError("(getGameEvents) "+in_data.status_text)}},on_error:function(in_a,in_b,in_c){return srvr.get_game_events_pending--,!1}}))},isConfGameFinished:!1,isCheckingConfGame:!1,confGameFinish:function(){if(!APP.server.isCheckingConfGame){var url=APP.server.api_url+"/hostConfGameFinish",data={member_id:APP.user?APP.user.member_id:"n/a",device_token:APP.device.token,device_role:APP.device.role,alley_id:APP.server.alley_id,game_id:APP.server.game_id};advLog.checkTournament()&&(data.log=1),window.setTimeout((function(){APP.server.isCheckingConfGame=!1}),3e3),APP.server.isCheckingConfGame=!0,$.ajax({url:url,type:"POST",cache:!1,dataType:"json",jsonp:!1,processData:!0,data:data,success:function(r){"OK"===r.status?(APP.server.isConfGameFinished=!0,APP.server.getGameEvents({success:function(){APP.processGameEvents()}})):window.setTimeout((function(){APP.server.confGameFinish()}),3e3)}})}},sendHostGameFinish:function(reloaded){if("HOST"===APP.device.role||APP.device.is_hosting)BBAT.flushData("updating_host_device");else{if(reloaded)APP.server.hostGameFinishWarning();else{if(!APP.server.sendHostGameTimer){var timerVars={name:"sendHostGameTimer",runTime:10,callback:function(manuallyEnded){manuallyEnded||APP.server.hostGameFinishWarning()},eachTick:function(){},debugMode:!1};APP.server.sendHostGameTimer=new Timer(timerVars)}APP.alert.show("Updating host device, please wait &hellip;",(function(){}),null,"Connection Notice!"),$("#alert-ok").hide(),APP.server.confHostGameFinish()}}},hostGameFinishWarning:function(){APP.alert.show('\n\t\t\t<span class="bold">This device is attempting to update your opponents device</span>\n\t\t\t<br /><br />\n\t\t\tIf you select "continue" before it succeeds<br />\n\t\t\t<span class="bold">You WILL Lose Match Data</span>\n\t\t\t<br /><br />\n\t\t\t<span style="font-size: 0.8em; line-height: 1.5em; display: block;">\n\t\t\t\tCheck the internet connection for both devices. If internet connectivity cannot be restored, there are two options: \n\t\t\t\t<br />\n\t\t\t\t1) Suspend the match on both devices until internet resumes\n\t\t\t\t2) Continue scoring the match on the Host Device ONLY, with the host scoring for both players.\n\t\t\t</span>\n\t\t',(function(){APP.confirm.show({msg:'If you continue:<br /> <span class="bold">You WILL Lose Match Data</span>',ok:function(){BBAT.flushData("updating_host_device"),APP.scoreboard.eolOverlayOff(),APP.server.stopHostGameFinish=!0},cancel:function(){APP.server.hostGameFinishWarning()}})}),null,"Warning!");new Timer({name:"sendHostGameTimer",runTime:19,callback:function(){$("#alert-ok").removeClass("button-disabled"),$("#alert-ok").text("Continue")},eachTick:function(){var timeLeft=this.getCountDown();$("#alert-ok").text("Continue ("+timeLeft+")")},debugMode:!1});$("#alert-ok").addClass("button-disabled"),$("#alert-ok").text("Continue (20)"),$("#alert-ok").show(),APP.server.confHostGameFinish()},sendHostGameTimer:null,stopHostGameFinish:!1,hostGameEnableOptions:!1,guestGameEndOfSet:!1,guestGameEndOfMatch:!1,confHostGameFinish:function(){if(APP.server.stopHostGameFinish)return BBAT.flushData("updating_host_device"),APP.scoreboard.eolOverlayOff(),APP.alert.hide(),void $("#alert-ok").show();BBAT.storeData({updating_host_device:!0});var url=APP.server.api_url+"/guestConfGameFinish",data={member_id:APP.user?APP.user.member_id:"n/a",device_token:APP.device.token,device_role:APP.device.role,alley_id:APP.server.alley_id,game_id:APP.server.game_id};advLog.checkTournament()&&(data.log=1),$.ajax({url:url,type:"POST",cache:!1,dataType:"json",jsonp:!1,processData:!0,data:data,success:function(r){"OK"===r.status?(APP.device.showSpinnerOverlay(),APP.alert.show("Game Starting, Please Wait...",(function(){}),null,"Match Updating"),$("#alert-ok").hide(),BBAT.flushData("updating_host_device"),APP.server.sendHostGameTimer&&APP.server.sendHostGameTimer.stopTimer(),APP.attemptEOGAutoForward(),APP.server.guestGameEndOfSet&&(APP.scoreboard.eolOverlayOff(),APP.alert.hide())):-1===r.status_text.indexOf("not open")?window.setTimeout((function(){APP.server.confHostGameFinish()}),3e3):(APP.scoreboard.eolOverlayOn(),BBAT.flushData("updating_host_device"),APP.kickDeviceOut(),$("#alert-ok").show()),APP.device.spinner.stop(),APP.device.hideSpinnerOverlay()},error:function(e){APP.scoreboard.eolOverlayOff(),BBAT.flushData("updating_host_device")}})},cancelChalkRelease:function(){APP.server.chalk_release_timer_id&&(BBAT.flushData("chalk_release_pending"),window.clearTimeout(APP.server.chalk_release_timer_id),APP.server.chalk_release_timer_id=null,APP.device.has_chalk=!0,APP.server.startTimer("SEND"),APP.device.enableChalkControls())},releaseChalk:function(in_on_success){function retainChalk(){APP.device.has_chalk=!0,APP.server.startTimer("SEND"),APP.device.enableChalkControls(),APP.reveal.setChalkButton()}BBAT.storeData({chalk_release_pending:!0}),APP.server.squeue.enQueue({type:"GAME",caller:"releaseChalk",url:APP.server.api_url+"/releaseChalk",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,cmd_seq:APP.cmd_seq},on_success:function(in_data){"OK"==in_data.status?APP.server.squeue.enQueue({type:"GAME",caller:"confirmChalk",url:APP.server.api_url+"/confirmChalk",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,confirm_mode:"RELEASE"},on_success:function(in_data){BBAT.flushData("chalk_release_pending"),"OK"==in_data.status?($("#mb-ig-control").css("display","inline-block"),$("#mb-ig-message").css("display","none"),"function"==typeof in_on_success?in_on_success():(APP.reveal.setChalkButton(),APP.server.startTimer("RECEIVE"))):-1!=in_data.status_text.indexOf("not open")?APP.kickDeviceOut():-1==in_data.status_text.indexOf("is stale")||APP.game.finished?(retainChalk(),APP.recordError("(releaseChalk) "+in_data.status_text),APP.alert.show(in_data.status_text,null,!0)):APP.newGame()},on_error:function(in_a,in_b,in_c){return BBAT.flushData("chalk_release_pending"),retainChalk(),!1}}):(BBAT.flushData("chalk_release_pending"),-1!=in_data.status_text.indexOf("not open")||-1!=in_data.status_text.indexOf("getting open alley")?APP.kickDeviceOut():-1==in_data.status_text.indexOf("is stale")||APP.game.finished?(retainChalk(),APP.recordError("(releaseChalk) "+in_data.status_text),APP.alert.show(in_data.status_text,null,!0)):APP.newGame())},on_error:function(in_a,in_b,in_c){return BBAT.flushData("chalk_release_pending"),retainChalk(),!1}})},takeChalk:function(in_spec){(in_spec=in_spec||{}).take_it=!0,APP.server.pickupChalk(in_spec)},pickupChalk:function(in_spec){APP.server;in_spec=in_spec||{},BBAT.storeData({chalk_pickup_pending:!0}),APP.server.squeue.enQueue({type:"GAME",caller:in_spec.take_it?"takeChalk":"pickupChalk",url:APP.server.api_url+(in_spec.take_it?"/takeChalk":"/pickupChalk"),spinner:in_spec.spinner,data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,cmd_seq:APP.cmd_seq},on_success:function(in_data){"OK"==in_data.status?APP.server.squeue.enQueue({type:"GAME",caller:"confirmChalk",url:APP.server.api_url+"/confirmChalk",data:{device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user.token,alley_id:APP.server.alley_id,confirm_mode:"PICKUP"},on_success:function(in_data){BBAT.flushData("chalk_pickup_pending"),"OK"==in_data.status?($("#mb-ig-control").css("display","none"),$("#mb-ig-message").css("display","inline-block"),APP.device.has_chalk=!0,APP.server.chalking_opponent=APP.game.current_opponent,APP.server.chalking_round=APP.game.current_round,APP.reveal.setChalkButton(),APP.storeState(),in_spec.take_it?"function"==typeof in_spec.success&&in_spec.success():APP.game.finished?APP.reload():(APP.device.enableChalkControls(),APP.server.startTimer("SEND"))):-1!=in_data.status_text.indexOf("not open")?APP.kickDeviceOut():-1==in_data.status_text.indexOf("is stale")||APP.game.finished?(APP.recordError("(pickupChalk) "+in_data.status_text),APP.alert.show(in_data.status_text,null,!0)):APP.newGame()},on_error:function(in_a,in_b,in_c){return BBAT.flushData("chalk_pickup_pending"),!0}}):(BBAT.flushData("chalk_pickup_pending"),-1!=in_data.status_text.indexOf("not open")?APP.kickDeviceOut():-1==in_data.status_text.indexOf("is stale")||APP.game.finished?(APP.recordError("(pickupChalk) "+in_data.status_text),APP.alert.show(in_data.status_text,null,!0)):APP.newGame())},on_error:function(in_a,in_b,in_c){return BBAT.flushData("chalk_pickup_pending"),!1}})},startTimer:function(in_mode){APP.is_reloading=!1,APP.server.mode!=in_mode&&(APP.server.stopTimer(),APP.server.mode=in_mode,"RECEIVE"==APP.server.mode&&(APP.server.timer=window.setInterval((function(){"PRE-GAME"==APP.mode?APP.server.getGameSettings({success:function(in_payload){in_payload.game_settings&&APP.processGameSettings(in_payload.game_settings),APP.message_bar.display(APP.session.getMessage()),APP.header.refresh(),in_payload.game_started&&(APP.storeState(),APP.changeMode("IN-GAME"))}}):APP.server.getGameEvents({success:function(){APP.processGameEvents()}})}),1e3)))},stopTimer:function(){APP.server.timer&&window.clearInterval(APP.server.timer),APP.server.timer=null,APP.server.mode=null},updateSyncMessages:function(in_status){var el,gc,id,is_log_showing,is_summary_showing,is_welcome_showing,mc,msg,spinner=APP.server.sync_spinner;if($(".sync-message").removeClass("sync-message-pending").html("&nbsp;<br />&nbsp;"),is_summary_showing=!("none"==$("#popup-session-summary").css("display")),is_log_showing=!("none"==$("#popup-device-log").css("display")),is_welcome_showing=!("none"==$("#device-role-menu").css("display")),is_summary_showing)id="pss-sync-message";else if(is_log_showing)id="pdl-sync-message";else{if(!is_welcome_showing)return;id="drm-log"}gc=APP.session.getGamesPendingSyncCount(),mc=APP.session.getMatchesPendingCloseCount(),is_welcome_showing?0==mc?(msg="All Matches Saved",$("#drm-log").removeClass("button-gold").addClass("button-grey")):(msg=mc+" Unsaved Match"+(1==mc?"":"es"),$("#drm-log").removeClass("button-grey").addClass("button-gold")):0==gc&&0==mc?msg="All games saved.<br />All matches saved.":(0==mc&&(mc=1),msg=gc+" game"+(1==gc?"":"s")+" waiting to be saved.<br />"+mc+" match"+(1==mc?"":"es")+" waiting to be saved."),(el=$("#"+id)).html(msg),(gc>0||mc>0)&&el.addClass("sync-message-pending"),"ACTIVE"!=in_status||is_welcome_showing?spinner.stop():spinner.spin(document.getElementById(id))},has_history_sync_failed:!1,hasPendingFinishedGames:function(in_ignore_offline){var match,ms,ms_len,ss,ss_len,gs,gs_len,i,j,k;if(APP.isOffline())return!1;if(APP.server.sync_pending)return!1;for(ms_len=(ms=APP.session.matches).length,i=0;i<ms_len;i++)if("HOST"==(match=ms[i]).role&&!match.closed)for(ss_len=(ss=match.sets).length,j=0;j<ss_len;j++){if(ss[j].forfeited&&!ss[j].forfeit_recorded)return!0;for(gs_len=(gs=ss[j].games).length,k=0;k<gs_len;k++)if(null==gs[k].game_guid)return!0}return!1},forwardFinishedGames:function(){var match,m,ss,ss_len,set,s,gs,gs_len,ms,ms_len,g,i,j,h;if(!APP.isOffline()&&!APP.server.sync_pending){ms_len=(ms=APP.session.matches).length;match_loop:for(h=0;h<ms_len;h++)if("HOST"==(match=ms[h]).role&&!match.closed){if((m={}).first_name=match.first_name,m.last_name=match.last_name,m.member_id=match.member_id,m.closed=match.closed,m.bracket_interface_id=match.bracket_interface_id,m.bracket_board_id=match.bracket_board_id,m.bracket_event_id=match.bracket_event_id,m.bracket_match_id=match.bracket_match_id,m.bracket_match_premature_end=match.bracket_match_premature_end,m.event_id=match.event_guid,m.league_id=match.league_id,m.league_guid=match.league_guid,m.league_match_id=match.league_match_id,m.match_format_style=match.match_format_style,m.league_set_id=match.league_set_id,m.league_set_number=match.league_set_number,m.league_practice_match=match.league_practice_match,m.league_division_guid=match.league_division_guid,m.season_status=match.season_status,m.season_id=match.season_id,m.opponent_guids=match.opponent_guids,m.tournament_id=match.tournament_id,m.broadcast_matches_id=match.broadcast_matches_id,m.broadcast_matches_status=match.broadcast_matches_status,m.was_broadcasting=match.was_broadcasting,m.was_hosting=match.was_hosting,m.app_version=APP.version,m.title=match.title,m.description=match.description,m.name=match.name,m.mode=match.mode,m.format=match.format,m.match_points=match.match_points,m.name_timestamp=match.name_timestamp,m.start_time=match.start_time,m.finish_time=match.finish_time,m.device_token=APP.device.token,m.money_round=match.money_round,m.tiebreaker=match.tiebreaker,m.tournament_event_type=match.tournament_event_type,m.suppress_recap_email=match.suppress_recap_email,m.game_count=match.game_count,m.game_time=match.game_time,m.rounds=match.rounds,m.game_wins=match.game_wins,m.set_wins=APP.session.calculateRealSetWins(match.sets),m.points=match.points,m.point_darts=match.point_darts,m.bonus_points=match.bonus_points,m.bonus_points_win=match.bonus_points_win,m.bonus_points_sweep=match.bonus_points_sweep,m.sweep_requirement=match.sweep_requirement,m.high_points_turn=match.high_points_turn,m.high_points_in=match.high_points_in,m.high_points_out=match.high_points_out,m.marks=match.marks,m.mark_darts=match.mark_darts,m.high_marks_turn=match.high_marks_turn,m.high_bull_turn=match.high_bull_turn,m.high_marks_in=match.high_marks_in,m.high_marks_out=match.high_marks_out,!(g=match.sets[0].games[0])&&!match.sets[0].forfeited)continue match_loop;for(ss_len=(ss=match.sets).length,i=0;i<ss_len;i++){if((set=ss[i]).forfeited&&!set.forfeit_recorded){(s={}).forfeited=set.forfeited,s.forfeit_time=set.forfeit_time,s.forfeit_type=set.forfeit_type,s.forfeit_players=$.extend(set.forfeit_players,[]),s.start_time=set.forfeit_time,s.wins=set.wins,s.set_id=set.set_id,s.set_number=set.set_number,s.league_points=set.league_points,APP.server.updateSyncMessages("ACTIVE"),APP.server.sync_pending++,APP.server.sync_match_index=h,APP.server.squeue.enQueue({type:"HISTORY",caller:"forwardFinishedGames",url:"/api/history/sync",process_data:!1,data:JSON.stringify({member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user?APP.user.token:"",device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,match_id:match.match_guid,match_data:m,set_index:i,set_data:s}),on_success:function(in_data){if("OK"==in_data.status)match.match_guid=in_data.payload.match_id,set.forfeit_recorded=!0;else{var errorData={timestamp:(new Date).valueOf(),server_error:in_data.status_text,leg:g,server_down:!1};APP.session.matches[APP.session.matches.length-1].error_legs.push(errorData),set.forfeit_recorded=!0,APP.recordError("(forwardFinishedGames) "+in_data.status_text)}APP.session.store(APP.server.sync_match_index),APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--},on_error:function(in_a,in_b,in_c){if(APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--,APP.server.has_history_sync_failed=!0,!APP.server.errorLegAlreadyRecorded(g.start_time)){var errorData={timestamp:(new Date).valueOf(),server_error:in_a.status+": "+in_a.statusText,leg:g,server_down:!0};return APP.session.matches[APP.session.matches.length-1].error_legs.push(errorData),!1}}});break match_loop}if(set.games.length){(s={}).wins=set.wins,s.start_time=set.games[0].start_time,s.forfeited=!1,s.forfeit_time=null,s.forfeit_type=null,s.forfeit_players=null,set.points&&(s.league_points=set.points),gs_len=(gs=set.games).length;var player_format=0;try{for(var ii=0;ii<gs_len;ii++)for(var _oppo=gs[ii].opponents,pf_o=0;pf_o<_oppo.length;pf_o++)_oppo[pf_o].team.players.length>player_format&&(player_format=_oppo[pf_o].team.players.length)}catch(error){}for(s.player_format=player_format,APP.nlf.data.rails&&(s.set_id=m.league_set_id,s.set_number=m.league_set_number),i==ss_len-1&&h==APP.session.current_match&&APP.game.finished&&!APP.game.isEOGFinal()&&gs_len--,j=0;j<gs_len;j++)if(g=gs[j],APP.nlf.data.rails&&(g.set_id=m.league_set_id,g.set_number=m.league_set_number),null==g.game_guid){APP.server.updateSyncMessages("ACTIVE"),APP.server.sync_pending++,APP.server.sync_match_index=h,APP.server.squeue.enQueue({type:"HISTORY",caller:"forwardFinishedGames",url:"/api/history/sync",process_data:!1,data:JSON.stringify({member_id:APP.user?APP.user.member_id:"n/a",user_token:APP.user?APP.user.token:"",device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,match_id:match.match_guid,match_data:m,set_index:i,set_data:s,game_index:j,game_data:g}),on_success:function(in_data){if("OK"==in_data.status)match.match_guid=in_data.payload.match_id,g.game_guid=in_data.payload.game_id;else{if(in_data.status_text&&"Server paused for restart"==in_data.status_text)return;var errorData={timestamp:(new Date).valueOf(),server_error:in_data.status_text,leg:g,server_down:!1};APP.session.matches[APP.session.matches.length-1].error_legs.push(errorData),g.game_guid=-1,APP.recordError("(forwardFinishedGames) "+in_data.status_text)}APP.session.store(APP.server.sync_match_index),APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--},on_error:function(in_a,in_b,in_c){if(APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--,APP.server.has_history_sync_failed=!0,!APP.server.errorLegAlreadyRecorded(g.start_time)){var errorData={timestamp:(new Date).valueOf(),server_error:in_a.status+": "+in_a.statusText,leg:g,server_down:!0};return APP.session.matches[APP.session.matches.length-1].error_legs.push(errorData),!1}}});break match_loop}}}}}},errorLegAlreadyRecorded:function(startTime){var errorLegs=APP.session.matches[APP.session.matches.length-1].error_legs;if(!errorLegs)return!1;if(!errorLegs.length)return!1;for(var errorLegArr=[],i=0;i<errorLegs.length;i++){var errorLeg=errorLegs[i];errorLegArr.push(errorLeg.leg)}return APP.findInObjArray("start_time",errorLegArr,startTime).length},hasPendingFinishedMatches:function(in_ignore_offline){var match,ms_len,ms,i,ss_len,ss,j,gs_len,gs,k,ready;if(APP.cleanBasicMatches(),!in_ignore_offline&&APP&&APP.user_options&&APP.user_options.offline)return!1;if(APP.server.sync_pending)return!1;for(ms_len=(ms=APP.session.matches).length,i=0;i<ms_len;i++)if("HOST"==(match=ms[i]).role&&(match.match_guid||match.bracket_match_premature_end)&&match.signed_off&&!match.closed){for(ready=!0,ss_len=(ss=match.sets).length,j=0;j<ss_len&&ready;j++)if(ss[j].forfeited)ready=ss[j].forfeit_recorded&&ready;else for(gs_len=(gs=ss[j].games).length,k=0;k<gs_len;k++)ready=gs[k].game_guid&&ready;if(ready)return!0}return!1},forwardFinishedMatches:function(){var match,ms_len,ms,m,i,ss_len,ss,j,gs_len,gs,k,ready;if(!APP.isOffline()&&!APP.server.sync_pending){ms_len=(ms=APP.session.matches).length;var failedMatches=[],newMatches=[];for(i=0;i<ms_len;i++)(match=ms[i]).failed_sync?failedMatches.push(match):newMatches.push(match);for(ms=newMatches.concat(failedMatches),i=0;i<ms_len;i++){var isBotMatch=!1;if("HOST"==(match=ms[i]).role&&(match.match_guid||match.bracket_match_premature_end)&&match.signed_off&&!match.closed){for(ready=!0,ss_len=(ss=match.sets).length,j=0;j<ss_len&&ready;j++)if(ss[j].forfeited)ready=ss[j].forfeit_recorded&&ready;else for(gs_len=(gs=ss[j].games).length,k=0;k<gs_len;k++){ready=gs[k].game_guid&&ready;try{for(var oppos=gs[k].opponents,l=0;l<oppos.length;l++){var oppo=oppos[l];"DartConnect"!=oppo.chalkboard_name&&"ExactBot"!=oppo.chalkboard_name||(isBotMatch=!0)}}catch(e){}}if(ready)return APP.server.sync_match_index=i,(m={}).closed=!0,m.app_version=APP.version,m.backup_tablet=APP.markMatchAsBackup(),m.event_id=match.event_guid,m.bracket_interface_id=match.bracket_interface_id,m.bracket_board_id=match.bracket_board_id,m.bracket_event_id=match.bracket_event_id,m.bracket_match_id=match.bracket_match_id,m.bracket_match_premature_end=match.bracket_match_premature_end,m.match_format_style=match.match_format_style,m.league_set_id=match.league_set_id,m.league_set_number=match.league_set_number,m.league_amb_set_scores=match.league_amb_set_scores,m.league_practice_match=match.league_practice_match,m.league_id=match.league_id,m.league_guid=match.league_guid,m.league_division_guid=match.league_division_guid,m.league_match_id=match.league_match_id,m.season_status=match.season_status,m.season_id=match.season_id,m.opponent_guids=match.opponent_guids,m.tournament_id=match.tournament_id,m.broadcast_matches_id=match.broadcast_matches_id,m.broadcast_matches_status=match.broadcast_matches_status,m.was_broadcasting=match.was_broadcasting,m.was_hosting=match.was_hosting,m.first_name=match.first_name,m.last_name=match.last_name,m.member_id=match.member_id,m.title=match.title,m.description=match.description,m.name=match.name,m.mode=match.mode,m.format=match.format,m.match_points=match.match_points,m.notes=match.notes,m.manual_notes=match.manual_notes,m.error_legs=match.error_legs,m.lobby_data=match.lobby_data,m.name_timestamp=match.name_timestamp,m.start_time=match.start_time,m.finish_time=match.finish_time,m.device_token=APP.device.token,m.money_round=match.money_round,m.tiebreaker=match.tiebreaker,m.tournament_event_type=match.tournament_event_type,m.suppress_recap_email=match.suppress_recap_email,m.game_count=match.game_count,m.game_time=match.game_time,m.rounds=match.rounds,m.game_wins=match.game_wins,m.set_wins=APP.session.calculateRealSetWins(match.sets),m.points=match.points,m.point_darts=match.point_darts,m.points_style=match.points_style,m.bonus_points=match.bonus_points,m.bonus_points_win=match.bonus_points_win,m.bonus_points_sweep=match.bonus_points_sweep,m.sweep_requirement=match.sweep_requirement,m.high_points_turn=match.high_points_turn,m.high_points_in=match.high_points_in,m.high_points_out=match.high_points_out,m.marks=match.marks,m.mark_darts=match.mark_darts,m.high_marks_turn=match.high_marks_turn,m.high_bull_turn=match.high_bull_turn,m.high_marks_in=match.high_marks_in,m.high_marks_out=match.high_marks_out,m.user_agent=navigator.userAgent?navigator.userAgent:null,m.guest_team_guid=match.guest_team_guid,m.is_bot_match=isBotMatch,m.adv_logging=match.adv_logging,m.fast_forwarded=match.fast_forwarded,APP.server.updateSyncMessages("ACTIVE"),APP.server.sync_pending++,void APP.server.squeue.enQueue({type:"HISTORY",caller:"forwardFinishedMatches",url:"/api/history/updateMatch",process_data:!1,data:JSON.stringify({user_token:APP.user?APP.user.token:"",member_id:APP.user?APP.user.member_id:"n/a",device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,match_id:match.match_guid,match_data:m}),on_success:function(in_data){"OK"!=in_data.status&&APP.recordError("(forwardFinishedMatches) "+in_data.status_text);try{if(in_data.payload.service_disabled)return APP.server.squeue.has_delay=!0,APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--,APP.server.has_history_sync_failed=!0,!1}catch(e){}try{("OK"==in_data.status||in_data.status_text.toLowerCase().indexOf("match is closed")>=0)&&(APP.session.matches[APP.server.sync_match_index].match_guid=in_data.payload.match_id,APP.session.matches[APP.server.sync_match_index].closed=!0,APP.session.store(APP.server.sync_match_index))}catch(e){}try{"FAILED"==in_data.status&&(APP.session.matches[APP.server.sync_match_index].failed_sync=!0)}catch(e){}APP.session.cleanUpClosedMatches(),APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--},on_error:function(in_a,in_b,in_c){return APP.server.updateSyncMessages(),APP.server.sync_match_index=null,APP.server.sync_pending--,APP.server.has_history_sync_failed=!0,!1}})}}}},removeTournamentPlayer:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"removeTournamentPlayer",url:"/ajax/tournamentPlayerRemove",show_network_message:!1,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,tournament_id:APP.session.getTournamentID(),first_name:in_params.first_name,last_name:in_params.last_name,email:in_params.email},on_success:function(in_data){"OK"!=in_data.status&&APP.recordError("(removeTournamentPlayer) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return!1}})},addTournamentPlayer:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"addTournamentPlayer",url:"/ajax/tournamentPlayerAdd",show_network_message:!1,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,tournament_id:APP.session.getTournamentID(),first_name:in_params.first_name,last_name:in_params.last_name,chalkboard_name:in_params.chalkboard_name,email:in_params.email},on_success:function(in_data){"OK"!=in_data.status&&APP.recordError("(addTournamentPlayer) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return!1}})},getTournamentList:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"getTournamentList",url:"/api/tournaments/getTournaments",show_network_message:!1,spinner:!1,data:{user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone},on_success:function(in_data){"OK"==in_data.status?in_params.on_success(in_data.payload):(APP.recordError("(getTournamentList) "+in_data.status_text),"function"==typeof in_params.on_logic_error&&setTimeout(in_params.on_logic_error,5))},on_error:function(in_a,in_b,in_c){return"function"==typeof in_params.on_network_error&&setTimeout(in_params.on_network_error,5),!1}})},getLeagueDivisionDirectory:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"getLeagueDivisionDirectory",url:"/getLeagueDivisionDirectory",show_network_message:!1,spinner:in_params.spinner,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,league_division_guid:in_params.league_division_guid,season_status:in_params.season_status,directory_edit_date:in_params.edit_date},on_success:function(in_data){"OK"==in_data.status?in_params.on_success(in_data.payload):"directory is up-to-date"==in_data.status_text?in_params.on_success():(APP.recordError("(getLeagueDivisionDirectory) "+in_data.status_text),"function"==typeof in_params.on_logic_error&&setTimeout(in_params.on_logic_error,5))},on_error:function(in_a,in_b,in_c){return"function"==typeof in_params.on_network_error&&setTimeout(in_params.on_network_error,5),!1}})},getBracketTournamentSetup:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"getBracketTournamentSetup",url:"/getBracketTournamentSetup",show_network_message:!0,spinner:!0,data:{user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,dc_tournament_id:in_params.dc_tournament_id},on_success:function(in_data){"OK"==in_data.status?in_params.on_success(in_data.payload):(APP.recordError("(getBracketTournamentSetup) "+in_data.status_text),"function"==typeof in_params.on_logic_error&&setTimeout(in_params.on_logic_error,5))},on_error:function(in_a,in_b,in_c){return"function"==typeof in_params.on_network_error&&setTimeout(in_params.on_network_error,5),!1}})},getBracketMatches:function(in_params){var data={user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,dc_tournament_id:in_params.tournament_id,data_version_number:APP.data_version_number};APP.session.isUserMatchesOnly()?data.member_id=APP.user.member_id:data.board_id=in_params.board_id,APP.server.squeue.enQueue({type:"REGISTER",caller:"getBracketMatches",url:"/getBracketMatches",show_network_message:!1,spinner:!0,data:data,on_success:function(in_data){"OK"==in_data.status?in_params.on_success(in_data.payload):(APP.recordError("(getBracketMatches) "+in_data.status_text),"function"==typeof in_params.on_logic_error&&setTimeout(in_params.on_logic_error,5))},on_error:function(in_a,in_b,in_c){return"function"==typeof in_params.on_network_error&&setTimeout(in_params.on_network_error,5),!1}})},abandonBracketMatch:function(in_params){if(!APP.user_options.backup_tablet){var data={device_token:APP.device.token,dc_tournament_id:in_params.tournament_id,bracket_event_id:in_params.event_id,bracket_match_id:in_params.match_id,board_number:in_params.board_number};APP.server.squeue.enQueue({type:"REGISTER",caller:"abandonBracketMatch",url:"/abandonBracketMatch",show_network_message:!1,spinner:!1,data:data,on_success:function(in_data){"OK"==in_data.status||(APP.recordError("(abandonBracketMatch) "+in_data.status_text),"function"==typeof in_params.on_logic_error&&setTimeout(in_params.on_logic_error,5))},on_error:function(in_a,in_b,in_c){return"function"==typeof in_params.on_network_error&&setTimeout(in_params.on_network_error,5),!1}})}},addUpdateLeaguePlayer:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"addUpdateLeaguePlayer",url:"/addUpdateLeaguePlayer",show_network_message:!1,spinner:!1,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,player_guid:in_params.player_guid,first_name:in_params.first_name,last_name:in_params.last_name,email:in_params.email},on_success:function(in_data){"OK"==in_data.status||APP.recordError("(addUpdateLeaguePlayer) "+in_data.status_text)},on_error:function(in_a,in_b,in_c){return!1}})},addLeaguePlayer:function(in_params){APP.server.squeue.enQueue({type:"REGISTER",caller:"addLeaguePlayer",url:"/addLeaguePlayer",show_network_message:!1,spinner:!1,data:{member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,team_guid:in_params.team_guid,first_name:in_params.first_name,last_name:in_params.last_name,email:in_params.email,match_id:in_params.match_id},on_success:function(in_data){"OK"==in_data.status&&in_params.on_success(in_data.payload)},on_error:function(in_a,in_b,in_c){return!1}})},hasPendingAjaxStats:function(){var p,cnt,stats=APP.server.ajax_stats;for(p in cnt=0,stats)cnt++;return cnt>2},forwardAjaxStats:function(){var srvr=APP.server;new Date;srvr.initAjaxStatsCollection()},prepAjaxStatRecord:function(in_type,in_caller){APP.server.ajax_stats},startAjaxCall:function(in_type,in_caller){APP.server;return 0},recordAjaxSuccess:function(in_ajax_id){APP.server},recordAjaxError:function(in_ajax_id,in_a,in_b,in_c){APP.server},storeAjaxStats:function(){BBAT.storeData({ajax_stats:APP.server.ajax_stats})},fetchAjaxData:function(){var srvr=APP.server;srvr.ajax_stats=BBAT.fetchData("ajax_stats"),null==srvr.ajax_stats&&srvr.initAjaxStatsCollection()},initAjaxStatsCollection:function(){var srvr=APP.server;delete srvr.ajax_calls,srvr.ajax_calls=[],delete srvr.ajax_stats,BBAT.flushData("ajax_stats"),srvr.ajax_stats={},srvr.ajax_stats.client_start_time=new Date,srvr.ajax_stats.client_stop_time=0,srvr.storeAjaxStats()}},APP.dartbot={levels:[{label:"1",skill:5,ppr:"31",mpr:"0.8"},{label:"2",skill:8,ppr:"36",mpr:"1.0"},{label:"3",skill:11,ppr:"41",mpr:"1.3"},{label:"4",skill:14,ppr:"44",mpr:"1.5"},{label:"5",skill:17,ppr:"49",mpr:"1.8"},{label:"6",skill:20,ppr:"55",mpr:"2.2"},{label:"7",skill:23,ppr:"60",mpr:"2.5"},{label:"8",skill:26,ppr:"64",mpr:"2.8"},{label:"9",skill:29,ppr:"71",mpr:"3.3"},{label:"10",skill:32,ppr:"81",mpr:"3.9"},{label:"11",skill:35,ppr:"91",mpr:"4.4"},{label:"12",skill:38,ppr:"100",mpr:"4.9"}],getExactBotLevel:function(fullName,noDarts){try{if(noDarts)return"ExactBot";var darts=APP.dartbot.activeScript.replace(/\D/g,"");if(fullName){var title="ExactBot";return darts&&(title+=" ("+darts+")"),title}return darts}catch(e){}return""},enableExactBot:function(darts){var scriptName="darter"+darts;if(APP.dartbot.scripts[scriptName]){var data={active:!0,locked:!0,script:"darter"+darts};APP.dartbot.isScripted=!0,APP.dartbot.locked=!0,APP.dartbot.activeScript=scriptName,APP.dartbot.saveExactBot(data)}},isScripted:!1,locked:!1,activeScript:"darter21",scripts:{darter36:{game:"01",starting_score:501,turns:[20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,5,1,20,5,1,20,20,20]},darter33:{game:"01",starting_score:501,turns:[20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,20,20,1,17,42,16]},darter30:{game:"01",starting_score:501,turns:[20,20,5,20,20,5,20,20,5,20,20,5,20,20,5,20,20,5,20,20,5,20,20,19,20,20,17,18,12,20]},darter27:{game:"01",starting_score:501,turns:[20,20,20,20,20,20,20,20,20,20,20,5,20,20,5,20,20,5,20,20,19,20,20,17,18,12,20]},darter24:{game:"01",starting_score:501,turns:[20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,19,36,13]},darter21:{game:"01",starting_score:501,turns:[60,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,19,60,10,16]},darter18:{game:"01",starting_score:501,turns:[60,20,20,60,20,20,20,20,20,20,20,20,20,20,20,60,33,14]},darter15:{game:"01",starting_score:501,turns:[60,60,20,60,20,20,60,20,20,60,20,19,10,20,16]},darter12:{game:"01",starting_score:501,turns:[60,60,60,60,60,60,60,20,1,60,20,10]},darter9:{game:"01",starting_score:501,turns:[60,60,60,60,60,60,60,57,12]}},saveExactBot:function(data){BBAT.storeData({exactbot_data:data})},loadExactBot:function(){var savedData=BBAT.fetchData("exactbot_data");savedData&&(APP.dartbot.isScripted=!0,savedData.script&&(APP.dartbot.activeScript=savedData.script),savedData.locked&&(APP.dartbot.locked=savedData.locked))},clearExactBot:function(){BBAT.flushData("exactbot_data"),APP.dartbot.isScripted=!1,APP.dartbot.locked=!1},getName:function(in_skill){var n,x,y;if(APP.dartbot.isScripted)return APP.dartbot.getExactBotLevel(!0,!0);switch(in_skill){case 1:return"DC 0.0";case 2:return"DC 0.3";case 3:return"DC 0.5";case 4:return"DC 0.7";case 38:return"DC 12.0";case 39:return"DC 12.3";case 40:return"DC 12.5";case 41:return"DC 12.7";default:switch(x=(n=in_skill-2)%3,y=Math.floor(n/3),x){case 0:return"DC "+y+".0";case 1:return"DC "+y+".3";case 2:return"DC "+y+".7"}}},promoteSkill:function(in_skill){return in_skill==APP.dartbot.skills_01.length-1?in_skill:in_skill+1},demoteSkill:function(in_skill){return 1==in_skill?in_skill:in_skill-1},attemptThrow:function(in_target,in_skill){var target,angle,radius,offset_point,hit_point;return target=Board.GetTargetPoint(in_target.SectorIndex,in_target.Ring),angle=Random.GetUniform()*Math.PI*2,radius=Random.GetNormal(in_skill.mean,in_skill.stdev),offset_point=new PolarPoint(radius,angle),hit_point=PolarPoint.AddPoints(target,offset_point),Board.GetHit(hit_point)},skills_01:[{},{mean:0,stdev:200},{mean:0,stdev:180},{mean:0,stdev:165},{mean:0,stdev:150},{mean:0,stdev:140},{mean:0,stdev:130},{mean:0,stdev:120},{mean:0,stdev:110},{mean:0,stdev:100},{mean:0,stdev:95},{mean:0,stdev:90},{mean:0,stdev:85},{mean:0,stdev:80},{mean:0,stdev:75},{mean:0,stdev:70},{mean:0,stdev:65},{mean:0,stdev:60},{mean:0,stdev:55},{mean:0,stdev:50},{mean:0,stdev:47.5},{mean:0,stdev:45},{mean:0,stdev:42.5},{mean:0,stdev:40},{mean:0,stdev:38},{mean:0,stdev:36},{mean:0,stdev:35},{mean:0,stdev:34},{mean:0,stdev:32},{mean:0,stdev:28},{mean:0,stdev:26},{mean:0,stdev:24},{mean:0,stdev:20},{mean:0,stdev:19},{mean:0,stdev:18},{mean:0,stdev:17},{mean:0,stdev:16},{mean:0,stdev:15},{mean:0,stdev:13},{mean:0,stdev:10},{mean:0,stdev:5},{mean:0,stdev:0}],targets_lookup_01:[[1,1],[1,1],[1,2],[1,1],[2,2],[1,1],[3,2],[3,1],[4,2],[1,1],[5,2],[3,1],[6,2],[1,1],[7,2],[3,1],[8,2],[1,1],[9,2],[3,1],[10,2],[5,1],[11,2],[7,1],[12,2],[9,1],[13,2],[11,1],[14,2],[13,1],[15,2],[15,1],[16,2],[17,1],[17,2],[3,1],[18,2],[5,1],[19,2],[7,1],[20,2],[9,1],[10,1],[11,1],[12,1],[13,1],[14,1],[15,1],[16,1],[17,1],[25,2],[19,1],[20,1],[13,1],[14,1],[15,1],[16,1],[17,1],[18,1],[19,1],[20,1],[15,3],[10,3],[13,3],[16,3],[15,3],[14,3],[17,3],[20,3],[19,3],[18,3],[13,3],[20,3],[19,3],[14,3],[15,3],[20,3],[15,3],[14,3],[13,3],[20,3],[19,3],[14,3],[17,3],[20,3],[15,3],[18,3],[17,3],[16,3],[19,3],[18,3],[17,3],[20,3],[19,3],[18,3],[15,3],[20,3],[19,3],[20,3],[19,3]],selectTarget01:function(in_darts_left){var cs,opts,db,tlu,num,mult,ring,sector;if(tlu=APP.dartbot.targets_lookup_01,opts=APP.game.options,cs=(db=APP.game.opponent[APP.game.active_opponent]).getCurrentScore()-APP.equation.value(),!db.has_doubled_in&&(opts.double_in||opts.two_player_double_in))return new Hit(0,RingType.Double);if(cs>tlu.length-1)return new Hit(0,RingType.Treble);if(!APP.game.getOption("double_out")&&(25==cs||cs<=20)?(num=cs,mult=1):(num=tlu[cs][0],mult=tlu[cs][1]),25===num&&1===mult)return new Hit(0,RingType.SingleBull);if(25===num&&2===mult)return new Hit(0,RingType.DoubleBull);if(sector=Board.GetSectorIndex(tlu[cs][0]),1===mult)ring=RingType.FatSingle;else if(2===mult)ring=RingType.Double;else{if(3!==mult)throw"Invalid ring multiplier["+mult+"]";ring=RingType.Treble}return new Hit(sector,ring)},hasEnoughToWin01:function(){return 0==APP.game.opponent[APP.game.active_opponent].getCurrentScore()-APP.equation.value()},isBust01:function(){return APP.game.opponent[APP.game.active_opponent].getCurrentScore()-APP.equation.value()<0},skills_cricket:[{},{mean:0,stdev:200},{mean:0,stdev:180},{mean:0,stdev:165},{mean:0,stdev:150},{mean:0,stdev:140},{mean:0,stdev:130},{mean:0,stdev:120},{mean:0,stdev:110},{mean:0,stdev:100},{mean:0,stdev:95},{mean:0,stdev:90},{mean:0,stdev:85},{mean:0,stdev:80},{mean:0,stdev:75},{mean:0,stdev:70},{mean:0,stdev:65},{mean:0,stdev:60},{mean:0,stdev:55},{mean:0,stdev:50},{mean:0,stdev:47.5},{mean:0,stdev:45},{mean:0,stdev:42.5},{mean:0,stdev:40},{mean:0,stdev:38},{mean:0,stdev:36},{mean:0,stdev:35},{mean:0,stdev:34},{mean:0,stdev:32},{mean:0,stdev:28},{mean:0,stdev:26},{mean:0,stdev:24},{mean:0,stdev:20},{mean:0,stdev:19},{mean:0,stdev:18},{mean:0,stdev:17},{mean:0,stdev:16},{mean:0,stdev:15},{mean:0,stdev:13},{mean:0,stdev:10},{mean:0,stdev:5},{mean:0,stdev:0}],selectTargetCricket:function(in_darts_left,in_double_needed){var db,db_points,db_is_ahead,db_is_exposed,db_can_close,oppo,oppo_points,oppo_is_exposed,target,len,t,d,o,gam;db=(gam=APP.game).opponent[gam.active_opponent],oppo=gam.opponent[0==gam.active_opponent?1:0];var db_exposed=[],oppo_exposed=[],open_targets=[];for(len=gam.target.length,t=1;t<len;t++)d=db.getGameTargetMarksScored(t),o=oppo.getGameTargetMarksScored(t),d<3&&o>=3?db_exposed.push({value:gam.target[t].value,label:gam.target[t].label}):d>=3&&o<3?oppo_exposed.push({value:gam.target[t].value,label:gam.target[t].label}):d<3&&o<3&&open_targets.push({value:gam.target[t].value,label:gam.target[t].label});if(db_is_ahead=(db_points=db.getCurrentScore())>=(oppo_points=oppo.getCurrentScore()),db_is_exposed=db_exposed.length>0,oppo_is_exposed=oppo_exposed.length>0,db_can_close=in_darts_left>=db_exposed.length,db_is_ahead&&db_is_exposed&&(db_can_close||db_points-oppo_points>=100))target=db_exposed[0];else if(!db_is_ahead&&oppo_is_exposed)target=oppo_exposed[0];else if(db_is_ahead&&oppo_is_exposed&&db_is_exposed&&!db_can_close)target=oppo_exposed[0];else if(open_targets.length>0)target=open_targets[0];else{if(!db_is_exposed)throw"Failed to acquire target";target=db_exposed[0]}var mTarget=target.value,mLabel=target.label;return 25===mTarget||"B"==mLabel?new Hit(0,RingType.DoubleBull):new Hit(Board.GetSectorIndex(mTarget),in_double_needed?RingType.Double:RingType.Treble)},hasEnoughToWinCricket:function(){var db,oppo,i,len,gam,ao,ar,pp;for(ao=(gam=APP.game).active_opponent,ar=gam.active_round,db=gam.opponent[ao],oppo=gam.opponent[0==ao?1:0],pp=0,len=gam.target.length,i=0;i<len;i++){if(null==db.closing_mark[i]&&db.getGameTargetMarksScored(i,!0)<3)return!1;pp+=db.turn[ar].target_points[i]}return db.getCurrentScore()+pp>=oppo.getCurrentScore()}},APP.header={edit_opponent:null,opponent_type:null,library_mode:null,teams:[],score_both:null,score_options:null,user_input:null,roster_left:null,roster_right:null,max_players:20,temp_select_list:{},lookup_players:[],roster_offset_ids:{},directory_type:null,league_guids:null,directory_edit_date:null,directory_backup_date:null,players_checked_in:null,current_letter:"A",home_index:0,Roster:function(){this.team={obj_id:null,is_default:null,players:[]},this.select_players=null,this.player_tracking=null,this.letter_mode=!1,this.reset=function(){this.team.obj_id=null,this.team.is_default=null,this.team.players.length=0,this.select_players=null},this.resetPlayers=function(){this.team.players.length=0},this.getTeamIndex=function(){var i,len,t;for(len=(t=APP.header.teams).length,i=1;i<len;i++)if(this.team.obj_id==t[i].obj_id)return i;return 0},this.getTeamName=function(){return APP.header.teams[this.getTeamIndex()].chalkboard_name},this.loadTeam=function(in_team){this.team.obj_id=in_team.obj_id,this.team.is_default=in_team.is_default||!1},this.loadPlayers=function(in_players){var i,len,p;for(len=(p=in_players).length,i=0;i<len;i++)"Pfiller"!=p[i].obj_id&&this.addPlayer(p[i])},this.addPlayer=function(in_player){var p;(p=this.team.players)[0]&&p[0].is_default&&p.splice(0,1),p.push({obj_id:in_player.obj_id,player_guid:in_player.player_guid,is_bot:in_player.is_bot||"Pdartbot"==in_player.obj_id,bot_level:in_player.bot_level||null,bot_skill:in_player.bot_skill||null,is_default:in_player.is_default||!1})},this.removePlayer=function(in_player_obj_id){var i,len,p;for(len=(p=this.team.players).length,i=0;i<len;i++)if(in_player_obj_id==p[i].obj_id)return void p.splice(i,1)},this.getPlayerCount=function(in_include_default){var p;return p=this.team.players,in_include_default?p.length:p.length>0?p[0].is_default?0:p.length:0},this.hasPlayers=function(in_include_default){return this.getPlayerCount(in_include_default)>0},this.hasBotPlayer=function(){var i,len;if(0==this.getPlayerCount())return!1;for(len=this.team.players.length,i=0;i<len;i++)if("Pdartbot"==this.team.players[i].obj_id)return!0;return!1}},init:function(){APP.header.score_both=!1,APP.header.user_input=[],APP.header.score_options={},APP.header.players_checked_in=BBAT.fetchData("players_checked_in"),APP.device.addFieldHandler(["hdr-name-0","hdr-score-0","hdr-handicap-0","hdr-name-1","hdr-score-1","hdr-handicap-1"],APP.header.handleEditRequest),APP.device.addButtonHandler(["bb-o-connect","oph-bb-library","bb-o-reload","bb-o-match-format","oph-bb-reset-left","oph-bb-continue","oph-bb-reset-right","oph-bb-sfb","oph-bb-forfeit"],APP.header.handleOpponentChange),APP.device.addButtonHandler(["pol-info","pol-close","pol-continue","pol-reset","pol-new","pol-edit","pol-delete","pol-backup","pol-restore"],APP.header.handleLibraryOption),APP.device.addButtonHandler(["ppd-close","ppd-info","ppd-update","ppd-add","ppd-finished","ppd-gmail","ppd-yahoo","ppd-hotmail","ppd-aol","ppd-msn","ppd-comcast","ppd-icloud","ppd-sbcglobal","ppd-verizon"],APP.header.handlePlayerDetailOption),APP.device.addButtonHandler(["ptd-close","ptd-ok","ptd-add","ptd-p-name-0","ptd-p-name-1","ptd-p-name-2","ptd-p-name-3","ptd-p-name-4","ptd-p-name-5","ptd-p-name-6","ptd-p-name-7","ptd-p-name-8","ptd-p-name-9","ptd-p-name-10","ptd-p-name-11"],APP.header.handleTeamDetailOption),APP.device.addButtonHandler(["pml-same-order","pmr-same-order","pmo-back"],APP.header.handlePlayerOrder),APP.device.addButtonHandler(["dsm-level-0","dsm-level-1","dsm-level-2","dsm-level-3","dsm-level-4","dsm-level-5","dsm-level-6","dsm-level-7","dsm-level-8","dsm-level-9","dsm-level-10","dsm-level-11","dsm-adaptive","dsm-quick-play","dsm-auto-alt-start","dsm-suppress-email","dsm-continue","dsm-close","dsm-info"],APP.header.handleDartBotSettings),APP.device.addButtonHandler(["op-button-left-add-player","op-right-Pdartbot"],APP.header.handleOpponentChange),APP.device.addButtonHandler(["pat-close","pat-info","pat-mark-temp","pat-remove","pat-add-left","pat-add-right","pat-add","pat-gmail","pat-yahoo","pat-hotmail","pat-aol","pat-msn","pat-comcast","pat-icloud","pat-sbcglobal","pat-verizon"],APP.header.handleAddPlayer),APP.device.addButtonHandler(["ppl-close","ppl-add","ppl-select-0","ppl-email-0","ppl-email-1","ppl-email-2","ppl-email-3","ppl-email-4","ppl-email-5","ppl-email-6","ppl-email-7","ppl-email-8","ppl-email-9","ppl-email-10","ppl-email-11","ppl-email-12","ppl-email-13","ppl-email-14","ppl-email-15","ppl-email-16","ppl-email-17","ppl-email-18","ppl-email-19","ppl-email-20","ppl-email-21","ppl-email-22","ppl-email-23","ppl-email-24","ppl-name-0","ppl-name-1","ppl-name-2","ppl-name-3","ppl-name-4","ppl-name-5","ppl-name-6","ppl-name-7","ppl-name-8","ppl-name-9","ppl-name-10","ppl-name-11","ppl-name-12","ppl-name-13","ppl-name-14","ppl-name-15","ppl-name-16","ppl-name-17","ppl-name-18","ppl-name-19","ppl-name-20","ppl-name-21","ppl-name-22","ppl-name-23","ppl-name-24"],APP.header.handlePlayerLookup),APP.device.addButtonHandler(["op-search-a","op-search-c","op-search-e","op-search-g","op-search-i","op-search-k","op-search-m","op-search-o","op-search-q","op-search-s","op-search-u","op-search-w","op-search-y","op-search-b","op-search-d","op-search-f","op-search-h","op-search-j","op-search-l","op-search-n","op-search-p","op-search-r","op-search-t","op-search-v","op-search-x","op-search-z"],APP.header.handleRosterScroll),APP.device.addButtonHandler(["pla-close"],APP.header.handleLabelAdder),APP.device.addButtonHandler(["pssm-info","pssm-close","pssm-continue","pssm-advanced","pmsm-advanced","pssm-advanced-tournament-type-button","pssm-elimination","pssm-round-robin","pssm-match-play","pssm-set-play","pssm-match-format","pmsm-per-match","pmsm-per-set","pmsm-per-leg","pmsm-same-legs","pmsm-select-legs","pmsm-point-per-leg","pmsm-point-per-set","pmsm-point-varies","pmsm-point-suppress","pssm-lpb-quarter","pssm-lpb-half","pssm-lpb-one","pssm-lpb-two","pssm-lpb-three","pssm-set-1","pssm-set-3","pssm-set-5","pssm-set-7","pssm-set-9","pssm-set-11","pssm-set-pa-1","pssm-set-pa-2","pssm-set-pa-3","pssm-set-pa-4","pssm-set-pa-5","pssm-set-pa-6","pssm-set-other"],APP.header.handleSetSetup),APP.device.addButtonHandler(["pmsm-alternate","pmsm-cork","pmsm-menu","pmsm-select","pmsm-random-start","pmsm-cork-first","pmsm-cork-last","pmsm-reset","pmsm-continue","pmsm-set-best-of","pmsm-set-play-all","pmsm-leg-best-of","pmsm-leg-play-all"],APP.header.handleSetSetup),APP.device.addButtonHandler(["pssm-mrb-t2","pssm-mrb-t4","pssm-mrb-t8","pssm-mrb-t16","pssm-mrb-t32"],APP.header.handleMoneyMenu),APP.device.addButtonHandler(["ple-close","ple-continue"],APP.header.handleLegsEditor),APP.device.addButtonHandler(["pbbs-reset","pbbs-continue","pbbs-practice","pbbs-close","pbbs-round-robin"],APP.header.handleBracketBoardSelector),APP.device.addButtonHandler(["sd-swap-opponents","sd-throw-order","sd-cancel"],APP.header.handleSwapDialog),APP.device.addButtonHandler(["pet-sm","pet-tm","pet-we","pet-y"],APP.header.handleTournamentEventType),APP.header.buildDartBotMenu(),APP.header.enableEditing()},buildDartBotMenu:function(){var i,len,level,levels;for(len=(levels=APP.dartbot.levels).length,i=0;i<len;i++)level=levels[i],$("#dsm-level-"+i+" > .dsm-ppr").html("ppr: "+level.ppr),$("#dsm-level-"+i+" > .dsm-level").html("Level "+level.label),$("#dsm-level-"+i+" > .dsm-mpr").html("mpr: "+level.mpr)},startDartBotSettings:function(){var p,p_list,len,i,level,levels,prev_skill;APP.user_options;for($(".dsm-level-group").removeClass("menu-option-on"),$("#dsm-adaptive").removeClass("menu-option-on"),len=(p_list=APP.header.roster_right.team.players).length,i=0;i<len;i++)if(p_list[i].is_bot){p=p_list[i];break}if($(".dsm-option").removeClass("menu-option-on"),APP.user_options.dartbot_adaptive_play&&$("#dsm-adaptive").addClass("menu-option-on"),APP.user_options.dartbot_auto_alt_start&&$("#dsm-auto-alt-start").addClass("menu-option-on"),APP.user_options.dartbot_quick_play&&$("#dsm-quick-play").addClass("menu-option-on"),APP.user_options.dartbot_suppress_email,APP.device.enableButton("dsm-close"),"d"==p.bot_level)APP.device.disableButton("dsm-close"),APP.device.disableButton("dsm-continue");else if("a"==p.bot_level)if($("#dsm-adaptive").addClass("menu-option-on"),levels=APP.dartbot.levels,p.bot_skill<=levels[0].skill)$("#dsm-level-0").addClass("menu-option-on");else if(p.bot_skill>=levels[11].skill)$("#dsm-level-11").addClass("menu-option-on");else for(prev_skill=levels[0].skill,i=1;i<11;i++){if(level=levels[i],prev_skill<=p.bot_skill&&p.bot_skill<level.skill){$("#dsm-level-"+(i-1)).addClass("menu-option-on");break}prev_skill=level.skill}else $("#dsm-level-"+p.bot_level).addClass("menu-option-on");void 0!==APP.user.recap_status_bot&&("E"==APP.user.recap_status_bot?($("#dsm-suppress-email").text("Recap Email: ON"),$("#dsm-suppress-email").addClass("menu-option-green-text")):($("#dsm-suppress-email").text("Recap Email: OFF"),$("#dsm-suppress-email").addClass("menu-option-red-text"))),APP.popup.show("dartbot-settings-menu")},handleDartBotSettings:function(in_id){var bot_level,p,p_list,len,i,el;switch(in_id){case"dsm-info":APP.info.show("info-text-compete-DC","Competing Against DartConnect");break;case"dsm-close":APP.popup.hide(),APP.header.handleOpponentChange("op-right-Pdartbot");break;case"dsm-adaptive":$("#dsm-adaptive").toggleClass("menu-option-on");break;case"dsm-quick-play":$("#dsm-quick-play").toggleClass("menu-option-on");break;case"dsm-auto-alt-start":$("#dsm-auto-alt-start").toggleClass("menu-option-on");break;case"dsm-suppress-email":APP.alert.show("Manage your match report preferences in the <strong>Notifications</strong> section of the <strong>My DartConnect Member Site</strong>");break;case"dsm-continue":if(APP.user_options.dartbot_adaptive_play=$("#dsm-adaptive").hasClass("menu-option-on"),APP.user_options.dartbot_auto_alt_start=$("#dsm-auto-alt-start").hasClass("menu-option-on"),APP.user_options.dartbot_suppress_email=$("#dsm-suppress-email").hasClass("menu-option-on"),APP.user_options.dartbot_quick_play=$("#dsm-quick-play").hasClass("menu-option-on"),APP.storeUserOptions(),el=$(".dsm-level-group").filter(".menu-option-on")[0]){for(len=(p_list=APP.header.roster_right.team.players).length,i=0;i<len;i++)if(p_list[i].is_bot){p=p_list[i];break}p.bot_level=APP.extractLastNumberSegment(el.id),p.bot_skill=APP.dartbot.levels[p.bot_level].skill,$("#dsm-adaptive").hasClass("menu-option-on")&&(p.bot_level="a");var botTitle="vs DartConnect "+APP.dartbot.getName(p.bot_skill).substr(3);APP.dartbot.isScripted&&(botTitle=APP.dartbot.getExactBotLevel(!0)),$("#op-right-Pdartbot").html(botTitle),APP.popup.hide()}else APP.popup.hide(),APP.header.handleOpponentChange("op-right-Pdartbot");break;default:APP.device.enableButton("dsm-continue"),$(".dsm-level-group").removeClass("menu-option-on"),bot_level=APP.extractLastNumberSegment(in_id),$("#dsm-level-"+bot_level).addClass("menu-option-on")}},swapOpponents:function(){APP.header.hidePlayerOrderMenu(0),APP.header.hidePlayerOrderMenu(1),APP.game.swapOpponents(),APP.header.refresh();var multi_0=$("#hdr-name-1").hasClass("hdr-multi-player"),multi_1=$("#hdr-name-0").hasClass("hdr-multi-player");$(".hdr-multi-player").removeClass("hdr-multi-player"),multi_0&&($("#hdr-name-0").addClass("hdr-multi-player"),APP.header.enablePlayerOrderProcessing(0)),multi_1&&($("#hdr-name-1").addClass("hdr-multi-player"),APP.header.enablePlayerOrderProcessing(1)),!APP.is_reloading&&APP.device.has_chalk&&APP.storeGameEvent({cmd:"SWAP_OPPONENTS",cmd_data:{}})},handleSwapDialog:function(in_id){function finish(){APP.header.swap_index=null,$("#swap-dialog").hide(0),$("#swap-dialog-overlay").hide(0)}switch(in_id){case"sd-swap-opponents":APP.header.swapOpponents(),finish();break;case"sd-throw-order":APP.header.togglePlayerOrderMenu(APP.header.swap_index),finish();break;case"sd-cancel":finish()}},swap_index:null,showSwapDialog:function(in_opponent_index){APP.header.swap_index=in_opponent_index,$("#swap-dialog-overlay").show(0),$("#swap-dialog").show(0)},handleEditRequest:function(in_id){var o=APP.extractLastNumberSegment(in_id);$("#"+in_id).hasClass("header-handicap")?"IN-GAME"==APP.mode&&"function"==typeof APP.game.plugin.editScore&&APP.game.plugin.editScore(o):$("#"+in_id).hasClass("header-score")?"IN-GAME"==APP.mode?"function"==typeof APP.game.plugin.easterEgg&&APP.game.plugin.easterEgg(o):(APP.header.edit_opponent=o,APP.header.startScoreEdit()):APP.game.started&&APP.device.has_chalk?$("#"+in_id).hasClass("hdr-multi-player")&&(APP.header.hidePlayerOrderMenu(0),APP.header.hidePlayerOrderMenu(1),APP.header.togglePlayerOrderMenu(o)):APP.game.opponent[o].team.players[0]&&APP.game.opponent[o].team.players[0].is_bot?APP.header.startOpponentChange():"TEAM"==APP.header.opponent_type?APP.header.startOpponentChange(!0):APP.header.showLabelAdder(o)},label_adder_index:null,handleLabelAdder:function(in_id){var oi=APP.header.label_adder_index,label=$("#pla-input").val().trim(),tourney="TOURNAMENT"==APP.session.getMatchMode();if(!in_id&&label&&!function(in_label){var i,pl=APP.header.teams[0].players,len=pl.length;for(i=0;i<len;i++){var p=pl[i];if(p.is_temp_player&&!p.email&&(p.first_name+p.last_name).toLowerCase()==(in_label+"*").toLowerCase())return!0}return!1}(label)){var p={first_name:tourney?"*":label,last_name:tourney?label:"*",chalkboard_name:label,email:"",in_pool:!0,is_temp_player:!0};p.obj_id=APP.header.teams[0].addPlayer(p),APP.header.teams[0].sort(),APP.header.storeDirectory();var t=new APP.game.Team(APP.header.teams[0]);t.addPlayer(p),t.sort(),APP.game.opponent[oi].setTeam(t,"PLAYER"),APP.game.opponent[oi].player_order.length=0,APP.session.addSet()}APP.header.hideLabelAdder()},showLabelAdder:function(in_oppo_index){APP.header.label_adder_index=in_oppo_index,APP.device.pauseKeyboardHandler(),$("#pla-input").on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.header.handleLabelAdder(),!1):27==e.which?(BBAT.killDOMEvent(e),APP.header.hideLabelAdder(),!1):void 0})),0==in_oppo_index?$("#popup-label-adder").css("left","0").css("right",""):$("#popup-label-adder").css("right","0").css("left",""),APP.popup.show("popup-notice",'Use "Select Players" to add connections to your Player Library and receive a match recap.'),$("#popup-label-adder-overlay").show(0),$("#popup-label-adder").show(0),$("#pla-input").val("").focus()},hideLabelAdder:function(){APP.header.label_adder_index=null,$("#pla-input").val("").blur(),$("#popup-label-adder").hide(0),$("#popup-label-adder-overlay").hide(0),APP.popup.hide("popup-notice"),APP.device.resumeKeyboardHandler()},createPlayerOrderButtons:function(qty,in_opponent){for(var leftBtnsContent="",rightBtnsContent="",leftBtnArr=[],rightBtnArr=[],i=0;i<qty;i++)in_opponent?(rightBtnsContent+=`\n\t\t\t\t\t<div id='pmr-button-${i}' class='pmr-button button button-menu button-gold round-corners'>\n\t\t\t\t\t\t<div id='pmr-name-${i}' class='pmr-name'></div>\n\t\t\t\t\t\t<div id='pmr-overlay-${i}' class='pmx-overlay'></div>\n\t\t\t\t\t\t<div id='pmr-number-${i}' class='pmr-number'></div>\n\t\t\t\t\t</div>\n\t\t\t\t`,rightBtnArr.push("pmr-button-"+i)):(leftBtnsContent+=`\n\t\t\t\t\t<div id='pml-button-${i}' class='pml-button button button-menu button-gold round-corners'>\n\t\t\t\t\t\t<div id='pml-name-${i}' class='pml-name'></div>\n\t\t\t\t\t\t<div id='pml-overlay-${i}' class='pmx-overlay'></div>\n\t\t\t\t\t\t<div id='pml-number-${i}' class='pml-number'></div>\n\t\t\t\t\t</div>\n\t\t\t\t`,leftBtnArr.push("pml-button-"+i));in_opponent?($("#players-menu-right .pmr-buttons").html(rightBtnsContent),APP.fns.activateBtn(rightBtnArr,APP.header.handlePlayerOrder)):($("#players-menu-left .pml-buttons").html(leftBtnsContent),APP.fns.activateBtn(leftBtnArr,APP.header.handlePlayerOrder))},enablePlayerOrderProcessing:function(in_opponent,in_show_player_order){var oppo,pc,i;if(oppo=APP.game.opponent[in_opponent],APP.device.has_chalk?APP.header.enablePlayerOrderMenu(in_opponent):APP.header.disablePlayerOrderMenu(in_opponent),oppo.player_tracking){if($("#hdr-name-"+in_opponent).removeClass("hdr-multi-player"),1==(pc=oppo.team.getPlayerCount(!0)))return oppo.player_order.length=0,void oppo.player_order.push(0);if(pc-oppo.team.getBotPlayerCount()==1)return oppo.player_order.length=0,oppo.player_order.push(1),void oppo.player_order.push(0);if(pc-oppo.team.getFillerPlayerCount()==1){if(oppo.player_order.length=0,oppo.player_order<pc)for(i=0;i<pc;i++)oppo.player_order.push(i);return}if(APP.nlf.playerRails.isSetTeamOrder()){var autoSetPlayerOrder=!1;if(0==in_opponent?APP.nlf.playerRails.isSetTeamOrder("home")&&(autoSetPlayerOrder=!0):APP.nlf.playerRails.isSetTeamOrder("away")&&(autoSetPlayerOrder=!0),APP.session.isFirstLeg()||APP.header.checkMaintainThrowOrder(in_opponent)||(autoSetPlayerOrder=!1),autoSetPlayerOrder)for(oppo.player_order.length=0,i=0;i<pc;i++)oppo.player_order.push(i)}if(APP.session.bracketFunctions.isSetTeamOrder())for(oppo.player_order.length=0,i=0;i<pc;i++)oppo.player_order.push(i);if($("#hdr-name-"+in_opponent).addClass("hdr-multi-player"),APP.device.has_chalk&&in_show_player_order?(APP.header.createPlayerOrderButtons(pc,in_opponent),$(".players-menu-hint").show(0)):$(".players-menu-hint").hide(0),0==oppo.player_order.length&&in_show_player_order&&(APP.header.checkMaintainThrowOrder(in_opponent)?APP.header.injectThrowOrder(in_opponent):APP.header.showPlayerOrderMenu(in_opponent)),APP.device.is_hosting){var prevPlayerLength;try{prevPlayerLength=APP.session.getPrevGamePlayerOrder(0).length}catch(e){}prevPlayerLength&&pc!==APP.session.getPrevGamePlayerOrder(0).length&&$(".pmx-same-order").hide()}}},checkMaintainThrowOrder:function(in_opponent){try{if((APP.session.isBracketMatch()||APP.nlf.data.rails)&&"Y"==APP.getMatch().format.maintain_team_throw_order){var sess=APP.session;if(null==sess.current_match||null==sess.current_set)return!1;var oppo=APP.game.opponent[in_opponent],prevPlayerOrder=APP.session.getPrevGamePlayerOrder(in_opponent);return!!prevPlayerOrder&&prevPlayerOrder.length==oppo.team.getPlayerCount()}}catch(e){}return!1},injectThrowOrder:function(in_opponent){"number"==typeof in_opponent&&(in_opponent?APP.header.handlePlayerOrder("pmr-same-order"):APP.header.handlePlayerOrder("pml-same-order"))},disablePlayerOrderProcessing:function(){APP.header.hidePlayerOrderMenu(0),APP.header.disablePlayerOrderMenu(0),APP.header.hidePlayerOrderMenu(1),APP.header.disablePlayerOrderMenu(1)},showPlayerOrderMenu:function(in_index){var i,j,p,o,bc,p_len,o_len,prefix,menu;if(!APP.game.started_scoring||in_index==APP.game.current_opponent){for(prefix in APP.session.isNewSet()?($(".players-menu-hint").show(0),$(".pmx-same-order").hide(0)):($(".players-menu-hint").hide(0),$(".pmx-same-order").show(0)),"SERVER"==APP.game_master&&$(".pmx-same-order").hide(0),0==in_index?{pml:null}:1==in_index?{pmr:null}:{pml:null,pmr:null})if("pml"==prefix?(o=APP.game.opponent[0],menu=$("#players-menu-left")):(o=APP.game.opponent[1],menu=$("#players-menu-right")),o.player_order.length=0,bc=o.team.getBotPlayerCount(),p_len=o.team.getPlayerCount()-o.team.getFillerPlayerCount(),o_len=o.player_order.length,$("."+prefix+"-button").hide(0),$("."+prefix+"-name").text(""),$(".pmx-overlay").hide(0),$("."+prefix+"-number").hide(0).text(""),p_len>1){for(i=bc;i<p_len;i++)for(p=o.team.players[i],$("#"+prefix+"-name-"+i).text(p.first_name+" "+p.last_name),$("#"+prefix+"-button-"+i).show(0),j=0;j<o_len;j++)o.player_order[j]==i&&($("#"+prefix+"-number-"+i).text(j+1).show(0),$("#"+prefix+"-overlay-"+i).show(0));in_index==APP.game.active_opponent&&($("#players-menu-overlay").show(0),APP.game.hasUserStartedScoring()?$("#pmo-back").hide(0):$("#pmo-back").show(0)),menu.show(0)}var hasError=!1;try{APP.game.opponent[0].getPlayers().length!==APP.session.getPrevGamePlayerOrder(0).length&&(hasError=!0),APP.game.opponent[1].getPlayers().length!==APP.session.getPrevGamePlayerOrder(1).length&&(hasError=!0)}catch(e){}hasError&&$(".pmx-same-order").hide(0)}},togglePlayerOrderMenu:function(in_index){var oppo;oppo=APP.game.opponent[in_index],"none"==(0==in_index?$("#players-menu-left"):$("#players-menu-right")).css("display")?APP.header.showPlayerOrderMenu(in_index):oppo.player_order.length==oppo.team.getPlayerCount()&&APP.header.hidePlayerOrderMenu(in_index)},handlePlayerOrder:function(in_id){var i,j,already_placed,pi,po,o_len,o,oi,prefix,pc,bc,rpc;function finish(){APP.header.hidePlayerOrderMenu(oi),APP.header.refresh(),APP.storeGameEvent({cmd:"SET_PLAYER_ORDER",cmd_data:{opponent:oi,player_order:po}}),APP.storeState();try{APP.device.is_broadcasting&&APP.server.postBroadcast({notable:""})}catch(e){}}if("pmo-back"==in_id)return $("#players-menu-overlay").hide(0),$("#pmo-back").hide(0),void setTimeout((function(){APP.game.plugin.handleUserInput("mb-ig-funcl")}),5);if(in_id.indexOf("pml")>=0?(oi=0,prefix="pml",$("#players-menu-left")):(oi=1,prefix="pmr",$("#players-menu-right")),o=APP.game.opponent[oi],o_len=(po=o.player_order).length,in_id.indexOf("same-order")>=0){var prev_order=APP.session.getPrevGamePlayerOrder(oi),prev_order_len=prev_order.length;for(po.length=0,i=0;i<prev_order_len;i++)po.push(prev_order[i]);finish()}else{for(rpc=(pc=o.team.getPlayerCount())-o.team.getFillerPlayerCount()-(bc=o.team.getBotPlayerCount()),pi=APP.extractLastNumberSegment(in_id),i=0;i<o_len;i++)if(pi==po[i])return po.length=0,$("."+prefix+"-number").text("").hide(0),void $(".pmx-overlay").hide(0);if(po.push(pi),o_len=po.length,$("#"+prefix+"-number-"+pi).text(o_len).show(0),$("#"+prefix+"-overlay-"+pi).show(0),o_len==rpc-1){for(i=bc;i<pc;i++){for(already_placed=!1,j=0;j<o_len;j++)if(i==po[j]){already_placed=!0;break}already_placed||po.push(i)}1==bc&&po.push(0),finish()}}},hidePlayerOrderMenu:function(in_index){var oppo_0=APP.game.opponent[0],oppo_1=APP.game.opponent[1],ao=APP.game.active_opponent;0==in_index?$("#players-menu-left").hide(0):$("#players-menu-right").hide(0),(APP.game.hasUserStartedScoring()||0==ao&&oppo_0.player_order.length==oppo_0.team.getPlayerCount()||1==ao&&oppo_1.player_order.length==oppo_1.team.getPlayerCount())&&($("#players-menu-overlay").hide(0),$("#pmo-back").hide(0))},packageTeamPool:function(){var i,t_len,hdr=APP.header,obj=[];if("HOST"!=APP.device.role)return BBAT.fetchData("remote_teams");function addTeam(in_team_index){var i,p_len,t,p,team,player;if(hdr.teams[in_team_index]){for(team=hdr.teams[in_team_index],(t={}).obj_id=team.obj_id,t.team_name=team.team_name,t.chalkboard_name=team.chalkboard_name,t.is_default=team.is_default,t.players=[],p_len=team&&team.players&&team.players.length?team.players.length:0,i=0;i<p_len;i++)(player=team.players[i]).in_pool&&(p={},$.extend(p,player),t.players.push(p));obj.push(t)}}if("PLAYER"==hdr.opponent_type)addTeam(0);else for(obj.push({}),t_len=hdr.teams.length,i=0;i<t_len;i++)hdr.teams[i].in_pool&&addTeam(i);return obj},loadTeamPool:function(in_arr){var hdr=APP.header;hdr.teams=in_arr,BBAT.storeData({remote_teams:hdr.teams})},confirmSwitchToGameMode:function(in_continue_callback){APP.session.switchToGameMode(),APP.storeUserOptions(),in_continue_callback()},startOpponentChange:function(in_new_players,no_animate){APP.session.getMatchFormat();function removeFillerPlayers(in_opponent){var p;if(0!=(p=APP.game.opponent[in_opponent].team.players).length)for(;"Pfiller"==p[p.length-1].obj_id;)p.pop()}if("MATCH"!=APP.session.getMatchMode()||APP.session.isNewMatch()){APP.game.setShootForBull(!1),APP.session.hideBullShoot(),APP.game_selector.refreshGamePanel(),APP.header.disableEditing(!0),APP.header.fetchDirectory(),removeFillerPlayers(0),removeFillerPlayers(1);var prev_game_winner="GAME"==APP.session.getMatchMode()?APP.session.getPrevGameWinningOpponent():null;APP.header.roster_left=new APP.header.Roster,APP.header.roster_left.loadTeam(APP.game.opponent[0].getTeam()),APP.header.roster_left.loadPlayers(APP.game.opponent[0].getPlayers()),in_new_players&&0!=prev_game_winner&&APP.header.roster_left.resetPlayers(),APP.header.roster_left.select_players="PLAYER"==APP.header.opponent_type||APP.header.roster_left.hasPlayers(),APP.header.roster_left.player_tracking=APP.game.opponent[0].player_tracking,APP.header.roster_right=new APP.header.Roster,APP.header.roster_right.loadTeam(APP.game.opponent[1].getTeam()),APP.header.roster_right.loadPlayers(APP.game.opponent[1].getPlayers()),in_new_players&&1!=prev_game_winner&&APP.header.roster_right.resetPlayers(),APP.header.roster_right.select_players="PLAYER"==APP.header.opponent_type||APP.header.roster_right.hasPlayers(),APP.header.roster_right.player_tracking=APP.game.opponent[1].player_tracking,"HOST"!=APP.device.role&&(APP.device.disableButton("oph-bb-library"),APP.device.disableButton("bb-o-connect")),APP.device.disableButton("bb-o-reload"),APP.session.allowReloadPriorLeg()&&APP.device.enableButton("bb-o-reload",!0),APP.device.showSpinnerOverlay();try{if(APP.nlf.rails.data.league&&"LEAGUE"==APP.header.directory_type&&"TEAM"==APP.header.opponent_type&&APP.header.teams.length<=1){APP.recordError("Missing teams in league directory");APP.alert.show("There was an error loading the teams. Please log back in and try again.",(function(){APP.device.hideSpinnerOverlay(),APP.logoutManager.init(!0)}))}}catch(e){}if(APP.reveal.showButtonBar("button-bar-opponents","","",!0),$("#header").hide(0),$("#opponents-panel").css("height",$("#chalkboard").outerHeight(!0)-$("#reveal-bar").outerHeight(!0)-$("#button-bar").outerHeight(!0)-$("#message-bar").outerHeight(!0)),APP.reveal.showPanel("opponents-panel",(function(){APP.session.isLeaguePlay()?$("#opponents-panel-list").css("height",$("#opponents-panel").outerHeight(!0)-$("#op-header").outerHeight(!0)-parseFloat($("#opponents-panel-list").css("margin-bottom"))).scrollTop(0):$("#opponents-panel-list").css("height",$("#opponents-panel").outerHeight(!0)-$("#op-header").outerHeight(!0)-$("#opponents-panel-special-options").outerHeight(!0)-parseFloat($("#opponents-panel-list").css("margin-bottom"))).scrollTop(0),APP.header.rebuildOpponentsPanel(),APP.device.hideSpinnerOverlay()}),!0),"TOURNAMENT"==APP.session.getMatchMode()){$("#oph-bb-library").html("Add Player");APP.session.getMatchFormat();APP.device.disableButton("oph-bb-library")}APP.session.isLeaguePlay()?APP.device.enableButton("oph-bb-forfeit",!0):APP.device.disableButton("oph-bb-forfeit"),APP.session.isLeaguePlay()?$("#opponents-panel-special-options").hide(0):$("#opponents-panel-special-options").show(0),APP.session.lockMatchFormat()&&APP.device.disableButton("bb-o-match-format"),APP.reveal.setBackButton("CANCEL"),APP.session.currentLeagueIsGroup()&&($("#oph-bb-forfeit").addClass("button-disabled"),$("#oph-bb-library").addClass("button-disabled")),APP.session.isLeaguePlay()&&APP.nlf.autoSelectPlayers(),APP.nlf.data.rails&&APP.nlf.rails.injections.selectPlayers();try{APP.nlf.data.rails&&$("#oph-bb-sfb").text("Start Game")}catch(e){}}else APP.header.confirmSwitchToGameMode(APP.header.startOpponentChange)},storeDirectory:function(){var obj,d,ld=APP.header.league_definition;switch(APP.header.directory_type){case"TOURNAMENT":var smallTeams=JSON.parse(JSON.stringify(APP.header.teams));d={teams:smallTeams=APP.header.deflateTournamentDirectory(smallTeams)},BBAT.storeData({directory_tournament:d});break;case"LEAGUE":d={teams:APP.header.teams,league_guid:ld.league_guid,league_division_guid:ld.league_division_guid,season_status:ld.season_status,edit_date:APP.header.directory_edit_date},(obj={})["directory_division_"+ld.league_division_guid+"_"+ld.season_status]=d,BBAT.storeData(obj);break;case"USER":d={teams:APP.header.teams,edit_date:APP.header.directory_edit_date,backup_date:APP.header.directory_backup_date},BBAT.storeData({directory_user:d})}},fetchDirectory:function(){var d,tl,i,len,mm=APP.session.getMatchMode(),ld=APP.session.getLeagueDefinition(APP.session.getMatchLeagueKey())||{};if(APP.header.resetDirectory(),"PARTICIPANT"==APP.device.role)tl=BBAT.fetchData("remote_teams")||[APP.game.players_team],ld.league_division_guid?($("#oph-bb-library").html("Manage League Rosters"),$("#pol-title").html("League Rosters")):"TEAM"==APP.header.opponent_type?$("#oph-bb-library").html("Manage Team Library"):$("#oph-bb-library").html("Manage Player Library"),APP.device.disableButton("oph-bb-library");else{if(APP.session.isLeaguePlay()&&ld.league_division_guid&&ld.season_status)return $("#oph-bb-library").html("Manage League Rosters"),$("#pol-title").html("League Rosters"),void((d=BBAT.fetchData("directory_division_"+ld.league_division_guid+"_"+ld.season_status))&&APP.header.loadLeagueDivisionDirectory(d));"TOURNAMENT"==mm?((d=BBAT.fetchData("directory_tournament"))&&d.teams&&(d.teams=APP.header.inflateTournamentDirectory(d.teams)),APP.header.directory_type="TOURNAMENT",APP.header.league_definition=null):((d=BBAT.fetchData("directory_user"))||((d={}).edit_date=BBAT.fetchData("library_edit_date"),d.backup_date=BBAT.fetchData("library_backup_date"),d.teams=BBAT.fetchData("teams"),d.teams&&BBAT.storeData({directory_user:d}),BBAT.flushData("teams","library_edit_date","library_backup_date")),APP.header.directory_type="USER",APP.header.league_definition=null,APP.header.directory_edit_date=d.edit_date,APP.header.directory_backup_date=d.backup_date),(tl=d?d.teams:null)||(tl=[APP.game.players_team],APP.header.directory_edit_date=null,APP.header.directory_backup_date=new Date),"TEAM"==APP.header.opponent_type?($("#oph-bb-library").html("Manage Team Library"),$("#pol-title").html("Team Library")):($("#oph-bb-library").html("Manage Player Library"),$("#pol-title").html("Player Library"))}for(APP.header.teams=[],len=tl.length,i=0;i<len;i++)APP.header.teams.push(APP.game.cloneTeam(tl[i]))},deflateTournamentDirectory:function(d){try{for(var playerList=d[0].players,deflatedPlayers=[],i=0;i<playerList.length;i++){var player=playerList[i],smallPlayer={id:player.obj_id,em:player.email,gu:player.player_guid,fn:player.first_name,ln:player.last_name,cn:player.chalkboard_name,nn:player.nickname,ml:player.member_level,mi:player.member_id,df:player.is_default,pl:player.in_pool,bt:player.is_bot,bs:player.bot_skill,bl:player.bot_level,di:player.has_doubled_in,da:player.do_attempts,tp:player.is_temp_player,i2:player.iso2_country,i3:player.iso3_country,co:player.country_name,wr:player.wdf_rank};deflatedPlayers.push(smallPlayer)}d[0].players=deflatedPlayers}catch(e){}return d},inflateTournamentDirectory:function(d){try{for(var playerList=d[0].players,inflatedPlayers=[],i=0;i<playerList.length;i++){var player=playerList[i],bigPlayer={obj_id:player.id,email:player.em,player_guid:player.gu,first_name:player.fn,last_name:player.ln,chalkboard_name:player.cn,nickname:player.nn,member_level:player.ml,member_id:player.mi,is_default:player.df,in_pool:player.pl,is_bot:player.bt,bot_skill:player.bs,bot_level:player.bl,has_doubled_in:player.di,do_attempts:player.da,is_temp_player:player.tp,iso2_country:player.i2,iso3_country:player.i3,country_name:player.co,wdf_rank:player.wr};inflatedPlayers.push(bigPlayer)}d[0].players=inflatedPlayers}catch(e){}return d},resetDirectory:function(){APP.header.teams&&(APP.header.teams.length=0),APP.header.directory_type&&(APP.header.directory_type=null),APP.header.directory_edit_date&&(APP.header.directory_edit_date=null),APP.header.directory_backup_date&&(APP.header.directory_backup_date=null)},isDartBotAvailable:function(){var o;if("HOST"!=APP.device.role)return!1;if(APP.device.is_hosting)return!1;if("Library"==APP.game.name)return!1;if("Cricket"==APP.game.name){if("MARK UP"==(o=APP.game.options).variation||"STRAIGHT"==o.variation||"EXTENDED"==o.variation||"TACTICS NL"==o.variation)return!1;if(o.drop_10||o.no_bull)return!1}return 1!=APP.game.opponent_count&&!APP.session.isLeaguePlay()},goto_bottom:!1,prev_search_letter:null,handleRosterScroll:function(in_id){var din=APP.extractLastSegment(in_id).toUpperCase(),roi=APP.header.roster_offset_ids,top=null;if(APP.header.roster_left.letter_mode)return APP.header.rebuildOpponentsPanel(din),void $("#opponents-panel-list").scrollTop(0);switch(din){case"A":top=0;break;case"Z":top=9999999;break;default:top=roi[din]?$("#"+roi[din]).position().top:null}null!=top&&$("#opponents-panel-list").scrollTop(top)},rebuildOpponentsPanel:function(in_letter){var cls,dn,dni,i,id,id_button,id_edit,l,left_1,len,player_in_range,roster,side,start_i,no_player_error,in_obj,count=0,mm=APP.session.getMatchMode(),other_class=(new Date,""),prev_letter=null,roi=APP.header.roster_offset_ids;for(side in APP.device.is_hosting?$("#op-right-Pdartbot").hide(0):$("#op-right-Pdartbot").show(0),roi.A=null,roi.B=null,roi.C=null,roi.D=null,roi.E=null,roi.F=null,roi.G=null,roi.H=null,roi.I=null,roi.J=null,roi.K=null,roi.L=null,roi.M=null,roi.N=null,roi.O=null,roi.P=null,roi.Q=null,roi.R=null,roi.S=null,roi.T=null,roi.U=null,roi.V=null,roi.W=null,roi.X=null,roi.Y=null,roi.Z=null,document.getElementById("op-left-col").innerText="",document.getElementById("op-right-col").innerText="",$(".op-search .text-whitesmoke").removeClass("text-whitesmoke"),$(".op-search .text-gold").removeClass("text-gold"),{left:"",right:""}){var frag=document.createDocumentFragment();"left"==side?(roster=APP.header.roster_left,"right"):(roster=APP.header.roster_right,"left");try{roster.select_players?(l=APP.header.teams[roster.getTeamIndex()].players,start_i=0):(l=APP.header.teams,start_i=1)}catch(e){no_player_error=!0}function SortByName(a,b){if(a.last_name&&b.last_name){var aName=a.last_name.toLowerCase(),bName=b.last_name.toLowerCase();return aName<bName?-1:aName>bName?1:0}}if(len=l?l.length:0,"TOURNAMENT"==mm||"SINGLES"==mm)try{l.sort(SortByName)}catch(e){}if(APP.nlf.rails.checkWdfRules()){function SortByRank(a,b){if(a.wdf_rank&&b.wdf_rank)return a.wdf_rank<b.wdf_rank?-1:a.wdf_rank>b.wdf_rank?1:0}roster.select_players&&l.sort(SortByRank)}for(roster.letter_mode=len>50&&"TOURNAMENT"==mm,roster.letter_mode&&(in_letter&&(APP.header.current_letter=in_letter),$("#op-search-"+APP.header.current_letter.toLowerCase()).addClass("text-gold")),other_class="",prev_letter="",i=start_i;i<len;i++){var who=l[i];if(!who.is_bot&&who.in_pool&&(left_1="TOURNAMENT"==mm&&who.last_name?who.last_name.left(1).toUpperCase():who.first_name||who.last_name?who.first_name.left(1).toUpperCase():"",0==/[0-9]|[A-Z]/.test(left_1)&&(left_1="A"),roster.letter_mode&&left_1!=APP.header.current_letter&&$("#op-search-"+left_1.toLowerCase()).addClass("text-whitesmoke"),player_in_range=!roster.letter_mode||"A"==APP.header.current_letter&&left_1<=APP.header.current_letter||"A"!=APP.header.current_letter&&left_1==APP.header.current_letter)){if(id="op-"+side+"-"+who.obj_id,id_button="op-button-"+side+"-"+who.obj_id,id_edit="op-edit-"+side+"-"+who.obj_id,cls="op-option-"+who.obj_id,other_class="T"==who.obj_id.left(1)?"op-other-color":"",who.email)var email_src="images/icon_envelope.png";else email_src="images/icon_info.png";if(in_obj=who,(dn=roster.select_players?"Pfiller"==in_obj.obj_id?"":in_obj.is_bot?"DartConnect":"TOURNAMENT"==mm||"SINGLES"==mm?in_obj.last_name+", "+in_obj.first_name:APP.nlf.rails.checkWdfRules()&&in_obj.wdf_rank?in_obj.wdf_rank+" | "+in_obj.first_name+" "+in_obj.last_name:in_obj.first_name+" "+in_obj.last_name:in_obj.team_name).left(1).toUpperCase()!=prev_letter&&(prev_letter=dn.left(1).toUpperCase()),!roster.letter_mode||player_in_range){var li=document.createElement("li");if(li.className="op-option opponent-group round-corners op-"+side+" "+other_class+" "+cls,li.id=id,"I"==l[i].player_postseason_status){var cLeague=APP.session.getCurrentLeague();cLeague&&"POST"==cLeague.season_status&&(li.className+=" ineligible")}var di=document.createElement("div");di.className="button op-option-div",di.id=id_button,di.innerText=dn,li.appendChild(di);var ii=document.createElement("img");ii.className="button op-option-img",ii.id=id_edit,ii.src=email_src,li.appendChild(ii),frag.appendChild(li),APP.device.addButtonHandler([id_button,id_edit],APP.header.handleOpponentChange)}if("left"==side){var filled=!1;count++,dni=dn.left(1).toUpperCase(),roi.A=roi.A||id,roi[dni]=roi[dni]||id}else filled||(filled=!0,roi.B=roi.B||roi.A,roi.C=roi.C||roi.B,roi.D=roi.D||roi.C,roi.E=roi.E||roi.D,roi.F=roi.F||roi.E,roi.G=roi.G||roi.F,roi.H=roi.H||roi.G,roi.I=roi.I||roi.H,roi.J=roi.J||roi.I,roi.K=roi.K||roi.J,roi.L=roi.L||roi.K,roi.M=roi.M||roi.L,roi.N=roi.N||roi.M,roi.O=roi.O||roi.N,roi.P=roi.P||roi.O,roi.Q=roi.Q||roi.P,roi.R=roi.R||roi.Q,roi.S=roi.S||roi.R,roi.T=roi.T||roi.S,roi.U=roi.U||roi.T,roi.V=roi.V||roi.U,roi.W=roi.W||roi.V,roi.X=roi.X||roi.W,roi.Y=roi.Y||roi.X)}}document.getElementById("op-"+side+"-col").appendChild(frag),APP.device.setButtonEvents("#op-"+side+"-col .button")}APP.header.roster_left.letter_mode||"TOURNAMENT"==mm?$("#op-search-count").html('<span class="text-whitesmoke">'+(len-1)+'</span><br /><span class="text-gold">'+count+"</span>"):$("#op-search-count").html("&nbsp;"),APP.header.refreshOpponentsPanel(),"PARTICIPANT"==APP.device.role&&APP.device.disableButton("bb-o-match-format"),no_player_error&&(APP.alert.show("There was an error getting your Player Library, please exit the application and try again or contact your league admin."),APP.device.disableButton("oph-bb-library"))},refreshOpponentsPanel:function(){var i,l,len,msg,other_roster,other_side,r,roster,side,start_i,ld=APP.header.league_definition;function teamHasPlayers(in_team){var i,len,t;for(len=(t=APP.header.teams).length,i=0;i<len;i++)if(t[i].obj_id==in_team.obj_id)return t[i].getPlayerCount()>0;return!1}function isSelected(in_obj_id,in_list){var i,len;for(len=in_list.length,i=0;i<len;i++)if(in_obj_id==in_list[i].obj_id)return!0;return!1}if($(".op-option-bot").removeClass("op-option-bot"),$(".op-option-on").removeClass("op-option-on"),APP.device.enableButtonSelector(".op-option > div"),"TOURNAMENT"==APP.session.getMatchMode()?($("#op-button-left-add-player").html("Update Roster").addClass("button-red"),APP.device.enableButton("op-right-Pdartbot")):APP.header.isDartBotAvailable()?(APP.device.enableButton("op-right-Pdartbot"),$("#op-right-Pdartbot").show(0)):APP.device.disableButton("op-right-Pdartbot"),APP.header.roster_left.letter_mode||0!=$("#op-left-col li").length||0!=$("#op-right-col li").length){$(".op-search").css("display","inline-block");var ocl=parseInt($("#op-col-left").css("height")),ocr=parseInt($("#op-right-col").css("height")),opl=parseInt($("#opponents-panel-list").css("height"));$("#op-col-middle").css("height",Math.max(ocl,opl,ocr)-3+"px"),$("#opponents-panel-hint").css("display","none")}else $(".op-search").css("display","none"),$("#op-col-middle").css("height",0),$("#opponents-panel-hint").css("display","block"),ld?$("#opponents-panel-hint").addClass("text-gold").html('<span style="font-size:1.5em;line-height:1.5em;">Welcome to<br />Season Pass!</span><p style="padding:0.5em;">Remember to add emails to players who are missing an envelope so they will receive a Match recap - Tap the Info Icon</p>'):"TEAM"==APP.header.opponent_type?$("#opponents-panel-hint").addClass("text-gold").html('Use "Manage Team Library"<br />to add Opponents.<br />&nbsp;<br />Select "Start Game" to begin Match.'):"TOURNAMENT"==APP.session.getMatchMode()?$("#opponents-panel-hint").removeClass("text-gold").html('Use "Player Look Up"<br />to add new opponents'):$("#opponents-panel-hint").addClass("text-gold").html('Use "Manage Player Library"<br />to download your player library.<br />&nbsp;<br />Select "Start Game" to begin Match.');"TEAM"==APP.header.opponent_type?(APP.header.roster_left.team.is_default?$("#oph-bb-host").html("&nbsp;"):$("#oph-bb-host").html('<span class="text-gold">'+APP.header.teams[APP.header.roster_left.getTeamIndex()].chalkboard_name+"</span>"),APP.header.roster_right.team.is_default?$("#oph-bb-guest").html("&nbsp;"):$("#oph-bb-guest").html('<span class="text-gold">'+APP.header.teams[APP.header.roster_right.getTeamIndex()].chalkboard_name+"</span>"),$("#oph-bb-connect").show(0)):APP.device.is_hosting||"PARTICIPANT"==APP.device.role?($("#oph-bb-host").text("Host Player"),$("#oph-bb-guest").text("Guest Player"),$("#oph-bb-connect").show(0)):($("#oph-bb-host").html('<span class="text-gold">Left Opponent</span>'),$("#oph-bb-guest").html('<span class="text-gold">Right Opponent</span>'),$("#oph-bb-connect").show(0));var left_mini_list='<div id="oph-mini-list-left" class="oph-mini-list oph-text">',right_mini_list='<div id="oph-mini-list-right" class="oph-mini-list oph-text">';for(side in{left:"",right:""}){"left"==side?(other_side="right",roster=APP.header.roster_left,other_roster=APP.header.roster_right,APP.game.dflt_host_team):(other_side="left",roster=APP.header.roster_right,other_roster=APP.header.roster_left,APP.game.dflt_guest_team);try{roster.select_players?(l=APP.header.teams[roster.getTeamIndex()].players,r=roster.team.players,start_i=0):(l=APP.header.teams,r=[roster.team],start_i=1)}catch(e){}APP.session.isNewMatch()||roster.hasPlayers()?(APP.device.enableButton("oph-bb-reset-"+side),$("#oph-bb-reset-"+side).removeClass("button-down"),roster.hasPlayers()?$("#oph-bb-reset-"+side).removeClass("button-heavy-gray").addClass("button-gold"):$("#oph-bb-reset-"+side).removeClass("button-gold").addClass("button-heavy-gray")):APP.device.disableButton("oph-bb-reset-"+side);var ml_delim="";for(l||(l=[]),len=l.length,i=start_i;i<len;i++)if(l[i].obj_id==other_roster.team.obj_id&&APP.device.disableButton("op-button-"+side+"-"+l[i].obj_id),isSelected(l[i].obj_id,r)){"left"==side?(left_mini_list+=ml_delim,l[i].first_name&&l[i].first_name[0]&&APP.session.isBracketMatch()&&(left_mini_list+=l[i].first_name[0]+". "),left_mini_list+=l[i].chalkboard_name,ml_delim="<br />"):(right_mini_list+=ml_delim,l[i].first_name&&l[i].first_name[0]&&APP.session.isBracketMatch()&&(right_mini_list+=l[i].first_name[0]+". "),right_mini_list+=l[i].chalkboard_name,ml_delim="<br />"),roster.select_players||roster.team.is_default||!teamHasPlayers(roster.team)||(roster.select_players=!0,APP.header.rebuildOpponentsPanel());var playerEle=$("#op-"+side+"-"+l[i].obj_id);if(l[i].is_bot&&(playerEle.addClass("op-option-bot"),APP.dartbot.isScripted)){var ebTitle=APP.dartbot.getExactBotLevel(!0);playerEle.text(ebTitle)}playerEle.addClass("op-option-on"),APP.device.disableButton("op-button-"+other_side+"-"+l[i].obj_id),l[i].email?$("#op-edit-"+side+"-"+l[i].obj_id).attr("opacity",.99):$("#op-edit-"+side+"-"+l[i].obj_id).attr("opacity",0)}}if(1==APP.game.opponent_count&&($("#op-right-col").addClass("hidden"),APP.device.disableButton("oph-bb-sfb")),1==APP.game.opponent_count)msg="Practice";else{left_mini_list+="</div>",right_mini_list+="</div>";var pc_left=APP.header.roster_left.getPlayerCount(),pc_right=APP.header.roster_right.getPlayerCount(),railsTeamSize=!1;if(APP.nlf.data.rails){var set=APP.nlf.data.railsChapter;if(set&&set.player_format)switch(set.player_format){case"singles":railsTeamSize="Singles";break;case"doubles":railsTeamSize="Doubles";break;case"triples":railsTeamSize="Triples";break;case"quads":railsTeamSize="Quads";break;case"team":railsTeamSize="Teams";var maxTeamSize=APP.nlf.playerRails.getMaxTeamSize();maxTeamSize.active&&maxTeamSize.maxTeam&&(railsTeamSize+=`\n\t\t\t\t\t\t\t\t\t<span style="font-size: 0.5em;">\n\t\t\t\t\t\t\t\t\t\t(Max ${maxTeamSize.maxTeam})\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t`)}}switch(pc_left>pc_right?pc_left:pc_right){case 1:msg=left_mini_list+(railsTeamSize||"Singles")+right_mini_list;break;case 2:msg=left_mini_list+(railsTeamSize||"Doubles")+right_mini_list;break;case 3:msg=left_mini_list.replace("oph-text","oph-mini-list-small")+(railsTeamSize||"Triples")+right_mini_list.replace("oph-text","oph-mini-list-small");break;case 4:msg=left_mini_list.replace("oph-text","oph-mini-list-small")+(railsTeamSize||"Quads")+right_mini_list.replace("oph-text","oph-mini-list-small");break;default:msg=APP.device.is_hosting?'<span class="text-gold">This is the Host Device</span>':'<span class="text-gold">'+(railsTeamSize||"Select Opponents")+"</span>"}}APP.message_bar.show("message-bar-header"),APP.message_bar.display(msg,!0),$("#oph-bb-guest").removeClass("text-gold").addClass("text-white"),$("#panel-col-right-overlay").hide(0);var btnTxt,mf=APP.session.getMatchFormat()||{};("CORK"==mf.next_game||mf.next_game_options&&(mf.next_game_options.random_start||mf.next_game_options.cork_first))&&(btnTxt=APP.session.isNewMatch()&&mf.next_game_options&&mf.next_game_options.random_start?"Random Start":"Bull Up");var override=APP.zanis.masterCheck("Oppo Btn Txt");if(override)switch(override){case"CORK":btnTxt="Bull Up";break;case"RANDOM":btnTxt="Random Start";break;case"PLAYER":btnTxt="Select Starter";break;case"ALTERNATE":var lastSetStartingOppo=APP.session.getPrevSetStartingOpponent();"number"==typeof lastSetStartingOppo&&(btnTxt="",APP.device.disableButton("oph-bb-sfb"),APP.game.setBullShootWinner(0==lastSetStartingOppo?1:0,!1));break;case"MUGS_AWAY":var lastSetWinningOppo=APP.session.getPrevSetWinningOpponent();"number"==typeof lastSetWinningOppo&&(btnTxt="",APP.device.disableButton("oph-bb-sfb"),APP.game.setBullShootWinner(0==lastSetWinningOppo?1:0,!1))}btnTxt?($("#oph-bb-sfb").html(btnTxt),APP.device.disableButton("oph-bb-continue")):APP.device.enableButton("oph-bb-continue",!0),APP.nlf.rails.checkWdfRules()&&APP.nlf.rails.injections.selectPlayers(),APP.session.isChangingPlayerMidSet&&APP.device.enableButton("oph-bb-continue",!0);var ocm_left=Math.ceil($("#op-col-middle").position().left),os_width=parseInt($("#op-search").css("width"));$("#op-search").css("left",ocm_left),$("#op-search-2").css("left",ocm_left+Math.floor(.8*os_width))},areValidOpponentsSelected:function(){try{return APP.session.isBracketOfficialMatch()?APP.header.roster_left?0!=APP.header.roster_left.getPlayerCount()&&0!=APP.header.roster_right.getPlayerCount():0!=APP.game.opponent[0].team.getPlayerCount()&&0!=APP.game.opponent[1].team.getPlayerCount():!APP.session.isLeaguePlay()||(APP.header.roster_left?"TEAM"==APP.session.getMatchMode()?!APP.header.roster_left.team.is_default&&!APP.header.roster_right.team.is_default:0!=APP.header.roster_left.getPlayerCount()&&0!=APP.header.roster_right.getPlayerCount():"TEAM"==APP.session.getMatchMode()?!APP.game.opponent[0].team.is_default&&!APP.game.opponent[1].team.is_default:0!=APP.game.opponent[0].team.getPlayerCount()&&0!=APP.game.opponent[1].team.getPlayerCount())}catch(e){return!1}},home_away_selected:!1,handleOpponentChange:function(in_id,is_routine){var el,dflt_player,dflt_team,roster,obj_id;function resetSelections(in_roster,in_dflt_team){"TEAM"==APP.header.opponent_type&&in_roster.hasPlayers()?in_roster.resetPlayers():(in_roster.reset(),in_roster.loadTeam(in_dflt_team),in_roster.select_players="PLAYER"==APP.header.opponent_type),in_roster==APP.header.roster_right&&$("#op-right-Pdartbot").html("vs DartConnect")}function continueSFB(){APP.session.bracketFunctions.stuckData.check()&&(APP.recordError("Zombie Tournament Data Cleaned"),APP.session.bracketFunctions.stuckData.clean()),APP.header.recordOpponentChange(),checkSetSetup(),APP.game.shooting_for_bull?(APP.session.showGameSelector(!0),APP.session.showBullShoot()):(APP.session.showGameSelector(!0),APP.session.hideBullShoot()),APP.game_selector.selectGame("gs-cork-calls"),(APP.nlf.data.rails||APP.session.isLeaguePlay())&&APP.nlf.rails.autoGameSelect()}function continueContinue(){APP.header.recordOpponentChange(),checkSetSetup(),APP.game.shooting_for_bull?(APP.session.showGameSelector(!0),APP.session.showBullShoot()):(APP.session.showGameSelector(!0),APP.session.hideBullShoot()),(APP.nlf.data.rails||APP.session.isLeaguePlay())&&APP.nlf.rails.autoGameSelect()}function checkRailsTeams(in_callback){var leftQty=APP.header.roster_left.getPlayerCount(),rightQty=APP.header.roster_right.getPlayerCount(),railsCheck=APP.nlf.rails.isValidLineUp([leftQty,rightQty]);if(railsCheck.errorType&&2==railsCheck.errorType&&APP.nlf.playerRails.allowShortLineUp()&&(railsCheck.success=!0),railsCheck.success)in_callback();else if(railsCheck.homeBlock||railsCheck.awayBlock)railsCheck.errorMsg+='\n\t\t\t\t\t\t<hr class="" style="margin: 1em 0;">\n\t\t\t\t\t\t<p style="font-size: 1em">\n\t\t\t\t\t\t\tA team has too many players. Return to the player list and select the correct players\n\t\t\t\t\t\t</p>\n\t\t\t\t\t',APP.alert.show(railsCheck.errorMsg,"",!1,railsCheck.title),railsCheck.homeBlock&&APP.header.handleOpponentChange("oph-bb-reset-left"),railsCheck.awayBlock&&APP.header.handleOpponentChange("oph-bb-reset-right");else{switch(railsCheck.errorType){case 1:railsCheck.errorMsg+='\n\t\t\t\t\t\t\t\t<hr class="" style="margin: 1em 0;">\n\t\t\t\t\t\t\t\t<p style="font-size: 1em">\n\t\t\t\t\t\t\t\t\tSelect <span class="bold">Continue</span> to play this set without players\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t';break;case 2:railsCheck.errorMsg+='\n\t\t\t\t\t\t\t\t<hr class="" style="margin: 1em 0;">\n\t\t\t\t\t\t\t\t<p style="font-size: 1em">\n\t\t\t\t\t\t\t\t\tSelect <span class="bold">Continue</span> to play this set with missing player(s)\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t';break;case 3:railsCheck.errorMsg+='\n\t\t\t\t\t\t\t\t<hr class="" style="margin: 1em 0;">\n\t\t\t\t\t\t\t\t<p style="font-size: 1em">\n\t\t\t\t\t\t\t\t\tTeams have incomplete player lineups. Do you want to continue?\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t'}if(APP.nlf.rails.isForfeit)return;APP.confirm.show({msg:railsCheck.errorMsg,ok:in_callback,title:railsCheck.title,ok_text:"Continue"})}}function checkSetSetup(){try{if(APP.nlf.data.rails){var mf=APP.getMatch().format;if(mf.legs&&mf.legs.limit)return}}catch(e){}APP.header.showSetSetup({game_start:!0})}function checkNoPlayer(in_callback){BBAT.storeData({no_player_warning:!0}),APP.confirm.show({msg:"It appears that you<br />may be missing players<br />Do you want to continue?",ok:in_callback})}APP.session.getMatchFormat();switch(in_id){case"oph-bb-sfb":if(APP.nlf.data.rails)return void checkRailsTeams(continueContinue);if(!APP.header.areValidOpponentsSelected())return void APP.alert.show("Please select opponents.");"TEAM"!=APP.session.getMatchMode()||0!=APP.header.roster_left.getPlayerCount()&&0!=APP.header.roster_right.getPlayerCount()&&APP.header.roster_left.getPlayerCount()==APP.header.roster_right.getPlayerCount()?continueSFB():checkNoPlayer(continueSFB);break;case"oph-bb-continue":if(APP.nlf.data.rails)return void checkRailsTeams(continueSFB);if(!APP.header.areValidOpponentsSelected())return void APP.alert.show("Please select opponents.");"TEAM"!=APP.session.getMatchMode()||0!=APP.header.roster_left.getPlayerCount()&&0!=APP.header.roster_right.getPlayerCount()&&APP.header.roster_left.getPlayerCount()==APP.header.roster_right.getPlayerCount()?continueContinue():checkNoPlayer(continueContinue);break;case"rails-team-continue":continueContinue();break;case"bb-o-reload":"HOST"==APP.device.role?APP.confirm.show({msg:"Reload/Replay the Prior Leg?",ok:APP.session.reloadPriorLeg}):APP.popup.show("popup-notify","To access prior leg, have the host device control the match",8e3,.95);break;case"bb-o-connect":APP.handleMatchOption("bb-e-alley");break;case"oph-bb-forfeit":return void(APP.header.areValidOpponentsSelected()?(APP.header.recordOpponentChange(!0),APP.session.startForfeit()):APP.alert.show("Please select opponents."));case"bb-o-match-format":APP.header.has_seen_legs_menu=!1,APP.session.isBracketMatch()&&!APP.session.isBracketPrescribedMatch()?APP.header.showSetSetup({advanced_only:!1}):APP.header.showSetSetup({advanced_only:!0});break;case"oph-bb-reset-left":resetSelections(APP.header.roster_left,APP.game.dflt_host_team),"TEAM"==APP.session.getMatchMode()?APP.header.rebuildOpponentsPanel():APP.header.refreshOpponentsPanel();break;case"oph-bb-reset-right":resetSelections(APP.header.roster_right,APP.game.dflt_guest_team),"TEAM"==APP.session.getMatchMode()?APP.header.rebuildOpponentsPanel():APP.header.refreshOpponentsPanel();break;case"oph-bb-library":if("TOURNAMENT"==APP.session.getMatchMode())APP.header.showAddPlayer();else if(APP.session.isLeaguePlay()&&APP.session.getMatchLeagueKey().league_id){"PRE"==APP.session.getMatchLeagueKey().season_status?APP.alert.show("Your league is currently in pre-season and this function is not available.",null,null,"Notice!"):APP.confirm.show({title:"Notice!",msg:"Adding or modifying players will send a notification to the league.<br />&nbsp;<br />Player edits require WiFi and a valid email to become permanent.",ok_text:"Continue",ok:function(){"TEAM"==APP.header.opponent_type&&APP.header.roster_left.hasPlayers()&&APP.header.roster_left.resetPlayers(),resetSelections(APP.header.roster_left,APP.game.dflt_host_team),"TEAM"==APP.header.opponent_type&&APP.header.roster_right.hasPlayers()&&APP.header.roster_right.resetPlayers(),resetSelections(APP.header.roster_right,APP.game.dflt_guest_team),APP.header.rebuildOpponentsPanel(),APP.header.library_mode="SELECT",APP.header.refreshOpponentLibrary(),APP.popup.show("popup-opponent-library"),$("#pol-list").css("height",$("#popup-opponent-library").outerHeight(!0)-$("#pol-header").outerHeight(!0)-$("#pol-footer").outerHeight(!0)).scrollTop(0)}})}else"TEAM"==APP.header.opponent_type&&APP.header.roster_left.hasPlayers()&&APP.header.roster_left.resetPlayers(),resetSelections(APP.header.roster_left,APP.game.dflt_host_team),"TEAM"==APP.header.opponent_type&&APP.header.roster_right.hasPlayers()&&APP.header.roster_right.resetPlayers(),resetSelections(APP.header.roster_right,APP.game.dflt_guest_team),APP.header.rebuildOpponentsPanel(),APP.header.library_mode="SELECT",APP.header.refreshOpponentLibrary(),APP.popup.show("popup-opponent-library"),$("#pol-list").css("height",$("#popup-opponent-library").outerHeight(!0)-$("#pol-header").outerHeight(!0)-$("#pol-footer").outerHeight(!0)).scrollTop(0);break;case"op-button-left-add-player":"TOURNAMENT"==APP.session.getMatchMode()?(resetSelections(APP.header.roster_left,APP.game.dflt_host_team),resetSelections(APP.header.roster_right,APP.game.dflt_guest_team),APP.server.getTournamentPlayers({spinner:"50%",tournament_id:APP.session.getTournamentID(),force:!0,on_success:function(in_players){APP.header.loadTournamentDirectory(in_players),APP.header.rebuildOpponentsPanel()},on_error:function(e){APP.session.bracket_offline_error_visible=!1,APP.session.warnBracketConnectivity(),"function"==typeof in_callback&&in_callback()}})):APP.header.showAddPlayer();break;default:if(!is_routine&&"op-right-Pdartbot"==in_id&&APP.dartbot.isScripted&&APP.dartbot.locked)return void APP.confirm.show({title:"Notice!",msg:"This will remove ExactBot. Continue?",ok:function(){APP.dartbot.clearExactBot(),APP.header.handleOpponentChange("op-right-Pdartbot")}});if(0==in_id.indexOf("op-edit-")){"PRE"==APP.session.getMatchLeagueKey().season_status?APP.alert.show("Your league is currently in pre-season and this function is not available.",null,null,"Notice!"):(roster=in_id.indexOf("left")>=0?APP.header.roster_left:APP.header.roster_right,APP.header.showAddPlayer(roster.getTeamIndex(),APP.extractLastSegment(in_id)))}else{if(APP.session.isLeaguePlay()&&$("#"+in_id).parent().hasClass("ineligible"))return void APP.alert.show("This player is ineligible to play in Post Season");if(!APP.header.home_away_selected&&("TEAM"==APP.session.getMatchMode()&&APP.header.roster_left.team.is_default&&APP.header.roster_right.team.is_default||"SINGLES"==APP.session.getMatchMode()&&(!APP.header.roster_left.team.players[0]||APP.header.roster_left.team.players[0].is_default)&&(!APP.header.roster_right.team.players[0]||APP.header.roster_right.team.players[0].is_default)))return APP.session.currentLeagueIsGroup()?(APP.header.home_away_selected=!0,void APP.header.handleOpponentChange(in_id.replace("right","left"))):void APP.confirm.show({title:"Home/Away Selector",msg:'<p style="line-height:1.3em;">Is <span style="font-weight:bold;">'+$($("#"+in_id)[0]).text()+"</span> Home/Host<br />or Away/Guest?</p>",ok_text:"Home/Host",cancel_text:"Away/Guest",use_close_icon:!0,close:function(){APP.header.home_away_selected=!1,resetSelections(APP.header.roster_left,APP.game.dflt_host_team),resetSelections(APP.header.roster_right,APP.game.dflt_guest_team),APP.header.rebuildOpponentsPanel()},ok:function(){APP.header.home_away_selected=!0,0==APP.header.home_index?APP.header.handleOpponentChange(in_id.replace("right","left")):APP.header.handleOpponentChange(in_id.replace("left","right"))},cancel:function(){APP.header.home_away_selected=!0,0==APP.header.home_index?APP.header.handleOpponentChange(in_id.replace("left","right")):APP.header.handleOpponentChange(in_id.replace("right","left"))}});APP.header.home_away_selected=!1,in_id.indexOf("left")>=0?(el=$("#op-left-"+APP.extractLastSegment(in_id)),"left","right",roster=APP.header.roster_left,dflt_team=APP.game.dflt_host_team,dflt_player=APP.game.dflt_host_player):(el=$("#op-right-"+APP.extractLastSegment(in_id)),"right","left",roster=APP.header.roster_right,dflt_team=APP.game.dflt_guest_team,dflt_player=APP.game.dflt_guest_player),obj_id=APP.extractLastSegment(in_id),roster.select_players?el.hasClass("op-option-on")?(roster.removePlayer(obj_id),roster.hasPlayers()||roster.addPlayer(dflt_player)):roster.getPlayerCount()<4&&roster.addPlayer({obj_id:obj_id}):el.hasClass("op-option-on")?roster.loadTeam(dflt_team):roster.loadTeam({obj_id:obj_id})}"op-right-Pdartbot"==in_id&&(APP.header.roster_right.hasBotPlayer()?APP.header.startDartBotSettings():(APP.dartbot.clearExactBot(),$("#op-right-Pdartbot").html("vs DartConnect"))),APP.header.refreshOpponentsPanel()}},recordOpponentChange:function(in_record_only){var pc_0,pc_1;function packageRoster(in_roster,in_dflt_team){var l,i,j,t,len,p,player;if("PLAYER"==APP.header.opponent_type){if(!in_roster.team.players[0]||in_roster.team.players[0].is_default)return in_dflt_team}else if(in_roster.team.is_default)return in_dflt_team;if(l=APP.header.teams,i="PLAYER"==APP.header.opponent_type?0:in_roster.getTeamIndex(),t=new APP.game.Team(l[i]),!in_roster.select_players)return t;if(in_roster.hasPlayers())for(len=in_roster.getPlayerCount(),j=0;j<len;j++)p=in_roster.team.players[j],player=l[i].getPlayer(p.obj_id),p.is_bot&&p.bot_skill&&(player.bot_level=p.bot_level,player.bot_skill=p.bot_skill),p.player_guid&&(player.player_guid=p.player_guid),t.addPlayer(player),t.sort();return t}function sameOpponent(in_roster,in_opponent){var i,len;if(!in_roster.team)return!1;if(in_roster.team.obj_id!=in_opponent.team.obj_id)return!1;if(in_roster.team.players.length!=in_opponent.team.players.length)return!1;for(len=in_roster.team.players.length,i=0;i<len;i++)if(in_roster.team.players[i].obj_id!=in_opponent.team.players[i].obj_id)return!1;return!0}function addFillerPlayers(in_opponent,in_count){var i,p;for(p=APP.game.opponent[in_opponent].team.players,i=0;i<in_count;i++)p.push(APP.game.filler_player)}var noNewSet=!1;APP.session.isChangingPlayerMidSet&&(noNewSet=!0),sameOpponent(APP.header.roster_left,APP.game.opponent[0])&&sameOpponent(APP.header.roster_right,APP.game.opponent[1])||noNewSet?(APP.game.opponent[0].setTeam(packageRoster(APP.header.roster_left,APP.game.dflt_host_team),APP.header.opponent_type),APP.game.opponent[0].player_order.length=0,APP.game.opponent[1].setTeam(packageRoster(APP.header.roster_right,APP.game.dflt_guest_team),APP.header.opponent_type),APP.game.opponent[1].player_order.length=0):(APP.game.opponent[0].setTeam(packageRoster(APP.header.roster_left,APP.game.dflt_host_team),APP.header.opponent_type),APP.game.opponent[0].player_order.length=0,APP.game.opponent[1].setTeam(packageRoster(APP.header.roster_right,APP.game.dflt_guest_team),APP.header.opponent_type),APP.game.opponent[1].player_order.length=0,APP.session.isLeaguePlay()||APP.session.addSet(APP.game.name));var noShortPlayers=!1,railsTurnSettings=APP.nlf.playerRails.getTeamTurnSetting();railsTurnSettings.active&&"NO_SKIP_TURNS"==railsTurnSettings.turnSetting&&(noShortPlayers=!0),"TEAM"!=APP.session.getMatchMode()||noShortPlayers||(pc_0=APP.game.opponent[0].team.getPlayerCount(),pc_1=APP.game.opponent[1].team.getPlayerCount(),pc_0>0&&pc_0<pc_1?addFillerPlayers(0,pc_1-pc_0):pc_1>0&&pc_1<pc_0&&addFillerPlayers(1,pc_0-pc_1)),APP.game.opponent[0].player_tracking=APP.header.roster_left.player_tracking,APP.game.opponent[1].player_tracking=APP.header.roster_right.player_tracking,APP.session.isNewMatch()&&APP.session.setMatchOpponentGUIDs({game:APP.game,directory_type:APP.header.directory_type,opponent_type:APP.header.opponent_type}),in_record_only||(APP.game.isBotPlaying()?APP.device.disableButton("gs-library"):APP.device.enableButton("gs-library"),APP.storeState({settings_change:!0}),APP.header.finishOpponentChange(),APP.game.plugin.refreshGamePanel())},finishOpponentChange:function(){var mm=APP.session.getMatchMode(),do_listing=APP.device.is_broadcasting&&(APP.user.seba||"TOURNAMENT"==mm||"TEAM"==mm||"SINGLES"==mm);do_listing="TEAM"==mm?(do_listing=do_listing&&!APP.header.roster_left.team.is_default)&&!APP.header.roster_right.team.is_default:(do_listing=do_listing&&APP.header.roster_left.team.players[0]&&!APP.header.roster_left.team.players[0].is_default)&&APP.header.roster_right.team.players[0]&&!APP.header.roster_right.team.players[0].is_default;var isRails=APP.nlf.data.rails;if(do_listing){var ol=[],pl=[],buildBoth=!1;if("TEAM"==mm&&isRails&&(buildBoth=!0),("TEAM"==mm||buildBoth)&&(ol.push(APP.header.teams[APP.header.roster_left.getTeamIndex()].chalkboard_name),ol.push(APP.header.teams[APP.header.roster_right.getTeamIndex()].chalkboard_name)),"TEAM"!=mm||buildBoth){buildBoth||(ol.push(APP.header.teams[APP.header.roster_left.getTeamIndex()].chalkboard_name),ol.push(APP.header.teams[APP.header.roster_right.getTeamIndex()].chalkboard_name));for(var pi=0;pi<APP.header.roster_left.team.players.length;pi++){(p=APP.header.teams[APP.header.roster_left.getTeamIndex()].getPlayer(APP.header.roster_left.team.players[pi].obj_id))&&pl.push({opponent_index:0,last_name:"*"==p.last_name?"":p.last_name,first_name:"*"==p.first_name?"":p.first_name,iso2_country:p.iso2_country,iso3_country:p.iso3_country,email:p.email,player_guid:p.player_guid})}for(pi=0;pi<APP.header.roster_right.team.players.length;pi++){var p;(p=APP.header.teams[APP.header.roster_right.getTeamIndex()].getPlayer(APP.header.roster_right.team.players[pi].obj_id))&&pl.push({opponent_index:1,last_name:"*"==p.last_name?"":p.last_name,first_name:"*"==p.first_name?"":p.first_name,iso2_country:p.iso2_country,iso3_country:p.iso3_country,email:p.email,player_guid:p.player_guid})}}}APP.reveal.setBackButton("BACK"),APP.header.roster_left=null,APP.header.roster_right=null;APP.reveal.hidePanel((function(){if(APP.reveal.showButtonBar("button-bar-match"),APP.header.enableEditing(),APP.header.refresh(),APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.reveal.updateSetStatus(),APP.header.players_checked_in=!0,BBAT.storeData({players_checked_in:!0}),APP.game_selector.refreshGamePanel(),do_listing){var html=$("#header").html();html=(html=html.replace(/(<div id="hdr-score-0".*?>).*?(<\/div>)/g,"$10$2")).replace(/(<div id="hdr-score-1".*?>).*?(<\/div>)/g,"$10$2"),APP.server.postBroadcast({header:html,scoreboard:$("#scoreboard-center").html(),message_bar:'<div style="font-size:2.5em; color: gray; padding-top: 0.4em;">Waiting for Game Start...</div>',suggested_out:"",notable:""},ol,pl)}}),!0)},cancelOpponentChange:function(){APP.header.finishOpponentChange()},isSamePlayer:function(in_a,in_b){return in_a.chalkboard_name==in_b.chalkboard_name},isSameTeam:function(in_a,in_b){return in_a.chalkboard_name==in_b.chalkboard_name},handleMoneyMenu:function(in_id){var mr=APP.session.getMatchMoney(),new_mr=APP.extractLastSegment(in_id).toUpperCase();new_mr==mr?(APP.session.setMatchMoney(null),APP.header.updateMatchMoneyButton()):(APP.session.setMatchMoney(new_mr),APP.header.updateMatchMoneyButton())},getMoneyText:function(in_money_code){var html="";switch(in_money_code){case"T2":html="Finals";break;case"T4":html="Semi Finals";break;case"T8":html="Quarter Finals";break;case"T16":html="Top Sixteen";break;case"T32":html="Top Thirty-Two";break;default:html=""}return html},updateMatchMoneyButton:function(){var html,mr=APP.session.getMatchMoney();$(".pssm-mrb").removeClass("button-green").addClass("button-gray"),mr&&$("#pssm-mrb-"+mr.toLowerCase()).removeClass("button-gray").addClass("button-green"),html=mr?APP.header.getMoneyText(mr):"Select For Finals / $ Money Rounds",$("#pssm-mrb-title").html(html)},handleLegsEditor:function(in_id){var regx,legs,mf=APP.session.getMatchFormat(),uo=APP.user_options;function hideKeyboard(){$("#ple-legs").blur()}function finish(){$("#ple-legs").val("").blur(),$("#popup-legs-editor").hide(0),$("#popup-legs-editor-overlay").hide(0),APP.header.showSetSetup()}switch(in_id){case"ple-continue":regx=/^[0-9]+$/i,(legs=$("#ple-legs").val()).match(regx)?(null!=mf&&'{"limit":null}'===JSON.stringify(mf.legs)&&(mf.legs=null),mf||(mf={sets:null,legs:null,next_game:null,next_game_options:null,same_game:null,same_legs:null,points_style:APP.session.getSetPointsStyle(),points:1}),mf.legs||(mf.legs={},mf.legs.mode="none"!=$("#pssm-set-play-all").css("display")?"PLAY-ALL":"BEST-OF"),mf.legs.limit=legs,APP.session.setMatchFormat(mf),"TOURNAMENT"==APP.session.getMatchMode()&&(uo.tournament_leg_mode=mf.legs.mode,uo.tournament_next_game=mf.next_game,uo.tournament_next_game_options=mf.next_game_options,uo.tournament_same_game=mf.same_game,uo.tournament_same_legs=mf.same_legs,APP.storeUserOptions()),hideKeyboard(),finish()):APP.alert.show("Invalid legs quantity",(function(){$("#ple-legs").focus()}),null,"Try Again");break;default:hideKeyboard(),finish()}},showLegsEditor:function(){var mf=APP.session.getMatchFormat()||{},el=$("#ple-legs");APP.device.pauseKeyboardHandler(),el.on("focus",(function(e){$("#ple-legs").val("")})),el.on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.header.handleLegsEditor("ple-continue"),!1):27==e.which?(BBAT.killDOMEvent(e),APP.header.handleSetSetup("ple-close"),!1):void 0})),mf.legs&&mf.legs.limit?el.val(mf.legs.limit):el.val(""),mf.legs&&"PLAY-ALL"==mf.legs.mode?$("#ple-title").html("Play All"):mf.legs&&"BEST-OF"==mf.legs.mode?$("#ple-title").html("Best of"):"none"!=$("#pssm-set-play-all").css("display")?$("#ple-title").html("Play All"):$("#ple-title").html("Best of"),$("#popup-legs-editor-overlay").show(0),$("#popup-legs-editor").show(0)},isInMatchSetup:function(){return"none"!=$("#opponents-panel").css("display")},set_setup_callback:null,handleSetSetup:function(in_id,track_id){var sets_spec_ok,sets_limit,sets_mode,sets_spec,legs_spec_ok,legs_max_ok,legs_max,legs_mode,legs_spec,next_game,next_game_options,regx,same_game,same_legs,points,points_style,in_focus_id,in_msg,sess=APP.session,mf=APP.session.getMatchFormat()||{},uo=APP.user_options,mm=APP.session.getMatchMode(),cm=sess.matches[sess.current_match];function showBestOfWarning(in_params){var ls=in_params.legs_spec||{},ss=in_params.sets_spec||{};APP.nlf.data.rails&&in_params.ok_callback(),"BEST-OF"==ls.mode&&ls.limit&&ls.limit%2==0||"BEST-OF"==ss.mode&&ss.limit&&ss.limit%2==0?APP.confirm.show({msg:"This set or match<br>could result in a tie.",ok_text:"Continue",ok:in_params.ok_callback}):in_params.ok_callback()}function hideKeyboard(){$("#pmsm-set-limit").blur()}function finish(in_full_close){$("#pmsm-set-limit").val("").blur(),APP.device.resumeKeyboardHandler(),APP.header.hideSetSetup(),"IN-GAME"==APP.mode&&(APP.session.store(APP.session.current_match),APP.game.finished&&APP.reload()),APP.header.roster_left&&APP.header.roster_right&&APP.header.refreshOpponentsPanel(),"function"==typeof APP.header.set_setup_callback&&APP.header.set_setup_callback(),APP.message_bar.refreshStatusMessage(),APP.session.updateLegFormat(),APP.header.set_setup_callback=null}switch(in_id){case"kb-enter":hideKeyboard();break;case"pssm-close":finish();break;case"pssm-info":APP.info.show("info-text-match-format","Match Settings");break;case"pssm-lpb-quarter":case"pssm-lpb-half":case"pssm-lpb-one":case"pssm-lpb-two":case"pssm-lpb-three":var cp=1;mf=APP.session.getMatchFormat();switch(in_id){case"pssm-lpb-quarter":cp=.25;break;case"pssm-lpb-half":cp=.5;break;case"pssm-lpb-one":cp=1;break;case"pssm-lpb-two":cp=2;break;case"pssm-lpb-three":cp=3}APP.session.setSetPoints(cp),APP.header.setLeaguePointButtons(mf.points_style,cp);break;case"pssm-set-play":uo.tournament_mode?APP.header.handleSetSetup("pmsm-reset","1"):"SETPLAY"!=uo.tournament_mode&&(sess.resetMatchFormatLegs(),sess.resetMatchFormatSets(),uo.tournament_mode="SETPLAY",APP.storeUserOptions(),finish(APP.header.isInMatchSetup()));break;case"pssm-advanced-tournament-type-button":$("#pssm-advanced-tournament-type-button").hide(0),$("#pssm-advanced-tournament-type").show(0);break;case"pssm-elimination":uo.tournament_mode?APP.header.handleSetSetup("pmsm-reset","2"):"ELIMINATION"!=uo.tournament_mode&&(APP.session.isOnlineBracketMatch()||(sess.resetMatchFormatLegs(),sess.resetMatchFormatSets(!0)),uo.tournament_mode="ELIMINATION",APP.storeUserOptions(),finish(APP.header.isInMatchSetup()));break;case"pssm-round-robin":uo.tournament_mode?APP.header.handleSetSetup("pmsm-reset","3"):"ROUND ROBIN"!=uo.tournament_mode&&(sess.resetMatchFormatLegs(),sess.resetMatchFormatSets(!0),uo.tournament_mode="ROUND ROBIN",APP.storeUserOptions(),finish(APP.header.isInMatchSetup()));break;case"pssm-match-play":uo.tournament_mode?APP.header.handleSetSetup("pmsm-reset","4"):"MATCHPLAY"!=uo.tournament_mode&&(sess.resetMatchFormatLegs(),sess.resetMatchFormatSets(!0),uo.tournament_mode="MATCHPLAY",APP.storeUserOptions(),finish(APP.header.isInMatchSetup()));break;case"pssm-set-other":APP.header.showLegsEditor();break;case"pmsm-advanced":case"pssm-advanced":APP.header.set_setup_callback=APP.header.showSetSetup,APP.header.showSetSetupSection(!0);break;case"pmsm-reset":hideKeyboard();var ld=APP.session.getMatchLeagueKey();if(APP.session.isLeaguePlay()&&ld.league_division_guid){var als=APP.getAssociatedLeagueSeason(ld.league_division_guid);APP.session.setMatchFormat(als.match_settings)}else sess.setMatchMoney(null),sess.setMatchFormat(null),$("#pmsm-singles-options > .button").removeClass("button-red").addClass("button-gray"),"TOURNAMENT"==mm&&(uo.tournament_mode=null,uo.tournament_leg_max=null,uo.tournament_leg_mode=null,uo.tournament_set_mode=null,uo.tournament_set_limit=null,uo.tournament_next_game=null,uo.tournament_next_game_options=null,uo.tournament_same_game=null,uo.tournament_same_legs=null,APP.storeUserOptions());APP.storeState({settings_change:!0}),APP.header.showSetSetupSection(!0);break;case"pmsm-continue":if(hideKeyboard(),regx=/^[0-9]+$/i,"TOURNAMENT"==mm&&"SETPLAY"!=uo.tournament_mode?(sets_limit="1",sets_mode="BEST-OF",legs_max="MATCHPLAY"==uo.tournament_mode?$("#pmsm-ms-limit").val():null,legs_mode=(legs_mode=$(".pmsm-leg-option").filter(".button-red")[0])?legs_mode.id.substr(9).toUpperCase():null):(sets_limit=$("#pmsm-set-limit").val(),sets_mode=(sets_mode=$(".pmsm-set-option").filter(".button-red")[0])?sets_mode.id.substr(9).toUpperCase():null,legs_mode=(legs_mode=$(".pmsm-leg-option").filter(".button-red")[0])?legs_mode.id.substr(9).toUpperCase():null),sets_spec_ok=!0,sets_spec=null,(sets_limit||sets_mode||"SETPLAY"==uo.tournament_mode)&&(sets_limit.match(regx)&&sets_mode?sets_spec={mode:sets_mode,limit:sets_limit}:sets_spec_ok=!1),legs_spec_ok=!0,legs_max_ok=!0,legs_spec=null,mf.legs&&mf.legs.limit?(legs_spec=mf.legs,legs_mode&&(legs_spec.mode=legs_mode)):legs_mode&&(legs_spec={mode:legs_mode}),"MATCHPLAY"==uo.tournament_mode&&legs_max&&(legs_max.match(regx)&&legs_max%2==1||(legs_max_ok=!1,legs_spec_ok=!1)),same_game=function(){switch($(".pmsm-game-option").filter(".button-red")[0].id){case"pmsm-per-leg":return"PER-LEG";case"pmsm-per-set":return"PER-SET";case"pmsm-per-match":return"PER-MATCH";default:return"PER-LEG"}}(),same_legs=$("#pmsm-same-legs").hasClass("button-red"),APP.session.isLeaguePlay())switch($(".pmsm-points-option").filter(".button-red")[0].id){case"pmsm-point-per-leg":points=1,points_style="PER-LEG";break;case"pmsm-point-varies":points=APP.session.getSetPoints()||1,points_style="VARIES";break;case"pmsm-point-suppress":points=0,points_style="SUPPRESS";break;default:points=1,points_style="PER-SET"}else points=1,points_style=null;if((next_game=$(".pmsm-next-game-option").filter(".button-red")[0])?(next_game=APP.extractLastSegment(next_game.id).toUpperCase(),next_game_options="ALTERNATE"==next_game?{random_start:$("#pmsm-random-start").hasClass("button-red"),cork_first:$("#pmsm-cork-first").hasClass("button-red"),cork_last:$("#pmsm-cork-last").hasClass("button-red")}:null):(next_game=null,next_game_options=null),sets_spec_ok&&legs_spec_ok){if(sets_spec){cm=APP.session.matches[APP.session.current_match];if("PLAY-ALL"==sets_spec.mode)var min_viable_sets=cm.set_wins[0]+cm.set_wins[1];else if(cm.set_wins[0]>cm.set_wins[1])min_viable_sets=cm.set_wins[0]?2*cm.set_wins[0]-1:0;else min_viable_sets=cm.set_wins[1]?2*cm.set_wins[1]-1:0;if(parseInt(sets_spec.limit,10)<min_viable_sets)return void APP.alert.show("Invalid # of sets given the current match status... the minimum is "+min_viable_sets)}showBestOfWarning({sets_spec:sets_spec,legs_spec:legs_spec,ok_callback:function(){sess.setMatchFormat({sets:sets_spec,legs:legs_spec,next_game:next_game,next_game_options:next_game_options,same_game:same_game,same_legs:same_legs,points_style:points_style,points:points}),APP.session.setSetPointsStyle(points_style),APP.session.setSetPoints(points),APP.storeState({settings_change:!0,callback:function(){"TOURNAMENT"==mm&&(uo.tournament_leg_max=legs_max,uo.tournament_next_game=next_game,uo.tournament_next_game_options=next_game_options,uo.tournament_same_game=same_game,uo.tournament_same_legs=same_legs,"SETPLAY"==uo.tournament_mode&&(uo.tournament_leg_mode=legs_spec?legs_spec.mode:null,uo.tournament_set_mode=sets_spec.mode,uo.tournament_set_limit=sets_spec.limit)),APP.storeUserOptions(),finish()}}),!APP.header.has_seen_legs_menu&&APP.quickplay.data.showLegsMenu&&(APP.handleMatchOption("bb-e-new-players"),APP.quickplay.data.showLegsMenu=!1,finish())}})}else{in_focus_id="pmsm-set-limit",in_msg=legs_max_ok?"TOURNAMENT"!=mm||legs_spec_ok?"For Sets,<br />specify the Number<br />AND format (Best Of/Play All).":"Number of Legs is required.":"Max Legs Must be Odd.",APP.alert.show(in_msg,(function(){$("#"+in_focus_id).focus()}),null,"Setup Error")}break;case"pmsm-set-play-all":case"pmsm-set-best-of":hideKeyboard(),APP.header.updateSetLimitButtons($("#"+in_id).hasClass("button-red")?null:in_id);break;case"pmsm-leg-play-all":case"pmsm-leg-best-of":hideKeyboard(),APP.header.updateLegLimitButtons($("#"+in_id).hasClass("button-red")?null:in_id);break;case"pmsm-per-match":case"pmsm-per-set":case"pmsm-per-leg":hideKeyboard(),APP.header.updateSameGameButtons(in_id);break;case"pmsm-same-legs":case"pmsm-select-legs":hideKeyboard(),APP.header.updateSameLegsButton($("#pmsm-same-legs").hasClass("button-gray"));break;case"pmsm-point-per-leg":case"pmsm-point-per-set":case"pmsm-point-varies":case"pmsm-point-suppress":hideKeyboard(),APP.header.setPointsStyleButton(in_id);break;case"pmsm-alternate":case"pmsm-cork":case"pmsm-menu":case"pmsm-select":hideKeyboard(),APP.header.updateNextGameButtons($("#"+in_id).hasClass("button-red")?null:in_id);break;case"pmsm-random-start":case"pmsm-cork-last":case"pmsm-cork-first":hideKeyboard(),APP.header.updateNextGameOptionButtons(in_id,!$("#"+in_id).hasClass("button-red"));break;case"pssm-continue":if(APP.header.has_seen_legs_menu=!0,mf.legs&&mf.legs.limit){var cs=APP.session.matches[APP.session.current_match].sets[APP.session.current_set];if("PLAY-ALL"==mf.legs.mode)var min_viable_legs=cs.wins[0]+cs.wins[1];else if(cs.wins[0]>cs.wins[1])min_viable_legs=cs.wins[0]?2*cs.wins[0]-1:0;else min_viable_legs=cs.wins[1]?2*cs.wins[1]-1:0;if(mf.legs.limit<min_viable_legs)return void APP.alert.show("Invalid # of legs given the current set status... the minimum is "+min_viable_legs)}var canSkipLegs=!0;APP.session.isBracketMatch()&&(canSkipLegs=!1),APP.session.isBracketPracticeMatch()&&(canSkipLegs=!1),APP.session.isOnlineBracketMatch()&&(canSkipLegs=!1),APP.session.isLeaguePlay()&&(canSkipLegs=!1),"TOURNAMENT"==mm&&(canSkipLegs=!1),mf.legs&&mf.legs.limit||canSkipLegs?showBestOfWarning({legs_spec:mf.legs,ok_callback:function(){if(mf.legs&&mf.legs.limit||APP.session.setMatchFormat(mf),"TOURNAMENT"==mm&&mf.legs&&mf.legs.limit&&(uo.tournament_leg_mode=mf.legs.mode,APP.storeUserOptions()),APP.session.isLeaguePlay()&&"VARIES"==mf.points_style){switch(APP.extractLastSegment($(".pssm-lpb-points").filter(".button-red")[0].id)){case"quarter":mf.points=.25;break;case"half":mf.points=.5;break;case"one":mf.points=1;break;case"two":mf.points=2;break;case"three":mf.points=3}APP.session.setMatchFormat(mf),APP.session.setSetPoints(mf.points)}APP.storeState({settings_change:!0,callback:function(){APP.storeUserOptions(),finish()}})}}):APP.alert.show("Number of legs is required."),APP.reveal.updateSetStatus(),mf.legs&&mf.legs.limit||!canSkipLegs||APP.session.showBullShoot();break;default:mf=APP.session.getMatchFormat();var el=$("#"+in_id);mf||(mf={legs:null,sets:"TOURNAMENT"==mm?{mode:"PLAY-ALL",limit:1}:null,next_game:null,next_game_options:null,same_game:null,same_legs:null,points_style:APP.session.getSetPointsStyle(),points:1}),el.hasClass("button-red")?("TOURNAMENT"==mm?APP.session.setMatchFormat(null):APP.session.resetMatchFormatLegs(),APP.storeState({settings_change:!0}),$(".pssm-set-option").removeClass("button-red").addClass("button-gray"),APP.header.setContinueButton(),"none"!=$("#pssm-set-play-all").css("display")?APP.header.switchQuickLegs("PLAY-ALL"):APP.header.switchQuickLegs("BEST-OF")):(mf.legs={mode:in_id.indexOf("-pa-")>=0?"PLAY-ALL":"BEST-OF",limit:APP.extractLastNumberSegment(in_id),locked:!1},APP.session.setMatchFormat(mf),APP.storeState({settings_change:!0}),APP.header.showSetSetupSection())}},setLeaguePointButtons:function(in_points_per,in_points){var lpb_id;switch($("#pssm-league-points-hint").html("League Points for this Set"),APP.device.enableButtonClass("pssm-lpb-points",!0),$(".pssm-lpb-points").removeClass("button-red").addClass("button-gray"),in_points){case.25:lpb_id="pssm-lpb-quarter";break;case.5:lpb_id="pssm-lpb-half";break;case 1:lpb_id="pssm-lpb-one";break;case 2:lpb_id="pssm-lpb-two";break;case 3:lpb_id="pssm-lpb-three"}$("#"+lpb_id).removeClass("button-gray").addClass("button-red")},setContinueButton:function(){var el=$("#pssm-continue"),mm=APP.session.getMatchMode();0!=$(".pssm-set-option.button-red").length||"TOURNAMENT"==mm&&!APP.session.isBracketPracticeMatch()||"SINGLES"==mm||"TEAM"==mm||$("#pssm-special-legs").css("display"),el.removeClass("button-red").addClass("button-green").html("Continue")},switchQuickLegs:function(in_mode){$("#pssm-set-play-all").hide(0),$("#pssm-set-best-of").hide(0),"PLAY-ALL"==in_mode?($("#pssm-set-switch-left").html("Play"),$("#pssm-set-switch-right").html("All"),$("#pssm-set-play-all").show(0)):($("#pssm-set-switch-left").html("Best of"),$("#pssm-set-switch-right").html("First to"),$("#pssm-set-best-of").show(0))},handleBracketBoardSelector:function(in_id){var bi,el_bi=$("#pbbs-board-id");APP.session.bracket;switch(in_id){case"pbbs-continue":(bi=el_bi.val())&&(APP.session.resetBracketBoard(),APP.session.setBracketBoard(bi,APP.reload),APP.device.disableButton("pbbs-continue"),APP.device.disableButton("pbbs-reset"));break;case"pbbs-reset":el_bi.val("").focus();break;case"pbbs-round-robin":APP.session.showBracketRoundRobinEventListing(),$("#popup-bracket-board-selector").hide(0),$("#popup-bracket-board-selector-overlay").hide(0);break;case"pbbs-practice":$("#popup-bracket-board-selector").hide(0),$("#popup-bracket-board-selector-overlay").hide(0),APP.session.handleBracketMatchListing("pbml-practice"),APP.practicePopup.start();break;case"pbbs-close":APP.reveal.handleButtons("reveal-exit")}},showBracketBoardSelector:function(){var sess=APP.session,el=$("#pbbs-board-id"),bi=(sess.bracket||{}).board_id||"";APP.device.pauseKeyboardHandler(),el.on("focus",(function(e){$("#pbbs-board-id").val(""),APP.device.enableButton("pbbs-continue",!0),APP.device.enableButton("pbbs-reset",!0)})),el.on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.header.handleBracketBoardSelector("pbbs-continue"),!1):27==e.which?(BBAT.killDOMEvent(e),APP.header.handleBracketBoardSelector("pbbs-reset"),!1):void 0})),$("#pbbs-board-id").val(bi).blur();try{var tn=sess.tournaments[sess.tournament_id].match_description;$("#pbbs-tournament-label").text(tn)}catch(e){}sess.isUserMatchesOnly()||($("#popup-bracket-board-selector-overlay").show(0),$("#popup-bracket-board-selector").show(0)),APP.server.getDCTVTourneyInfo(sess.tournament_id)},handleTournamentEventType:function(in_id){var et=APP.extractLastSegment(in_id).toUpperCase();APP.session.setTournamentEventType(et),APP.session.store(!0),APP.header.hideTournamentEventType(),APP.session.updateLegFormat()},hideTournamentEventType:function(){$("#popup-event-type").hide(0),$("#event-type-overlay").hide(0)},showTournamentEventType:function(){$("#event-type-overlay").show(0),$("#popup-event-type").show(0)},getTournamentEventTypeText:function(in_event_type){switch(in_event_type){case"TM":return"Tournament Match";case"SM":return"Side Darts";case"WE":return"Women's Event";case"Y":return"Youth";default:return"Unknown"}},showSetSetupSection:function(in_advanced,in_advanced_button,in_game_start){var html,mf=APP.session.getMatchFormat()||{},mm=APP.session.getMatchMode(),uo=APP.user_options;APP.session.matches[APP.session.current_match];if($(".pssm-section").hide(0),$("#pssm-tournament-section").hide(0),$("#pssm-advanced-tournament-type").hide(0),$("#pssm-advanced-tournament-type-button").hide(0),$("#pssm-matchplay-section").hide(0),$("#pssm-non-tournament-section").hide(0),$("#pmsm-game-types").show(0),$("#pmsm-league-points").hide(0),$("#pssm-league-points").hide(0),$("#pssm-suppress-points").hide(0),$("#pssm-game-points").hide(0),$("#pssm-set-points").hide(0),$("#pmsm-advanced").hide(0),$("#pssm-money-round").hide(0),$("#pmsm-singles-options").hide(0),$(".pmsm-alt-option").hide(0),$("#pmsm-bottom-controls").show(0),"TOURNAMENT"==mm?APP.device.disableButton("pssm-close"):APP.device.enableButton("pssm-close"),APP.session.isBracketPracticeMatch()&&(mm="PLAY"),"TOURNAMENT"==mm&&!uo.tournament_mode&!APP.session.isBracketMatch())$("#pssm-title").html("Select Tournament Type"),$("#pssm-advanced-tournament-type-button").show(0),$(".pssm-tournament-types").removeClass("button-gold").addClass("button-gray").show(0),$("#pmsm-bottom-controls").hide(0),$("#pssm-tournament-section").show(0),$("#pssm-tournament-section p").show(0),$("#pssm-advanced-menu").show(0),$("#pmsm-game-types").hide(0);else if(in_advanced){switch(mm){case"TOURNAMENT":APP.header.updateSameGameButtons(mf.same_game),APP.header.updateTournamentFormatButtons(),$("#pssm-tournament-section").show(0),$("#pssm-tournament-section p").hide(0),"SETPLAY"==uo.tournament_mode?(APP.device.enableButton("pmsm-same-legs"),$("#pssm-non-tournament-section").show(0),APP.header.updateSetLimitButtons(mf.sets?"pmsm-set-"+mf.sets.mode.toLowerCase():null),$("#pmsm-set-limit").val(mf.sets?mf.sets.limit:""),APP.header.updateSameLegsButton(mf.same_legs),APP.header.updateLegLimitButtons(mf.legs?"pmsm-leg-"+mf.legs.mode.toLowerCase():null),$("#pssm-set-number").html("1"),$("#pssm-leg-number").html("2"),$("#pssm-game-number").html("3"),$("#pssm-player-number").html("4")):(APP.device.disableButton("pmsm-same-legs"),$("#pssm-player-number").html("2")),"MATCHPLAY"==uo.tournament_mode&&($("#pssm-matchplay-section").show(0),$("#pmsm-ms-limit").val(uo.tournament_leg_max?uo.tournament_leg_max:"")),$("#pmsm-singles-options").show(0),APP.header.updateNextGameButtons(mf.next_game?"pmsm-"+mf.next_game.toLowerCase():null),"ALTERNATE"==mf.next_game&&mf.next_game_options&&(APP.header.updateNextGameOptionButtons("pmsm-random-start",mf.next_game_options.random_start),APP.header.updateNextGameOptionButtons("pmsm-cork-first",mf.next_game_options.cork_first),APP.header.updateNextGameOptionButtons("pmsm-cork-last",mf.next_game_options.cork_last));break;case"SINGLES":case"TEAM":$("#pssm-non-tournament-section").show(0),$("#pmsm-league-points").show(0),APP.header.updateSameGameButtons(mf.same_game),APP.header.updateSameLegsButton(mf.same_legs),APP.header.setPointsStyleButton("pmsm-point-"+APP.session.getSetPointsStyle().toLowerCase()),APP.header.updateSetLimitButtons(mf.sets?"pmsm-set-"+mf.sets.mode.toLowerCase():null),$("#pmsm-set-limit").val(mf.sets?mf.sets.limit:""),APP.header.updateLegLimitButtons(mf.legs?"pmsm-leg-"+mf.legs.mode.toLowerCase():null),$("#pmsm-singles-options").show(0),APP.header.updateNextGameButtons(mf.next_game?"pmsm-"+mf.next_game.toLowerCase():null),"ALTERNATE"==mf.next_game&&mf.next_game_options&&(APP.header.updateNextGameOptionButtons("pmsm-random-start",mf.next_game_options.random_start),APP.header.updateNextGameOptionButtons("pmsm-cork-first",mf.next_game_options.cork_first),APP.header.updateNextGameOptionButtons("pmsm-cork-last",mf.next_game_options.cork_last)),$("#pssm-set-number").html("1"),$("#pssm-leg-number").html("2"),$("#pssm-game-number").html("3"),$("#pssm-points-number").html("4"),$("#pssm-player-number").html("5");break;default:$("#pssm-non-tournament-section").show(0),APP.header.updateSameGameButtons(mf.same_game),APP.header.updateSameLegsButton(mf.same_legs),APP.header.updateSetLimitButtons(mf.sets?"pmsm-set-"+mf.sets.mode.toLowerCase():null),$("#pmsm-set-limit").val(mf.sets?mf.sets.limit:"");var mfLegsMode="";void 0!==mf.legs&&mf.legs&&((mfLegsMode=mf.legs.mode)||(mfLegsMode="")),APP.header.updateLegLimitButtons(mf.legs?"pmsm-leg-"+mfLegsMode.toLowerCase():null),$("#pmsm-singles-options").show(0),APP.header.updateNextGameButtons(mf.next_game?"pmsm-"+mf.next_game.toLowerCase():null),"ALTERNATE"==mf.next_game&&mf.next_game_options&&(APP.header.updateNextGameOptionButtons("pmsm-random-start",mf.next_game_options.random_start),APP.header.updateNextGameOptionButtons("pmsm-cork-first",mf.next_game_options.cork_first),APP.header.updateNextGameOptionButtons("pmsm-cork-last",mf.next_game_options.cork_last)),$("#pssm-set-number").html("1"),$("#pssm-leg-number").html("2"),$("#pssm-game-number").html("3"),$("#pssm-player-number").html("4")}$("#pssm-advanced-menu").show(0)}else{$(".pssm-option").removeClass("button-red").addClass("button-gray"),APP.session.lockMatchFormat()||"PARTICIPANT"==APP.device.role||APP.session.isBracketOfficialMatch()?APP.session.isBracketOfficialMatch()?APP.device.enableButton("pssm-advanced",!0):APP.device.disableButton("pssm-advanced"):APP.device.enableButton("pssm-advanced",!0),$("#pssm-standard-legs").hide(0),$("#pssm-special-legs").hide(0);var is_special=!1;switch(jQuery.isEmptyObject(mf.legs)&&(mf.legs={limit:null}),mf.legs&&"PLAY-ALL"==mf.legs.mode||"ROUND ROBIN"==APP.user_options.tournament_mode?"BEST-OF"===mf.legs.mode&&"ROUND ROBIN"===mf.event_type?mf.legs&&mf.legs.limit&&1!=mf.legs.limit&&3!=mf.legs.limit&&5!=mf.legs.limit&&7!=mf.legs.limit&&9!=mf.legs.limit&&11!=mf.legs.limit&&(is_special=!0):mf.legs&&mf.legs.limit&&1!=mf.legs.limit&&2!=mf.legs.limit&&3!=mf.legs.limit&&4!=mf.legs.limit&&5!=mf.legs.limit&&6!=mf.legs.limit&&(is_special=!0):mf.legs&&"BEST-OF"==mf.legs.mode&&("TOURNAMENT"==mm?mf.legs&&mf.legs.limit&&1!=mf.legs.limit&&3!=mf.legs.limit&&5!=mf.legs.limit&&7!=mf.legs.limit&&9!=mf.legs.limit&&11!=mf.legs.limit&&(is_special=!0):mf.legs&&mf.legs.limit&&1!=mf.legs.limit&&3!=mf.legs.limit&&5!=mf.legs.limit&&9!=mf.legs.limit&&7!=mf.legs.limit&&11!=mf.legs.limit&&(is_special=!0)),in_game_start&&mf.same_legs&&mf.legs.limit&&!APP.session.isNewMatch()?($("#pssm-special-legs").hide(0),$("#pssm-standard-legs").hide(0),$("#pssm-set-other").hide(0)):is_special?(mf.legs&&"PLAY-ALL"==mf.legs.mode||"ROUND ROBIN"==APP.user_options.tournament_mode?"BEST-OF"===mf.legs.mode&&"ROUND ROBIN"===mf.event_type?$("#pssm-set-special").html("Best of "+mf.legs.limit):$("#pssm-set-special").html("Play "+mf.legs.limit+" Legs"):$("#pssm-set-special").html("Best of "+mf.legs.limit),$("#pssm-special-legs").show(0)):(mf.legs&&"PLAY-ALL"==mf.legs.mode||"ROUND ROBIN"==APP.user_options.tournament_mode?"BEST-OF"===mf.legs.mode&&"ROUND ROBIN"===mf.event_type?APP.header.switchQuickLegs("BEST-OF"):APP.header.switchQuickLegs("PLAY-ALL"):APP.header.switchQuickLegs("BEST-OF"),$("#pssm-standard-legs").show(0)),mm){case"TOURNAMENT":$("#pssm-set-1").show(0),$("#pssm-set-9").hide(0),APP.session.isBracketMatch()||"Group"===!APP.session.getTournamentType()&&($("#pssm-money-round").show(0),APP.header.updateMatchMoneyButton());break;case"SINGLES":case"TEAM":switch($("#pssm-set-1").show(0),mf.points_style){case"VARIES":$("#pssm-league-points").show(0),APP.header.setLeaguePointButtons(mf.points_style,APP.session.getSetPoints());break;case"PER-LEG":$("#pssm-game-points").show(0);break;case"PER-SET":$("#pssm-set-points").show(0);break;case"PER-SET-PLAYER":$("#pssm-suppress-points").text("League Points: Team Size").show(0);break;case"MATCH_WINS_1_WIN_.5_TIE":case"MATCH_WINS_2_WIN_1_TIE":case"MATCH_WINS_3_WIN_1_TIE":$("#pssm-suppress-points").text("Premier Points").show(0);break;default:$("#pssm-suppress-points").show(0)}break;default:$("#pssm-set-1").show(0)}if(APP.device.enableButtonClass("pssm-set-option",!0),$("#pssm-legs-label").removeClass("text-gray"),mf&&mf.legs&&("PLAY-ALL"==mf.legs.mode?$("#pssm-set-pa-"+mf.legs.limit).removeClass("button-gray").addClass("button-red"):$("#pssm-set-"+mf.legs.limit).removeClass("button-gray").addClass("button-red")),uo.tournament_mode||mf.sets||mf.legs||mf.next_game||mf.points_style||mf.same_legs){if(html="<ul>","TOURNAMENT"==mm)switch(uo.tournament_mode){case"ROUND ROBIN":html+="<li>Round Robin</li>";break;case"ELIMINATION":html+="<li>Elimination / Knock Out</li>";break;case"SETPLAY":html+="<li>Set Play</li>";break;case"MATCHPLAY":html+="<li>Matchplay - Win by 2",uo.tournament_leg_max?html+="<div>Max "+uo.tournament_leg_max+"</div></li>":html+="</li>"}else mf.sets?html+="<li>"+("PLAY-ALL"==mf.sets.mode?"Play ":"Best of ")+mf.sets.limit+" Sets<div>Set "+(APP.session.current_set+1)+"</div></li>":html+="<li>Sets: No Limit<div>Set "+(APP.session.current_set+1)+"</div></li>";mf.same_legs&&mf.legs&&in_game_start&&!APP.session.isNewMatch()&&(html+="<li>"+("PLAY-ALL"==mf.legs.mode?"Play ":"Best of ")+mf.legs.limit+" Legs</li>"),"ALTERNATE"==mf.next_game?(html+="<li>Alternate</li>",mf.next_game_options&&mf.next_game_options.random_start&&mf.next_game_options.cork_last?html+="<li>Random Start &amp; Cork Last Match Leg</li>":mf.next_game_options&&mf.next_game_options.random_start?html+="<li>Random Start</li>":mf.next_game_options&&mf.next_game_options.cork_first&&mf.next_game_options.cork_last?html+="<li>Cork First &amp; Last Match Leg</li>":mf.next_game_options&&mf.next_game_options.cork_first?html+="<li>Cork First Match Leg</li>":mf.next_game_options&&mf.next_game_options.cork_last&&(html+="<li>Cork Last Match Leg</li>")):"CORK"==mf.next_game&&(html+="<li>Cork All Games Starts</li>"),html+="</ul>"}else html='<div style="padding-top:2.0em;">No Settings</div>';APP.header.setContinueButton(),$("#pssm-format").html(html),$("#pssm-basic-menu").show(0)}},hideSetSetup:function(){$("#popup-set-setup-menu").hide(0),$("#set-setup-menu-overlay").hide(0)},has_seen_legs_menu:!1,showSetSetup:function(in_params){var mf=APP.session.getMatchFormat()||{};in_params=in_params||{},APP.header.has_seen_legs_menu?APP.header.hideSetSetup():APP.session.isNewMatch()||!in_params.game_start||!mf.points_style&&APP.session.isLeaguePlay()||!mf.same_legs||!mf.legs||null==mf.legs.limit?(APP.device.pauseKeyboardHandler(),APP.header.set_setup_callback=in_params.callback||null,$(".pmsm-input").on("focus",(function(e){$("#"+e.target.id).val("")})),$(".pmsm-input").on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.header.handleSetSetup("kb-enter"),!1):27==e.which?(BBAT.killDOMEvent(e),APP.header.handleSetSetup("pmsm-reset","5"),!1):void 0})),"TOURNAMENT"==APP.session.getMatchMode()?($("#pssm-title").html("Tournament Settings"),$("#pmsm-reset").html("Reset")):APP.session.isLeaguePlay()?(APP.session.currentLeagueIsGroup()?$("#pssm-title").html("Match Settings"):$("#pssm-title").html("League Settings"),$("#pmsm-reset").html("Restore Defaults")):($("#pssm-title").html("Match Settings"),$("#pmsm-reset").html("Reset")),APP.header.showSetSetupSection(in_params.advanced_only,!1,in_params.game_start),$("#set-setup-menu-overlay").show(0),$("#popup-set-setup-menu").show(0)):APP.header.hideSetSetup()},setPointsStyleButton:function(in_id){$(".pmsm-points-option").removeClass("button-red").addClass("button-gray"),APP.session.isFirstSet()||(APP.session.isSuppressPoints()?(APP.device.disableButtonClass("pmsm-points-option"),APP.device.enableButton("pmsm-point-suppress")):(APP.device.enableButtonClass("pmsm-points-option"),APP.device.disableButton("pmsm-point-suppress"))),$("#"+in_id).removeClass("button-gray").addClass("button-red")},updateSameLegsButton:function(in_same){in_same?($("#pmsm-same-legs").removeClass("button-gray").addClass("button-red"),$("#pmsm-select-legs").removeClass("button-red").addClass("button-gray")):($("#pmsm-same-legs").removeClass("button-red").addClass("button-gray"),$("#pmsm-select-legs").removeClass("button-gray").addClass("button-red"))},updateSameGameButtons:function(in_option){if($(".pmsm-game-option").removeClass("button-red").addClass("button-gray"),!0!==in_option)switch(in_option){case"PER-MATCH":case"pmsm-per-match":$("#pmsm-per-match").removeClass("button-gray").addClass("button-red");break;case"PER-SET":case"pmsm-per-set":$("#pmsm-per-set").removeClass("button-gray").addClass("button-red");break;case"PER-LEG":case"pmsm-per-leg":default:$("#pmsm-per-leg").removeClass("button-gray").addClass("button-red")}else $("#pmsm-per-match").removeClass("button-gray").addClass("button-red")},updateTournamentFormatButtons:function(){var uo=APP.user_options;$(".pssm-tournament-types").removeClass("button-gold").addClass("button-gray").hide(0),uo.tournament_mode&&"ELIMINATION"==uo.tournament_mode?$("#pssm-elimination").removeClass("button-gray").addClass("button-gold").show(0):uo.tournament_mode&&"ROUND ROBIN"==uo.tournament_mode?$("#pssm-round-robin").removeClass("button-gray").addClass("button-gold").show(0):uo.tournament_mode&&"MATCHPLAY"==uo.tournament_mode?$("#pssm-match-play").removeClass("button-gray").addClass("button-gold").show(0):uo.tournament_mode&&"SETPLAY"==uo.tournament_mode&&$("#pssm-set-play").removeClass("button-gray").addClass("button-gold").show(0)},updateNextGameOptionButtons:function(in_id,in_on){var el;in_id?(el=$("#"+in_id),in_on?(el.hasClass("pmsm-alt-first-option")&&$(".pmsm-alt-first-option").removeClass("button-red").addClass("button-gray"),el.removeClass("button-gray").addClass("button-red")):el.removeClass("button-red").addClass("button-gray")):$(".pmsm-alt-option").removeClass("button-red").addClass("button-gray")},updateNextGameButtons:function(in_id){switch($(".pmsm-next-game-option").removeClass("button-red").addClass("button-gray"),in_id){case"pmsm-alternate":$("#pmsm-alternate").removeClass("button-gray").addClass("button-red"),$("#pmsm-cork").hide(0),$("#pmsm-menu").hide(0),$("#pmsm-select").hide(0),$(".pmsm-alt-option").show(0);break;case"pmsm-cork":APP.header.updateNextGameOptionButtons(),$("#pmsm-cork").removeClass("button-gray").addClass("button-red");break;case"pmsm-menu":APP.header.updateNextGameOptionButtons(),$("#pmsm-menu").removeClass("button-gray").addClass("button-red");break;default:$("#pmsm-alternate").show(0),$("#pmsm-cork").show(0),$("#pmsm-menu").show(0),$("#pmsm-select").show(0),$(".pmsm-alt-option").hide(0),$("#pmsm-select").removeClass("button-gray").addClass("button-red")}},updateLegLimitButtons:function(in_id){$(".pmsm-leg-option").removeClass("button-red").addClass("button-gray"),in_id&&$("#"+in_id).removeClass("button-gray").addClass("button-red")},updateSetLimitButtons:function(in_id){$(".pmsm-set-option").removeClass("button-red").addClass("button-gray"),in_id&&$("#"+in_id).removeClass("button-gray").addClass("button-red")},backupProfile:function(){var t_len,i,hdr=APP.header,temp=[];function addTeam(in_team_index){var i,p_len,t,p,team,player;for(team=hdr.teams[in_team_index],(t={}).obj_id=team.obj_id,t.team_name=team.team_name,t.chalkboard_name=team.chalkboard_name,t.email=team.email,t.is_default=team.is_default,t.players=[],p_len=team.players.length,i=0;i<p_len;i++)(player=team.players[i]).is_temp_player||(p={},$.extend(p,player),t.players.push(p));return t}for(t_len=hdr.teams.length,i=0;i<t_len;i++)temp.push(addTeam(i));APP.server.backupProfile({library:temp},(function(in_response){"OK"==in_response.status?(APP.header.directory_edit_date=null,APP.header.directory_backup_date=in_response.payload.update_date,APP.device.disableButton("pol-backup"),APP.alert.show("Player and Team Library<br />backup successful")):(APP.recordError("(backupProfile) "+in_response.status_text),APP.alert.show("Library backup failed...<br />"+in_response.status_text))}))},restoreProfile:function(){function format(in_date){BBAT.getDayName(in_date);return in_date.toLocaleDateString()+" at "+in_date.toLocaleTimeString()}APP.server.restoreProfile((function(in_response){if("OK"==in_response.status){var killed,prompt,pl=JSON.parse(in_response.payload),tl=JSON.parse(pl.players_lib_json),ud=new Date(pl.update_date),lbd=APP.header.directory_backup_date?new Date(APP.header.directory_backup_date):null,led=APP.header.directory_edit_date?new Date(APP.header.directory_edit_date):null,t=APP.header.teams[0];led&&lbd?prompt='This device Player and Team Library was backed-up on<br /><span style="color:red;font-size:0.7em;font-weight:bold;">'+format(lbd)+'</span><br />and last edited on<br /><span style="color:red;font-size:0.7em;font-weight:bold;">'+format(led)+"</span>":led?prompt='This device Player and Team Library was last edited on<br /><span style="color:red;font-size:0.7em;font-weight:bold;">'+format(led)+"</span>":lbd&&(prompt='This device Player and Team Library was last backed-up on<br /><span style="color:red;font-size:0.7em;font-weight:bold;">'+format(lbd)+"</span>"),prompt+='<br />&nbsp;<br />Do you want to <span style="font-weight:bold;">replace</span> it with a backup copy from <br /><span style="color:red;font-size:0.7em;font-weight:bold;">'+format(ud)+"</span>?",APP.confirm.show({msg:prompt,ok_text:"Yes",cancel_text:"No",ok:function(){for(APP.header.teams.length=1,killed=0,len=t.players.length,i=0;i<len;i++)t.players[i-killed].is_temp_player||(t.players.splice(i-killed,1),killed++);for(len=tl[0].players.length,i=0;i<len;i++)t.addPlayer(tl[0].players[i]);t.sort();for(var len=tl.length,i=1;i<len;i++)APP.header.teams.push(APP.game.cloneTeam(tl[i]));APP.header.directory_type="USER",APP.header.league_definition=null,APP.header.directory_edit_date=null,APP.header.directory_backup_date=ud,APP.header.storeDirectory(),APP.header.refreshOpponentLibrary(),APP.alert.show("Player and Team Library<br />download successful")}})}else-1==in_response.status_text.indexOf("profile not found")&&APP.recordError("(restoreProfile) "+in_response.status_text),APP.alert.show("Library restore failed...<br />"+in_response.status_text)}))},forceRestoreProfile:function(){APP.server.restoreProfile((function(in_response){if("OK"==in_response.status){APP.header.fetchDirectory();var killed,pl=JSON.parse(in_response.payload),tl=JSON.parse(pl.players_lib_json),ud=new Date(pl.update_date),t=APP.header.teams[0];for(APP.header.teams.length=1,killed=0,len=t.players.length,i=0;i<len;i++)t.players[i-killed].is_temp_player||(t.players.splice(i-killed,1),killed++);for(len=tl[0].players.length,i=0;i<len;i++)t.addPlayer(tl[0].players[i]);t.sort();for(var len=tl.length,i=1;i<len;i++)APP.header.teams.push(APP.game.cloneTeam(tl[i]));APP.header.directory_type="USER",APP.header.league_definition=null,APP.header.directory_edit_date=null,APP.header.directory_backup_date=ud,APP.header.storeDirectory(),APP.header.refreshOpponentLibrary(),APP.header.resetDirectory()}else-1==in_response.status_text.indexOf("profile not found")&&APP.recordError("(restoreProfile) "+in_response.status_text)}),!0)},setBackupRestoreButtons:function(){var ld=APP.header.league_definition;if(APP.isOffline())return APP.device.disableButton("pol-backup"),void APP.device.disableButton("pol-restore");ld?(APP.device.disableButton("pol-backup"),APP.device.disableButton("pol-delete"),$("#pol-restore").html("Reload Rosters")):"EDIT"==APP.header.library_mode||"DELETE"==APP.header.library_mode?(APP.device.disableButton("pol-backup"),APP.device.disableButton("pol-restore")):APP.header.directory_edit_date||!APP.header.directory_backup_date?(APP.device.enableButton("pol-backup",!0),APP.device.enableButton("pol-restore",!0)):(APP.device.disableButton("pol-backup"),APP.device.enableButton("pol-restore",!0))},removeFromOpponent:function(in_opponent,in_obj_id,in_dflt_team){var i,p,len;if("TEAM"==APP.header.opponent_type)in_opponent.team.obj_id==in_obj_id&&in_opponent.setTeam(in_dflt_team);else{for(len=(p=in_opponent.team.players).length,i=0;i<len;i++)if(p[i].obj_id==in_obj_id){p.splice(i,1);break}0==p.length&&in_opponent.setTeam(in_dflt_team)}},removeFromRoster:function(in_roster,in_obj_id,in_dflt_team){var i,p,len;if("TEAM"==APP.header.opponent_type)in_roster.team.obj_id==in_obj_id&&(in_roster.select_players=!1,in_roster.loadTeam(in_dflt_team));else{for(len=(p=in_roster.team.players).length,i=0;i<len;i++)if(p[i].obj_id==in_obj_id){p.splice(i,1);break}0==p.length&&(in_roster.loadTeam(in_dflt_team),in_roster.loadPlayers(in_dflt_team.players))}},handleLibraryOption:function(in_id){var dn,el,i,items,l,len,start_i,ld=APP.header.league_definition;function buildTempSelectList(in_clear_selection){var i,l,len;for(APP.header.temp_select_list={},len=(l=$(".pol-opponent-group")).length,i=0;i<len;i++)el=$("#"+l[i].id),APP.header.temp_select_list[el.data("obj_id")]=el.hasClass("menu-option-on");in_clear_selection&&$(".pol-opponent-group").removeClass("menu-option-on")}function doContinue(){for(i=start_i;i<len;i++)l[i].in_pool=l[i].is_temp_player||$("#pol-opponent-"+i).hasClass("menu-option-on"),l[i].in_pool||l[i].is_temp_player||(APP.header.removeFromRoster(APP.header.roster_left,l[i].obj_id,APP.game.dflt_host_team),APP.header.removeFromRoster(APP.header.roster_right,l[i].obj_id,APP.game.dflt_guest_team),APP.header.removeFromOpponent(APP.game.opponent[0],l[i].obj_id,APP.game.dflt_host_team),APP.header.removeFromOpponent(APP.game.opponent[1],l[i].obj_id,APP.game.dflt_guest_team));APP.header.storeDirectory(),APP.header.rebuildOpponentsPanel(),APP.popup.hide(),APP.header.setLibraryMode(),APP.header.temp_select_list={},APP.nlf.data.matchLoaded&&APP.nlf.autoSelectPlayers()}switch("TEAM"==APP.header.opponent_type?(l=APP.header.teams,start_i=1):(l=APP.header.teams[0].players,start_i=0),len=l.length,in_id){case"pol-info":APP.info.show("info-text-libraries","Manage Player/Team Library");break;case"pol-close":APP.header.rebuildOpponentsPanel(),APP.popup.hide(),APP.header.setLibraryMode(),APP.header.temp_select_list={};break;case"pol-backup":APP.confirm.show({msg:"Backing up will replace your existing Player and Team Library data on the DartConnect server.",ok_text:"Continue",ok:function(){APP.header.backupProfile()}});break;case"pol-restore":(ld=APP.header.league_definition)?APP.server.getLeagueDivisionDirectory({league_division_guid:ld.league_division_guid,season_status:ld.season_status,edit_date:null,spinner:!0,on_network_error:function(){APP.header.refreshOpponentLibrary()},on_success:function(in_payload){in_payload&&("TEAM"==ld.league_type&&in_payload.teams.unshift({}),APP.header.loadLeagueDivisionDirectory(in_payload),APP.header.storeDirectory()),APP.header.refreshOpponentLibrary()}}):APP.header.restoreProfile();break;case"pol-continue":"DELETE"==APP.header.library_mode?(items="TEAM"==APP.header.opponent_type?"teams":"players",0==$(".deletion-mark").length?APP.alert.show("No "+items+" have been marked for deletion.",null,!0):APP.confirm.show({msg:"Delete marked "+items+'?<br /><span style="font-style:italic;">CANNOT be undone!</span>',ok:function(){APP.header.directory_edit_date=new Date,$(".deletion-mark").each((function(indx,el){for(dn=$("#"+el.id).data("chalkboard_name"),len=l.length,i=start_i;i<len;i++)if(dn==l[i].chalkboard_name){APP.header.removeFromRoster(APP.header.roster_left,l[i].obj_id,APP.game.dflt_host_team),APP.header.removeFromRoster(APP.header.roster_right,l[i].obj_id,APP.game.dflt_guest_team),APP.header.removeFromOpponent(APP.game.opponent[0],l[i].obj_id,APP.game.dflt_host_team),APP.header.removeFromOpponent(APP.game.opponent[1],l[i].obj_id,APP.game.dflt_guest_team),l.splice(i,1);break}})),APP.header.storeDirectory(),APP.header.setLibraryMode(),APP.header.refreshOpponentLibrary(),APP.header.temp_select_list={}}})):!ld&&APP.header.directory_edit_date?APP.confirm.show({msg:"It appears you have made changes to your library, would you like to back it up?",ok:APP.header.backupProfile,ok_text:"Yes",cancel:doContinue,cancel_text:"Not Now"}):doContinue();break;case"pol-reset":"DELETE"==APP.header.library_mode?$(".deletion-mark").removeClass("deletion-mark"):$(".pol-opponent-group").removeClass("menu-option-on");break;case"pol-new":if(APP.nlf.data.matchLoaded)return void APP.alert.show("You cannot add a new team during a scheduled match. Please contact your league administrator.");APP.header.library_mode="ADD",buildTempSelectList(!0),"TEAM"==APP.header.opponent_type?APP.header.showTeamDetails():APP.header.showPlayerDetails(0);break;case"pol-edit":(el=$("#pol-edit")).toggleClass("button-gray").toggleClass("button-gold"),el.hasClass("button-gold")?(buildTempSelectList(!0),APP.header.setLibraryMode("EDIT")):(APP.header.setLibraryMode(),APP.header.refreshOpponentLibrary(),APP.header.temp_select_list={});break;case"pol-delete":(el=$("#pol-delete")).toggleClass("button-gray").toggleClass("button-gold"),el.hasClass("button-gold")?(buildTempSelectList(!0),APP.header.setLibraryMode("DELETE")):(APP.header.setLibraryMode(),APP.header.refreshOpponentLibrary(),APP.header.temp_select_list={});break;default:switch(APP.header.library_mode){case"EDIT":"TEAM"==APP.header.opponent_type?(APP.header.showTeamDetails(in_id),APP.header.refreshTeamRoster(APP.extractLastNumberSegment(in_id))):APP.header.showPlayerDetails(0,APP.extractLastNumberSegment(in_id));break;case"DELETE":(el=$("#"+in_id)).toggleClass("deletion-mark");break;default:if("TEAM"==APP.header.opponent_type&&!APP.session.isNewMatch())return;el=$("#"+in_id),i=APP.extractLastNumberSegment(in_id),el.toggleClass("menu-option-on")}}},setLibraryMode:function(in_mode){switch(APP.header.library_mode=in_mode||"SELECT",in_mode){case"EDIT":APP.device.disableButton("pol-reset"),APP.device.disableButton("pol-new"),APP.device.disableButton("pol-delete"),APP.device.disableButton("pol-continue"),APP.device.disableButton("pol-restore");break;case"DELETE":"TEAM"==APP.header.opponent_type?$("#pol-continue").html("Delete Teams").addClass("button-gold"):$("#pol-continue").html("Delete Players").addClass("button-gold"),APP.device.disableButton("pol-new"),APP.device.disableButton("pol-edit");break;default:$("#pol-continue").html("Continue").removeClass("button-gold"),APP.device.enableButton("pol-reset"),APP.device.enableButton("pol-new"),APP.device.enableButton("pol-edit"),APP.device.enableButton("pol-delete"),APP.device.enableButton("pol-continue"),APP.device.enableButton("pol-restore"),$("#pol-edit").removeClass("button-gold").addClass("button-gray"),$("#pol-delete").removeClass("button-gold").addClass("button-gray"),$(".deletion-mark").removeClass("deletion-mark")}APP.header.setBackupRestoreButtons()},refreshOpponentLibrary:function(){var col,cols,i,id,l,len,start_i,skip_count;for(APP.header.setBackupRestoreButtons(),"TEAM"==APP.header.opponent_type?(l=APP.header.teams,start_i=1,cols=2,$("#pol-list .menu-col-a").addClass("pol-team-col-a"),$("#pol-list .menu-col-b").addClass("pol-team-col-b"),$("#pol-list .menu-col-c").addClass("pol-team-col-c")):(l=APP.header.teams[0].players,start_i=0,cols=3,$("#pol-list .menu-col-a").removeClass("pol-team-col-a"),$("#pol-list .menu-col-b").removeClass("pol-team-col-b"),$("#pol-list .menu-col-c").removeClass("pol-team-col-c")),len=l.length,$("#pol-hint").text("").hide(0),"TEAM"==APP.header.opponent_type&&1==len&&$("#pol-hint").html('Use "New" to add Teams').show(0),"PLAYER"==APP.header.opponent_type&&1==len&&$("#pol-hint").html('Use "New" to add Players').show(0),$(".pol-opponent-group").remove(),skip_count=0,i=start_i;i<len;i++)if(l[i].is_bot||l[i].is_temp_player)skip_count++;else{switch((i-start_i-skip_count)%cols){case 0:col="#pol-column-a";break;case 1:col="#pol-column-b";break;case 2:col="#pol-column-c"}id="pol-opponent-"+i;var dataId=null;try{dataId=l[i].team_guid}catch(e){}$("#pol-opponent-x").clone(!0).appendTo(col).attr("id",id).attr("data-id",dataId).addClass("pol-opponent-group").data("chalkboard_name",l[i].chalkboard_name).data("obj_id",l[i].obj_id).removeClass("template"),"SELECT"==APP.header.library_mode&&(APP.header.temp_select_list.hasOwnProperty(l[i].obj_id)?APP.header.temp_select_list[l[i].obj_id]&&$("#"+id).addClass("menu-option-on"):l[i].in_pool&&$("#"+id).addClass("menu-option-on")),APP.device.addButtonHandler([id],APP.header.handleLibraryOption),"TEAM"==APP.header.opponent_type?($("#"+id+" .polo-line1").html(l[i].team_name),$("#"+id+" .polo-line2").html("&nbsp;")):($("#"+id+" .polo-line1").html(l[i].first_name),$("#"+id+" .polo-line2").html(l[i].last_name))}for(i=(len-skip_count)%cols;i>0&&i<cols;i++){switch(i){case 1:col="#pol-column-b";break;case 2:col="#pol-column-c"}$("#pol-filler-x").clone(!0).appendTo(col).removeAttr("id").addClass("pol-opponent-group").removeClass("template")}APP.nlf.data.matchLoaded&&APP.nlf.hideNonActiveTeams()},showPlayerLookup:function(){var hdr=APP.header,srvr=APP.server;$("#opponents-panel").hide(0),$("#popup-player-lookup-overlay").show(0),$("#popup-player-lookup").show(0),hdr.resetPlayerLookup(),$("#ppl-search-name").focus().val("").on("input",(function(e){var sn=$("#ppl-search-name").val(),se=$("#ppl-search-email").val();sn&&sn.length>=2?srvr.lookupEmail(sn,se,hdr.updatePlayerLookup):hdr.resetPlayerLookup()})),$("#ppl-search-email").val("").on("input",(function(e){var sn=$("#ppl-search-name").val(),se=$("#ppl-search-email").val();se&&se.length>=2?srvr.lookupEmail(sn,se,hdr.updatePlayerLookup):hdr.resetPlayerLookup()}))},hidePlayerLookup:function(){APP.header.resetPlayerLookup(),$("#ppl-search-name").off("input").val("").blur(),$("#ppl-search-email").off("input").val("").blur(),$("#popup-player-lookup").hide(0),$("#popup-player-lookup-overlay").hide(0),APP.device.showSpinnerOverlay(),setTimeout((function(){$("#opponents-panel").show(0),APP.header.rebuildOpponentsPanel(),APP.device.hideSpinnerOverlay()}),150)},resetPlayerLookup:function(){APP.header.lookup_players.length=0,APP.device.disableButton("ppl-select-0"),$("#ppl-message").text(""),$(".ppl-name").text(""),$(".ppl-email").text("")},updatePlayerLookup:function(in_data){var len,i,hdr=APP.header;if(hdr.resetPlayerLookup(),$("#ppl-message").text(in_data.count+(1==in_data.count?" match":" matches")+" found"),in_data.emails.length)for(hdr.lookup_players=in_data.emails,len=hdr.lookup_players.length,i=0;i<len;i++)$("#ppl-name-"+i).text(hdr.lookup_players[i].last_name+", "+hdr.lookup_players[i].first_name),hdr.lookup_players[i].handle?$("#ppl-email-"+i).text(hdr.lookup_players[i].handle.toUpperCase()):$("#ppl-email-"+i).text(hdr.lookup_players[i].email.split("@")[0].toLowerCase()+"@");1==in_data.emails.length&&APP.device.enableButton("ppl-select-0",!0)},handlePlayerLookup:function(in_id){var i,er,hdr=APP.header;switch(in_id){case"ppl-close":hdr.hidePlayerLookup();break;case"ppl-add":hdr.resetPlayerLookup(),$("#ppl-search-email").val("").focus(),$("#ppl-search-name").val("").focus(),APP.header.showAddPlayer();break;case"ppl-select-0":default:i=APP.extractLastNumberSegment(in_id),er=hdr.lookup_players[i],APP.confirm.show({msg:"Is <br>&nbsp;<br>"+er.first_name+" "+er.last_name+'<br><span class="text-red">'+er.email+"</span><br>&nbsp;<br>correct?",ok_text:"Yes",cancel_text:"No",ok:function(){$("#ppl-search-email").focus().val(""),$("#ppl-search-name").focus().val(""),hdr.resetPlayerLookup(),er.first_name&&er.last_name?APP.header.teams[0].isValidNewLookupPlayer(er.email)&&(APP.header.teams[0].addPlayer({first_name:er.first_name,last_name:er.last_name,chalkboard_name:"TOURNAMENT"==APP.session.getMatchMode()?er.last_name:er.first_name+" "+er.last_name.left(1),email:er.email,in_pool:!0,is_temp_player:!0}),APP.header.teams[0].sort(),APP.header.storeDirectory(),"TOURNAMENT"==APP.session.getMatchMode()?(APP.header.rebuildOpponentsPanel(),APP.server.addTournamentPlayer({first_name:er.first_name,last_name:er.last_name,chalkboard_name:er.last_name,email:er.email})):APP.header.rebuildOpponentsPanel()):($("#pat-first-name").val(er.first_name),$("#pat-last-name").val(er.last_name),$("#pat-chalkboard-name").val(""),$("#pat-email").val(er.email),APP.header.showAddPlayer())}})}},deselectTeams:function(){var i,i_len;for(i_len=APP.header.teams.length,i=0;i<i_len;i++)APP.header.teams[i].in_pool=!1},deselectPlayers:function(){var i,len,p,t=APP.header.teams[0];for(len=t.players.length,i=0;i<len;i++)(p=t.players[i]).is_temp_player?p.in_pool=!0:p.in_pool=!1},loadTournamentDirectory:function(in_players){var len,ip,p,i,t,wrong_cn;for(APP.header.directory_edit_date=null,APP.header.directory_backup_date=null,APP.header.directory_type="TOURNAMENT",APP.header.league_definition=null,APP.header.teams.length=0,APP.header.teams.push(new APP.game.Team({obj_id:"TOURNAMENT"})),t=APP.header.teams[0],len=in_players?in_players.length:0,i=0;i<len;i++)wrong_cn=(ip=in_players[i]).chalkboard_name==ip.last_name+", "+ip.first_name,p={},APP.session.isBracketMatch()&&ip.id&&(p.obj_id="P"+ip.id),p.player_guid=ip.id,p.first_name=ip.first_name,p.last_name=ip.last_name,p.chalkboard_name=ip.chalkboard_name&&!wrong_cn?ip.chalkboard_name:ip.last_name,p.email=ip.email,p.in_pool=!0,p.is_temp_player=!0,p.last_active_date=ip.last_active_date,p.iso2_country=null,ip.iso2_country&&(p.iso2_country=ip.iso2_country),p.iso3_country=null,ip.iso3_country&&(p.iso3_country=ip.iso3_country),p.country_name=null,ip.country_name&&(p.country_name=ip.country_name),t.addPlayer(p);t.sort(),t.addPlayer(APP.game.dartbot),APP.header.storeDirectory()},loadLeagueDivisionDirectory:function(in_payload,forceKey){var i,i_len,j,j_len,p,pt,t,offset_i,ht=APP.header.teams;if(!(ld=APP.session.getLeagueDefinition(APP.session.getMatchLeagueKey()))&&forceKey)var ld=APP.session.getLeagueDefinition(forceKey);if(APP.header.directory_type="LEAGUE",APP.header.league_definition=ld,APP.header.directory_edit_date=in_payload.directory_edit_date,APP.header.directory_backup_date=null,(ht=APP.header.teams).length=0,"TEAM"==ld.league_type)for(i=in_payload.teams.length-1;i>=1;i--)in_payload.teams[i].team_guid||in_payload.teams.splice(i,1);for("TEAM"==ld.league_type?(ht.push({}),offset_i=1):offset_i=0,i_len=(pt=in_payload.teams)?pt.length:0,i=offset_i;i<i_len;i++)for((t=pt[i]).chalkboard_name=t.team_name,ht.push(new APP.game.Team(t)),j_len=t.players.length,j=0;j<j_len;j++)(p=t.players[j]).in_pool=!0,"NULL"==p.email&&(p.email=null),p.nickname&&!APP.session.isLeaguePlay()?p.chalkboard_name=p.nickname:p.chalkboard_name=p.first_name+" "+p.last_name.left(1),ht[i].players.push(new APP.game.Player(p))},killTempPlayers:function(){if(APP.header.teams){var len,i,killed,t=APP.header.teams[0];if(!APP.isFeatureBlocked("killTempPlayers")){for(killed=0,len=t&&t.players?t.players.length:0,i=0;i<len;i++)t.players[i-killed].is_temp_player&&(t.players.splice(i-killed,1),killed++);killed>1&&APP.header.storeDirectory()}}},email_editor_object:null,email_editor_team_index:null,showAddPlayer:function(in_team_index,in_obj_id){var o,i,t_len,hdr=APP.header;APP.header.league_definition;if(APP.device.pauseKeyboardHandler(),$("#popup-add-temp").on("keydown",(function(e){return 13==e.which?(APP.header.handleAddPlayer("pat-add"),BBAT.killDOMEvent(e)):27==e.which?(APP.header.handleAddPlayer("pat-close"),BBAT.killDOMEvent(e)):void 0})),$("#pat-mark-temp").removeClass("button-gold").addClass("button-gray"),"TOURNAMENT"==APP.session.getMatchMode()||null!=in_team_index?$("#pat-mark-temp").hide(0):$("#pat-mark-temp").show(0),null!=in_team_index)if("T"==in_obj_id.left(1)){for(t_len=hdr.teams.length,i=1;i<t_len;i++)if(hdr.teams[i].obj_id==in_obj_id){o=hdr.teams[i];break}hdr.email_editor_object=o,hdr.email_editor_team_index=in_team_index,$("#pat-first-name").val("x").hide(0),$("#pat-last-name").val(o.team_name).attr("placeholder","Team Name"),$("#pat-chalkboard-name").val(o.team_name),$("#pat-email").val(o.email?"**********":""),$("#pat-title").html("Team Info"),$("#pat-add").css("width","8em").html("Update Team"),$("#pat-remove").hide(0),$("#pat-add-left").hide(0),$("#pat-add-right").hide(0)}else o=hdr.teams[in_team_index].getPlayer(in_obj_id),hdr.email_editor_object=o,hdr.email_editor_team_index=in_team_index,$("#pat-first-name").val(o.first_name).show(0),$("#pat-last-name").val(o.last_name).attr("placeholder","Last Name"),$("#pat-chalkboard-name").val(o.chalkboard_name),$("#pat-email").val(o.email?"**********":""),$("#pat-title").html("Player Info"),$("#pat-add-left").hide(0),$("#pat-add-right").hide(0),"TOURNAMENT"==APP.session.getMatchMode()?($("#pat-add").css("width","5em").html("Update"),$("#pat-remove").hide(0)):($("#pat-add").css("width","8em").html("Update Player"),$("#pat-remove").hide(0));else hdr.email_editor_object=null,hdr.email_editor_team_index=in_team_index,$("#pat-first-name").show(0),$("#pat-last-name").attr("placeholder","Last Name"),$("#pat-title").html("TOURNAMENT"==APP.session.getMatchMode()?"Add Tournament Player":"Add New Player"),$("#pat-add").css("width","8em").html("Add Player"),$("#pat-remove").hide(0),$("#pat-add-left").show(0),$("#pat-add-right").show(0),$("#pat-first-name").val(""),$("#pat-last-name").val(""),$("#pat-chalkboard-name").val("");"TOURNAMENT"==APP.session.getMatchMode()&&($("#pat-first-name").attr("disabled","disabled").css("color","white"),$("#pat-last-name").attr("disabled","disabled").css("color","white"),$("#pat-email").attr("disabled","disabled").css("color","white"),$("#pat-gmail").hide(),$("#pat-hotmail").hide(),$("#pat-yahoo").hide(),$("#pat-aol").hide(),$("#pat-msn").hide(),$("#pat-icloud").hide(),$("#pat-comcast").hide(),$("#pat-sbcglobal").hide(),$("#pat-verizon").hide(),$("#pat-add").remove(),$("#pat-chalkboard-name").remove(),$("#pat-message").text("To make changes please see the Tournament Director")),$("#popup-add-temp-overlay").show(0),$("#popup-add-temp").show(0),hdr.email_editor_object?$("#pat-email").focus():$("#pat-first-name").focus()},handleAddPlayer:function(in_id){var fn,ln,dn,em,delim,hdr=APP.header,el_fn=$("#pat-first-name"),el_ln=$("#pat-last-name"),el_dn=$("#pat-chalkboard-name"),el_em=$("#pat-email"),el_msg=$("#pat-message"),el_pqco=$("#popup-add-temp-overlay"),el_pqc=$("#popup-add-temp"),ld=APP.header.league_definition;function reset(){el_msg.html(""),el_fn.val(""),el_ln.val(""),el_dn.val(""),el_em.val(""),el_fn.focus()}function finish(){$("#pat-input-container").off("keydown"),APP.device.resumeKeyboardHandler(),el_fn.val(""),el_ln.val(""),el_dn.val(""),el_em.val(""),el_fn.blur(),el_ln.blur(),el_dn.blur(),el_em.blur(),el_pqc.hide(0),el_pqco.hide(0),APP.header.email_editor_object=null,hdr.email_editor_team_index=null,APP.header.rebuildOpponentsPanel()}function addPlayer(in_side){var is_temp="TOURNAMENT"==APP.session.getMatchMode()||$("#pat-mark-temp").hasClass("button-gold"),obj_id=APP.header.teams[0].addPlayer({first_name:fn,last_name:ln,chalkboard_name:dn,email:em,in_pool:!0,is_temp_player:is_temp});if(APP.header.teams[0].sort(),is_temp||(APP.header.directory_edit_date=new Date),APP.header.storeDirectory(),fn&&ln&&"TOURNAMENT"==APP.session.getMatchMode()&&APP.server.addTournamentPlayer({first_name:fn,last_name:ln,chalkboard_name:dn,email:em}),in_side){if("left"==in_side)var roster=APP.header.roster_left;else roster=APP.header.roster_right;roster.getPlayerCount()<4&&roster.addPlayer({obj_id:obj_id})}reset()}function updatePlayer(){var o=APP.header.email_editor_object,ti=APP.header.email_editor_team_index;"T"==o.obj_id.left(1)?(o.last_name=ln,o.chalkboard_name=dn,o.email=em):(o.first_name.toLowerCase()==fn.toLowerCase()&&o.last_name.toLowerCase()==ln.toLowerCase()||(dn="TOURNAMENT"==APP.session.getMatchMode()?ln:fn+" "+ln.left(1)),o.first_name=fn,o.last_name=ln,o.chalkboard_name=dn,o.email=em,o.last_active_date=new Date,APP.header.teams[ti].sort()),o.is_temp_player||(APP.header.directory_edit_date=new Date),fn&&ln&&"TOURNAMENT"==APP.session.getMatchMode()&&APP.server.addTournamentPlayer({first_name:fn,last_name:ln,chalkboard_name:dn,email:em}),APP.header.storeDirectory(),ld&&o.player_guid&&APP.server.addUpdateLeaguePlayer({player_guid:o.player_guid,first_name:o.first_name,last_name:o.last_name,email:o.email?o.email:null}),reset(),finish()}switch(in_id){case"pat-close":finish();break;case"pat-info":$("#info-topic-player-details-gotit").hide(0),APP.info.show("info-topic-player-details");break;case"pat-remove":fn=el_fn.val().trim(),ln=el_ln.val().trim(),em=el_em.val().trim().toLowerCase(),function(){var i,i_len,tp,p,o=APP.header.email_editor_object;for(i_len=(tp=APP.header.teams[0].players).length,i=0;i<i_len;i++)if(tp[i].obj_id==o.obj_id){p=tp[i],tp.splice(i,1);break}APP.server.removeTournamentPlayer({first_name:p.first_name,last_name:p.last_name,email:p.email}),APP.header.storeDirectory()}(),reset(),finish();break;case"pat-add":case"pat-add-left":case"pat-add-right":fn=el_fn.val().trim(),ln=el_ln.val().trim(),dn=el_dn.val().trim(),em=el_em.val().trim().toLowerCase();var side=in_id.indexOf("right")>=0?"right":in_id.indexOf("left")>=0?"left":null;if(APP.header.email_editor_object&&em.indexOf("*")>=0&&(em=APP.header.email_editor_object.email),msg="",delim="",el_msg.html(""),fn.length||(msg=msg+delim+"First Name is required",delim=", "),ln.length||(msg=msg+delim+"Last Name is required",delim=", "),msg||dn||("TOURNAMENT"==APP.session.getMatchMode()?dn=ln:(dn=fn+" "+ln.left(1),APP.header.teams[0].isValidNewPlayer(dn)||(msg+=delim+dn+" already exists in your Player Library",delim=", "))),em.length&&!BBAT.isValidEmailFormat(em)&&(msg=msg+delim+"Invalid email format",delim=", "),!msg||(el_msg.html(msg),0))if(em&&em!=(APP.header.email_editor_object?APP.header.email_editor_object.email:"")){var msg='<span style="font-size:1.7em;">'+em.split("@")[0]+"</span><br />@"+em.split("@")[1];APP.header.league_definition&&(msg+='<p style="font-size:0.8em;color:red;margin:1.0em;">Player should confirm this email matches their DartConnect profile in the member site.</p>'),APP.confirm.show({title:"Confirm Email!",msg:msg,ok:function(){APP.header.email_editor_object?(updatePlayer(),finish()):(addPlayer(side),finish())}})}else APP.header.email_editor_object?(updatePlayer(),finish()):(addPlayer(side),finish());break;case"pat-mark-temp":$("#pat-mark-temp").toggleClass("button-gold").toggleClass("button-gray");break;case"pat-gmail":el_em.val(APP.cleanEmail(el_em.val())+"@gmail.com");break;case"pat-hotmail":el_em.val(APP.cleanEmail(el_em.val())+"@hotmail.com");break;case"pat-yahoo":el_em.val(APP.cleanEmail(el_em.val())+"@yahoo.com");break;case"pat-aol":el_em.val(APP.cleanEmail(el_em.val())+"@aol.com");break;case"pat-msn":el_em.val(APP.cleanEmail(el_em.val())+"@msn.com");break;case"pat-comcast":el_em.val(APP.cleanEmail(el_em.val())+"@comcast.net");break;case"pat-icloud":el_em.val(APP.cleanEmail(el_em.val())+"@icloud.com");break;case"pat-sbcglobal":el_em.val(APP.cleanEmail(el_em.val())+"@sbcglobal.net");break;case"pat-verizon":el_em.val(APP.cleanEmail(el_em.val())+"@verizon.net")}},addLobbyPlayer:function(player){player.is_temp_player=!0;var obj_id=APP.header.teams[0].addPlayer(player);return APP.header.teams[0].sort(),APP.header.storeDirectory(),obj_id},player_confirm_email:"",confirmPlayerEmail:function(in_id,in_callback){var hdr=APP.header,email=$("#ppd-email").val().trim().toLowerCase();hdr.player_confirm_email="";var msg='<span style="font-size:1.7em;">'+email.split("@")[0]+"</span><br />@"+email.split("@")[1];APP.header.league_definition&&(msg+='<p style="font-size:0.8em;color:red;margin:1.0em;">Player should confirm this email matches their DartConnect profile in the member site.</p>'),APP.confirm.show({title:"Confirm Email!",msg:msg,ok:function(){hdr.player_confirm_email=email,hdr.handlePlayerDetailOption(in_id,in_callback)}})},showPlayerDetails:function(in_team_index,in_player_index){var p,el_dn=$("#ppd-chalkboard-name"),el_fn=$("#ppd-first-name"),el_ln=$("#ppd-last-name"),el_em=$("#ppd-email"),el_msg=$("#ppd-message"),i=in_player_index;APP.header.league_definition;APP.device.pauseKeyboardHandler(),$("#popup-player-details").on("keydown",(function(e){return 13==e.which?(APP.header.handlePlayerDetailOption("none"==$("#ppd-update").css("display")?"ppd-add":"ppd-update"),BBAT.killDOMEvent(e)):27==e.which?(APP.header.handlePlayerDetailOption("ppd-close"),BBAT.killDOMEvent(e)):void 0})),APP.header.player_confirm_email="",el_dn.data("team_index",in_team_index),el_dn.data("player_index",in_player_index),$("#ppd-add").hide(0),$("#ppd-update").hide(0),$("#ppd-finished").hide(0),(p=APP.header.teams[in_team_index].getPlayer(i))?($("#ppd-update").show(0),el_fn.val(p.first_name),el_ln.val(p.last_name),el_dn.val(p.chalkboard_name),el_em.val(p.email?"**********":""),APP.header.player_confirm_email=p.email):($("#ppd-add").show(0),$("#ppd-finished").show(0),el_fn.val(""),el_ln.val(""),el_dn.val(""),el_em.val("")),APP.session.isLeaguePlay()||$("#ppd-league-message").hide(0),el_msg.html(""),$("#popup-player-overlay").show(0),APP.popup.show("popup-player-details"),el_fn.focus()},handlePlayerDetailOption:function(in_id,in_add_callback){var delim,fn,ln,msg,dn,em,pi,ti,t,el_fn=$("#ppd-first-name"),el_ln=$("#ppd-last-name"),el_msg=$("#ppd-message"),el_dn=$("#ppd-chalkboard-name"),el_em=$("#ppd-email"),el_po=$("#popup-player-overlay"),player_mode="PLAYER"==APP.header.opponent_type;function finish(){el_fn.blur(),APP.popup.hide("popup-player-details"),el_po.hide(0),el_fn.val(""),el_ln.val(""),el_dn.val(""),el_em.val(""),el_msg.html(""),el_dn.removeData("team_index"),el_dn.removeData("player_index"),"ADD"==APP.header.library_mode&&(APP.header.library_mode="SELECT"),APP.header.refreshOpponentLibrary(),APP.device.resumeKeyboardHandler()}switch(ti=el_dn.data("team_index"),t=APP.header.teams[ti],in_id){case"ppd-add":case"ppd-update":if(el_msg.html(""),fn=el_fn.val().trim(),ln=el_ln.val().trim(),dn=el_dn.val().trim(),em=el_em.val().trim().toLowerCase(),msg="",delim="",pi=el_dn.data("player_index"),!player_mode&&pi>=0&&!fn.length&&!ln.length&&!dn.length)return t.removePlayer(pi),APP.header.storeDirectory(),APP.header.refreshTeamRoster(ti),void finish();if(fn.length||(msg=msg+delim+"First Name is required",delim=", "),ln.length||(msg=msg+delim+"Last Name is required",delim=", "),em.indexOf("*")>=0&&(em=APP.header.player_confirm_email),em.length&&!BBAT.isValidEmailFormat(em)&&(msg=msg+delim+"Invalid email format",delim=", "),msg)el_msg.html(msg);else{if(APP.header.directory_edit_date=new Date,em&&em!=APP.header.player_confirm_email)return el_em.focus(),void APP.header.confirmPlayerEmail(in_id,in_add_callback);if(APP.header.player_confirm_email="",dn.length||(dn=fn+" "+ln.left(1),el_dn.val(dn)),"ppd-add"!=in_id||t.isValidNewPlayer(dn)){if(APP.header.directory_edit_date=new Date,"ppd-add"==in_id){t.obj_id,t.addPlayer({first_name:fn,last_name:ln,chalkboard_name:dn,email:em,in_pool:!0});if(t.sort(),"LEAGUE"==APP.header.directory_type&&em){var matchId=null;try{matchId=APP.nlf.data.matchId}catch(e){}APP.server.addLeaguePlayer({team_guid:t.team_guid,first_name:fn,last_name:ln,email:em,match_id:matchId,on_success:function(){APP.header.handleLibraryOption("pol-restore")}})}}else{if("LEAGUE"==APP.header.directory_type){var p=t.players[pi];p.player_guid&&APP.server.addUpdateLeaguePlayer({player_guid:p.player_guid,first_name:fn,last_name:ln,email:em||null})}t.updatePlayer({first_name:fn,last_name:ln,chalkboard_name:dn,email:em},pi),t.sort()}if(APP.header.storeDirectory(),player_mode)APP.header.refreshOpponentLibrary();else{if(APP.header.refreshTeamRoster(ti),!((pi=APP.header.teams[ti].players.length)<APP.header.max_players))return void finish();el_dn.data("player_index",pi-1)}el_fn.focus(),el_fn.val(""),el_ln.val(""),el_dn.val(""),el_em.val(""),"ppd-update"==in_id&&finish(),"function"==typeof in_add_callback&&in_add_callback()}else el_msg.html(dn+" already exists in your Player Library")}break;case"ppd-finished":el_fn.val().trim().length>0||el_ln.val().trim().length>0||el_dn.val().trim().length>0||el_em.val().trim().length>0?APP.header.handlePlayerDetailOption("ppd-add",finish):finish();break;case"ppd-gmail":el_em.val(APP.cleanEmail(el_em.val())+"@gmail.com");break;case"ppd-hotmail":el_em.val(APP.cleanEmail(el_em.val())+"@hotmail.com");break;case"ppd-yahoo":el_em.val(APP.cleanEmail(el_em.val())+"@yahoo.com");break;case"ppd-aol":el_em.val(APP.cleanEmail(el_em.val())+"@aol.com");break;case"ppd-msn":el_em.val(APP.cleanEmail(el_em.val())+"@msn.com");break;case"ppd-comcast":el_em.val(APP.cleanEmail(el_em.val())+"@comcast.net");break;case"ppd-icloud":el_em.val(APP.cleanEmail(el_em.val())+"@icloud.com");break;case"ppd-sbcglobal":el_em.val(APP.cleanEmail(el_em.val())+"@sbcglobal.net");break;case"ppd-verizon":el_em.val(APP.cleanEmail(el_em.val())+"@verizon.net");break;case"ppd-close":finish();break;case"ppd-info":$("#info-topic-player-details-gotit").hide(0),APP.info.show("info-topic-player-details")}},showTeamDetails:function(in_id){var i,el_dn=$("#ptd-chalkboard-name"),el_tn=$("#ptd-team-name"),el_em=$("#ptd-email"),el_msg=$("#ptd-message"),l=APP.header.teams;APP.header.league_definition;APP.device.setKeyboardHandler(null),$("#popup-team-details").on("keydown",(function(e){return 13==e.which?(APP.header.handleTeamDetailOption("ptd-ok"),BBAT.killDOMEvent(e)):27==e.which?(APP.header.handleTeamDetailOption("ptd-close"),BBAT.killDOMEvent(e)):void 0})),in_id?(i=APP.extractLastNumberSegment(in_id),APP.device.enableButton("ptd-add"),el_tn.val(l[i].team_name),el_dn.val(l[i].chalkboard_name),el_em.val(l[i].email?"**********":""),el_dn.data("team_index",i)):(APP.device.disableButton("ptd-add"),el_tn.val(""),el_dn.val(""),el_em.val("")),el_msg.html(""),$("#popup-overlay").show(0),APP.popup.show("popup-team-details"),el_tn.focus(),in_id?APP.header.refreshTeamRoster(APP.extractLastNumberSegment(in_id)):APP.header.refreshTeamRoster()},handleTeamDetailOption:function(in_id){var delim,len,tn,msg,new_ti,dn,em,ti,pi,el_tn=$("#ptd-team-name"),el_msg=$("#ptd-message"),el_dn=$("#ptd-chalkboard-name"),el_em=$("#ptd-email"),el_po=$("#popup-overlay"),l=APP.header.teams;function resetMessage(){el_msg.html("")}function finish(){$("#popup-team-details").off("keydown"),el_tn.blur(),APP.popup.hide("popup-team-details"),el_po.hide(0),el_tn.val(""),el_dn.val(""),el_em.val(""),el_dn.removeData("team_index"),resetMessage(),"ADD"==APP.header.library_mode&&(APP.header.library_mode="SELECT"),APP.header.refreshOpponentLibrary()}switch(in_id){case"ptd-ok":resetMessage(),tn=el_tn.val().trim(),dn=el_dn.val().trim(),em=el_em.val().trim().toLowerCase(),msg="",delim="",tn.length||(msg=msg+delim+"Team Name is required",delim=", "),msg?el_msg.html(msg):(dn.length||(dn=tn,el_dn.val(dn)),!function(in_chalkboard_name,in_team_index){var i;if("home"==in_chalkboard_name.toLowerCase()||"away"==in_chalkboard_name.toLowerCase())return!0;for(len=APP.header.teams.length,i=1;i<len;i++)if(in_team_index!=i&&l[i].chalkboard_name.toLowerCase()==in_chalkboard_name.toLowerCase())return!0;return!1}(dn,ti=el_dn.data("team_index"))?(new_ti=function(in_team_name,in_chalkboard_name,in_email,in_team_index){var i,t;for(APP.header.directory_edit_date=new Date,(i=in_team_index)>=0?((t=APP.game.cloneTeam(l[i])).chalkboard_name=in_chalkboard_name,t.team_name=in_team_name,t.email=in_email.indexOf("*")>=0?t.email:in_email||null,l.splice(i,1)):t=new APP.game.Team({chalkboard_name:in_chalkboard_name,team_name:in_team_name,email:in_email,in_pool:!1}),len=APP.header.teams.length,i=1;i<len;i++)if(in_team_name.toLowerCase()<l[i].team_name.toLowerCase())return l.splice(i,0,t),i;return l.push(t)-1}(tn,dn,em,ti),APP.device.enableButton("ptd-add"),APP.header.storeDirectory(),APP.header.refreshOpponentLibrary(),ti>=0?finish():(el_dn.data("team_index",new_ti),APP.header.refreshTeamRoster(new_ti))):el_msg.html(dn+" already exists in your Team Library"));break;case"ptd-close":finish();break;case"ptd-add":ti=el_dn.data("team_index"),APP.header.showPlayerDetails(ti);break;default:ti=el_dn.data("team_index"),pi=APP.extractLastNumberSegment(in_id),APP.header.showPlayerDetails(ti,pi)}},refreshTeamRoster:function(in_team_index){var i,p;for((p=in_team_index>=0?APP.header.teams[in_team_index].players:[]).length<APP.header.max_players?$("#ptd-add").show(0):$("#ptd-add").hide(0),i=0;i<APP.header.max_players;i++)p[i]?($("#ptd-p-name-"+i).text(p[i].first_name+" "+p[i].last_name).addClass("button").removeClass("ptd-p-empty"),$("#ptd-p-chalkboard-name-"+i).text(p[i].chalkboard_name).removeClass("ptd-p-empty")):($("#ptd-p-name-"+i).text("").removeClass("button").addClass("ptd-p-empty"),$("#ptd-p-chalkboard-name-"+i).text("").addClass("ptd-p-empty"))},resetScoreOptions:function(){var p;for(p in APP.header.score_both=!1,APP.header.score_options)delete APP.header.score_options[p]},setScoreOptions:function(in_options){var p;for(p in in_options)APP.header.score_options[p]=in_options[p]},startScoreEdit:function(){var o=APP.header.edit_opponent,cs=APP.game.opponent[o].getCurrentScore();APP.header.showPendingScore(o,cs),APP.device.setKeyboardHandler(APP.header.handleScoreKeyInput),APP.device.addButtonHandler(["kp-p-01","kp-p-02","kp-p-03","kp-p-04","kp-p-05","kp-p-06","kp-p-07","kp-p-08","kp-p-09","kp-p-00","bb-pg-clear","bb-pg-cancel","mb-ig-funcl","mb-ig-funcr"],APP.header.handleScoreKeyInput),APP.equation.linkToUserInput(APP.header.user_input),APP.equation.reset(cs),APP.message_bar.clear(),APP.message_bar.show("message-bar-ingame"),APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text}),APP.message_bar.setLeftFunc("backspace"),APP.message_bar.setRightFunc("enter"),APP.keypad_points.disableOperators(),APP.scoreboard.shield(),APP.reveal.showButtonBar("button-bar-pregame"),APP.reveal.showPanel("keypad-points-panel"),APP.header.disableEditing(),APP.header.score_both=!0,APP.header.setUserControls()},finishScoreEdit:function(){APP.header.edit_opponent=null,APP.header.refresh(),APP.reveal.hidePanel((function(){APP.reveal.showButtonBar("button-bar-match")})),APP.equation.reset(),APP.message_bar.show("message-bar-status"),APP.header.edit_opponent=null,APP.device.setKeyboardHandler(null),APP.keypad_points.enableOperators(),APP.header.enableEditing(),APP.header.refresh(),APP.scoreboard.unshield()},recordScoreEdit:function(){APP.header.score_both?(APP.game.opponent[0].setStartingScore(APP.equation.value()),APP.game.opponent[1].setStartingScore(APP.equation.value())):APP.game.opponent[APP.header.edit_opponent].setStartingScore(APP.equation.value()),APP.storeState({settings_change:!0}),APP.header.finishScoreEdit(),"function"==typeof APP.header.score_options.done_callback&&APP.header.score_options.done_callback()},cancelScoreEdit:function(){APP.header.finishScoreEdit()},setUserControls:function(){APP.header.score_both?$("#bb-pg-both").addClass("button-bar-option-on"):$("#bb-pg-both").removeClass("button-bar-option-on"),APP.equation.hasUserInput()?(APP.device.enableButton("bb-pg-clear"),APP.device.enableButton("mb-ig-funcl")):(APP.device.disableButton("bb-pg-clear"),APP.device.disableButton("mb-ig-funcl"))},handleScoreKeyInput:function(in_code,in_shift_key){var btn_code,o=APP.header.edit_opponent;if(BBAT.isNumeric(in_code))if(in_code>=48&&in_code<=57)in_shift_key||APP.equation.addDigit(in_code-48,APP.header.score_options.max_value);else if(in_code>=96&&in_code<=105)APP.equation.addDigit(in_code-96,APP.header.score_options.max_value);else switch(parseInt(in_code)){case 8:APP.equation.backspace();break;case 13:return void APP.header.recordScoreEdit();case 27:return void APP.header.cancelScoreEdit();case 187:if(!in_shift_key)return void APP.header.recordScoreEdit();break;default:return}else if(btn_code=in_code.substr(in_code.lastIndexOf("-")+1),BBAT.isNumeric(btn_code))APP.equation.addDigit(parseInt(btn_code,10),APP.header.score_options.max_value);else switch(btn_code){case"funcl":APP.equation.backspace();break;case"funcr":return void APP.header.recordScoreEdit();case"cancel":return void APP.header.cancelScoreEdit();case"clear":APP.equation.reset();break;case"both":APP.header.score_both=!APP.header.score_both;break;case"enter":return void APP.header.recordScoreEdit()}APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text}),APP.header.score_both?(APP.header.showPendingScore(0,APP.equation.value()),APP.header.showPendingScore(1,APP.equation.value())):(APP.header.refresh(),APP.header.showPendingScore(o,APP.equation.value())),APP.header.setUserControls()},disablePlayerOrderMenu:function(in_index){APP.device.disableFieldID("hdr-name-"+in_index)},enablePlayerOrderMenu:function(in_index){APP.device.enableFieldID("hdr-name-"+in_index)},enableHandicapping:function(){$(".header-handicap").show(0)},disableHandicapping:function(){$(".header-handicap").hide(0)},enableEditing:function(){APP.device.enableFieldClass("header-name")&&$(".header-name").addClass("header-editable"),APP.device.disableFieldClass("header-score"),$(".header-score").removeClass("header-editable"),APP.session.other_game&&"01"==APP.game.name&&APP.device.enableFieldClass("header-score")&&$(".header-score").addClass("header-editable")},disableEditing:function(in_name_edit){in_name_edit?(APP.device.disableFieldClass("header-score"),$(".header-score").removeClass("header-editable")):(APP.device.disableFieldClass("header-name"),APP.device.disableFieldClass("header-score"),$(".header-opponent .field").removeClass("header-editable"))},showPendingScore:function(in_opponent,in_score,in_force_it){var cs,suffix,ar=APP.game.active_round,el=$("#hdr-score-"+in_opponent);APP.game.started&&"Cricket"==APP.game.name&&APP.game.getOption("no_points")?(cs=APP.game.opponent[in_opponent].getGameTotalMarksScored(),suffix=""):(cs=APP.game.opponent[in_opponent].getCurrentScore(ar),suffix=""),el.text(in_score+suffix),in_force_it||in_score!=cs?el.addClass("header-score-pending").text(in_score+suffix):el.removeClass("header-score-pending").text(in_score+suffix)},displayPendingPoints:function(in_opponent_index,in_pending_points){$("#hdr-points-"+in_opponent_index).html(in_pending_points||""),$("#hdr-points-"+in_opponent_index).addClass("header-points-current")},forceRoundCounter:!1,refresh:function(in_names_only){var cs,pc,pi,oppo,ao=APP.game.active_opponent,ar=APP.game.active_round;$(".header-name-current").removeClass("header-name-current"),$(".header-name-current-player").removeClass("header-name-current-player"),$(".header-score-current").removeClass("header-score-current"),$(".header-3da").removeClass("header-3da-current"),$(".header-m3da").removeClass("header-m3da-current"),$(".header-points").removeClass("header-points-current"),$(".header-editing").removeClass("header-editing"),APP.game.plugin.is_edit_mode&&($("#hdr-name-"+ao).addClass("header-editing"),$("#hdr-score-"+ao).addClass("header-editing")),BBAT.isNumeric(ar)&&$("#hdr-round").text(ar+1);try{if(!APP.header.forceRoundCounter){var scoreType,homeScore,awayScore,hasUpdate=!1;if(APP.session.isLeaguePlay())if(APP.nlf.data.rails){var matchData=APP.nlf.rails.getRailsMatchData(!1,!0);matchData&&(homeScore=matchData.home_match_points,awayScore=matchData.away_match_points,scoreType="Match Score",hasUpdate=!0)}else{var leagueMatchPoints=APP.session.getLeagueMatchScore();leagueMatchPoints&&(homeScore=leagueMatchPoints.home_match_points,awayScore=leagueMatchPoints.away_match_points,scoreType="Match Score",hasUpdate=!0)}else APP.session.isSetPlay()&&(homeScore=APP.getMatch().set_wins[0],awayScore=APP.getMatch().set_wins[1],scoreType="Set Score",hasUpdate=!0);if(hasUpdate){var setScoreTable,displayMode="single";switch(2!=homeScore.toString().length&&2!=awayScore.toString().length||(displayMode="double"),(homeScore.toString().length>2||awayScore.toString().length>2)&&(displayMode="triple"),displayMode){case"single":setScoreTable=`\n\t\t\t\t\t\t\t\t<table class="hdr-set-score-table" style="width: 100%; font-size: 0.67em;">\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td width="40%" class="text-right" style="text-align: right">${homeScore}</td>\n\t\t\t\t\t\t\t\t\t\t\t<td width="20%">-</td>\n\t\t\t\t\t\t\t\t\t\t\t<td width="40%" class="text-left" style="text-align: left">${awayScore}</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t`;break;case"double":setScoreTable=`\n\t\t\t\t\t\t\t\t<table class="hdr-set-score-table" style="width: 100%; font-size: 0.5em; font-weight:normal;">\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td width="40%" class="text-right" style="text-align: right">${homeScore}</td>\n\t\t\t\t\t\t\t\t\t\t\t<td width="20%">-</td>\n\t\t\t\t\t\t\t\t\t\t\t<td width="40%" class="text-left" style="text-align: left">${awayScore}</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t`;break;case"triple":setScoreTable=`\n\t\t\t\t\t\t\t\t<table class="hdr-set-score-table" style="width: 100%; font-size: 0.67em;">\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t<tr style="font-size: 0.7em;line-height: 1.6em;">\n\t\t\t\t\t\t\t\t\t\t\t<td width="100%">${homeScore}</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t<tr style="font-size: 0.7em;line-height: 1.6em;">\n\t\t\t\t\t\t\t\t\t\t\t<td width="100%">${awayScore}</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t`}$("#hdr-round").html(setScoreTable),$("#hdr-version").html(`<span class="bold">${scoreType}</span>`)}}}catch(e){}if(APP.device.has_chalk&&!APP.game.started&&APP.device.enableFieldClass("header-name")&&$(".header-name").addClass("header-editable"),(oppo=APP.game.opponent[0]).player_order.length>("TEAM"==APP.header.opponent_type?0:1)&&(!APP.game.started_scoring||0==APP.game.active_opponent)&&APP.game.started)pc=oppo.team.getPlayerCount(),pi=APP.game.active_round%pc,$("#hdr-name-0").html(oppo.getChalkboardName(pi));else if(!APP.game.started&&APP.device.has_chalk&&APP.session.isNewMatch()&&oppo.team.players[0]&&"d"==oppo.team.players[0].bot_level)APP.device.enableFieldID("hdr-name-0")&&$("#hdr-name-0").removeClass("header-editable").html("Edit Level");else{var sess=APP.session,playerName=oppo.getChalkboardName();1===oppo.getPlayers().length&&sess.isBracketMatch()&&!sess.isBracketPracticeMatch()&&(playerName=sess.createPlayerName(oppo.getPlayers()[0])),"SINGLES"==sess.getMatchMode()&&(playerName=sess.createPlayerName(oppo.getPlayers()[0])),$("#hdr-name-0").html(playerName)}if((oppo=APP.game.opponent[1]).player_order.length>("TEAM"==APP.header.opponent_type?0:1)&&(!APP.game.started_scoring||1==APP.game.active_opponent)&&APP.game.started)pc=oppo.team.getPlayerCount(),pi=APP.game.active_round%pc,$("#hdr-name-1").html(oppo.getChalkboardName(pi));else if(!APP.game.started&&APP.device.has_chalk&&APP.session.isNewMatch()&&oppo.team.players[0]&&"d"==oppo.team.players[0].bot_level)APP.device.enableFieldID("hdr-name-1")&&$("#hdr-name-1").removeClass("header-editable").html("Edit Level");else{sess=APP.session,playerName=oppo.getChalkboardName();1===oppo.getPlayers().length&&sess.isBracketMatch()&&!sess.isBracketPracticeMatch()&&(playerName=sess.createPlayerName(oppo.getPlayers()[0])),"SINGLES"==sess.getMatchMode()&&(playerName=sess.createPlayerName(oppo.getPlayers()[0])),$("#hdr-name-1").html(playerName)}if(APP.game.started&&!APP.game.finished){switch(APP.game.name){case"01":$("#hdr-3da-0").html(APP.game.opponent[0].getRunning3DA(0)),$("#hdr-3da-1").html(APP.game.opponent[1].getRunning3DA(0)),$("#hdr-3da-"+APP.game.current_opponent).addClass("header-3da-current"),$("#hdr-m3da-0").html(APP.session.getM3DA("POINTS",0)),$("#hdr-m3da-1").html(APP.session.getM3DA("POINTS",1)),$("#hdr-m3da-"+APP.game.current_opponent).addClass("header-m3da-current");break;case"Cricket":$("#hdr-3da-0").html(APP.game.opponent[0].getRunning3DA(1)),$("#hdr-3da-1").html(APP.game.opponent[1].getRunning3DA(1)),$("#hdr-3da-"+APP.game.current_opponent).addClass("header-3da-current"),$("#hdr-m3da-0").html(APP.session.getM3DA("MARKS",0)),$("#hdr-m3da-1").html(APP.session.getM3DA("MARKS",1)),$("#hdr-m3da-"+APP.game.current_opponent).addClass("header-m3da-current");break;default:$(".header-3da").html(""),$(".header-m3da").html("")}APP.user_options.running_3da||APP.user_options.running_1da?($(".header-3da").removeClass("header-3da-dont-show"),$(".header-m3da").removeClass("header-3da-dont-show")):($(".header-3da").addClass("header-3da-dont-show"),$(".header-m3da").addClass("header-3da-dont-show")),APP.user_options.floating_set_score&&"Cricket"!==APP.game.name?$("#sb-floating-set-score").addClass("show"):$("#sb-floating-set-score").removeClass("show")}else $(".header-3da").html(""),$(".header-m3da").html("");if(!in_names_only){if($(".header-score-pending").removeClass("header-score-pending"),APP.game.started&&"Cricket"==APP.game.name&&APP.game.getOption("no_points")?(cs=APP.game.opponent[0].getGameTotalMarksScored(),$("#hdr-score-0").text(cs+"M"),cs=APP.game.opponent[1].getGameTotalMarksScored(),$("#hdr-score-1").text(cs+"M")):APP.game.finished||(cs=APP.game.opponent[0].getCurrentScore(),$("#hdr-score-0").text(cs),cs=APP.game.opponent[1].getCurrentScore(),$("#hdr-score-1").text(cs)),1==APP.game.opponent_count?($("#hdr-name-1").css("opacity",0),$("#hdr-score-1").css("opacity",0)):($("#hdr-name-1").css("opacity",.99),$("#hdr-score-1").css("opacity",.99)),APP.game.started)$("#hdr-score-0").removeClass("header-score-special"),$("#hdr-score-1").removeClass("header-score-special"),APP.game.finished?($(".header-name").addClass("header-eog"),$(".header-score").addClass("header-eog"),$("#hdr-score-"+APP.game.winning_opponent).addClass("header-winner"),$("#hdr-name-"+APP.game.winning_opponent).addClass("header-winner"),"Library"==APP.game.name&&($(".header-ascending-eog").removeClass("button").removeClass("button-up"),$("#hdr-eog-"+APP.game.winning_opponent).addClass("header-ascending-winner"))):($(".header-eog").removeClass("header-eog"),$(".header-winner").removeClass("header-winner"),$("#hdr-name-"+ao).addClass("header-name-current"),$("#hdr-score-"+ao).addClass("header-score-current"),"Library"==APP.game.name&&APP.game.started_scoring&&($(".header-ascending-eog").show(0).addClass("button").addClass("button-up"),$("#hdr-eog-"+APP.game.winning_opponent).removeClass("header-ascending-winner"),APP.device.has_chalk?$(".header-ascending-eog").removeClass("button-disabled"):$(".header-ascending-eog").addClass("button-disabled"),1==APP.game.opponent_count&&$("#hdr-eog-1").addClass("button-disabled")));else switch(APP.game.name){case"01":"01"==(""+APP.game.opponent[0].getStartingScore()).right(2)?$("#hdr-score-0").removeClass("header-score-special"):$("#hdr-score-0").addClass("header-score-special"),"01"==(""+APP.game.opponent[1].getStartingScore()).right(2)?$("#hdr-score-1").removeClass("header-score-special"):$("#hdr-score-1").addClass("header-score-special");break;case"Cricket":0==APP.game.opponent[0].getStartingScore()?$("#hdr-score-0").removeClass("header-score-special"):$("#hdr-score-0").addClass("header-score-special"),0==APP.game.opponent[1].getStartingScore()?$("#hdr-score-1").removeClass("header-score-special"):$("#hdr-score-1").addClass("header-score-special");break;default:$("#hdr-score-0").text("").removeClass("header-score-special"),$("#hdr-score-1").text("").removeClass("header-score-special")}if(APP.session.isBracketMatch()&&APP.session.isBracketPrescribedMatch()){APP.header.disableEditing();try{var tournamentId=APP.session.tournament_id;if(-1!=[].indexOf(tournamentId))return;var eventId=APP.session.bracket.event_id;if(eventId=eventId.toString(),-1!=[].indexOf(eventId))return}catch(e){}try{if((mf=APP.getMatch().format).enable_handicapping&&"Y"==mf.enable_handicapping)return}catch(e){}APP.header.disableHandicapping()}if(APP.session.isLeaguePlay())try{var mf;if((mf=APP.getMatch().format).dynamic_handicapping)return}catch(e){}}}},APP.game={active_opponent:null,active_round:null,bull_shoot_winner:null,cork_winner:null,current_opponent:null,current_round:null,dartbot:null,deepest_initiated_edit:null,dflt_guest_player:null,dflt_guest_team:null,dflt_host_player:null,dflt_host_team:null,dyg_target:null,elapsed_time:null,filler_player:null,finish_time:null,finished:null,handicap_opponent:null,is_handicapping:null,name:null,opponent:null,opponent_count:null,options:null,plugin:null,reload_count:null,select_winning_dart:null,shooting_for_bull:null,shot_for_bull:null,special_target_offset:null,start_time:null,started:null,started_scoring:null,sudden_death_win:null,target:null,winning_dart:null,winning_opponent:null,leg_forfeit:null,nine_darter:null,league_practice_game:!1,score_edits:[],resetOptions:function(){var key;for(key in APP.game.options)delete APP.game.options[key];APP.game.options={opponent_type:"S"}},resetCricketOptions:function(){var key;for(key in APP.game.options)switch(key){case"no_points":case"drop_10":case"dutch_tactics":delete APP.game.options[key]}},setOptions:function(in_spec){var p;for(p in in_spec)APP.game.options[p]=in_spec[p]},getOption:function(in_option){return APP.game.options[in_option]},init:function(){APP.game.active_opponent=null,APP.game.active_round=null,APP.game.current_opponent=null,APP.game.current_round=null,APP.game.deepest_initiated_edit=0,APP.game.dyg_target=[],APP.game.elapsed_time=0,APP.game.finish_time=null,APP.game.finished=!1,APP.game.handicap_opponent=null,APP.game.is_handicapping=!1,APP.game.name=null,APP.game.opponent=[],APP.game.opponent_count=2,APP.game.opponent_order=[],APP.game.options={},APP.game.plugin=null,APP.game.special_target_offset=0,APP.game.start_time=null,APP.game.started=!1,APP.game.started_scoring=!1,APP.game.target=[],APP.game.winning_dart=null,APP.game.winning_opponent=null,APP.game.sudden_death_win=!1,APP.game.eog_final=!1,APP.game.reload_count=0,APP.game.leg_forfeit=null,APP.game.shooting_for_bull=BBAT.fetchData("shooting_for_bull")||!1,APP.game.bull_shoot_winner=BBAT.fetchData("bull_shoot_winner"),APP.game.cork_winner=BBAT.fetchData("cork_winner"),APP.game.dflt_host_player=new APP.game.Player({obj_id:"Phost",chalkboard_name:"Home",first_name:"Home",is_default:!0}),APP.game.dflt_host_team=new APP.game.Team({obj_id:"Thost",chalkboard_name:"Home",team_name:"Home",is_default:!0}),APP.game.dflt_host_team.addPlayer(APP.game.dflt_host_player),APP.game.dflt_guest_player=new APP.game.Player({obj_id:"Pguest",chalkboard_name:"Away",first_name:"Away",is_default:!0}),APP.game.dflt_guest_team=new APP.game.Team({obj_id:"Tguest",chalkboard_name:"Away",team_name:"Away",is_default:!0}),APP.game.dflt_guest_team.addPlayer(APP.game.dflt_guest_player),APP.game.dartbot=new APP.game.Player({obj_id:"Pdartbot",chalkboard_name:"DC",first_name:"DC",in_pool:!0,is_bot:!0,bot_level:"d",bot_skill:APP.dartbot.levels[0].skill}),APP.game.players_team=new APP.game.Team({obj_id:"Tplayers"}),APP.game.players_team.addPlayer(APP.game.dartbot),APP.game.filler_player=new APP.game.Player({obj_id:"Pfiller",chalkboard_name:"-SHORT-",first_name:"",last_name:"",in_pool:!1,is_bot:!1}),APP.game.resetOptions(),APP.device.addButtonHandler(["pda-0","pda-1","pda-2","pda-3"],APP.game.handleDoubleOutAttempts),APP.device.addButtonHandler(["pbd-1","pbd-2","pbd-3"],APP.game.handleBustDarts),APP.fns.activateBtn("popup-bust-info",(function(){APP.game.explainBustDarts()})),APP.fns.activateBtn("pbd-off",APP.game.disableBustDarts)},Target:function(in_spec){this.label=""+in_spec.label,this.value=parseInt(in_spec.value,10),this.special=!1},Dart:function(){this.color=null,this.zone=null,this.reset=function(){this.color=null,this.zone=null}},Turn:function(){this.color=null,this.r3da=null,this.r1da=null,this.current_score=null,this.darts_thrown=null,this.player_index=null,this.dart=[],this.dart[0]=new APP.game.Dart,this.dart[1]=new APP.game.Dart,this.dart[2]=new APP.game.Dart,this.do_attempts=null,this.marks_recorded=null,this.marks_scored=null,this.points=null,this.target_marks=[],this.target_points=[],this.user_input=[],this.entry_marks=[],this.entry_points=[],this.unscore=function(in_target_count){var i;for(this.entry_marks.length=0,this.entry_points.length=0,this.target_marks.length=0,i=0;i<in_target_count;i++)this.target_marks.push(0);for(this.target_points.length=0,i=0;i<in_target_count;i++)this.target_points.push(0);this.r3da=null,this.r1da=null,this.color=null,this.points=null,this.darts_thrown=null,this.marks_scored=null,this.player_index=null,this.current_score=null,this.marks_recorded=null,this.do_attempts=null,this.dart[0].reset(),this.dart[1].reset(),this.dart[2].reset()},this.reset=function(in_target_count){this.unscore(in_target_count),this.user_input.length=0}},Player:function(in_spec){this.obj_id=in_spec.player_guid?"P"+in_spec.player_guid:in_spec.obj_id?in_spec.obj_id:BBAT.createRandomID("P"),this.player_guid=in_spec.player_guid||null,this.first_name=in_spec.first_name||null,this.last_name=in_spec.last_name||null,this.chalkboard_name=in_spec.chalkboard_name||null,this.nickname=in_spec.nickname||null,this.email=in_spec.email||null,this.member_level=in_spec.member_level||"U",this.member_id=in_spec.member_id||null,this.is_default=in_spec.is_default||!1,this.in_pool=in_spec.in_pool||null,this.is_bot=in_spec.is_bot||!1,this.bot_skill=in_spec.bot_skill||null,this.bot_level=in_spec.bot_level||null,this.has_doubled_in=!1,this.do_attempts=in_spec.do_attempts||null,this.is_temp_player=in_spec.is_temp_player||!1,this.last_active_date=in_spec.last_active_date||null,this.iso2_country=in_spec.iso2_country||null,this.iso3_country=in_spec.iso3_country||null,this.country_name=in_spec.country_name||null,this.player_postseason_status=in_spec.player_postseason_status||!1,this.wdf_rank=in_spec.wdf_rank||null},Team:function(in_spec){this.obj_id=in_spec.team_guid?"T"+in_spec.team_guid:in_spec.obj_id?in_spec.obj_id:BBAT.createRandomID("T"),this.team_guid=in_spec.team_guid||null,this.team_name=in_spec.team_name||null,this.chalkboard_name=in_spec.chalkboard_name||null,this.email=in_spec.email||null,this.is_default=!!in_spec.is_default,this.in_pool=!!in_spec.in_pool,this.players=[],this.resetDoubleOutAttempts=function(){var pi,p_len;for(p_len=this.players.length,pi=0;pi<p_len;pi++)this.players[pi].do_attempts=null},this.getBotPlayerCount=function(){var p;return(p=this.players).length&&p[0].is_bot?1:0},this.getFillerPlayerCount=function(){var p,i,len,count;for(count=0,len=(p=this.players).length,i=0;i<len;i++)"Pfiller"==p[i].obj_id&&count++;return count},this.getPlayerCount=function(in_include_default_player){return in_include_default_player?this.players.length:this.players.length?this.players[0].is_default?0:this.players.length:0},this.getPlayer=function(in_param){var i,len,p;if(len=(p=this.players).length,BBAT.isInteger(in_param)&&in_param<len)return p[in_param];for(i=0;i<len;i++)if(in_param==p[i].obj_id)return p[i];return null},this.isValidNewPlayer=function(in_chalkboard_name){var i,len,p,cn=in_chalkboard_name?in_chalkboard_name.toLowerCase():null;if(!cn||"home"==cn||"away"==cn||"dartconnect"==cn||APP.game.isBotChalkboardName(cn))return!1;for(len=(p=this.players).length,i=0;i<len;i++)if(cn==p[i].chalkboard_name.toLowerCase())return!1;return!0},this.isValidNewLookupPlayer=function(in_email){var i,len,p,em=in_email.toLowerCase();for(len=(p=this.players).length,i=0;i<len;i++)if(em==(p[i].email?p[i].email.toLowerCase():""))return!1;return!0},this.sort=function(){var tourney="TOURNAMENT"==APP.session.getMatchMode();try{if(APP.nlf.data.rails&&APP.nlf.playerRails.isSetTeamOrder())return-1}catch(e){}if(tourney)return-1;this.players.sort((function(in_a,in_b){var af=in_a.is_bot?"":in_a.first_name.toLowerCase(),al=in_a.is_bot?"":in_a.last_name.toLowerCase(),bf=in_b.is_bot?"":in_b.first_name.toLowerCase(),bl=in_b.is_bot?"":in_b.last_name.toLowerCase();return tourney?al<bl?-1:al>bl?1:af<bf?-1:af>bf?1:0:af<bf?-1:af>bf?1:al<bl?-1:al>bl?1:0}))},this.addPlayer=function(in_spec){return this.players.push(new APP.game.Player(in_spec)),this.players[this.players.length-1].obj_id},this.updatePlayer=function(in_spec,in_index){var t,key;for(key in t=this.getPlayer(in_index),in_spec)t[key]=in_spec[key];this.removePlayer(in_index),this.addPlayer(t),this.sort()},this.resetPlayers=function(){this.players.length=0},this.removePlayer=function(in_param){var i,len,p;if(len=(p=this.players).length,BBAT.isInteger(in_param)&&in_param<len)return p.splice(in_param,1),!0;for(i=0;i<len;i++)if(in_param==p[i].obj_id)return p.splice(i,1),!0;return!1}},isDefaultOpponents:function(){return APP.game.opponent[0].team.is_default&&APP.game.opponent[1].team.is_default},isBotChalkboardName:function(in_chalkboard_name){return in_chalkboard_name.match(/^dc [1-9,x]\.[0-9]$/i)},isBotPlaying:function(in_adaptive_mode){var i,j,len,oppo;for(i=0;i<APP.game.opponent_count;){for(len=(oppo=APP.game.opponent[i]).team.players.length,j=0;j<len;j++)if(oppo.team.players[j].is_bot)return!in_adaptive_mode||"a"==oppo.team.players[j].bot_level;i++}return!1},getBotLevel:function(){var i,j,len,oppo;for(i=0;i<APP.game.opponent_count;){for(len=(oppo=APP.game.opponent[i]).team.players.length,j=0;j<len;j++)if(oppo.team.players[j].is_bot)return oppo.team.players[j].bot_level;i++}return null},cloneTeam:function(in_spec){var t,i,len;if(t=new APP.game.Team(in_spec),in_spec.players)for(len=in_spec.players.length,i=0;i<len;i++)t.addPlayer(in_spec.players[i]);return t},swapOpponents:function(){var oppo_0=APP.game.opponent[0],oppo_1=APP.game.opponent[1],temp={};temp.team=APP.game.cloneTeam(oppo_0.team),temp.chalkboard_name=oppo_0.chalkboard_name,temp.start_button_name=oppo_0.start_button_name,temp.player_order=oppo_0.player_order.slice(0),oppo_0.team=APP.game.cloneTeam(oppo_1.team),oppo_0.chalkboard_name=oppo_1.chalkboard_name,oppo_0.start_button_name=oppo_1.start_button_name,oppo_0.player_order=oppo_1.player_order.slice(0),oppo_1.team=APP.game.cloneTeam(temp.team),oppo_1.chalkboard_name=temp.chalkboard_name,oppo_1.start_button_name=temp.start_button_name,oppo_1.player_order=temp.player_order.slice(0)},Opponent:function(in_spec){this.chalkboard_name="?",this.start_button_name="?",this.starting_score=in_spec.starting_score,this.current_score=in_spec.starting_score,this.closing_mark=[],this.handicap_marks=[],this.handicap=in_spec.handicap,this.stats={},this.turn=[],this.team={},this.has_doubled_in=!1,this.player_tracking=!0,this.player_order=[],this.isPlayerOrderPending=function(){var len=this.team.players.length;return!!(this.player_tracking&&len>1&&this.player_order.length!=len)},this.applyDoubleOutAttempts=function(){var i,i_len,po=this.player_order,po_len=po.length,tp=this.team.players;tp.length;for(i_len=this.turn.length,i=0;i<i_len;i++){if(1==tp.length)player=tp[0];else{if(0==po_len)return;var player=tp[po[i%po_len]]}player.do_attempts?player.do_attempts+=this.turn[i].do_attempts:player.do_attempts=this.turn[i].do_attempts}},this.skipPlayerTracking=function(){},this.getPlayerInitials=function(in_player_index){var i,p;return null!=in_player_index&&(p=this.team.players[in_player_index])?"Pfiller"==p.obj_id?"":(i=p.first_name.left(1),p.last_name>""&&(i+=p.last_name.left(1)),i):""},this.getDCTVNames=function(){var p,name,i,len,delim;for(len=this.team.players.length,name="",delim="",i=0;i<len;i++)"Pfiller"!=(p=this.team.players[i]).obj_id&&(name+=delim+((p.first_name||"")+" "+(p.last_name||"")).trim()),delim=", ";return name},this.setTurnPlayers=function(){var i,len,p_count;if(this.player_tracking)for(p_count=this.player_order.length,len=this.turn.length,i=0;i<len;i++)this.turn[i].player_index=this.player_order[i%p_count]},this.loadPlayerOrder=function(in_player_order){var i,len;for(this.player_order.length=0,len=in_player_order.length,i=0;i<len;i++)this.player_order.push(in_player_order[i])},this.setTeam=function(in_spec,in_mode){delete this.team,this.team=APP.game.cloneTeam(in_spec),this.setNames()},this.setNames=function(){var i,len,p,t,delim="",sb_delim="";if("TEAM"==APP.session.getMatchMode())this.chalkboard_name=this.team.chalkboard_name,this.start_button_name=this.team.chalkboard_name;else for(this.chalkboard_name="",this.start_button_name="",len=(t=this.team).players.length,i=0;i<len;i++)switch(p=t.players[i],len){case 1:p.is_bot?(this.chalkboard_name=APP.dartbot.getName(p.bot_skill),this.start_button_name=this.chalkboard_name):(this.chalkboard_name=p.chalkboard_name,this.start_button_name=(p.first_name||"")+" "+(("*"==p.last_name?"":p.last_name)||"").trim());break;case 2:p.is_bot?(this.chalkboard_name=APP.dartbot.getName(p.bot_skill),this.start_button_name=this.chalkboard_name):"Pfiller"!=p.obj_id&&(0==t.getBotPlayerCount()&&(this.chalkboard_name=this.chalkboard_name+delim+p.first_name.left(1)+p.last_name.left(1)),"TOURNAMENT"==APP.session.getMatchMode()?this.start_button_name=this.start_button_name+delim+p.first_name+" "+p.last_name:this.start_button_name=this.start_button_name+delim+p.first_name+" "+p.last_name.left(1)),delim=" &amp; ";break;default:p.is_bot?(this.chalkboard_name=APP.dartbot.getName(p.bot_skill),this.start_button_name=this.chalkboard_name):"Pfiller"!=p.obj_id&&(0==t.getBotPlayerCount()&&(this.chalkboard_name=this.chalkboard_name+delim+p.first_name.left(1)+p.last_name.left(1)),"TOURNAMENT"==APP.session.getMatchMode()?this.start_button_name=this.start_button_name+sb_delim+p.first_name+" "+p.last_name:this.start_button_name=this.start_button_name+sb_delim+p.first_name+" "+p.last_name.left(1)),delim=" ",sb_delim=", "}},this.getRunning3DA=function(in_decimals){var t=this.turn,lti=t.length-1;if(APP.user_options.running_1da){if(null==t[lti].r1da){if(0==lti)return(0).toFixed(in_decimals);lti--}return null==t[lti].r1da?(0).toFixed(in_decimals):t[lti].r1da.toFixed(in_decimals)}if(null==t[lti].r3da){if(0==lti)return(0).toFixed(in_decimals);lti--}return null==t[lti].r3da?(0).toFixed(in_decimals):t[lti].r3da.toFixed(in_decimals)},this.getTeam=function(){return this.team},this.getPlayers=function(){return this.team.players},this.getStartButtonName=function(){return this.start_button_name},this.getTeamPlayerNames=function(in_split){var p,i,len,names;names="",len=(p=this.team.players).length;var maxTeams=APP.nlf.playerRails.getMaxTeamSize();if(maxTeams.active&&maxTeams.maxTeam){var realPlayerCount=0;for(i=0;i<len;i++)"Pfiller"!=p[i].obj_id&&realPlayerCount++;return this.team.team_name+" ("+realPlayerCount+")"}for(i=0;i<len;i++){if("Pfiller"==p[i].obj_id)return names+=' <span class="italic">(short)</span>';names+=i==len-1?p[i].chalkboard_name:1==i&&in_split?p[i].chalkboard_name+",<br />":p[i].chalkboard_name+", "}return names},this.getFullName=function(in_player_order_index){var p;return this.player_order.length>in_player_order_index&&in_player_order_index>=0?(p=this.team.players[this.player_order[in_player_order_index]]).is_bot?"DartConnect":(p.first_name||"")+" "+(("*"==p.last_name?"":p.last_name)||"").trim():this.chalkboard_name},this.getChalkboardName=function(in_player_order_index){var p;try{return this.player_order.length>in_player_order_index&&in_player_order_index>=0?(p=this.team.players[this.player_order[in_player_order_index]]).is_bot&&"d"==p.bot_level?p.chalkboard_name+"1":p.chalkboard_name:this.chalkboard_name}catch(e){}return this.chalkboard_name},this.setStartingScore=function(in_score){this.starting_score=parseInt(in_score,10),this.recalcScore()},this.getStartingScore=function(){return this.starting_score},this.setHandicap=function(in_handicap){this.handicap=parseInt(in_handicap,10),this.recalcScore()},this.getHandicap=function(){return this.handicap},this.recalcScore=function(){var t,t_cnt;for(this.current_score=this.starting_score,this.current_score=this.current_score+this.handicap,t_cnt=this.turn.length,t=0;t<t_cnt;t++)BBAT.isNumeric(this.turn[t].points)&&(APP.game.options.ascending_score?(this.current_score=this.current_score+this.turn[t].points,this.turn[t].current_score=this.current_score):(this.current_score=this.current_score-this.turn[t].points,this.turn[t].current_score=this.current_score))},this.getCurrentScore=function(){return this.current_score},this.setTurnColor=function(in_round,in_color){this.turn[in_round].color=in_color},this.getTurnColor=function(in_round){return this.turn[in_round].color},this.clearTurnColor=function(in_round){this.turn[in_round].color=null},this.setUserInput=function(in_round,in_user_input){return this.turn[in_round].user_input=in_user_input},this.getUserInput=function(in_round,in_by_ref){return in_by_ref?this.turn[in_round].user_input:this.turn[in_round].user_input.slice(0)},this.hasUserInput=function(in_round){return this.turn[in_round].user_input.length>0},this.getUserInputLength=function(in_round){return this.turn[in_round].user_input.length},this.clearUserInput=function(in_round){return this.turn[in_round].user_input.length=0},this.recalcRunning3DA=function(){var pnts,drts,len,t,i,ttl;if("Library"!=APP.game.name)for(ttl=0,drts=0,len=this.turn.length,i=0;i<len;i++)drts+=(t=this.turn[i]).darts_thrown,null==(pnts="01"==APP.game.name?t.points:t.marks_scored)?(t.r3da=null,t.r1da=null):(ttl+=pnts,t.r3da=ttl/drts*3,t.r1da=ttl/drts)},this.setTurnPoints=function(in_round,in_points){var t=this.turn[in_round];if("number"==typeof t.points&&t.points!==in_points&&"01"===APP.game.name&&APP.plugin_01.hasScoreBeenEdited()&&(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)&&APP.device.has_chalk){var round=APP.game.active_round+1,scoreFrom=t.points,scoreTo=in_points,sideEdited=null;try{sideEdited=parseFloat($(".sb-turn-edit-prev").attr("id").split("-t")[1])}catch(e){}var editDetails={round:APP.game.active_round,display_round:round,score_from:scoreFrom,score_to:scoreTo,side_edited:sideEdited};if(APP.message.send.editMessage(editDetails),APP.device.is_hosting)editDetails.edit_made_by="HOST",editDetails.timestamp=new Date,APP.session.matches[APP.session.current_match].leg_score_edits.push(editDetails),APP.session.store(APP.session.current_match)}t.points=in_points,t.darts_thrown=3,this.recalcScore(),this.recalcRunning3DA(),APP.game.started_scoring=!APP.game.is_handicapping},this.clearTurnPoints=function(in_round){this.turn[in_round].points=null,this.recalcScore(),this.recalcRunning3DA()},this.getTurnPoints=function(in_round){return this.turn[in_round].points},this.setTurnMarks=function(in_round,in_recorded,in_scored){this.turn[in_round].marks_recorded=in_recorded,this.turn[in_round].marks_scored=in_scored,this.recalcRunning3DA(),APP.game.started_scoring=!APP.game.is_handicapping},this.clearTurnMarks=function(in_round){this.turn[in_round].marks_recorded=null,this.turn[in_round].marks_scored=null,this.recalcRunning3DA()},this.setTargetClosingFromMark=function(in_target_index,in_closing_mark){this.closing_mark[in_target_index]=in_closing_mark},this.clearTargetClosingFromMark=function(in_target_index){this.closing_mark[in_target_index]=null},this.getTargetClosingFromMark=function(in_target_index){return this.closing_mark[in_target_index]},this.getTargetHandicapMark=function(in_target_index){return this.handicap_marks[in_target_index]},this.getTotalHandicapMarks=function(){var i,mrks=0,t_cnt=APP.game.target.length;for(i=1;i<t_cnt;i++)mrks+=this.handicap_marks[i];return mrks},this.isTargetClosed=function(in_round,in_target_index){return 0!=in_target_index&&(null!=this.closing_mark[in_target_index]||(!APP.game.getOption("marksman_scoring")||"STRAIGHT"==APP.game.getOption("variation")||"EXTENDED"==APP.game.getOption("variation"))&&this.getGameTargetMarksScored(in_target_index,!0)>=3)},this.areAllTargetsClosed=function(in_bull_target_index){var i=this.closing_mark.indexOf(null);return void 0!==in_bull_target_index&&i==in_bull_target_index||-1==i},this.getPendingTargetPoints=function(in_round){return this.current_score+this.getTurnTotalPointsScored(in_round)},this.getTargetPointsScored=function(in_round,in_target_index){return this.turn[in_round].target_points[in_target_index]},this.getTurnTotalMarksScored=function(in_round){var i,len,mrks=0,tm=this.turn[in_round].target_marks;for(len=tm.length,i=0;i<len;i++)mrks+=tm[i];return mrks},this.getTurnTotalMarksRecorded=function(in_round){var i,len,mrks=0,ui=this.turn[in_round].user_input;for(len=ui.length,i=0;i<len;i++)0!=ui[i]&&(mrks+=APP.game.options.marksman_scoring?APP.game.getModifierValue(ui[i].right(1)):1);return mrks},this.getTurnTotalPointsScored=function(in_round){var i,len,pnts=0,tp=this.turn[in_round].target_points;for(len=tp.length,i=0;i<len;i++)pnts+=tp[i];return pnts},this.getGameTargetPointsScored=function(in_target_index){var i,len=this.turn.length,pnts=0;for(i=0;i<len;i++)pnts+=this.turn[i].target_points[in_target_index];return pnts},this.getGameTargetMarksScored=function(in_target_index,in_include_handicap){var i,len=this.turn.length,mrks=0;for(i=0;i<len;i++)mrks+=this.turn[i].target_marks[in_target_index];return in_include_handicap&&(mrks+=this.handicap_marks[in_target_index]),mrks},this.pushTargetMark=function(in_round,in_target_index,in_modifier){var mrks,mrks_over,mrks_short,pnts,t=this.turn[in_round];if(0!=in_target_index){if(in_modifier)return mrks_over=(mrks_over=(mrks=APP.game.getModifierValue(in_modifier))-(mrks_short=(mrks_short=3-this.getGameTargetMarksScored(in_target_index,!0))<0?0:mrks_short))<0?0:mrks_over,("MARK UP"==APP.game.options.variation||!APP.game.isTargetClosedOut(in_round,in_target_index,APP.game.active_opponent))&&mrks_over>0&&"NO POINTS"!=APP.game.getOption("variation")?(pnts=APP.game.target[in_target_index].value*mrks_over,t.target_points[in_target_index]+=pnts,t.entry_points.push(pnts),t.target_marks[in_target_index]+=mrks,t.entry_marks.push(mrks)):APP.game.isTargetClosedOut(in_round,in_target_index)?(t.entry_points.push(0),t.entry_marks.push(0)):(t.entry_points.push(0),t.target_marks[in_target_index]+=mrks<mrks_short?mrks:mrks_short,t.entry_marks.push(mrks<mrks_short?mrks:mrks_short)),void t.user_input.push(""+in_target_index+in_modifier);"MARK UP"!=APP.game.options.variation&&APP.game.isTargetClosedOut(in_round,in_target_index)?(t.entry_points.push(0),t.entry_marks.push(0)):(this.isTargetClosed(in_round,in_target_index)?(pnts=APP.game.target[in_target_index].value,t.target_points[in_target_index]+=pnts,t.entry_points.push(pnts)):t.entry_points.push(0),t.target_marks[in_target_index]++,t.entry_marks.push(1)),t.user_input.push(""+in_target_index)}else t.user_input.push(""+in_target_index)},this.popTargetMark=function(in_round){var entry,mrks,new_val,pnts,target_index,t=this.turn[in_round];return 0==t.user_input.length?null:"0"==(entry=t.user_input.pop())?"0":(mrks=t.entry_marks.pop()||0,pnts=t.entry_points.pop()||0,target_index=parseInt(entry,10),new_val=t.target_points[target_index]-pnts,t.target_points[target_index]=new_val,new_val=t.target_marks[target_index]-mrks,t.target_marks[target_index]=new_val,target_index)},this.getTargetMarks=function(in_round,in_target_index){return this.turn[in_round].target_marks[in_target_index]},this.getPriorTargetMarks=function(in_round,in_target_index){var i,marks=0;for(i=0;i<in_round;i++)marks+=this.getTargetMarks(i,in_target_index);return marks},this.getStat=function(in_stat){return this.stats[in_stat]},this.getGameTotalMarksScored=function(){var i,m,mrks=0;for(i=0;i<=APP.game.current_round;i++)null!=(m=this.turn[i].marks_scored)&&(mrks+=m);return mrks},this.isBotTurn=function(in_round){var len,p;return APP.game.active_round==APP.game.current_round&&(in_round%(len=(p=this.team.players).length)==len-1&&p[0].is_bot)}},setShootForBull:function(in_flag,in_skip_server){var gam=APP.game;gam.cork_winner=null,gam.bull_shoot_winner=null,gam.shooting_for_bull=in_flag,in_flag||(gam.shot_for_bull=!1),BBAT.storeData({shooting_for_bull:gam.shooting_for_bull,shot_for_bull:gam.shot_for_bull,bull_shoot_winner:gam.bull_shoot_winner,cork_winner:gam.cork_winner}),"SERVER"==APP.game_master&&APP.device.has_chalk&&!in_skip_server&&APP.server.setGameSettings()},setBullShootWinner:function(in_opponent_index,in_cork_credit){APP.game.bull_shoot_winner=in_opponent_index,APP.game.shot_for_bull=!0,APP.game.shooting_for_bull=!1,APP.game.cork_winner=in_cork_credit?in_opponent_index:null,APP.storeState({settings_change:!0})},getHighestPoints:function(){var hp,i,j,opnt,p,len=APP.game.opponent.length;if(!APP.game.finished)return null;for(hp=0,i=0;i<len;i++)for(opnt=APP.game.opponent[i],j=0;j<=APP.game.current_round;j++)null!=(p=opnt.turn[j].points)&&p>hp&&(hp=p);return hp},getModifierValue:function(in_modifier){switch(in_modifier){case"S":return 1;case"D":return 2;case"T":return 3}},doesRoundHaveScores:function(in_round){var i,o_len=APP.game.opponent.length;for(i=0;i<o_len;i++)if(APP.game.opponent[i].turn[in_round].user_input.length>0)return!0;return!1},isFirstTurnActive:function(){return 0==APP.game.active_round&&APP.game.active_opponent==APP.game.opponent_order[0]},isLastTurnActive:function(){return APP.game.active_round==APP.game.current_round&&APP.game.active_opponent==APP.game.opponent_order[APP.game.opponent_order.length-1]},isFirstOpponent:function(in_opponent){return in_opponent==APP.game.opponent_order[0]},isLastOpponent:function(in_opponent){return in_opponent==APP.game.opponent_order[APP.game.opponent_order.length-1]},addNewRound:function(){var i,o_cnt=APP.game.opponent.length;for(null!=APP.game.current_round?APP.game.current_round=APP.game.current_round+1:APP.game.current_round=0,i=0;i<o_cnt;i++)APP.game.opponent[i].turn[APP.game.current_round]=new APP.game.Turn,APP.game.opponent[i].turn[APP.game.current_round].reset(APP.game.target.length);APP.game.current_opponent=APP.game.opponent_order[0],APP.game.active_round=APP.game.current_round,APP.game.active_opponent=APP.game.current_opponent},deleteCurrentTurn:function(){var i,co=APP.game.current_opponent,cr=APP.game.current_round,o_cnt=APP.game.opponent.length;if(co==APP.game.opponent_order[0]){for(APP.game.dyg_target.length&&(APP.game.dyg_target[cr].special&&APP.game.special_target_offset--,APP.game.dyg_target.pop()),i=0;i<o_cnt;i++)APP.game.opponent[i].turn.pop();APP.game.current_round=APP.game.current_round-1,APP.game.current_opponent=APP.game.opponent_order[APP.game.opponent_order.length-1]}else for(APP.game.opponent[co].turn[cr].reset(APP.game.target.length),i=1;i<o_cnt;i++)if(co==APP.game.opponent_order[i]){APP.game.current_opponent=APP.game.opponent_order[i-1];break}APP.game.active_round=APP.game.current_round,APP.game.active_opponent=APP.game.current_opponent},nextOpponentTurn:function(){var i,ao=APP.game.active_opponent,ar=APP.game.active_round,co=APP.game.current_opponent,cr=APP.game.current_round,o_cnt=APP.game.opponent_order.length;if(ao==APP.game.opponent_order[o_cnt-1])ar==cr?APP.game.addNewRound():(APP.game.active_round=ar+1,APP.game.active_opponent=APP.game.opponent_order[0]);else for(i=0;i<o_cnt;i++)if(ao==APP.game.opponent_order[i])return APP.game.active_opponent=APP.game.opponent_order[i+1],void(ar==cr&&ao==co&&(APP.game.current_opponent=APP.game.active_opponent))},prevOpponentTurn:function(){var i,ao=APP.game.active_opponent,ar=APP.game.active_round,o_cnt=(APP.game.current_opponent,APP.game.current_round,APP.game.opponent_order.length);if(ao==APP.game.opponent_order[0])ar>0&&(APP.game.active_round=ar-1,APP.game.active_opponent=APP.game.opponent_order[o_cnt-1]);else for(i=0;i<o_cnt;i++)if(ao==APP.game.opponent_order[i]){APP.game.active_opponent=APP.game.opponent_order[i-1];break}},getTurnsFromCurrent:function(){var a,c,gm=APP.game,len=APP.game.opponent.length;for(a=0;a<len&&gm.opponent_order[a]!=gm.active_opponent;a++);for(c=0;c<len&&gm.opponent_order[c]!=gm.current_opponent;c++);return c+gm.current_round*len-(a+gm.active_round*len)},isSomeoneScoring:function(){return APP.game.opponent[APP.game.current_opponent].turn[APP.game.current_round].user_input.length>0},hasAnyoneScored:function(){var i,turn,t,tlen;for(i=0;i<2;i++)for(tlen=(turn=APP.game.opponent[i].turn).length,t=0;t<tlen;t++)if(turn[t].user_input.length)return!0;return!1},isCurrentTurnActive:function(){return APP.game.current_round==APP.game.active_round&&APP.game.current_opponent==APP.game.active_opponent},addTarget:function(in_spec){var i,oppo,cnt=APP.game.opponent.length;for(APP.game.target.push(new APP.game.Target(in_spec)),i=0;i<cnt;i++)(oppo=APP.game.opponent[i]).closing_mark.push(1==APP.game.target.length?3:null),oppo.handicap_marks||(oppo.handicap_marks=[]),oppo.handicap_marks.length<oppo.closing_mark.length&&oppo.handicap_marks.push(0)},addDYGTarget:function(in_spec){APP.game.dyg_target.push(new APP.game.Target(in_spec))},changeDYGTarget:function(in_round,in_label,in_value){var i,t,cnt=APP.game.opponent.length;for(APP.game.dyg_target[in_round].special||APP.game.special_target_offset++,i=0;i<cnt;i++)(t=APP.game.dyg_target[in_round]).label=in_label,t.value=in_value,t.special=!0},resetDYGTarget:function(in_round){var lbl,t,val;return APP.game.dyg_target[in_round].special&&(APP.game.special_target_offset--,lbl=APP.game.getDYGDefaultTargetLabel(in_round),val="TARGET COUNTING"==APP.game.options.scoring_type?1:+lbl,(t=APP.game.dyg_target[in_round]).label=lbl,t.value=val,t.special=!1),APP.game.dyg_target[in_round].label},getDYGDefaultTargetLabel:function(in_round){var st=+APP.game.options.starting_target||1;return""+("DESCENDING"==APP.game.options.target_order?st-in_round+APP.game.special_target_offset:st+in_round-APP.game.special_target_offset)},getDYGTargetValue:function(in_round){return APP.game.dyg_target[in_round].value},isDYGKeypadTarget:function(in_round){return null==APP.game.dyg_target[in_round].value},hasHighScore:function(in_opponent){var i,o_cnt=APP.game.opponent.length,hs=APP.game.opponent[in_opponent].current_score;for(i=0;i<o_cnt;i++)if(APP.game.opponent[i].current_score>hs)return!1;return!0},scoreIsEqual:function(){var i,o_cnt=APP.game.opponent.length,hs=null;for(i=0;i<o_cnt;i++)if("number"!=typeof hs)hs=APP.game.opponent[i].current_score;else if(APP.game.opponent[i].current_score==hs)return!0;return!1},getOpponentCount:function(){return APP.game.opponent.length},getTargetCount:function(){return APP.game.target.length},getTargetValue:function(in_target_index){return APP.game.target[in_target_index].value},getTargetIndex:function(in_target_value){var i,len;for(len=APP.game.target.length,i=0;i<len;i++)if(in_target_value==APP.game.target[i].value)return i;return null},getTargetLabel:function(in_target_index){return APP.game.target[in_target_index].label},isTargetClosedOut:function(in_round,in_target_index,in_except_opponent){var i,len=APP.game.opponent.length;for(i=0;i<len;i++)if(i!=in_except_opponent&&!APP.game.opponent[i].isTargetClosed(in_round,in_target_index))return!1;return!0},resetScores:function(in_score){var i,o_cnt=APP.game.opponent.length;for(i=0;i<o_cnt;i++)APP.game.opponent[i].starting_score=in_score,APP.game.opponent[i].current_score=in_score,APP.game.opponent[i].handicap=0},hasAtLeastOnePlayerEmail:function(){var oi,pl,pl_len,pl_i;for(oi=0;oi<2;oi++)for(pl_len=(pl=APP.game.opponent[oi].team.players).length,pl_i=0;pl_i<pl_len;pl_i++)if(pl[pl_i].email)return!0;return!1},initGameBroadcast:function(){APP.server.checkGamePostBroadcast();var sess=APP.session;if($(".mb-dctv-ld-set-status").html(sess.getLegsStanding()),APP.message_bar.displayM3DA(0,sess.getM3DA("POINTS",0),sess.getM3DA("MARKS",0)),APP.message_bar.displayM3DA(1,sess.getM3DA("POINTS",1),sess.getM3DA("MARKS",1)),"TEAM"==sess.getMatchMode()){if($("#mb-dctv-to-opponent-0").html(APP.game.opponent[0].getChalkboardName()),$("#mb-dctv-to-opponent-1").html(APP.game.opponent[1].getChalkboardName()),$("#mb-dctv-to-names-0").html(APP.game.opponent[0].getDCTVNames()),$("#mb-dctv-to-names-1").html(APP.game.opponent[1].getDCTVNames()),APP.nlf.data.rails){var uniqueId=APP.nlf.rails.getUniqueId(),railsScore=APP.nlf.getLocal(uniqueId,"matchScore");if(-1!==railsScore){var homeScore=0,awayScore=0;railsScore.home&&(homeScore=railsScore.home.set_wins),railsScore.away&&(awayScore=railsScore.away.set_wins),$("#mb-dctv-to-set-score-0").html(homeScore),$("#mb-dctv-to-set-score-1").html(awayScore)}else $("#mb-dctv-to-set-score-0").html(sess.getWins(null,"SETS",0,sess.isSetDone())),$("#mb-dctv-to-set-score-1").html(sess.getWins(null,"SETS",1,sess.isSetDone()))}else sess.isFirstSet()?($("#mb-dctv-to-set-score-0").css("color","dimgray").html("-"),$("#mb-dctv-to-set-score-1").css("color","dimgray").html("-")):($("#mb-dctv-to-set-score-0").html(sess.getWins(null,"SETS",0,sess.isSetDone())),$("#mb-dctv-to-set-score-1").html(sess.getWins(null,"SETS",1,sess.isSetDone())));$("#mb-dctv-to-game-score-0").html(sess.getWins(null,"LEGS",0,!1)),$("#mb-dctv-to-game-score-1").html(sess.getWins(null,"LEGS",1,!1));var html=$("#message-bar-dctv-opponent").clone()[0].outerHTML}else{$("#mb-dctv-tp-names-0").html(APP.game.opponent[0].getDCTVNames()),$("#mb-dctv-tp-names-1").html(APP.game.opponent[1].getDCTVNames()),sess.isFirstSet()?($("#mb-dctv-tp-set-score-0").css("color","dimgray").html("-"),$("#mb-dctv-tp-set-score-1").css("color","dimgray").html("-")):($("#mb-dctv-tp-set-score-0").html(sess.getWins(null,"SETS",0,sess.isSetDone())),$("#mb-dctv-tp-set-score-1").html(sess.getWins(null,"SETS",1,sess.isSetDone()))),$("#mb-dctv-tp-game-score-0").html(sess.getWins(null,"LEGS",0,!1)),$("#mb-dctv-tp-game-score-1").html(sess.getWins(null,"LEGS",1,!1));html=$("#message-bar-dctv-player").clone()[0].outerHTML}var gn=APP.game.name?$("#gsp-settings-title").html():"";"Cricket"==APP.game.name&&"Cricket"!=gn&&(gn+=" Cricket");var sf=APP.session.getMatchFormatSummary();sess.buildSummary();var setScore=[],homeSetScore=APP.noZero(sess.getMatchPoints(null,0,!0)),awaySetScore=APP.noZero(sess.getMatchPoints(null,1,!0));setScore.push(homeSetScore),setScore.push(awaySetScore);var gamePostBroadCast={header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),match_recap_url:sess.getMatchRecapURL(),set_details:sess.bundleBroadcastSetDetails(),eog_stats:"",suggested_out:"",message_bar:html,notable:APP.is_reloading?"":"Game On!",screen_saver:"",other_data:{game_name:sf||"Open Format",game_start_time:APP.game.start_time,set_status:APP.session.getLegsStanding(),tournament_match_score:APP.session.getTournamentMatchScore(),tournament_set_score:setScore,race_info:APP.session.getFullMatchFormatSummary()}};APP.server.postBroadcast(gamePostBroadCast)},hasUserStartedScoring:function(){var oppos=APP.game.opponent;return!!APP.game.started&&(oppos[0].turn[0]&&oppos[0].turn[0].user_input&&oppos[0].turn[0].user_input.length>0||oppos[1].turn[0]&&oppos[1].turn[0].user_input&&oppos[1].turn[0].user_input.length>0)},clearPrevCmds:function(){for(var cmdSeqArr=[],i=0;i<localStorage.length;i++){var key=localStorage.key(i);if(-1!==key.indexOf("__cmd")){JSON.parse(localStorage.getItem(localStorage.key(i)));var order=parseFloat(key.replace(/^\D+/g,""));cmdSeqArr.push(order)}}var cmdSeq=1;cmdSeqArr=cmdSeqArr.sort((function(a,b){return a-b}));for(i=0;i<cmdSeqArr.length;i++){if(cmdSeqArr[i]!=cmdSeq)try{var problemCmd=APP.formatCmd(cmdSeqArr[i]);JSON.stringify(BBAT.fetchData(problemCmd)),BBAT.flushData(problemCmd)}catch(e){}cmdSeq++}},start:function(in_opponent,in_start_time){if(void 0!==in_opponent&&null!=in_opponent){APP.practicePopup.start();APP.game.opponent[0].starting_score,APP.game.opponent[1].starting_score;var i,j,o_cnt=APP.game.opponent.length,o=parseInt(in_opponent,10),mf=APP.session.getMatchFormat()||{};if(APP.header.has_seen_legs_menu=!1,!APP.game.started){for(APP.game.active_round=0,APP.game.active_opponent=in_opponent,APP.game.opponent[0].player_tracking=!0,APP.game.opponent[1].player_tracking=!0,$("#match-control-button").hide(0),APP.game.start_time=in_start_time||new Date,!APP.is_reloading&&"SERVER"==APP.game_master&&APP.device.has_chalk?APP.storeState({settings_change:!0}):APP.storeState(),APP.game.clearPrevCmds(),APP.storeGameEvent({cmd:"START_GAME",cmd_data:{opponent:in_opponent,start_time:APP.game.start_time}}),APP.reveal.setBackButton("CANCEL"),setBotName(0),setBotName(1),"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||(APP.is_reloading?(APP.server.chalking_opponent=BBAT.fetchData("chalking_opponent")||in_opponent,APP.server.chalking_round=BBAT.fetchData("chalking_round")||0):(APP.server.chalking_opponent=in_opponent,APP.server.chalking_round=0),APP.device.has_chalk?APP.reveal.setBackButton("RESET"):APP.reveal.setBackButton("EXIT"),APP.message_bar.show("message-bar-ingame"),APP.reveal.setChalkButton()),APP.device.has_chalk||APP.popup.hide(),APP.lobby.data.mode>0&&APP.popup.hide("popup-lobby"),null==APP.session.current_set&&APP.session.addSet(),APP.game.started=!0,i=0;i<o_cnt;i++)j=(o+i)%o_cnt,APP.game.opponent_order.push(j),APP.game.opponent[j].recalcScore();APP.header.disableEditing(),APP.game.opponent[0].player_order.length=0,APP.game.opponent[1].player_order.length=0,APP.header.enablePlayerOrderProcessing(0),APP.header.enablePlayerOrderProcessing(1),APP.game.opponent[0].team.resetDoubleOutAttempts(),APP.game.opponent[1].team.resetDoubleOutAttempts(),APP.game_selector.hide(),APP.session.hideBullShoot(),APP.keypad_points.setSpeedKeys(),APP.device.has_chalk?APP.reveal.hideButtonBar((function(){APP.message_bar.clear(),APP.game.plugin.handlePostStart(),APP.is_reloading||(APP.session.isNewSet()?(!APP.game.opponent[0].team.players||APP.game.opponent[0].team.players.length<=1)&&(!APP.game.opponent[1].team.players||APP.game.opponent[1].team.players.length<=1)&&APP.popup.show("popup-notable","Game On!"):APP.popup.show("popup-notable",APP.session.getWins(null,"LEGS",0,!1)+" - "+APP.session.getWins(null,"LEGS",1,!1))),APP.changeMode("IN-GAME"),testbot.init(),APP.game.hasAnyoneScored()?APP.session.hideChangePlayerDiv():(APP.is_reloading||APP.tacticsResize.toggle(),APP.session.showChangePlayerDiv()),APP.device.is_broadcasting&&APP.game.initGameBroadcast()})):(APP.message_bar.clear(),APP.game.plugin.handlePostStart(),APP.is_reloading||(APP.session.isNewSet()?(!APP.game.opponent[0].team.players||APP.game.opponent[0].team.players.length<=1)&&(!APP.game.opponent[1].team.players||APP.game.opponent[1].team.players.length<=1)&&(APP.popup.show("popup-notable","Game On!"),testbot.init(),APP.game.hasAnyoneScored()?APP.session.hideChangePlayerDiv():APP.session.showChangePlayerDiv()):APP.popup.show("popup-notable",APP.session.getWins(null,"LEGS",0,!1)+" - "+APP.session.getWins(null,"LEGS",1,!1))),APP.changeMode("IN-GAME"),testbot.init(),APP.game.hasAnyoneScored()?APP.session.hideChangePlayerDiv():APP.session.showChangePlayerDiv(),APP.device.is_broadcasting&&APP.game.initGameBroadcast()),!APP.device.has_chalk||APP.session.isNewMatch()||!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit||"ALTERNATE"!=mf.next_game||!APP.session.isSameGameAgain()||mf.legs||APP.header.showSetSetup()}}function setBotName(in_opponent_index){var p=APP.game.opponent[in_opponent_index].team.players[0];p&&p.is_bot&&(p.chalkboard_name=APP.dartbot.getName(p.bot_skill),p.first_name=p.chalkboard_name,p.last_name=null)}},getGameName:function(in_full_name){var name,g=APP.game;switch(g.name){case"01":var outText=g.getOption("double_out")?"DO":"SO";return g.getOption("master_out")&&(outText="MO"),name=""+(g.opponent[0].starting_score!=g.opponent[1].starting_score?"x01":g.opponent[0].starting_score),in_full_name&&(name+=g.getOption("double_in")?" DI":g.getOption("all_player_double_in")?" ADI":" SI",name+=outText),name;case"Cricket":switch(g.getOption("variation")){case"DROP 10":return"Drop 10"+(in_full_name?" Cricket":"");case"MARK UP":return"Mark Up"+(in_full_name?" Cricket":"");case"STRAIGHT":return"Straight"+(in_full_name?" Cricket":"");case"EXTENDED":return"Extended"+(in_full_name?" Cricket":"");case"NO POINTS":return"No Points"+(in_full_name?" Cricket":"");case"CUSTOM":return"Custom"+(in_full_name?" Cricket":"");case"STANDARD":return"Cricket";case"TACTICS NL":return"Tactics NL";case"TACTICS 10":return"Tactics 10";case"TACTICS 11":return"Tactics 11";case"TACTICS 12":return"Tactics 12";default:return"??"}break;case"Library":return""+g.getOption("dyg_name")}},getGameOptsLabel:function(optsObj){try{if(!optsObj)return!1;var label="";return optsObj.no_bull&&(label+="No Bull",label+=" | "),optsObj.call&&(label+="Call",label+=" | "),optsObj.no_points&&(label+="No Points",label+=" | "),label=label.substring(0,label.length-3)}catch(e){}return!1},isEOGFinal:function(){return APP.game.finished,!1},missingFormat:function(){try{if("PARTICIPANT"!==APP.device.role)return!1;var match=APP.getMatch();if(!match)return!0;if(!match.format)return!0}catch(e){}return!1},finish:function(in_dart,in_finish_time,in_winning_opponent,in_next_cmd_obj,in_cmd_obj){if(APP.game.missingFormat())return APP.recordError("Missing Host - Missing Format"),void APP.kickDeviceOut();var three_da_0,three_da_1;APP.game.select_winning_dart=!1,APP.header.disableEditing(),APP.game.finish_time=in_finish_time||new Date,null!=in_winning_opponent&&(APP.game.winning_opponent=in_winning_opponent),APP.game.opponent[0].applyDoubleOutAttempts(),APP.game.opponent[1].applyDoubleOutAttempts(),APP.game.winning_dart=in_dart,APP.game.plugin.handlePreFinish(in_next_cmd_obj),APP.game.finished=!0,APP.game.elapsed_time=APP.game.finish_time-APP.game.start_time,APP.game.elapsed_time=APP.game.elapsed_time,null!=APP.game.winning_opponent&&(APP.game.opponent[APP.game.winning_opponent].turn[APP.game.current_round].darts_thrown=in_dart,APP.game.opponent[APP.game.winning_opponent].recalcRunning3DA()),APP.game.opponent[0].setTurnPlayers(),APP.game.opponent[1].setTurnPlayers(),APP.game.calcStats(),APP.reveal.buildEOGStatsPanel(APP.game.options.stats_type),APP.is_reloading||("MARKS"==APP.game.options.stats_type?(three_da_0=null==APP.game.opponent[0].getStat("mpr")?0:APP.game.opponent[0].getStat("mpr").toFixed(2)+"M",three_da_1=null==APP.game.opponent[1].getStat("mpr")?0:APP.game.opponent[1].getStat("mpr").toFixed(2)+"M"):(three_da_0=null==APP.game.opponent[0].getStat("ppr")?0:APP.game.opponent[0].getStat("ppr").toFixed(2)+"P",three_da_1=null==APP.game.opponent[1].getStat("ppr")?0:APP.game.opponent[1].getStat("ppr").toFixed(2)+"P")),APP.game.checkForPerfection()&&(APP.game.nine_darter=!0,APP.popup.show("popup-notable","9 Darter!")),APP.nlf.rails.isPracticeMatch()&&(APP.game.league_practice_game=!0);var scoreEdits=APP.session.matches[APP.session.current_match].leg_score_edits;if(scoreEdits&&scoreEdits.length&&(APP.game.score_edits=JSON.parse(JSON.stringify(scoreEdits)),APP.session.matches[APP.session.matches.length-1].leg_score_edits=[],APP.session.store(APP.session.current_match)),APP.lobby.data.isInMatch){var cm=APP.session.matches[APP.session.current_match],lobbyObj={is_lobby_match:!0},aLeague=APP.lobby.data.activeLeague;aLeague&&(lobbyObj.league_id=aLeague.league_id,"Y"===aLeague.is_challenge_league&&(lobbyObj.is_challenge_league="Y",lobbyObj.league_division_guid=aLeague.league_division_guid,lobbyObj.team_guid=aLeague.team_guid,lobbyObj.season_id=aLeague.season_id)),cm.lobby_data=lobbyObj,APP.session.store(APP.session.current_match)}APP.session.isGameRecorded(APP.game.start_time)||APP.session.addGameResults({abandoned:!1,start_time:APP.game.start_time,ending_scores:[APP.game.opponent[0].current_score,APP.game.opponent[1].current_score],game_name:APP.game.getGameName(),game_type:APP.game.name,starting_opponent:APP.game.opponent_order[0],starting_scores:[APP.game.opponent[0].starting_score,APP.game.opponent[1].starting_score],three_da:[three_da_0,three_da_1],winning_opponent:APP.game.winning_opponent,rounds_played:APP.game.opponent[0].turn.length,track_do_attempts:APP.user_options.do_attempts,game:APP.game}),APP.device.has_chalk||APP.starpubs.checkForTiebreaker()&&APP.starpubs.showSelectTieBreakPlayer(),APP.reveal.clearAllPanels((function(){null==in_next_cmd_obj&&(APP.session.captureReloadData(),in_cmd_obj&&"FINISH_GAME"==in_cmd_obj.cmd?APP.scoreboard.showEOGStatus({is_set_end:in_cmd_obj.cmd_data.is_set_end,is_match_end:in_cmd_obj.cmd_data.is_match_end}):APP.scoreboard.showEOGStatus()),APP.device.has_chalk?APP.reveal.showButtonBar("button-bar-endgame"):("HOST"==APP.device.role&&($("#bb-g-rejoin").removeClass("button-green").addClass("button-gold").html("Control the Match"),APP.device.enableButton("bb-g-rejoin",!0)),APP.reveal.showButtonBar("button-bar-guest"))})),APP.reveal.setChalkButton(),APP.device.has_chalk?APP.reveal.setBackButton("OPTIONS"):(APP.device.enableButton("bb-g-stats",!0),"PARTICIPANT"==APP.device.role?APP.reveal.setBackButton("EXIT"):APP.reveal.setBackButton("RESET"));var gt=BBAT.formatElapsedMilliseconds(APP.session.getTotalTime("GAME"),"MS"),st=BBAT.formatElapsedMilliseconds(APP.session.getTotalTime("SET"),"MS");APP.reveal.showGameTime(gt+" / "+st),APP.message_bar.show("message-bar-status"),APP.message_bar.refreshStatusMessage(),APP.header.refresh();var headerHtml=(headerHtml=$("#header").html()).replace(/\t|\n|\r/g,""),scoreboardHtml=(scoreboardHtml=$("#scoreboard-center").html()).replace(/\t|\n|\r/g,""),messageBarHtml=(messageBarHtml=$("#message-bar-status").clone()[0].outerHTML).replace(/\t|\n|\r/g,""),eogStatsHtml=(eogStatsHtml=$("#eog-stats-center").html()).replace(/\t|\n|\r/g,"");if(!APP.is_reloading&&APP.device.is_broadcasting){var gamePostBroadCast={header:headerHtml,scoreboard:scoreboardHtml,message_bar:messageBarHtml,eog_stats:eogStatsHtml,match_recap_url:APP.session.getMatchRecapURL(),set_details:APP.session.bundleBroadcastSetDetails(),extended_details:APP.session.getExtendedBroadcastDetails(),other_data:{game_time:gt,set_status:APP.session.getLegsStanding(),tournament_match_score:APP.session.getTournamentMatchScore(),race_info:APP.session.getFullMatchFormatSummary()},suggested_out:"",notable:"Game",is_nine_darter:APP.game.checkForPerfection(),nine_dart_player:APP.game.checkForPerfection()?APP.game.getNineDarterDetails():null};gamePostBroadCast.force_match_broadcast_id=APP.session.getMatchBroadcastID(),BBAT.storeData({game_postbroadcast:gamePostBroadCast}),APP.server.postBroadcast(gamePostBroadCast,"","",(function(){BBAT.flushData("game_postbroadcast")}))}},confirmWinner:function(in_spec){var html,leg_html_0,leg_html_1,ao=APP.game.active_opponent,leg_wins=APP.session.getLegsStanding().split(" - ");function disableGSW(){APP.user_options.game_shot=!1,APP.storeUserOptions(),in_spec.cancel(),APP.confirm.hide()}leg_wins[0]=parseInt(leg_wins[0]),leg_wins[1]=parseInt(leg_wins[1]),0==ao?(leg_html_0='<span style="color:red;">'+(leg_wins[0]+1)+"</span>",leg_html_1=leg_wins[1]):(leg_html_0=leg_wins[0],leg_html_1='<span style="color:red;">'+(leg_wins[1]+1)+"</span>"),html='<p style="font-size:2em;font-weight:bold;color:red;margin:0.5em 0 0.3em;">'+$("#hdr-name-"+ao).html()+'</p><p style="font-size:2em;font-weight:bold;">'+leg_html_0+" - "+leg_html_1+'</p><p id="cw-turn-off-gsw" class="button button-enabled" style="color:blue;margin-bottom:1.5em;line-height:1.25em;font-style:italic;">Hide this confirmation</p><a href="" target="_self" class="refresh-app mBottom posAbs">Refresh App</a>';APP.confirm.show({title:"Game Shot Winner:",msg:html,ok_text:"Confirm",cancel_text:"Change",ok:function(){$("#confirm").removeClass("refresh-link-padding"),in_spec.ok()},cancel:function(){$("#confirm").removeClass("refresh-link-padding"),in_spec.cancel()},post_display:function(){APP.device.addButtonHandler(["cw-turn-off-gsw"],disableGSW),APP.device.setButtonEvents("#cw-turn-off-gsw"),$("#confirm").addClass("refresh-link-padding")}})},do_attempts:null,resetDoubleOutAttempts:function(){APP.game.do_attempts={opponent_index:null,round_index:null,callback:null}},showDoubleOutAttempts:function(in_opponent_index,in_round_index,in_choices,in_callback){var i,oppo=APP.game.opponent[in_opponent_index];oppo.turn[in_round_index];if(1==oppo.team.players.length)var pi=0;else{if(0==oppo.player_order.length)return void in_callback();pi=oppo.player_order[in_round_index%oppo.player_order.length]}oppo.team.players[pi];if(APP.game.resetDoubleOutAttempts(),APP.game.do_attempts.opponent_index=in_opponent_index,APP.game.do_attempts.round_index=in_round_index,APP.game.do_attempts.callback=in_callback,in_choices){for(APP.device.disableButtonClass("button-pda"),i=0;i<4;i++)in_choices[i]&&APP.device.enableButton("pda-"+i,!0);$("#popup-do-attempts-overlay").show(0),$("#popup-do-attempts").show(0)}},handleDoubleOutAttempts:function(in_id){APP.device.disableButton("pda-1"),APP.device.disableButton("pda-2"),APP.device.disableButton("pda-3");var attempts=APP.extractLastNumberSegment(in_id),doa=APP.game.do_attempts,callback=doa.callback;APP.is_reloading||APP.storeGameEvent({cmd:"DO_ATTEMPTS",cmd_data:{opponent_index:doa.opponent_index,round_index:doa.round_index,attempts:attempts}}),APP.game.processDoubleOutAttempts({opponent_index:doa.opponent_index,round_index:doa.round_index,attempts:attempts}),APP.game.resetDoubleOutAttempts(),$("#popup-do-attempts").hide(0),$("#popup-do-attempts-overlay").hide(0),callback()},processDoubleOutAttempts:function(in_params){var turn=APP.game.opponent[in_params.opponent_index].turn[in_params.round_index];try{turn.do_attempts=in_params.attempts}catch(e){}},bust_darts:null,is_busting_darts:!1,resetBustDarts:function(){APP.game.bust_darts={opponent_index:null,round_index:null,score:null,callback:null}},showBustDarts:function(in_opponent_index,in_round_index,in_score,in_callback){var i,oppo=APP.game.opponent[in_opponent_index];oppo.turn[in_round_index];if(1==oppo.team.players.length)var pi=0;else{if(0==oppo.player_order.length)return void in_callback();pi=oppo.player_order[in_round_index%oppo.player_order.length]}oppo.team.players[pi];if(APP.game.resetBustDarts(),APP.game.bust_darts.opponent_index=in_opponent_index,APP.game.bust_darts.round_index=in_round_index,APP.game.bust_darts.callback=in_callback,in_score){APP.game.bust_darts.score=in_score;var choices=APP.game.calculateBustDarts(in_score);if(choices){for(APP.device.disableButtonClass("button-pbd"),i=0;i<=3;i++)choices[i]&&APP.device.enableButton("pbd-"+(i+1),!0);$("#popup-bust-darts-overlay").show(0),$("#popup-bust-darts").show(0),APP.device.pauseKeyboardHandler()}}},calculateBustDarts:function(in_score){return in_score>=122&&in_score<=181?[!1,!1,!0]:in_score>=62&&in_score<=121?[!1,!0,!0]:in_score>=2&&in_score<=61&&[!0,!0,!0]},handleBustDarts:function(in_id){APP.device.disableButton("pbd-1"),APP.device.disableButton("pbd-2"),APP.device.disableButton("pbd-3");var attempts=APP.extractLastNumberSegment(in_id),bd=APP.game.bust_darts,callback=bd.callback;bd.attempts=attempts,$("#popup-bust-darts-overlay").hide(0),$("#popup-bust-darts").hide(0),APP.device.resumeKeyboardHandler(),callback&&(APP.game.is_busting_darts=!0,callback(),APP.game.registerBustDarts(),APP.game.is_busting_darts=!1)},registerBustDarts:function(){var bd=APP.game.bust_darts;APP.is_reloading||APP.storeGameEvent({cmd:"BUST_DARTS",cmd_data:{opponent_index:bd.opponent_index,round_index:bd.round_index,attempts:bd.attempts}}),APP.game.processBustDarts({opponent_index:bd.opponent_index,round_index:bd.round_index,attempts:bd.attempts}),APP.game.resetBustDarts(),APP.device.releaseChalk(!0)},processBustDarts:function(in_params){var oppo=APP.game.opponent[in_params.opponent_index],turn=oppo.turn[in_params.round_index];try{turn.darts_thrown=in_params.attempts,oppo.recalcRunning3DA(),APP.header.refresh()}catch(e){}},explainBustDarts:function(){APP.alert.show("\n\t\t\tThis match is using the Modified Bust Rule which does not include darts not thrown in your average. \n\t\t\t<br /><br />\n\t\t\tThis will inflate a player's average when compared to the standard of counting all 3 darts \n\t\t")},disableBustDarts:function(id,preflight){if(preflight){APP.userOptions.updateOption({option:"bust_darts",val:!1})}else{APP.confirm.show({title:"Disable Modified Bust Rule",msg:"\n\t\t\t\tAre you sure you want to disable the Modified Bust Rule?\n\t\t\t\t<br /><br />\n\t\t\t\tA bust will always register 3 darts from now on.\n\t\t\t\t<br /><br />\n\t\t\t\tThe feature can be reactivated in settings\n\t\t\t",ok_text:"Disable",cancel_text:"Cancel",ok:function(){APP.game.disableBustDarts(id,!0)}})}},resetEOG:function(in_cancel_gsw){var i,o_cnt,stat;APP.game.finished;for(APP.game.select_winning_dart=null,APP.game.winning_opponent=null,APP.game.winning_dart=null,APP.game.finish_time=null,APP.game.elapsed_time=null,APP.game.finished=!1,$("#seo-set-control").data("data-cancel-save",null),o_cnt=APP.game.opponent.length,i=0;i<o_cnt;i++)for(stat in APP.game.opponent[i].stats)APP.game.opponent[i].stats[stat]=null;APP.device.has_chalk?APP.reveal.setBackButton("RESET"):(APP.reveal.setBackButton("EXIT"),APP.device.enableButton("bb-g-stats",!0)),APP.session.isGameRecorded(APP.game.start_time)&&APP.session.popGameResults(),APP.game.opponent[0].player_tracking&&APP.game.opponent[0].team.players.length>1&&APP.header.enablePlayerOrderMenu(0),APP.game.opponent[1].player_tracking&&APP.game.opponent[1].team.players.length>1&&APP.header.enablePlayerOrderMenu(1),APP.scoreboard.hideEOGStatus(),APP.reveal.updateSetStatus(),!APP.is_reloading&&APP.device.is_broadcasting&&APP.game.initGameBroadcast()},calcStats:function(){var cr,darts,darts_double_bulls,darts_doubles,darts_first_3,darts_last,darts_last_3,darts_missed,darts_others,darts_single_bulls,darts_singles,darts_triples,dt,entry,first_score,first_scoring_turn,hi_m,hi_m_turn,hi_bull,hi_bull_turn,hi_p,hi_p_turn,i,last_r,last_turn,last_turn_score,marks,marks_scored,modifier,ms,o,o_cnt,opnt,p,points,r,score_first_3,score_last_3,score_others,target_index,target_label,turns,turns_100,turns_5,turns_bust,turns_miss,turn_bull_marks,top_three,s,double_in_3da,isForfeit=!1;for(null!==APP.game.leg_forfeit&&(isForfeit=!0),cr=APP.game.current_round,APP.game.getTargetCount(),o_cnt=APP.game.opponent.length,o=0;o<o_cnt&&o<APP.game.opponent_count;o++)if(darts=0,darts_double_bulls=0,darts_doubles=0,darts_first_3=0,darts_last=0,darts_last_3=0,darts_missed=0,darts_others=0,darts_single_bulls=0,darts_singles=0,darts_triples=0,first_score=0,first_scoring_turn=0,hi_m=0,hi_m_turn=0,hi_bull=0,hi_bull_turn=0,hi_p=0,hi_p_turn=0,last_turn=0,last_turn_score=0,marks=0,marks_scored=0,points=0,score_first_3=null,score_last_3=null,score_others=null,turns=0,turns_100=0,turns_5=0,turns_bust=0,turns_miss=0,top_three=[0,0,0],double_in_3da=null,last_r=null==(opnt=APP.game.opponent[o]).turn[cr].points?cr-1:cr,"MARKS"==APP.game.options.stats_type)if(APP.game.options.marksman_scoring){for(r=0;r<=cr;r++)if(turn_bull_marks=0,null!=opnt.turn[r].points){for(turns+=1,darts+=3,points+=opnt.turn[r].points,marks+=opnt.turn[r].marks_recorded||0,marks_scored+=ms=opnt.turn[r].marks_scored||0,0==first_scoring_turn&&ms>0&&(first_scoring_turn=r+1,first_score=ms),last_turn=r+1,last_turn_score=ms,r<3&&(darts_first_3+=3,score_first_3=score_first_3?score_first_3+ms:ms),r>last_r-3&&(darts_last_3+=3,score_last_3=score_last_3?score_last_3+ms:ms),r<3||r>last_r-3||(darts_others+=3,score_others=score_others?score_others+ms:ms),ms>hi_m&&(hi_m=ms,hi_m_turn=r+1),s=0;s<3;s++)if(ms>top_three[s]){top_three.splice(s,0,ms),top_three.length=3;break}for(0==ms?turns_miss++:ms>=5&&turns_5++,i=0;i<opnt.turn[r].user_input.length;i++)if("0"!=(entry=opnt.turn[r].user_input[i]))if(target_index=parseInt(entry,10),target_label=APP.game.getTargetLabel(target_index),modifier=entry.right(1),"B"==target_label)"D"==modifier?(turn_bull_marks+=2,darts_double_bulls+=1):(turn_bull_marks+=1,darts_single_bulls+=1);else switch(modifier){case"T":darts_triples+=1;break;case"D":darts_doubles+=1;break;case"S":darts_singles+=1}turn_bull_marks>hi_bull&&(hi_bull=turn_bull_marks,hi_bull_turn=r+1)}o==APP.game.winning_opponent&&(darts_last_3=darts_last_3-3+(darts_last=parseInt(APP.game.winning_dart,10)),darts=darts-3+darts_last),darts_missed=darts-darts_singles-darts_doubles-darts_triples-darts_single_bulls-darts_double_bulls,opnt.stats.darts_single_bulls=darts_single_bulls,opnt.stats.darts_doubles=darts_doubles,opnt.stats.darts_double_bulls=darts_double_bulls,opnt.stats.darts_missed=darts_missed,opnt.stats.darts_thrown=darts,opnt.stats.darts_singles=darts_singles,opnt.stats.darts_triples=darts_triples,opnt.stats.points=points,opnt.stats.marks_recorded=marks,opnt.stats.marks_scored=marks_scored,opnt.stats.top_three=top_three.slice(0),opnt.stats.turns_played=turns,opnt.stats.turns_miss=turns_miss,opnt.stats.turns_5_marks=turns_5,opnt.stats.hi_marks=hi_m,opnt.stats.hi_marks_turn=hi_m_turn,opnt.stats.hi_bull=hi_bull,opnt.stats.hi_bull_turn=hi_bull_turn,0==turns?(opnt.stats.mpr=null,opnt.stats.mpd=null):(opnt.stats.mpr=0+BBAT.round(marks_scored/darts*3,2),opnt.stats.mpd=0+BBAT.round(marks_scored/darts,2)),opnt.stats.tda_first_3=null==score_first_3?null:BBAT.round(score_first_3/9*3,1),opnt.stats.tda_last_3=null==score_last_3?null:BBAT.round(score_last_3/(6+darts_last)*3,1),opnt.stats.tda_others=null==score_others?null:BBAT.round(score_others/(darts-9-(6+darts_last))*3,1),opnt.stats.first_scoring_turn=first_scoring_turn,opnt.stats.first_score=first_score,o==APP.game.winning_opponent&&(opnt.stats.winning_turn=last_turn,opnt.stats.winning_score=last_turn_score),APP.message_bar.displayEOGStat(o,null==opnt.stats.mpr?"":opnt.stats.mpr.toFixed(1))}else{for(r=0;r<=cr;r++)if(turn_bull_marks=0,null!=opnt.turn[r].points){for(turns+=1,darts+=3,points+=opnt.turn[r].points,marks+=opnt.turn[r].marks_recorded||0,marks_scored+=ms=opnt.turn[r].marks_scored||0,0==first_scoring_turn&&ms>0&&(first_scoring_turn=r+1,first_score=ms),last_turn=r+1,last_turn_score=ms,r<3&&(darts_first_3+=3,score_first_3=score_first_3?score_first_3+ms:ms),r>last_r-3&&(darts_last_3+=3,score_last_3=score_last_3?score_last_3+ms:ms),r<3||r>last_r-3||(darts_others+=3,score_others=score_others?score_others+ms:ms),ms>hi_m&&(hi_m=ms,hi_m_turn=r+1),s=0;s<3;s++)if(ms>top_three[s]){top_three.splice(s,0,ms),top_three.length=3;break}if(0==ms?turns_miss++:ms>=5&&turns_5++,"Cricket"==APP.game.name)for(i=0;i<opnt.turn[r].user_input.length;i++)entry=opnt.turn[r].user_input[i],"B"==APP.game.getTargetLabel(parseInt(entry,10))&&turn_bull_marks++;turn_bull_marks>hi_bull&&(hi_bull=turn_bull_marks,hi_bull_turn=r+1)}o==APP.game.winning_opponent&&(darts_last_3=darts_last_3-3+(darts_last=parseInt(APP.game.winning_dart,10)),darts=darts-3+darts_last),0==turns||APP.game.options.special_targets||APP.game.options.miss_half?(opnt.stats.marks_scored=null,opnt.stats.turns_miss=null,opnt.stats.turns_5_marks=null,opnt.stats.hi_marks=null,opnt.stats.hi_marks_turn=null,opnt.stats.hi_bull=null,opnt.stats.hi_bull_turn=null,opnt.stats.mpr=null,opnt.stats.mpd=null,opnt.stats.tda_first_3=null,opnt.stats.tda_last_3=null,opnt.stats.tda_others=null,opnt.stats.top_three=null,opnt.stats.first_scoring_turn=null,opnt.stats.first_score=null):(opnt.stats.marks_scored=marks_scored,opnt.stats.turns_miss=turns_miss,opnt.stats.turns_5_marks=turns_5,opnt.stats.hi_marks=hi_m,opnt.stats.hi_marks_turn=hi_m_turn,opnt.stats.hi_bull=hi_bull,opnt.stats.hi_bull_turn=hi_bull_turn,opnt.stats.mpr=0+BBAT.round(marks_scored/darts*3,2),opnt.stats.mpd=0+BBAT.round(marks_scored/darts,2),opnt.stats.tda_first_3=null==score_first_3?null:BBAT.round(score_first_3/9*3,2),opnt.stats.tda_last_3=null==score_last_3?null:BBAT.round(score_last_3/(6+darts_last)*3,2),opnt.stats.tda_others=null==score_others?null:BBAT.round(score_others/(darts-9-(6+darts_last))*3,2),opnt.stats.top_three=top_three.slice(0),opnt.stats.first_scoring_turn=first_scoring_turn,opnt.stats.first_score=first_score,APP.game.winning_opponent==o&&(opnt.stats.winning_turn=last_turn,opnt.stats.winning_score=last_turn_score)),opnt.stats.turns_played=turns,opnt.stats.darts_thrown=darts,opnt.stats.points=points,APP.message_bar.displayEOGStat(o,null==opnt.stats.mpr?"":opnt.stats.mpr.toFixed(1))}else{var dartsThrownTotal=0;for(r=0;r<=cr;r++)if(p=opnt.turn[r].points,dartsThrownTotal+=dt=opnt.turn[r].darts_thrown,null!=p&&!isForfeit){for(turns++,darts+=dt,points+=p,0==first_scoring_turn&&p>0&&(first_scoring_turn=r+1,first_score=p,APP.game.options.double_in&&(double_in_3da=BBAT.round(p/first_scoring_turn,2))),p>0&&(last_turn=r+1,last_turn_score=p),r<3&&(darts_first_3+=3,score_first_3=score_first_3?score_first_3+p:p),r>last_r-3&&(darts_last_3+=3,score_last_3=score_last_3?score_last_3+p:p),r<3||r>last_r-3||(darts_others+=3,score_others=score_others?score_others+p:p),p>hi_p&&(hi_p=p,hi_p_turn=r+1),s=0;s<3;s++)if(p>top_three[s]){top_three.splice(s,0,p),top_three.length=3;break}0==p?"Miss"==opnt.turn[r].color?turns_miss++:turns_bust++:p>=100&&turns_100++}o!=APP.game.winning_opponent||isForfeit||(darts_last_3=darts_last_3-3+(darts_last=parseInt(APP.game.winning_dart,10)),darts=darts-3+darts_last),darts>0&&!isForfeit?(opnt.stats.oda=0+BBAT.round(points/dartsThrownTotal,1),opnt.stats.ppd=0+BBAT.round(points/dartsThrownTotal,1),opnt.stats.ppr=BBAT.round(points/dartsThrownTotal*3,1),opnt.stats.tda_first_3=null==score_first_3?null:BBAT.round(score_first_3/darts_first_3*3,1),opnt.stats.tda_last_3=null==score_last_3?null:BBAT.round(score_last_3/darts_last_3*3,1),opnt.stats.tda_others=null==score_others?null:BBAT.round(score_others/darts_others*3,1),opnt.stats.turns_played=turns,opnt.stats.darts_thrown=dartsThrownTotal,opnt.stats.points=points,opnt.stats.turns_miss=turns_miss,opnt.stats.turns_bust=turns_bust,opnt.stats.turns_100_points=turns_100,opnt.stats.hi_points=hi_p,opnt.stats.hi_points_turn=hi_p_turn,opnt.stats.first_scoring_turn=first_scoring_turn,opnt.stats.first_score=first_score,opnt.stats.double_in_3da=double_in_3da,opnt.stats.top_three=top_three.slice(0),APP.game.winning_opponent==o&&(opnt.stats.winning_turn=last_turn,opnt.stats.winning_score=last_turn_score)):(opnt.stats.turns_played=0,opnt.stats.darts_thrown=0,opnt.stats.points=0,opnt.stats.oda=null,opnt.stats.ppd=null,opnt.stats.ppr=null,opnt.stats.tda_first_3=null,opnt.stats.tda_last_3=null,opnt.stats.tda_others=null,opnt.stats.turns_miss=null,opnt.stats.turns_bust=null,opnt.stats.turns_100_points=null,opnt.stats.hi_points=null,opnt.stats.hi_points_turn=null,opnt.stats.first_scoring_turn=null,opnt.stats.first_score=null,opnt.stats.double_in_3da=null,opnt.stats.top_three=top_three);var myAvg=null==opnt.stats.ppr?"":opnt.stats.ppr.toFixed(0);APP.user_options.running_1da&&(myAvg=null==opnt.stats.ppd?"":opnt.stats.ppd.toFixed(0)),APP.message_bar.displayEOGStat(o,myAvg)}},checkForPerfection:function(){if(!APP.session.isBracketMatch())return!1;if("01"!=APP.game.options.type||501!=APP.game.options.starting_score||"POINTS"!=APP.game.options.stats_type)return!1;var o,o_cnt=APP.game.opponent.length;for(o=0;o<o_cnt&&o<APP.game.opponent_count;o++)if(opnt=APP.game.opponent[o],0===opnt.current_score&&3===opnt.turn.length)return!0;return!1},getNineDarterDetails:function(){if("01"!=APP.game.options.type||501!=APP.game.options.starting_score||"POINTS"!=APP.game.options.stats_type)return null;var o,o_cnt=APP.game.opponent.length;for(o=0;o<o_cnt&&o<APP.game.opponent_count;o++)if(opnt=APP.game.opponent[o],0===opnt.current_score&&3===opnt.turn.length){var loser=APP.game.opponent[1];o&&(loser=APP.game.opponent[0]);for(var loserTurnArr=[],i=0;i<loser.turn.length;i++)loser.turn[i].points&&loserTurnArr.push(loser.turn[i].points);var winnerTurnArr=[];for(i=0;i<opnt.turn.length;i++)opnt.turn[i].points&&winnerTurnArr.push(opnt.turn[i].points);var sess=APP.session,dataObj={winner:opnt.start_button_name,loser:loser.start_button_name,winner_scores:winnerTurnArr,loser_scores:loserTurnArr,winner_pos:sess.getPrevGameWinningOpponent()},bracketObj=sess.getBracketMatchObject(),mf=sess.getMatchFormat();return bracketObj&&(sess.bracket.tournament_id&&(dataObj.tournament_id=sess.bracket.tournament_id),dataObj.event_id=bracketObj.bracket_event_id,dataObj.bracket_match_id=bracketObj.bracket_match_id,dataObj.leg_score=sess.matches[sess.current_match].game_wins.join("-"),null!==mf.sets&&mf.sets.limit&&mf.sets.limit>1&&(dataObj.set_score=sess.matches[sess.current_match].set_wins.join("-"))),dataObj}return null},isAutoBalanceActive:function(){try{if(APP.user_options.auto_balance&&!APP.device.is_hosting&&"PARTICIPANT"!=APP.device.role)return!0}catch(e){newErrorReport(e,"Auto Balance Bug",!1)}return!1},setInitialAutoBalanceHandicap:function(force){if(APP.game.isAutoBalanceActive())try{var obj={initial_handicap_1:APP.game.opponent[0].getHandicap(),initial_handicap_2:APP.game.opponent[1].getHandicap()};BBAT.storeData({auto_balance:obj})}catch(e){newErrorReport(e,"Auto Balance Bug",!1)}},calculateAutoBalance:function(){try{var handicapPoints,handicapLegScore,handicapRemainder=0,p1Score=APP.session.getWins(null,"LEGS",0),p2Score=APP.session.getWins(null,"LEGS",1),initalHandicap1=0,initalHandicap2=0,initialHandicaps=BBAT.fetchData("auto_balance");if(initialHandicaps&&(initialHandicaps.initial_handicap_1&&(initalHandicap1=initialHandicaps.initial_handicap_1),initialHandicaps.initial_handicap_2&&(initalHandicap2=initialHandicaps.initial_handicap_2)),p1Score>p2Score){handicapPoints=(p1Score-p2Score)*(handicapLegScore=APP.session.getM3DA("POINTS",0));var removed=!1;if(initalHandicap2>0){if((tempHandicap=initalHandicap2-handicapPoints)<0)(remainder=handicapPoints-initalHandicap2)>handicapLegScore&&(handicapRemainder=Math.round(remainder/handicapLegScore)*handicapLegScore);tempHandicap<0&&(tempHandicap=0),initalHandicap2=tempHandicap,removed=!0}return p1Handicap=handicapRemainder||(removed?initalHandicap1:initalHandicap1+handicapPoints),p2Handicap=initalHandicap2,[p1Handicap,p2Handicap]}if(p1Score<p2Score){handicapPoints=(p2Score-p1Score)*(handicapLegScore=APP.session.getM3DA("POINTS",1));removed=!1;if(initalHandicap1>0){var tempHandicap,remainder;if((tempHandicap=initalHandicap1-handicapPoints)<0)(remainder=handicapPoints-initalHandicap1)>handicapLegScore&&(handicapRemainder=Math.round(remainder/handicapLegScore)*handicapLegScore);tempHandicap<0&&(tempHandicap=0),initalHandicap1=tempHandicap,removed=!0}return p2Handicap=handicapRemainder||(removed?initalHandicap2:initalHandicap2+handicapPoints),p1Handicap=initalHandicap1,[p1Handicap,p2Handicap]}return[initalHandicap1,initalHandicap2]}catch(e){newErrorReport(e,"Auto Balance Bug",!1)}return[0,0]},applyAutoBalance:function(){var handicaps;handicaps=APP.game.calculateAutoBalance(),APP.game.opponent[0].setHandicap(handicaps[0]),APP.game.opponent[1].setHandicap(handicaps[1]),APP.header.refresh()}},APP.game_selector={index:null,choice:[{name:"Library",plugin:null},{name:"01",plugin:null},{name:"Cricket",plugin:null}],init:function(){APP.game_selector.choice[0].plugin=APP.plugin_library,APP.game_selector.choice[1].plugin=APP.plugin_01,APP.game_selector.choice[2].plugin=APP.plugin_cricket,APP.game_selector.selectGame(null),APP.game.plugin.initGamePanel(),APP.device.addButtonHandler(["gsp-menu","gs-cricket","gs-01","gs-library","gs-game-on","gs-select-opponents","gs-play-now"],APP.game_selector.selectGame)},setPlayerButton:function(in_mode){$("#bb-e-new-players").removeClass("button-red").html("Match Setup")},refreshGamePanel:function(){function hideAll(){$("#gs-select-opponents").hide(0),$("#gs-play-now").hide(0),$("#gsp-player-hint").hide(0),$("#gsp-player-section").hide(0),$("#gsp-menu").hide(0)}APP.session.isBracketMatch()&&(APP.session.getRoundRobinLegs(),APP.session.isBracketPrescribedMatch()&&APP.header.areValidOpponentsSelected()?APP.device.disableButton("bb-e-new-players"):APP.device.enableButton("bb-e-new-players",!0),APP.session.isBracketPracticeMatch()&&APP.device.disableButton("bb-e-new-players")),isSolo501()&&APP.device.disableButton("bb-e-new-players"),APP.game.started?(hideAll(),APP.session.hideBullShoot()):APP.game.shooting_for_bull||APP.game.name?null==APP.game.bull_shoot_winner&&APP.session.showBullShoot():(hideAll(),APP.session.hideBullShoot(),$("#gsp-menu").show(0)),APP.game.shooting_for_bull?null==APP.game.bull_shoot_winner&&APP.session.showBullShoot():APP.game.shot_for_bull?(hideAll(),$("#gsp-menu").show(0),APP.game.name?$("#gs-game-on").show(0):$("#gs-game-on").hide(0)):APP.game.name?(hideAll(),$("#gsp-player-hint").show(0),$("#gsp-player-section").show(0),$("#gsp-menu").show(0)):(hideAll(),$("#gsp-menu").show(0))},selectGame:function(in_request,in_settings,cricket_options){var i,max_i,no_game;switch(in_request){case"gsp-menu":return APP.game_selector.selectGame(null),void APP.session.showGameSelector();case"gs-play-now":return APP.header.players_checked_in=!0,BBAT.storeData({players_checked_in:!0}),$("#gs-select-opponents").hide(0),$("#gs-play-now").hide(0),$("#gsp-player-hint").show(0),void $("#gsp-player-section").show(0);case"gs-select-opponents":return void APP.header.startOpponentChange();case"gs-select":return APP.game.setShootForBull(),void APP.game_selector.refreshGamePanel();case"gs-cork-calls":return APP.game.setShootForBull(!0),void APP.game_selector.refreshGamePanel();case"gs-game-on":return void APP.game.start(APP.game.bull_shoot_winner)}var custom_game=!1;for(no_game=!1,null==in_request?(no_game=!0,APP.server.game_id=null,APP.game.started=!1,APP.game.setShootForBull(!1,!0),in_request="Library"):-1!=in_request.indexOf("gs-")&&(in_request=in_request.substr(3),custom_game=!0),in_request=in_request.toLowerCase(),max_i=APP.game_selector.choice.length,i=0;i<max_i&&in_request!=APP.game_selector.choice[i].name.toLowerCase();i++);if($("#gs-library").attr("src","images/icon_library.png"),$("#gs-cricket").attr("src","images/icon_cricket.png"),$("#gs-01").attr("src","images/icon_01.png"),APP.header.resetScoreOptions(),no_game?(APP.game.name=null,APP.game.shot_for_bull=null!=APP.game.bull_shoot_winner,$(".gs-hint").show(0),$("#gs-game-on").hide(0),$("#gsp-game-hint").show(0),$("#gsp-settings").hide(0),$("#gsp-player-hint").hide(0),$("#gsp-player-section").hide(0)):(APP.game.name=APP.game_selector.choice[i].name,APP.game.shooting_for_bull&&(APP.game.shot_for_bull=!0,APP.game.shooting_for_bull=!1),$(".gs-hint").hide(0),$("#gs-game-on").hide(0),$("#gsp-game-hint").hide(0),$("#gsp-settings").show(0),$("#gsp-player-hint").show(0),$("#gsp-player-section").show(0),$("#gs-"+in_request).attr("src","images/icon_"+in_request+"_selected.png")),APP.game_selector.index=i,APP.game.plugin=APP.game_selector.choice[i].plugin,APP.device.has_chalk){if(APP.header.enableEditing(),APP.game.setOptions(APP.game.plugin.default_options),in_settings&&APP.game.setOptions(in_settings),"Cricket"==APP.game.name&&(APP.game.resetScores(APP.game.getOption("starting_score")),APP.game.setOptions({marksman_scoring:!!APP.user_options.marksman})),"01"==APP.game.name&&custom_game&&APP.game.resetScores(APP.game.getOption("starting_score")),"Cricket"==APP.game.name){if(APP.game.plugin.storeSettings(!0),cricket_options){if(cricket_options.variation)switch(cricket_options.variation){case"TACTICS NL":APP.game.setOptions({variation:"TACTICS NL",dutch_tactics:!0});break;case"STRAIGHT":APP.game.setOptions({variation:"STRAIGHT",targets:"2015",no_points:!0});break;case"EXTENDED":APP.game.setOptions({variation:"EXTENDED",targets:"2011",no_points:!0});break;case"DROP 10":APP.game.setOptions({variation:"DROP 10",drop_10:!0});break;case"NO POINTS":APP.game.setOptions({variation:"NO POINTS",no_points:!0});break;case"MARK UP":APP.game.setOptions({variation:"MARK UP",no_points:!0});break;default:APP.game.setOptions({variation:cricket_options.variation})}!cricket_options.call||"Y"!=cricket_options.call&&1!=cricket_options.call||APP.game.setOptions({call:!0}),!cricket_options.no_bull||"Y"!=cricket_options.no_bull&&1!=cricket_options.no_bull||APP.game.setOptions({no_bull:!0}),cricket_options.scoring&&("STANDARD"==cricket_options.scoring?APP.game.setOptions({marksman_scoring:!1}):APP.game.setOptions({marksman_scoring:!0})),APP.game.plugin.storeSettings()}}else APP.game.plugin.storeSettings();APP.game.plugin.initGamePanel()}else APP.header.disableEditing();custom_game&&!APP.is_reloading&&APP.game.plugin.handleGameOption("gsp-settings-title"),custom_game||APP.is_reloading||(APP.storeState({settings_change:!0}),APP.game_selector.refreshGamePanel())},show:function(in_show_basics){if(APP.device.has_chalk||$("#game-selector .button").addClass("button-disabled"),$("#game-selector").show(0),APP.game_selector.refreshGamePanel(),null==APP.game.name?APP.session.showGameSelector():APP.session.isBracketMatch()&&APP.session.isNewMatch()?APP.reveal.setBackButton("BACK"):APP.reveal.setBackButton("EXIT"),APP.isOffline()&&APP.session.isNewMatch()&&"PRE-GAME"==APP.mode&&APP.device.showOfflineMessage(),"TOURNAMENT"==APP.session.getMatchMode()&&!APP.user_options.tournament_mode&&!APP.session.bracket){if(APP.session.isOnlineBracketMatch()&&"PARTICIPANT"==APP.device.role)return $("#bs-event-type").hide(),APP.device.disableButton("bs-set-format"),void APP.device.disableButton("bs-game-info");APP.session.getTournamentType()?APP.header.handleSetSetup("pssm-elimination"):APP.header.showSetSetup({advanced_only:!0})}},hide:function(){$("#game-selector").hide(0),$("#league-game-selector").hide(0)}},APP.equation={text_max:null,user_input:null,is_negating:null,prev_edit_mode:null,init:function(){APP.equation.text_max=100,APP.equation.user_input=[],APP.equation.is_negating=!1,APP.equation.prev_edit_mode=!1},getUserInput:function(){return APP.equation.user_input},hasUserInput:function(){return APP.equation.user_input.length>0},getPlusCount:function(){var i,len,ui,count;for(count=0,len=(ui=APP.equation.user_input).length,i=0;i<len;i++)"+"==ui[i]&&count++;return count},getElementCount:function(){return APP.equation.user_input.length},getLastElement:function(){return 0==APP.equation.user_input.length?null:APP.equation.user_input.slice(-1)},value:function(){var ui=APP.equation.user_input.slice(0),len=ui.length;return BBAT.isNumeric(ui[len-1])||ui.pop(),0==ui.length?0:eval(APP.equation.buildText(ui).replace(/x/g,"*"))},addFactorValue:function(in_value){var len,op,ui=APP.equation.user_input;return op=APP.equation.is_negating?"-":"+",APP.equation.prev_edit_mode=!1,0==(len=ui.length)?(ui.push(op),void ui.push(""+in_value)):1==len&&"0"==ui[0]?(ui.push(op),void(ui[0]=""+in_value)):void(APP.equation.buildText(ui).length>=APP.equation.text_max||(ui.push(op),ui.push(""+in_value)))},addDigit:function(in_digit,in_max_value){var len,txt,ui=APP.equation.user_input;APP.equation.prev_edit_mode&&(ui.length=0),APP.equation.prev_edit_mode=!1,0!=(len=ui.length)?(txt=APP.equation.buildText(ui)).length>=APP.equation.text_max||("0"!=ui[len-1]?BBAT.isNumeric(ui[len-1])?0+(txt=""+ui[len-1]+in_digit)<=in_max_value&&(ui[len-1]=txt):ui.push(""+in_digit):ui[len-1]=""+in_digit):ui.push(""+in_digit)},addOperator:function(in_operator){var ui=APP.equation.user_input,len=ui.length;APP.game.started&&(APP.equation.prev_edit_mode=!1,APP.equation.buildText(ui).length>=APP.equation.text_max||(0==len&&"-"==in_operator||BBAT.isNumeric(ui[len-1]))&&ui.push(in_operator))},backspace:function(){var ui=APP.equation.user_input,len=ui.length;if(APP.equation.prev_edit_mode=!1,BBAT.isNumeric(ui[len-1]))if("+"==ui[0]||"-"==ui[0])ui.pop(),ui.pop();else if(ui[len-1].length>1){ui[len-1]=ui[len-1].substr(0,ui[len-1].length-1);try{APP.game.select_winning_dart&&APP.plugin_01.cancelSWD()}catch(e){}}else ui.pop();else ui.pop()},buildText:function(in_user_input){var i,j,txt="",mult=!1,ui=in_user_input,len=ui.length;for(i=0;i<len;i++){switch(ui[i]){case"-":txt+=" - ";break;case"+":txt+=" + ";break;case"x":j=txt.lastIndexOf(" "),txt=txt.substr(0,j)+" ("+txt.substr(j+1)+" x ",mult=!0;break;default:txt+=ui[i],mult&&(txt+=")",mult=!1)}if(txt.length==APP.equation.text_max)break}return txt},linkToUserInput:function(in_ui){APP.equation.user_input=in_ui,APP.equation.prev_edit_mode=in_ui.length>0,APP.equation.is_negating=in_ui.length>0&&"-"==in_ui[0]},negate:function(){var i,op,len,ui=APP.equation.user_input;switch(APP.equation.is_negating=!APP.equation.is_negating,ui[0]){case"+":op="-";break;case"-":op="+";break;default:op="-",ui.length>0&&ui.unshift("-")}for(len=ui.length,i=0;i<len;i++)switch(ui[i]){case"+":case"-":ui[i]=op}},reset:function(in_ui){var i,len;if(APP.equation.user_input.length=0,"number"==typeof in_ui)APP.equation.user_input.push(""+in_ui),APP.equation.prev_edit_mode=!0;else if(null!=in_ui){for(len=in_ui.length,i=0;i<len;i++)APP.equation.user_input.push(""+in_ui[i]);APP.equation.prev_edit_mode=!0}}},APP.scoreboard={play_again_option:null,init:function(){APP.device.addButtonHandler(["seo-box-1-info","seo-sb-lineup","seo-bb-cork","seo-bb-next-new-players","seo-bb-option-again","seo-bb-option-menu","seo-sb-next-game","seo-sb-next-new-game","seo-sb-next-new-players","seo-bb-alternate","seo-bb-mugs","seo-sb-new-set","seo-sb-change-game","seo-bb-players","seo-sb-players","seo-bb-change-players","seo-bb-select","seo-menu-switch","seo-set-control","seo-sb-edit-points","seo-sb-match-end"],APP.handleEOGMenuOption),APP.device.addButtonHandler(["pasc-cancel"],APP.scoreboard.handleAutoAltStart)},enableScrolling:function(){$("#scoreboard").css("overflow-y","scroll").on("scroll",APP.markEvent),$("#scoreboard-center").css("padding-bottom","55em")},disableEditing:function(){APP.device.disableFieldClass("sb-turn-enabled")},enableEditing:function(){APP.device.enableFieldClass("sb-turn-enabled")},auto_alt_start_dismissed:!1,auto_alt_start_timer:null,auto_alt_start_delay:3,handleAutoAltStart:function(in_id){switch(in_id){case"pasc-cancel":APP.scoreboard.cancelAutoAltStart()}},cancelAutoAltStart:function(in_sec){window.clearTimeout(APP.scoreboard.auto_alt_start_timer),APP.popup.hide(),APP.scoreboard.auto_alt_start_dismissed=!0},updateAutoAltStart:function(in_sec,in_type){in_sec>0?(APP.popup.show("popup-auto-start-countdown","Next "+in_type+" Starting in "+in_sec),APP.scoreboard.auto_alt_start_timer=window.setTimeout((function(){APP.scoreboard.updateAutoAltStart(in_sec-1,in_type)}),1e3)):(APP.scoreboard.cancelAutoAltStart(),"Game"==in_type?APP.handleEOGMenuOption("seo-bb-alternate"):APP.handleEOGMenuOption("seo-sb-next-alternate"))},showEOGStatus:function(in_spec){var show_set,html_lbl,html_btn,attemptAutoForward,match_done,sess=APP.session,cm=sess.matches[sess.current_match],mf=APP.session.getMatchFormat()||{},mm=APP.session.getMatchMode();APP.user_options;function leadingZero(in_integer){return in_integer<10?("00"+in_integer).substr(-2):in_integer}function showOverlay(){var height,cb=$("#chalkboard").outerHeight(!0),hd=$("#header").outerHeight(!0),rb=$("#reveal-bar").outerHeight(!0),mb=$("#message-bar").outerHeight(!0);height=cb-(hd+rb+$("#button-bar").outerHeight(!0)+mb),$("#scoreboard-eog-overlay-shell").css("height",height).css("top",hd).show(0),$("#scoreboard-eog-overlay").css("height",height),$("#bb-eg-board-menu").text("Review Game")}in_spec=in_spec||{},$(".text-gray-override").removeClass("text-gray-override"),$(".seo-eom-button").hide(0),show_set=in_spec.toggle?"none"==$("#seo-set-box").css("display"):mf.legs&&mf.legs.limit?APP.session.isSetDone():in_spec.is_set_end,match_done=mf.sets?APP.session.isLastSet()&&(APP.session.isSetDone()||in_spec.is_set_end||!1):in_spec.is_match_end||!1;try{if(mf.sets&&mf.sets.min_sets){var minSets=mf.sets.min_sets;cm.set_wins[0]+cm.set_wins[1]<minSets&&(match_done=!1)}}catch(e){}if(function(in_is_eom,in_is_eos,in_mf,in_mm){var ele=$("#bb-eg-end"),ell=$("#bb-eg-label");if(!APP.device.has_chalk)return ell.html(APP.session.getMatchFormatSummary(!0)).show(0),void ele.hide(0);if(in_is_eom)ell.hide(0),ele.removeClass("button-red").addClass("button-gold").html("Continue Match").show(0),APP.device.disableButton("bb-eg-end");else if(in_is_eos)if(in_mf.sets)ell.html(APP.session.getMatchFormatSummary(!0)).show(0),ele.hide(0);else switch(ell.hide(0),in_mm){case"SINGLES":case"TEAM":var buttonText="End League Match";if(APP.session.currentLeagueIsGroup())buttonText="End Match";ele.removeClass("button-gold").addClass("button-red").html(buttonText).show(0);break;default:ele.removeClass("button-gold").addClass("button-red").html("End Match").show(0)}else ell.html(APP.session.getMatchFormatSummary(!0)).show(0),ele.hide(0)}(match_done,show_set,mf,mm),function(in_is_eom,in_is_eos,in_mf,in_mm){var el=$("#seo-set-control");if(APP.device.has_chalk&&"PARTICIPANT"!=APP.device.role)if(in_is_eom)if(in_mf.sets){var type="Match";APP.nlf.data.rails&&(type="Set"),el.data("data-match-end",!0).html("Edit "+type+" Settings").show(0)}else el.data("data-match-end",!0).html("Back").show(0);else in_is_eos?in_mf.legs?el.data("data-match-end",null).html("Edit Match Settings").show(0):el.data("data-match-end",null).html("Back").show(0):in_mf.legs&&in_mf.legs.limit?el.data("data-match-end",null).html("Edit Match Settings").show(0):el.data("data-match-end",null).html("New Set or End Match").show(0);else el.hide(0)}(match_done,show_set,mf),match_done&&!show_set&&APP.device.has_chalk&&APP.device.is_broadcasting&&APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html()}),show_set){if($("#seo-game-box-1").hide(0),"PARTICIPANT"===APP.device.role&&APP.scoreboard.eolOverlayOn(),APP.server.guestGameEndOfSet=!0,$("#header *").addClass("text-gray-override"),$("#message-bar-status *").addClass("text-gray-override"),$("#seo-sb-set-opponent-0").html(APP.game.opponent[0].getChalkboardName()),$("#seo-sb-set-opponent-1").html(APP.game.opponent[1].getChalkboardName()),"GAME"==sess.getMatchMode()||(!mf.sets||"1"==mf.sets.limit)&&APP.session.isFirstSet())var wins_mode="LEGS";else wins_mode="SETS";var premier_points=!1;if(sess.getMatchFormat()&&sess.getMatchFormat().points_style&&-1!==sess.getMatchFormat().points_style.indexOf("MATCH_WINS")&&(premier_points=!0),APP.session.isLeaguePlay()&&!premier_points?($("#seo-sb-set-score-0").html(APP.noZero(sess.getMatchPoints(null,0,!0))),$("#seo-sb-set-score-1").html(APP.noZero(sess.getMatchPoints(null,1,!0)))):($("#seo-sb-set-score-0").html(sess.getWins(cm,wins_mode,0,!0)),$("#seo-sb-set-score-1").html(sess.getWins(cm,wins_mode,1,!0))),match_done?(APP.scoreboard.eolOverlayOff(),$("#seo-set-control").data("data-cancel-save")?$("#seo-set-control").data("data-cancel-save",null):"HOST"==APP.device.role&&APP.session.startAutoSave(),$("#seo-sb-set-label").html(("GAME"==APP.session.getMatchMode()?"Set":"Match")+'<br /><span style="font-size:0.6em;">Complete</span>'),$("#seo-set-inner-box").removeClass("seo-eos-color").addClass("seo-eom-color")):"LEGS"!=wins_mode||APP.session.isSetDone()?($("#seo-sb-set-label").html("Set "+leadingZero(sess.current_set+1)+(APP.session.isSetDone()?'<br /><span style="font-size:0.6em;">Complete</span>':"")),$("#seo-set-inner-box").addClass("seo-eos-color").removeClass("seo-eom-color"),"PARTICIPANT"===APP.device.role&&APP.scoreboard.eolOverlayOff()):($("#seo-sb-set-label").html("Leg "+leadingZero(sess.getLeg())+'<br /><span style="font-size:0.6em;">Complete</span>'),$("#seo-set-inner-box").removeClass("seo-eos-color").removeClass("seo-eom-color")),"TOURNAMENT"==APP.session.getMatchMode()&&$("#seo-sb-players").html("End Match"),"SINGLES"==APP.session.getMatchMode()?(APP.device.disableButton("seo-sb-players"),APP.device.disableButton("seo-sb-next-new-players")):(APP.device.enableButton("seo-sb-players",!0),APP.device.enableButton("seo-sb-next-new-players",!0)),APP.device.has_chalk){if(APP.device.enableButtonClass("seo-chalk-button"),match_done){var isBotTurn=!1;try{isBotTurn=APP.game.opponent[APP.game.winning_opponent].isBotTurn(APP.game.active_round)}catch(e){isBotTurn=!1}isBotTurn?APP.device.disableButton("bb-eg-back"):APP.device.enableButton("bb-eg-back",!0)}"PARTICIPANT"==APP.device.role&&($("#bb-eg-end").removeClass("button-gold").addClass("button-red").html("End Match"),APP.device.enableButton("bb-eg-end")),match_done&&"PARTICIPANT"==APP.device.role&&APP.device.has_chalk&&(APP.device.disableButton("bb-eg-back"),APP.device.showSpinnerOverlay()),APP.storeGameEvent({cmd:"FINISH_GAME",cmd_data:{dart:APP.game.winning_dart,finish_time:APP.game.finish_time,winning_opponent:APP.game.winning_opponent,is_set_end:!0,is_match_end:match_done,match_summary:APP.session.packageMatchSummary()}},(function(){match_done&&"PARTICIPANT"==APP.device.role&&APP.device.has_chalk&&APP.device.releaseChalk(!1,APP.reload)}))}else APP.device.disableButtonClass("seo-chalk-button");if($("#seo-sb-lineup").hide(0),$(".seo-set-button").hide(0),$(".seo-next-set-button").hide(0),$("#seo-sb-next-label").hide(0),match_done)$(".seo-set-button").hide(0),"HOST"==APP.device.role&&APP.device.has_chalk&&$(".seo-eom-button").show(0),"HOST"==APP.device.role&&APP.device.has_chalk&&APP.session.isLeaguePlay()?APP.session.currentLeagueIsGroup()?APP.device.disableButton("seo-sb-edit-points"):(APP.device.enableButton("seo-sb-edit-points",!0),mf&&("VARIES"==mf.points_style||"SUPPRESS"==mf.points_style||APP.device.disableButton("seo-sb-edit-points"))):APP.device.disableButton("seo-sb-edit-points");else if("TEAM"==APP.session.getMatchMode())$("#seo-sb-lineup").show(0);else{var nextSet=mf.next_set;nextSet||(nextSet=mf.next_game);var override=APP.zanis.newSetCheck();if(override)switch(override){case"CORK":nextSet="CORK";break;case"RANDOM":nextSet="RANDOM";break;case"PLAYER":nextSet="SELECT"}switch("PLAYER"==nextSet&&(nextSet="SELECT"),nextSet){case"MENU":case"SELECT":html_lbl="Next Set: Select Starting Player",html_btn="New Set";break;case"ALTERNATE":html_lbl="Next Set: Alternate Start",html_btn="Alternate";break;case"CORK":html_lbl="Next Set: Bull Up",html_btn="Bull Up";break;case"MUGS_AWAY":html_lbl="Next Set: Mugs Away",html_btn="Mugs Away";break;case"RANDOM":html_lbl="Next Set: Random Start",html_btn="Random"}if(APP.session.isSameGameAgain(in_spec.is_set_end)&&(html_lbl="Next Set: Play "+APP.game.getGameName(!0)+" Again"),$("#seo-sb-next-label").html(html_lbl).show(0),0===$("#bb-eg-end-clone").length){var newButton=$("#bb-eg-end").clone().attr("id","bb-eg-end-clone");$("#seo-set-control").after(newButton),$("#bb-eg-end").hide(),$("#bb-eg-label").show(),$("#bb-eg-end-clone").on("click touchend",(function(){APP.reveal.handleButtons("bb-eg-end"),$("#bb-eg-end").show(),$("#bb-eg-label").hide(),$("#bb-eg-end-clone").hide()}))}else $("#bb-eg-end").hide(),$("#bb-eg-label").show();if(nextSet){var data=nextSet;$("#seo-sb-next-game").html("Next Set").data("data-option",data).show(0),$("#seo-sb-next-new-players").show(0),$("#seo-sb-next-new-game").show(0),APP.eosAutoForward=!0}else mf.next_game?($("#seo-sb-next-game").html(html_btn).data("data-option","MENU"==mf.next_game?"SELECT":mf.next_game).show(0),$("#seo-sb-next-new-players").show(0),$("#seo-sb-next-new-game").show(0)):($(".seo-eom-button").hide(0),$(".seo-set-button").show(0))}if(APP.nlf.data.rails&&APP.nlf.rails.injections.eom(),showOverlay(),$("#seo-set-box").show(0),APP.starpubs.checkForTiebreaker()&&APP.starpubs.showSelectTieBreakPlayer(),APP.attemptEOSAutoForward(),"HOST"!==APP.device.role&&match_done&&APP.lobby.isLobbyMatch()){$("#seo-sb-rematch").length&&$("#seo-sb-rematch").remove(),$(".seo-sb-box").append('\n\t\t\t\t\t\t<div id="seo-sb-rematch" class="seo-chalk-button seo-eom-button button button-menu button-gold round-corners">\n\t\t\t\t\t\t\tRequest Rematch\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.fns.activateBtn("seo-sb-rematch",(function(){APP.lobby.offerRematch(!0)}))}}else{if($("#seo-set-box").hide(0),$("#seo-game-box-1").hide(0),"MENU"==mf.next_game&&"BASIC"!=APP.user_options.eog_menu_option||"FULL"==APP.user_options.eog_menu_option)APP.user_options.eog_menu_option="FULL",APP.session.isLeaguePlay()&&(APP.server.guestGameEndOfSet=!0),APP.storeUserOptions(),$("#seo-menu-switch").html("&#9650; Show Basic Options"),$(".seo-player-option").show(0);else switch(APP.user_options.eog_menu_option="BASIC",APP.session.isLeaguePlay()&&(APP.server.guestGameEndOfSet=!0),APP.ffwd.isActive&&(APP.user_options.backup_tablet=!1),APP.storeUserOptions(),$("#seo-menu-switch").html("&#9660; Show All Options"),$(".seo-player-option").hide(0),mf.next_game){case"ALTERNATE":APP.scoreboard.isCorkLastLeg()&&APP.session.isDecidingLeg()?$("#seo-bb-cork").show(0):($("#seo-bb-alternate").show(0),attemptAutoForward=!0);break;case"MUGS_AWAY":APP.scoreboard.isCorkLastLeg()&&APP.session.isDecidingLeg()?$("#seo-bb-cork").show(0):($("#seo-bb-mugs").show(0),attemptAutoForward=!0);break;case"CORK":APP.server.guestGameEndOfSet=!0,$("#seo-bb-cork").show(0),attemptAutoForward=!0;break;default:APP.server.guestGameEndOfSet=!0,$("#seo-bb-select").show(0)}APP.game.getGameName();if(!APP.device.has_chalk)return void $("#scoreboard-eog-overlay-shell").hide(0);isBotTurn=!1;try{isBotTurn=APP.game.opponent[APP.game.winning_opponent].isBotTurn(APP.game.active_round)}catch(e){isBotTurn=!1}if(APP.game.isEOGFinal()||isBotTurn?APP.device.disableButton("bb-eg-back"):APP.device.enableButton("bb-eg-back",!0),"TOURNAMENT"==mm||"SINGLES"==mm?$("#seo-bb-next-new-players").hide(0):mf.legs&&mf.legs.limit?APP.device.disableButton("seo-bb-next-new-players"):($("#seo-bb-next-new-players").show(0),APP.device.enableButton("seo-bb-next-new-players",!0)),APP.device.enableButtonClass("seo-chalk-button"),$("#seo-bb-option-again").html(APP.game.getGameName(!0)),$(".seo-bb-option").addClass("button-gray").removeClass("button-red"),APP.session.isSameGameAgain()&&"MENU"!=APP.scoreboard.play_again_option||"GAME"==APP.scoreboard.play_again_option?$("#seo-bb-option-again").addClass("button-red").removeClass("button-gray"):$("#seo-bb-option-menu").addClass("button-red").removeClass("button-gray"),APP.nlf.data.rails&&$("#seo-bb-players").hide(),"TOURNAMENT"==APP.session.getMatchMode()&&APP.device.disableButton("seo-bb-players"),APP.storeGameEvent({cmd:"FINISH_GAME",cmd_data:{dart:APP.game.winning_dart,finish_time:APP.game.finish_time,winning_opponent:APP.game.winning_opponent,is_set_end:!1,is_match_end:!1,match_summary:APP.session.packageMatchSummary()}}),"DECIDING"==APP.zanis.simpleLegCheck()&&mf.next_game_options&&mf.next_game_options.cork_last)return void APP.handleEOGMenuOption("seo-bb-cork");if("DECIDING"==APP.zanis.simpleSetCheck()&&"Y"==mf.win_by_two&&APP.session.isDecidingLeg()&&mf.cork_sudden_death&&"Y"==mf.cork_sudden_death)return void APP.handleEOGMenuOption("seo-bb-cork");if("SELECT"==mf.next_game&&"PARTICIPANT"!==APP.device.role)return void APP.handleEOGMenuOption("seo-bb-select");showOverlay(),$("#seo-game-box-1").show(0);var nlfData=APP.nlf.data;switch(nlfData.railsChapter&&"varies"==nlfData.railsChapter.player_format&&APP.session.changePlayerEndLeg(),"PARTICIPANT"===APP.device.role&&APP.scoreboard.eolOverlayOn(),APP.session.getMatchMode()){case"SINGLES":case"TOURNAMENT":APP.device.disableButton("seo-bb-players"),APP.device.disableButton("seo-bb-change-players");break;case"MATCH":case"GAME":(mf.legs&&mf.legs.limit||mf.sets)&&(APP.device.disableButton("seo-bb-players"),APP.device.disableButton("seo-bb-change-players"));break;case"BASIC GAME":APP.scoreboard.eolOverLayStatus&&APP.scoreboard.eolOverlayOff()}if(!APP.scoreboard.auto_alt_start_dismissed&&APP.game.isBotPlaying()&&APP.user_options.dartbot_auto_alt_start&&APP.scoreboard.updateAutoAltStart(3,"Game"),APP.nlf.rails.forcePlayerSelect())return void APP.session.changePlayerEndLeg();void 0!==attemptAutoForward&&attemptAutoForward&&"PARTICIPANT"!==APP.device.role&&APP.attemptEOGAutoForward(),"PARTICIPANT"===APP.device.role&&APP.scoreboard.eolOverlayOn()}},hideEOGStatus:function(){$(".text-gray-override").removeClass("text-gray-override"),$("#bb-eg-board-menu").text("Next Game"),$("#scoreboard-eog-overlay-shell").hide(0)},handleEOGStatus:function(in_id){switch(in_id){case"seo-set-box":case"seo-game-box-1":case"scoreboard-eog-overlay":APP.scoreboard.hideEOGStatus()}},isCorkLastLeg:function(){var cslp,sess=APP.session,mf=sess.getMatchFormat()||{},uo=APP.user_options;try{if(!mf.next_game_options.cork_last)return!1}catch(error){}return!(!mf.legs||!BBAT.isNumeric(mf.legs.limit))&&(!(mf.sets&&BBAT.isNumeric(mf.sets.limit)&&!sess.isLastSet())&&(cslp=sess.getCurrentSetLegsPlayed(),BBAT.isNumeric(uo.tournament_leg_max)?cslp==uo.tournament_leg_max-1:cslp==mf.legs.limit-1))},eolOverLayStatus:!1,eolOverlayOn:function(){APP.scoreboard.eolOverLayStatus||(APP.scoreboard.eolOverLayStatus=!0,$("#guest-eol-overlay").show(),APP.scoreboard.eolOverlayCounter=0,$("#guest-eol-overlay").off("click touchend"),$("#guest-eol-overlay").on("click touchend",(function(){APP.scoreboard.eolOverlayClick()})))},eolOverlayCounter:0,eolOverlayOff:function(){APP.scoreboard.eolOverLayStatus=!1,$("#guest-eol-overlay").hide()},eolOverlayClick:function(){APP.scoreboard.eolOverlayCounter++,5==APP.scoreboard.eolOverlayCounter&&APP.scoreboard.eolOverlayOff()},shield:function(){var sbc=$("#scoreboard-center");$("#scoreboard-overlay").css("height",sbc.outerHeight(!0)).show(0)},unshield:function(){$("#scoreboard-overlay").hide(0)}},APP.scoreboard_points={resetEOG:function(){APP.scoreboard_points.clearAchievementColumns(),$(".winning-turn").html("").removeClass("winning-turn"),$(".winning-turn-score").removeClass("winning-turn-score"),$(".exceptional-turn").removeClass("exceptional-turn")},clearAchievementColumns:function(){$(".turn-arrow-left").removeClass("turn-arrow-left"),$(".turn-arrow-right").removeClass("turn-arrow-right"),$(".winning-turn-left").removeClass("winning-turn-left"),$(".winning-turn-right").removeClass("winning-turn-right"),$(".expectional-turn").removeClass("expectional-turn"),$(".starting-turn").removeClass("starting-turn"),$(".best-turn").removeClass("best-turn")},enableGameSettings:function(in_enabled){in_enabled?APP.device.enableFieldID("sb-p-s-g")&&$("#sb-p-s-g").addClass("text-gold"):(APP.device.disableFieldID("sb-p-s-g"),$("#sb-p-s-g").removeClass("text-gold"))},displayGameSettings:function(){var gs="";APP.game.getOpponentCount();function formatHandicap(in_handicap){return in_handicap>0?"&#43;"+in_handicap:in_handicap}gs=APP.game.getOption("double_in")?"DI":APP.game.getOption("all_player_double_in")?"ADI":"SI",$("#sb-p-s-g").html(gs),$(".sb-handicap").html("&nbsp;"),APP.game.opponent[0].handicap&&$("#sb-p-s-h0").html(formatHandicap(APP.game.opponent[0].handicap)),APP.game.opponent[1].handicap&&$("#sb-p-s-h1").html(formatHandicap(APP.game.opponent[1].handicap))},clearInsertedMissTurns:function(){$(".inserted-miss-turn").removeClass("inserted-miss-turn")},markInsertedMissTurn:function(in_opponent,in_round){$("#sb-p-r"+in_round+"-t"+in_opponent).addClass("inserted-miss-turn")},markStartingTurn:function(in_opponent){$("#sb-p-r0-a"+in_opponent).addClass("starting-turn")},markExceptionalTurn:function(in_opponent,in_round){$("#sb-p-r"+in_round+"-t"+in_opponent).addClass("exceptional-turn")},markWinningTurn:function(in_opponent,in_round,in_dart){$("#sb-p-r"+in_round+"-a"+in_opponent).addClass("winning-turn").html(in_dart),$("#sb-p-r"+in_round+"-t"+in_opponent).addClass("winning-turn-score")},markBestTurn:function(in_opponent,in_round){$("#sb-p-r"+in_round+"-a"+in_opponent).html("&#9650;")},markCurrentTurn:function(){var cr=APP.game.current_round,co=APP.game.current_opponent;$(".turn-arrow-left").removeClass("turn-arrow-left"),$(".turn-arrow-right").removeClass("turn-arrow-right"),0==co?$("#sb-p-r"+cr+"-a"+co).addClass("turn-arrow-left"):$("#sb-p-r"+cr+"-a"+co).addClass("turn-arrow-right"),2==APP.game.getOption("opponent_count")&&("HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||APP.device.enableFieldID("sb-p-r"+cr+"-t"+co))},handleTurnSelection:function(in_id){APP.device.has_chalk?(APP.storeGameEvent({cmd:"GOTO",cmd_data:{turn_id:in_id}}),APP.scoreboard_points.activateTurn(in_id)):APP.alert.show("You do not currently have control.",null,!0)},displayTurnEntry:function(in_opponent,in_round,in_entry,in_turn_color){var sbt=$("#sb-p-r"+in_round+"-t"+in_opponent);if(null==in_entry)sbt.text("");else if(0==in_entry)switch(in_turn_color){case"SKIP":sbt.html("---");break;case"MISS":sbt.html("&#8709;");break;case"BUST":sbt.html("X");break;case"":sbt.text("0");break;default:sbt.text("")}else sbt.text(in_entry)},deleteCurrentTurn:function(){var co=APP.game.current_opponent,cr=APP.game.current_round;APP.game.isFirstOpponent(co)?$("#sb-p-r"+cr).remove():$("#sb-p-r"+cr+"-t"+co).text(""),APP.game.deleteCurrentTurn()},activateTurn:function(in_id,in_edit_navigation){if(APP.game.isCurrentTurnActive()&&APP.plugin_01.is_bot_turn&&"turn_next"!==in_id)APP.alert.show("DartConnect has the board.",null,!0);else{var gtr,gto,current_i,active_i,starting_o,ending_o,next_o,prev_o,i,ar=APP.game.active_round,ao=APP.game.active_opponent,cr=APP.game.current_round,co=APP.game.current_opponent,oo=APP.game.opponent_order,len=oo.length;for(APP.game.plugin.handlePreActivateTurn(in_id),$(".sb-turn-edit-prev").removeClass("sb-turn-edit-prev"),$(".sb-turn-edit").removeClass("sb-turn-edit"),i=0;i<len;i++)ao==oo[i]&&(active_i=i),co==oo[i]&&(current_i=i);switch(starting_o=oo[0],ending_o=oo[len-1],ao==starting_o?(prev_o=ending_o,next_o=oo[1]):ao==ending_o?(prev_o=oo[len-2],next_o=oo[0]):(prev_o=oo[active_i-1],next_o=oo[active_i+1]),in_id){case"turn_current":gtr=cr,gto=co,APP.scoreboard_points.markCurrentTurn();break;case"turn_active":gtr=ar,gto=ao;break;case"turn_next":co==ending_o?(APP.scoreboard_points.addNewRow(),gtr=APP.game.current_round,gto=APP.game.current_opponent):(gtr=cr,gto=next_o,APP.game.current_opponent=gto),APP.scoreboard_points.markCurrentTurn();break;case"turn_prev":0==ar&&ao==starting_o?(gtr=ar,gto=ao):ao==starting_o?(gtr=ar-1,gto=ending_o):(gtr=ar,gto=prev_o);break;case"nav_left":0==ao?0==ar?(gtr=ar,gto=ao):(gtr=ar-1,gto=len-1):ao-1==co&&ar==cr||null!=APP.game.opponent[ao-1].getTurnPoints(ar)?(gtr=ar,gto=ao-1):(gtr=ar,gto=ao);break;case"nav_right":ao==len-1?ar==cr?(gtr=ar,gto=ao):0==co&&ar+1==cr||null!=APP.game.opponent[0].getTurnPoints(ar+1)?(gtr=ar+1,gto=0):(gtr=ar,gto=ao):ao+1==co&&ar==cr||null!=APP.game.opponent[ao+1].getTurnPoints(ar)?(gtr=ar,gto=ao+1):(gtr=ar,gto=ao);break;case"nav_up":0==ar?(gtr=ar,gto=ao):(gtr=ar-1,gto=ao);break;case"nav_down":ar==cr||ar==cr-1&&ao!=co&&current_i<=active_i?(gtr=ar,gto=ao):(gtr=ar+1,gto=ao);break;case"nav_home":if(0==cr)for(gtr=0,gto=co,i=0;i<current_i;i++)oo[i]<gto&&(gto=oo[i]);else gtr=0,gto=0;break;case"nav_end":for(gtr=cr,gto=co,i=0;i<current_i;i++)oo[i]>gto&&(gto=oo[i]);break;case"winner":gtr=cr,gto=APP.game.winning_opponent;break;default:gtr=APP.extractFirstNumberSegment(in_id),gto=APP.extractLastNumberSegment(in_id)}if(gtr>APP.game.current_round)return!1;APP.game.active_round=gtr,APP.game.active_opponent=gto,APP.game.isCurrentTurnActive()?$("#sb-p-r"+gtr+"-t"+gto).addClass("sb-turn-edit").addClass("sb-turn-enabled"):$("#sb-p-r"+gtr+"-t"+gto).addClass("sb-turn-edit-prev"),APP.scoreboard_points.scrollToActiveRound(),APP.game.plugin.handlePostActivateTurn(in_edit_navigation)}},scrollToActiveRound:function(){var sb=$("#scoreboard"),sbh=BBAT.truncate(sb.height(),0),sbt=sb.scrollTop(),ar=$("#sb-p-r"+APP.game.active_round),arh=BBAT.truncate(ar.height(),0),art=BBAT.truncate(ar.position().top,0),half_arh=BBAT.truncate(arh/2,0),scroll_to=null;APP.game.started&&(APP.game.getOption("special_targets")&&(arh*=3),art+arh+half_arh>sbh?sbt<sb[0].scrollHeight-sb.outerHeight()-1&&(scroll_to=sbt+(art+arh+half_arh-sbh)):art<half_arh&&sbt>0&&(scroll_to=sbt+art-half_arh),null!=scroll_to&&sb.animate({scrollTop:scroll_to},{duration:APP.is_reloading?0:50,queue:!1}))},addNewRow:function(){var cr,id,lbl,rx=$("#sb-p-scoreboard-row-template");APP.game.addNewRound(),cr=parseInt(APP.game.current_round,10),lbl=APP.game.getDYGDefaultTargetLabel(cr),APP.game.addDYGTarget({label:lbl,value:"TARGET COUNTING"==APP.game.options.scoring_type?1:+lbl}),id="sb-p-r"+cr,rx.clone(!0).attr("id",id).appendTo("#scoreboard-points").removeClass("template"),APP.device.addFieldHandler([id+"-t0",id+"-t1"],APP.scoreboard_points.handleTurnSelection),$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).attr("id","sb-p-r"+cr+"-m0");break;case 1:$(el).attr("id","sb-p-r"+cr+"-t0");break;case 2:$(el).attr("id","sb-p-r"+cr+"-a0");break;case 3:$(el).attr("id","sb-p-r"+cr+"-g"),"Library"==APP.game.name&&"POINTS"==APP.game.getOption("game_type")?($(".sb-p-game-current-turn").removeClass("sb-p-game-current-turn"),$(el).find("div").attr("id","sb-pb"+cr).text(lbl).addClass("sb-p-game-current-turn")):$(el).find("div").attr("id","sb-pb"+cr).text(lbl);break;case 4:$(el).attr("id","sb-p-r"+cr+"-a1");break;case 5:$(el).attr("id","sb-p-r"+cr+"-t1");break;case 6:$(el).attr("id","sb-p-r"+cr+"-m1")}})),APP.scoreboard_points.clearTargetButtons(),"TARGET"!=APP.game.getOption("scoring_type")||"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||APP.scoreboard_points.setTargetButton(cr),!APP.game.getOption("special_targets")||"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||$("#sb-p-special-target-row").insertAfter($("#"+id)).show(0),!APP.game.getOption("negative_scoring")||"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||$("#sb-p-negative-target-row").insertAfter($("#"+id)).show(0)},changeDYGTarget:function(in_round,in_label,in_value){APP.game.changeDYGTarget(in_round,in_label,in_value),$("#sb-pb"+in_round).text(in_label)},resetDYGTarget:function(in_round){var lbl=APP.game.resetDYGTarget(in_round);$("#sb-pb"+in_round).text(lbl)},enableNegativeTargetButton:function(){APP.device.enableButton("sb-p-negative-target-button",!0)},disableNegativeTargetButton:function(){APP.device.disableButton("sb-p-negative-target-button")},enableSpecialTargetButton:function(){APP.device.enableButton("sb-p-special-target-button",!0)},disableSpecialTargetButton:function(){APP.device.disableButton("sb-p-special-target-button")},setTargetButton:function(in_round){$("#sb-pb"+in_round).addClass("button sb-p-game-target-button"),APP.device.addButtonHandler(["sb-pb"+in_round],APP.game.plugin.handleUserInput)},clearTargetButtons:function(){$(".sb-p-game-target-button").removeClass("button button-up sb-p-game-target-button")},disableTargetButton:function(){$(".sb-p-game-target-button").addClass("button-disabled")},disableSkipTurn:function(in_opponent,in_round){$("#sb-p-r"+in_round+"-t"+in_opponent).removeClass("sb-turn-enabled").removeClass("field-enabled")},enableTargetButton:function(in_round){$(".sb-p-game-target-button").removeClass("button-disabled")},swapTargetButton:function(in_from_round,in_to_round){$("#sb-pb"+in_from_round).removeClass("button sb-p-game-target-button"),$("#sb-pb"+in_to_round).addClass("button sb-p-game-target-button")},show:function(){$("#scoreboard-points").show(0)},hide:function(in_scoreboard_id){$("#scoreboard-points").hide(0)}},APP.scoreboard_cricket={enableGameSettings:function(in_block){var el=$("#sb-cricket-scoring-option");!APP.device.has_chalk||!APP.game.started||APP.game.started_scoring||APP.game.hasUserStartedScoring()||in_block?el.hide(0):el.html('<span style="font-size:0.8em;">Switch to<br /></span>'+(APP.game.getOption("marksman_scoring")?"Standard":"Marksman")+" Scoring").css("top",$("#reveal").position().top-1.5*el.outerHeight(!0)).show(0)},resetEOG:function(){APP.scoreboard_cricket.addTargetButtons()},removeTargetModifiers:function(){$(".sb-c-achieve").html("")},colorTapCounts:function(in_opponent){$(".sb-c-achieve-"+in_opponent).removeClass("sb-c-pending")},clearTapCounts:function(in_opponent){$(".sb-c-achieve-"+in_opponent).html("")},displayTapCount:function(in_opponent,in_target,in_tap_count,in_final_flag){var min_taps,el=$("#sb-c-r"+in_target+"-m"+in_opponent);min_taps=in_final_flag?3:0,el.html(in_tap_count>min_taps?in_tap_count:""),1==in_final_flag?el.removeClass("sb-c-pending"):el.addClass("sb-c-pending")},displayMiss:function(in_opponent,in_gold){$("#sb-c-r4-m"+in_opponent).html('<span style="color:'+(in_gold?"#FEE800;":"white;")+' font-weight:bold;">&#8709;</span>').removeClass("sb-c-pending")},displaySkip:function(in_opponent,in_gold){$("#sb-c-r4-m"+in_opponent).html('<span style="color:'+(in_gold?"#FEE800;":"white;")+' font-weight:bold;">---</span>').removeClass("sb-c-pending")},displayAfterTurnMarkCount:function(in_opponent,in_target,in_tap_count){$("#sb-c-r"+in_target+"-m"+in_opponent).html(in_tap_count>0?in_tap_count:"").removeClass("sb-c-pending").addClass("sb-c-after-turn")},clearAfterTurnMarks:function(in_opponent){$(".sb-c-margin-"+in_opponent).html("").removeClass("sb-c-pending").removeClass("sb-c-after-turn")},displayMarksCount:function(in_marks_scored,in_skip){},colorMarksCount:function(in_pending){var el=$(".sb-c-game-marks-display");in_pending?el.addClass("sb-c-game-marks-pending"):el.removeClass("sb-c-game-marks-pending")},clearPoints:function(in_opponent){$(".sb-c-margin-"+in_opponent).html("").removeClass("sb-c-pending").removeClass("sb-c-after-turn")},displayPoints:function(in_opponent,in_target,in_points,in_final_flag){$("#sb-c-r"+in_target+"-a"+in_opponent).html(in_points>0?in_points:"")},clearMarks:function(in_opponent,in_target_index){var el=$("#sb-c-r"+in_target_index+"-t"+in_opponent);el.removeClass("mark-0-0-1").removeClass("mark-0-0-2").removeClass("mark-0-0-3").removeClass("mark-0-0-close").removeClass("mark-0-1-1").removeClass("mark-0-1-2").removeClass("mark-0-1-3").removeClass("mark-0-1-close").removeClass("mark-0-2-2").removeClass("mark-0-2-3").removeClass("mark-0-2-close"),el.removeClass("mark-1-1-1").removeClass("mark-1-1-2").removeClass("mark-1-1-3").removeClass("mark-1-1-close").removeClass("mark-1-2-2").removeClass("mark-1-2-3").removeClass("mark-1-2-close").removeClass("mark-2-2-2").removeClass("mark-2-2-3").removeClass("mark-2-2-close").removeClass("mark-3-3-close")},displayMarks:function(in_opponent,in_target_index,in_handicap_mark,in_from_mark,in_to_mark){var to_mark=in_to_mark>=3?3:in_to_mark,from_mark=in_from_mark>=3?3:in_from_mark,el=$("#sb-c-r"+in_target_index+"-t"+in_opponent);APP.scoreboard_cricket.clearMarks(in_opponent,in_target_index),in_to_mark&&el.addClass("mark-"+Math.min(in_handicap_mark,3)+"-"+from_mark+"-"+to_mark)},markWinningMark:function(in_opponent,in_target_index){var el=$("#sb-c-r"+in_target_index+"-t"+in_opponent);el.hasClass("mark-0-0-close")?el.removeClass("mark-0-0-close").addClass("mark-0-0-3"):el.hasClass("mark-0-1-close")?el.removeClass("mark-0-1-close").addClass("mark-0-1-3"):el.hasClass("mark-0-2-close")?el.removeClass("mark-0-2-close").addClass("mark-0-2-3"):el.hasClass("mark-1-1-close")?el.removeClass("mark-1-1-close").addClass("mark-1-1-3"):el.hasClass("mark-1-2-close")?el.removeClass("mark-1-2-close").addClass("mark-1-2-3"):el.hasClass("mark-2-2-close")&&el.removeClass("mark-2-2-close").addClass("mark-2-2-3")},markColumnInactive:function(in_opponent){$(".sb-c-turn").removeClass("sb-t-inactive"),$(".sb-c-turn-"+in_opponent).addClass("sb-t-inactive")},grayOutTargetLabel:function(in_target_suffix){$("#sb-c-b"+in_target_suffix).addClass("sb-t-inactive")},disableTarget:function(in_target_index){$("#sb-c-b"+in_target_index).addClass("button-disabled")},enableTarget:function(in_target_index){$("#sb-c-b"+in_target_index).removeClass("button-disabled")},disableAllTargets:function(){$(".sb-c-game-target").addClass("button-disabled"),$(".sb-c-game-target-modifier").addClass("button-disabled")},removeTargetButton:function(in_target_index){$("#sb-c-b"+in_target_index).removeClass("sb-c-game-target-button").removeClass("button-disabled").removeClass("button-up").removeClass("button")},addTargetButton:function(in_target_index){$("#sb-c-b"+in_target_index).addClass("sb-c-game-target-button").addClass("button-up").addClass("button")},removeTargetButtons:function(){$(".sb-c-game-target").removeClass("sb-c-game-target-button").removeClass("button-disabled").removeClass("button-up").removeClass("button")},addTargetButtons:function(){$(".sb-c-game-target").addClass("sb-c-game-target-button").addClass("button-up").addClass("button")},addNewRow:function(in_index,in_middle_label,in_middle_suffix,in_left_shadow_button_id,in_right_label,in_right_suffix,in_right_shadow_button_id){var id,rx;rx="M"==in_right_suffix?$("#sb-c-bull-row-template"):$("#sb-c-scoreboard-row-template"),id="sb-c-r"+in_index,rx.clone(!0).attr("id",id).appendTo("#scoreboard-cricket").removeClass("template"),$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).attr("id","sb-c-r"+in_index+"-m0");break;case 1:$(el).attr("id","sb-c-r"+in_index+"-t0");break;case 2:$(el).attr("id","sb-c-r"+in_index+"-a0"),in_left_shadow_button_id?$(el).find("div").attr("data-shadow-button",in_left_shadow_button_id).attr("id","sb-c-b"+in_index+"D").html("D"):$(el).find("div").attr("id","sb-c-b"+in_index+"D").html("D");break;case 3:$(el).find("div").attr("id","sb-c-b"+in_index+(in_middle_suffix||"")).text(in_middle_label);break;case 4:in_right_shadow_button_id?$(el).find("div").attr("data-shadow-button",in_right_shadow_button_id).attr("id","sb-c-b"+in_index+(in_right_suffix||"")).html(in_right_label||""):$(el).find("div").attr("id","sb-c-b"+in_index+(in_right_suffix||"")).html(in_right_label||""),$(el).attr("id","sb-c-r"+in_index+"-a1");break;case 5:$(el).attr("id","sb-c-r"+in_index+"-t1");break;case 6:$(el).attr("id","sb-c-r"+in_index+"-m1")}}))},scrollToTarget:function(in_target_index){var sb=$("#scoreboard"),sbh=BBAT.truncate(sb.height(),0),sbt=sb.scrollTop(),r=$("#sb-c-b"+in_target_index),rh=BBAT.truncate(r.height(),0),rt=BBAT.truncate(r.position().top,0),half_rh=BBAT.truncate(rh/2,0),scroll_to=null;APP.game.started&&("TARGET"==APP.game.getOption("variation")&&(rh*=3),rt+rh+half_rh>sbh?sbt<sb[0].scrollHeight-sb.outerHeight()-1&&(scroll_to=sbt+(rt+rh+half_rh-sbh)):rt<half_rh&&sbt>0&&(scroll_to=sbt+rt-half_rh),null!=scroll_to&&sb.animate({scrollTop:scroll_to},{duration:APP.is_reloading?0:50,queue:!1}))},show:function(){$("#scoreboard-center").removeClass("scoreboard-lines"),$("#scoreboard-cricket").show(0)},hide:function(in_scoreboard_id){$("#scoreboard-cricket").hide(0)}},APP.keypad_points={speed_keys_basic:[22,25,26,30,40,41,45,60],speed_keys_advanced:[26,40,41,43,45,60,81,85],speed_keys_pro:[41,45,58,59,60,81,85,96],speed_keys_custom:[26,40,41,43,45,60,81,85],setSpeedKeys:function(){var sk,len,i,kp=APP.keypad_points;switch(APP.user_options.speed_keys){case 0:sk=kp.speed_keys_basic;break;case 1:sk=kp.speed_keys_advanced;break;case 2:sk=kp.speed_keys_pro;break;case 3:sk=kp.speed_keys_custom;break;default:sk=kp.speed_keys_basic}for(len=sk.length,i=0;i<len;i++)$("#kp-p-sk-"+i).html(sk[i])},getSpeedKeyCode:function(in_id){var sk,kp=APP.keypad_points;switch(APP.user_options.speed_keys){case 0:sk=kp.speed_keys_basic;break;case 1:sk=kp.speed_keys_advanced;break;case 2:sk=kp.speed_keys_pro;break;case 3:sk=kp.speed_keys_custom;break;default:sk=kp.speed_keys_basic}return""+sk[APP.extractLastNumberSegment(in_id)]},setZeroKey:function(in_key){switch(in_key){case"BUST":$("#kp-p-00").removeClass("key-180").addClass("key-bust").text("BUST");break;case"180":$("#kp-p-00").removeClass("key-bust").addClass("key-180").text("180");break;default:$("#kp-p-00").removeClass("key-180").removeClass("key-bust").text("0")}},setTonKeys:function(in_key,in_arr){switch("180"===in_key&&in_arr&&in_arr.length&&(in_key=in_arr[0]),in_key){case"BUST":case"180":$("#kp-p-times").hide(),$("#kp-p-plus").hide(),$("#kp-p-100").show(),$("#kp-p-140").show();break;default:$("#kp-p-times").show(),$("#kp-p-plus").show(),$("#kp-p-100").hide(),$("#kp-p-140").hide()}},getZeroKey:function(){var txt=$("#kp-p-00").text();return"0"==txt?"00":txt},setTimesMinusOperator:function(in_operator){var el=$(".kp-p-times-minus");switch(in_operator){case"x":el.attr("id","kp-p-times").text("x").removeClass("key-minus");break;case"-":el.attr("id","kp-p-minus").text("-").addClass("key-minus")}},disableSpeedKeys:function(){APP.device.disableButtonClass("keypad-p-gutter-left"),APP.device.disableButtonClass("keypad-p-gutter-right")},enableSpeedKeys:function(){APP.device.enableButtonClass("keypad-p-gutter-left"),APP.device.enableButtonClass("keypad-p-gutter-right")},disableOperators:function(){$(".keypad-p-operator").addClass("button-disabled")},enableOperators:function(){$(".keypad-p-operator").removeClass("button-disabled")},getCustomSpeedKeys:function(){var customSpeedKeys=APP.keypad_points.speed_keys_advanced;return BBAT.fetchData("custom_speed_keys")&&(customSpeedKeys=BBAT.fetchData("custom_speed_keys")),customSpeedKeys},setCustomSpeedKeys:function(in_arr){try{if(!in_arr)return{error:"in_arr not sent"};if(!Array.isArray(in_arr))return{error:"in_arr is not array"};if(8!==in_arr.length)return{error:"in_arr length must be 8"};for(var hasError=!1,i=0;i<8;i++){if(isNaN(in_arr[i])){hasError="Not a number found in array";break}if(in_arr[i]=parseInt(in_arr[i]),"number"!=typeof in_arr[i]){hasError="Array includes non number";break}if(in_arr[i]<10||in_arr[i]>180){hasError="Array includes invalid number";break}}return hasError?(newErrorReport("Invalid Custom Speed Keys","Custom Speed Keys Issue "+JSON.stringify(in_arr),!1),{error:hasError}):(BBAT.storeData({custom_speed_keys:in_arr}),APP.keypad_points.speed_keys_custom=in_arr,APP.keypad_points.setSpeedKeys(),{response:"success"})}catch(e){return newErrorReport(e,"Custom Speed Keys Issue",!1),{error:"General Error"}}},applyCustomSpeedKeys:function(){APP.keypad_points.speed_keys_custom=APP.keypad_points.getCustomSpeedKeys()}},APP.keypad_points.applyCustomSpeedKeys(),APP.plugin_01={dartbot_timer:null,default_options:{},handicap_max:9999,is_bot_turn:!1,is_edit_mode:!1,is_rebuilding_scoring:!1,prev_enter_miss_timestamp:0,prev_plus_timestamp:0,prev_speedkey_timestamp:0,quick_finish_dart:null,saved_entry:null,straight_out_min_dart:[null,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,2,1,2,2,1,2,1,1,2,2,1,2,2,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,3,2,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,null,3,3,null,3,3,null,3,3,null,null,3,null,null,3,null,null,3],double_out_min_dart:[null,null,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,null,3,3,null,null,3,null,null,3,null,null,3,null,null,null,null,null,null,null,null,null,null],master_out_min_dart:[null,null,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,1,1,1,2,1,2,2,1,2,2,1,2,1,1,2,2,1,2,2,1,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,2,2,3,2,2,3,2,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,null,3,3,null,3,3,null,3,3,null,null,3,null,null,3,null,null,3],three_dart_out:{S170:{alpha:"T20,T20,DB",numeric:"60,60,50"},S167:{alpha:"T20,T19,DB",numeric:"60,57,50"},S164:{alpha:"T20,T18,DB",numeric:"60,54,50"},S161:{alpha:"T20,T17,DB",numeric:"60,51,50"},S160:{alpha:"T20,T20,D20",numeric:"60,60,40"},S158:{alpha:"T20,T20,D19",numeric:"60,60,38"},S157:{alpha:"T20,T19,D20",numeric:"60,57,40"},S156:{alpha:"T20,T20,D18",numeric:"60,60,36"},S155:{alpha:"T20,T19,D19",numeric:"60,57,38"},S154:{alpha:"T20,T18,D20",numeric:"60,54,40"},S153:{alpha:"T20,T19,D18",numeric:"60,57,36"},S152:{alpha:"T20,T20,D16",numeric:"60,60,32"},S151:{alpha:"T20,T17,D20",numeric:"60,51,40"},S150:{alpha:"T20,T18,D18",numeric:"60,54,36"},S149:{alpha:"T20,T19,D16",numeric:"60,57,32"},S148:{alpha:"T20,T20,D14",numeric:"60,60,28"},S147:{alpha:"T20,T17,D18",numeric:"60,51,36"},S146:{alpha:"T20,T18,D16",numeric:"60,54,32"},S145:{alpha:"T20,T15,D20",numeric:"60,45,40"},S144:{alpha:"T20,T20,D12",numeric:"60,60,24"},S143:{alpha:"T20,T17,D16",numeric:"60,51,32"},S142:{alpha:"T20,T14,D20",numeric:"60,42,40"},S141:{alpha:"T20,T15,D18",numeric:"60,45,36"},S140:{alpha:"T20,T20,D10",numeric:"60,60,20"},S139:{alpha:"T20,T19,D11",numeric:"60,57,22"},S138:{alpha:"T20,T18,D12",numeric:"60,54,24"},S137:{alpha:"T20,T19,D10",numeric:"60,57,20"},S136:{alpha:"T20,T20,D8",numeric:"60,60,16"},S135:{alpha:"DB,T15,D20",numeric:"50,45,40"},S134:{alpha:"T20,T14,D16",numeric:"60,42,32"},S133:{alpha:"T20,T19,D8",numeric:"60,57,16"},S132:{alpha:"DB,T14,D20",numeric:"50,42,40"},S131:{alpha:"T20,T13,D16",numeric:"60,39,32"},S130:{alpha:"T20,T20,D5",numeric:"60,60,10"},S129:{alpha:"T19,T16,D12",numeric:"57,48,24"},S128:{alpha:"T18,T14,D16",numeric:"54,42,32"},S127:{alpha:"T20,T17,D8",numeric:"60,51,16"},S126:{alpha:"T19,T19,D6",numeric:"57,57,12"},S125:{alpha:"DB,T17,D12",numeric:"50,51,24"},S124:{alpha:"T20,T14,D11",numeric:"60,42,22"},S123:{alpha:"T19,T16,D9",numeric:"57,48,18"},S122:{alpha:"T18,T18,D7",numeric:"54,54,14"},S121:{alpha:"T20,T11,D14",numeric:"60,33,28"},S120:{alpha:"T20,20,D20",numeric:"60,20,40"},S119:{alpha:"T19,T12,D13",numeric:"57,36,26"},S118:{alpha:"T20,18,D20",numeric:"60,18,40"},S117:{alpha:"T20,17,D20",numeric:"60,17,40"},S116:{alpha:"T20,16,D20",numeric:"60,16,40"},S115:{alpha:"T20,15,D20",numeric:"60,15,40"},S114:{alpha:"T18,20,D20",numeric:"54,20,40"},S113:{alpha:"T19,16,D20",numeric:"57,16,40"},S112:{alpha:"T20,12,D20",numeric:"60,12,40"},S111:{alpha:"T18,17,D20",numeric:"54,17,40"},S110:{alpha:"T20,10,D20",numeric:"60,10,40"},S109:{alpha:"T20,9,D20",numeric:"60,9,40"},S108:{alpha:"T18,14,D20",numeric:"54,14,40"},S107:{alpha:"T19,10,D20",numeric:"57,10,40"},S106:{alpha:"T20,14,D16",numeric:"60,14,32"},S105:{alpha:"T20,13,D16",numeric:"60,13,32"},S104:{alpha:"T19,15,D16",numeric:"57,15,32"},S103:{alpha:"T19,10,D18",numeric:"57,10,36"},S102:{alpha:"T20,10,D16",numeric:"60,10,32"},S101:{alpha:"T20,9,D16",numeric:"60,9,32"},S100:{alpha:"T20,D20",numeric:"60,40"},S99:{alpha:"T19,10,D16",numeric:"57,10,32"},S98:{alpha:"T20,D19",numeric:"60,38"},S97:{alpha:"T19,D20",numeric:"57,40"},S96:{alpha:"T20,D18",numeric:"60,36"},S95:{alpha:"DB,13,D16",numeric:"50,13,32"},S94:{alpha:"DB,12,D16",numeric:"50,12,32"},S93:{alpha:"DB,11,D16",numeric:"50,11,32"},S92:{alpha:"DB,10,D16",numeric:"50,10,32"},S91:{alpha:"DB,9,D16",numeric:"50,9,32"},S90:{alpha:"T20,D15",numeric:"60,30"},S89:{alpha:"T19,D16",numeric:"57,32"},S88:{alpha:"T20,D14",numeric:"60,28"},S87:{alpha:"T17,D18",numeric:"51,36"},S86:{alpha:"T18,D16",numeric:"54,32"},S85:{alpha:"T15,D20",numeric:"45,40"},S84:{alpha:"T20,D12",numeric:"60,24"},S83:{alpha:"T17,D16",numeric:"51,32"},S82:{alpha:"DB,D16",numeric:"50,32"},S81:{alpha:"T15,D18",numeric:"45,36"},S80:{alpha:"T20,D10",numeric:"60,20"},S79:{alpha:"T19,D11",numeric:"57,22"},S78:{alpha:"T18,D12",numeric:"54,24"},S77:{alpha:"T19,D10",numeric:"57,20"},S76:{alpha:"T20,D8",numeric:"60,16"},S75:{alpha:"T17,D12",numeric:"51,24"},S74:{alpha:"T14,D16",numeric:"42,32"},S73:{alpha:"T19,D8",numeric:"57,16"},S72:{alpha:"T12,D18",numeric:"36,36"},S71:{alpha:"T13,D16",numeric:"39,32"},S70:{alpha:"T18,D8",numeric:"54,16"},S69:{alpha:"T15,D12",numeric:"45,24"},S68:{alpha:"T20,D4",numeric:"60,8"},S67:{alpha:"T17,D8",numeric:"51,16"},S66:{alpha:"T10,D18",numeric:"30,36"},S65:{alpha:"T11,D16",numeric:"33,32"},S64:{alpha:"T16,D8",numeric:"48,16"},S63:{alpha:"T13,D12",numeric:"39,24"},S62:{alpha:"T10,D16",numeric:"30,32"},S61:{alpha:"B,D18",numeric:"25,36"},S60:{alpha:"20,D20",numeric:"20,40"},S59:{alpha:"19,D20",numeric:"19,40"},S58:{alpha:"18,D20",numeric:"18,40"},S57:{alpha:"17,D20",numeric:"17,40"},S56:{alpha:"16,D20",numeric:"16,40"},S55:{alpha:"15,D20",numeric:"15,40"},S54:{alpha:"14,D20",numeric:"14,40"},S53:{alpha:"13,D20",numeric:"13,40"},S52:{alpha:"12,D20",numeric:"12,40"},S51:{alpha:"11,D20",numeric:"11,40"},S50:{alpha:"10,D20",numeric:"10,40"},S49:{alpha:"9,D20",numeric:"9,40"},S48:{alpha:"8,D20",numeric:"8,40"},S47:{alpha:"15,D16",numeric:"15,32"},S46:{alpha:"10,D18",numeric:"10,36"},S45:{alpha:"13,D16",numeric:"13,32"},S44:{alpha:"12,D16",numeric:"12,32"},S43:{alpha:"11,D16",numeric:"11,32"},S42:{alpha:"10,D16",numeric:"10,32"},S41:{alpha:"9,D16",numeric:"9,32"},S40:{alpha:"D20",numeric:"40"},S39:{alpha:"7,D16",numeric:"7,32"},S38:{alpha:"D19",numeric:"38"},S37:{alpha:"5,D16",numeric:"5,32"},S36:{alpha:"D18",numeric:"36"},S35:{alpha:"3,D16",numeric:"3,32"},S34:{alpha:"D17",numeric:"34"},S33:{alpha:"1,D16",numeric:"1,32"},S32:{alpha:"D16",numeric:"32"},S31:{alpha:"7,D12",numeric:"7,24"},S30:{alpha:"D15",numeric:"30"},S29:{alpha:"5,D12",numeric:"5,24"},S28:{alpha:"D14",numeric:"28"},S27:{alpha:"3,D12",numeric:"3,24"},S26:{alpha:"D13",numeric:"26"},S25:{alpha:"1,D12",numeric:"1,24"},S24:{alpha:"D12",numeric:"24"},S23:{alpha:"7,D8",numeric:"7,16"},S22:{alpha:"D11",numeric:"22"},S21:{alpha:"5,D8",numeric:"5,16"},S20:{alpha:"D10",numeric:"20"},S19:{alpha:"3,D8",numeric:"3,16"},S18:{alpha:"D9",numeric:"18"},S17:{alpha:"9,D4",numeric:"9,8"},S16:{alpha:"D8",numeric:"16"},S15:{alpha:"7,D4",numeric:"7,8"},S14:{alpha:"D7",numeric:"14"},S13:{alpha:"5,D4",numeric:"5,8"},S12:{alpha:"D6",numeric:"12"},S11:{alpha:"3,D4",numeric:"3,8"},S10:{alpha:"D5",numeric:"10"},S9:{alpha:"1,D4",numeric:"1,8"},S8:{alpha:"D4",numeric:"8"},S7:{alpha:"3,D2",numeric:"3,4"},S6:{alpha:"D3",numeric:"6"},S5:{alpha:"1,D2",numeric:"1,4"},S4:{alpha:"D2",numeric:"4"},S3:{alpha:"1,D1",numeric:"1,2"},S2:{alpha:"D1",numeric:"2"}},two_dart_out:{S110:{alpha:"T20,DB",numeric:"60,50"},S107:{alpha:"T19,DB",numeric:"57,50"},S104:{alpha:"T18,DB",numeric:"54,50"},S101:{alpha:"T17,DB",numeric:"51,50"},S100:{alpha:"T20,D20",numeric:"60,40"},S99:{alpha:"T19,10",numeric:"57,10"},S98:{alpha:"T20,D19",numeric:"60,38"},S97:{alpha:"T19,D20",numeric:"57,40"},S96:{alpha:"T20,D18",numeric:"60,36"},S95:{alpha:"T19,D19",numeric:"57,38"},S94:{alpha:"T18,D20",numeric:"54,40"},S93:{alpha:"T19,D18",numeric:"57,36"},S92:{alpha:"T20,D16",numeric:"60,32"},S91:{alpha:"T17,D20",numeric:"51,40"},S90:{alpha:"T18,D18",numeric:"54,36"},S89:{alpha:"T19,D16",numeric:"57,32"},S88:{alpha:"T20,D14",numeric:"60,28"},S87:{alpha:"T17,D18",numeric:"51,36"},S86:{alpha:"T18,D16",numeric:"54,32"},S85:{alpha:"T15,D20",numeric:"45,40"},S84:{alpha:"T20,D12",numeric:"60,24"},S83:{alpha:"T17,D16",numeric:"51,32"},S82:{alpha:"T14,D20",numeric:"42,40"},S81:{alpha:"T15,D18",numeric:"45,36"},S80:{alpha:"T20,D10",numeric:"60,20"},S79:{alpha:"T19,D11",numeric:"57,22"},S78:{alpha:"T18,D12",numeric:"54,24"},S77:{alpha:"T19,D10",numeric:"57,20"},S76:{alpha:"T20,D8",numeric:"60,16"},S75:{alpha:"T17,D12",numeric:"51,24"},S74:{alpha:"T14,D16",numeric:"42,32"},S73:{alpha:"T19,D8",numeric:"57,16"},S72:{alpha:"T16,D12",numeric:"48,24"},S71:{alpha:"T13,D16",numeric:"39,32"},S70:{alpha:"T20,D5",numeric:"60,10"},S69:{alpha:"T19,D6",numeric:"57,12"},S68:{alpha:"T18,D7",numeric:"54,14"},S67:{alpha:"T17,D8",numeric:"51,16"},S66:{alpha:"T16,D9",numeric:"48,18"},S65:{alpha:"T15,D10",numeric:"45,20"},S64:{alpha:"T14,D11",numeric:"42,22"},S63:{alpha:"T13,D12",numeric:"39,24"},S62:{alpha:"T12,D13",numeric:"36,26"},S61:{alpha:"T11,D14",numeric:"33,28"},S60:{alpha:"20,D20",numeric:"20,40"},S59:{alpha:"19,D20",numeric:"19,40"},S58:{alpha:"18,D20",numeric:"18,40"},S57:{alpha:"17,D20",numeric:"17,40"},S56:{alpha:"16,D20",numeric:"16,40"},S55:{alpha:"15,D20",numeric:"15,40"},S54:{alpha:"14,D20",numeric:"14,40"},S53:{alpha:"13,D20",numeric:"13,40"},S52:{alpha:"12,D20",numeric:"12,40"},S51:{alpha:"11,D20",numeric:"11,40"},S50:{alpha:"10,D20",numeric:"10,40"},S49:{alpha:"9,D20",numeric:"9,40"},S48:{alpha:"8,D20",numeric:"8,40"},S47:{alpha:"15,D16",numeric:"15,32"},S46:{alpha:"10,D18",numeric:"10,36"},S45:{alpha:"13,D16",numeric:"13,32"},S44:{alpha:"12,D16",numeric:"12,32"},S43:{alpha:"11,D16",numeric:"11,32"},S42:{alpha:"10,D16",numeric:"10,32"},S41:{alpha:"9,D16",numeric:"9,32"},S40:{alpha:"D20",numeric:"40"},S39:{alpha:"7,D16",numeric:"7,32"},S38:{alpha:"D19",numeric:"38"},S37:{alpha:"5,D16",numeric:"5,32"},S36:{alpha:"D18",numeric:"36"},S35:{alpha:"3,D16",numeric:"3,32"},S34:{alpha:"D17",numeric:"34"},S33:{alpha:"1,D16",numeric:"1,32"},S32:{alpha:"D16",numeric:"32"},S31:{alpha:"7,D12",numeric:"7,24"},S30:{alpha:"D15",numeric:"30"},S29:{alpha:"5,D12",numeric:"5,24"},S28:{alpha:"D14",numeric:"28"},S27:{alpha:"3,D12",numeric:"3,24"},S26:{alpha:"D13",numeric:"26"},S25:{alpha:"1,D12",numeric:"1,24"},S24:{alpha:"D12",numeric:"24"},S23:{alpha:"7,D8",numeric:"7,16"},S22:{alpha:"D11",numeric:"22"},S21:{alpha:"5,D8",numeric:"5,16"},S20:{alpha:"D10",numeric:"20"},S19:{alpha:"3,D8",numeric:"3,16"},S18:{alpha:"D9",numeric:"18"},S17:{alpha:"9,D4",numeric:"9,8"},S16:{alpha:"D8",numeric:"16"},S15:{alpha:"7,D4",numeric:"7,8"},S14:{alpha:"D7",numeric:"14"},S13:{alpha:"5,D4",numeric:"5,8"},S12:{alpha:"D6",numeric:"12"},S11:{alpha:"3,D4",numeric:"3,8"},S10:{alpha:"D5",numeric:"10"},S9:{alpha:"1,D4",numeric:"1,8"},S8:{alpha:"D4",numeric:"8"},S7:{alpha:"3,D2",numeric:"3,4"},S6:{alpha:"D3",numeric:"6"},S5:{alpha:"1,D2",numeric:"1,4"},S4:{alpha:"D2",numeric:"4"},S3:{alpha:"1,D1",numeric:"1,2"},S2:{alpha:"D1",numeric:"2"}},one_dart_out:{S110:{alpha:"T20",numeric:"60"},S107:{alpha:"T19",numeric:"57"},S104:{alpha:"T18",numeric:"54"},S101:{alpha:"T17",numeric:"51"},S100:{alpha:"T20",numeric:"60"},S99:{alpha:"T19",numeric:"57"},S98:{alpha:"T20",numeric:"60"},S97:{alpha:"T19",numeric:"57"},S96:{alpha:"T20",numeric:"60"},S95:{alpha:"T19",numeric:"57"},S94:{alpha:"T18",numeric:"54"},S93:{alpha:"T19",numeric:"57"},S92:{alpha:"T20",numeric:"60"},S91:{alpha:"T17",numeric:"51"},S90:{alpha:"DB",numeric:"50"},S89:{alpha:"T19",numeric:"57"},S88:{alpha:"T20",numeric:"60"},S87:{alpha:"T17",numeric:"51"},S86:{alpha:"DB",numeric:"50"},S85:{alpha:"T15",numeric:"45"},S84:{alpha:"T20",numeric:"60"},S83:{alpha:"T17",numeric:"51"},S82:{alpha:"DB",numeric:"50"},S81:{alpha:"T15",numeric:"45"},S80:{alpha:"T20",numeric:"60"},S79:{alpha:"T19",numeric:"57"},S78:{alpha:"T18",numeric:"54"},S77:{alpha:"T19",numeric:"57"},S76:{alpha:"T20",numeric:"60"},S75:{alpha:"T17",numeric:"51"},S74:{alpha:"T14",numeric:"42"},S73:{alpha:"T19",numeric:"57"},S72:{alpha:"T12",numeric:"36"},S71:{alpha:"T13",numeric:"39"},S70:{alpha:"T18",numeric:"54"},S69:{alpha:"T15",numeric:"45"},S68:{alpha:"T20",numeric:"60"},S67:{alpha:"T17",numeric:"51"},S66:{alpha:"DB",numeric:"50"},S65:{alpha:"T19",numeric:"57"},S64:{alpha:"T16",numeric:"48"},S63:{alpha:"T13",numeric:"39"},S62:{alpha:"T10",numeric:"30"},S61:{alpha:"25",numeric:"25"},S60:{alpha:"20",numeric:"20"},S59:{alpha:"19",numeric:"19"},S58:{alpha:"18",numeric:"18"},S57:{alpha:"17",numeric:"17"},S56:{alpha:"16",numeric:"16"},S55:{alpha:"15",numeric:"15"},S54:{alpha:"14",numeric:"14"},S53:{alpha:"13",numeric:"13"},S52:{alpha:"12",numeric:"12"},S51:{alpha:"11",numeric:"11"},S50:{alpha:"DB",numeric:"50"},S49:{alpha:"9",numeric:"9"},S48:{alpha:"8",numeric:"8"},S47:{alpha:"15",numeric:"15"},S46:{alpha:"10",numeric:"10"},S45:{alpha:"13",numeric:"13"},S44:{alpha:"12",numeric:"12"},S43:{alpha:"11",numeric:"11"},S42:{alpha:"10",numeric:"10"},S41:{alpha:"9",numeric:"9"},S40:{alpha:"D20",numeric:"40"},S39:{alpha:"7",numeric:"7"},S38:{alpha:"D19",numeric:"38"},S37:{alpha:"5",numeric:"5"},S36:{alpha:"D18",numeric:"36"},S35:{alpha:"3",numeric:"3"},S34:{alpha:"D17",numeric:"34"},S33:{alpha:"1",numeric:"1"},S32:{alpha:"D16",numeric:"32"},S31:{alpha:"7",numeric:"7"},S30:{alpha:"D15",numeric:"30"},S29:{alpha:"5",numeric:"5"},S28:{alpha:"D14",numeric:"28"},S27:{alpha:"3",numeric:"3"},S26:{alpha:"D13",numeric:"26"},S25:{alpha:"1",numeric:"1"},S24:{alpha:"D12",numeric:"24"},S23:{alpha:"7",numeric:"7"},S22:{alpha:"D11",numeric:"22"},S21:{alpha:"5",numeric:"5"},S20:{alpha:"D10",numeric:"20"},S19:{alpha:"3",numeric:"3"},S18:{alpha:"D9",numeric:"18"},S17:{alpha:"9",numeric:"9"},S16:{alpha:"D8",numeric:"16"},S15:{alpha:"7",numeric:"7"},S14:{alpha:"D7",numeric:"14"},S13:{alpha:"5",numeric:"5"},S12:{alpha:"D6",numeric:"12"},S11:{alpha:"3",numeric:"3"},S10:{alpha:"D5",numeric:"10"},S9:{alpha:"1",numeric:"1"},S8:{alpha:"D4",numeric:"8"},S7:{alpha:"3",numeric:"3"},S6:{alpha:"D3",numeric:"6"},S5:{alpha:"1",numeric:"1"},S4:{alpha:"D2",numeric:"4"},S3:{alpha:"1",numeric:"1"},S2:{alpha:"D1",numeric:"2"}},init:function(){var dvc=APP.device,plg=APP.plugin_01;plg.default_options.stats_type="POINTS",plg.default_options.ascending_score=!1,plg.default_options.double_in=!1,plg.default_options.all_player_double_in=!1,plg.default_options.double_out=!0,plg.default_options.master_out=!1,plg.default_options.starting_score=501,plg.default_options.hint32=!1,dvc.addButtonHandler(["gsm-01-info","gsm-01-close","gsm-01-handicap","gsm-01-double-in","gsm-01-double-out","gsm-01-adi","gsm-01-101","gsm-01-201","gsm-01-301","gsm-01-401","gsm-01-501","gsm-01-601","gsm-01-701","gsm-01-801","gsm-01-901","gsm-01-1001","gsm-01-hint32","gsm-01-continue"],plg.handleSettingChange),dvc.addFieldHandler(["popup-suggested-out-left","popup-suggested-out-right"],plg.handleSuggestedOutOption),dvc.addFieldHandler(["sb-p-s-g"],plg.handleInOption)},handleInOption:function(){var di=!1,adi=!1;APP.session.isBracketMatch()||(APP.storeGameEvent({cmd:"IN_OPTION",cmd_data:{}}),APP.game.getOption("double_in")?(di=!1,adi=!0):APP.game.getOption("all_player_double_in")?(adi=!1,!0):(!1,di=!0),APP.game.setOptions({double_in:di,all_player_double_in:adi}),APP.plugin_01.setUserControls(),APP.scoreboard_points.displayGameSettings())},handleSuggestedOutOption:function(in_id){APP.plugin_01.hideSuggestedOuts()},storeSettings:function(){var gam=APP.game;BBAT.storeData({settings_01:{options:gam.options,starting_score_0:gam.opponent[0].getStartingScore(),starting_score_1:gam.opponent[1].getStartingScore(),handicap_0:gam.opponent[0].getHandicap(),handicap_1:gam.opponent[1].getHandicap()}}),APP.storeState({settings_change:!0})},initGamePanel:function(){var settings,dvc=APP.device,gam=APP.game,hdr=APP.header,plg=APP.plugin_01;dvc.addButtonHandler(["gsp-opponent-0","gsp-opponent-1","gsp-opponent-x","gsp-opponent-ag","gsp-opponent-as","gsp-opponent-m","gsp-opponent-s","gsp-new-set"],plg.handleGameOption),gam.getOpponentCount()||(gam.opponent_count=2,gam.opponent[0]=new gam.Opponent({starting_score:plg.default_options.starting_score,handicap:0}),gam.opponent[0].setTeam(APP.game.dflt_host_team),gam.opponent[1]=new gam.Opponent({starting_score:plg.default_options.starting_score,handicap:0}),gam.opponent[1].setTeam(APP.game.dflt_guest_team)),gam.resetOptions(),(settings=BBAT.fetchData("settings_01"))?(gam.setOptions(settings.options),gam.opponent[0].setStartingScore(settings.starting_score_0),gam.opponent[1].setStartingScore(settings.starting_score_1),gam.opponent[0].setHandicap(settings.handicap_0),gam.opponent[1].setHandicap(settings.handicap_1)):APP.device.has_chalk&&(gam.setOptions({stats_type:plg.default_options.stats_type,ascending_score:plg.default_options.ascending_score,all_player_double_in:plg.default_options.all_player_double_in,double_in:plg.default_options.double_in,double_out:plg.default_options.double_out,master_out:plg.default_options.master_out,hint32:plg.default_options.hint32}),gam.resetScores(plg.default_options.starting_score)),hdr.resetScoreOptions(),hdr.setScoreOptions({cancel_text:"Cancel Score Edit",done_callback:function(){plg.storeSettings(),plg.refreshGamePanel()},hint_text:'<span style="font-size:0.75em;">Enter Starting Score</span>',max_value:1001}),hdr.refresh(),plg.refreshGamePanel()},refreshGamePanel:function(e,e_info){var gam=APP.game;APP.plugin_01,gam.opponent[0].getStartingScore(),gam.opponent[1].getStartingScore();switch("TEAM"==APP.session.getMatchMode()&&!gam.opponent[0].team.is_default&&gam.opponent[0].team.players.length>0?$("#gsp-opponent-name-0").html(gam.opponent[0].getTeamPlayerNames()):($("#gsp-opponent-name-0").html(gam.opponent[0].getStartButtonName()),$("#gsp-opponent-players-0").html("").removeClass("text-gray")),"TEAM"==APP.session.getMatchMode()&&!gam.opponent[1].team.is_default&&gam.opponent[1].team.players.length>0?$("#gsp-opponent-name-1").html(gam.opponent[1].getTeamPlayerNames()):($("#gsp-opponent-name-1").html(gam.opponent[1].getStartButtonName()),$("#gsp-opponent-players-1").html("").removeClass("text-gray")),APP.session.isNewSet()&&($("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled")),gam.opponent_count){case 1:$("#gsp-opponent-s").addClass("button-disabled"),$("#gsp-opponent-1").addClass("button-disabled"),$("#gsp-opponent-x").addClass("button-disabled"),$("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled");break;case 2:$("#gsp-opponent-s").removeClass("button-disabled"),$("#gsp-opponent-1").removeClass("button-disabled"),$("#gsp-opponent-x").removeClass("button-disabled"),APP.session.isNewSet()||($("#gsp-opponent-m").removeClass("button-disabled"),$("#gsp-opponent-ag").removeClass("button-disabled"))}$("#gsp-settings-title").html(gam.getGameName(!0)),$("#gsp-marksman").css("visibility","hidden"),APP.device.disableButton("gsp-marksman"),"TOURNAMENT"==APP.session.getMatchMode()&&(APP.blockFeatures(["gs-library","header-score"]),APP.blockUIControls())},handleGameOption:function(in_id){var i,gam=APP.game,plg=APP.plugin_01;APP.popup;switch(in_id){case"gsp-settings-title":plg.initGameSettings(),APP.x01Settings.init();break;case"gsp-new-set":APP.session.isNewSet()?(APP.session.popSet(),APP.session.showGameSelector()):APP.session.addSet("01"),APP.reveal.setNewSetButton(),APP.reveal.updateSetStatus(),APP.game.plugin.refreshGamePanel();break;case"gsp-opponent-s":APP.game_selector.selectGame("gs-cork-calls"),APP.session.showBullShoot();break;case"gsp-opponent-0":gam.start(0);break;case"gsp-opponent-1":gam.start(1);break;case"gsp-opponent-x":i=new Date%gam.getOpponentCount(),gam.start(i);break;case"gsp-opponent-ag":i=0==APP.session.getPrevGameStartingOpponent()?1:0,gam.start(i);break;case"gsp-opponent-as":i=0==APP.session.getPrevSetStartingOpponent()?1:0,gam.start(i);break;case"gsp-opponent-m":i=0==APP.session.getPrevGameWinningOpponent()?1:0,gam.start(i)}},initGameSettings:function(){var gam=APP.game;$("#game-settings-menu-01 .menu-option-on").removeClass("menu-option-on"),gam.getOption("double_in")&&$("#gsm-01-double-in").addClass("menu-option-on"),gam.getOption("all_player_double_in")&&$("#gsm-01-adi").addClass("menu-option-on"),gam.getOption("double_out")&&$("#gsm-01-double-out").addClass("menu-option-on"),gam.opponent[0].getCurrentScore()==gam.opponent[1].getCurrentScore()&&$("#gsm-01-"+gam.opponent[0].getCurrentScore()).addClass("menu-option-on"),gam.getOption("hint32")&&$("#gsm-01-hint32").addClass("menu-option-on")},handleSettingChange:function(in_id){var el,gam=APP.game,hdr=APP.header,plg=APP.plugin_01,pup=APP.popup;switch(in_id){case"gsm-01-info":APP.info.show("info-text-x01-settings","x01 Settings");break;case"gsm-01-close":pup.hide(),plg.refreshGamePanel();break;case"gsm-01-double-out":case"gsm-01-hint32":$("#"+in_id).toggleClass("menu-option-on");break;case"gsm-01-double-in":case"gsm-01-adi":(el=$("#"+in_id)).hasClass("menu-option-on")?el.removeClass("menu-option-on"):($(".gsm-01-double-in-group").removeClass("menu-option-on"),el.addClass("menu-option-on"));break;case"gsm-01-out-alpha":case"gsm-01-out-numeric":$("#"+in_id).hasClass("menu-option-on")?$(".gsm-01-out-group").removeClass("menu-option-on"):($(".gsm-01-out-group").removeClass("menu-option-on"),$("#"+in_id).addClass("menu-option-on"));break;case"gsm-01-101":case"gsm-01-201":case"gsm-01-301":case"gsm-01-401":case"gsm-01-501":case"gsm-01-601":case"gsm-01-701":case"gsm-01-801":case"gsm-01-901":case"gsm-01-1001":$(".gsm-01-score-option").removeClass("menu-option-on"),$("#"+in_id).addClass("menu-option-on");break;case"gsm-01-continue":if($("#game-selector").hide(),gam.setOptions({double_in:!1,all_player_double_in:!1,double_out:!1,hint32:!1}),$("#game-settings-menu-01 .menu-option-on").each((function(i){switch(this.id){case"gsm-01-double-in":gam.setOptions({double_in:!0});break;case"gsm-01-adi":gam.setOptions({all_player_double_in:!0});break;case"gsm-01-double-out":gam.setOptions({double_out:!0});break;case"gsm-01-hint32":gam.setOptions({hint32:!0});break;case"gsm-01-101":case"gsm-01-201":case"gsm-01-301":case"gsm-01-401":case"gsm-01-501":case"gsm-01-601":case"gsm-01-701":case"gsm-01-801":case"gsm-01-901":case"gsm-01-1001":var ss=parseInt(APP.extractLastNumberSegment(this.id),10);gam.resetScores(ss),gam.setOptions({starting_score:ss})}})),plg.storeSettings(),pup.hide(),plg.refreshGamePanel(),hdr.refresh(),APP.session.other_game){var scr=APP.game.opponent[0].starting_score,din=APP.game.options.double_in,adin=APP.game.options.all_player_double_in,dout=APP.game.options.double_out,mout=APP.game.options.master_out,lbl=scr;lbl+=adin?" ADI":din?" DI":" SI";var outText=dout?"DO":"SO";mout&&(outText="MO"),lbl+=outText,BBAT.storeData({other_game:{type:APP.game.name,label:lbl,starting_score:scr,all_player_double_in:adin,double_in:din,double_out:dout,master_out:mout,ascending_score:!1,custom:!0}})}window.setTimeout((function(){APP.game_selector.refreshGamePanel(),$("#game-selector").show()}),100)}},handlePostReloading:function(){},handlePostStart:function(){var dvc=APP.device,hdr=APP.header,plg=APP.plugin_01,rvl=APP.reveal,sb=APP.scoreboard,sbp=APP.scoreboard_points;dvc.setKeyboardHandler(plg.handleUserInput),dvc.addButtonHandler(["kp-p-01","kp-p-02","kp-p-03","kp-p-04","kp-p-05","kp-p-06","kp-p-07","kp-p-08","kp-p-09","kp-p-00","kp-p-times","kp-p-plus","kp-p-sk-0","kp-p-sk-1","kp-p-sk-2","kp-p-sk-3","kp-p-sk-4","kp-p-sk-5","kp-p-sk-6","kp-p-sk-7","bb-ig-clear","bb-ig-cancel","bb-ig-restore","bb-pg-clear","bb-pg-cancel","mb-ig-funcl","mb-ig-funcr","mb-ig-control","kp-p-140","kp-p-100"],plg.handleUserInput),dvc.addButtonHandler(["swdm-close","swdm-dart-1","swdm-dart-2","swdm-dart-3"],plg.handleSWDOption),sb.enableScrolling(),sbp.show(),sbp.addNewRow(),sbp.displayGameSettings(),sbp.enableGameSettings(!APP.session.isLeaguePlay()&&APP.device.has_chalk),sbp.activateTurn("turn_current"),rvl.showPanel("keypad-points-panel"),APP.device.has_chalk&&("HOST"==APP.device.role&&1==APP.game.current_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.current_opponent)&&APP.device.releaseChalk(),hdr.resetScoreOptions(),hdr.refresh()},takeDartBotTurn:function(){var skill,oppo;APP.plugin_01.dartbot_timer=null,APP.is_reloading||APP.plugin_01.is_edit_mode||!APP.device.has_chalk||($("#popup-bot-xray").html("&nbsp;"),oppo=APP.game.opponent[APP.game.current_opponent],skill=APP.dartbot.skills_01[oppo.team.players[0].bot_skill],APP.plugin_01.throwDartBotDarts(skill,3))},throwDartBotDarts:function(in_skill,in_darts_left){var gam,db;function processDart(in_value,in_modifier){var str,len,val,i;if("D"==in_modifier&&(db.has_doubled_in=!0),APP.dartbot.isScripted){var currentDart=0;currentDart+=3*(db.turn.length-1),currentDart+=3,currentDart-=in_darts_left;var script=APP.dartbot.scripts[APP.dartbot.activeScript].turns;script[currentDart]&&(in_value=script[currentDart],in_modifier="S",currentDart==[script.length-1]&&(in_modifier="D"))}if(!((gam.getOption("double_in")||gam.getOption("all_player_double_in"))&&!db.has_doubled_in))for(APP.equation.hasUserInput()&&APP.plugin_01.handleUserInput("bot-plus"),val=0+in_value,len=(str=""+(val*=APP.game.getModifierValue(in_modifier))).length,i=0;i<len;i++)APP.plugin_01.handleUserInput("bot-"+str[i])}gam=APP.game,db=gam.opponent[gam.active_opponent],window.setTimeout((function(){var target_request,target_actual,str,need_double_in,modifier;need_double_in=gam.getOption("double_in")&&!db.has_doubled_in,target_request=APP.dartbot.selectTarget01(in_darts_left,need_double_in),target_actual=APP.dartbot.attemptThrow(target_request,in_skill);var dartbot_darts=BBAT.fetchData("dartbot_darts")||"";dartbot_darts+="~"+in_skill.stdev+","+in_skill.mean+","+(APP.game.active_round+1)+","+target_request.toString()+","+target_actual.toString(),BBAT.storeData({dartbot_darts:dartbot_darts}),$("#popup-bot-xray").html($("#popup-bot-xray").html()+target_request.toString()+":"+target_actual.toString()+"&nbsp;/&nbsp;"),"OOB"!=(str=target_actual.toString())?(modifier=str.slice(0,1),processDart(Board.GetSectorValue(target_actual.SectorIndex),modifier)):APP.dartbot.isScripted&&processDart(1,"S"),1==in_darts_left||APP.dartbot.hasEnoughToWin01()||APP.dartbot.isBust01()?window.setTimeout((function(){gam.getOption("double_out")&&APP.dartbot.hasEnoughToWin01()&&"D"!=modifier&&(APP.dartbot.isScripted||APP.equation.reset(APP.equation.value()+1)),APP.equation.hasUserInput()?APP.plugin_01.handleUserInput("bot-enter"):APP.plugin_01.handleUserInput("bot-miss"),APP.popup.hide("popup-bot-xray")}),1e3):APP.plugin_01.throwDartBotDarts(in_skill,--in_darts_left)}),500)},handleSWDOption:function(in_id){APP.device.disableButton("swdm-dart-1"),APP.device.disableButton("swdm-dart-2"),APP.device.disableButton("swdm-dart-3");var bs,gam=APP.game,plg=APP.plugin_01,ao=APP.game.active_opponent,ar=APP.game.active_round;bs=0==ar?APP.game.opponent[ao].getStartingScore():APP.game.opponent[ao].turn[ar-1].current_score;var min_dart=APP.plugin_01.double_out_min_dart[bs];switch(APP.game.options.double_out&&(min_dart=APP.plugin_01.master_out_min_dart[bs]),in_id){case"swdm-close":plg.cancelSWD();break;case"swdm-dart-1":APP.plugin_01.needDoubleOutAttempts(0,!1,!1,min_dart)?APP.plugin_01.requestDoubleOutAttempts({opponent_index:ao,round_index:ar,before_score:bs,after_score:0,winning_dart:1,min_quick_finish_dart:min_dart,callback:function(){gam.finish(1)}}):gam.finish(1);break;case"swdm-dart-2":APP.plugin_01.needDoubleOutAttempts(0,!1,!1,min_dart)?APP.plugin_01.requestDoubleOutAttempts({opponent_index:ao,round_index:ar,before_score:bs,after_score:0,winning_dart:2,min_quick_finish_dart:min_dart,callback:function(){gam.finish(2)}}):gam.finish(2);break;case"swdm-dart-3":APP.plugin_01.needDoubleOutAttempts(0,!1,!1,min_dart)?APP.plugin_01.requestDoubleOutAttempts({opponent_index:ao,round_index:ar,before_score:bs,after_score:0,winning_dart:3,min_quick_finish_dart:min_dart,callback:function(){gam.finish(3)}}):gam.finish(3)}},cancelEOG:function(in_cancel_gsw,in_next_obj){var gam=APP.game,hdr=APP.header,mbr=APP.message_bar,plg=APP.plugin_01,rvl=APP.reveal,sbp=APP.scoreboard_points;APP.game.finished;APP.device.has_chalk&&APP.storeGameEvent({cmd:"CANCEL_EOG",cmd_data:{cancel_gsw:in_cancel_gsw}}),plg.quick_finish_dart=null,gam.resetEOG(in_cancel_gsw),mbr.show("message-bar-ingame"),in_cancel_gsw?(APP.game.plugin.gotoTurn("turn_current"),APP.game.opponent[APP.game.active_opponent].clearTurnPoints(APP.game.active_round)):APP.reveal.hideButtonBar((function(){APP.reveal.clearAllPanels((function(){APP.reveal.resetEOGStatsPanel(),rvl.showPanel("keypad-points-panel",(function(){APP.game.plugin.is_rebuilding_scoring=!0,APP.game.plugin.gotoTurn("turn_current"),null!=in_next_obj&&APP.game.opponent[APP.game.active_opponent].clearTurnPoints(APP.game.active_round),APP.game.plugin.is_rebuilding_scoring=!1,"IN-GAME"==APP.mode&&APP.device.has_chalk&&null==in_next_obj&&(APP.device.is_hosting&&1==APP.game.active_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.active_opponent)&&APP.alert.show("You are now scoring "+APP.game.opponent[APP.game.active_opponent].getChalkboardName()+"'s turn.<p>To edit prior turns, use the [BACK] button.")}))}))}),!0),sbp.resetEOG(),hdr.refresh(),APP.scoreboard.unshield()},startSWD:function(in_winning_opponent,in_live_choice){var dvc=APP.device,gam=APP.game,mbr=APP.message_bar,rvl=APP.reveal,sb=APP.scoreboard,ar=APP.game.active_round,ao=APP.game.active_opponent;if(in_live_choice&&APP.storeGameEvent({cmd:"START_SWD",cmd_data:{winning_opponent:in_winning_opponent}}),APP.plugin_01.is_edit_mode){for(;APP.game.current_round>ar;)APP.scoreboard_points.deleteCurrentTurn();if(APP.game.current_opponent=ao,APP.game.current_round=ar,APP.game.active_opponent=ao,APP.game.active_round=ar,APP.game.isFirstOpponent(ao)){var oo=0==ao?1:0,o_oppo=APP.game.opponent[oo];o_oppo.clearTurnPoints(ar),o_oppo.clearUserInput(ar),APP.scoreboard_points.displayTurnEntry(oo,ar,"")}APP.scoreboard_points.activateTurn("turn_current")}if(APP.game.opponent[0].isPlayerOrderPending()&&APP.header.hidePlayerOrderMenu(0),APP.game.opponent[1].isPlayerOrderPending()&&APP.header.hidePlayerOrderMenu(1),APP.game.opponent[0].player_order.length==APP.game.opponent[0].team.players.length&&APP.game.opponent[1].player_order.length==APP.game.opponent[1].team.players.length||APP.recordError("ClientMsg: Player Order Bug!",!1),APP.plugin_01.hideSuggestedOuts(),APP.game.winning_opponent=in_winning_opponent,APP.game.select_winning_dart=!0,sb.shield(),APP.game.opponent[APP.game.active_opponent].isBotTurn(APP.game.active_round))APP.game.finish(3);else if(APP.plugin_01.quick_finish_dart)APP.plugin_01.handleSWDOption("swdm-dart-"+APP.plugin_01.quick_finish_dart);else if(APP.device.has_chalk){APP.device.enableButtonClass("swdm-dart");var min_dart,oppo=APP.game.opponent[APP.game.winning_opponent],score=oppo.turn[oppo.turn.length-1].points;switch(min_dart=APP.game.options.double_out?APP.plugin_01.double_out_min_dart[score]:APP.plugin_01.straight_out_min_dart[score],APP.game.options.master_out&&(min_dart=APP.plugin_01.master_out_min_dart[score]),min_dart){case 2:APP.device.disableButton("swdm-dart-1");break;case 3:APP.device.disableButton("swdm-dart-1"),APP.device.disableButton("swdm-dart-2")}rvl.slideUpPanel("swd-menu-panel",(function(){mbr.setLeftFunc("back"),mbr.setRightFunc("bust"),gam.getOption("double_out")||dvc.disableButton("mb-ig-funcr")}),!0)}},cancelSWD:function(in_force_bust){APP.device,APP.game,APP.message_bar;var ao,ar,rvl=APP.reveal,sb=APP.scoreboard,sbp=APP.scoreboard_points;APP.plugin_01.quick_finish_dart=null,ao=APP.game.active_opponent,ar=APP.game.active_round,APP.game.select_winning_dart=!1,APP.game.winning_opponent=null,rvl.hideButtonBar((function(){rvl.slideDownPanel("swd-menu-panel","",!0)})),sbp.activateTurn("turn_current"),APP.game.opponent[ao].clearTurnPoints(ar),sb.unshield()},handlePreFinish:function(){var bt,i,o,p,r,wo_index,wr,cr=APP.game.current_round,gam=APP.game,o_cnt=APP.game.getOpponentCount(),sb=(APP.reveal,APP.scoreboard),sbp=APP.scoreboard_points,wo=APP.game.winning_opponent;for(gam.setOptions({stats_type:"POINTS",stats_score_label:"Starting Points"}),sb.unshield(),sb.disableEditing(),sbp.clearAchievementColumns(),wr=0,r=0;r<=cr&&BBAT.isNumeric(gam.opponent[wo].getTurnPoints(r));r++)wr=r;for(wo_index=null,i=0;i<o_cnt;i++)(o=gam.opponent_order[i])==wo?wo_index=i:null!=wo_index&&(gam.opponent[o].clearTurnPoints(wr),gam.opponent[o].clearTurnColor(wr),sbp.displayTurnEntry(o,wr,null));for(r=wr+1;r<=cr;r++)for(o=0;o<o_cnt;o++)gam.opponent[o].clearTurnPoints(r),gam.opponent[o].clearTurnColor(r),sbp.displayTurnEntry(o,r,null);for(o=0;o<o_cnt;o++)gam.opponent[o].recalcScore();for(bt=0,r=0;r<=wr;r++)for(o=0;o<o_cnt;o++)((p=gam.opponent[o].getTurnPoints(r))>=95||r==wr&&o==wo)&&sbp.markExceptionalTurn(o,r),p>bt&&(bt=p);for(r=0;r<=wr;r++)for(o=0;o<o_cnt;o++)(p=gam.opponent[o].getTurnPoints(r))==bt&&sbp.markBestTurn(o,r);sbp.markStartingTurn(gam.opponent_order[0]),sbp.markWinningTurn(wo,wr,gam.winning_dart)},cancelEdit:function(){var plg=APP.plugin_01;plg.restoreEntry(),plg.recordEntry()},restoreEntry:function(){var eq=APP.equation,plg=APP.plugin_01;eq.reset(plg.saved_entry)},isValidEntry:function(checkOnly){var points,min_dart,ao=APP.game.active_opponent,ar=APP.game.active_round,dvc=APP.device,eq=APP.equation,gam=APP.game,mm=(APP.plugin_01,APP.popup,APP.scoreboard_points,APP.session.getMatchMode());APP.user_options.notables;if(points=eq.value(),min_dart=APP.game.options.double_out?APP.plugin_01.double_out_min_dart[points]:APP.plugin_01.straight_out_min_dart[points],APP.game.options.master_out&&(min_dart=APP.plugin_01.master_out_min_dart[points]),!APP.game.plugin.is_edit_mode&&gam.opponent[ao].getCurrentScore()==points&&!min_dart){if(dvc.has_chalk&&!APP.is_reloading){if(checkOnly)return!1;APP.alert.show("This score is invalid.<br />Please check your darts and math to enter the correct score for this turn.")}return!1}var doubleInCheck=!1;if(APP.game.options.all_player_double_in)try{for(var playerScore=0,playerCount=(oppo=gam.opponent[ao]).team.players.length,player=(oppo.turn.length,pi=ar%oppo.team.getPlayerCount(),pi),i=0;i<oppo.turn.length;i++){if((myRound=oppo.turn[i])&&myRound.points){var roundPoints=myRound.points;i==player&&(playerScore+=roundPoints)}(i+1)%playerCount==0&&(player+=playerCount)}0==playerScore&&(doubleInCheck=!0)}catch(e){doubleInCheck=!1}if(APP.game.options.double_in)try{var oppo,pi;for(playerScore=0,playerCount=(oppo=gam.opponent[ao]).team.players.length,oppo.turn.length,pi=ar%oppo.team.getPlayerCount(),player=pi,i=0;i<oppo.turn.length;i++){var myRound;if((myRound=oppo.turn[i])&&myRound.points)playerScore+=roundPoints=myRound.points;(i+1)%playerCount==0&&(player+=playerCount)}0==playerScore&&(doubleInCheck=!0)}catch(e){doubleInCheck=!1}if(doubleInCheck&&points&&!APP.plugin_01.three_dart_out["S"+points]){if(dvc.has_chalk&&!APP.is_reloading){if(checkOnly)return!1;APP.alert.show('This is not a valid <span class="bold">"Double In"</span> score<br /> Please correct the entry')}return!1}if(points<0||points>180||179==points||178==points||176==points||175==points||173==points||172==points||169==points||166==points||163==points){if(dvc.has_chalk&&!APP.is_reloading){if(checkOnly)return!1;APP.alert.show("This score is invalid.<br />Please check your darts and math to enter the correct score for this turn.")}return!1}return!0},recordEntry:function(in_override,bustDarts){var os,cs,ss,points,ao=APP.game.active_opponent,ar=APP.game.active_round,eq=(APP.device,APP.equation),gam=APP.game,plg=APP.plugin_01,pup=APP.popup,sbp=APP.scoreboard_points,broadcast_notable="",mm=APP.session.getMatchMode(),show_notables=APP.user_options.notables&&"TOURNAMENT"!=mm,is_bust=!1,is_miss=!1;if(sbp.clearInsertedMissTurns(),plg.saved_entry=null,points=eq.value(),!APP.plugin_01.isValidEntry())return APP.equation.user_input=[],APP.equation.reset(),APP.message_bar.clear(),$("#mb-ig-message").html("Invalid Score"),void $("#mb-ig-message").addClass("text-gold");ss=gam.opponent[ao].getStartingScore(),os=gam.opponent[ao].getCurrentScore(),gam.opponent[ao].setTurnPoints(ar,points),gam.opponent[ao].clearTurnColor(ar),0==points&&("SKIP"==in_override?gam.opponent[ao].setTurnColor(ar,"SKIP"):(gam.opponent[ao].setTurnColor(ar,"MISS"),is_miss=!0),1==gam.opponent_count&&pup.show("popup-notify","MISS")),cs=gam.opponent[ao].getCurrentScore();var trackBustDarts=!1;try{APP.user_options.bust_darts&&!APP.plugin_01.is_bot_turn&&(trackBustDarts=!0)}catch(e){}if("BUST"==in_override||cs<0||1==cs&&gam.getOption("double_out")){if(trackBustDarts&&!bustDarts&&APP.device.has_chalk&&!APP.is_reloading)return void APP.game.showBustDarts(ao,ar,os,(function(){APP.plugin_01.recordEntry("BUST",!0)}));points=0,gam.opponent[ao].setTurnPoints(ar,points),gam.opponent[ao].setTurnColor(ar,"BUST"),is_bust=!0,plg.is_edit_mode||(show_notables&&pup.show("popup-notable","Bust!"),broadcast_notable="Bust!")}else points>=95&&points<=99?(gam.opponent[ao].setTurnColor(ar,points+"!"),broadcast_notable=points+"!"):100==points?(gam.opponent[ao].setTurnColor(ar,"TON"),broadcast_notable="Ton!"):points>100&&(gam.opponent[ao].setTurnColor(ar,"TON "+(points-100)),broadcast_notable="Ton "+(points-100)+"!"),APP.is_reloading||plg.is_edit_mode||(gam.getOption("double_in")&&os==ss&&points>0?points>=100?(pup.show("popup-notable",points+" In!"),broadcast_notable=points+" In!"):(pup.show("popup-notable",points+" In"),broadcast_notable=points+" In"):points>=95&&points<=99?(show_notables&&pup.show("popup-notable",points+"!"),broadcast_notable=points+"!"):100==points?(show_notables&&pup.show("popup-notable","Ton!"),broadcast_notable="Ton!"):points>100&&(show_notables&&pup.show("popup-notable","Ton "+(points-100)+"!"),broadcast_notable="Ton "+(points-100)+"!"));if(APP.is_reloading||APP.plugin_01.userInputCheck()&&APP.recordError("MISSING TURNS BUG - 01"),sbp.displayTurnEntry(ao,ar,points,gam.opponent[ao].getTurnColor(ar)),0==cs&&"BUST"!=in_override)APP.device.has_chalk&&!APP.is_reloading&&(APP.user_options.game_shot&&!APP.game.isBotPlaying()?APP.game.confirmWinner({ok:function(){APP.game.winning_opponent=ao,APP.plugin_01.startSWD(ao,!0)},cancel:function(){APP.plugin_01.cancelEOG(!0)}}):(APP.game.winning_opponent=ao,APP.plugin_01.startSWD(ao,!0)));else{var min_quick_finish_dart=APP.plugin_01.double_out_min_dart[APP.plugin_01.is_edit_mode?cs+points:os];APP.game.options.master_out&&(min_quick_finish_dart=APP.plugin_01.master_out_min_dart[APP.plugin_01.is_edit_mode?cs+points:os]),APP.plugin_01.needDoubleOutAttempts(cs,is_bust,is_miss,min_quick_finish_dart)?APP.plugin_01.requestDoubleOutAttempts({opponent_index:ao,round_index:ar,before_score:APP.plugin_01.is_edit_mode?cs+points:os,after_score:cs,is_bust:is_bust,is_miss:is_miss,winning_dart:null,min_quick_finish_dart:min_quick_finish_dart,callback:finish}):finish()}function finish(){if(plg.is_edit_mode?sbp.activateTurn("turn_current"):(1==gam.opponent_count&&sbp.activateTurn("turn_next"),sbp.activateTurn("turn_next")),!APP.is_reloading&&APP.device.is_broadcasting){$($("#message-bar-status").clone()[0]);APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),notable:broadcast_notable})}APP.is_reloading||APP.device.is_broadcasting||APP.is_reloading||APP.nlf.rails.retryBroadcast(),!APP.session.isBracketMatch()||APP.device.is_broadcasting||APP.is_reloading||APP.session.bracketFunctions.retryBroadcast(),APP.is_reloading||APP.plugin_01.checkEarlyFinish()}},earlyFinishAttempted:!1,isEarlyFinishActive:function(){try{var match=APP.getMatch();if(match&&match.format){var mf=match.format;if(mf.sudden_death&&"Y"==mf.sudden_death.active){if(mf.sudden_death.round)return!0;if(APP.game.options.starting_score<=501){if(mf.sudden_death.norm_501)return!0}else if(mf.sudden_death.ext_501)return!0}}}catch(e){}return!1},getEarlyFinishTurnLimit:function(){try{var mf=APP.getMatch().format;return mf.sudden_death.round?mf.sudden_death.round+1:APP.game.options.starting_score<=501?mf.sudden_death.norm_501+1:mf.sudden_death.ext_501+1}catch(e){}return-2},checkEarlyFinish:function(){if(this.isEarlyFinishActive()&&!this.earlyFinishAttempted){var turnLimit=this.getEarlyFinishTurnLimit();if(APP.game.active_round+1===turnLimit){var customMsg=!1,mf=APP.getMatch().format;mf.sudden_death&&mf.sudden_death.instructions&&(customMsg=mf.sudden_death.instructions);var team1=getPlayerNameList(APP.game.opponent[0]),team2=getPlayerNameList(APP.game.opponent[1]),isTournament=!1;try{mf.sudden_death&&mf.sudden_death.type&&"TOURNAMENT"==mf.sudden_death.type&&(isTournament=!0)}catch(e){}if(APP.game.active_round+1==turnLimit){var errorMsg="",type="casual";switch(APP.session.isLeaguePlay()&&(type="league"),isTournament&&(type="tournament"),type){case"league":errorMsg=`\n\t\t\t\t\t\t<p>${APP.game.active_round} Turns / ${3*APP.game.active_round} Dart Limit</p>\n\t\t\t\t\t\t<p>This leg has reached the maximum number of darts allowed for league play. Please select the winner.</p>\n\t\t\t\t\t`;break;case"tournament":case"casual":default:errorMsg=`\n\t\t\t\t\t\t<p>${APP.game.active_round} Turns / ${3*APP.game.active_round} Dart Limit</p>\n\t\t\t\t\t\t<p>This leg has reached the maximum number of darts allowed. Please select the winner.</p>\n\t\t\t\t\t`}errorMsg+=customMsg?`\n\t\t\t\t\t<p class="bold highlight-box text-gold">${customMsg}</p>\n\t\t\t\t`:isTournament?"\n\t\t\t\t\t\t<p>Players are instructed to follow the tournament rules to determine the winner of this leg.</p>\n\t\t\t\t\t":"\n\t\t\t\t\t\t<p>Players are instructed to follow the league rules to determine the winner of this leg.</p>\n\t\t\t\t\t",errorMsg+=`\t\n\t\t\t\t<div class="dialogBtn button button-menu button-green round-corners"\n\t\t\t\t\tid="ef-player0-btn"\n\t\t\t\t>\n\t\t\t\t\t${APP.game.opponent[0].getChalkboardName()}\n\t\t\t\t</div>\n\t\t`,team1&&!isTournament&&(errorMsg+=`\n\t\t\t\t\t<p>${team1}</p>\n\t\t\t\t`),errorMsg+=`\n\t\t\t\t<div class="dialogBtn button button-menu button-green round-corners"\n\t\t\t\t\tid="ef-player1-btn"\n\t\t\t\t>\n\t\t\t\t\t${APP.game.opponent[1].getChalkboardName()}\n\t\t\t\t</div>\n\t\t`,team2&&!isTournament&&(errorMsg+=`\n\t\t\t\t\t<p>${team2}</p>\n\n\t\t\t\t\t<hr />\n\t\t\t\t`),errorMsg+='\n\t\t\t\t<p>OR</p>\n\n\t\t\t\t<div class="dialogBtn button button-menu button-red round-corners"\n\t\t\t\t\tid="ef-continue-btn"\n\t\t\t\t>\n\t\t\t\t\tContinue This Leg\n\t\t\t\t</div>\n\t\t\t',APP.dialog.show({title:"Sudden Death!",msg:errorMsg,use_close_icon:!1}),this.earlyFinishAttempted=!0}APP.fns.activateBtn(["ef-player0-btn","ef-player1-btn","ef-continue-btn"],this.handleEarlyFinish)}}function getPlayerNameList(oppo){try{var playerName="";if(oppo.getPlayers().length<1)return"";for(var i=0;i<oppo.getPlayers().length;i++)playerName+=oppo.getChalkboardName(i),playerName+=" &amp; ";return playerName.substring(0,playerName.length-7)}catch(e){}return""}},handleEarlyFinish:function(in_id){if("ef-continue-btn"==in_id)return APP.dialog.hide(),void(this.earlyFinishAttempted=!0);APP.game.active_opponent;var leg_html_0,leg_html_1,leg_wins=APP.session.getLegsStanding().split(" - ");leg_wins[0]=parseInt(leg_wins[0]),leg_wins[1]=parseInt(leg_wins[1]),"ef-player0-btn"==in_id?(leg_html_0='<span style="color:red;">'+(leg_wins[0]+1)+"</span>",leg_html_1=leg_wins[1]):(leg_html_0=leg_wins[0],leg_html_1='<span style="color:red;">'+(leg_wins[1]+1)+"</span>");var html='<p style="font-size:2em;font-weight:bold;color:red;margin:0.5em 0 0.3em;">'+("ef-player0-btn"==in_id?APP.game.opponent[0].getChalkboardName():APP.game.opponent[1].getChalkboardName())+'</p><p style="font-size:2em;font-weight:bold;">'+leg_html_0+" - "+leg_html_1+"</p>";switch(in_id){case"ef-player0-btn":APP.dialog.hide(),APP.confirm.show({title:"Confirm Game Winner:",msg:html,ok:function(){APP.game.winning_opponent=0,APP.game.sudden_death_win=!0,APP.game.finish(3)},cancel:function(){this.earlyFinishAttempted=!1,APP.plugin_01.checkEarlyFinish()}});break;case"ef-player1-btn":APP.dialog.hide(),APP.confirm.show({title:"Confirm Game Winner:",msg:html,ok:function(){APP.game.winning_opponent=1,APP.game.sudden_death_win=!0,APP.game.finish(3)},cancel:function(){this.earlyFinishAttempted=!1,APP.plugin_01.checkEarlyFinish()}})}},needDoubleOutAttempts:function(in_after_score,in_is_bust,in_is_miss,in_min_quick_finish_dart){var ao=APP.game.active_opponent,ar=APP.game.active_round,oppo=APP.game.opponent[ao];if(1==oppo.team.players.length);else{if(0==oppo.player_order.length)return!1;oppo.player_order[ar%oppo.player_order.length]}var tfc=APP.game.getTurnsFromCurrent();return!APP.is_reloading&&APP.device.has_chalk&&!APP.plugin_01.is_bot_turn&&(0==tfc||1==tfc)&&APP.game.getOption("double_out")&&APP.user_options.do_attempts&&in_min_quick_finish_dart&&(in_is_bust||in_is_miss||in_after_score<51)},requestDoubleOutAttempts:function(in_params){var dart_choices;if(APP.device.enableButton("pda-1"),APP.device.enableButton("pda-2"),APP.device.enableButton("pda-3"),2!=in_params.before_score){switch(in_params.min_quick_finish_dart){case 3:switch(in_params.winning_dart){case 1:case 2:case 3:return APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,null,in_params.callback),void APP.game.handleDoubleOutAttempts("pda-1");default:dart_choices=[!0,!0,!1,!1]}break;case 2:switch(in_params.winning_dart){case 1:case 2:return APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,null,in_params.callback),void APP.game.handleDoubleOutAttempts("pda-1");case 3:dart_choices=[!1,!0,!0,!1];break;default:dart_choices=[!0,!0,!0,!1]}break;default:switch(in_params.winning_dart){case 1:return APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,null,in_params.callback),void APP.game.handleDoubleOutAttempts("pda-1");case 2:dart_choices=[!1,!0,!0,!1];break;case 3:dart_choices=[!1,!0,!0,!0];break;default:dart_choices=[!0,!0,!0,!0]}}APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,dart_choices,in_params.callback)}else in_params.is_bust||in_params.is_miss?(dart_choices=[!1,!0,!0,!0],APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,dart_choices,in_params.callback)):in_params.winning_dart?(APP.game.showDoubleOutAttempts(in_params.opponent_index,in_params.round_index,null,in_params.callback),APP.game.handleDoubleOutAttempts("pda-"+in_params.winning_dart)):in_params.callback()},requestBustDarts:function(in_params){APP.device.enableButton("pbd-1"),APP.device.enableButton("pbd-2"),APP.device.enableButton("pbd-3")},broadcastSuggestedOut:function(in_pending_score){APP.plugin_01.showSuggestedOuts(in_pending_score,!0)&&APP.server.postBroadcast({suggested_out:{active_side:APP.game.active_opponent,left_html:$(".pso-cell-left").text()?$("#popup-suggested-out-left").html():"",right_html:$(".pso-cell-right").text()?$("#popup-suggested-out-right").html():""}})},showSuggestedOuts:function(in_pending_score,in_broadcast){var out3,out2,out1,type,eq=APP.equation,uo=APP.user_options;function show3Outs(in_3_outs,in_side,in_is_active){var outs;switch(in_is_active?$("#popup-suggested-out-"+in_side).removeClass("pso-inactive-side").addClass("pso-active-side"):$("#popup-suggested-out-"+in_side).removeClass("pso-active-side").addClass("pso-inactive-side"),(outs="ALPHA"==type?in_3_outs.alpha.split(","):in_3_outs.numeric.split(",")).length){case 3:$("#pso-a-"+in_side+"-3").html(outs[0]),$("#pso-a-"+in_side+"-2").html(outs[1]),$("#pso-a-"+in_side+"-1").html(outs[2]);break;case 2:$("#pso-a-"+in_side+"-3").html(outs[0]),$("#pso-a-"+in_side+"-2").html(outs[1]);break;case 1:$("#pso-a-"+in_side+"-3").html(outs[0])}in_broadcast||(APP.popup.show("popup-suggested-out-"+in_side),APP.popup.show("popup-coach-container"))}APP.plugin_01.hideSuggestedOuts(),$(".pso-cell-left").empty(),$(".pso-cell-right").empty();var show_left=uo.suggested_out_left,show_right=uo.suggested_out_right;if(0==APP.game.current_round)return!1;if(!show_left&&!show_right&&!in_broadcast)return!1;var active_left=0==APP.game.active_opponent,active_side=active_left?"left":"right",inactive_side=active_left?"right":"left",active_score=in_pending_score,inactive_score=APP.game.opponent[active_left?1:0].getCurrentScore();in_broadcast||uo.suggested_out_standard?type="ALPHA":uo.suggested_out_numeric&&(type="NUMERIC");var show_active=active_score<=170&&active_score>0&&(active_left&&show_left||!active_left&&show_right||in_broadcast),show_three=!eq.hasUserInput(),show_other=eq.getPlusCount()>0;(show_three||show_other)&&show_active&&(out3=APP.plugin_01.three_dart_out["S"+active_score],out2=APP.plugin_01.two_dart_out["S"+active_score],out1=APP.plugin_01.one_dart_out["S"+active_score],out3=out3||out2||out1,show_three&&out3?show3Outs(out3,active_side,!0):(out2||out1)&&function(in_2_outs,in_1_outs,in_side){var outs,dart='<img src="images/dart_flight_white.png" />';if($("#popup-suggested-out-"+in_side).removeClass("pso-inactive-side").addClass("pso-active-side"),in_2_outs)switch(outs="ALPHA"==type?in_2_outs.alpha.split(","):in_2_outs.numeric.split(","),$("#pso-a-"+in_side+"-3").html(dart),outs.length){case 2:$("#pso-a-"+in_side+"-2").html(outs[0]),$("#pso-a-"+in_side+"-1").html(outs[1]);break;case 1:$("#pso-a-"+in_side+"-1").html(outs[0])}in_1_outs&&(outs="ALPHA"==type?in_1_outs.alpha.split(","):in_1_outs.numeric.split(","),$("#pso-b-"+in_side+"-3").html(dart),$("#pso-b-"+in_side+"-2").html(dart),$("#pso-b-"+in_side+"-1").html(outs[0])),in_broadcast||(APP.popup.show("popup-suggested-out-"+in_side),APP.popup.show("popup-coach-container"))}(out2,out1,active_side));var show_inactive=null!=(out3=APP.plugin_01.three_dart_out["S"+inactive_score])&&inactive_score<=170&&inactive_score>0&&(active_left&&show_right||!active_left&&show_left||in_broadcast);return show_inactive&&show3Outs(out3,inactive_side,!1),show_active||show_inactive},hideSuggestedOuts:function(){APP.popup.hide("popup-coach-container"),APP.popup.hide("popup-suggested-out-left"),APP.popup.hide("popup-suggested-out-right")},displayOpponentHint:function(){var cs,hint,ao=APP.game.active_opponent;function colorHint(in_hint){return in_hint<=20?in_hint:in_hint>=61||in_hint%3!=0?'<span style="color:gray;">'+in_hint+"</span>":in_hint}(cs=APP.game.opponent[ao].getCurrentScore())<=120&&cs>40&&(hint='<span class="mb-ig-message-hint">'+colorHint(cs-40)+" &#183; "+colorHint(cs-32)+" &#183; "+colorHint(cs-24)+"</span>",0==ao?APP.message_bar.display('<div class="mb-ig-message-indicator-left mb-ig-message-center">'+hint+"</div>"):APP.message_bar.display('<div class="mb-ig-message-indicator-right mb-ig-message-center">'+hint+"</div>"))},gotoTurn:function(in_id){APP.scoreboard_points.activateTurn(in_id)},hasScoreBeenEdited:function(){try{APP.game;var plg=APP.plugin_01;if(!APP.is_reloading&&1==plg.is_edit_mode)return!0}catch(e){}return!1},handlePreActivateTurn:function(in_id){var ao=APP.game.active_opponent,ar=APP.game.active_round,gam=(APP.equation,APP.game),hdr=APP.header,sbp=(APP.plugin_01,APP.scoreboard_points),sb=APP.scoreboard;sbp.displayTurnEntry(ao,ar,gam.opponent[ao].getTurnPoints(ar),gam.opponent[ao].getTurnColor(ar)),APP.device.has_chalk&&sb.enableEditing(),hdr.refresh()},handlePostActivateTurn:function(){var oppo,pc,pi,ao=APP.game.active_opponent,ar=APP.game.active_round,dvc=APP.device,eq=APP.equation,gam=APP.game,hdr=APP.header,mbr=APP.message_bar,plg=APP.plugin_01,sb=APP.scoreboard,sbp=APP.scoreboard_points;if(plg.hideSuggestedOuts(),plg.is_edit_mode=!gam.isCurrentTurnActive(),plg.is_edit_mode){var tfc=gam.getTurnsFromCurrent();gam.deepest_initiated_edit<tfc&&(gam.deepest_initiated_edit=tfc)}(oppo=gam.opponent[ao]).turn[ar].do_attempts=null,plg.is_edit_mode&&(sb.disableEditing(),plg.saved_entry=oppo.getUserInput(ar)),eq.linkToUserInput(oppo.getUserInput(ar,!0)),gam.started_scoring&&mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0}),sbp.displayTurnEntry(ao,ar,eq.value(),oppo.getTurnColor(ar)),plg.setUserControls(),pc=oppo.team.getPlayerCount(!0),pi=APP.game.active_round%pc,clearTimeout(plg.dartbot_timer),plg.dartbot_timer=null,plg.is_bot_turn=!1,APP.device.has_chalk&&APP.device.enableButton("reveal-settings",!0),pc>0&&"Pfiller"==oppo.team.players[pi].obj_id&&!APP.plugin_01.is_edit_mode?APP.is_reloading||APP.plugin_01.handleUserInput("skip"):!APP.is_reloading&&oppo.isBotTurn(APP.game.active_round)?(APP.plugin_01.is_bot_turn=!0,APP.device.disableButton("reveal-settings"),APP.scoreboard_points.enableGameSettings(!1),APP.plugin_01.dartbot_timer=setTimeout(APP.plugin_01.takeDartBotTurn,APP.user_options.dartbot_quick_play?1e3:4e3),plg.is_edit_mode||!APP.user_options.suggested_out_standard&&!APP.user_options.suggested_out_numeric||(plg.hideSuggestedOuts(),plg.showSuggestedOuts(oppo.getCurrentScore()))):(APP.is_reloading||plg.is_edit_mode||!APP.device.is_broadcasting||plg.broadcastSuggestedOut(oppo.getCurrentScore()),plg.is_edit_mode||!APP.user_options.suggested_out_standard&&!APP.user_options.suggested_out_numeric||(plg.hideSuggestedOuts(),plg.showSuggestedOuts(oppo.getCurrentScore())),APP.game.getOption("hint32")&&plg.displayOpponentHint()),APP.game.started_scoring&&APP.device.needToReleaseChalk()&&(APP.game.is_busting_darts||dvc.releaseChalk(!0)),APP.scoreboard_points.markStartingTurn(APP.game.opponent_order[0]),hdr.refresh()},setUserMessage:function(){var show_bust,min_dart,ao=APP.game.active_opponent,ar=APP.game.active_round,gam=APP.game,mbr=APP.message_bar,plg=APP.plugin_01;APP.equation.hasUserInput()||(show_bust=gam.opponent[ao].getCurrentScore()<=181&&!BBAT.isNumeric(APP.equation.getLastElement()),!plg.is_edit_mode&&show_bust&&APP.device.has_chalk&&!APP.game.opponent[ao].isBotTurn(ar)?(min_dart=APP.game.getOption("double_out")?APP.plugin_01.double_out_min_dart[gam.opponent[ao].getCurrentScore()]:APP.plugin_01.straight_out_min_dart[gam.opponent[ao].getCurrentScore()],APP.game.getOption("master_out")&&(min_dart=APP.plugin_01.master_out_min_dart[gam.opponent[ao].getCurrentScore()]),APP.user_options.fast_finish_flights&&mbr.showQuickFinish(plg.handleQuickFinish,min_dart)):gam.opponent[ao].current_score==gam.opponent[ao].starting_score?gam.getOption("double_in")?mbr.display('<span class="text-gold">Double-In</span>'):gam.getOption("all_player_double_in")?mbr.display('<span class="text-gold">All Double-In</span>'):mbr.display('<span class="text-gold">Straight-In</span>'):mbr.display(""))},setUserControls:function(){var editing_entry,show_key,ao=APP.game.active_opponent,ar=APP.game.active_round,dvc=APP.device,first_turn=APP.game.isFirstTurnActive(),gam=APP.game,eq=APP.equation,mbr=APP.message_bar,plg=APP.plugin_01,rvl=APP.reveal,sbp=APP.scoreboard_points;if(APP.header.disableHandicapping(),APP.device.disableFieldClass("header-score"),APP.device.has_chalk&&(!APP.game.started||APP.game.started_scoring||APP.game.isSomeoneScoring()?plg.is_edit_mode||APP.device.enableFieldID("hdr-score-"+ao):APP.header.enableHandicapping()),BBAT.isNumeric(APP.equation.getLastElement()))show_key="0";else{var lastChanceFor180=182;try{APP.game.getOption("master_out")&&(lastChanceFor180=180)}catch(e){}show_key=gam.opponent[ao].getCurrentScore()>=lastChanceFor180?"180":"BUST"}APP.keypad_points.setZeroKey(show_key),APP.keypad_points.setTonKeys(show_key,APP.equation.getLastElement()),APP.device.has_chalk&&!APP.device.big_ui&&(gam.opponent[ao].hasUserInput(ar)?(APP.device.disableButtonClass("keypad-p-gutter-left"),APP.device.disableButtonClass("keypad-p-gutter-right")):(APP.device.enableButtonClass("keypad-p-gutter-left"),APP.device.enableButtonClass("keypad-p-gutter-right"))),gam.isCurrentTurnActive()?(rvl.hideButtonBar(),gam.opponent[ao].hasUserInput(ar)?(mbr.setLeftFunc("backspace"),mbr.setRightFunc("enter")):(1==gam.opponent_count?(mbr.setLeftFunc("back",first_turn&&!gam.hasAnyoneScored()),first_turn&&!gam.hasAnyoneScored()&&APP.device.has_chalk&&APP.device.enableButton("mb-ig-funcl",!0)):(mbr.setLeftFunc("back",APP.server.chalk_release_timer_id||!1),first_turn&&gam.hasAnyoneScored()||!APP.device.has_chalk||APP.device.enableButton("mb-ig-funcl",!0)),mbr.setRightFunc("miss"))):(editing_entry=!gam.opponent[ao].getUserInput(ar).isEquivalent(plg.saved_entry),APP.device.has_chalk&&APP.device.disableButtonClass("keypad-p-gutter"),rvl.showPanel("keypad-points-panel",(function(){rvl.showButtonBar("button-bar-ingame","Cancel",(function(){sbp.scrollToActiveRound()}))})),editing_entry?($("#bb-ig-restore").html("Restore"),dvc.enableButton("bb-ig-restore")):(dvc.disableButton("bb-ig-restore"),1!=APP.game.getTurnsFromCurrent()||editing_entry||($("#bb-ig-restore").html("Insert MISS (&#8709;)"),dvc.enableButton("bb-ig-restore"))),gam.opponent[ao].hasUserInput(ar)?(dvc.enableButton("bb-ig-clear"),mbr.setLeftFunc("backspace"),mbr.setRightFunc("enter")):(dvc.disableButton("bb-ig-clear"),1!=APP.game.getTurnsFromCurrent()||APP.game.isFirstTurnActive()?APP.game.hasAnyoneScored()?mbr.setLeftFunc("backspace",!1):mbr.setLeftFunc("back",APP.device.has_chalk):mbr.setLeftFunc("delete"),mbr.setRightFunc("miss"))),sbp.enableGameSettings(!APP.session.isLeaguePlay()&&!gam.hasUserStartedScoring()&&APP.device.has_chalk&&!APP.plugin_01.is_edit_mode),plg.setUserMessage(),APP.device.has_chalk||eq.hasUserInput()||APP.server.chalk_release_timer_id?($("#mb-ig-control").css("display","none"),$("#mb-ig-message").css("display","inline-block")):($("#mb-ig-control").css("display","inline-block"),$("#mb-ig-message").css("display","none")),0==APP.game.current_round&&(APP.header.enablePlayerOrderProcessing(0,!0),APP.header.enablePlayerOrderProcessing(1,!0))},handleQuickFinish:function(in_id){var cs,i,len,ao=APP.game.active_opponent,plg=APP.plugin_01;for(len=(cs=""+APP.game.opponent[ao].getCurrentScore()).length,plg.quick_finish_dart=APP.extractLastNumberSegment(in_id),i=0;i<len;i++)plg.handleUserInput("qf-"+cs[i]);plg.handleUserInput("qf-enter")},handleRemoteHandicap:function(in_cmd_data){APP.game.opponent[0].setHandicap(in_cmd_data.handicap_0),APP.game.opponent[1].setHandicap(in_cmd_data.handicap_1),APP.plugin_01.storeSettings(),APP.header.refresh(),APP.scoreboard_points.displayGameSettings(),APP.popup.show("popup-notable","Game On!")},resetHandicapping:function(){APP.game.opponent[0].setHandicap(0),APP.game.opponent[1].setHandicap(0),APP.plugin_01.storeSettings()},startHandicapping:function(in_oppo_index){APP.plugin_01.resetHandicapping(),APP.header.refresh(),APP.scoreboard_points.displayGameSettings(),APP.scoreboard.shield(),APP.popup.hide("popup-notable"),APP.popup.show("popup-notify",'<span style="font-size:0.6em;">Change starting score, then click/tap [Enter] to start playing.</span>',8e3),APP.keypad_points.disableOperators(),APP.keypad_points.disableSpeedKeys(),APP.keypad_points.setZeroKey("0"),$("#bb-pg-cancel").html("Cancel Handicapping"),APP.reveal.showButtonBar("button-bar-pregame"),APP.game.opponent[in_oppo_index].setHandicap(0);var cs=APP.game.opponent[in_oppo_index].getCurrentScore();APP.header.disableHandicapping(),APP.header.disableEditing(),APP.header.showPendingScore(in_oppo_index,cs,!0),APP.equation.linkToUserInput(APP.header.user_input),APP.equation.reset(cs),APP.message_bar.setLeftFunc("backspace"),APP.message_bar.setRightFunc("enter"),APP.message_bar.clear(),APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text}),APP.game.handicap_opponent=in_oppo_index,APP.game.is_handicapping=!0},finishHandicapping:function(in_cancel){var ss,hc;if(in_cancel)APP.plugin_01.resetHandicapping();else{if(ss=APP.game.opponent[APP.game.handicap_opponent].getStartingScore(),APP.equation.value()<=1)return void APP.alert.show("Handicapped score must be higher than 1");hc=APP.equation.value()-ss,APP.game.opponent[APP.game.handicap_opponent].setHandicap(hc),APP.plugin_01.storeSettings()}APP.storeGameEvent({cmd:"HANDICAP",cmd_data:{handicap_0:APP.game.opponent[0].getHandicap(),handicap_1:APP.game.opponent[1].getHandicap()}}),APP.game.setInitialAutoBalanceHandicap(),APP.reveal.hideButtonBar(),$("#bb-pg-cancel").html("Cancel Score Edit"),APP.equation.reset(),APP.equation.linkToUserInput(APP.game.opponent[APP.game.opponent_order[0]].getUserInput(0,!0)),APP.scoreboard.unshield(),APP.keypad_points.enableOperators(),APP.plugin_01.setUserControls(),APP.header.refresh(),APP.scoreboard_points.displayGameSettings(),APP.game.handicap_opponent=null,APP.game.is_handicapping=!1,APP.popup.show("popup-notable","Game On!")},editScore:function(in_oppo_index){APP.game.started&&!APP.game.started_scoring?APP.plugin_01.startHandicapping(in_oppo_index):APP.plugin_01.handleUserInput("reverse_score")},easterEgg:function(){APP.plugin_01.handleUserInput("reverse_score")},handleUserInput:function(in_code,in_shift_key,in_remote){var btn_code,bot_action,chkout,entry,i,points,len,ao=APP.game.active_opponent,ar=APP.game.active_round,co=APP.game.current_opponent,cr=APP.game.current_round,eq=APP.equation,gam=APP.game,hdr=APP.header,inserted_miss=!1,mbr=APP.message_bar,plg=APP.plugin_01,sbp=APP.scoreboard_points;function enterMissTimeOK(){return!!in_remote||(!!testbot.isRunning||!(!APP.is_reloading&&new Date-APP.plugin_01.prev_enter_miss_timestamp<2e3)&&(APP.is_reloading||(APP.plugin_01.prev_enter_miss_timestamp=new Date),!0))}function storeEvent(in_code,in_shift_key){APP.game.is_handicapping||(APP.game.started_scoring||"btn-back"!=in_code)&&APP.storeGameEvent({cmd:"KEY",cmd_data:{code:in_code,shift_key:in_shift_key}})}if("none"==$("#players-menu-overlay").css("display")||"mb-ig-funcl"==in_code)if("bb-pg-cancel"!=in_code){if("bb-pg-clear"==in_code)return APP.equation.reset(),void APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text});if(APP.game.opponent[ao].isBotTurn(ar)||plg.hideSuggestedOuts(),clearTimeout(APP.plugin_01.plus_timer),$("#kp-p-plus").removeClass("kp-p-send-score").text("+"),!gam.finished&&null!=in_code&&"btn-undefined"!=in_code)if(APP.session.changePlayerDivDisplayed&&!APP.is_reloading&&APP.session.hideChangePlayerDiv(!0),bot_action=-1!=(in_code=""+in_code).indexOf("bot-"),!APP.plugin_01.is_bot_turn||bot_action||APP.plugin_01.is_edit_mode||APP.plugin_01.dartbot_timer&&"mb-ig-funcl"==in_code)if("mb-ig-control"!=in_code)if(APP.device.has_chalk||in_remote||"back"==(btn_code="funcl"==in_code.substr(in_code.lastIndexOf("-")+1)?mbr.getFunc("funcl",!0):"")&&APP.server.chalk_release_timer_id){if(BBAT.isNumeric(in_code))if(in_code>=48&&in_code<=57)if(in_shift_key)56==in_code&&(storeEvent(in_code,in_shift_key),eq.addOperator("x"));else{if(APP.game.is_handicapping)return eq.addDigit(in_code-48,APP.plugin_01.handicap_max),void APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text});storeEvent(in_code,in_shift_key),eq.addDigit(in_code-48,180)}else if(in_code>=96&&in_code<=105){if(APP.game.is_handicapping)return eq.addDigit(in_code-96,APP.plugin_01.handicap_max),void APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text});storeEvent(in_code,in_shift_key),eq.addDigit(in_code-96,180)}else switch(parseInt(in_code)){case 8:storeEvent(in_code,in_shift_key),eq.backspace();break;case 9:return void(!in_shift_key&&enterMissTimeOK()&&(storeEvent(in_code,in_shift_key),plg.recordEntry()));case 13:return void(enterMissTimeOK()&&(storeEvent(in_code,in_shift_key),plg.recordEntry()));case 27:return storeEvent(in_code,in_shift_key),void plg.cancelEdit();case 107:storeEvent(in_code,in_shift_key),eq.addOperator("+");break;case 106:storeEvent(in_code,in_shift_key),eq.addOperator("x");break;case 187:if(!in_shift_key)return void(enterMissTimeOK()&&(storeEvent(in_code,in_shift_key),plg.recordEntry()));storeEvent(in_code,in_shift_key),eq.addOperator("+");break;default:return}else{if("funcr"==(btn_code=in_code.indexOf("-sk-")>=0?APP.keypad_points.getSpeedKeyCode(in_code):in_code.substr(in_code.lastIndexOf("-")+1))?btn_code=mbr.getFunc("funcr"):"funcl"==btn_code&&(btn_code=mbr.getFunc("funcl",!0)),null==btn_code)return;if(!(in_remote||"enter"!=btn_code&&"miss"!=btn_code||"qf-enter"==in_code||enterMissTimeOK()))return;if(BBAT.isNumeric(btn_code)&&parseInt(btn_code,10)>9){if(!in_remote&&!APP.is_reloading&&new Date-APP.plugin_01.prev_speedkey_timestamp<2e3)return;APP.plugin_01.prev_speedkey_timestamp=new Date}if(storeEvent("btn-"+btn_code),BBAT.isNumeric(btn_code)){if("00"==btn_code&&"BUST"==(btn_code=APP.keypad_points.getZeroKey()))return void APP.plugin_01.recordEntry("BUST");if(parseInt(btn_code,10)>9){for(len=btn_code.length,i=0;i<len;i++)eq.addDigit(btn_code.substr(i,1),180);return plg.recordEntry(),mbr.fakePrevFuncr("enter"),void((parseInt(btn_code,10)<95||!APP.user_options.notables)&&APP.popup.show("popup-notify",parseInt(btn_code,10)))}if(APP.game.is_handicapping)return eq.addDigit(parseInt(btn_code,10),APP.plugin_01.handicap_max),void APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text});eq.addDigit(parseInt(btn_code,10),180)}else switch(btn_code){case"cancel":plg.cancelEdit();break;case"back":if(gam.select_winning_dart)return void plg.cancelSWD();if(!gam.hasAnyoneScored())return void APP.newGame("DELETE");APP.server.cancelChalkRelease(),APP.game.opponent[APP.game.active_opponent].turn[APP.game.active_round].reset(),APP.game.opponent[0].recalcScore(),APP.header.refresh(),sbp.activateTurn("turn_prev");break;case"bust":return plg.cancelSWD(!0),void plg.recordEntry("BUST");case"clear":eq.reset();break;case"restore":$("#bb-ig-restore").text().indexOf("Insert")>=0?(gam.opponent[co].setUserInput(cr,APP.game.opponent[ao].getUserInput(ar)),eq.reset(0),plg.recordEntry(),sbp.markInsertedMissTurn(ao,ar),inserted_miss=!0):plg.restoreEntry();break;case"backspace":if(APP.game.is_handicapping)return eq.backspace(),void APP.message_bar.displayEquation(APP.equation.getUserInput(),{editing_flag:!1,show_hint:!0,show_miss:!1,hint_text:APP.header.score_options.hint_text});eq.backspace();break;case"delete":return APP.scoreboard_points.deleteCurrentTurn(),APP.scoreboard_points.deleteCurrentTurn(),gam.opponent[0].recalcScore(),gam.opponent[1].recalcScore(),sbp.activateTurn("turn_next"),hdr.refresh(),void(!APP.is_reloading&&APP.device.is_broadcasting&&APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),notable:""}));case"plus":if(!APP.is_reloading&&APP.device.is_broadcasting&&"+"==eq.getLastElement()){var intermediate_update=!0;APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html()})}else if(eq.addOperator("+"),!APP.is_reloading&&APP.device.is_broadcasting&&!APP.plugin_01.is_bot_turn)if(APP.user_options.remote_score_update)APP.plugin_01.plus_timer=setTimeout((function(){$("#kp-p-plus").addClass("kp-p-send-score").text("Update")}),1100);else{intermediate_update=!0;APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html()})}break;case"times":eq.addOperator("x");break;case"miss":return eq.addDigit(0,180),void plg.recordEntry();case"skip":return eq.addDigit(0,180),void plg.recordEntry("SKIP");case"enter":return APP.game.is_handicapping?void APP.plugin_01.finishHandicapping():void plg.recordEntry()}}for(ao=APP.game.active_opponent,ar=APP.game.active_round,entry=eq.value(),chkout=gam.opponent[ao].getStartingScore()+gam.opponent[ao].getHandicap(),chkout-=entry,i=0;i<=gam.current_round;i++)points=gam.opponent[ao].getTurnPoints(i),BBAT.isNumeric(points)&&i!=ar&&(chkout-=points);if("reverse_score"==btn_code&&enterMissTimeOK())return APP.equation.reset(chkout),chkout=entry,entry=eq.value(),void plg.recordEntry();inserted_miss?mbr.display('<span class="text-gold">MISS Inserted</span>'):mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0}),plg.is_edit_mode||(!APP.is_reloading&&APP.device.is_broadcasting&&intermediate_update&&(plg.broadcastSuggestedOut(chkout),intermediate_update=!1),(APP.user_options.suggested_out_standard||APP.user_options.suggested_out_numeric)&&(eq.hasUserInput()&&"+"!=eq.getLastElement()?0==eq.getPlusCount()&&plg.hideSuggestedOuts():plg.showSuggestedOuts(chkout))),hdr.refresh(),hdr.showPendingScore(ao,chkout,eq.hasUserInput()),sbp.displayTurnEntry(ao,ar,entry,plg.is_edit_mode?"":null),plg.setUserControls()}else APP.alert.show("You do not have the board.",null,!0,"Connection Notice!");else APP.handleAlleyOption("pcm-compete-host-chalk-button");else APP.alert.show("DartConnect has the board.",null,!0)}else APP.plugin_01.finishHandicapping(!0)},userInputCheck:function(){if(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)return!1;try{var thisOpponent=APP.game.current_opponent;APP.game.opponent_order[thisOpponent]&&!0;var turns=APP.game.opponent[thisOpponent].turn,currentTurn=turns[turns.length-1];if(0===!currentTurn.r3da)return!0;if(0===!currentTurn.r1da)return!0}catch(e){}return!1}},APP.plugin_cricket={bull_target_index:null,dartbot_timer:null,default_options:{},is_bot_turn:!1,is_edit_mode:!1,is_rebuild_mode:!1,miss_target_index:null,saved_entry:null,scoring_done_opponent:null,scoring_done_round:null,is_game_shot:!1,enterCoolDown:{disabled:!1,startCoolDown:function(){new Timer({name:"enterCoolDown",runTime:1,callback:function(){APP.plugin_cricket.enterCoolDown.disabled=!1},eachTick:function(){},debugMode:!1});APP.plugin_cricket.enterCoolDown.disabled=!0}},init:function(){APP.practicePopup.start(),APP.plugin_cricket.default_options.ascending_score=!0,APP.plugin_cricket.default_options.double_in=!1,APP.plugin_cricket.default_options.double_out=!1,APP.plugin_cricket.default_options.starting_score=0,APP.plugin_cricket.default_options.call=!1,APP.plugin_cricket.default_options.drop_10=!1,APP.plugin_cricket.default_options.no_bull=!1,APP.plugin_cricket.default_options.no_points=!1,APP.plugin_cricket.default_options.targets="2015",APP.plugin_cricket.default_options.variation="STANDARD",APP.device.addButtonHandler(["gsm-cricket-info","gsm-cricket-close","gsm-cricket-standard","gsm-cricket-straight","gsm-cricket-extended","gsm-cricket-no-bull","gsm-cricket-no-points","gsm-cricket-custom","gsm-cricket-mark-up","gsm-cricket-drop-10","gsm-cricket-call","gsm-cricket-continue","gsm-cricket-tactics-nl","gsm-cricket-tactics-10","gsm-cricket-tactics-11","gsm-cricket-tactics-12"],APP.plugin_cricket.handleSettingChange),APP.device.addFieldHandler(["pem-r0-input-0","pem-r0-input-1","pem-r1-input-0","pem-r1-input-1","pem-r2-input-0","pem-r2-input-1"],APP.plugin_cricket.handleEditMapRequest),APP.device.addButtonHandler(["pem-edit"],APP.plugin_cricket.handleEditMapRequest),APP.device.addButtonHandler(["hdr-co-button"],APP.plugin_cricket.handleHeaderOverlay),APP.device.addButtonHandler(["sb-cricket-scoring-option"],APP.plugin_cricket.handleScoringOption)},handlePostReloading:function(){APP.game.select_winning_dart&&APP.plugin_cricket.cancelSWD();var blockRebuild=!1;try{"IN-GAME"==APP.mode&&APP.game.isSomeoneScoring()&&(blockRebuild=!0)}catch(e){}APP.plugin_cricket.is_rebuilding_scoring=!0,blockRebuild||APP.plugin_cricket.rebuildScoring(),APP.plugin_cricket.is_rebuilding_scoring=!1,"PRE-GAME"!=APP.mode&&APP.game.plugin.setUserControls()},storeSettings:function(in_marksman_only){if(in_marksman_only){var settings=BBAT.fetchData("settings_cricket");settings||(settings={options:{ascending_score:APP.plugin_cricket.default_options.ascending_score,double_in:APP.plugin_cricket.default_options.double_in,double_out:APP.plugin_cricket.default_options.double_out,drop_10:APP.plugin_cricket.default_options.drop_10,no_bull:APP.plugin_cricket.default_options.no_bull,no_points:APP.plugin_cricket.default_options.no_points,targets:APP.plugin_cricket.default_options.targets,variation:APP.plugin_cricket.default_options.variation,call:APP.plugin_cricket.default_options.call,starting_score:APP.plugin_cricket.default_options.starting_score,marksman_scoring:APP.user_options.marksman},handicap_marks_0:APP.game.opponent[0].handicap_marks?APP.game.opponent[0].handicap_marks.slice(0):[],handicap_marks_1:APP.game.opponent[1].handicap_marks?APP.game.opponent[1].handicap_marks.slice(0):[]}),BBAT.storeData({settings_cricket:settings})}else BBAT.storeData({settings_cricket:{options:APP.game.options,handicap_marks_0:APP.game.opponent[0].handicap_marks?APP.game.opponent[0].handicap_marks.slice(0):[],handicap_marks_1:APP.game.opponent[1].handicap_marks?APP.game.opponent[1].handicap_marks.slice(0):[]}}),APP.storeState({settings_change:!0})},handleScoringOption:function(){if(!APP.is_reloading)if(APP.device.has_chalk){var ms=!APP.game.getOption("marksman_scoring");APP.game.setOptions({marksman_scoring:ms}),APP.plugin_cricket.storeSettings(),APP.storeState(),"SERVER"==APP.game_master?(APP.settings_version++,APP.server.setGameSettings({success:function(){APP.storeGameEvent({cmd:"SCORING_OPTION",cmd_data:{}},(function(){APP.reload()}))}})):APP.reload()}else APP.reload()},initGamePanel:function(){var settings;APP.device.addButtonHandler(["gsp-opponent-0","gsp-opponent-1","gsp-opponent-x","gsp-opponent-ag","gsp-opponent-as","gsp-opponent-m","gsp-opponent-s","gsp-new-set"],APP.plugin_cricket.handleGameOption),APP.game.getOpponentCount()||(APP.game.opponent_count=2,APP.game.opponent[0]=new APP.game.Opponent({starting_score:APP.plugin_cricket.default_options.starting_score,handicap:0}),APP.game.opponent[0].setTeam(APP.game.dflt_host_team),APP.game.opponent[1]=new APP.game.Opponent({starting_score:APP.plugin_cricket.default_options.starting_score,handicap:0}),APP.game.opponent[1].setTeam(APP.game.dflt_guest_team)),APP.game.resetOptions(),(settings=BBAT.fetchData("settings_cricket"))?APP.game.setOptions(settings.options):(APP.game.setOptions({ascending_score:APP.plugin_cricket.default_options.ascending_score,double_in:APP.plugin_cricket.default_options.double_in,double_out:APP.plugin_cricket.default_options.double_out,drop_10:APP.plugin_cricket.default_options.drop_10,no_bull:APP.plugin_cricket.default_options.no_bull,no_points:APP.plugin_cricket.default_options.no_points,targets:APP.plugin_cricket.default_options.targets,variation:APP.plugin_cricket.default_options.variation,call:APP.plugin_cricket.default_options.call,starting_score:APP.plugin_cricket.default_options.starting_score,marksman_scoring:APP.user_options.marksman}),APP.game.resetScores(APP.plugin_cricket.default_options.starting_score)),"TACTICS NL"==APP.game.getOption("variation")?APP.game.setOptions({dutch_tactics:!0}):APP.game.setOptions({dutch_tactics:!1}),"DROP 10"==APP.game.getOption("variation")?APP.game.setOptions({drop_10:!0}):APP.game.setOptions({drop_10:!1}),APP.header.resetScoreOptions(),APP.header.refresh(),APP.plugin_cricket.refreshGamePanel()},refreshGamePanel:function(e,e_info){var key,title,gam=APP.game;switch("TEAM"==APP.session.getMatchMode()&&!gam.opponent[0].team.is_default&&gam.opponent[0].team.players.length>0?$("#gsp-opponent-name-0").html(gam.opponent[0].getTeamPlayerNames()):($("#gsp-opponent-name-0").html(gam.opponent[0].getStartButtonName()),$("#gsp-opponent-players-0").html("").removeClass("text-gray")),"TEAM"==APP.session.getMatchMode()&&!gam.opponent[1].team.is_default&&gam.opponent[1].team.players.length>0?$("#gsp-opponent-name-1").html(gam.opponent[1].getTeamPlayerNames()):($("#gsp-opponent-name-1").html(gam.opponent[1].getStartButtonName()),$("#gsp-opponent-players-1").html("").removeClass("text-gray")),APP.session.isNewSet()&&($("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled")),APP.game.opponent_count){case 1:$("#gsp-opponent-1").addClass("button-disabled"),$("#gsp-opponent-x").addClass("button-disabled"),$("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled");break;case 2:$("#gsp-opponent-1").removeClass("button-disabled"),$("#gsp-opponent-x").removeClass("button-disabled"),APP.session.isNewSet()||($("#gsp-opponent-m").removeClass("button-disabled"),$("#gsp-opponent-ag").removeClass("button-disabled"))}for(key in title=APP.game.getGameName(),$("#gsp-settings-title").removeClass("gsp-settings-title-no-marksman").html(title),$("#gsp-settings").removeClass("text-gold"),APP.plugin_cricket.default_options)if("starting_score"==key){if(APP.game.opponent[0].getStartingScore()!=APP.plugin_cricket.default_options.starting_score||APP.game.opponent[1].getStartingScore()!=APP.plugin_cricket.default_options.starting_score)break}else if(APP.game.getOption(key)!=APP.plugin_cricket.default_options[key])break;APP.game.isBotPlaying()?(APP.device.disableButton("gsm-cricket-mark-up"),APP.device.disableButton("gsm-cricket-straight"),APP.device.disableButton("gsm-cricket-tactics-nl"),APP.device.disableButton("gsm-cricket-extended"),APP.device.disableButton("gsm-cricket-call"),APP.device.disableButton("gsm-cricket-no-bull")):(APP.device.enableButton("gsm-cricket-mark-up"),APP.device.enableButton("gsm-cricket-straight"),APP.device.enableButton("gsm-cricket-drop-10"),APP.device.enableButton("gsm-cricket-tactics-nl"),APP.device.enableButton("gsm-cricket-tactics-10"),APP.device.enableButton("gsm-cricket-tactics-11"),APP.device.enableButton("gsm-cricket-tactics-12"),APP.device.enableButton("gsm-cricket-extended"),APP.device.enableButton("gsm-cricket-call"),APP.device.enableButton("gsm-cricket-no-bull")),"TOURNAMENT"==APP.session.getMatchMode()&&(APP.blockFeatures(["gs-library","header-score"]),APP.blockUIControls())},handleGameOption:function(in_id){var i;switch(in_id){case"gsp-settings-title":APP.plugin_cricket.initGameSettings(),APP.popup.show("game-settings-menu-cricket");break;case"gsp-new-set":APP.session.isNewSet()?(APP.session.popSet(),APP.session.showGameSelector()):APP.session.addSet("CRICKET"),APP.reveal.setNewSetButton(),APP.reveal.updateSetStatus(),APP.game.plugin.refreshGamePanel();break;case"gsp-opponent-s":APP.game_selector.selectGame("gs-cork-calls"),APP.session.showBullShoot();break;case"gsp-opponent-0":APP.game.start(0);break;case"gsp-opponent-1":APP.game.start(1);break;case"gsp-opponent-x":i=new Date%APP.game.getOpponentCount(),APP.game.start(i);break;case"gsp-opponent-ag":i=0==APP.session.getPrevGameStartingOpponent()?1:0,APP.game.start(i);break;case"gsp-opponent-as":i=0==APP.session.getPrevSetStartingOpponent()?1:0,APP.game.start(i);break;case"gsp-opponent-m":i=0==APP.session.getPrevGameWinningOpponent()?1:0,APP.game.start(i)}},initGameSettings:function(){switch($("#game-settings-menu-cricket .menu-option-on").removeClass("menu-option-on"),APP.game.getOption("variation")){case"DROP 10":$("#gsm-cricket-drop-10").addClass("menu-option-on");break;case"TACTICS NL":$("#gsm-cricket-tactics-nl").addClass("menu-option-on");break;case"TACTICS 10":$("#gsm-cricket-tactics-10").addClass("menu-option-on");break;case"TACTICS 11":$("#gsm-cricket-tactics-11").addClass("menu-option-on");break;case"TACTICS 12":$("#gsm-cricket-tactics-12").addClass("menu-option-on");break;case"CUSTOM":$("#gsm-cricket-custom").addClass("menu-option-on");break;case"STANDARD":$("#gsm-cricket-standard").addClass("menu-option-on");break;case"NO POINTS":$("#gsm-cricket-no-points").addClass("menu-option-on");break;case"MARK UP":$("#gsm-cricket-mark-up").addClass("menu-option-on");break;case"STRAIGHT":$("#gsm-cricket-straight").addClass("menu-option-on");break;case"EXTENDED":$("#gsm-cricket-extended").addClass("menu-option-on")}APP.game.getOption("call")&&$("#gsm-cricket-call").addClass("menu-option-on"),APP.game.getOption("no_bull")&&$("#gsm-cricket-no-bull").addClass("menu-option-on")},handleSettingChange:function(in_id){switch(in_id){case"gsm-cricket-info":APP.info.show("info-text-cricket-settings","Cricket Settings");break;case"gsm-cricket-close":APP.popup.hide(),APP.plugin_cricket.refreshGamePanel();break;case"gsm-cricket-standard":case"gsm-cricket-drop-10":case"gsm-cricket-tactics-nl":case"gsm-cricket-tactics-10":case"gsm-cricket-tactics-11":case"gsm-cricket-tactics-12":case"gsm-cricket-custom":case"gsm-cricket-no-points":case"gsm-cricket-mark-up":case"gsm-cricket-straight":case"gsm-cricket-extended":$(".gsm-cricket-variation-group").removeClass("menu-option-on"),$("#"+in_id).addClass("menu-option-on");break;case"gsm-cricket-call":case"gsm-cricket-no-bull":$("#"+in_id).toggleClass("menu-option-on");break;case"gsm-cricket-continue":$("#game-selector").hide(),APP.game.setOptions(APP.plugin_cricket.default_options),APP.game.setOptions({dutch_tactics:!1}),$("#game-settings-menu-cricket .menu-option-on").each((function(i){switch(this.id){case"gsm-cricket-standard":APP.game.setOptions({variation:"STANDARD"});break;case"gsm-cricket-custom":APP.game.setOptions({variation:"CUSTOM"});break;case"gsm-cricket-straight":APP.game.setOptions({variation:"STRAIGHT",targets:"2015",no_points:!0});break;case"gsm-cricket-extended":APP.game.setOptions({variation:"EXTENDED",targets:"2011",no_points:!0});break;case"gsm-cricket-drop-10":APP.game.setOptions({variation:"DROP 10",drop_10:!0});break;case"gsm-cricket-tactics-nl":APP.game.setOptions({variation:"TACTICS NL",dutch_tactics:!0});break;case"gsm-cricket-tactics-10":APP.game.setOptions({variation:"TACTICS 10"});break;case"gsm-cricket-tactics-11":APP.game.setOptions({variation:"TACTICS 11"});break;case"gsm-cricket-tactics-12":APP.game.setOptions({variation:"TACTICS 12"});break;case"gsm-cricket-no-points":APP.game.setOptions({variation:"NO POINTS",no_points:!0});break;case"gsm-cricket-mark-up":APP.game.setOptions({variation:"MARK UP",no_points:!0});break;case"gsm-cricket-call":APP.game.setOptions({call:!0});break;case"gsm-cricket-no-bull":APP.game.setOptions({no_bull:!0})}})),APP.plugin_cricket.storeSettings(),APP.popup.hide(),APP.plugin_cricket.refreshGamePanel(),APP.header.refresh(),APP.session.other_game&&BBAT.storeData({other_game:{type:"Cricket",label:APP.game.getGameName(!0),drop_10:APP.game.getOption("drop_10"),dutch_tactics:APP.game.getOption("dutch_tactics"),no_bull:APP.game.getOption("no_bull"),no_points:APP.game.getOption("no_points"),targets:APP.game.getOption("targets"),variation:APP.game.getOption("variation"),call:APP.game.getOption("call"),ascending_score:!0,custom:!0}}),window.setTimeout((function(){APP.game_selector.refreshGamePanel(),$("#game-selector").show()}),100)}},handlePostStart:function(){var i,lbl,val,offset,sb_id;switch(APP.device.setKeyboardHandler(APP.plugin_cricket.handleUserInput),APP.device.addButtonHandler(["swdm-close","swdm-dart-1","swdm-dart-2","swdm-dart-3"],APP.plugin_cricket.handleSWDOption),offset=APP.game.getOption("drop_10")?-10:0,APP.plugin_cricket.miss_target_index=0,APP.game.getOption("variation")){case"STRAIGHT":APP.plugin_cricket.bull_target_index=7;break;case"EXTENDED":APP.plugin_cricket.bull_target_index=11;break;case"TACTICS 10":case"TACTICS NL":APP.plugin_cricket.bull_target_index=12,"test"==APP.location||APP.location,$("#scoreboard-center").addClass("tactics");var fontFlow=Math.round($("#scoreboard").height()/12/5);$("#scoreboard-center.tactics").css("font-size",fontFlow+"px"),"TACTICS NL"==APP.game.getOption("variation")&&BBAT.storeData({prev_game_tactics:!0});break;case"TACTICS 11":APP.plugin_cricket.bull_target_index=11,$("#scoreboard-center").addClass("tactics");fontFlow=Math.round($("#scoreboard").height()/11/5);$("#scoreboard-center.tactics").css("font-size",fontFlow+"px");break;case"TACTICS 12":APP.plugin_cricket.bull_target_index=10,$("#scoreboard-center").addClass("tactics");fontFlow=Math.round($("#scoreboard").height()/10/5);$("#scoreboard-center.tactics").css("font-size",fontFlow+"px");break;default:APP.plugin_cricket.bull_target_index=7,$("#scoreboard-center").removeClass("tactics")}for(APP.game.addTarget({label:"&#8709;",value:0}),i=1;i<APP.plugin_cricket.bull_target_index;i++)lbl=""+(val=21-i+offset),APP.game.getOption("marksman_scoring")?(sb_id="sb-c-b"+i+"S",APP.scoreboard_cricket.addNewRow(i,lbl,"S",sb_id,"T","T",sb_id)):APP.scoreboard_cricket.addNewRow(i,lbl),APP.game.addTarget({label:lbl,value:APP.game.getOption("no_points")?0:val});if(APP.game.getOption("marksman_scoring"))for(i=0;i<APP.plugin_cricket.bull_target_index;i++)targetId=i+1,APP.device.addButtonHandler(["sb-c-b"+targetId+"S","sb-c-b"+targetId+"D","sb-c-b"+targetId+"T"],APP.plugin_cricket.handleUserInput);else for(i=0;i<APP.plugin_cricket.bull_target_index;i++){var targetId=i+1;APP.device.addButtonHandler(["sb-c-b"+targetId],APP.plugin_cricket.handleUserInput)}APP.device.addButtonHandler(["bb-me-clear","bb-me-done","bb-me-restore","mb-ig-funcl","mb-ig-funcr","mb-ig-control"],APP.plugin_cricket.handleUserInput),APP.device.addButtonHandler(["bb-pg-clear","bb-pg-cancel"],APP.plugin_cricket.handleUserInput),APP.game.getOption("marksman_scoring")?(sb_id="sb-c-b"+APP.plugin_cricket.bull_target_index+"S",APP.scoreboard_cricket.addNewRow(APP.plugin_cricket.bull_target_index,"B","S",sb_id,"","M",null),APP.game.getOption("no_bull")?(APP.scoreboard_cricket.disableTarget(APP.plugin_cricket.bull_target_index+"S"),APP.scoreboard_cricket.disableTarget(APP.plugin_cricket.bull_target_index+"D")):(APP.game.addTarget({label:"B",value:APP.game.getOption("no_points")?0:25+offset}),APP.device.addButtonHandler(["sb-c-b"+APP.plugin_cricket.bull_target_index+"S","sb-c-b"+APP.plugin_cricket.bull_target_index+"D"],APP.plugin_cricket.handleUserInput))):(APP.scoreboard_cricket.addNewRow(APP.plugin_cricket.bull_target_index,"B"),APP.game.getOption("no_bull")?APP.scoreboard_cricket.disableTarget(APP.plugin_cricket.bull_target_index):(APP.game.addTarget({label:"B",value:APP.game.getOption("no_points")?0:25+offset}),APP.device.addButtonHandler(["sb-c-b"+APP.plugin_cricket.bull_target_index],APP.plugin_cricket.handleUserInput))),APP.game.getOption("marksman_scoring")||APP.scoreboard_cricket.removeTargetModifiers(),APP.scoreboard.enableScrolling(),APP.scoreboard_cricket.show(),$("#scoreboard").scrollTop(0),APP.game.addNewRound(),APP.header.resetScoreOptions(),APP.game.resetScores(0),APP.plugin_cricket.processHandicapMarks(),APP.game.opponent[0].recalcScore(),APP.game.opponent[1].recalcScore(),APP.plugin_cricket.setUserControls(),APP.header.refresh(),APP.scoreboard_cricket.enableGameSettings(),APP.device.has_chalk&&("HOST"==APP.device.role&&1==APP.game.current_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.current_opponent)&&APP.device.releaseChalk(),APP.plugin_cricket.displayOpponentIndicator(),APP.game.opponent[APP.game.current_opponent].isBotTurn(APP.game.active_round)&&(APP.plugin_cricket.is_bot_turn=!0,APP.device.disableButton("reveal-settings"),APP.plugin_cricket.takeDartBotTurn()),APP.is_reloading||APP.tacticsResize.toggle()},takeDartBotTurn:function(){var skill,oppo;APP.plugin_cricket.is_rebuild_mode||APP.is_reloading||APP.plugin_cricket.is_edit_mode||!APP.device.has_chalk||($("#popup-bot-xray").html("&nbsp;"),oppo=APP.game.opponent[APP.game.current_opponent],skill=APP.dartbot.skills_cricket[oppo.team.players[0].bot_skill],APP.plugin_cricket.throwDartBotDarts(skill,3))},throwDartBotDarts:function(in_skill,in_darts_left){var gam,oppo;function processDart(in_index,in_modifier){var mult;if(APP.game.getOption("marksman_scoring"))APP.plugin_cricket.handleUserInput("bot-b"+in_index+in_modifier);else for(mult=APP.game.getModifierValue(in_modifier);mult>0;)APP.plugin_cricket.handleUserInput("bot-b"+in_index),mult--;"D"==in_modifier&&(oppo.has_doubled_in=!0)}gam=APP.game,oppo=gam.opponent[gam.active_opponent],window.setTimeout((function(){var target_request,target_actual,str,need_double_in,modifier,index;if(APP.dartbot.hasEnoughToWinCricket())window.setTimeout((function(){console.log("early win"),APP.plugin_cricket.handleUserInput("bot-enter"),APP.popup.hide("popup-bot-xray")}),1e3);else{need_double_in=gam.getOption("double_in")&&!oppo.has_doubled_in,target_request=APP.dartbot.selectTargetCricket(in_darts_left,need_double_in),target_actual=APP.dartbot.attemptThrow(target_request,in_skill);var dartbot_darts=BBAT.fetchData("dartbot_darts")||"";switch(dartbot_darts+="~"+in_skill.stdev+","+in_skill.mean+","+target_request.toString()+","+target_actual.toString(),BBAT.storeData({dartbot_darts:dartbot_darts}),$("#popup-bot-xray").html($("#popup-bot-xray").html()+target_request.toString()+":"+target_actual.toString()+"&nbsp;/&nbsp;"),str=target_actual.toString()){case"OOB":processDart(0,"S");break;case"SB":processDart(need_double_in?0:APP.plugin_cricket.bull_target_index,"S");break;case"DB":processDart(APP.plugin_cricket.bull_target_index,"D");break;default:null!=(index=APP.game.getTargetIndex(0+str.slice(1)))?(modifier=str.slice(0,1),need_double_in&&"D"!=modifier?processDart(0,"S"):processDart(index,modifier)):processDart(0,"S")}1==in_darts_left||APP.dartbot.hasEnoughToWinCricket()?window.setTimeout((function(){APP.plugin_cricket.handleUserInput("bot-enter"),APP.popup.hide("popup-bot-xray")}),1e3):APP.plugin_cricket.throwDartBotDarts(in_skill,--in_darts_left)}}),500)},handleSWDOption:function(in_id){switch(in_id){case"swdm-close":APP.plugin_cricket.cancelSWD();break;case"swdm-dart-1":APP.game.finish(1);break;case"swdm-dart-2":APP.game.finish(2);break;case"swdm-dart-3":APP.game.finish(3)}},isPrevGameTactics:function(){if("PRE-GAME"==APP.mode&&BBAT.fetchData("prev_game_tactics"))return!0},cancelEOG:function(in_cancel_gsw,in_next_obj){APP.storeGameEvent({cmd:"CANCEL_EOG",cmd_data:{cancel_gsw:in_cancel_gsw}},(function(){if(APP.plugin_cricket.is_game_shot=!1,in_cancel_gsw){APP.game.opponent[APP.game.active_opponent].clearTurnMarks(APP.game.active_round),APP.game.opponent[APP.game.active_opponent].clearTurnPoints(APP.game.active_round),APP.message_bar.displayTargetHits(APP.game.opponent[APP.game.active_opponent].getUserInput(APP.game.active_round));for(var j=1;j<APP.game.getTargetCount();j++)APP.plugin_cricket.updateTargetMarks(APP.game.active_opponent,j);APP.plugin_cricket.rebuildScoring()}else APP.game.resetEOG(),APP.scoreboard_cricket.resetEOG(),APP.reveal.hideButtonBar((function(){APP.reveal.clearAllPanels((function(){APP.reveal.resetEOGStatsPanel()}))})),APP.is_reloading?(APP.message_bar.show("message-bar-ingame"),APP.header.refresh(),APP.reveal.hideButtonBar(null,!0),APP.scoreboard.unshield(),"IN-GAME"==APP.mode&&APP.device.has_chalk&&null==in_next_obj&&(APP.device.is_hosting&&1==APP.game.active_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.active_opponent)&&APP.alert.show("You are now scoring "+APP.game.opponent[APP.game.active_opponent].getChalkboardName()+"'s turn.<p>To edit prior turns, use the [BACK] button.")):APP.reload()}))},startSWD:function(in_winning_opponent,in_live_choice){var oppo;if(in_live_choice&&APP.storeGameEvent({cmd:"START_SWD",cmd_data:{winning_opponent:in_winning_opponent}}),APP.game.opponent[0].isPlayerOrderPending()&&APP.header.hidePlayerOrderMenu(0),APP.game.opponent[1].isPlayerOrderPending()&&APP.header.hidePlayerOrderMenu(1),APP.game.opponent[0].player_order.length!=APP.game.opponent[0].team.players.length||(APP.game.opponent[1].player_order.length,APP.game.opponent[1].team.players.length),APP.game.winning_opponent=in_winning_opponent,APP.game.select_winning_dart=!0,APP.scoreboard_cricket.clearAfterTurnMarks(APP.game.active_opponent),APP.scoreboard.shield(),APP.message_bar.disableFuncs(),APP.game.opponent[APP.game.active_opponent].isBotTurn(APP.game.active_round))APP.game.finish(3);else{if(APP.device.enableButtonClass("swdm-dart"),APP.game.getOption("marksman_scoring"))switch((oppo=APP.game.opponent[APP.game.winning_opponent]).turn[oppo.turn.length-1].user_input.length){case 2:APP.device.disableButton("swdm-dart-1");break;case 3:APP.device.disableButton("swdm-dart-1"),APP.device.disableButton("swdm-dart-2")}APP.reveal.hideButtonBar((function(){APP.device.has_chalk&&(APP.tacticsResize.toggle(!0),APP.reveal.showPanel("swd-menu-panel",(function(){APP.tacticsResize.forceOff=!0,APP.message_bar.setLeftFunc("back"),APP.message_bar.setRightFunc("bust"),APP.device.disableButton("mb-ig-funcr")}),!0))}))}},cancelSWD:function(){var i,ao,ar,ui,t_cnt=APP.game.getTargetCount();for(ao=APP.game.active_opponent,ar=APP.game.active_round,APP.game.select_winning_dart=!1,APP.game.winning_opponent=null,APP.device.has_chalk&&APP.message_bar.enableFuncs(),APP.scoreboard.unshield(),APP.reveal.hideButtonBar((function(){APP.reveal.hidePanel()})),APP.game.opponent[ao].clearTurnMarks(ar),APP.game.opponent[ao].clearTurnPoints(ar),i=1;i<t_cnt;i++)APP.plugin_cricket.updateTargetMarks(ao,i);ui=APP.game.opponent[ao].getUserInput(ar),APP.message_bar.displayTargetHits(ui),APP.header.refresh(),APP.game.getOption("no_points")?APP.header.showPendingScore(ao,APP.game.opponent[ao].getGameTotalMarksScored()+APP.game.opponent[ao].getTurnTotalMarksScored(ar)):APP.header.showPendingScore(ao,APP.game.opponent[ao].getPendingTargetPoints(ar)),APP.plugin_cricket.setUserControls(),APP.tacticsResize.forceOff=!1},handlePreFinish:function(in_next_cmd_obj){var i,j,opnt,counts,target_index,t_cnt=APP.game.getTargetCount(),o_cnt=APP.game.getOpponentCount(),marksman=APP.game.getOption("marksman_scoring");if(APP.header.displayPendingPoints(0,""),APP.header.displayPendingPoints(1,""),APP.game.setOptions({stats_type:"MARKS"}),APP.game.getOption("marksman_scoring")&&in_next_cmd_obj)APP.scoreboard.unshield();else{for(APP.scoreboard_cricket.removeTargetModifiers(),APP.scoreboard_cricket.removeTargetButtons(),i=0;i<o_cnt;i++)for(opnt=APP.game.opponent[i],j=1;j<t_cnt;j++)APP.scoreboard_cricket.displayPoints(i,j,opnt.getGameTargetPointsScored(j),!0),APP.scoreboard_cricket.displayTapCount(i,j,opnt.getGameTargetMarksScored(j,marksman),!0);if(counts=BBAT.getUniqueFrequencies(APP.game.opponent[APP.game.winning_opponent].getUserInput(APP.game.active_round)),BBAT.objectHasProperties(counts))for(target_index in counts)APP.scoreboard_cricket.markWinningMark(APP.game.winning_opponent,parseInt(target_index,10));APP.game.options.no_bull&&APP.scoreboard_cricket.grayOutTargetLabel(APP.plugin_cricket.bull_target_index+(marksman?"S":"")),APP.scoreboard.unshield()}},setTargetControls:function(){var i,j,variation,enable_count,ao=APP.game.active_opponent,ar=APP.game.active_round,t_cnt=APP.game.getTargetCount(),ui=APP.game.opponent[ao].getUserInput(ar);if("STRAIGHT"==(variation=APP.game.getOption("variation"))||"EXTENDED"==variation||"MARK UP"==variation){if(APP.scoreboard_cricket.disableAllTargets(),ui.length&&"0"!=ui[0])i=parseInt(ui[0],10);else for(i=1;i<t_cnt&&(APP.game.opponent[ao].isTargetClosed(ar,i)||!APP.plugin_cricket.isValidTargetMark(i,ui));i++);for(enable_count="MARK UP"==variation?1:3,j=i;j<i+enable_count&&j<t_cnt;j++)APP.game.getOption("marksman_scoring")?(APP.scoreboard_cricket.enableTarget(j+"S"),APP.scoreboard_cricket.enableTarget(j+"D"),APP.scoreboard_cricket.enableTarget(j+"T"),APP.scoreboard_cricket.scrollToTarget(j+"S")):(APP.scoreboard_cricket.enableTarget(j),APP.scoreboard_cricket.scrollToTarget(j));APP.game.getOption("marksman_scoring")?APP.scoreboard_cricket.scrollToTarget(i+"S"):APP.scoreboard_cricket.scrollToTarget(i)}},processHandicapMarks:function(){for(var sc=BBAT.fetchData("settings_cricket")||{},o_len=APP.game.getOpponentCount(),t_cnt=APP.game.getTargetCount(),i=0;i<o_len;i++){var oppo=APP.game.opponent[i];oppo.handicap=0;for(var hm=0===i?sc.handicap_marks_0||[]:sc.handicap_marks_1||[],j=0;j<t_cnt;j++)oppo.handicap_marks[j]=hm[j]||0,oppo.handicap_marks[j]>=3&&(oppo.setTargetClosingFromMark(j,3),oppo.handicap+=(oppo.handicap_marks[j]-3)*APP.game.target[j].value),APP.plugin_cricket.updateTargetMarks(i,j)}},handleRemoteHandicap:function(in_cmd_data){APP.game.resetScores(0),APP.game.opponent[0].handicap_marks=in_cmd_data.handicap_marks_0.slice(0),APP.game.opponent[1].handicap_marks=in_cmd_data.handicap_marks_1.slice(0),APP.plugin_cricket.storeSettings(),APP.plugin_cricket.processHandicapMarks(),APP.game.opponent[0].recalcScore(),APP.game.opponent[1].recalcScore(),APP.header.refresh(),APP.popup.show("popup-notable","Game On!")},startHandicapping:function(in_oppo_index){if("SERVER"==APP.game_master&&!APP.device.has_chalk)return APP.popup.hide("popup-notable"),APP.popup.show("popup-notify",'<span style="font-size:0.6em;">Only the active player can set or change a handicap</span>',8e3),!1;APP.game.handicap_opponent=in_oppo_index,APP.popup.hide("popup-notable"),APP.popup.show("popup-notify",'<span style="font-size:0.6em;">Select marks, then click/tap [Enter] to start playing.</span>',8e3),APP.plugin_cricket.resetHandicapping(),$("#bb-pg-cancel").html("Cancel Handicapping"),APP.reveal.showButtonBar("button-bar-pregame"),APP.device.disableButton("mb-ig-funcr"),APP.device.disableButton("sb-cricket-scoring-option"),APP.header.disableEditing(),APP.header.showPendingScore(in_oppo_index,0,!0),APP.game.active_opponent=in_oppo_index,APP.game.is_handicapping=!0},resetHandicapping:function(){var i,len;for(len=APP.game.getTargetCount(),APP.game.opponent[0].turn[0].reset(len),APP.game.opponent[1].turn[0].reset(len),APP.scoreboard_cricket.clearPoints(0),APP.scoreboard_cricket.clearPoints(1),i=0;i<len;i++)APP.game.opponent[0].handicap=0,APP.game.opponent[1].handicap=0,APP.game.opponent[0].closing_mark[i]=0==i?3:null,APP.game.opponent[1].closing_mark[i]=0==i?3:null,APP.game.opponent[0].handicap_marks[i]=0,APP.game.opponent[1].handicap_marks[i]=0,APP.scoreboard_cricket.clearMarks(0,i),APP.scoreboard_cricket.clearMarks(1,i);APP.game.opponent[0].recalcScore(),APP.game.opponent[1].recalcScore(),APP.plugin_cricket.storeSettings(),APP.header.showPendingScore(APP.game.handicap_opponent,0,!0),$(".header-points").html(""),APP.message_bar.clear()},finishHandicapping:function(){APP.reveal.hideButtonBar(),$("#bb-pg-cancel").html("Cancel Score Edit"),APP.device.enableButton("mb-ig-funcr"),APP.device.enableButton("sb-cricket-scoring-option",!0),APP.game.handicap_opponent=null,APP.game.is_handicapping=!1,APP.game.active_opponent=APP.game.opponent_order[0],APP.header.refresh(),APP.plugin_cricket.displayOpponentIndicator(),APP.plugin_cricket.setUserControls(),APP.popup.show("popup-notable","Game On!")},editScore:function(in_oppo_index){APP.game.started&&!APP.game.started_scoring&&APP.plugin_cricket.startHandicapping(in_oppo_index)},setUserControls:function(){var editing_entry,ao=APP.game.active_opponent,ar=APP.game.active_round,eq=APP.equation,first_turn=APP.game.isFirstTurnActive();APP.plugin_cricket.is_rebuild_mode||(APP.header.disableHandicapping(),APP.device.disableFieldClass("header-score"),APP.device.has_chalk&&(!APP.game.started||APP.game.started_scoring||APP.game.isSomeoneScoring()||APP.header.enableHandicapping()),APP.plugin_cricket.setTargetControls(),APP.plugin_cricket.is_edit_mode?(editing_entry=!APP.game.opponent[ao].getUserInput(ar).isEquivalent(APP.plugin_cricket.saved_entry),$("#bb-me-restore").html("Restore"),APP.device.disableButton("hdr-co-button"),editing_entry?APP.device.enableButton("bb-me-restore"):(APP.device.disableButton("bb-me-restore"),APP.device.enableButton("hdr-co-button"),1==APP.game.getTurnsFromCurrent()&&($("#bb-me-restore").html("Insert MISS (&#8709;)"),APP.device.enableButton("bb-me-restore"))),APP.reveal.showButtonBar("button-bar-map-edit"),APP.game.opponent[ao].hasUserInput(ar)?(APP.message_bar.setLeftFunc("backspace"),APP.message_bar.setRightFunc("enter",APP.device.has_chalk)):(1!=APP.game.getTurnsFromCurrent()||APP.game.isFirstTurnActive()?APP.game.hasAnyoneScored()?APP.message_bar.setLeftFunc("backspace",!APP.device.has_chalk):APP.message_bar.setLeftFunc("back",APP.device.has_chalk):APP.message_bar.setLeftFunc("delete"),APP.message_bar.setRightFunc("miss"))):(APP.device.enableButton("hdr-co-button"),APP.game.select_winning_dart||APP.game.is_handicapping||APP.game.finished||APP.reveal.hideButtonBar(),APP.game.opponent[ao].hasUserInput(ar)?(APP.message_bar.setLeftFunc("backspace"),APP.message_bar.setRightFunc("enter")):(1==APP.game.opponent_count?APP.message_bar.setLeftFunc("back",first_turn&&!APP.game.started_scoring):APP.message_bar.setLeftFunc("back",!(first_turn&&APP.game.started_scoring)),APP.message_bar.setRightFunc("miss"))),APP.device.has_chalk||eq.hasUserInput()||APP.server.chalk_release_timer_id?($("#mb-ig-control").css("display","none"),$("#mb-ig-message").css("display","inline-block")):($("#mb-ig-control").css("display","inline-block"),$("#mb-ig-message").css("display","none")),0==APP.game.current_round&&(APP.header.enablePlayerOrderProcessing(0,!0),APP.header.enablePlayerOrderProcessing(1,!0)))},calculateOpponentDeficit:function(){try{var i,bv,cs0,cs1,o_cnt,down_to_bulls;function bullsNeeded(in_points_offset,in_bull_count,in_bull_value){var bc=Math.min(3,in_bull_count),bv=in_bull_value,po=in_points_offset;return po>=0?3-bc:3-bc+Math.ceil(-po/bv)}if(APP.game.getOption("no_bull"))down_to_bulls=!1;else for(down_to_bulls=!0,o_cnt=APP.game.getOpponentCount(),i=0;i<o_cnt;i++)if(!APP.game.opponent[i].areAllTargetsClosed(APP.plugin_cricket.bull_target_index)){down_to_bulls=!1;break}return cs0=APP.game.opponent[0].getCurrentScore(),cs1=APP.game.opponent[1].getCurrentScore(),down_to_bulls?(bv=APP.game.getTargetValue(APP.plugin_cricket.bull_target_index),[bullsNeeded(cs0-cs1,APP.game.opponent[0].getGameTargetMarksScored(APP.plugin_cricket.bull_target_index,!0),bv),bullsNeeded(cs1-cs0,APP.game.opponent[1].getGameTargetMarksScored(APP.plugin_cricket.bull_target_index,!0),bv)]):[cs0-cs1,cs1-cs0]}catch(e){}return!1},displayOpponentIndicator:function(){APP.game.active_round;var i,bv,cs0,cs1,bn0,bn1,o_cnt,down_to_bulls,ao=APP.game.active_opponent,show_cues=APP.user_options.cricket_cues;function formatPointsDisplay(in_opponent,in_offset){var pnts;return pnts=0==in_offset?"&nbsp;":in_offset>0?"+"+in_offset:""+in_offset,0==in_opponent?'<div class="mb-ig-message-indicator-left">'+pnts+"</div>":'<div class="mb-ig-message-indicator-right">'+pnts+"</div>"}function bullsNeeded(in_points_offset,in_bull_count,in_bull_value){var bc=Math.min(3,in_bull_count),bv=in_bull_value,po=in_points_offset;return po>=0?3-bc:3-bc+Math.ceil(-po/bv)}if(APP.header.refresh(),show_cues){if(APP.game.getOption("no_bull"))down_to_bulls=!1;else for(down_to_bulls=!0,o_cnt=APP.game.getOpponentCount(),i=0;i<o_cnt;i++)if(!APP.game.opponent[i].areAllTargetsClosed(APP.plugin_cricket.bull_target_index)){down_to_bulls=!1;break}cs0=APP.game.opponent[0].getCurrentScore(),cs1=APP.game.opponent[1].getCurrentScore(),down_to_bulls?(bv=APP.game.getTargetValue(APP.plugin_cricket.bull_target_index),bn0=bullsNeeded(cs0-cs1,APP.game.opponent[0].getGameTargetMarksScored(APP.plugin_cricket.bull_target_index,!0),bv),bn1=bullsNeeded(cs1-cs0,APP.game.opponent[1].getGameTargetMarksScored(APP.plugin_cricket.bull_target_index,!0),bv),APP.message_bar.display((0==ao?'<div class="mb-ig-message-indicator-left">':'<div class="mb-ig-message-indicator-right">')+'<span class="mb-ig-message-addin-left">'+bn0+'B</span>&nbsp;<span class="mb-ig-message-addin-right">'+bn1+"B</span></div>")):0==ao?APP.message_bar.display(formatPointsDisplay(ao,cs0-cs1)):APP.message_bar.display(formatPointsDisplay(ao,cs1-cs0))}else 0==ao?APP.message_bar.display('<div class="mb-ig-message-indicator-left">&nbsp;</div>'):APP.message_bar.display('<div class="mb-ig-message-indicator-right">&nbsp;</div>')},updateTargetMarks:function(in_opponent,in_target_index){var hc_marks,old_marks,new_marks,ttl_marks,oppo,i=in_target_index,ar=APP.game.active_round;"0"!=in_target_index&&(ttl_marks=(old_marks=(hc_marks=(oppo=APP.game.opponent[in_opponent]).getTargetHandicapMark(i))+oppo.getPriorTargetMarks(ar,i))+(new_marks=oppo.getTargetMarks(ar,i)),APP.header.displayPendingPoints(in_opponent,oppo.getTurnTotalPointsScored(ar,i)),APP.scoreboard_cricket.displayTapCount(in_opponent,i,new_marks),APP.game.is_handicapping?ttl_marks>=3?APP.scoreboard_cricket.displayMarks(in_opponent,i,3,3,"close"):(APP.scoreboard_cricket.displayMarks(in_opponent,i,ttl_marks,ttl_marks,ttl_marks),oppo.clearTargetClosingFromMark(i)):old_marks>=3?APP.scoreboard_cricket.displayMarks(in_opponent,i,hc_marks,oppo.getTargetClosingFromMark(i),"close"):(APP.scoreboard_cricket.displayMarks(in_opponent,i,hc_marks,old_marks,ttl_marks),oppo.clearTargetClosingFromMark(i)))},isValidTargetMark:function(in_target_index,in_user_input){var total_targets,target_index,bull_marks,min_marks,max_marks,counts,marks,variation,ar=APP.game.active_round,ao=APP.game.active_opponent,ui=in_user_input.slice(0);if(APP.game.is_handicapping)return!0;if(ui.push(in_target_index),counts=BBAT.getUniqueFrequencies(ui),"STRAIGHT"==(variation=APP.game.getOption("variation"))||"EXTENDED"==variation||"MARK UP"==variation){if(in_target_index>1&&!APP.game.opponent[ao].isTargetClosed(ar,in_target_index-1))return!1;for(target_index in counts)if(counts[target_index]>("MARK UP"==variation?9:3))return!1}if(APP.game.getOption("marksman_scoring"))return!APP.game.isTargetClosedOut(ar,in_target_index)&&(in_user_input.length<3||!(APP.is_reloading||!APP.device.has_chalk)&&(APP.alert.show('You have already recorded 3 Darts.<br>&nbsp;<br>Use the "D" or "T" buttons to record Double and Triple Shots.<br>&nbsp;<br>Use the "UNDO" button to correct this turn.'),!1));for(target_index in min_marks=9,max_marks=0,bull_marks=0,total_targets=0,counts)total_targets+=1,marks=counts[target_index],"B"==APP.game.target[parseInt(target_index,10)].label&&(bull_marks=marks),marks<min_marks&&(min_marks=marks),marks>max_marks&&(max_marks=marks);if(total_targets>3)return!1;switch(total_targets){case 1:if(max_marks>9)return!1;if(bull_marks>6)return!1;break;case 2:if(max_marks>6)return!1;if(bull_marks>4)return!1;if(max_marks>3&&min_marks>3)return!1;break;case 3:if(max_marks>3)return!1;if(bull_marks>2)return!1}return!0},showHeaderButton:function(in_mode){$("#hdr-co-button");switch(in_mode){case"EDIT":$("#hdr-co-button").addClass("button-gold").removeClass("button-green").html("Edit<br />Other<br />Turns");break;case"GAME":$("#hdr-co-button").removeClass("button-gold").addClass("button-green").html("Back<br />to<br />Game")}$("#hdr-center-overlay").show(0)},hideHeaderButton:function(){$("#hdr-center-overlay").hide(0)},hideEditMap:function(){APP.popup.hide("popup-edit-map")},showEditMap:function(){var i,j,ui,pts,so;$(".pem-active").removeClass("pem-active"),$("#pem-disclaimer").hide(0),$("#pem-edit-active").hide(0),APP.plugin_cricket.showHeaderButton("GAME"),$(".pem-input-data").removeClass("pem-input-data"),APP.device.disableFieldClass("pem-input"),j=APP.game.current_round>2?APP.game.current_round-2:0,so=APP.game.opponent_order[0],$(".pem-pts-"+so).addClass("pem-points-first"),$(".pem-name-"+so).addClass("pem-name-first"),$(".pem-pts-"+(0==so?"1":"0")).addClass("pem-points-second"),$(".pem-name-"+(0==so?"1":"0")).addClass("pem-name-second");var oppo=APP.game.opponent[APP.game.active_opponent],pi=APP.game.active_round%oppo.team.getPlayerCount();$("#pem-name-"+APP.game.active_opponent).html(oppo.getChalkboardName(pi));APP.game.opponent[0==APP.game.active_opponent?1:0];for(i=0;i<3;i++){if(j<=APP.game.current_round){if(ui=APP.game.opponent[0].getUserInput(j),pts=APP.game.opponent[0].getTurnTotalPointsScored(j),$("#pem-r"+i+"-points-0").html(pts?pts+"<br />pts":"&nbsp;"),$("#pem-r"+i+"-input-0").attr("data-round",j).html(APP.message_bar.formatTargetHits(ui,!1)),ui.length){pi=j%(oppo=APP.game.opponent[0]).team.getPlayerCount();$("#pem-r"+i+"-name-0").html(oppo.getFullName(pi)),APP.device.enableFieldID("pem-r"+i+"-input-0"),$("#pem-r"+i+"-input-0").addClass("pem-input-data")}if(ui=APP.game.opponent[1].getUserInput(j),pts=APP.game.opponent[1].getTurnTotalPointsScored(j),$("#pem-r"+i+"-points-1").html(pts?pts+"<br />pts":"&nbsp;"),$("#pem-r"+i+"-input-1").attr("data-round",j).html(APP.message_bar.formatTargetHits(ui,!1)),ui.length){pi=j%(oppo=APP.game.opponent[1]).team.getPlayerCount();$("#pem-r"+i+"-name-1").html(oppo.getFullName(pi)),APP.device.enableFieldID("pem-r"+i+"-input-1"),$("#pem-r"+i+"-input-1").addClass("pem-input-data")}}j++}APP.popup.show("popup-edit-map")},handleHeaderOverlay:function(in_id){$("#hdr-co-button").text().indexOf("Edit")>=0?(APP.game.deep_editing=!0,APP.plugin_cricket.handleUserInput("bb-me-done"),APP.device.has_chalk&&APP.plugin_cricket.showEditMap()):(APP.game.deep_editing=!1,APP.plugin_cricket.handleUserInput("bb-me-done"))},handleEditMapRequest:function(in_id){switch(in_id){case"pem-edit":APP.plugin_cricket.hideEditMap(),APP.plugin_cricket.gotoTurn($(".pem-active")[0].id);break;default:$("#"+in_id).hasClass("pem-active")?($(".pem-active").removeClass("pem-active"),$("#pem-edit-active").hide(0)):($(".pem-active").removeClass("pem-active"),$("#"+in_id).addClass("pem-active"),$("#pem-disclaimer").hide(0),$("#pem-edit-active").show(0))}},startEditMode:function(){var ar=APP.game.active_round,ao=APP.game.active_opponent;APP.plugin_cricket.processHandicapMarks(),APP.game.opponent[0].recalcScore(),APP.game.opponent[1].recalcScore(),$("#pem-name-0").html(APP.game.opponent[0].getChalkboardName()),$("#pem-name-1").html(APP.game.opponent[1].getChalkboardName()),APP.plugin_cricket.is_edit_mode=!0;var tfc=APP.game.getTurnsFromCurrent();APP.game.deepest_initiated_edit<tfc&&(APP.game.deepest_initiated_edit=tfc),APP.plugin_cricket.saved_entry=APP.game.opponent[ao].getUserInput(ar),APP.plugin_cricket.restoreEntry(),APP.device.has_chalk&&APP.plugin_cricket.showHeaderButton("EDIT")},finishEditMode:function(){var ao=APP.game.active_opponent,ar=APP.game.active_round;$("#hdr-center-overlay").hide(0),APP.plugin_cricket.saved_entry=null,APP.reveal.hideButtonBar(),APP.plugin_cricket.is_edit_mode=!1,APP.scoreboard_cricket.markColumnInactive(null),1!=APP.game.getTurnsFromCurrent()||APP.game.opponent[ao].hasUserInput(ar)||APP.game.deleteCurrentTurn(),APP.game.active_opponent=APP.game.current_opponent,APP.game.active_round=APP.game.current_round,APP.plugin_cricket.clearScoreboard(),APP.plugin_cricket.processHandicapMarks(),APP.plugin_cricket.rebuildScoring(),APP.plugin_cricket.displayOpponentIndicator(),APP.plugin_cricket.setUserControls(),APP.is_reloading||APP.plugin_cricket.is_rebuilding_scoring||window.setTimeout((function(){APP.tacticsResize.toggle()}),100)},gotoTurn:function(in_id){var ar,pc,pi,oppo,ao=APP.game.active_opponent;switch(in_id){case"NEXT":APP.game.nextOpponentTurn(),APP.plugin_cricket.displayOpponentIndicator(),APP.plugin_cricket.setUserControls(),APP.game.started_scoring&&APP.device.needToReleaseChalk()&&APP.device.releaseChalk(!0);break;case"PREV":APP.scoreboard_cricket.markColumnInactive(APP.game.active_opponent),APP.game.prevOpponentTurn(),APP.plugin_cricket.startEditMode();break;default:in_id.indexOf("pem-")>=0?in_id=(ao=APP.extractLastNumberSegment(in_id))+"-"+(ar=parseInt($("#"+in_id).attr("data-round"),10)):(ao=in_id.split("-")[0],ar=in_id.split("-")[1]),!APP.is_reloading&&APP.device.has_chalk&&APP.storeGameEvent({cmd:"GOTO",cmd_data:{turn_id:in_id}}),APP.game.active_opponent=ao,APP.game.active_round=ar,APP.scoreboard_cricket.markColumnInactive(0==ao?1:0),APP.scoreboard_cricket.clearAfterTurnMarks(0),APP.scoreboard_cricket.clearAfterTurnMarks(1),APP.plugin_cricket.saved_entry=APP.game.opponent[ao].getUserInput(ar),APP.plugin_cricket.clearScoreboard(),APP.plugin_cricket.rebuildScoring(),APP.plugin_cricket.startEditMode()}ao=APP.game.active_opponent,pc=(oppo=APP.game.opponent[ao]).team.getPlayerCount(!0),pi=APP.game.active_round%pc,clearTimeout(APP.plugin_cricket.dartbot_timer),APP.plugin_cricket.dartbot_timer=null,APP.plugin_cricket.is_bot_turn=!1,APP.device.has_chalk&&APP.device.enableButton("reveal-settings",!0),pc>0&&"Pfiller"==oppo.team.players[pi].obj_id?APP.is_reloading||APP.plugin_cricket.handleUserInput("skip"):!APP.is_reloading&&oppo.isBotTurn(APP.game.active_round)&&(APP.plugin_cricket.is_bot_turn=!0,APP.device.disableButton("reveal-settings"),APP.plugin_cricket.dartbot_timer=setTimeout(APP.plugin_cricket.takeDartBotTurn,APP.user_options.dartbot_quick_play?1e3:4e3))},clearScoreboard:function(){APP.game.active_opponent,APP.game.active_round,APP.game.current_round;var i,j,o_len=APP.game.getOpponentCount(),t_len=APP.game.getTargetCount();for(i=0;i<o_len;i++)for(APP.scoreboard_cricket.clearPoints(i),APP.scoreboard_cricket.clearAfterTurnMarks(i),APP.game.getOption("marksman_scoring")||APP.scoreboard_cricket.clearTapCounts(i),j=0;j<t_len;j++)APP.scoreboard_cricket.clearMarks(i,j)},rebuildScoring:function(){var i,j,opnt,ao=APP.game.active_opponent,ar=APP.game.active_round,cr=APP.game.current_round,o_len=APP.game.getOpponentCount(),t_len=APP.game.getTargetCount();for(i=0;i<o_len;i++){for(opnt=APP.game.opponent[i],j=1;j<t_len;j++)(!opnt.handicap_marks[j]||opnt.handicap_marks[j]<3)&&opnt.clearTargetClosingFromMark(j);for(j=0;j<=cr;j++)opnt.turn[j]&&opnt.turn[j].unscore(t_len)}if(APP.game.started_scoring)for(APP.plugin_cricket.is_rebuild_mode=!0,i=0;i<=APP.game.current_round;i++)for(j=0;j<o_len;j++)opnt=APP.game.opponent[APP.game.opponent_order[j]],APP.plugin_cricket.is_rebuild_mode&&(APP.plugin_cricket.saved_entry=opnt.getUserInput(i),opnt.clearUserInput(i),APP.game.active_round=i,APP.game.active_opponent=APP.game.opponent_order[j],APP.plugin_cricket.restoreEntry(),APP.plugin_cricket.scoring_done_round==APP.game.active_round&&0==APP.plugin_cricket.saved_entry.length&&(APP.game.active_opponent=APP.plugin_cricket.scoring_done_opponent),i==ar&&APP.game.opponent_order[j]==ao?(APP.plugin_cricket.is_rebuild_mode=!1,APP.is_reloading||APP.plugin_cricket.is_edit_mode||!APP.device.is_broadcasting||APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),notable:""})):(APP.plugin_cricket.scoring_done_round=null,APP.plugin_cricket.scoring_done_opponent=null,APP.plugin_cricket.handleUserInput("auto-replay-enter")))},clearEntry:function(in_skip_ui){var i,ao=APP.game.active_opponent,ar=APP.game.active_round;for(APP.game.opponent[ao].clearTurnMarks(ar),APP.game.opponent[ao].clearTurnPoints(ar),i=APP.game.opponent[ao].popTargetMark(ar);null!=i;)APP.plugin_cricket.setTargetButtons(i),APP.plugin_cricket.updateTargetMarks(ao,i),i=APP.game.opponent[ao].popTargetMark(ar);in_skip_ui||(APP.scoreboard_cricket.clearAfterTurnMarks(ao),APP.header.refresh(),APP.message_bar.displayTargetHits(APP.game.opponent[ao].getUserInput(ar),!APP.game.isCurrentTurnActive()),APP.game.getOption("no_points")?APP.header.showPendingScore(ao,APP.game.opponent[ao].getGameTotalMarksScored()+APP.game.opponent[ao].getTurnTotalMarksScored(ar)):APP.header.showPendingScore(ao,APP.game.opponent[ao].getPendingTargetPoints(ar)),APP.plugin_cricket.setUserControls())},restoreEntry:function(){var i,ui,ui_len,ao=APP.game.active_opponent,ar=APP.game.active_round;if(APP.plugin_cricket.clearEntry(!0),APP.plugin_cricket.saved_entry){for(ui_len=(ui=APP.plugin_cricket.saved_entry).length,i=0;i<ui_len;i++)APP.plugin_cricket.handleUserInput("auto-replay-b"+ui[i]);ui_len>0&&0==APP.game.opponent[ao].turn[ar].user_input.length&&(APP.plugin_cricket.handleUserInput("auto-replay-b0"),ui[0]),"0"==ui[0]&&APP.scoreboard_cricket.displayMiss(ao,!0)}APP.header.refresh(),APP.message_bar.displayTargetHits(APP.game.opponent[ao].getUserInput(ar),!APP.game.isCurrentTurnActive()),APP.game.getOption("no_points")?APP.header.showPendingScore(ao,APP.game.opponent[ao].getGameTotalMarksScored()+APP.game.opponent[ao].getTurnTotalMarksScored(ar)):APP.header.showPendingScore(ao,APP.game.opponent[ao].getPendingTargetPoints(ar)),APP.plugin_cricket.setUserControls()},buildEntry:function(in_target_index,in_modifier){var ar=APP.game.active_round,ao=APP.game.active_opponent,ui=APP.game.opponent[ao].getUserInput(ar);if(APP.game.is_handicapping){var t=APP.game.opponent[ao].turn[0],tp=t.target_points,tm=t.target_marks,tmlen=tm.length,t_open=0,handi_points=0,marks=1;switch(in_modifier){case"T":marks=3;break;case"D":marks=2}handi_points=marks*APP.game.getTargetValue(in_target_index);for(var tmi=1;tmi<tmlen;tmi++)tmi==in_target_index?tm[tmi]+marks<3&&t_open++:tm[tmi]<3&&t_open++,handi_points+=tp[tmi];if(t_open<1)return;if(handi_points>9999)return}if(APP.plugin_cricket.miss_target_index==ui[0])APP.game.opponent[ao].popTargetMark(ar);else if(!APP.plugin_cricket.isValidTargetMark(in_target_index,ui))return;APP.game.opponent[ao].pushTargetMark(ar,in_target_index,in_modifier);try{0==APP.game.opponent[ao].turn[ar].user_input.length&&APP.recordError("(missing turn) cricket add")}catch(e){}if($("#mb-ig-message").height("auto"),APP.message_bar.displayTargetHits(APP.game.opponent[ao].getUserInput(ar),!APP.game.isCurrentTurnActive()),in_target_index!=APP.plugin_cricket.miss_target_index){APP.game.getOption("no_points")?APP.header.showPendingScore(ao,APP.game.opponent[ao].getGameTotalMarksScored()+APP.game.opponent[ao].getTurnTotalMarksScored(ar)):APP.header.showPendingScore(ao,APP.game.opponent[ao].getPendingTargetPoints(ar)),APP.plugin_cricket.updateTargetMarks(ao,in_target_index);try{0==APP.game.opponent[ao].turn[ar].user_input.length&&APP.recordError("(missing turn) cricket update")}catch(e){}APP.plugin_cricket.setUserControls()}},backspaceEntry:function(){var i,ui,ar=APP.game.active_round,ao=APP.game.active_opponent;i=APP.game.opponent[ao].popTargetMark(ar),ui=APP.game.opponent[ao].getUserInput(ar),APP.game.is_handicapping||APP.header.refresh(),APP.game.getOption("no_points")?APP.header.showPendingScore(ao,APP.game.opponent[ao].getGameTotalMarksScored()+APP.game.opponent[ao].getTurnTotalMarksScored(ar),APP.game.is_handicapping):APP.header.showPendingScore(ao,APP.game.opponent[ao].getPendingTargetPoints(ar),APP.game.is_handicapping),APP.message_bar.displayTargetHits(ui,!APP.game.isCurrentTurnActive()),APP.plugin_cricket.updateTargetMarks(ao,i),APP.plugin_cricket.setTargetButtons(i),APP.plugin_cricket.setUserControls()},setTargetButtons:function(in_target_index){var ar=APP.game.active_round,show_cues=APP.user_options.cricket_cues;APP.game.getOption("marksman_scoring")?show_cues&&APP.game.isTargetClosedOut(ar,in_target_index)?(APP.scoreboard_cricket.disableTarget(in_target_index+"S"),APP.scoreboard_cricket.disableTarget(in_target_index+"D"),APP.scoreboard_cricket.disableTarget(in_target_index+"T")):(APP.scoreboard_cricket.enableTarget(in_target_index+"S"),APP.scoreboard_cricket.enableTarget(in_target_index+"D"),APP.scoreboard_cricket.enableTarget(in_target_index+"T")):show_cues&&APP.game.isTargetClosedOut(ar,in_target_index)?APP.scoreboard_cricket.disableTarget(in_target_index):APP.scoreboard_cricket.enableTarget(in_target_index)},recordEntry:function(in_override){var hc_marks,i,new_marks,old_marks,oppo,t_cnt,ttl_marks,hit,bulls,ao=APP.game.active_opponent,ar=APP.game.active_round,broadcast_notable="",show_popups=!APP.is_reloading&&!APP.plugin_cricket.is_edit_mode&&!APP.plugin_cricket.is_rebuild_mode&&"DELETING"!=in_override,mm=APP.session.getMatchMode(),show_notables=APP.user_options.notables&&"TOURNAMENT"!=mm;if(oppo=APP.game.opponent[ao],APP.scoreboard_cricket.clearPoints(ao),oppo.isBotTurn(ar)?0==oppo.getTurnTotalMarksScored(ar)&&(oppo.setTurnColor(ar,"MISS"),APP.scoreboard_cricket.displayMiss(ao)):0==oppo.getUserInput(ar)[0]&&("SKIP"==in_override?(oppo.setTurnColor(ar,"SKIP"),APP.scoreboard_cricket.displaySkip(ao)):(oppo.setTurnColor(ar,"MISS"),APP.scoreboard_cricket.displayMiss(ao))),oppo.setTurnMarks(ar,oppo.getTurnTotalMarksRecorded(ar),oppo.getTurnTotalMarksScored(ar)),oppo.setTurnPoints(ar,oppo.getTurnTotalPointsScored(ar)),hit=oppo.getTurnTotalMarksScored(ar),bulls=oppo.getTargetMarks(ar,APP.plugin_cricket.bull_target_index),APP.game.is_handicapping||(bulls>=3?(oppo.setTurnColor(ar,"BIG BULL"),show_popups&&(show_notables&&APP.popup.show("popup-notable",bulls+" Bulls!"),broadcast_notable=bulls+" Bulls!")):hit>=5&&hit<=8?(oppo.setTurnColor(ar,"BIG HIT"),show_popups&&(show_notables&&APP.popup.show("popup-notable",hit+" Hit!"),broadcast_notable=hit+" Hit!")):9==hit&&(oppo.setTurnColor(ar,"ROUND OF 9"),show_popups&&(show_notables&&APP.popup.show("popup-notable","Rnd of 9!"),broadcast_notable="Rnd of 9!"))),APP.game.getOption("marksman_scoring")?(APP.scoreboard_cricket.displayMarksCount("MISS"==oppo.getTurnColor(ar)?0:null,"SKIP"==oppo.getTurnColor(ar)),APP.scoreboard_cricket.colorMarksCount(!1)):APP.scoreboard_cricket.clearTapCounts(ao),!(APP.is_reloading||APP.game.is_handicapping||APP.plugin_cricket.is_edit_mode||APP.plugin_cricket.is_rebuild_mode)&&APP.plugin_cricket.userInputCheck()){var isBotPlaying=!1;try{isBotPlaying=APP.game.isBotPlaying()}catch(e){}isBotPlaying||APP.recordError("MISSING TURNS BUG - CRICKET")}if(hit){for(t_cnt=APP.game.getTargetCount(),i=1;i<t_cnt;i++)ttl_marks=(old_marks=(hc_marks=oppo.getTargetHandicapMark(i))+oppo.getPriorTargetMarks(ar,i))+(new_marks=oppo.getTargetMarks(ar,i)),APP.game.is_handicapping?ttl_marks>=3?(oppo.setTargetClosingFromMark(i,3),APP.scoreboard_cricket.displayMarks(ao,i,3,3,"close")):(oppo.clearTargetClosingFromMark(i),APP.scoreboard_cricket.displayMarks(ao,i,ttl_marks,ttl_marks,ttl_marks)):ttl_marks>=3?(old_marks<3&&oppo.setTargetClosingFromMark(i,old_marks),APP.scoreboard_cricket.displayMarks(ao,i,hc_marks,oppo.getTargetClosingFromMark(i),"close")):(oppo.clearTargetClosingFromMark(i),APP.scoreboard_cricket.displayMarks(ao,i,hc_marks,ttl_marks,ttl_marks)),APP.scoreboard_cricket.displayAfterTurnMarkCount(ao,i,new_marks),APP.plugin_cricket.setTargetButtons(i);$("#scoreboard-cricket").css("border-bottom","1px solid black"),setTimeout((function(){$("#scoreboard-cricket").css("border-bottom","")}),5)}var extendedPlay=!1,isATie=!1;if(APP.game.getOption("dutch_tactics")&&!APP.game.getOption("no_points")&&APP.game.scoreIsEqual()){extendedPlay=!0;var oppo1=APP.game.opponent[0],oppo2=APP.game.opponent[1];oppo1.areAllTargetsClosed()&&oppo2.areAllTargetsClosed()&&(isATie=!0)}if(APP.is_reloading||APP.plugin_cricket.is_rebuild_mode||!isATie){if(oppo.areAllTargetsClosed()&&APP.game.hasHighScore(ao)){for(APP.plugin_cricket.scoring_done_opponent=APP.game.active_opponent,APP.plugin_cricket.scoring_done_round=APP.game.active_round;APP.game.current_round!=ar;)APP.game.deleteCurrentTurn();if(APP.game.current_opponent!=ao&&(extendedPlay||APP.game.deleteCurrentTurn()),APP.plugin_cricket.is_edit_mode){if(APP.game.isFirstOpponent(ao)){var o_oppo=APP.game.opponent[0==ao?1:0];o_oppo.clearTurnPoints(ar),o_oppo.clearTurnMarks(ar),o_oppo.clearUserInput(ar)}APP.plugin_cricket.finishEditMode()}APP.is_reloading?extendedPlay?(APP.message_bar.clear(),APP.plugin_cricket.gotoTurn("NEXT"),APP.plugin_cricket.scoring_done_round=null):(APP.message_bar.clear(),APP.header.refresh()):APP.device.has_chalk?(APP.plugin_cricket.is_game_shot=!0,!APP.user_options.game_shot||APP.game.isBotPlaying()||APP.game.deep_editing?APP.game.getOption("dutch_tactics")&&!APP.game.getOption("no_points")&&APP.game.scoreIsEqual()?(APP.plugin_cricket.scoring_done_round=null,APP.message_bar.clear(),APP.plugin_cricket.gotoTurn("NEXT")):(APP.plugin_cricket.startSWD(ao,!0),APP.message_bar.clear()):APP.game.getOption("dutch_tactics")&&!APP.game.getOption("no_points")&&APP.game.scoreIsEqual()?(APP.plugin_cricket.scoring_done_round=null,APP.message_bar.clear(),APP.plugin_cricket.gotoTurn("NEXT")):(APP.tacticsResize.forceOff=!0,APP.game.confirmWinner({ok:function(){APP.plugin_cricket.startSWD(ao,!0),APP.message_bar.clear()},cancel:function(){APP.plugin_cricket.cancelEOG(!0)}}),window.setTimeout((function(){APP.tacticsResize.forceOff=!1}),100))):APP.game.getOption("dutch_tactics")&&APP.game.scoreIsEqual()&&APP.plugin_cricket.gotoTurn("NEXT")}else APP.game.is_handicapping||(1==APP.game.opponent_count&&(APP.game.getOption("marksman_scoring")||APP.scoreboard_cricket.clearTapCounts(ao),APP.plugin_cricket.gotoTurn("NEXT")),APP.plugin_cricket.is_edit_mode?APP.plugin_cricket.saved_entry=APP.game.opponent[ao].getUserInput(ar):APP.plugin_cricket.gotoTurn("NEXT"));APP.is_reloading||!APP.device.is_broadcasting||APP.game.is_handicapping||APP.plugin_cricket.is_edit_mode||APP.plugin_cricket.is_rebuild_mode||APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),notable:broadcast_notable}),APP.is_reloading||APP.plugin_cricket.is_rebuild_mode||APP.tacticsResize.toggle(),APP.is_reloading||APP.plugin_cricket.checkEarlyFinish()}else{if(!APP.device.has_chalk)return;APP.confirm.show({msg:"Is this leg tied?",ok_text:"Yes - Replay the Leg",cancel_text:"No - Edit Last Score Entry",ok:function(){APP.message.send.tacticsMessage(),APP.newGame("DELETE")},cancel:function(){if(!APP.device.is_hosting&&"PARTICIPANT"!=APP.device.role)return APP.plugin_cricket.gotoTurn("NEXT"),APP.plugin_cricket.handleUserInput("back"),APP.plugin_cricket.handleUserInput("clear"),APP.plugin_cricket.handleUserInput("delete"),void APP.reload();APP.confirm.hide(),APP.plugin_cricket.handleUserInput("backspace")}})}},handleUserInput:function(in_code,in_shift_key,in_remote){var i,btn_code,bot_action,auto_replay,ar=APP.game.active_round,ao=APP.game.active_opponent,cr=APP.game.current_round,co=APP.game.current_opponent;function storeEvent(in_code,in_shift_key){APP.game.is_handicapping||(APP.game.started_scoring||"btn-back"!=in_code)&&APP.storeGameEvent({cmd:"KEY",cmd_data:{code:in_code,shift_key:in_shift_key}})}if(!APP.game.finished&&null!=in_code&&"btn-undefined"!=in_code){if(APP.session.changePlayerDivDisplayed&&!APP.is_reloading&&APP.session.hideChangePlayerDiv(!0),"bb-pg-cancel"==in_code)return APP.plugin_cricket.resetHandicapping(),APP.isOnlineMatch()&&sendHandicapReset(),void APP.plugin_cricket.finishHandicapping();if("bb-pg-clear"==in_code)return APP.plugin_cricket.resetHandicapping(),void(APP.isOnlineMatch()&&sendHandicapReset());if(APP.scoreboard_cricket.enableGameSettings(!0),auto_replay=-1!=(in_code=""+in_code).indexOf("auto-replay"),bot_action=-1!=in_code.indexOf("bot-"),APP.is_reloading||!APP.plugin_cricket.is_bot_turn||bot_action||auto_replay||APP.plugin_cricket.is_edit_mode)if("mb-ig-control"!=in_code)if(APP.device.has_chalk||in_remote||auto_replay||"back"==(btn_code="funcl"==in_code.substr(in_code.lastIndexOf("-")+1)?APP.message_bar.getFunc("funcl",!0):"")&&APP.server.chalk_release_timer_id){if(APP.scoreboard_cricket.clearAfterTurnMarks(0==APP.game.active_opponent?1:0),APP.header.displayPendingPoints(0==APP.game.active_opponent?1:0,""),BBAT.isNumeric(in_code))switch(parseInt(in_code)){case 8:storeEvent(in_code,in_shift_key),APP.plugin_cricket.backspaceEntry();break;case 9:case 13:if(!auto_replay&&!APP.is_reloading&&APP.plugin_cricket.enterCoolDown.disabled)return;storeEvent(in_code,in_shift_key);ao=APP.game.active_opponent,ar=APP.game.active_round;APP.game.opponent[ao].hasUserInput(ar)?processEnter():processMiss(),auto_replay||APP.is_reloading||APP.plugin_cricket.enterCoolDown.startCoolDown()}else{if("funcr"==(btn_code=in_code.substr(in_code.lastIndexOf("-")+1))?btn_code=APP.message_bar.getFunc("funcr"):"funcl"==btn_code&&(btn_code=APP.message_bar.getFunc("funcl",!0)),null==btn_code)return;switch(auto_replay||storeEvent("btn-"+btn_code),btn_code){case"b0":case"b1":case"b2":case"b3":case"b4":case"b5":case"b6":case"b7":case"b8":case"b9":case"b10":case"b11":case"b12":case"b13":case"b14":case"b15":case"b16":case"b17":case"b18":case"b19":case"b20":case"b21":i=parseInt(btn_code.substr(1),10),APP.plugin_cricket.buildEntry(i);break;case"b0S":case"b1S":case"b2S":case"b3S":case"b4S":case"b5S":case"b6S":case"b7S":case"b8S":case"b9S":case"b10S":case"b11S":case"b12S":case"b13S":case"b14S":case"b15S":case"b16S":case"b17S":case"b18S":case"b19S":case"b20S":case"b21S":case"b1D":case"b2D":case"b3D":case"b4D":case"b5D":case"b6D":case"b7D":case"b8D":case"b9D":case"b10D":case"b11D":case"b12D":case"b13D":case"b14D":case"b15D":case"b16D":case"b17D":case"b18D":case"b19D":case"b20D":case"b21D":case"b1T":case"b2T":case"b3T":case"b4T":case"b5T":case"b6T":case"b7T":case"b8T":case"b9T":case"b10T":case"b11T":case"b12T":case"b13T":case"b14T":case"b15T":case"b16T":case"b17T":case"b18T":case"b19T":case"b20T":case"b21T":i=parseInt(btn_code.substr(1),10),APP.game.target[i]?APP.plugin_cricket.buildEntry(i,btn_code.right(1)):APP.plugin_cricket.buildEntry(APP.plugin_cricket.miss_target_index,"S");break;case"b7N":APP.plugin_cricket.buildEntry(APP.plugin_cricket.miss_target_index,"S");break;case"restore":$("#bb-me-restore").text().indexOf("Insert")>=0?(APP.game.opponent[co].setUserInput(cr,APP.game.opponent[ao].getUserInput(ar)),APP.plugin_cricket.clearEntry(),APP.plugin_cricket.buildEntry(APP.plugin_cricket.miss_target_index),APP.plugin_cricket.finishEditMode(),APP.scoreboard_cricket.displayMiss(ao),APP.message_bar.displayTargetHits(APP.game.opponent[co].getUserInput(cr),!0),APP.popup.show("popup-notify","Miss Inserted")):APP.plugin_cricket.restoreEntry();break;case"enter":processEnter();break;case"miss":processMiss();break;case"skip":APP.plugin_cricket.buildEntry(APP.plugin_cricket.miss_target_index),APP.plugin_cricket.recordEntry("SKIP");break;case"back":if(APP.game.select_winning_dart)return void APP.plugin_cricket.cancelSWD();APP.game.hasAnyoneScored()?(APP.server.cancelChalkRelease(),APP.plugin_cricket.gotoTurn("PREV")):APP.newGame("DELETE");break;case"backspace":APP.plugin_cricket.backspaceEntry();break;case"delete":return APP.plugin_cricket.finishEditMode(),APP.game.deleteCurrentTurn(),APP.plugin_cricket.rebuildScoring(),void APP.plugin_cricket.recordEntry("DELETING");case"clear":APP.plugin_cricket.clearEntry();break;case"done":APP.plugin_cricket.restoreEntry(),APP.plugin_cricket.finishEditMode(),APP.plugin_cricket.hideEditMap()}}APP.plugin_cricket.is_edit_mode&&!APP.is_reloading&&APP.plugin_cricket.setUserControls()}else APP.alert.show("You do not have the board.",null,!0,"Connection Notice!");else APP.handleAlleyOption("pcm-compete-host-chalk-button");else APP.alert.show("DartConnect has the board.",null,!0)}function processMiss(){if(APP.plugin_cricket.buildEntry(APP.plugin_cricket.miss_target_index),APP.plugin_cricket.is_edit_mode){var turns=APP.game.getTurnsFromCurrent();APP.plugin_cricket.finishEditMode(),turns>1&&!APP.plugin_cricket.is_rebuild_mode&&APP.device.has_chalk&&!APP.is_reloading&&APP.plugin_cricket.showEditMap()}else APP.plugin_cricket.recordEntry()}function processEnter(){if(APP.plugin_cricket.is_edit_mode){APP.game.getTurnsFromCurrent();APP.plugin_cricket.finishEditMode(),APP.game.deep_editing&&!APP.plugin_cricket.is_rebuild_mode&&APP.device.has_chalk&&!APP.is_reloading&&APP.plugin_cricket.showEditMap()}else if(APP.game.is_handicapping){var handi_oppo=APP.game.opponent[APP.game.handicap_opponent];APP.plugin_cricket.recordEntry(),handi_oppo.handicap_marks=handi_oppo.turn[0].target_marks.slice(0),handi_oppo.handicap=handi_oppo.current_score,handi_oppo.turn[0].reset(APP.game.getTargetCount()),APP.plugin_cricket.finishHandicapping(),APP.plugin_cricket.storeSettings(),APP.storeState(),APP.storeGameEvent({cmd:"HANDICAP",cmd_data:{handicap_marks_0:APP.game.opponent[0].handicap_marks,handicap_marks_1:APP.game.opponent[1].handicap_marks}}),!APP.is_reloading&&APP.device.is_broadcasting&&APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html()}),APP.is_reloading||APP.device.is_broadcasting||APP.is_reloading||APP.nlf.rails.retryBroadcast(),!APP.session.isBracketMatch()||APP.device.is_broadcasting||APP.is_reloading||APP.session.bracketFunctions.retryBroadcast()}else APP.plugin_cricket.recordEntry()}function sendHandicapReset(){var handi_oppo=APP.game.opponent[APP.game.handicap_opponent];handi_oppo.handicap_marks=handi_oppo.turn[0].target_marks.slice(0),handi_oppo.handicap=handi_oppo.current_score,handi_oppo.turn[0].reset(APP.game.getTargetCount()),APP.plugin_cricket.finishHandicapping(),APP.plugin_cricket.storeSettings(),APP.storeState(),APP.storeGameEvent({cmd:"HANDICAP",cmd_data:{handicap_marks_0:APP.game.opponent[0].handicap_marks,handicap_marks_1:APP.game.opponent[1].handicap_marks}})}},userInputCheck:function(){if(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)return!1;try{var thisOpponent=APP.game.current_opponent;APP.game.opponent_order[thisOpponent]&&!0;var turns=APP.game.opponent[thisOpponent].turn;if(0===turns[turns.length-1].user_input.length)return!0}catch(e){}return!1},earlyFinishAttempted:!1,isEarlyFinishActive:function(){try{var match=APP.getMatch();if(match&&match.format){var mf=match.format;if(mf.sudden_death&&"Y"==mf.sudden_death.active&&mf.sudden_death.round)return!0}}catch(e){}return!1},getEarlyFinishTurnLimit:function(){try{var mf=APP.getMatch().format;if(mf.sudden_death.round)return mf.sudden_death.round+1}catch(e){}return-2},checkEarlyFinish:function(){if(this.isEarlyFinishActive()&&!this.earlyFinishAttempted){var turnLimit=this.getEarlyFinishTurnLimit();if(APP.game.active_round+1===turnLimit){var customMsg=!1,mf=APP.getMatch().format;mf.sudden_death&&mf.sudden_death.instructions&&(customMsg=mf.sudden_death.instructions);var team1=getPlayerNameList(APP.game.opponent[0]),team2=getPlayerNameList(APP.game.opponent[1]),isTournament=!1;try{mf.sudden_death&&mf.sudden_death.type&&"TOURNAMENT"==mf.sudden_death.type&&(isTournament=!0)}catch(e){}if(APP.game.active_round+1==turnLimit){var errorMsg="",type="casual";switch(APP.session.isLeaguePlay()&&(type="league"),isTournament&&(type="tournament"),type){case"league":errorMsg=`\n\t\t\t\t\t\t<p>${APP.game.active_round} Turns / ${3*APP.game.active_round} Dart Limit</p>\n\t\t\t\t\t\t<p>This leg has reached the maximum number of darts allowed for league play. Please select the winner.</p>\n\t\t\t\t\t`;break;case"tournament":case"casual":default:errorMsg=`\n\t\t\t\t\t\t<p>${APP.game.active_round} Turns / ${3*APP.game.active_round} Dart Limit</p>\n\t\t\t\t\t\t<p>This leg has reached the maximum number of darts allowed. Please select the winner.</p>\n\t\t\t\t\t`}errorMsg+=customMsg?`\n\t\t\t\t\t<p class="bold highlight-box text-gold">${customMsg}</p>\n\t\t\t\t`:isTournament?"\n\t\t\t\t\t\t<p>Players are instructed to follow the tournament rules to determine the winner of this leg.</p>\n\t\t\t\t\t":"\n\t\t\t\t\t\t<p>Players are instructed to follow the league rules to determine the winner of this leg.</p>\n\t\t\t\t\t",errorMsg+=`\t\n\t\t\t\t<div class="dialogBtn button button-menu button-green round-corners"\n\t\t\t\t\tid="ef-player0-btn"\n\t\t\t\t>\n\t\t\t\t\t${APP.game.opponent[0].getChalkboardName()}\n\t\t\t\t</div>\n\t\t`,team1&&!isTournament&&(errorMsg+=`\n\t\t\t\t\t<p>${team1}</p>\n\t\t\t\t\t`),errorMsg+=`\n\t\t\t\t<div class="dialogBtn button button-menu button-green round-corners"\n\t\t\t\t\tid="ef-player1-btn"\n\t\t\t\t>\n\t\t\t\t\t${APP.game.opponent[1].getChalkboardName()}\n\t\t\t\t</div>\n\t\t`,team2&&!isTournament&&(errorMsg+=`\n\t\t\t\t\t<p>${team2}</p>\n\n\t\t\t\t\t<hr />\n\t\t\t\t\t`),errorMsg+='\n\t\t\t\t<p>OR</p>\n\n\t\t\t\t<div class="dialogBtn button button-menu button-red round-corners"\n\t\t\t\t\tid="ef-continue-btn"\n\t\t\t\t>\n\t\t\t\t\tContinue This Leg\n\t\t\t\t</div>\n\t\t\t',APP.dialog.show({title:"Sudden Death!",msg:errorMsg,use_close_icon:!1}),this.earlyFinishAttempted=!0}APP.fns.activateBtn(["ef-player0-btn","ef-player1-btn","ef-continue-btn"],this.handleEarlyFinish)}}function getPlayerNameList(oppo){try{var playerName="";if(oppo.getPlayers().length<1)return"";for(var i=0;i<oppo.getPlayers().length;i++)playerName+=oppo.getChalkboardName(i),playerName+=" &amp; ";return playerName.substring(0,playerName.length-7)}catch(e){}return""}},handleEarlyFinish:function(in_id){if("ef-continue-btn"==in_id)return APP.dialog.hide(),void(this.earlyFinishAttempted=!0);APP.game.active_opponent;var leg_html_0,leg_html_1,leg_wins=APP.session.getLegsStanding().split(" - ");leg_wins[0]=parseInt(leg_wins[0]),leg_wins[1]=parseInt(leg_wins[1]),"ef-player0-btn"==in_id?(leg_html_0='<span style="color:red;">'+(leg_wins[0]+1)+"</span>",leg_html_1=leg_wins[1]):(leg_html_0=leg_wins[0],leg_html_1='<span style="color:red;">'+(leg_wins[1]+1)+"</span>");var html='<p style="font-size:2em;font-weight:bold;color:red;margin:0.5em 0 0.3em;">'+("ef-player0-btn"==in_id?APP.game.opponent[0].getChalkboardName():APP.game.opponent[1].getChalkboardName())+'</p><p style="font-size:2em;font-weight:bold;">'+leg_html_0+" - "+leg_html_1+"</p>";switch(in_id){case"ef-player0-btn":APP.dialog.hide(),APP.confirm.show({title:"Confirm Game Winner:",msg:html,ok:function(){APP.game.winning_opponent=0,APP.game.sudden_death_win=!0,APP.game.finish(3)},cancel:function(){this.earlyFinishAttempted=!1,APP.plugin_cricket.checkEarlyFinish()}});break;case"ef-player1-btn":APP.dialog.hide(),APP.confirm.show({title:"Confirm Game Winner:",msg:html,ok:function(){APP.game.winning_opponent=1,APP.game.sudden_death_win=!0,APP.game.finish(3)},cancel:function(){this.earlyFinishAttempted=!1,APP.plugin_cricket.checkEarlyFinish()}})}}},APP.plugin_library={default_options:{},is_edit_mode:!1,saved_entry:null,prev_speedkey_timestamp:0,init:function(){var dvc=APP.device,plg=APP.plugin_library;plg.default_options.ascending_score=!0,plg.default_options.double_in=!1,plg.default_options.double_out=!1,plg.default_options.starting_score=0,plg.default_options.assume_3=!1,plg.default_options.dyg_name="Count-Up",plg.default_options.game_type="POINTS",plg.default_options.miss_half=!1,plg.default_options.negative_scoring=!1,plg.default_options.scoring_type="TARGET COUNTING",plg.default_options.special_targets=!1,plg.default_options.starting_target=1,plg.default_options.target_order="ASCENDING",dvc.addButtonHandler(["gsm-library-close","gsm-library-info","gsm-library-game-play","gsm-library-game-create","gsm-library-type-points","gsm-library-type-targets","gsm-library-type-halve-it","gsm-library-target-counting","gsm-library-target-scoring","gsm-library-miss-half","gsm-library-special-targets","gsm-library-target-order-ascending","gsm-library-target-order-descending","gsm-library-negative-scoring","gsm-library-negative-target","gsm-library-starting-target","gsm-library-assume-3","gsm-library-continue","gsm-library-around","gsm-library-baseball","gsm-library-count-up","gsm-library-51x5s","gsm-library-golf","gsm-library-shanghai","gsm-library-27","gsm-library-101-darts","ptp-close","ptp-1","ptp-2","ptp-3","ptp-4","ptp-5","ptp-6","ptp-7","ptp-8","ptp-9","ptp-10","ptp-11","ptp-12","ptp-13","ptp-14","ptp-15","ptp-16","ptp-17","ptp-18","ptp-19","ptp-20"],plg.handleSettingChange)},storeSettings:function(){var gam=APP.game;BBAT.storeData({settings_library:{options:gam.options,starting_score_0:gam.opponent[0].getStartingScore(),starting_score_1:gam.opponent[1].getStartingScore()}}),APP.storeState({settings_change:!0})},initGamePanel:function(){var settings,dvc=APP.device,gam=APP.game,hdr=APP.header,plg=APP.plugin_library;dvc.addButtonHandler(["gsp-settings-title","gsp-options","gsp-opponent-0","gsp-opponent-1","gsp-opponent-x","gsp-opponent-ag","gsp-opponent-as","gsp-opponent-m","gsp-opponent-s","gsp-new-set"],plg.handleGameOption),gam.getOpponentCount()||(gam.opponent_count=2,gam.opponent[0]=new gam.Opponent({starting_score:plg.default_options.starting_score,handicap:0}),gam.opponent[0].setTeam(APP.game.dflt_host_team),gam.opponent[1]=new gam.Opponent({starting_score:plg.default_options.starting_score,handicap:0}),gam.opponent[1].setTeam(APP.game.dflt_guest_team)),gam.resetOptions(),(settings=BBAT.fetchData("settings_library"))?(gam.setOptions(settings.options),gam.opponent[0].setStartingScore(settings.starting_score_0),gam.opponent[1].setStartingScore(settings.starting_score_1)):(APP.plugin_library.resetGameOptions(),gam.resetScores(plg.default_options.starting_score)),hdr.resetScoreOptions(),hdr.setScoreOptions({cancel_text:"Cancel Score Edit",done_callback:function(){plg.storeSettings(),plg.refreshGamePanel()},hint_text:'<span style="font-size:0.75em;">Enter Starting Score</span>',max_value:1001}),hdr.refresh(),plg.refreshGamePanel()},refreshGamePanel:function(e,e_info){var gam=APP.game;APP.plugin_library;switch($("#gsp-opponent-name-0").html(gam.opponent[0].getStartButtonName()),$("#gsp-opponent-name-1").html(gam.opponent[1].getStartButtonName()),APP.session.isNewSet()&&($("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled")),gam.opponent_count){case 1:$("#gsp-opponent-1").addClass("button-disabled"),$("#gsp-opponent-x").addClass("button-disabled"),$("#gsp-opponent-m").addClass("button-disabled"),$("#gsp-opponent-ag").addClass("button-disabled");break;case 2:$("#gsp-opponent-1").removeClass("button-disabled"),$("#gsp-opponent-x").removeClass("button-disabled"),APP.session.isNewSet()||($("#gsp-opponent-m").removeClass("button-disabled"),$("#gsp-opponent-ag").removeClass("button-disabled"))}$("#gsp-settings-title").html(gam.getOption("dyg_name")),$("#gsp-marksman").css("visibility","hidden"),APP.device.disableButton("gsp-marksman"),"TOURNAMENT"==APP.session.getMatchMode()&&(APP.blockFeatures(["gs-library","header-score"]),APP.blockUIControls())},handleGameOption:function(in_id){var i,gam=APP.game,plg=APP.plugin_library,pup=APP.popup;switch(in_id){case"gsp-options":case"gsp-settings-title":plg.initSettingsMenu(),pup.show("game-settings-menu-library");break;case"gsp-new-set":APP.session.isNewSet()?(APP.session.popSet(),APP.session.showGameSelector()):APP.session.addSet("LIBRARY"),APP.reveal.setNewSetButton(),APP.reveal.updateSetStatus(),APP.game.plugin.refreshGamePanel();break;case"gsp-opponent-s":APP.game_selector.selectGame("gs-cork-calls"),APP.session.showBullShoot();break;case"gsp-opponent-0":gam.start(0);break;case"gsp-opponent-1":gam.start(1);break;case"gsp-opponent-x":i=new Date%gam.getOpponentCount(),gam.start(i);break;case"gsp-opponent-ag":i=0==APP.session.getPrevGameStartingOpponent()?1:0,gam.start(i);break;case"gsp-opponent-as":i=0==APP.session.getPrevSetStartingOpponent()?1:0,gam.start(i);break;case"gsp-opponent-m":i=0==APP.session.getPrevGameWinningOpponent()?1:0,gam.start(i)}},resetGameOptions:function(){var plg=APP.plugin_library;APP.game.setOptions({ascending_score:plg.default_options.ascending_score,assume_3:plg.default_options.assume_3,double_in:plg.default_options.double_in,double_out:plg.default_options.double_out,dyg_name:plg.default_options.dyg_name,game_type:plg.default_options.game_type,scoring_type:plg.default_options.scoring_type,negative_scoring:plg.default_options.negative_scoring,miss_half:plg.default_options.miss_half,special_targets:plg.default_options.special_targets,target_order:plg.default_options.target_order,starting_target:plg.default_options.starting_target})},initSettingsMenu:function(){var dyg_name,i,gam=APP.game;switch($("#game-settings-menu-library .menu-option-on").removeClass("menu-option-on"),$(".gsm-library-options-group").hide(0),$(".gsm-library-game-hints").hide(0),$(".gsm-library-target-hints").hide(0),$("#gsm-library-game-play").addClass("menu-option-on"),$(".gsm-library-top-option").hide(0),$("#gsm-library-predefined").show(0),dyg_name=APP.game.getOption("dyg_name").toLowerCase()){case"around the world":dyg_name="around";break;case"51 x 5's":dyg_name="51x5s";break;case"101 darts":dyg_name="101-darts"}switch($("#gsm-library-"+dyg_name).addClass("menu-option-on"),gam.getOption("game_type")){case"POINTS":$("#gsm-library-type-points").addClass("menu-option-on"),$("#gsm-library-points-hint").show(0),$("#gsm-library-points-options").show(0);break;case"TARGETS":gam.getOption("miss_half")?($("#gsm-library-type-halve-it").addClass("menu-option-on"),$("#gsm-library-halve-it-hint").show(0),$(".gsm-library-target-only-options").hide(0)):($("#gsm-library-type-targets").addClass("menu-option-on"),$("#gsm-library-targets-hint").show(0),$(".gsm-library-target-only-options").show(0)),$("#gsm-library-targets-options").show(0)}switch(gam.getOption("scoring_type")){case"TARGET COUNTING":$("#gsm-library-target-counting").addClass("menu-option-on"),$("#gsm-library-target-counting-hint").show(0);break;case"TARGET SCORING":$("#gsm-library-target-scoring").addClass("menu-option-on"),$("#gsm-library-target-scoring-hint").show(0)}gam.getOption("negative_scoring")&&$(".gsm-negative-scoring").addClass("menu-option-on"),"ASCENDING"==gam.getOption("target_order")?$("#gsm-library-target-order-ascending").addClass("menu-option-on"):$("#gsm-library-target-order-descending").addClass("menu-option-on"),gam.getOption("special_targets")&&$("#gsm-library-special-targets").addClass("menu-option-on"),i=gam.getOption("starting_target"),$("#gsm-library-starting-target").text("Starting Target = "+i),$(".ptp-option-on").removeClass("ptp-option-on"),$("#ptp-"+i).addClass("ptp-option-on"),gam.getOption("assume_3")&&$("#gsm-library-assume-3").addClass("menu-option-on")},handleSettingChange:function(in_id){var gam=APP.game,hdr=APP.header,plg=APP.plugin_library,pup=APP.popup;function setupStartingTarget(in_target_value){$("#gsm-library-starting-target").text("Starting Target = "+in_target_value),$(".ptp-option-on").removeClass("ptp-option-on"),$("#ptp-"+in_target_value).addClass("ptp-option-on")}function setAscendingTargets(){$(".gsm-library-target-order-group").removeClass("menu-option-on"),$("#gsm-library-target-order-ascending").addClass("menu-option-on")}function toggleGameSelection(in_id){$(".gsm-library-game-group").removeClass("menu-option-on"),$("#"+in_id).addClass("menu-option-on")}switch(in_id){case"gsm-library-close":pup.hide(),plg.refreshGamePanel();break;case"gsm-library-info":$("#gsm-library-game-play").hasClass("menu-option-on")?APP.info.show("info-gsm-library-play"):APP.info.show("info-gsm-library-create");break;case"gsm-library-starting-target":$("#popup-overlay").show(0),APP.popup.show("popup-target-picker");break;case"ptp-1":case"ptp-2":case"ptp-3":case"ptp-4":case"ptp-5":case"ptp-6":case"ptp-7":case"ptp-8":case"ptp-9":case"ptp-10":case"ptp-11":case"ptp-12":case"ptp-13":case"ptp-14":case"ptp-15":case"ptp-16":case"ptp-17":case"ptp-18":case"ptp-19":case"ptp-20":setupStartingTarget(APP.extractLastNumberSegment(in_id));case"ptp-close":APP.popup.hide("popup-target-picker"),$("#popup-overlay").hide(0);break;case"gsm-library-game-play":$(".gsm-library-top-option-group").removeClass("menu-option-on"),$("#gsm-library-game-play").addClass("menu-option-on"),$("#gsm-library-create-games").hide(0),$("#gsm-library-predefined").show(0);break;case"gsm-library-around":case"gsm-library-baseball":toggleGameSelection(in_id),plg.handleSettingChange("gsm-library-type-targets"),plg.handleSettingChange("gsm-library-target-counting"),$("#gsm-library-special-targets").removeClass("menu-option-on"),setAscendingTargets(),setupStartingTarget(1);break;case"gsm-library-shanghai":toggleGameSelection(in_id),plg.handleSettingChange("gsm-library-type-targets"),plg.handleSettingChange("gsm-library-target-scoring"),$("#gsm-library-special-targets").removeClass("menu-option-on"),setAscendingTargets(),setupStartingTarget(1);break;case"gsm-library-101-darts":case"gsm-library-count-up":case"gsm-library-51x5s":case"gsm-library-golf":toggleGameSelection(in_id),plg.handleSettingChange("gsm-library-type-points"),$(".gsm-negative-scoring").removeClass("menu-option-on");break;case"gsm-library-27":toggleGameSelection(in_id),plg.handleSettingChange("gsm-library-type-targets"),plg.handleSettingChange("gsm-library-target-scoring"),$("#gsm-library-special-targets").addClass("menu-option-on"),$(".gsm-negative-scoring").addClass("menu-option-on"),setAscendingTargets(),setupStartingTarget(1);break;case"gsm-library-game-create":$(".gsm-library-top-option-group").removeClass("menu-option-on"),$("#gsm-library-predefined").hide(0),$(".gsm-library-game-group").removeClass("menu-option-on"),$("#gsm-library-game-create").addClass("menu-option-on"),$("#gsm-library-create-games").show(0);break;case"gsm-library-type-points":$(".gsm-library-options-group").hide(0),$(".gsm-library-type-group").removeClass("menu-option-on"),$("#gsm-library-type-points").addClass("menu-option-on"),$(".gsm-library-scoring-group").removeClass("menu-option-on"),$("#gsm-library-target-counting").addClass("menu-option-on"),$(".gsm-library-target-order-group").removeClass("menu-option-on"),$("#gsm-library-target-order-ascending").addClass("menu-option-on"),$("#gsm-library-special-targets").removeClass("menu-option-on"),setupStartingTarget(1),$(".gsm-library-game-hints").hide(0),$("#gsm-library-points-hint").show(0),$("#gsm-library-points-options").show(0);break;case"gsm-library-type-targets":$(".gsm-library-options-group").hide(0),$(".gsm-library-type-group").removeClass("menu-option-on"),$("#gsm-library-type-targets").addClass("menu-option-on"),$(".gsm-negative-scoring").removeClass("menu-option-on"),$(".gsm-library-game-hints").hide(0),$("#gsm-library-targets-hint").show(0),$(".gsm-library-target-only-options").show(0),$("#gsm-library-targets-options").show(0);break;case"gsm-library-type-halve-it":$(".gsm-library-options-group").hide(0),$(".gsm-library-type-group").removeClass("menu-option-on"),$("#gsm-library-type-halve-it").addClass("menu-option-on"),$(".gsm-negative-scoring").removeClass("menu-option-on"),$(".gsm-library-scoring-group").removeClass("menu-option-on"),$("#gsm-library-target-scoring").addClass("menu-option-on"),$(".gsm-library-target-hints").hide(0),$("#gsm-library-target-scoring-hint").show(0),$(".gsm-library-game-hints").hide(0),$("#gsm-library-halve-it-hint").show(0),$(".gsm-library-target-only-options").hide(0),$("#gsm-library-targets-options").show(0);break;case"gsm-library-target-scoring":$(".gsm-library-scoring-group").removeClass("menu-option-on"),$("#gsm-library-target-scoring").addClass("menu-option-on"),$(".gsm-library-target-hints").hide(0),$("#gsm-library-target-scoring-hint").show(0);break;case"gsm-library-target-counting":$(".gsm-library-scoring-group").removeClass("menu-option-on"),$("#gsm-library-target-counting").addClass("menu-option-on"),$(".gsm-library-target-hints").hide(0),$("#gsm-library-target-counting-hint").show(0);break;case"gsm-library-target-order-ascending":$(".gsm-library-target-order-group").removeClass("menu-option-on"),$("#gsm-library-target-order-ascending").addClass("menu-option-on"),setupStartingTarget(1);break;case"gsm-library-target-order-descending":$(".gsm-library-target-order-group").removeClass("menu-option-on"),$("#gsm-library-target-order-descending").addClass("menu-option-on"),setupStartingTarget(20);break;case"gsm-library-assume-3":case"gsm-library-special-targets":$("#"+in_id).toggleClass("menu-option-on");break;case"gsm-library-negative-scoring":case"gsm-library-negative-target":$(".gsm-negative-scoring").toggleClass("menu-option-on");break;case"gsm-library-continue":APP.plugin_library.resetGameOptions(),$("#game-settings-menu-library .menu-option-on").each((function(i){switch(this.id){case"gsm-library-around":gam.resetScores(1),gam.setOptions({dyg_name:"Around the World"});break;case"gsm-library-baseball":gam.resetScores(0),gam.setOptions({dyg_name:"Baseball"});break;case"gsm-library-101-darts":gam.resetScores(0),gam.setOptions({dyg_name:"101 Darts"});break;case"gsm-library-count-up":gam.resetScores(0),gam.setOptions({dyg_name:"Count-Up"});break;case"gsm-library-51x5s":gam.resetScores(0),gam.setOptions({dyg_name:"51 x 5's"});break;case"gsm-library-golf":gam.resetScores(0),gam.setOptions({dyg_name:"Golf"});break;case"gsm-library-27":gam.resetScores(27),gam.setOptions({dyg_name:"27"});break;case"gsm-library-shanghai":gam.resetScores(0),gam.setOptions({dyg_name:"Shanghai"});break;case"gsm-library-game-create":APP.game.resetScores(plg.default_options.starting_score);break;case"gsm-library-type-points":gam.setOptions({game_type:"POINTS"}),$("#gsm-library-game-create").hasClass("menu-option-on")&&gam.setOptions({dyg_name:"Points Game"});break;case"gsm-library-type-targets":gam.setOptions({game_type:"TARGETS",miss_half:!1}),$("#gsm-library-game-create").hasClass("menu-option-on")&&gam.setOptions({dyg_name:"Targets Game"});break;case"gsm-library-type-halve-it":gam.setOptions({game_type:"TARGETS",miss_half:!0}),$("#gsm-library-game-create").hasClass("menu-option-on")&&gam.setOptions({dyg_name:"Halve-It Game"});break;case"gsm-library-target-counting":gam.setOptions({scoring_type:"TARGET COUNTING"});break;case"gsm-library-target-scoring":gam.setOptions({scoring_type:"TARGET SCORING"});break;case"gsm-library-target-order-ascending":gam.setOptions({target_order:"ASCENDING"}),gam.setOptions({starting_target:APP.extractLastNumberSegment($(".ptp-option-on")[0].id)});break;case"gsm-library-target-order-descending":gam.setOptions({target_order:"DESCENDING"}),gam.setOptions({starting_target:APP.extractLastNumberSegment($(".ptp-option-on")[0].id)});break;case"gsm-library-special-targets":gam.setOptions({special_targets:!0});break;case"gsm-library-negative-target":case"gsm-library-negative-scoring":gam.setOptions({negative_scoring:!0});break;case"gsm-library-assume-3":gam.setOptions({assume_3:!0})}})),plg.storeSettings(),pup.hide(),plg.refreshGamePanel(),hdr.refresh()}},handleRemoteHandicap:function(){console.log("Handicap doesn't work in library games")},handlePostStart:function(){var dvc=APP.device,gam=APP.game,hdr=APP.header,plg=APP.plugin_library,rvl=APP.reveal,sb=APP.scoreboard,sbp=APP.scoreboard_points;dvc.setKeyboardHandler(plg.handleUserInput),dvc.addButtonHandler(["kp-p-01","kp-p-02","kp-p-03","kp-p-04","kp-p-05","kp-p-06","kp-p-07","kp-p-08","kp-p-09","kp-p-00","kp-p-times","kp-p-plus","kp-p-minus","kp-p-sk-0","kp-p-sk-1","kp-p-sk-2","kp-p-sk-3","kp-p-sk-4","kp-p-sk-5","kp-p-sk-6","kp-p-sk-7","bb-ig-clear","bb-ig-cancel","bb-ig-restore","mb-ig-funcl","mb-ig-funcr","hdr-eog-0","hdr-eog-1","sb-p-special-target-button","sb-p-negative-target-button","ptm-close","ptm-reset","ptm-bull","ptm-double-bull","ptm-double","ptm-triple","ptm-39","ptm-42","ptm-3b","ptm-3c","ptm-3n","ptm-x","kp-p-140","kp-p-100"],plg.handleUserInput),dvc.addButtonHandler(["swdm-close","swdm-dart-1","swdm-dart-2","swdm-dart-3"],plg.handleSWDOption),sb.enableScrolling(),sbp.show(),sbp.addNewRow(),sbp.displayGameSettings(),sbp.activateTurn("turn_current"),"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||(("POINTS"==gam.getOption("game_type")||gam.getOption("special_targets"))&&rvl.showPanel("keypad-points-panel"),gam.getOption("special_targets")&&APP.keypad_points.disableOperators(),gam.getOption("negative_scoring")&&APP.keypad_points.setTimesMinusOperator("-")),APP.device.has_chalk&&!APP.device.chalk_locked&&("HOST"==APP.device.role&&1==APP.game.current_opponent||"PARTICIPANT"==APP.device.role&&0==APP.game.current_opponent)&&APP.device.releaseChalk(),hdr.resetScoreOptions(),hdr.refresh()},handleSWDOption:function(in_id){var gam=APP.game,plg=APP.plugin_library;APP.scoreboard_points;switch(in_id){case"swdm-close":plg.cancelSWD();break;case"swdm-dart-1":gam.finish(1);break;case"swdm-dart-2":gam.finish(2);break;case"swdm-dart-3":gam.finish(3)}},cancelEOG:function(){var gam=APP.game,hdr=APP.header,mbr=APP.message_bar,rvl=(APP.plugin_01,APP.reveal),sbp=APP.scoreboard_points;APP.storeGameEvent({cmd:"CANCEL_EOG",cmd_data:{}}),gam.resetEOG(),"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||(mbr.show("message-bar-ingame"),APP.reveal.hideButtonBar((function(){APP.reveal.clearAllPanels((function(){APP.reveal.resetEOGStatsPanel(),"POINTS"==gam.getOption("game_type")||gam.getOption("special_targets")?rvl.showPanel("keypad-points-panel",(function(){APP.device.has_chalk&&APP.game.plugin.startSWD()})):APP.device.has_chalk&&APP.game.plugin.startSWD()}))}))),sbp.resetEOG(),hdr.refresh()},handleScoringOption:function(){},startSWD:function(in_assume_3){APP.device;var s0,s1,gam=APP.game,mbr=APP.message_bar,rvl=APP.reveal,sb=APP.scoreboard;if(APP.game.opponent[0].isPlayerOrderPending()&&(APP.game.opponent[0].skipPlayerTracking(),APP.header.hidePlayerOrderMenu(0)),APP.game.opponent[1].isPlayerOrderPending()&&(APP.game.opponent[1].skipPlayerTracking(),APP.header.hidePlayerOrderMenu(1)),APP.game.select_winning_dart=!0,"101 Darts"==gam.getOption("dyg_name"))return s0=gam.opponent[0].getCurrentScore(),s1=gam.opponent[1].getCurrentScore(),gam.winning_opponent=s0==s1?new Date%2:s0>s1?0:1,void gam.finish(2);in_assume_3?gam.finish(3):(sb.shield(),mbr.disableFuncs(),"POINTS"==gam.getOption("game_type")||gam.getOption("special_targets")?rvl.slideUpPanel("swd-menu-panel",(function(){mbr.setLeftFunc("back"),mbr.setRightFunc("bust")})):rvl.showPanel("swd-menu-panel",(function(){mbr.setLeftFunc("back"),mbr.setRightFunc("bust")})))},cancelSWD:function(){APP.device;var gam=APP.game,mbr=APP.message_bar,rvl=APP.reveal,sb=APP.scoreboard,sbp=APP.scoreboard_points;APP.game.select_winning_dart=!1,APP.storeGameEvent({cmd:"CANCEL_SWD",cmd_data:{}}),"TARGETS"==gam.getOption("game_type")?rvl.hideButtonBar((function(){rvl.hidePanel("swd-menu-panel")})):rvl.hideButtonBar((function(){rvl.slideDownPanel("swd-menu-panel")})),sbp.activateTurn("turn_current"),gam.winning_opponent=null,sb.unshield(),mbr.enableFuncs()},handlePreFinish:function(){var bt,delete_last_round,i,o,p,r,cr=APP.game.current_round,gam=APP.game,o_cnt=APP.game.getOpponentCount(),sb=APP.scoreboard,sbp=APP.scoreboard_points,wo=APP.game.winning_opponent;for("TARGETS"==gam.getOption("game_type")?gam.setOptions({stats_type:"MARKS"}):gam.setOptions({stats_type:"POINTS"}),sb.unshield(),sb.disableEditing(),sbp.clearAchievementColumns(),sbp.clearTargetButtons(),delete_last_round=!0,i=0;i<o_cnt;i++)if(BBAT.isNumeric(gam.opponent[i].getTurnPoints(cr))){delete_last_round=!1;break}if(delete_last_round)for(;cr==gam.current_round;)sbp.deleteCurrentTurn();for(bt=0,cr=gam.current_round,r=0;r<=cr;r++)for(o=0;o<o_cnt;o++)((p=gam.opponent[o].getTurnPoints(r))>=95||r==cr&&o==wo)&&sbp.markExceptionalTurn(o,r),p>bt&&(bt=p);for(r=0;r<=cr;r++)for(o=0;o<o_cnt;o++)(p=gam.opponent[o].getTurnPoints(r))==bt&&sbp.markBestTurn(o,r);sbp.markStartingTurn(gam.opponent_order[0]),sbp.markWinningTurn(wo,cr)},cancelEdit:function(){var plg=APP.plugin_library;plg.restoreEntry(),plg.recordEntry()},restoreEntry:function(){var eq=APP.equation,plg=APP.plugin_library;eq.reset(plg.saved_entry)},recordEntry:function(){var chkout,i,points,value,ao=APP.game.active_opponent,ar=APP.game.active_round,dvc=APP.device,eq=APP.equation,gam=APP.game,plg=APP.plugin_library,pup=APP.popup,sbp=(APP.reveal,APP.scoreboard_points);if(plg.saved_entry=null,(points=eq.value())>180)dvc.has_chalk&&!APP.is_reloading&&alert("Entry exceeds 180 points... Please correct the entry.");else{if("TARGETS"==gam.getOption("game_type")&&!gam.getOption("special_targets")){if(points%(value=gam.getDYGTargetValue(ar))!=0)return void(dvc.has_chalk&&!APP.is_reloading&&alert("Entry must be a factor of "+value+"... Please correct the entry."));gam.opponent[ao].setTurnMarks(ar,points/value,points/value)}if(gam.opponent[ao].clearTurnColor(ar),0==points&&(gam.opponent[ao].setTurnColor(ar,"MISS"),1==gam.opponent_count&&pup.show("popup-notify","MISS")),gam.opponent[ao].setTurnPoints(ar,points),sbp.displayTurnEntry(ao,ar,points,gam.opponent[ao].getTurnColor(ar)),gam.getOption("miss_half"))for(chkout=gam.opponent[ao].getStartingScore()+gam.opponent[ao].getHandicap(),i=0;i<=gam.current_round;i++)"MISS"==gam.opponent[ao].getTurnColor(i)?(points=0,1==chkout?points=-1:chkout>0&&(points=-Math.floor(chkout/2)),gam.opponent[ao].setTurnPoints(i,points),chkout+=points):(points=gam.opponent[ao].getTurnPoints(i),BBAT.isNumeric(points)&&(chkout+=points));if("DESCENDING"==APP.game.getOption("target_order")&&1==value&&gam.isLastOpponent(ao))return dvc.has_chalk&&!APP.is_reloading&&alert("Please select a winner"),void sbp.activateTurn("turn_current");if(plg.is_edit_mode)sbp.activateTurn("turn_current");else{if(1==gam.opponent_count&&sbp.activateTurn("turn_next"),"101 Darts"==APP.game.getOption("dyg_name")&&33==ar&&APP.game.isLastOpponent(ao))return void APP.plugin_library.startSWD();sbp.activateTurn("turn_next")}!APP.is_reloading&&APP.device.is_broadcasting&&APP.server.postBroadcast({header:$("#header").html(),scoreboard:$("#scoreboard-center").html(),notable:gam.opponent[ao].getTurnColor(ar)||""})}},gotoTurn:function(in_id){APP.scoreboard_points.activateTurn(in_id)},handlePreActivateTurn:function(in_id){var ao=APP.game.active_opponent,ar=APP.game.active_round,eq=APP.equation,gam=APP.game,hdr=APP.header,plg=APP.plugin_library,sbp=APP.scoreboard_points,sb=APP.scoreboard;sbp.displayTurnEntry(ao,ar,eq.value(),gam.opponent[ao].getTurnColor(ar)),"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||sb.enableEditing(),hdr.refresh(),plg.is_edit_mode=!1},handlePostActivateTurn:function(in_edit_navigation){var ao=APP.game.active_opponent,ar=APP.game.active_round,cr=APP.game.current_round,dvc=APP.device,eq=APP.equation,gam=APP.game,hdr=APP.header,mbr=APP.message_bar,plg=APP.plugin_library,sb=APP.scoreboard,sbp=APP.scoreboard_points;plg.is_edit_mode=!gam.isCurrentTurnActive(),plg.is_edit_mode?(sb.disableEditing(),plg.saved_entry=gam.opponent[ao].getUserInput(ar),"TARGETS"==gam.getOption("game_type")&&sbp.swapTargetButton(cr,ar)):"TARGETS"!=gam.getOption("game_type")||"HOST"!=APP.device.role&&"PARTICIPANT"!=APP.device.role||(sbp.clearTargetButtons(ar),sbp.setTargetButton(ar),sbp.enableTargetButton()),eq.linkToUserInput(gam.opponent[ao].getUserInput(ar,!0)),gam.started_scoring&&("TARGETS"==gam.getOption("game_type")?gam.isDYGKeypadTarget(ar)?mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0}):mbr.displayValueFactors(eq.getUserInput(),plg.is_edit_mode,plg.is_edit_mode):mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0})),sbp.displayTurnEntry(ao,ar,eq.value(),gam.opponent[ao].getTurnColor(ar)),plg.setUserControls(),APP.game.started_scoring&&dvc.needToReleaseChalk()&&dvc.releaseChalk(!0),"101 Darts"==APP.game.getOption("dyg_name")&&33==ar&&APP.popup.show("popup-notable",'<span style="font-size:0.7em;">Last 2 Darts</span>'),hdr.refresh()},setUserControls:function(){var editing_entry,ao=APP.game.active_opponent,ar=APP.game.active_round,dvc=APP.device,first_turn=APP.game.isFirstTurnActive(),gam=APP.game,mbr=APP.message_bar,plg=APP.plugin_library,rvl=APP.reveal,sbp=APP.scoreboard_points;APP.equation.is_negating?$("#sb-p-negative-target-button").addClass("sb-p-negative-target-active"):$("#sb-p-negative-target-button").removeClass("sb-p-negative-target-active"),"TARGET SCORING"==gam.getOption("scoring_type")&&gam.getOption("negative_scoring")?sbp.enableNegativeTargetButton():sbp.disableNegativeTargetButton(),gam.getOption("special_targets")&&(gam.doesRoundHaveScores(ar)||plg.is_edit_mode?sbp.disableSpecialTargetButton():sbp.enableSpecialTargetButton()),$("#kp-p-140").hide(),$("#kp-p-100").hide(),gam.isCurrentTurnActive()?("TARGETS"==gam.getOption("game_type")?APP.device.has_chalk&&gam.isDYGKeypadTarget(ar)?rvl.hideButtonBar((function(){sbp.scrollToActiveRound()})):rvl.hideButtonBar():(rvl.hideButtonBar(),APP.device.has_chalk&&!APP.device.big_ui&&(gam.opponent[ao].hasUserInput(ar)?APP.device.disableButtonClass("keypad-p-gutter"):APP.device.enableButtonClass("keypad-p-gutter"))),gam.opponent[ao].hasUserInput(ar)?(mbr.setLeftFunc("backspace"),mbr.setRightFunc("enter")):(1==gam.opponent_count?mbr.setLeftFunc("back",first_turn&&!gam.started_scoring):mbr.setLeftFunc("back",!(first_turn&&gam.started_scoring)),mbr.setRightFunc("miss"))):(editing_entry=!gam.opponent[ao].getUserInput(ar).isEquivalent(plg.saved_entry),APP.device.has_chalk&&(APP.device.disableButtonClass("keypad-p-gutter"),rvl.showButtonBar("button-bar-ingame","Cancel Editing",(function(){sbp.scrollToActiveRound()}))),editing_entry?dvc.enableButton("bb-ig-restore"):dvc.disableButton("bb-ig-restore"),gam.opponent[ao].hasUserInput(ar)?(dvc.enableButton("bb-ig-clear"),mbr.setLeftFunc("backspace"),mbr.setRightFunc("enter")):(dvc.disableButton("bb-ig-clear"),mbr.setLeftFunc("backspace",!APP.device.has_chalk),mbr.setRightFunc("miss")))},handleUserInput:function(in_code,in_shift_key,in_remote){var btn_code,chkout,entry,i,points,len,ao=APP.game.active_opponent,ar=APP.game.active_round,eq=APP.equation,gam=APP.game,hdr=APP.header,mbr=APP.message_bar,plg=APP.plugin_library,sbp=(APP.reveal,APP.scoreboard_points);if(!gam.finished)if(in_code=""+in_code,APP.device.has_chalk||in_remote||"back"==(btn_code="funcl"==in_code.substr(in_code.lastIndexOf("-")+1)?mbr.getFunc("funcl",!0):"")&&APP.server.chalk_release_timer_id){if(BBAT.isNumeric(in_code))if(in_code>=48&&in_code<=57)in_shift_key?56==in_code&&(storeEvent(in_code,in_shift_key),eq.addOperator("x")):(storeEvent(in_code,in_shift_key),eq.addDigit(in_code-48,180));else if(in_code>=96&&in_code<=105)storeEvent(in_code,in_shift_key),eq.addDigit(in_code-96,180);else switch(parseInt(in_code)){case 8:storeEvent(in_code,in_shift_key),eq.backspace();break;case 9:case 13:return storeEvent(in_code,in_shift_key),void plg.recordEntry();case 27:return storeEvent(in_code,in_shift_key),void plg.cancelEdit();case 106:storeEvent(in_code,in_shift_key),eq.addOperator("x");break;case 107:storeEvent(in_code,in_shift_key),eq.addOperator("+");break;case 109:storeEvent(in_code,in_shift_key),eq.addOperator("-");break;case 187:if(!in_shift_key)return storeEvent(in_code,in_shift_key),void plg.recordEntry();storeEvent(in_code,in_shift_key),eq.addOperator("+");break;case 189:in_shift_key||(storeEvent(in_code,in_shift_key),eq.addOperator("-"));break;default:return}else{if(in_code.indexOf("-sk-")>=0&&(in_code=APP.keypad_points.getSpeedKeyCode(in_code)),BBAT.isNumeric(in_code)&&parseInt(in_code,10)>9){if(!in_remote&&!APP.is_reloading&&new Date-APP.plugin_library.prev_speedkey_timestamp<2e3)return;APP.plugin_library.prev_speedkey_timestamp=new Date}if("sb-p-special-target-button"==in_code)return $("#popup-overlay").show(0),void APP.popup.show("popup-target-menu");if(-1!=in_code.indexOf("ptm-")){switch(in_code){case"ptm-bull":sbp.changeDYGTarget(ar,"B",25),storeEvent(in_code);break;case"ptm-double-bull":sbp.changeDYGTarget(ar,"DB",50),storeEvent(in_code);break;case"ptm-39":sbp.changeDYGTarget(ar,"39",39),storeEvent(in_code);break;case"ptm-42":sbp.changeDYGTarget(ar,"42",42),storeEvent(in_code);break;case"ptm-double":sbp.changeDYGTarget(ar,"D",null),storeEvent(in_code);break;case"ptm-triple":sbp.changeDYGTarget(ar,"T",null),storeEvent(in_code);break;case"ptm-3b":sbp.changeDYGTarget(ar,"3B",null),storeEvent(in_code);break;case"ptm-3c":sbp.changeDYGTarget(ar,"3C",null),storeEvent(in_code);break;case"ptm-3n":sbp.changeDYGTarget(ar,"3N",null),storeEvent(in_code);break;case"ptm-x":sbp.changeDYGTarget(ar,"X",null),storeEvent(in_code);break;case"ptm-reset":sbp.resetDYGTarget(ar),storeEvent(in_code)}return APP.popup.hide("popup-target-menu"),$("#popup-overlay").hide(0),void plg.setUserControls()}if(-1!=in_code.indexOf("eog"))btn_code="eog"+in_code.substr(in_code.lastIndexOf("-"));else if("sb-p-negative-target-button"==in_code)btn_code="negate";else if("funcr"==(btn_code=in_code.substr(in_code.lastIndexOf("-")+1))?btn_code=mbr.getFunc("funcr"):"funcl"==btn_code&&(btn_code=mbr.getFunc("funcl",!0)),null==btn_code)return;if(storeEvent("btn-"+btn_code),BBAT.isNumeric(btn_code)){if("POINTS"!=gam.getOption("game_type")&&!gam.isDYGKeypadTarget(ar)&&!plg.is_edit_mode)return;if(parseInt(btn_code,10)>9){for(len=btn_code.length,i=0;i<len;i++)eq.addDigit(btn_code.substr(i,1),180);return plg.recordEntry(),void mbr.fakePrevFuncr("enter")}eq.addDigit(parseInt(btn_code,10),180)}else switch(btn_code){case"negate":eq.negate();break;case"eog-0":return APP.game.winning_opponent=0,eq.hasUserInput()&&plg.recordEntry(),void(APP.device.has_chalk&&plg.startSWD(gam.getOption("assume_3")));case"eog-1":return APP.game.winning_opponent=1,eq.hasUserInput()&&plg.recordEntry(),void(APP.device.has_chalk&&plg.startSWD(gam.getOption("assume_3")));case"cancel":plg.cancelEdit();break;case"back":if(APP.game.select_winning_dart)return void plg.cancelSWD();if(!gam.started_scoring)return void APP.newGame("DELETE");APP.server.cancelChalkRelease(),sbp.activateTurn("turn_prev"),ao=APP.game.active_opponent,ar=APP.game.active_round,gam.opponent[ao].clearTurnPoints(ar),gam.opponent[ao].clearTurnMarks(ar),gam.opponent[ao].clearTurnColor(ar);break;case"bust":return void plg.cancelSWD();case"clear":eq.reset();break;case"restore":plg.restoreEntry();break;case"backspace":eq.backspace();break;case"plus":eq.addOperator("+");break;case"minus":eq.addOperator("-");break;case"times":eq.addOperator("x");break;case"miss":return eq.addDigit(0,180),void plg.recordEntry();case"enter":return void plg.recordEntry();default:if("pb"==btn_code.left(2)){if(gam.isDYGKeypadTarget(ar))return;eq.addFactorValue(APP.game.getDYGTargetValue(ar))}}}if(ao=APP.game.active_opponent,ar=APP.game.active_round,"TARGETS"==gam.getOption("game_type")?gam.isDYGKeypadTarget(ar)?mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0}):mbr.displayValueFactors(eq.getUserInput(),plg.is_edit_mode,plg.is_edit_mode):mbr.displayEquation(eq.getUserInput(),{editing_flag:plg.is_edit_mode,show_hint:plg.is_edit_mode,show_miss:!0}),entry=eq.value(),chkout=gam.opponent[ao].getStartingScore()+gam.opponent[ao].getHandicap(),0==entry&&eq.hasUserInput()&&gam.getOption("miss_half")){for(i=0;i<=gam.current_round;i++)points=gam.opponent[ao].getTurnPoints(i),BBAT.isNumeric(points)&&i!=ar&&(chkout+=points);1==chkout?chkout=0:chkout>0&&(chkout=Math.floor(chkout/2))}else for(chkout+=entry,i=0;i<=gam.current_round;i++)points=gam.opponent[ao].getTurnPoints(i),BBAT.isNumeric(points)&&i!=ar&&(chkout+=points);hdr.refresh(),hdr.showPendingScore(ao,chkout,eq.hasUserInput()),sbp.displayTurnEntry(ao,ar,entry,plg.is_edit_mode?"":null),plg.setUserControls()}else APP.alert.show("You do not have the board.",null,!0,"Connection Notice!");function storeEvent(in_code,in_shift_key){(APP.game.started_scoring||"btn-back"!=in_code)&&APP.storeGameEvent({cmd:"KEY",cmd_data:{code:in_code,shift_key:in_shift_key}})}}},APP.session={alley_set_start:null,current_match:null,current_set:null,leagues:{},matches:[],tournament_id:null,other_game:null,auto_save:null,auto_exit:null,tournaments:null,tournament_crash_caught:!1,Match:function(in_spec){this.bracket_interface_id=in_spec.bracket_interface_id||null,this.bracket_board_id=in_spec.bracket_board_id||null,this.bracket_event_id=in_spec.bracket_event_id||null,this.bracket_match_id=in_spec.bracket_match_id||null,this.bracket_match_premature_end=in_spec.bracket_match_premature_end||null,this.event_guid=in_spec.event_guid||null,this.match_guid=in_spec.match_guid||null,this.league_id=in_spec.league_id||null,this.league_guid=in_spec.league_guid||null,this.league_division_guid=in_spec.league_division_guid||null,this.league_match_id=in_spec.league_match_id||null,this.match_format_style=in_spec.match_format_style||null,this.league_set_id=in_spec.league_set_id||null,this.league_set_number=in_spec.league_set_number||null,this.league_amb_set_scores=in_spec.league_amb_set_scores||null,this.league_practice_match=APP.nlf.rails.isPracticeMatch(),this.season_status=in_spec.season_status||null,this.season_id=in_spec.season_id||null,this.opponent_guids=in_spec.opponent_guids||[null,null],this.tournament_id=in_spec.tournament_id||null,this.broadcast_matches_start=in_spec.broadcast_matches_start||null,this.broadcast_matches_id=in_spec.broadcast_matches_id||null,this.broadcast_matches_status=in_spec.broadcast_matches_status||null,this.was_broadcasting=in_spec.was_broadcasting||!1,this.was_hosting=in_spec.was_hosting||!1,this.mode=in_spec.mode||null,this.role=in_spec.role||null,this.name=in_spec.name||"Match: "+new Date,this.name_timestamp=in_spec.name_timestamp||(new Date).valueOf(),this.start_time=in_spec.start_time||null,this.finish_time=in_spec.finish_time||null,this.title=in_spec.title||null,this.description=in_spec.description||null,this.match_points=in_spec.match_points||[null,null],this.sets=in_spec.sets||[],this.format=in_spec.format||null,this.money_round=in_spec.money_round||null,this.tiebreaker=in_spec.tiebreaker||!1,this.tournament_event_type=in_spec.tournament_event_type||null,this.suppress_recap_email=in_spec.suppress_recap_email||null,this.first_name=in_spec.first_name||(APP.user?APP.user.first_name:null),this.last_name=in_spec.last_name||(APP.user?APP.user.last_name:null),this.member_id=in_spec.member_id||(APP.user?APP.user.member_id:null),this.closed=in_spec.closed||!1,this.notes=in_spec.notes||"",this.signed_off=in_spec.signed_off||!1,this.game_count=in_spec.game_count||0,this.game_time=in_spec.game_time||0,this.rounds=in_spec.rounds||[0,0],this.game_wins=in_spec.game_wins||[0,0],this.set_wins=in_spec.set_wins||[0,0],this.points=in_spec.points||[0,0],this.point_darts=in_spec.point_darts||[0,0],this.points_style=in_spec.points_style||null,this.bonus_points=in_spec.bonus_points||null,this.bonus_points_win=in_spec.bonus_points_win||null,this.bonus_points_sweep=in_spec.bonus_points_sweep||null,this.sweep_requirement=in_spec.sweep_requirement||null,this.high_points_turn=in_spec.high_points_turn||[],this.high_points_in=in_spec.high_points_in||[],this.high_points_out=in_spec.high_points_out||[],this.marks=in_spec.marks||[0,0],this.mark_darts=in_spec.mark_darts||[0,0],this.high_marks_turn=in_spec.high_marks_turn||[],this.high_bull_turn=in_spec.high_bull_turn||[],this.high_marks_in=in_spec.high_marks_in||[],this.high_marks_out=in_spec.high_marks_out||[],this.games_analysis=in_spec.games_analysis||[],this.manual_notes=in_spec.manual_notes||!1,this.error_legs=in_spec.error_legs||[],this.lobby_data=in_spec.lobby_data||null,this.leg_score_edits=in_spec.leg_score_edits||[],this.guest_team_guid=in_spec.guest_team_guid||null,this.is_bot_match=in_spec.is_bot_match||!1,this.adv_logging=in_spec.adv_logging||[],this.fast_forwarded=in_spec.fast_forwarded||!1},Best:function(in_spec){this.opponent_index=in_spec.opponent_index,this.player_chalkboard_name=in_spec.player_chalkboard_name,this.value=in_spec.value},Game_Analysis:function(in_spec){this.game_name=in_spec.game_name,this.player_count=in_spec.player_count,this.threeda_0=in_spec.threeda_0,this.threeda_1=in_spec.threeda_1,this.games_best=in_spec.games_best},Set:function(in_teams,in_chalkboard_names,in_points_style,in_points){this.chalkboard_names=in_chalkboard_names,this.game_results=[],this.games=[],this.points=in_points,this.points_style=in_points_style,this.teams=[],this.teams[0]=APP.game.cloneTeam(in_teams[0]),this.teams[1]=APP.game.cloneTeam(in_teams[1]),this.wins=[0,0],this.set_id=null,this.set_number=null,this.league_points=null},GameResult:function(in_spec){this.start_time=in_spec.start_time,this.ending_scores=in_spec.ending_scores,this.rounds_played=in_spec.rounds_played,this.game_name=in_spec.game_name,this.game_type=in_spec.game_type,this.starting_opponent=in_spec.starting_opponent,this.starting_scores=in_spec.starting_scores,this.three_da=in_spec.three_da,this.winning_opponent=in_spec.winning_opponent,this.notes=in_spec.notes||null},store:function(in_match_index){var len,i,sess=APP.session,obj={};if("HOST"==APP.device.role){if(!0===in_match_index)for(len=sess.matches.length,i=0;i<len;i++)obj["matches_"+i]=sess.matches[i];else obj["matches_"+in_match_index]=sess.matches[in_match_index];BBAT.storeData(obj)}},fetch:function(in_override){var i,m,obj,sess=APP.session;if(in_override||"PARTICIPANT"!=APP.device.role){for(i=0,(m=APP.session.matches).length=0,obj=BBAT.fetchData("matches_"+i);null!=obj;)m.push(new APP.session.Match(obj)),obj=BBAT.fetchData("matches_"+ ++i);sess.matches.length>0?(sess.current_match=sess.matches.length-1,sess.current_set=0==sess.matches[sess.current_match].sets.length?null:sess.matches[sess.current_match].sets.length-1):(sess.current_match=null,sess.current_set=null)}},cleanUpClosedMatches:function(){var i,len,match_count,sess=APP.session,obj={};match_count=sess.matches.length;var keep_list=[];for(i=0;i<match_count;i++)sess.matches[i].closed||keep_list.push(i);if(BBAT.storeData({match_cleanup:!0}),(len=keep_list.length)>0){for(i=0;i<len;i++)obj["matches_"+i]=sess.matches[keep_list[i]];BBAT.storeData(obj)}for(i=len;i<match_count;i++)BBAT.flushData("matches_"+i);for(BBAT.flushData("match_cleanup"),sess.fetch(!0),len=sess.matches.length,i=0;i<len-1;i++)sess.matches[i].signed_off=!0,sess.store(i)},init:function(){var sess=APP.session;sess.fetch(!0),sess.bracket=BBAT.fetchData("bracket"),sess.bracket&&(sess.tournament_id=sess.bracket.tournament_id),0!=sess.matches.length&&sess.cleanUpClosedMatches(),sess.tournaments=BBAT.fetchData("tournaments")||{},APP.device.addFieldHandler(["lgs-custom-hint"],APP.session.handleGameSelector),APP.device.addButtonHandler(["plm-close","plm-singles","plm-team","plm-refresh"],sess.handleLeagueMenu),APP.device.addButtonHandler(["psm-close","psm-game-play","psm-solo-practice","psm-match-play","psm-league"],sess.handleMatchMenu),APP.device.addButtonHandler(["pss-close","pss-score","pss-exit","psd-close"],sess.handleSummaryOption),APP.device.addButtonHandler(["bs-opponent-0","bs-opponent-1","bs-random","bs-coin-toss","bs-skip-cork","bs-set-format","bs-reset","bs-game-info","bs-event-type","bs-money","bs-points-format"],sess.handleBullShoot),APP.device.addButtonHandler(["pdl-close","pdl-retry-sync"],sess.handleDeviceLog),APP.device.addButtonHandler(["pms-info","pms-close","pms-confirm","pms-continue","pms-save","pms-notes"],sess.handleMatchScore),APP.device.addButtonHandler(["mom-info","mom-close","mom-reset","mom-state","mom-reset-description","mom-save-temp","mom-use-temp","mom-preview","mom-continue"],sess.handleMatchOptions),APP.device.addButtonHandler(["fm-info","fm-close","fm-opponent-0","fm-opponent-1","fm-opponent-b","fm-forfeit","fm-setwin","fm-notes","fm-continue"],sess.handleForfeit),APP.device.addButtonHandler(["lgs-demo-player","lgs-demo-dartconnect"],sess.handleDemoOpponent),APP.device.addButtonHandler(["mfc-change","mfc-continue"],sess.handleMatchFormatConfirm),APP.device.addButtonHandler(["ptl-close","ptl-refresh"],sess.handleTournamentListing),APP.device.addButtonHandler(["pbml-change","pbml-refresh","pbml-practice","pbml-official","pbml-close","pbmc-play","pbmc-play-in-person","pbmc-play-online","pbmc-play-online-btn","pbmc-change","pbmc-other","pbmo-disqualify-0","pbmo-forfeit-0","pbmo-disqualify-1","pbmo-forfeit-1","pbmo-disqualify-both","pbmo-forfeit-both","pbmo-cancel","pbml-round-robin"],sess.handleBracketMatchListing),APP.device.addButtonHandler(["pbel-close","pcem-refresh"],sess.handleBracketEventListing),APP.device.addButtonHandler(["pcem-close"],sess.hideCreateEventMatch),APP.device.addButtonHandler(["pbrr-close"],sess.handleBracketRoundRobinEventListing)},setUpTournamentDefaults:function(in_cold_start){var cm,t,mm,mbr=APP.message_bar,sess=APP.session,tm=(uo=APP.user_options).tournament_leg_mode,stm=uo.tournament_set_mode,stl=uo.tournament_set_limit,sg=uo.tournament_same_game,sl=uo.tournament_same_legs,tc=uo.tournament_next_game,to=uo.tournament_next_game_options,legs=null,sets=null,t_id=sess.tournament_id||sess.getTournamentID();if(t=sess.tournaments[t_id]){if(mm=sess.getMatchMode(),(cm=sess.matches[sess.current_match]).description||(cm.description=t.match_description),sess.isBracketMatch()&&!APP.header.players_checked_in){var key,b=sess.bracket;for(key in uo.big_ui=!1,uo.cricket_cues=!1,uo.do_attempts=!1,uo.fast_finish_flights=!1,uo.game_shot=!1,uo.intros=!1,uo.notables=!1,uo.pro_speed_keys=!1,uo.speed_keys=0,uo.remote_score_update=!1,uo.running_3da=!1,uo.running_1da=!1,uo.suggested_out_left=!1,uo.suggested_out_numeric=!1,uo.suggested_out_right=!1,uo.suggested_out_standard=!1,uo.auto_balance=!1,b.user_options)uo[key]=b.user_options[key];APP.storeUserOptions()}else if(in_cold_start){var uo;(uo=APP.user_options).hints_01=!1,uo.cricket_cues=!1,uo.fast_finish_flights=!0,uo.do_attempts=!1,uo.notables=!1,uo.pro_speed_keys=!0,uo.running_3da=!1,uo.running_1da=!1,uo.suggested_out_left=!1,uo.suggested_out_numeric=!1,uo.suggested_out_right=!1,uo.suggested_out_standard=!1,uo.auto_balance=!1,APP.storeUserOptions()}APP.header.players_checked_in||("TOURNAMENT"==mm&&(APP.user.tx||APP.user.pa&&"Y"==t.reset_match_format)?(sets={mode:"PLAY-ALL",limit:1},sess.setMatchFormat({legs:legs,sets:sets,next_game:null,next_game_options:null,same_game:null,same_legs:null,points_style:null,points:1}),APP.storeState({settings_change:!0})):sess.getMatchFormat()||(tm&&(legs={mode:tm}),sets=stm?{mode:stm,limit:stl}:{mode:"PLAY-ALL",limit:1},sess.setMatchFormat({legs:legs,sets:sets,next_game:tc,next_game_options:to,same_game:sg,same_legs:sl,points_style:null,points:1}),APP.storeState({settings_change:!0}))),sess.store(sess.current_match),mbr.promo.line_1=t.promo_line_1,mbr.promo.line_2=t.promo_line_2,mbr.promo.line_3=t.promo_line_3,mbr.promo.active=!0}},setupLeagueDefaults:function(){var cm,l,mbr=APP.message_bar,sess=APP.session,lkey=sess.getMatchLeagueKey()||{};if(lkey.league_id){if(cm=sess.matches[sess.current_match],lkey.league_division_guid&&lkey.season_status){if(!(l=sess.getLeagueDefinition(lkey)).league_division_guid)return;cm.description||(cm.description=l.longname,sess.store(sess.current_match)),mbr.promo.line_1=l.shortname,mbr.promo.line_2=l.longname,mbr.promo.line_3=""}else{if(!(l=sess.leagues[lkey.league_id.toUpperCase()]))return;cm.description||(cm.description=l.description,sess.store(sess.current_match));var lid=lkey.league_id.toUpperCase();mbr.promo.line_1="PDSL"==lid?"DNSL":lid,mbr.promo.line_2=l.description,mbr.promo.line_3=""}mbr.promo.active=!0,BBAT.storeData({promo:mbr.promo})}},getLeagueMatchInfo:function(){try{var currentLeague=APP.session.getCurrentLeague();if(!currentLeague)return{league_id:null,season_id:null,league_match_id:null,division_id:null,season_status:null,amb_set_score_0:0,amb_set_score_1:1};var leagueId=currentLeague.league_id,seasonId=currentLeague.season_id,divisionId=currentLeague.league_division_guid,leagueMatchId=APP.getMatch().league_match_id,season_status=null,amb_set_score_0=0,amb_set_score_1=0;if(APP.nlf.data.rails){var matchData=APP.nlf.rails.getRailsMatchData();matchData&&(amb_set_score_0=matchData.home_match_points,amb_set_score_1=matchData.away_match_points,APP.nlf.data.league&&(season_status=APP.nlf.data.league.season_status))}return leagueId&&seasonId&&divisionId?{league_id:leagueId,season_id:seasonId,league_match_id:leagueMatchId,division_id:divisionId,season_status:season_status,amb_set_score_0:amb_set_score_0,amb_set_score_1:amb_set_score_1}:{league_id:null,season_id:null,league_match_id:null,division_id:null,season_status:null,amb_set_score_0:0,amb_set_score_1:1}}catch(e){return{league_id:null,season_id:null,league_match_id:null,division_id:null,season_status:null,amb_set_score_0:null,amb_set_score_1:null}}},getLeagueMatchScore:function(){var currentLeague=APP.session.getCurrentLeague();if(!currentLeague)return!1;if(currentLeague.match_settings&&currentLeague.match_settings.points_style){var pointsStyle=currentLeague.match_settings.points_style,match=APP.getMatch();if(!match)return!1;var setWins,sets,legWins,points,i,scoreObj={home_match_points:0,away_match_points:0};switch(pointsStyle){case"PER-SET":return!!(setWins=match.set_wins)&&(scoreObj.home_match_points=setWins[0],scoreObj.away_match_points=setWins[1],scoreObj);case"PER-LEG":return!!(legWins=match.game_wins)&&(scoreObj.home_match_points=legWins[0],scoreObj.away_match_points=legWins[1],scoreObj);case"PER-SET-PLAYER":if(setWins=match.set_wins,sets=match.sets,!setWins)return!1;if(!sets)return!1;var setsCompleted=setWins[0]+setWins[1];for(i=0;i<setsCompleted;i++){if(set=sets[i])if((setScore=set.wins)&&setScore[0]!==setScore[1]){var winner=0;setScore[1]>setScore[0]&&(winner=1);var teamSize=0;set.teams[0].players.length>teamSize&&(teamSize=set.teams[0].players.length),set.teams[1].players.length>teamSize&&(teamSize=set.teams[1].players.length),teamSize||(teamSize=1),winner?scoreObj.away_match_points+=teamSize:scoreObj.home_match_points+=teamSize}}return scoreObj;case"VARIES":if(setWins=match.set_wins,sets=match.sets,!setWins)return!1;if(!sets)return!1;setsCompleted=setWins[0]+setWins[1];for(i=0;i<setsCompleted;i++){var set,setScore;if(set=sets[i])if((setScore=set.wins)&&setScore[0]!==setScore[1]){winner=0;setScore[1]>setScore[0]&&(winner=1),points=set.points,winner?scoreObj.away_match_points+=points:scoreObj.home_match_points+=points}}return scoreObj;case"SUPRESS":default:return!1}}return!1},getLeagueLobbyMatchInfo:function(){if(!APP.lobby.data.activeLeague)return{};if(!APP.lobby.data.isInMatch)return{};var activeLeague=APP.lobby.data.activeLeague;if(!activeLeague)return{};var playerGuidArr=APP.session.getPlayerGuids();if(!playerGuidArr)return{};try{return{league_id:activeLeague.league_id,season_id:activeLeague.season_id,home_player_guid:playerGuidArr[0],away_player_guid:playerGuidArr[1]}}catch(e){return{}}},getPlayerGuids:function(){try{for(var playerGuidArr=[],teams=APP.getGame().teams,i=0;i<teams.length;i++)for(var players=teams[i].players,j=0;j<players.length;j++){var player=players[j];playerGuidArr.push(parseFloat(player.player_guid))}return 2==playerGuidArr.length&&playerGuidArr}catch(e){return!1}},needsSignOff:function(in_match){return!in_match.signed_off},startAutoSave:function(){var sess=APP.session;$("#seo-set-control").addClass("seo-cancel-save").html("Cancel Save").data("data-cancel-save",!0);var timer=120;if(APP.lobby.isLobbyMatch()){timer=180,$("#seo-set-control").hide();$("#seo-sb-edit-points").after('\n\t\t\t\t<div id="seo-sb-rematch" class="seo-chalk-button seo-eom-button button button-menu button-gold round-corners">\n\t\t\t\t\tRequest Rematch\n\t\t\t\t</div>\n\t\t\t'),$("#seo-sb-edit-points").remove()}$("#seo-auto-save-message").show(0),sess.auto_save={seconds:timer,timer:setInterval(sess.countdownAutoSave,1e3)},sess.countdownAutoSave(),APP.lobby.isLobbyMatch()&&APP.fns.activateBtn("seo-sb-rematch",(function(){APP.lobby.offerRematch()}))},countdownAutoSave:function(){var sess=APP.session,as=sess.auto_save;if(as){var msg="Match will be saved in ";if(APP.nlf.data.rails)msg="Match will continue in ";if(30==as.seconds&&($("#set-control-wrapper").show(),$("#seo-auto-save-message").show()),as.seconds>0)$("#seo-auto-save-message").html(msg+as.seconds),as.seconds--;else{if(APP.nlf.data.rails)return APP.device.showSpinnerOverlay(),APP.nlf.rails.isForfeit||APP.nlf.rails.saveCompleteLocal(),void APP.nlf.rails.exitSet();sess.stopAutoSave(),APP.handleEOGMenuOption("seo-sb-match-end")}}else sess.stopAutoSave()},stopAutoSave:function(){var sess=APP.session;sess.auto_save&&(clearInterval(sess.auto_save.timer),sess.auto_save=null,$("#seo-set-control").removeClass("seo-cancel-save").html("Back")),$("#seo-auto-save-message").hide(0)},getLegsCount:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.game_count:0},hasLegBeenPlayed:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match]).sets.length>1||cm.game_count>0},getCurrentSetLegsPlayed:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.sets[sess.current_set].game_results.length:0},getCurrentSetsPlayed:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.sets.length-1:0},showMatchOptionsMenu:function(){var cm,sess=APP.session,p=APP.message_bar.promo;APP.device.pauseKeyboardHandler(),$("#match-options-menu").on("keydown",(function(e){if(27==e.which)return BBAT.killDOMEvent(e),sess.handleMatchOptions("mom-close"),!1})),$("#match-options-menu").on("keyup",(function(e){sess.enableActivate($("#pe-line-1").val()||$("#pe-line-2").val()||$("#pe-line-3").val())})),cm=sess.matches[sess.current_match],$("#mom-description").val(cm.description);var temp=BBAT.fetchData("match_description_template")||"";function fixStr(in_str){return in_str?in_str.replace(/<br \/>/g,"\n"):""}$("#mom-description-template").text(temp),$("#pe-line-1").val(fixStr(p.line_1)),$("#pe-line-2").val(fixStr(p.line_2)),$("#pe-line-3").val(fixStr(p.line_3)),p.active?$("#mom-state").addClass("button-mom-option-on"):$("#mom-state").removeClass("button-mom-option-on"),sess.enableActivate(p.line_1||p.line_2||p.line_3),APP.popup.show("match-options-menu")},enableActivate:function(in_true){in_true?(APP.device.enableButton("mom-state"),APP.device.enableButton("mom-preview")):(APP.device.disableButton("mom-state"),APP.device.disableButton("mom-preview"),$("#mom-state").removeClass("button-mom-option-on"))},handleMatchOptions:function(in_id){var sess=APP.session,p=APP.message_bar.promo;function closeMenu(){hideKeyboard(),APP.popup.hide(),$("#mom-description").val(""),APP.device.resumeKeyboardHandler()}function fixStr(in_str){return in_str.trim().replace(/\n/g,"<br />")}function hideKeyboard(){$("#pe-line-1").blur(),$("#pe-line-2").blur(),$("#pe-line-3").blur(),$("#mom-description").blur()}switch(in_id){case"mom-info":APP.info.show("info-text-match-options","Match Options");break;case"mom-continue":sess.matches[sess.current_match].description=$("#mom-description").val().trim(),sess.store(sess.current_match),p.line_1=fixStr($("#pe-line-1").val()),p.line_2=fixStr($("#pe-line-2").val()),p.line_3=fixStr($("#pe-line-3").val()),p.active=$("#mom-state").hasClass("button-mom-option-on"),BBAT.storeData({promo:p}),BBAT.storeData({match_description_template:$("#mom-description-template").text()}),closeMenu(),APP.device.is_broadcasting&&APP.message_bar.promo.active&&APP.session.isNewMatch()&&APP.message_bar.showPromo(null,null,null,!1,!0);break;case"mom-reset-description":hideKeyboard(),$("#mom-description").val("");break;case"mom-use-temp":$("#mom-description").val($("#mom-description-template").text());break;case"mom-save-temp":$("#mom-description-template").text($("#mom-description").val().trim());break;case"mom-reset":hideKeyboard(),$("#pe-line-1").val(""),$("#pe-line-2").val(""),$("#pe-line-3").val(""),sess.enableActivate(!1);break;case"mom-state":hideKeyboard(),$("#mom-state").toggleClass("button-mom-option-on");break;case"mom-preview":hideKeyboard(),APP.message_bar.showPromo(fixStr($("#pe-line-1").val()),fixStr($("#pe-line-2").val()),fixStr($("#pe-line-3").val()),!0);break;case"mom-close":closeMenu()}},packageMatchSummary:function(){var obj,cm,cs,cs_len,i,set,cgr,cgr_len,j,game_result,sess=APP.session;if(cm=sess.matches[sess.current_match]){for(obj={league_division_guid:cm.league_division_guid,event_guid:cm.event_guid,match_guid:cm.match_guid,mode:cm.mode,format:cm.format,start_time:new Date(cm.start_time),title:cm.title,match_points:cm.match_points.slice(0),points:cm.points.slice(0),point_darts:cm.point_darts.slice(0),marks:cm.marks.slice(0),mark_darts:cm.mark_darts.slice(0),sets:[],game_wins:cm.game_wins.slice(0),set_wins:cm.set_wins.slice(0),high_points_turn:cm.high_points_turn.slice(0),high_points_in:cm.high_points_in.slice(0),high_points_out:cm.high_points_out.slice(0),high_marks_turn:cm.high_marks_turn.slice(0),high_bull_turn:cm.high_bull_turn.slice(0),high_marks_in:cm.high_marks_in.slice(0),high_marks_out:cm.high_marks_out.slice(0)},cs_len=cm.sets.length,i=0;i<cs_len;i++){for(set={points:(cs=cm.sets[i]).points,chalkboard_names:cs.chalkboard_names.slice(0),forfeited:cs.forfeited||!1,forfeit_time:cs.forfeit_time||null,forfeit_type:cs.forfeit_type||null,forfeit_players:cs.forfeit_players?$.extend(cs.forfeit_players,[]):null,wins:cs.wins.slice(0),games:[],game_results:[],set_id:cs.set_id,set_number:cs.set_number,league_points:cs.league_points},cgr_len=cs.game_results.length,j=0;j<cgr_len;j++)set.games.push({start_time:cs.games[j].start_time,elapsed_time:cs.games[j].elapsed_time}),game_result={start_time:(cgr=cs.game_results[j]).start_time,game_name:cgr.game_name,game_type:cgr.game_type,starting_opponent:cgr.starting_opponent,starting_scores:cgr.starting_scores.slice(0),winning_opponent:cgr.winning_opponent,ending_scores:cgr.ending_scores.slice(0),rounds_played:cgr.rounds_played,three_da:cgr.three_da.slice(0)},set.game_results.push(game_result);obj.sets.push(set)}return obj}obj={league_division_guid:null,event_guid:null,match_guid:null,mode:null,format:{},start_time:null,title:null,match_points:[],points:[],point_darts:[],marks:[],mark_darts:[],sets:[],game_wins:[],set_wins:[],high_points_turn:[],high_points_in:[],high_points_out:[],high_marks_turn:[],high_bull_turn:[],high_marks_in:[],high_marks_out:[]}},loadMatchSummary:function(in_params){var sess=APP.session,mf=sess.getMatchFormat();sess.matches.length=0,sess.matches[0]=in_params.payload,in_params.retain_current_format&&sess.setMatchFormat(mf),sess.current_match=0,sess.current_set=0==sess.matches[sess.current_match].sets.length?null:sess.matches[sess.current_match].sets.length-1,APP.header.opponent_type="TEAM"==sess.getMatchMode()?"TEAM":"PLAYER"},handleBullShoot:function(in_id){var oppo_index,cork_credit,mf=APP.session.getMatchFormat()||{},is_random=APP.session.isNewMatch()&&mf.next_game_options&&mf.next_game_options.random_start;switch(in_id){case"bs-coin-toss":return void APP.popup.show("popup-notable",new Date%2==0?"Heads!":"Tails!");case"bs-event-type":return void setTimeout((function(){APP.header.showTournamentEventType()}),5);case"bs-reset":return void setTimeout((function(){APP.session.resetMatch()}),5);case"bs-game-info":return void setTimeout((function(){APP.game.name&&APP.reveal.handleButtons("reveal-back")}),5);case"bs-money":case"bs-points-format":case"bs-set-format":case"bs-set-format":return APP.header.has_seen_legs_menu=!1,void setTimeout((function(){APP.header.showSetSetup({callback:function(){$("#bs-set-format").html(APP.session.getMatchFormatSummary(!0))}})}),5);case"bs-skip-cork":return void setTimeout((function(){APP.reveal.handleButtons("reveal-back")}),5);case"bs-opponent-0":if(!APP.header.areValidOpponentsSelected())return void APP.alert.show('Specific opponents are required...<br>please "Select Players"');cork_credit=!is_random,oppo_index=0;break;case"bs-opponent-1":if(!APP.header.areValidOpponentsSelected())return void APP.alert.show('Specific opponents are required...<br>please "Select Players"');cork_credit=!is_random,oppo_index=1;break;case"bs-random":if(!APP.header.areValidOpponentsSelected())return void APP.alert.show('Specific opponents are required...<br>please "Select Players"');cork_credit=!1,oppo_index=new Date%2}try{APP.nlf.data.rails&&APP.nlf.rails.isAlternateSets()&&(APP.nlf.rails.getAlternateSets()||APP.nlf.rails.setAlternateSets(oppo_index))}catch(e){}if(APP.game.name){if(APP.game.shooting_for_bull&&APP.game.setBullShootWinner(oppo_index,cork_credit),APP.lobby.data.activeLeague&&APP.lobby.isChallengeLeagueFormat()){var legsSet=!0;(mf=APP.session.getMatchFormat())&&mf.legs&&mf.legs.limit||(legsSet=!1),legsSet||APP.header.showSetSetup()}APP.session.hideBullShoot(),APP.game.plugin.handleGameOption("gsp-opponent-"+oppo_index),window.setTimeout((function(){APP.showMessagingIntro()}),1e3)}else APP.session.showGameSelector(),APP.game.setBullShootWinner(oppo_index,cork_credit),APP.session.hideBullShoot(),APP.game_selector.refreshGamePanel()},isSameGameAgain:function(in_is_set_done_override){var mf=APP.session.getMatchFormat()||{};if(!0===mf.same_game)return!0;switch(mf.same_game){case"PER-LEG":return!1;case"PER-SET":return!in_is_set_done_override&&!APP.session.isNewSet()&&!APP.session.isSetDone();case"PER-MATCH":return!0}},getLastSetWinner:function(){try{var sets=APP.getMatch().sets,result=sets[sets.length-2].wins;return result[0]!==result[1]?result[0]>result[1]?0:1:-1}catch(e){return-1}},updateLegFormat:function(){APP.session.getMatchFormat();if($("#bs-set-format").html(APP.session.getMatchFormatSummary(!0)).show(0),$("#bs-game-info").html(APP.game.name?APP.game.getGameName(!0):"Game Menu").show(0),APP.session.isLeaguePlay()&&(APP.session.currentLeagueIsGroup()||$("#bs-points-format").html(function(in_style,in_points){var pts;switch(in_style){case"VARIES":switch(in_points){case.25:pts="1/4 point";break;case.5:pts="1/2 point";break;case 1:pts="1 point";break;default:pts=in_points+" points"}return pts+" per Set";case"PER-LEG":return"1 point per Leg";case"SUPPRESS":return"Manual League Points";case"MATCH_WINS_1_WIN_.5_TIE":case"MATCH_WINS_2_WIN_1_TIE":case"MATCH_WINS_3_WIN_1_TIE":return"Premier Points";case"PER-SET-PLAYER":return"Team Size Points";default:return"1 point per Set"}}(APP.session.getSetPointsStyle(),APP.session.getSetPoints())).show(0)),"TOURNAMENT"==APP.session.getMatchMode())if(APP.session.isBracketMatch())APP.session.setBracketBSButtons();else{var mr=APP.session.getMatchMoney();mr&&$("#bs-money").html(APP.header.getMoneyText(mr)).show(0),$("#bs-event-type").html(APP.header.getTournamentEventTypeText(APP.session.getTournamentEventType())).show(0),APP.session.isNewMatch()?$("#bs-reset").show(0):$("#bs-reset").hide(0)}},showBullShoot:function(){var gam=APP.game,mf=APP.session.getMatchFormat()||{},mm=APP.session.getMatchMode();if($(".bs-button").hide(0),$("#bs-reset").hide(0),APP.session.updateLegFormat(),APP.device.has_chalk){if("TEAM"==APP.session.getMatchMode()&&!gam.opponent[0].team.is_default&&gam.opponent[0].team.players.length>0?$("#bs-opponent-name-0").html(gam.opponent[0].getTeamPlayerNames()):($("#bs-opponent-name-0").html(gam.opponent[0].getStartButtonName()),$("#bs-opponent-players-0").html("").removeClass("text-gray")),"TEAM"==APP.session.getMatchMode()&&!gam.opponent[1].team.is_default&&gam.opponent[1].team.players.length>0?$("#bs-opponent-name-1").html(gam.opponent[1].getTeamPlayerNames()):($("#bs-opponent-name-1").html(gam.opponent[1].getStartButtonName()),$("#bs-opponent-players-1").html("").removeClass("text-gray")),$("#bs-chalker").empty(),APP.session.isBracketMatch()){var chalker=APP.session.getFromMatch("marker_label");if(chalker){var chalkerContent=`\n\t\t\t\t\t\t<div id="bs-chalker-name" class="highlight-box secondary">\n\t\t\t\t\t\t\tScorekeeper: <span class="text-gold">${chalker}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;$("#bs-chalker").append(chalkerContent)}}var isTeams=!1;try{(APP.game.opponent[0].getPlayers().length>1||APP.game.opponent[1].getPlayers().length>1)&&(isTeams=!0)}catch(e){}APP.session.isNewMatch()&&mf.next_game_options&&mf.next_game_options.random_start?$("#bs-title").html("Random Start"):APP.session.isNewMatch()&&mf.next_game_options&&mf.next_game_options.cork_first||APP.game.shooting_for_bull?isTeams?$("#bs-title").html("Select starting Team").css("font-size","1em"):$("#bs-title").html("Select Starting Player").css("font-size","1em"):$("#bs-title").html("Select to Start");var override=APP.zanis.masterCheck("Player Select Screen");if(override)switch(override){case"CORK":isTeams?$("#bs-title").html("Select starting Team").css("font-size","1em"):$("#bs-title").html("Select Starting Player").css("font-size","1em");break;case"RANDOM":$("#bs-title").html("Random Start");break;case"PLAYER":$("#bs-title").html("Select to Start")}APP.session.isLeaguePlay()&&(0!=APP.game.opponent[0].team.players.length&&(APP.game.opponent[0].team.players[0].is_default||APP.game.opponent[0].team.players[0].is_bot)||$("#bs-opponent-name-0").html('<div style="font-size:0.7em;">Home</div>'+$("#bs-opponent-name-0").html()),0!=APP.game.opponent[1].team.players.length&&(APP.game.opponent[1].team.players[0].is_default||APP.game.opponent[1].team.players[0].is_bot)||$("#bs-opponent-name-1").html('<div style="font-size:0.7em;">Away</div>'+$("#bs-opponent-name-1").html())),APP.popup.show("bull-shoot"),APP.game.name&&APP.reveal.setBackButton("BACK"),!APP.device.has_chalk||!APP.header.players_checked_in||APP.session.isNewMatch()||!APP.session.isNewSet()||"VARIES"!=mf.points_style&&mf.same_legs&&mf.legs&&mf.legs.limit?APP.session.updateLegFormat():APP.session.isSameGameAgain()?APP.header.showSetSetup({callback:APP.session.updateLegFormat}):"GAME"!=mm&&"MATCH"!=mm||APP.header.has_seen_legs_menu||mf.legs&&null!=mf.legs.limit||APP.header.showSetSetup({callback:APP.session.updateLegFormat}),!APP.session.isBracketMatch()&&APP.session.isNewMatch()&&"TOURNAMENT"==APP.session.getMatchMode()&&!APP.session.getTournamentEventType()&&APP.header.players_checked_in&&("Group"===!APP.session.getTournamentType()?APP.header.showTournamentEventType():APP.header.handleTournamentEventType("pet-tm"))}if("SOLO"==APP.session.getMatchMode()&&(APP.device.disableButton("bs-opponent-1"),APP.device.disableButton("bs-coin-toss"),APP.device.disableButton("bs-random"),APP.device.disableButton("bs-skip-cork")),APP.session.isBracketMatch()&&APP.session.setBracketBSButtons(),APP.nlf.data.rails){if(0==APP.session.getLegsCount()){var starter=APP.nlf.rails.getInitialStarter();if(-1!==starter)return APP.mode&&"IN-GAME"!=APP.mode&&$("#bull-shoot").addClass("shield"),void window.setTimeout((function(){APP.mode&&"IN-GAME"!=APP.mode&&(APP.session.handleBullShoot("bs-opponent-"+starter),$("#bull-shoot").removeClass("shield"))}),100)}APP.nlf.rails.injections.bullshoot()}},hideBullShoot:function(){APP.popup.hide("bull-shoot")},getGamesPendingSyncCount:function(){var ms,ms_len,i,ss,ss_len,j,gs,gs_len,k,match,count=0;for(ms_len=(ms=APP.session.matches).length,i=0;i<ms_len;i++)if("HOST"==(match=ms[i]).role&&!match.closed)for(ss_len=(ss=match.sets).length,j=0;j<ss_len;j++)for(ss[j].forfeited&&!ss[j].forfeit_recorded&&count++,gs_len=(gs=ss[j].games).length,k=0;k<gs_len;k++)null==gs[k].game_guid&&count++;return count},resetStuckGames:function(){for(var ms=APP.session.matches,i=0;i<ms.length;i++)for(var sets=ms[i].sets,j=0;j<sets.length;j++)for(var games=sets[j].games,k=0;k<games.length;k++){var game=games[k];-1===game.game_guid&&(game.game_guid=null)}},checkStuckGames:function(match){for(var isStuck=!1,sets=(APP.session.matches,match.sets),j=0;j<sets.length;j++)for(var games=sets[j].games,k=0;k<games.length;k++){-1===games[k].game_guid&&(isStuck=!0)}return isStuck},getMatchesPendingCloseCount:function(){var ms,ms_len,i,count=0;for(ms_len=(ms=APP.session.matches).length,i=0;i<ms_len;i++)ms[i].signed_off&&!ms[i].closed&&count++;return count},isGameSelectorShowing:function(){return"none"!=$("#league-game-selector").css("display")},hasAutoForwardedSingleGame:!1,getGameSelector:function(){var sess=APP.session,game_defs=[],standardDefaults=[{type:"01",label:"301 DIDO",starting_score:301,double_in:!0,double_out:!0},{type:"01",label:"501 SIDO",starting_score:501,double_out:!0},{type:"Cricket",label:"Cricket"},{type:"Other",label:"Other"}];try{var ld=sess.getMatchLeagueKey()||{},t_id=sess.tournament_id||sess.getTournamentID();if(sess.isBracketMatch()&&!sess.isBracketPracticeMatch()){var eventsMenu,t=sess.tournaments[t_id],bei=sess.getBracketEventId();try{if(t&&(eventsMenu=t.events?t.events[bei].game_menu:sess.bracket.events[bei].game_menu),!eventsMenu)eventsMenu=sess.bracket.events[sess.getBracketEventId()].game_menu}catch(e){}return game_defs=eventsMenu||standardDefaults}if(ld.league_division_guid){game_defs=APP.getAssociatedLeagueSeason(ld.league_division_guid).game_menu||[];try{game_defs[0]||APP.nlf.data.rails&&APP.nlf.data.railsChapter&&APP.nlf.data.railsChapter.game_menu&&(game_defs=APP.nlf.data.railsChapter.game_menu)}catch(e){}return game_defs[0]||(game_defs=standardDefaults),game_defs}if(ld.league_id&&sess.leagues[ld.league_id.toUpperCase()]){var league=sess.leagues[ld.league_id.toUpperCase()];ld.league_id.toUpperCase();return(game_defs=league.games)[0]||(game_defs=standardDefaults),game_defs}if(sess.lgs_list)game_defs=sess.lgs_list;else{if(APP.quickplay.customGameMenu.length)return APP.quickplay.customGameMenu;switch(APP.user.member_level){case"B":case"P":case"S":case"G":game_defs=standardDefaults;break;case"D":(game_defs=standardDefaults).pop()}}return game_defs}catch(e){}return standardDefaults},setGameSelectorTitle:function(){var sess=APP.session;try{var ld=sess.getMatchLeagueKey()||{},t_id=sess.tournament_id||sess.getTournamentID();if(sess.isBracketMatch()&&!sess.isBracketPracticeMatch()){var t=sess.tournaments[t_id];return void(t?$("#lgs-league-abbrev").html(t.menu_title):$("#lgs-league-abbrev").html("DartConnect"))}if(ld.league_division_guid){var als=APP.getAssociatedLeagueSeason(ld.league_division_guid);return void $("#lgs-league-abbrev").html(als.shortname)}if(ld.league_id&&sess.leagues[ld.league_id.toUpperCase()]){sess.leagues[ld.league_id.toUpperCase()];var id=ld.league_id.toUpperCase();$("#lgs-league-abbrev").html("PDSL"==id?"DNSL":id)}switch(APP.user.member_level){case"B":case"P":case"S":case"G":var t_def=sess.tournaments[sess.getTournamentID()];return void(t_def?$("#lgs-league-abbrev").html(t_def.menu_title):$("#lgs-league-abbrev").html("DartConnect"));case"D":return void $("#lgs-league-abbrev").html("Try DartConnect!")}}catch(e){}$("#lgs-league-abbrev").html("DartConnect")},showGameSelector:function(no_animate){var i,id,gc,len,lbl,extLbl,list,gamex,sess=APP.session,other_game=BBAT.fetchData("other_game");sess.getMatchFormat();if(!APP.game.name){$(".lgs-choice").remove(),$("#lgs-custom-hint").hide(),sess.setGameSelectorTitle(),sess.isBracketMatch()&&!sess.isBracketPracticeMatch()&&(APP.session.getBracketBoardId()?APP.session.getBracketEventId()||(APP.session.resetBracketMatch(),APP.session.buildTabbedBracketMatchListing(),APP.session.showBracketMatchListing(),game_defs=[]):(APP.header.showBracketBoardSelector(),game_defs=[]));var game_defs=APP.session.getGameSelector();"test"!=APP.location&&"dev"!=APP.location||APP.lobby.isLobbyMatch()||game_defs&&APP.inject101&&(game_defs=APP.session.inject101(game_defs)),sess.lgs_list=game_defs;var lobbyData=APP.lobby.data;if(lobbyData.activeLeague&&APP.lobby.isChallengeLeagueFormat()){var gameMenu=lobbyData.activeLeague.game_menu;gameMenu.length>0&&(sess.lgs_list=gameMenu,game_defs=sess.lgs_list)}var gameMenuHelper=APP.nlf.rails.gameMenu,railsGameOpts=gameMenuHelper.getOptions();if(railsGameOpts){var checkAllRules=!0;railsGameOpts.decidingLeg&&"DECIDING"==APP.zanis.simpleLegCheck()&&(game_defs=gameMenuHelper.allowAll(game_defs),checkAllRules=!1),checkAllRules&&(railsGameOpts.isChicago&&(game_defs=gameMenuHelper.setChicago(game_defs)),railsGameOpts.isOrdered&&(game_defs=gameMenuHelper.setOrder(game_defs)),railsGameOpts.decidingLeg&&"DECIDING"==APP.zanis.simpleLegCheck()&&(game_defs=gameMenuHelper.allowAll(game_defs)))}for(isSolo501()&&(gameMenu=[{type:"01",label:"501 SIDO",starting_score:501,double_out:!0}],sess.lgs_list=gameMenu,game_defs=sess.lgs_list),gc=$("#lgs-game-container"),gamex=$("#lgs-game-x"),$("#lgs-cricket-x"),$("#lgs-other-x"),list=[],len=game_defs.length,i=0;i<len;i++){extLbl="";var is_other="Other"==game_defs[i].label;if(is_other){if(!other_game){$("#lgs-custom-hint").html("Add Game").appendTo(gc).show(0);continue}id="lgs-custom-game-"+i,lbl=other_game.label,other_game.type&&"Cricket"==other_game.type&&(extLabel=APP.game.getGameOptsLabel(other_game))&&(extLbl='<span class="cric-opts">'+extLabel+"</span>")}else if(id="lgs-game-"+i,lbl=game_defs[i].label,"Cricket"==game_defs[i].type){var extLabel;if(game_defs[i].cricket_options)(extLabel=APP.game.getGameOptsLabel(game_defs[i].cricket_options))&&(extLbl='<span class="cric-opts">'+extLabel+"</span>");game_defs[i].cricket_variation&&(lbl=sess.getCricketVariantName(game_defs[i].cricket_variation))}gamex.clone(!0).attr("id",id).appendTo(gc).addClass("lgs-choice").removeClass("template"),$("#"+id+" > span").html(lbl+extLbl),game_defs[i].game_order_disabled&&$("#"+id).addClass("order-disabled"),list.push(id),is_other&&other_game&&($("#"+id).removeClass("button-red").addClass("button-gold"),$("#lgs-custom-hint").html("Remove Game").appendTo(gc).show(0))}if(APP.session.isBracketOfficialMatch()&&APP.header.players_checked_in&&(id="lgs-bracket-forfeit-dq",lbl="Forfeit/DQ Match",list.push(id),$("#"+id).remove(),gamex.clone(!0).attr("id",id).appendTo(gc).removeClass("button-red").addClass("button-gold").removeClass("template"),$("#"+id+" > span").html(lbl)),APP.device.addButtonHandler(list,sess.handleGameSelector),"D"==APP.user.member_level&&($("#lgs-demo-custom").show(0),APP.game.opponent[1].team.players[0].is_bot?sess.handleDemoOpponent("lgs-demo-dartconnect",!0):sess.handleDemoOpponent("lgs-demo-player",!0)),APP.popup.show("league-game-selector"),APP.session.isBracketPracticeMatch(),APP.session.isBracketMatch()&&APP.session.isNewMatch()?APP.reveal.setBackButton("BACK"):APP.reveal.setBackButton("EXIT"),BBAT.fetchData("reload_bracket")&&window.setTimeout((function(){APP.session.bracket||(localStorage.bracket?APP.session.bracket=JSON.parse(localStorage.bracket):APP.recordError("RICH! BAD TOURNAMENT LOOP has returned"));try{APP.session.bracket.board_id||APP.session.showUserMatches()}catch(e){APP.session.showUserMatches()}}),100),APP.session.isBracketMatch()&&!APP.session.getBracketBoardId()&&APP.session.isUserMatchesOnly()&&window.setTimeout((function(){APP.session.bracket.board_id||APP.session.showUserMatches()}),100),sess.isBracketMatch()&&!sess.isBracketPracticeMatch())try{1==game_defs.length&&$("#lgs-game-0").length&&(APP.session.hasAutoForwardedSingleGame||"CORK"!==BBAT.fetchData("shortcut")&&window.setTimeout((function(){APP.session.hasAutoForwardedSingleGame=!0,APP.session.handleGameSelector("lgs-game-0")}),100))}catch(e){}APP.nlf.data.rails&&APP.nlf.rails.injections.showGameSelector()}},inject101:function(game_defs){try{for(var isAlreadyInjected=!1,i=0;i<game_defs.length;i++){var myGame=game_defs[i];myGame.is_injected&&(isAlreadyInjected=!0),myGame.label&&"101 SIDO"==myGame.label&&(isAlreadyInjected=!0)}isAlreadyInjected||game_defs.unshift({is_injected:!0,type:"01",label:"101 SIDO",starting_score:101,double_out:!0})}catch(e){}return game_defs},getCricketVariantName:function(variant){var lbl="Cricket";switch(variant){case"DROP 10":lbl="Drop 10 Cricket";break;case"MARK UP":lbl="Mark Up Cricket";break;case"STRAIGHT":lbl="Straight Cricket";break;case"EXTENDED":lbl="Extended Cricket";break;case"NO POINTS":lbl="No Points Cricket";break;case"CUSTOM":lbl="Custom Cricket";break;case"TACTICS NL":lbl="Tactics NL";break;case"TACTICS 10":lbl="Tactics 10";break;case"TACTICS 11":lbl="Tactics 11";break;case"TACTICS 12":lbl="Tactics 12"}return lbl},isMatchSummaryShowing:function(){return"none"!=$("#popup-session-summary").css("display")},handleDemoOpponent:function(in_id,in_buttons_only){switch(in_id){case"lgs-demo-player":$("#lgs-demo-player").removeClass("button-gray").addClass("button-green"),$("#lgs-demo-dartconnect").removeClass("button-green").addClass("button-gray"),in_buttons_only||(APP.game.opponent[1].setTeam(APP.game.dflt_guest_team),APP.storeState({settings_change:!0}),APP.header.refresh());break;case"lgs-demo-dartconnect":$("#lgs-demo-dartconnect").removeClass("button-gray").addClass("button-green"),$("#lgs-demo-player").removeClass("button-green").addClass("button-gray"),in_buttons_only||(APP.game.opponent[1].team.players[0].is_bot=!0,APP.header.startDartBotSettings())}},handleGameSelector:function(in_id){var league,ld,g,sess=APP.session,mf=APP.session.getMatchFormat()||{},b=sess.bracket||{};if("lgs-bracket-forfeit-dq"!=in_id){var myBtn=$("#"+in_id);if(myBtn.hasClass("order-disabled"))APP.confirm.show({title:"Warning!",msg:"\n\t\t\t\t\tYour league admin has set these games to be played in a set order. Playing them out of sequence may lead to legs/matches being voided.\n\t\t\t\t\t<br /><br />\n\t\t\t\t\tDo you want to enable this game?\n\t\t\t\t",ok_text:"Enable Game",ok:function(){myBtn.removeClass("order-disabled")}});else{if("lgs-custom-hint"==in_id)return(g=BBAT.fetchData("other_game"))?void setTimeout((function(){BBAT.flushData("other_game"),APP.session.showGameSelector()}),5):(APP.session.other_game=!0,APP.popup.hide("league-game-selector"),void APP.reveal.setBackButton("BACK"));if(ld=sess.getMatchLeagueKey()||{},sess.isBracketMatch()&&!sess.isBracketPracticeMatch()){var te=b.events[sess.getBracketEventId()];te.game_menu.length||(te.game_menu=APP.session.getGameSelector()),"test"==APP.location&&APP.inject101&&(te.game_menu=APP.session.inject101(te.game_menu)),g=te.game_menu[APP.extractLastNumberSegment(in_id)]}else if(ld.league_division_guid){APP.nlf.rails.checkGameLevelSettings(in_id);var als=APP.getAssociatedLeagueSeason(ld.league_division_guid);als.game_menu&&als.game_menu.length||(als.game_menu=APP.session.getGameSelector()),g=als.game_menu[APP.extractLastNumberSegment(in_id)]}else ld.league_id?((league=sess.leagues[ld.league_id.toUpperCase()]).games.length||(league.games=APP.session.getGameSelector()),g=league.games[APP.extractLastNumberSegment(in_id)]):g=sess.lgs_list[APP.extractLastNumberSegment(in_id)];if(APP.dartbot.isScripted&&"501 SIDO"!==g.label)APP.confirm.show({title:"Warning!",msg:"\n\t\t\t\t\t\tExactbot only works with 501 SIDO.\n\t\t\t\t\t",ok_text:"Understood!",ok:function(){},cancel_text:"Remove Exactbot",cancel:function(){APP.handleMatchOption("bb-e-new-players"),APP.header.handleOpponentChange("oph-bb-reset-right")}});else{if(APP.session.other_game=!1,"Other"==g.type&&(in_id.indexOf("custom")>=0&&(g=BBAT.fetchData("other_game")||g),"Other"==g.type))return APP.session.other_game=!0,APP.popup.hide("league-game-selector"),APP.reveal.setBackButton("BACK"),void("TOURNAMENT"!=APP.session.getMatchMode()||APP.header.players_checked_in||APP.header.startOpponentChange());try{g&&g.type&&g.label&&"Cricket"==g.type&&APP.session.setCorrectCricketGame(g)}catch(e){}var cricketOpts=!1;"Cricket"==g.type&&(cricketOpts={},g.cricket_scoring&&(cricketOpts.scoring=g.cricket_scoring),g.cricket_option_call&&(cricketOpts.call=g.cricket_option_call),g.cricket_options&&(g.cricket_options.call&&(cricketOpts.call=g.cricket_options.call),g.cricket_options.no_bull&&(cricketOpts.no_bull=g.cricket_options.no_bull)),g.cricket_variation&&(cricketOpts.variation=g.cricket_variation)),APP.game_selector.selectGame(g.type,g,cricketOpts),APP.game.plugin.initGamePanel(),g.starting_score&&APP.game.resetScores(g.starting_score),APP.game.options.double_in=!!g.double_in,APP.game.options.all_player_double_in=!!g.all_player_double_in,APP.game.options.double_out=!!g.double_out,g.sudden_death&&"Y"==g.sudden_death&&APP.session.checkTournamentSuddenDeath(g),g.dynamic_handicapping&&"N"!==g.dynamic_handicapping&&APP.session.checkTournamentHandicapping(g),"101 Darts"==g.label&&(APP.game.options.dyg_name=g.label),$("#bs-set-format").html(APP.session.getMatchFormatSummary(!0)),$("#bs-game-info").html(APP.game.name?APP.game.getGameName(!0):"Game Menu"),APP.storeState({settings_change:!0}),APP.game.plugin.storeSettings(),APP.game.plugin.refreshGamePanel(),APP.header.refresh(),APP.popup.hide("league-game-selector"),APP.reveal.setBackButton("BACK");var zanisAction=APP.zanis.masterCheck();null!=APP.game.bull_shoot_winner&&(APP.game.start(APP.game.bull_shoot_winner),!0)||function(){if(!APP.was_game_deleted&&!APP.session.isNewMatch()&&APP.session.isNewSet())switch(zanisAction){case"ALTERNATE":return APP.game.start(0==APP.session.getPrevSetStartingOpponent()?1:0),!0;case"RANDOM":return APP.game.start(Math.floor(2*Math.random())),!0;case"CORK":case"PLAYER":return APP.session.showBullShoot(),!0}return!1}()||"ALTERNATE"==mf.next_game&&!APP.was_game_deleted&&!APP.session.isNewMatch()&&(APP.game.start(0==APP.session.getPrevGameStartingOpponent()?1:0),!0)||function(){if(!APP.header.players_checked_in&&APP.game.name)APP.session.isBracketPracticeMatch()?APP.header.has_seen_legs_menu||APP.session.handleBullShoot("bs-set-format"):APP.session.bracket||"TOURNAMENT"!=APP.session.getMatchMode()?APP.session.showBullShoot():APP.header.has_seen_legs_menu||(APP.header.handleTournamentEventType("pet-tm"),APP.session.handleBullShoot("bs-set-format"))}()}}}else APP.session.showBracketPrematureEndOptions(APP.session.bracket.match_id)},setCorrectCricketGame:function(g){switch(APP.game.resetCricketOptions(),g.label){case"Cricket":APP.game.setOptions({variation:"STANDARD"});break;case"Extended Cricket":APP.game.setOptions({variation:"EXTENDED",targets:"2011",no_points:!0});break;case"Custom Cricket":APP.game.setOptions({variation:"CUSTOM"});break;case"Staight Cricket":APP.game.setOptions({variation:"STRAIGHT",targets:"2015",no_points:!0});break;case"Drop 10 Cricket":APP.game.setOptions({variation:"DROP 10",drop_10:!0});break;case"Tactics NL":APP.game.setOptions({variation:"TACTICS NL",dutch_tactics:!0});break;case"Tactics 10":APP.game.setOptions({variation:"TACTICS 10"});break;case"Tactics 11":APP.game.setOptions({variation:"TACTICS 11"});break;case"Tactics 12":APP.game.setOptions({variation:"TACTICS 12"});break;case"Mark Up Cricket":APP.game.setOptions({variation:"MARK UP",no_points:!0});break;case"No Points Cricket":APP.game.setOptions({variation:"NO POINTS",no_points:!0})}APP.game.setOptions({marksman_scoring:!!APP.user_options.marksman}),APP.plugin_cricket.storeSettings()},isUserLeagueAssociated:function(in_league_guid){var i,i_len,ula=(APP.user?APP.user.league_associations:null)||[];for(i_len=ula.length,i=0;i<i_len;i++)if(ula[i].league_guid==in_league_guid)return!0;return!1},showQuickPlayListing:function(onlineMode){APP.popup.show("popup-quick-play-mode");var sbh=$("#popup-quick-play-mode").outerHeight(!0)-$("#popup-quick-play-mode .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#pqp-scroll-box").css("padding-top")));$("#pqp-scroll-box").css("max-height",sbh),APP.device.addButtonHandler(["pqp-btn-close","pqp-btn-0","pqp-btn-1","pqp-btn-2","pqp-btn-3","pqp-btn-4","pqp-btn-5","pqp-btn-6","pqp-btn-7","pqp-btn-8","pqp-btn-9","pqp-btn-10"],APP.session.handleQuickPlayButton),onlineMode?($("#pqp-trainers").hide(),APP.session.quickPlayOnline=!0):($("#pqp-trainers").show(),APP.session.quickPlayOnline=!1)},quickPlayOnline:!1,handleQuickPlayButton:function(in_id){switch(in_id){case"pqp-btn-close":APP.popup.hide("popup-quick-play-mode");break;case"pqp-btn-0":APP.quickplay.customMatchMode();break;case"pqp-btn-1":APP.quickplay.play(0,1);break;case"pqp-btn-2":APP.quickplay.play(1,1);break;case"pqp-btn-3":APP.quickplay.play(2,2);break;case"pqp-btn-4":APP.quickplay.play(3);break;case"pqp-btn-5":APP.quickplay.play(4,1,3);break;case"pqp-btn-6":APP.quickplay.play(5,1,6);break;case"pqp-btn-7":APP.quickplay.play(6,1,10);break;case"pqp-btn-8":APP.quickplay.play(7,2,3);break;case"pqp-btn-9":APP.quickplay.play(8,2,6);break;case"pqp-btn-10":APP.quickplay.play(9,2,10)}APP.session.quickPlayOnline&&"pqp-btn-close"!==in_id&&(APP.header.handleOpponentChange("bb-o-connect"),APP.handleAlleyOption("pcm-compete-host-button"))},showTournamentListing:function(){var key,t,sess=APP.session,active_html="",future_html="",st=APP.session.tournaments||{};new Date;for(key in BBAT.flushData("tournament_id"),st){var nonFutureEvent=(t=st[key]).active,eventDate="";try{eventDate=(eventDate=moment(t.start_date)).format("ddd Do MMMM YYYY")}catch(e){}var id="ptl-tournament-"+key,eventTitle="",eventSubtitle="&nbsp",subTitleSet=!1;if(t.match_description){var parts=(eventTitle=t.match_description).split(" | ");parts.length>0&&(eventTitle=parts[0],eventSubtitle=parts[1],subTitleSet=!0)}var eventNumber=null,eventOrg=null,eventTagline=null,locationArr=[];t.event_number_label&&(eventNumber=t.event_number_label),t.org_name&&(eventOrg=t.org_name),t.venue&&locationArr.push(t.venue),t.city&&locationArr.push(t.city),t.state&&locationArr.push(t.state),t.country_code&&locationArr.push(t.country_code),t.checkin_tagline&&(eventTagline=t.checkin_tagline),eventNumber?subTitleSet||(eventSubtitle=eventNumber):eventOrg?subTitleSet||(eventSubtitle=eventOrg):locationArr.length?subTitleSet||(eventSubtitle=locationArr.join(", ")):eventTagline&&(subTitleSet||(eventSubtitle=eventTagline));var content=`\n\t\t\t\t<div id="${id}" class="button event-button button-${nonFutureEvent?"green":"gray"} round-corners">\n\t\t\t\t\t<div class="event-title">${eventTitle}</div>\n\t\t\t`;eventSubtitle&&nonFutureEvent&&(content+=`\n\t\t\t\t\t<div class="event-subtitle">${eventSubtitle}</div>\n\t\t\t\t`),eventDate&&(content+=`\n\t\t\t\t\t<div class="event-date">Starts: ${eventDate}</div>\n\t\t\t\t`),content+="\n\t\t\t\t</div>\n\t\t\t",nonFutureEvent?active_html+=content:future_html+=content,nonFutureEvent?APP.device.addButtonHandler([id],sess.handleTournamentListing):APP.device.addButtonHandler([id],(function(mId){APP.session.handleTournamentListing(mId,!0)}))}active_html?($("#ptl-active").html(active_html),APP.device.setButtonEvents("#ptl-active .button"),$("#ptl-active-section").show(0)):$("#ptl-active-section").hide(0),future_html?($("#ptl-future-content .ptl-section-title").html("Upcoming Events"),$("#ptl-future").html(future_html),APP.device.setButtonEvents("#ptl-future .button")):$("#ptl-future-content .ptl-section-title").html("No Upcoming Events");var footer=$("#ptl-footer");footer.html("\n\t\t\t<div class='ptl-section-title'>Additional Event Check-In:</div>\n\t\t\t<a id='ptl-link' href='https://checkin.dartconnect.com/' target='_blank'></a>\n\t\t\t<div class='ptl-hint'>Don't see your event? Go to tv.dartconnect.com, find this event and use either RegConnect or the Checkin Link to add your name to the player roster. Then, \"Check for Updates\" on this device.</div>\n\t\t"),APP.fns.checkForProxy()&&footer.addClass("hide"),APP.popup.show("popup-tournament-listing");var sbh=$("#popup-tournament-listing").outerHeight(!0)-$("#popup-tournament-listing .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#ptl-scroll-box").css("padding-top")));$("#ptl-scroll-box").css("max-height",sbh)},getBracketFromStorage:function(){try{APP.session.bracket=JSON.parse(localStorage.getItem("bracket"))}catch(e){}},handleTournamentListing:function(in_id,early_access,preflight){if(!early_access||preflight){var id,sess=APP.session;switch(in_id){case"ptl-close":APP.popup.hide("popup-tournament-listing");break;case"ptl-refresh":APP.lobby.updateLeagues(!1,(function(){APP.device.hideSpinnerOverlay();APP.alert.show("Couldn't update Tournaments, please check your connectivity and try again later")}));break;default:APP.exitTournament(!0),id=APP.extractLastSegment(in_id),APP.session.tournament_id=id;var t=sess.tournaments[id];if(!t)return BBAT.flushData("reload_bracket_board"),BBAT.flushData("reload_bracket"),void APP.exitTournament();sess.isBracketTournamentInterface(t.bracket_interface)?sess.getBracketEventsSetup((function(){sess.initBracket(id,t.bracket_interface),continueSetup()})):continueSetup()}}else APP.confirm.show({title:"Warning!",msg:"\n\t\t\t\t\tThis is a future event. Do you want to access it now?\n\t\t\t\t",ok_text:"Yes",ok:function(){APP.session.handleTournamentListing(in_id,early_access,!0)},cancel_text:"No"});function continueSetup(){APP.session.startNew("TOURNAMENT"),APP.server.getTournamentPlayers({tournament_id:id,on_success:function(in_players){APP.header.loadTournamentDirectory(in_players)}}),APP.device.has_chalk=!0,APP.changeMode("PRE-GAME"),APP.chalkboard.unshield(),APP.popup.hide(),APP.reveal.showButtonBar("button-bar-match"),APP.game_selector.show(),APP.header.refresh(),APP.reveal.setChalkButton(),APP.session.setUpTournamentDefaults(!0),APP.handleAlleyOption("pcm-broadcast-start-button")}},checkTournamentSuddenDeath:function(selectedGame){if(APP.session.isBracketMatch())try{if(selectedGame.sudden_death&&"Y"==selectedGame.sudden_death){if(!selectedGame.sudden_death_round)return;var sess=APP.session,mf=APP.getMatch().format;mf.sudden_death={active:"Y",round:selectedGame.sudden_death_round,type:"TOURNAMENT"},selectedGame.sudden_death_instructions&&(mf.sudden_death.instructions=selectedGame.sudden_death_instructions),sess.store(sess.current_match)}}catch(e){}},checkTournamentHandicapping:function(selectedGame){if(APP.session.isBracketMatch())try{if(selectedGame.dynamic_handicapping){var sess=APP.session,mf=APP.getMatch().format;switch(APP.user_options.auto_balance=!1,APP.storeUserOptions(),mf.enable_handicapping="N",selectedGame.dynamic_handicapping){case"Y":return mf.dynamic_handicapping="A",sess.store(sess.current_match),APP.user_options.auto_balance=!0,void APP.storeUserOptions();case"S":mf.enable_handicapping="Y"}}}catch(e){}},leagueMenu:{show:function(){for(var ula=(APP.user?APP.user.league_associations:null)||[],grouped={},has_practice=!1,has_active=!1,has_inactive=!1,has_groups=!1,practice_html="",active_html="",groups_html="",inactive_html="",practiceBtns=[],msgTracker={amb:!1,membership:!1,groupSeason:!1},i=0;i<ula.length;i++){var league=ula[i];grouped[key=league.league_id+"::"+league.division_label+"::"+league.season_label]||(grouped[key]={label:league.longname,division:league.division_label,season:league.season_label,divisions:[],hasReg:!1,hasPost:!1}),"REG"===league.season_status&&(grouped[key].hasReg=!0),"POST"===league.season_status&&(grouped[key].hasPost=!0),-1!==(league.league_division_guid+"").indexOf("teamgroup~")?(league.is_group="Y",league.is_auto_group=!0):league.is_auto_group=!1,grouped[key].divisions.push(league)}for(var groupKey in $("#plm-practice-leagues, #plm-active-leagues, #plm-inactive-leagues, #plm-active-groups").hide(0),grouped){var group=grouped[groupKey],divisions=group.divisions;divisions.sort((function(a,b){return a.season_status===b.season_status?0:"REG"===a.season_status?-1:1}));for(var groupHtml=`\n\t\t\t\t\t<div class="league-block">\n\t\t\t\t\t\t<div class="league-header">\n\t\t\t\t\t\t\t<span class="league-label">${group.label}</span>\n\t\t\t\t\t\t\t<span class="league-subtitle">\n\t\t\t\t\t\t\t\t<span class="division-label">\n\t\t\t\t\t\t\t\t\t${group.division?group.division+" - ":""}\n\t\t\t\t\t\t\t\t</span><span class="season-label">${group.season}</span>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="league-buttons">\n\t\t\t\t`,j=0;j<divisions.length;j++){if("Y"!==(l=divisions[j]).covid_season){var displayDivision=APP.session.leagueMenu.getDisplayDivisionFlag(ula,l),railsPractice=APP.nlf.rails.railsPracticeEnabled(l),key=l.league_id+"-"+l.league_division_guid;"AMB"===l.match_format_style&&(msgTracker.amb=!0),!l.season_underway||l.team_guid&&l.league_division_guid||(msgTracker.membership=!0),"Y"===l.is_group&&(msgTracker.groupSeason=!0,has_groups=!0);var hasRegAndPost=group.hasReg&&group.hasPost,isPracticeValid=railsPractice&&"AMB"===l.match_format_style&&l.match_settings.sets&&l.match_settings.sets.length&&"POST"!==l.season_status&&!hasRegAndPost,mainButton=this.getAndSetLeagueButton(l,APP.session.handleLeagueMenu,displayDivision),buttonClass="gray";switch(l.access_status){case"A":buttonClass="POST"===l.season_status?"gold":"green",has_active=!0;break;case"P":buttonClass="gold",has_practice=!0;break;case"I":buttonClass="gray",has_inactive=!0}if(groupHtml+=`\n\t\t\t\t\t\t<div class="plm-button-wrapper ${buttonClass}">\n\t\t\t\t\t\t\t${mainButton}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,isPracticeValid){var practiceBtnId="plm-ula-"+l.league_id+"-"+l.league_division_guid+"-PRACTICE";practiceBtns.push(practiceBtnId),groupHtml+=`\n\t\t\t\t\t\t\t<div class="practice-button-wrapper">\n\t\t\t\t\t\t\t\t<div id="${practiceBtnId}" class="button-practice button-red round-corners button-medium button">\n\t\t\t\t\t\t\t\t\tPlay a Practice Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`}}}msgTracker.amb&&(groupHtml+=this.getSeasonMessage()),msgTracker.membership&&(groupHtml+=this.getMembershipMessage(group.divisions[0],APP.user)),msgTracker.groupSeason&&(groupHtml+=this.getGroupSeasonMessage(group.divisions[0])),groupHtml+="\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t";var isGroup=!1,hasPractice=!1,hasActive=!1,hasInactive=!1;for(j=0;j<divisions.length;j++){if("Y"===(l=divisions[j]).is_group){isGroup=!0;break}}if(!isGroup)for(j=0;j<divisions.length;j++){if("P"===(l=divisions[j]).access_status){hasPractice=!0;break}}if(!isGroup&&!hasPractice)for(j=0;j<divisions.length;j++){var l;if("A"===(l=divisions[j]).access_status){hasActive=!0;break}}isGroup||hasPractice||hasActive||(hasInactive=!0),isGroup?groups_html+=groupHtml:hasPractice?practice_html+=groupHtml:hasActive?active_html+=groupHtml:hasInactive&&(inactive_html+=groupHtml)}has_practice&&($("#plm-practice-leagues").show(0),$("#plm-practice-leagues-body").html(practice_html),APP.device.setButtonEvents("#plm-practice-leagues .button")),has_groups&&($("#plm-active-groups").show(0),$("#plm-active-groups-body").html(groups_html),APP.device.setButtonEvents("#plm-active-groups .button")),has_active&&($("#plm-active-leagues").show(0),$("#plm-active-leagues-body").html(active_html),APP.device.setButtonEvents("#plm-active-leagues .button")),has_inactive&&($("#plm-inactive-leagues").show(0),$("#plm-inactive-leagues-body").html(inactive_html),APP.device.setButtonEvents("#plm-inactive-leagues .button")),practiceBtns.length&&APP.device.addButtonHandler(practiceBtns,APP.nlf.rails.startPracticeMatch),$("#plm-member-email").html(APP.user.email),"G"==APP.user.member_level&&(APP.device.disableButton("plm-team"),APP.device.disableButton("plm-singles")),APP.popup.show("popup-league-menu");var sbh=$("#popup-league-menu").outerHeight(!0)-$("#popup-league-menu .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#plm-scroll-box").css("padding-top")));$("#plm-scroll-box").css("max-height",sbh)},getSeasonMessage:function(){return'\n\t\t\t\t<div class="amb-msg">\n\t\t\t\t\t<span></span> <span class="text-gold">Advanced Match Format</span>\n\t\t\t\t</div>\n\t\t\t'},getGroupSeasonMessage(in_league){var html="";return"S"===in_league.league_status&&(html="Access to this group has been suspended. Contact your league for details."),html&&(html='<div class="plm-pre-button">'+html+"</div>"),html},getAndSetLeagueButton(in_league,in_button_handler,displayDivision){var b_id,b_class,html="";switch(b_id="plm-ula-"+in_league.league_id+"-"+in_league.league_division_guid+"-"+in_league.season_status,b_class="plm-button button-menu round-corners ",in_league.access_status){case"P":b_class+="button button-gold";break;case"A":"Y"==in_league.is_group?b_class+="button button-red":"POST"==in_league.season_status?b_class+="button button-gold":b_class+="button button-green";break;case"I":b_class+="button-gray"}APP.nlf.rails.checkMissingRailsFormat(in_league).missing&&(in_league.access_status="I",b_class="plm-button button-menu round-corners button-gray"),"S"===in_league.season_active_status||"S"===in_league.league_status?(b_class="plm-button button-menu round-corners ",b_class+=" button-gray"):"PA".indexOf(in_league.access_status)>=0&&APP.device.addButtonHandler([b_id],in_button_handler);var isGroup=!1;switch(APP.session.currentLeagueIsGroup(in_league)&&(isGroup=!0),in_league.access_status){case"P":html=`\n\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">Practice ${"TEAM"==in_league.league_type?"Team":"Singles"} League Play</div>\n\t\t\t\t\t`,isGroup&&(html=`\n\t\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">\n\t\t\t\t\t\t\t\t${in_league.longname} Practice\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`);break;case"I":html=`\n\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">\n\t\t\t\t\t\t\tLeague is Inactive\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,isGroup&&(html=`\n\t\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">\n\t\t\t\t\t\t\t\t${in_league.longname} (Inactive)\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`);break;case"A":html=`\n\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">\n\t\t\t\t\t\t\t${"POST"===in_league.season_status?"Play Post Season Match":"Play Regular Season"}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,isGroup&&(html=`\n\t\t\t\t\t\t\t<div id="${b_id}" class="${b_class}">\n\t\t\t\t\t\t\t\t${in_league.longname}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`)}return html},getMembershipMessage(in_league,in_user){var purchase_link,days_to_expire,html='<div class="plm-post-button">',now=new Date,expire_html="";if(in_league.season_underway&&(!in_league.team_guid||!in_league.league_division_guid))return(html+='<div class="plm-unassigned">Season rosters have been posted and the email associated with your DartConnect Account has not been assigned to a division or team.<br>Contact your league to resolve.</div>')+"</div>";if("P"==in_league.payment_type&&"PS".indexOf(in_user.member_level)>=0)return html+"</div>";if(in_league.season_pass_id)return html+"</div>";if("TRIAL"==in_user.premium_pay_type?days_to_expire=Math.floor((APP.user.med-now)/864e5)+1:in_league.free_trial_ends&&(days_to_expire=Math.floor((new Date(in_league.free_trial_ends)-now)/864e5)+1),days_to_expire&&(expire_html='<div class="plm-expire">Your Free Trial Expires in '+days_to_expire+" Days</div>"),purchase_link="L"==in_league.payment_type||in_league.season_pass_id?"":'<div><a target="_blank" href="'+APP.getDomain("MEMBERS")+'"><div class="plm-purchase button-menu button-red round-corners" style="display:inline-block;">Purchase Now!</div></a></div>',"I"!=in_league.access_status&&!days_to_expire)return html+"</div>";switch(in_league.payment_type){case"I":return(html+="Season Pass Required"+expire_html+purchase_link)+"</div>";case"P":return(html+="Premium Membership Required"+expire_html+purchase_link)+"</div>";case"L":return html+"</div>";default:return(html+="Contact Your League")+"</div>"}return""},getDisplayDivisionFlag:function(ula,targetLeague){for(var leagueGuidArr=[],j=0;j<ula.length;j++){var mLeague=ula[j];mLeague.is_group&&"N"!=mLeague.is_group||"REG"==mLeague.season_status&&leagueGuidArr.push(mLeague.league_guid)}for(j=0;j<leagueGuidArr.length;j++)for(var needle=leagueGuidArr[j],k=0;k<leagueGuidArr.length;k++)if(k!=j&&needle==leagueGuidArr[k])return!0;return!1}},handleLeagueMenu:function(in_id){var ld,sess=APP.session;function closeMenu(in_all,in_open_alley,in_status){if(in_all){if(in_open_alley){var league=APP.session.getCurrentLeague();league?"Y"==league.can_broadcast&&APP.handleAlleyOption("pcm-broadcast-start-button"):APP.handleAlleyOption("pcm-broadcast-start-button")}APP.device.has_chalk=!0,APP.changeMode("PRE-GAME"),APP.chalkboard.unshield(),APP.popup.hide(),APP.game_selector.show(!0),APP.reveal.showButtonBar("button-bar-match"),APP.header.refresh(),APP.reveal.setChalkButton(),APP.session.setupLeagueDefaults(),"PRE"==in_status&&APP.alert.show('Welcome to Pre-Season Practice!<p class="plm-popup-notice-p">Pre Season provides sample games, players and  match format so that you can master the essentials for running a league match:</p><ul class="plm-popup-notice-ul"><li>Selecting Opponents</li><li>Selecting Player Throw Order</li><li>Playing short &amp; forfeiting</li><li>Scoring Turns</li><li>Correcting Scoring Errors</li><li>Correcting League Points</li><li>Ending &amp; Saving Matches</li></ul><p class="plm-popup-notice-p">Your league administrator will adjust the league settings to reflect your format once the regular season begins.</p><p class="plm-popup-notice-p">For tips &amp; video tutorials go to <a style="color:blue;" target="_blank" href="http://www.dartconnect.com/learnmore.php">dartconnect.com/learnmore.php</a></p>')}else APP.popup.hide("popup-league-menu")}switch(in_id){case"plm-close":closeMenu();break;case"plm-refresh":APP.lobby.updateLeagues(!1,(function(){APP.device.hideSpinnerOverlay();APP.alert.show("Couldn't update Leagues, please check your connectivity and try again later")}));break;case"plm-singles":sess.startNew("SINGLES"),APP.header.fetchDirectory(),closeMenu(!0);break;case"plm-team":sess.startNew("TEAM"),APP.header.fetchDirectory(),closeMenu(!0);break;default:if(0==in_id.indexOf("plm-ula"))var key={league_id:APP.extractSegment(in_id,3,"-"),league_division_guid:APP.extractSegment(in_id,4,"-"),season_status:APP.extractLastSegment(in_id)};else key={league_id:APP.extractLastSegment(in_id)};ld=sess.getLeagueDefinition(key);var reloadSuccess=!1;try{if(APP.nlf.data.railsReturn&&APP.nlf.data.league){var rrld=APP.nlf.data.league,uniqueId=rrld.league_guid;uniqueId+="-",uniqueId+=rrld.season_status;var currentUniqueId=ld.league_guid;currentUniqueId+="-",uniqueId==(currentUniqueId+=ld.season_status)&&(reloadSuccess=!0)}}catch(e){}if(reloadSuccess||(APP.nlf.data.league=JSON.parse(JSON.stringify(ld))),APP.nlf.checkForProxy()){var rr=APP.nlf.data.railsReturn;rr&&(APP.nlf.data.selectedPlayerId=rr.selectedPlayerId,APP.nlf.data.selectedPlayerLabel=rr.selectedPlayerLabel,APP.nlf.data.selectedTeamId=rr.selectedTeamId,APP.nlf.data.selectedTeamLabel=rr.selectedTeamLabel,rr.leagueSchedule&&(APP.nlf.data.league.league_schedule=rr.leagueSchedule))}var showSchedule=!1;if(APP.nlf.checkForProxy()){if(ld.sched_id)return"SINGLES"==APP.nlf.checkForProxy()?(APP.nlf.save(),APP.popup.hide("popup-league-menu"),void APP.nlf.init(3,!0)):(APP.nlf.save(),APP.popup.hide("popup-league-menu"),void APP.nlf.init(1,!0));APP.nlf.data.league=null}else{try{"POST"==ld.season_status?ld.postseason_rounds&&ld.postseason_rounds>0&&(showSchedule=!0):(ld.league_schedule&&ld.league_schedule.length&&(showSchedule=!0),1==APP.nlf.data.league.ad_hoc&&(showSchedule=!0))}catch(e){}if(showSchedule)return APP.nlf.save(),APP.popup.hide("popup-league-menu"),void APP.nlf.init(1,!0);APP.nlf.data.league=null}sess.startNew(ld.league_type,key),ld&&sess.applyAdditionalOptions(ld),ld.user_options&&sess.applyUserOptions(ld.user_options),APP.header.fetchDirectory(),closeMenu(!0,!0)}},enableLeagueLookup:function(){APP.device.addButtonHandler(["plm-lookup"],(function(){APP.showIframePopOver("https://league.dartconnect.com/league-lookup","League Lookup")}))},showMatchMenu:function(){$(".psm-game-button").removeClass("menu-option-on"),APP.popup.show("popup-session-menu")},applyUserOptions:function(in_uo){try{var uo=APP.user_options;for(key in in_uo)uo[key]=in_uo[key]}catch(e){}APP.storeUserOptions()},applyAdditionalOptions:function(ld){try{if(!ld)return;ld.dynamic_handicapping&&"A"==ld.dynamic_handicapping&&(ld.user_options?ld.user_options.auto_balance=!0:ld.user_options={auto_balance:!0}),ld.modified_bust_rule&&("Y"==ld.modified_bust_rule?ld.user_options?ld.user_options.bust_darts=!0:ld.user_options={bust_darts:!0}:ld.user_options?ld.user_options.bust_darts=!1:ld.user_options={bust_darts:!1})}catch(e){}},applyAdditionalTournamentOptions:function(bracket_event_id){},handleMatchMenu:function(in_id,in_league_id){var sess=APP.session;function closeMenu(){APP.popup.hide()}switch(in_id){case"psm-close":APP.handleMatchOption("bb-e-new-match");break;case"psm-league":sess.leagueMenu.show();break;case"psm-game-play":closeMenu(),APP.game.opponent_count=2,sess.startNew("GAME",in_league_id);break;case"psm-solo-practice":closeMenu(),APP.game.opponent_count=1,sess.startNew("SOLO",in_league_id);break;case"psm-match-play":closeMenu(),APP.game.opponent_count=2,sess.startNew("MATCH",in_league_id)}},startForfeit:function(){var lbl_0,lbl_1;"TEAM"==APP.session.getMatchMode()?(lbl_0=!APP.game.opponent[0].is_default&&APP.game.opponent[0].team.players.length>0?APP.game.opponent[0].getTeamPlayerNames():APP.game.opponent[0].chalkboard_name,lbl_1=!APP.game.opponent[1].is_default&&APP.game.opponent[1].team.players.length>0?APP.game.opponent[1].getTeamPlayerNames():APP.game.opponent[1].chalkboard_name):(lbl_0=APP.game.opponent[0].chalkboard_name,lbl_1=APP.game.opponent[1].chalkboard_name),$("#fm-opponent-0").html(lbl_0),$("#fm-opponent-1").html(lbl_1),$(".fm-type-group").removeClass("button-red").addClass("button-gray"),$(".fm-opponent-group").removeClass("button-red").addClass("button-gray"),APP.device.disableButtonClass("fm-opponent-group"),APP.device.disableButtonClass("fm-control"),$("#fm-opponent-hint").html("&nbsp;"),$("#forfeit-menu-overlay").show(0),$("#forfeit-menu").show(0)},finishForfeit:function(){$("#forfeit-menu").hide(0),$("#forfeit-menu-overlay").hide(0),!APP.game.opponent[0].is_default&&APP.game.opponent[0].team.players.length>0&&APP.header.handleOpponentChange("oph-bb-reset-left"),!APP.game.opponent[1].is_default&&APP.game.opponent[1].team.players.length>0&&APP.header.handleOpponentChange("oph-bb-reset-right"),APP.header.recordOpponentChange(!0),APP.header.refreshOpponentsPanel()},handleForfeit:function(in_id){var el,sess=APP.session;function resetOpponent(){$(".fm-opponent-group").removeClass("button-red").addClass("button-gray")}switch(in_id){case"fm-info":APP.info.show("info-text-forfeit","Forfeit");break;case"fm-close":sess.finishForfeit();break;case"fm-notes":APP.showGameNoteEditor(!0);break;case"fm-forfeit":case"fm-setwin":(el=$("#"+in_id)).hasClass("button-gray")&&($(".fm-type-group").removeClass("button-red").addClass("button-gray"),resetOpponent(),APP.device.disableButtonClass("fm-control"),el.removeClass("button-gray").addClass("button-red"),APP.device.enableButtonClass("fm-opponent-group",!0)),"fm-forfeit"==in_id?$("#fm-opponent-hint").html("Select Forfeiting Opponent"):($("#fm-opponent-hint").html("Select Winning Opponent"),APP.device.disableButton("fm-opponent-b"));break;case"fm-opponent-0":case"fm-opponent-1":case"fm-opponent-b":(el=$("#"+in_id)).hasClass("button-gray")&&(resetOpponent(),APP.device.enableButtonClass("fm-control",!0),el.removeClass("button-gray").addClass("button-red"));break;case"fm-continue":var plyrs=[[],[]];if("TEAM"==APP.session.getMatchMode())for(var oi=0;oi<2;oi++){if(!(oppo=APP.game.opponent[oi]).is_default&&oppo.team.players.length>0)for(var plst=oppo.team.players,plen=plst.length,pi=0;pi<plen;pi++)"Pfiller"!=plst[pi].obj_id&&(plyrs[oi][pi]={first_name:plst[pi].first_name,last_name:plst[pi].last_name,email:plst[pi].email,player_guid:plst[pi].player_guid})}var oppo,type=APP.extractLastSegment($(".fm-type-group.button-red")[0].id);if("b"!=(oppo=APP.extractLastSegment($(".fm-opponent-group.button-red")[0].id))){oppo=parseInt(oppo,10);var lbl=APP.game.opponent[oppo].chalkboard_name;"TEAM"==APP.session.getMatchMode()&&!APP.game.opponent[oppo].is_default&&APP.game.opponent[oppo].team.players.length>0&&(lbl=APP.game.opponent[oppo].getTeamPlayerNames())}var cm=sess.matches[sess.current_match],cs=cm.sets[sess.current_set],msg="Set #"+(sess.current_set+(cs.games.length?2:1))+": ",lf=String.fromCharCode(13);"forfeit"==type?(msg+="b"==oppo?"Both Opponents forfeited.":lbl+" forfeited.",APP.confirm.show({title:"Confirm!",msg:msg,ok:function(){cm=sess.matches[sess.current_match],sess.addSet(),(cs=cm.sets[sess.current_set]).forfeited=!0,cs.forfeit_time=new Date,cs.forfeit_type="FORFEIT",cs.forfeit_players=plyrs,"b"!=oppo&&(cs.wins[0==oppo?1:0]=1,cm.set_wins[0==oppo?1:0]++),cm.notes+=lf+msg,APP.nlf.data.rails&&APP.nlf.rails.saveCompleteLocal(cm.set_wins),sess.setMatchDynamicInfo(cm),sess.isLastSet()?(sess.store(sess.current_match),sess.finishForfeit(),sess.buildSummary(),sess.showSummary(!0)):(sess.addSet(),sess.store(sess.current_match),sess.finishForfeit()),APP.device.disableButton("bb-o-reload"),APP.session.allowReloadPriorLeg()&&APP.device.enableButton("bb-o-reload",!0)},cancel:sess.finishForfeit})):(msg+=lbl+" won.",APP.confirm.show({title:"Confirm!",msg:msg,ok:function(){cm=sess.matches[sess.current_match],sess.addSet(),(cs=cm.sets[sess.current_set]).forfeited=!0,cs.forfeit_time=new Date,cs.forfeit_type="SET-WIN",cs.forfeit_players=plyrs,cs.wins[oppo]=1,cm.set_wins[oppo]++,cm.notes+=lf+msg,APP.nlf.data.rails&&APP.nlf.rails.saveCompleteLocal(cm.set_wins),sess.setMatchDynamicInfo(cm),sess.isLastSet()?(sess.store(sess.current_match),sess.finishForfeit(),sess.buildSummary(),sess.showSummary(!0)):(sess.addSet(),sess.store(sess.current_match),sess.finishForfeit())},cancel:sess.finishForfeit}))}},isPreviousSetForfeit:function(){var sess=APP.session;return!!sess.current_set&&sess.matches[sess.current_match].sets[sess.current_set-1].forfeited},startNew:function(in_mode,in_league_key){var sess=APP.session,gam=APP.game,hdr=APP.header;APP.message_bar,APP.device;if("HOST"==APP.device.role){if(in_mode&&"BASIC GAME"!==in_mode&&(APP.zanis.masterCheck("New Game"),BBAT.flushData("prev_game_tactics"),APP.user_options&&(APP.user_options.auto_balance=!1),APP.storeUserOptions(),BBAT.flushData("auto_balance"),advLog.startNewMatch()),("SINGLES"==in_mode||"TEAM"==in_mode||"TOURNAMENT"==in_mode&&!1!==APP.user_options.game_shot)&&(APP.user_options.game_shot=!0),APP.user_options.eog_menu_option=null,APP.user_options.suppress_no_player_warning=!1,APP.storeUserOptions(),APP.game.opponent_count="SOLO"==in_mode?1:2,BBAT.flushData("dartbot_darts"),null!=sess.current_match){var cm=sess.matches[sess.current_match];cm.bracket_match_premature_end||cm.sets&&0!=cm.sets.length&&(cm.sets[0].games&&0!=cm.sets[0].games.length||cm.sets[0].forfeited)||sess.matches.pop()}var ld=APP.session.getLeagueDefinition(in_league_key)||{};if(sess.isBracketMatch())sess.matches.push(new sess.Match({bracket_interface_id:sess.bracket.interface_id,bracket_board_id:sess.getBracketMatchBoardNo(),bracket_event_id:sess.bracket.event_id,bracket_match_id:sess.bracket.match_id,tournament_id:sess.tournament_id,tournament_event_type:"PRACTICE"==sess.bracket.event_id?"SM":"TM",mode:in_mode,role:APP.device.role,league_id:ld.league_id,league_guid:ld.league_guid,league_division_guid:ld.league_division_guid,season_status:ld.season_status,season_id:ld.season_id,opponent_guids:null,first_name:APP.user?APP.user.first_name:null,last_name:APP.user?APP.user.last_name:null,member_id:APP.user?APP.user.member_id:null}));else{var league_points_style=null,bonus_points=null,bonus_points_win=null,bonus_points_sweep=null,sweep_requirement=null,is_rails=!1;if(APP.nlf.data.rails&&(is_rails=!0,ld))try{var setsMode=ld.match_settings.sets_mode,setsLimit=ld.match_settings.sets_limit;ld.match_settings=APP.nlf.data.railsTransFormat,ld.game_menu=APP.nlf.data.railsGameMenu,setsMode&&setsLimit&&(ld.match_settings.sets_mode=setsMode,ld.match_settings.sets_limit=setsLimit)}catch(e){}if(ld.match_settings&&(ld.match_settings.points_style&&(league_points_style=ld.match_settings.points_style),ld.match_settings.bonus_points&&(bonus_points=ld.match_settings.bonus_points),ld.match_settings.bonus_points_win&&(bonus_points_win=ld.match_settings.bonus_points_win),ld.match_settings.bonus_points_sweep&&(bonus_points_sweep=ld.match_settings.bonus_points_sweep),ld.match_settings.sweep_requirement&&(sweep_requirement=ld.match_settings.sweep_requirement)),0!==APP.lobby.data.mode){var isChallengeLeague=!1,aLeague=APP.lobby.data.activeLeague;aLeague&&"Y"==aLeague.is_challenge_league&&(isChallengeLeague=!0),isChallengeLeague&&aLeague.match_settings.points_style&&(league_points_style=aLeague.match_settings.points_style)}var matchData={bracket_board_id:null,bracket_event_id:null,bracket_match_id:null,tournament_id:sess.tournament_id,tournament_event_type:null,mode:in_mode,role:APP.device.role,league_id:ld.league_id,league_guid:ld.league_guid,league_division_guid:ld.league_division_guid,season_status:ld.season_status,season_id:ld.season_id,match_format_style:ld.match_format_style,opponent_guids:null,points_style:league_points_style,bonus_points:bonus_points,bonus_points_win:bonus_points_win,bonus_points_sweep:bonus_points_sweep,sweep_requirement:sweep_requirement,first_name:APP.user?APP.user.first_name:null,last_name:APP.user?APP.user.last_name:null,member_id:APP.user?APP.user.member_id:null};is_rails&&ld&&ld.match_settings&&(matchData.league_set_id=ld.match_settings.chapter_id,matchData.league_set_number=ld.match_settings.chapter_number,matchData.league_amb_set_scores=null),sess.matches.push(new sess.Match(matchData))}if(sess.current_match=sess.matches.length-1,sess.current_set=null,gam.opponent[0].setTeam(gam.dflt_host_team,in_mode),gam.opponent[0].player_tracking=!0,gam.opponent[1].setTeam(gam.dflt_guest_team,in_mode),gam.opponent[1].player_tracking=!0,hdr.opponent_type="TEAM"==in_mode?"TEAM":"PLAYER",("TEAM"==in_mode||"SINGLES"==in_mode)&&("Library"==gam.name&&APP.game_selector.selectGame("gs-01"),"HOST"==APP.device.role&&ld.league_division_guid)){var als=APP.getAssociatedLeagueSeason(ld.league_division_guid);if(als.sudden_death&&"Y"==als.sudden_death){var sudden_death_obj={norm_501:als.leg_roundlimit_501less,ext_501:als.leg_roundlimit_more501,cricket:als.leg_roundlimit_cricket,active:als.sudden_death};als.match_settings.sudden_death=sudden_death_obj}APP.session.setMatchFormat(als.match_settings)}sess.addSet(),APP.blockUIControls(),APP.session.showGameSelector(!1),APP.reveal.updateSetStatus()}},getTotalTime:function(in_level){var cm,s_start,slen,slist,si,glen,glist,gi,sess=APP.session,elapsed_time=0;if(!(cm=sess.matches[sess.current_match]))return 0;switch(in_level){case"GAME":return APP.game.elapsed_time;case"SET":s_start=sess.current_set;break;case"MATCH":s_start=0}for(slen=(slist=cm.sets).length,si=s_start;si<slen;si++)for(glen=(glist=slist[si].games).length,gi=0;gi<glen;gi++)elapsed_time+=glist[gi].elapsed_time;return elapsed_time},setMatchOpponentGUIDs:function(in_params){var cm,oppo_0,oppo_1,sess=APP.session;(cm=sess.matches[sess.current_match]).opponent_guids=[null,null],("LEAGUE"==in_params.directory_type||APP.session.isBracketMatch())&&(oppo_0=in_params.game.opponent[0],oppo_1=in_params.game.opponent[1],"TEAM"==in_params.opponent_type?(cm.opponent_guids[0]=oppo_0.team.team_guid,cm.opponent_guids[1]=oppo_1.team.team_guid):(cm.opponent_guids[0]=oppo_0.team.players[0].player_guid,cm.opponent_guids[1]=oppo_1.team.players[0].player_guid)),"HOST"==APP.device.role&&sess.store(sess.current_match)},setMatchFormat:function(in_format){var cm,sess=APP.session;APP.user_options;try{cm=sess.matches[sess.current_match],in_format&&(!in_format||in_format.sets||in_format.legs||in_format.next_game||in_format.same_game||in_format.same_legs||in_format.points_style)?cm.format=function cloneObject(in_obj){var tmp,key;if(!in_obj||"object"!=typeof in_obj)return in_obj;for(key in tmp=new in_obj.constructor,in_obj)in_obj[key]&&"object"==typeof in_obj[key]?tmp[key]=cloneObject(in_obj[key]):tmp[key]=in_obj[key];return tmp}(in_format):(cm.format=null,"test"==APP.location||APP.location),cm&&cm.format&&"PLAYER"==cm.format.next_game&&(cm.format.next_game="SELECT"),"HOST"==APP.device.role&&sess.store(sess.current_match)}catch(e){}},getMatchFormat:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.format:null},resetMatchFormatSets:function(in_tournament_default){var cm,sess=APP.session;(cm=sess.matches[sess.current_match]).format&&cm.format.sets&&(cm.format.sets.limit=null,in_tournament_default&&(cm.format.sets={mode:"PLAY-ALL",limit:1})),!cm.format||cm.format.sets||cm.format.legs||cm.format.next_game||cm.format.same_game||cm.format.same_legs||cm.format.points_style||(cm.format=null),sess.store(sess.current_match)},resetMatchFormatLegs:function(){var cm,sess=APP.session;(cm=sess.matches[sess.current_match]).format&&cm.format.legs&&(APP.header.has_seen_legs_menu=!1,cm.format.legs.limit=null),!cm.format||cm.format.sets||cm.format.legs||cm.format.next_game||cm.format.same_game||cm.format.same_legs||cm.format.points_style||(cm.format=null)},getMatchFormatSummary:function(in_bs_version,in_format){var mf=APP.session.getMatchFormat()||{},html="";in_format&&(mf=in_format);try{in_bs_version?html=mf.legs&&mf.legs.limit?"BEST-OF"==mf.legs.mode?"Best of "+mf.legs.limit+" Legs":"Play "+mf.legs.limit+" Legs":"No Leg Limit":mf.legs&&mf.legs.limit&&(html=("BEST-OF"==mf.legs.mode?"Best of ":"Play ")+mf.legs.limit+" Legs")}catch(e){}return html},getMatchFormatSummaryFirstTo:function(){var mf=APP.session.getMatchFormat()||{},html="";try{if(mf.legs&&mf.legs.mode)if("PLAY-ALL"==mf.legs.mode)if(mf.legs.limit){var legTxt=" Legs";1==mf.legs.limit&&(legTxt=" Leg"),html="Play "+mf.legs.limit+legTxt}else html="";else if("BEST-OF"==mf.legs.mode)if(mf.legs.limit){var startTxt,legCount;startTxt="First to ",legCount=Math.round(mf.legs.limit/2),mf.legs.limit%2==0&&(startTxt="Best of ",legCount=mf.legs.limit);legTxt=" Legs";1==mf.legs.limit&&(legTxt=" Leg"),html=startTxt+legCount+legTxt}else html=""}catch(error){html="Legs"}return html},getFullMatchFormatSummary:function(type,myMf){var mf=APP.session.getMatchFormat()||{};myMf&&(mf=myMf);var html="",setDetector=function(){try{var startTxt,setCount;if(mf.sets.mode)if("PLAY-ALL"==mf.sets.mode)if(mf.sets.limit){var setTxt=" Sets";if(1==mf.sets.limit)return legDetector();html="Play "+mf.sets.limit+setTxt}else html="Set Play";else if("BEST-OF"==mf.sets.mode)if(startTxt="First to ",setCount=Math.round(mf.sets.limit/2),mf.sets.limit%2==0&&(startTxt="Best of ",setCount=mf.sets.limit),mf.sets.limit){if(setTxt=" Sets",1==setCount)return legDetector();html=startTxt+setCount+setTxt}else html="Set Play";return html}catch(e){return""}},legDetector=function(){try{if(mf.legs){if(mf.legs.mode)if("PLAY-ALL"==mf.legs.mode)if(mf.legs.limit){var legTxt=" Legs";1==mf.legs.limit&&(legTxt=" Leg"),html="Play "+mf.legs.limit+legTxt}else html="";else if("BEST-OF"==mf.legs.mode)if(mf.legs.limit){var startTxt,legCount;startTxt="First to ",legCount=Math.round(mf.legs.limit/2),mf.legs.limit%2==0&&(startTxt="Best of ",legCount=mf.legs.limit);legTxt=" Legs";1==mf.legs.limit&&(legTxt=" Leg"),html=startTxt+legCount+legTxt}else html="";return html}}catch(e){return""}};if(type){if("sets"==type)return setDetector();if("legs"==type)return legDetector()}return mf.sets?setDetector():legDetector()},setHasCompletedLegs:function(){var leg_wins=APP.session.getLegsStanding().split(" - ");return leg_wins[0]=parseInt(leg_wins[0]),leg_wins[1]=parseInt(leg_wins[1]),!(!leg_wins[0]&&!leg_wins[1])},getExtendedBroadcastDetails:function(){var oppo0=APP.game.opponent[0],oppo1=APP.game.opponent[1],lastScore1=!1,lastScore2=!1,score1=!1,score2=!1,dartsThrown1=!1,dartsThrown2=!1,firstName1=[],firstName2=[],lastName1=[],lastName2=[],winningDart=null,chalkboardName1=!1,chalkboardName2=!1,teamThrowingOrder1=!1,teamThrowingOrder2=!1,activePlayer1=!1,activePlayer2=!1,sets_mode=null,sets_limit=null,legs_mode=null,legs_limit=null,country_name1=[],country_name2=[],iso2_country1=[],iso2_country2=[],iso3_country1=[],iso3_country2=[],turnCount1=!1,turnCount2=!1,startPlayer=0,tournament=null,tournamentId=null,tournamentName=null,tournamentAudience=null,bracketMatchInfo=null,team1=null,team2=null,league_title=null,league_type=null,season_title=null,division_title=null,points_style=null,league_points_score_0=null,league_points_score_1=null,legDesc=null,roundLabel=null,roundId=null,amb_set_score_0=0,amb_set_score_1=0,amb_match_format_race=null,season_status=null,match_format_style=null,player_lineup_rule=null,player_lineup_mode=null,matchData=APP.nlf.rails.getRailsMatchData();matchData&&(amb_set_score_0=matchData.home_set_wins,amb_set_score_1=matchData.away_set_wins,amb_league_points_0=matchData.home_match_points,amb_league_points_1=matchData.away_match_points,season_status=matchData.season_status,match_format_style=matchData.match_format_style);var season_id=null,league_id=null,league_match_id=null,league_amb_set_id=null;if(APP.nlf.data.rails){var data=APP.nlf.data;if(data.league&&(season_id=data.league.season_id,league_id=data.league.league_id),data.railsMatch&&(league_match_id=data.railsMatch.league_match_id),data.railsChapter){league_amb_set_id=data.railsChapter.set_id;var matchRace=APP.nlf.rails.getMatchRace();matchRace&&(amb_match_format_race=matchRace)}}function dartsThrownCalculator(turns,returnType){for(var dartsThrown=0,lastScore=!1,turnCount=0,i=0;i<turns.length;i++){var turn=turns[i];dartsThrown+=turn.darts_thrown,turn.darts_thrown&&(lastScore=turn.points,turnCount++)}if(returnType)switch(returnType){case"count":return turnCount;case"score":return lastScore}return dartsThrown}function findFromPlayer(searchVar,playerGuid){for(var playerList=APP.header.teams[0].players,i=0;i<playerList.length;i++){var player=playerList[i];if(player.player_guid==playerGuid)return player[searchVar]}}try{APP.session.getTournamentID()&&(tournament=APP.session.tournaments[APP.session.getTournamentID()]),tournament&&(tournamentId=APP.session.getTournamentID(),tournamentName=tournament.match_description,tournamentAudience=tournament.audience);var bracketMatchId=APP.getMatch().bracket_event_id;if(bracketMatchId&&((bracketMatchInfo=APP.session.getBracketMatchInfo()).event_label=null,bracketMatchInfo.tv_title=null,tournament)){var bracketMatch=tournament.events[bracketMatchId];bracketMatch&&(bracketMatch.event_label&&(bracketMatchInfo.event_label=bracketMatch.event_label),bracketMatch.tv_title&&(bracketMatchInfo.tv_title=bracketMatch.tv_title),roundLabel=bracketMatchInfo.round_label,roundId=bracketMatchInfo.round_id,legDesc=APP.session.getFullMatchFormatSummary())}var ld,als,isLeague=APP.session.isLeaguePlay();if(isLeague)try{ld=APP.session.getMatchLeagueKey()||{},als=APP.getAssociatedLeagueSeason(ld.league_division_guid)}catch(e){}var railsMatchSettings,isRails=APP.nlf.data.rails;if(isLeague&&!isRails){var leagueMatchPoints=APP.session.getLeagueMatchScore();leagueMatchPoints&&(league_points_score_0=leagueMatchPoints.home_match_points,league_points_score_1=leagueMatchPoints.away_match_points)}if(isLeague&&isRails)try{player_lineup_rule=(railsMatchSettings=APP.nlf.data.league.match_settings).player_lineup_rule,player_lineup_mode=railsMatchSettings.player_lineup_mode}catch(e){}APP.game.isFirstOpponent(1)&&(startPlayer=1),dartsThrown1=dartsThrownCalculator(oppo0.turn),dartsThrown2=dartsThrownCalculator(oppo1.turn),lastScore1=dartsThrownCalculator(oppo0.turn,"score"),lastScore2=dartsThrownCalculator(oppo1.turn,"score"),turnCount1=dartsThrownCalculator(oppo0.turn,"count"),turnCount2=dartsThrownCalculator(oppo1.turn,"count"),APP.game.started&&"Cricket"==APP.game.name&&APP.game.getOption("no_points")?(score1=oppo0.getGameTotalMarksScored(),score2=oppo1.getGameTotalMarksScored()):(score1=oppo0.getCurrentScore(),score2=oppo1.getCurrentScore());for(var i=0;i<oppo0.team.players.length;i++){var player=oppo0.team.players[i];firstName1.push(player.first_name),lastName1.push(player.last_name),isLeague||(country_name1.push(findFromPlayer("country_name",player.player_guid)),iso2_country1.push(findFromPlayer("iso2_country",player.player_guid)),iso3_country1.push(findFromPlayer("iso3_country",player.player_guid)))}for(i=0;i<oppo1.team.players.length;i++){player=oppo1.team.players[i];firstName2.push(player.first_name),lastName2.push(player.last_name),isLeague||(country_name2.push(findFromPlayer("country_name",player.player_guid)),iso2_country2.push(findFromPlayer("iso2_country",player.player_guid)),iso3_country2.push(findFromPlayer("iso3_country",player.player_guid)))}turn1=APP.session.getTurns(0),turn2=APP.session.getTurns(1)}catch(e){}try{var mf=APP.getMatch().format;mf.legs&&(mf.legs.mode&&(legs_mode=mf.legs.mode),mf.legs.limit&&(legs_limit=mf.legs.limit)),mf.sets&&(mf.sets.mode&&(sets_mode=mf.sets.mode),mf.sets.limit&&(sets_limit=mf.sets.limit))}catch(e){}if(isLeague){als&&(season_title=als.season_label,league_title=als.longname,league_type=als.league_type,division_title=als.division_label,als.match_settings&&als.match_settings.points_style&&(points_style=als.match_settings.points_style));try{team1=APP.game.opponent[0].getTeam().team_name,team2=APP.game.opponent[1].getTeam().team_name}catch(e){}}try{firstName1.length>1&&(chalkboardName1=oppo0.chalkboard_name,teamThrowingOrder1=oppo0.player_order),firstName2.length>1&&(chalkboardName2=oppo1.chalkboard_name,teamThrowingOrder2=oppo1.player_order)}catch(e){}try{var ar=APP.game.active_round;firstName1.length>1&&(activePlayer1=teamThrowingOrder1[ar%oppo0.team.players.length]),firstName2.length>1&&(activePlayer2=teamThrowingOrder2[ar%oppo1.team.players.length])}catch(e){}try{APP.game&&APP.game.winning_dart&&(winningDart=APP.game.winning_dart)}catch(e){}var gameOpts=null;APP.game&&APP.game.options&&(gameOpts=APP.game.options);try{return{scoring_app_version:APP.version,game_options:gameOpts,backup_tablet:APP.markMatchAsBackup(),tournament_id:tournamentId,tournament_name:tournamentName,tournament_audience:tournamentAudience,bracket_info:bracketMatchInfo,match_guid:APP.getMatch().match_guid,winning_dart:winningDart,status:APP.game.started?"O":"W",legDesc:legDesc,roundLabel:roundLabel,roundId:roundId,is_set_play:APP.session.isSetPlay(),is_team:firstName1.length>1,start_player:startPlayer,current_player:APP.game.current_opponent,current_leg_number:APP.session.getCurrentSetLegsPlayed(),current_set_number:APP.session.getCurrentSetsPlayed(),set_race:APP.session.getFullMatchFormatSummary("sets"),leg_race:APP.session.getFullMatchFormatSummary("legs"),sets_mode:sets_mode,sets_limit:sets_limit,legs_mode:legs_mode,legs_limit:legs_limit,season_title:season_title,league_title:league_title,league_type:league_type,division_title:division_title,points_style:points_style,league_points_score_0:league_points_score_0,league_points_score_1:league_points_score_1,amb_set_score_0:amb_set_score_0,amb_set_score_1:amb_set_score_1,amb_match_format_race:amb_match_format_race,season_status:season_status,match_format_style:match_format_style,player_lineup_rule:player_lineup_rule,player_lineup_mode:player_lineup_mode,season_id:season_id,league_id:league_id,league_match_id:league_match_id,league_amb_set_id:league_amb_set_id,oppo_0:{current_score:score1,last_score:lastScore1,leg_score:parseInt(APP.session.getLegsStanding().split(" - ")[0]),set_score:APP.getMatch().set_wins[0],averages:APP.session.getMatchAverages(0),first_name:firstName1,last_name:lastName1,country_code:iso2_country1,country_name:country_name1,country_iso3:iso3_country1,player_order:oppo0.player_order,turn_count:turnCount1,darts_thrown:dartsThrown1,turns:turn1,player_turn_index:teamThrowingOrder1,team_initials:chalkboardName1,active_player:activePlayer1,team:team1},oppo_1:{current_score:score2,last_score:lastScore2,leg_score:parseInt(APP.session.getLegsStanding().split(" - ")[1]),set_score:APP.getMatch().set_wins[1],averages:APP.session.getMatchAverages(1),first_name:firstName2,last_name:lastName2,country_code:iso2_country2,country_name:country_name2,country_iso3:iso3_country2,player_order:oppo1.player_order,turn_count:turnCount2,darts_thrown:dartsThrown2,turns:turn2,player_turn_index:teamThrowingOrder2,team_initials:chalkboardName2,active_player:activePlayer2,team:team2},cricket:APP.session.getExtendedCricketObject()}}catch(e){return!1}},getExtendedCricketObject:function(){var cricObj=!1;try{if(!APP.game)return cricObj;if("Cricket"!=APP.game.name)return cricObj;var ar=APP.game.active_round,oppo0=APP.game.opponent[0],oppo1=APP.game.opponent[1];(cricObj={va:APP.game.options.variation,de:APP.game.plugin.calculateOpponentDeficit(),op:{},targets:{},lastTurn:!1}).lastTurn=APP.session.getLastTurnCricket();for(var targets=APP.game.target,i=0;i<targets.length;i++){var target=targets[i];0!=i&&(cricObj.targets[i]={l:target.label,v:target.value,c:APP.game.isTargetClosedOut(ar,i),0:{m:oppo0.getGameTargetMarksScored(i,!0),s:oppo0.getGameTargetPointsScored(i),h:oppo0.getTargetHandicapMark(i),t:APP.session.getCricketMarkType(0,i)},1:{m:oppo1.getGameTargetMarksScored(i,!0),s:oppo1.getGameTargetPointsScored(i),h:oppo1.getTargetHandicapMark(i),t:APP.session.getCricketMarkType(1,i)}})}var opts=APP.game.options,noBull=opts.no_bull;noBull&&(cricObj.op.no_bull=noBull);var noPoints=opts.no_points;noPoints&&(cricObj.op.no_points=noPoints);var call=opts.call;call&&(cricObj.op.call=call);var drop10=opts.drop_10;drop10&&(cricObj.op.drop_10=drop10);var nl=opts.dutch_tactics;nl&&(cricObj.op.dutch_tactics=nl)}catch(e){console.log(e)}return cricObj},getCricketMarkType:function(in_oppo,in_index){for(var id="sb-c-r"+in_index+"-t"+in_oppo,classList=document.getElementById(id).classList,type=!1,i=0;i<classList.length;i++){var myClass=classList[i];myClass.indexOf("mark-")>-1&&(type=(type=myClass.replace("mark-","")).replace("close","C"))}return type},getLastTurnCricket:function(){try{var oppo=APP.game.current_opponent,cr=APP.game.current_round;if(!APP.plugin_cricket.is_game_shot){var starter=APP.game.opponent_order[0];(oppo=1==oppo?0:1)&&!starter&&(cr-=1),!oppo&&starter&&(cr-=1)}var lastTurn=APP.game.opponent[oppo].turn[cr];if(!lastTurn)return!1;if(!lastTurn.darts_thrown)return!1;var isMiss=!lastTurn.marks_recorded&&!lastTurn.marks_scored;return{marks:lastTurn.target_marks.slice(1),points:lastTurn.target_points.slice(1),oppo:oppo,isMiss:isMiss,gameShot:APP.plugin_cricket.is_game_shot}}catch(e){}return!1},getTurns:function(player){try{if("01"!=APP.game.name)return"Cricket"==APP.game.name&&APP.session.getCricketTurns(player);for(var turnArr=[],turns=APP.game.opponent[player].turn,i=0;i<turns.length;i++){var turn=turns[i];(turn.current_score||turn.points)&&(0==turn.points&&turn.color?turnArr.push(turn.color):turnArr.push(turn.points))}return turnArr}catch(e){return!1}},getCricketTurns:function(player){try{for(var turnArr=[],turns=APP.game.opponent[player].turn,i=0;i<turns.length;i++){var turn=turns[i];if(turn){var obj={marks:turn.target_marks.slice(1),points:turn.target_points.slice(1)};turnArr.push(obj)}}return turnArr}catch(e){return!1}},isSuppressPoints:function(){return"SUPPRESS"==(APP.session.getMatchFormat()||{}).points_style},setTournamentEventType:function(in_event_type){var sess=APP.session;sess.matches[sess.current_match].tournament_event_type=in_event_type,sess.store(sess.current_match)},getTournamentEventType:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.tournament_event_type:null},setTiebreaker:function(in_tiebreaker){var sess=APP.session;sess.matches[sess.current_match].tiebreaker=in_tiebreaker,sess.store(sess.current_match)},getTiebreaker:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.tiebreaker:null},setMatchMoney:function(in_money){var sess=APP.session;sess.matches[sess.current_match].money_round=in_money,sess.store(sess.current_match)},getMatchMoney:function(){var cm,sess=APP.session;return(cm=sess.matches[sess.current_match])?cm.money_round:null},isLastSet:function(){var cm,sess=APP.session,done=!1;if(!(cm=sess.matches[sess.current_match]).format||!cm.format.sets)return done;if("BEST-OF"==cm.format.sets.mode&&parseInt(cm.format.sets.limit,10)>1){if(cm.format.sets.limit%2==0){if(cm.set_wins[0]+cm.set_wins[1]==cm.format.sets.limit)return!0;var magicNumber=cm.format.sets.limit/2+1;return cm.set_wins[0]>=magicNumber||cm.set_wins[1]>=magicNumber}done=cm.set_wins[0]==Math.round(cm.format.sets.limit/2)||cm.set_wins[1]==Math.round(cm.format.sets.limit/2);try{cm.format.sets&&cm.format.sets.min_sets&&(done=cm.set_wins[0]>=Math.round(cm.format.sets.limit/2)||cm.set_wins[1]>=Math.round(cm.format.sets.limit/2))}catch(e){}}else done=sess.current_set+1==cm.format.sets.limit;return done},isFirstSet:function(){try{return 0==APP.session.current_set}catch(e){return!1}},isFirstLeg:function(){try{return 0==APP.getGame().games.length}catch(e){return!1}},isDecidingLeg:function(){try{var sess=APP.session,mf=sess.getMatchFormat()||{};if(!mf.legs||!BBAT.isNumeric(mf.legs.limit))return!1;if(mf.legs.limit%2==0)return!1;var isDecidingSet=APP.session.isDecidingSet();if(isDecidingSet&&mf.win_by_two&&"Y"==mf.win_by_two){var gw0=sess.getWins(null,"LEGS",0,!1),gw1=sess.getWins(null,"LEGS",1,!1);parseInt(mf.legs.max,10);if(mf.win_by_two&&"Y"==mf.win_by_two&&isDecidingSet&&mf.legs.max)return gw0==gw1&&gw0+gw1==mf.legs.max-1}return"BEST-OF"==mf.legs.mode?mf.legs.limit-sess.getCurrentSetLegsPlayed()==1:"PLAY-ALL"==mf.legs.mode&&(mf.legs.limit-sess.getCurrentSetLegsPlayed()==1&&APP.getMatch().game_wins[0]==APP.getMatch().game_wins[1])}catch(e){return!1}},isDecidingSet:function(nudge){try{var sess=APP.session,mf=sess.getMatchFormat()||{},setsPlayed=sess.getCurrentSetsPlayed();return 1==mf.sets.limit&&0==APP.session.getCurrentSetsPlayed()||!(!mf.sets||!BBAT.isNumeric(mf.sets.limit))&&(mf.sets.limit%2!=0&&("BEST-OF"==mf.sets.mode?(nudge&&setsPlayed++,mf.sets.limit-setsPlayed==1):"PLAY-ALL"==mf.sets.mode&&(nudge&&setsPlayed++,mf.sets.limit-setsPlayed==1&&APP.getMatch().set_wins[0]==APP.getMatch().set_wins[1])))}catch(e){return!1}},addSet:function(in_game_name){var cm,pts,pts_style,sess=APP.session,mf=(sess.getMatchMode(),sess.getMatchFormat()||{});("HOST"==APP.device.role||APP.device.has_chalk)&&(cm=sess.matches[sess.current_match],null==sess.current_set||cm.sets[sess.current_set].forfeited||0!=cm.sets[sess.current_set].game_results.length||cm.sets.pop(),sess.isLeaguePlay()?(pts_style=mf.points_style?mf.points_style:"PER-SET",pts="VARIES"==mf.points_style?mf.points:1):(pts_style=null,pts=1),cm?(cm.sets.push(new sess.Set([APP.game.opponent[0].getTeam(),APP.game.opponent[1].getTeam()],[APP.game.opponent[0].getChalkboardName(),APP.game.opponent[1].getChalkboardName()],pts_style,pts)),sess.current_set=cm.sets.length-1,1==APP.game.opponent_count&&(cm.sets[sess.current_set].chalkboard_names[1]=""),APP.game.name||APP.game_selector.selectGame(in_game_name||null),mf.same_legs||sess.resetMatchFormatLegs(),sess.store(sess.current_match),APP.storeState({settings_change:!0})):APP.session.startNew("MATCH"))},setSetPoints:function(in_points){var sess=APP.session;null!=sess.current_match&&null!=sess.current_set&&(sess.matches[sess.current_match].sets[sess.current_set].points=in_points,sess.store(sess.current_match))},setSetPointsStyle:function(in_style){var sess=APP.session;null!=sess.current_match&&null!=sess.current_set&&(sess.matches[sess.current_match].sets[sess.current_set].points_style=in_style,sess.store(sess.current_match))},getSetPointsStyle:function(in_set){var sess=APP.session;return null==sess.current_match||null==sess.current_set?null:(null==in_set?sess.matches[sess.current_match].sets[sess.current_set]:sess.matches[sess.current_match].sets[0]).points_style},getSetPoints:function(){var cs,sess=APP.session;return null==sess.current_match||null==sess.current_set?0:null==(cs=sess.matches[sess.current_match].sets[sess.current_set]).points?1:cs.points},getLeg:function(){var cs,sess=APP.session;if(null==sess.current_match||null==sess.current_set)return 0;try{return(cs=sess.matches[sess.current_match].sets[sess.current_set]).wins[0]+cs.wins[1]}catch(err){return APP.recordError("getLeg: "+sess.current_match+":"+sess.current_set+":"+err),0}},getLegsStanding:function(){var cs,sess=APP.session;if(null==sess.current_match||null==sess.current_set)return"0 - 0";try{return(cs=sess.matches[sess.current_match].sets[sess.current_set]).wins[0]+" - "+cs.wins[1]}catch(err){return APP.recordError("Limbo eD.wins error - current_match: "+sess.current_match+" current_set: "+sess.current_set),"0 - 0"}},getPrevGamePlayerOrder:function(in_opponent_index){var cs,pgi,sess=APP.session;if(null==sess.current_match||null==sess.current_set||sess.isNewSet())return[];pgi=(cs=sess.matches[sess.current_match].sets[sess.current_set]).games.length-1;var playerOrder=[];try{playerOrder=cs.games[pgi].opponents[in_opponent_index].player_order}catch(e){}return playerOrder},getMatchMode:function(){var sess=APP.session;return null==sess.current_match?null:sess.matches[sess.current_match].mode},resetMatchBroadcast:function(){var sess=APP.session;null!=sess.current_match&&(sess.matches[sess.current_match].broadcast_matches_status=null,sess.store(sess.current_match))},getMatchBroadcastStatus:function(){var sess=APP.session;return null==sess.current_match?null:sess.matches[sess.current_match].broadcast_matches_status},setMatchBroadcastStatus:function(in_status){var sess=APP.session;null!=sess.current_match&&(sess.matches[sess.current_match].broadcast_matches_status=in_status,sess.store(sess.current_match))},setgetMatchBroadcastStart:function(){var sess=APP.session;return null==sess.current_match?null:(sess.matches[sess.current_match].broadcast_matches_start||(sess.matches[sess.current_match].broadcast_matches_start=new Date,sess.store(sess.current_match)),sess.matches[sess.current_match].broadcast_matches_start)},getMatchBroadcastID:function(){var sess=APP.session;return null==sess.current_match?null:sess.matches[sess.current_match].broadcast_matches_id},setMatchBroadcastID:function(in_id){var sess=APP.session;null!=sess.current_match&&(sess.matches[sess.current_match].broadcast_matches_id=in_id,sess.store(sess.current_match))},getTournamentTablets:function(){var sess=APP.session,tournamentId=sess.getTournamentID();return tournamentId?sess.tournaments[tournamentId].tablet:null},getTournamentName:function(){var sess=APP.session;if(null==sess.current_match)return null;var tournamentId=null;try{tournamentId=sess.matches[sess.current_match].description}catch(e){}return tournamentId},getTournamentID:function(){var sess=APP.session;if(null==sess.current_match)return null;var tournamentId=null;try{tournamentId=sess.matches[sess.current_match].tournament_id}catch(e){}return tournamentId},getFromTournament:function(val){APP.session;var tournamentId=APP.session.tournament_id;if(tournamentId||(tournamentId=APP.session.getTournamentID()),!tournamentId)return null;try{var tournament=APP.session.tournaments[tournamentId];return tournament[val]?tournament[val]:null}catch(e){}return null},getFromMatch:function(val){try{var matchList=APP.session.bracket.match_list,match=APP.getMatch();if(matchList&&match)if((match=matchList[match.bracket_match_id+"_"+match.bracket_event_id])[val])return match[val]}catch(e){}return null},getTournamentType:function(){APP.session;var tournamentId=APP.session.tournament_id;if(tournamentId||(tournamentId=APP.session.getTournamentID()),!tournamentId)return null;try{var tournament=APP.session.tournaments[tournamentId];return tournament.tournament_type?tournament.tournament_type:null}catch(e){return null}return null},getMatchScore:function(){var m,sess=APP.session;return null==sess.current_match?null:(m=sess.matches[sess.current_match]).format&&m.format.sets&&1==m.format.sets.limit?m.game_wins.slice(0):m.set_wins.slice(0)},getTournamentMatchScore:function(){var m,sess=APP.session;return null==sess.current_match?null:"TOURNAMENT"==(m=sess.matches[sess.current_match]).mode||APP.session.isLeaguePlay()?m.format&&m.format.sets&&1==m.format.sets.limit?m.game_wins.slice(0):m.set_wins.slice(0):null},switchToGameMode:function(){var sess=APP.session;null!=sess.current_match&&(sess.matches[sess.current_match].mode="GAME")},getMatchLeagueKey:function(){var sess=APP.session;if(null==sess.current_match)return null;var cm=sess.matches[sess.current_match];return{league_id:cm.league_id,league_division_guid:cm.league_division_guid,season_status:cm.season_status}},getLeagueDefinition:function(in_key){var i,i_len,l,ula=(APP.user?APP.user.league_associations:null)||[];if(!in_key)return null;if(in_key.league_division_guid&&in_key.season_status){for(i_len=ula.length,i=0;i<i_len;i++)if(ula[i].league_division_guid==in_key.league_division_guid&&ula[i].season_status==in_key.season_status)return ula[i]}else if(in_key.league_id)return l=APP.session.leagues[in_key.league_id.toUpperCase()],{league_id:in_key.league_id,league_type:l.match_mode,longname:l.description,shortname:in_key.league_id};return null},getCurrentLeague:function(){var currentLeague=null;try{for(var sess=APP.session,cm=sess.matches[sess.current_match],ula=APP.user.league_associations,i=0;i<ula.length;i++){var league=ula[i];league.league_division_guid==cm.league_division_guid&&(currentLeague=league)}}catch(e){currentLeague=null}return currentLeague},currentLeagueIsGroup:function(league){var isGroup=!1;try{league||(league=APP.session.getCurrentLeague()),league&&("Y"==league.is_group||league.is_auto_group)&&(isGroup=!0)}catch(e){}return isGroup},isPartyPlay:function(){var m,sess=APP.session;return null!=sess.current_match&&("MATCH"==(m=sess.matches[sess.current_match].mode)||"GAME"==m)},lockMatchFormat:function(){var mf;return!!APP.session.isLeaguePlay()&&(!!(mf=APP.session.getMatchLeagueKey()).league_id&&("pteam"!=mf.league_id&&"psingles"!=mf.league_id))},isLeaguePlay:function(){var m,sess=APP.session;return null!=sess.current_match&&("TEAM"==(m=sess.matches[sess.current_match].mode)||"SINGLES"==m)},showNewSetLegSelectorLeague:function(){if(APP.session.isNewSet()&&APP.session.isLeaguePlay()){var mf=APP.session.getMatchFormat();try{mf.legs&&(mf.legs.limit&&mf.legs.limit||(APP.header.has_seen_legs_menu=!1,APP.header.showSetSetup()))}catch(e){}}},isNewMatch:function(){var sess=APP.session;return null==sess.current_match||(0==sess.matches[sess.current_match].sets.length||0==sess.matches[sess.current_match].sets[0].game_results.length&&!sess.matches[sess.current_match].sets[0].forfeited)},updateMatchRole:function(in_role){var cm,sess=APP.session;null!=sess.current_match&&((cm=sess.matches[sess.current_match]).role||(cm.role=in_role))},updateSetTeams:function(){var sess=APP.session,cs=sess.matches[sess.current_match].sets[sess.current_set],gam=APP.game;cs.teams=[],cs.teams[0]=gam.cloneTeam(gam.opponent[0].team),cs.teams[1]=gam.cloneTeam(gam.opponent[1].team)},isSetPlay:function(){try{var mf=APP.session.getMatchFormat();if(!mf||!mf.sets||!mf.sets.limit)return!!(APP.getMatch().sets&&APP.getMatch().sets.length>1);var isSetPlay=!1;return mf.sets.limit>1&&(isSetPlay=!0),isSetPlay}catch(e){return!1}},isSetDone:function(){var sess=APP.session,mf=sess.getMatchFormat(),mm=sess.getMatchMode(),uo=APP.user_options,done=!1;try{if(!mf||!mf.legs||!mf.legs.limit){if(!(mf.legs_limit&&mf.legs&&mf.legs.mode)||mf.legs.limit)return!1;mf.legs.limit=mf.legs_limit}}catch(e){return!1}var gw0=sess.getWins(null,"LEGS",0,!1),gw1=sess.getWins(null,"LEGS",1,!1),limit=parseInt(mf.legs.limit,10),isDecidingSet=APP.session.isDecidingSet();if(mf.win_by_two&&"Y"==mf.win_by_two&&isDecidingSet)return done=mf.legs.max?(gw0>limit/2||gw1>limit/2)&&(Math.abs(gw0-gw1)>=2||gw0+gw1>=mf.legs.max):(gw0>limit/2||gw1>limit/2)&&Math.abs(gw0-gw1)>=2;"TOURNAMENT"==mm&&"MATCHPLAY"==uo.tournament_mode&&isDecidingSet?done=BBAT.isNumeric(uo.tournament_leg_max)?(gw0>limit/2||gw1>limit/2)&&(Math.abs(gw0-gw1)>=2||gw0+gw1>=uo.tournament_leg_max):(gw0>limit/2||gw1>limit/2)&&Math.abs(gw0-gw1)>=2:mf.legs&&"BEST-OF"==mf.legs.mode?(done=gw0>limit/2||gw1>limit/2)||mf.legs.limit%2!=0||(done=gw0+gw1==mf.legs.limit):done=gw0+gw1>=limit;try{if(mf.legs.min_legs)gw0+gw1<mf.legs.min_legs&&(done=!1)}catch(e){}return done},popSet:function(){var cs,cm,sess=APP.session;"HOST"==APP.device.role&&null!=sess.current_set&&((cm=sess.matches[sess.current_match]).sets.pop(),sess.current_set=cm.sets.length?cm.sets.length-1:null,sess.store(sess.current_match),null==sess.current_set?(APP.game.opponent[0].setTeam(APP.game.dflt_host_team),APP.game.opponent[1].setTeam(APP.game.dflt_guest_team),APP.game_selector.selectGame(null)):(cs=cm.sets[sess.current_set],APP.game.opponent[0].setTeam(cs.teams[0],cm.mode),APP.game.opponent[1].setTeam(cs.teams[1],cm.mode),APP.game_selector.selectGame(null)),APP.storeState({settings_change:!0}),APP.header.refresh())},captureReloadData:function(){var i,cmd,sess=APP.session,prior_leg={};if(!APP.is_reloading&&null!=sess.current_match&&null!=sess.current_set&&sess.matches[sess.current_match].sets[sess.current_set].games.length){for(prior_leg.commands=[],i=1,cmd=BBAT.fetchData(APP.formatCmd(i));cmd;)prior_leg.commands.push(cmd),i+=1,cmd=BBAT.fetchData(APP.formatCmd(i));prior_leg.settings=BBAT.fetchData("game_settings"),BBAT.storeData({prior_leg:prior_leg})}},allowReloadPriorLeg:function(){return!!APP.device.has_chalk&&(!APP.session.isNewMatch()&&((0!=APP.session.getCurrentSetLegsPlayed()||!APP.session.isPreviousSetForfeit())&&(!APP.game.isBotPlaying()&&!!BBAT.fetchData("prior_leg"))))},reloadPriorLeg:function(){var cs,glen,i,ilen,json,prior_leg,obj={},sess=APP.session;function killOnline(){alert('Failed to update the server... Closing "Compete Online"'),APP.revertToLocalPlay(),APP.server.closeAlley({success:APP.reload,error:APP.reload})}if(APP.device.has_chalk&&"HOST"==APP.device.role&&!APP.is_reloading&&(prior_leg=BBAT.fetchData("prior_leg"))){for(sess.isNewSet()&&sess.popSet(),glen=(cs=sess.matches[sess.current_match].sets[sess.current_set]).games.length,cs.games[glen-1],prior_leg.settings.reload_count++,APP.device.is_hosting&&(prior_leg.settings.game_id=APP.server.game_id,prior_leg.settings.settings_version=APP.settings_version+1),BBAT.storeData({game_settings:prior_leg.settings}),APP.cmd_seq=0,ilen=prior_leg.commands.length,i=0;i<ilen;i++)"FINISH_GAME"==(json=prior_leg.commands[i]).cmd&&i==ilen-1&&(json.cmd_data.finish_time=new Date,APP.session.setMatchFormat(json.cmd_data.match_summary.format),APP.session.store()),obj[APP.formatCmd(i+1)]=json;i>0&&(json={cmd:"KEY",cmd_data:{code:"btn-back"}},obj[APP.formatCmd(i+1)]=json,BBAT.storeData(obj)),APP.cmd_seq=i+1,BBAT.storeData({prior_leg:null}),APP.session.popGameResults(),APP.mode="IN_GAME",APP.storeState(),BBAT.storeData({prior_leg_reload:!0}),APP.device.is_hosting?(APP.device.showSpinnerOverlay(),APP.processGameSettings(prior_leg.settings),APP.server.setGameSettings({success:function(){APP.server.submitGameEvent({cmd_seq:APP.cmd_seq,success:APP.reload,error:killOnline})},error:killOnline}),APP.device.hideSpinnerOverlay()):APP.reload()}},popGameResults:function(){var cm,cs,sess=APP.session;(cs=(cm=sess.matches[sess.current_match]).sets[sess.current_set]).game_results.length&&(cs.wins[cs.game_results[cs.game_results.length-1].winning_opponent]--,cs.game_results.pop(),cs.games.pop(),sess.setMatchDynamicInfo(cm)),"HOST"==APP.device.role&&sess.store(sess.current_match)},setMatchDynamicInfo:function(in_match){var m,s,s_len,i,g,g_len,j,o,p,p_len,players,n,names,add_name;APP.session;if((m=in_match).title=null,m.start_time=null,m.finish_time=null,m.game_count=0,m.was_hosting=m.was_hosting||APP.device.is_hosting,m.was_broadcasting=m.was_broadcasting||APP.device.is_broadcasting,m.game_time=0,m.player_count=0,m.rounds=0,m.match_points[0]=null,m.match_points[1]=null,m.game_wins[0]=0,m.game_wins[1]=0,m.set_wins[0]=0,m.set_wins[1]=0,m.points[0]=0,m.points[1]=0,m.point_darts[0]=0,m.point_darts[1]=0,m.marks[0]=0,m.marks[1]=0,m.mark_darts[0]=0,m.mark_darts[1]=0,m.high_points_turn.length=0,m.high_points_in.length=0,m.high_points_out.length=0,m.high_marks_turn.length=0,m.high_bull_turn.length=0,m.high_marks_in.length=0,m.high_marks_out.length=0,0!=m.sets[0].games.length||m.sets[0].forfeited){for(m.start_time=m.sets[0].forfeited?m.sets[0].forfeit_time:m.sets[0].games[0].start_time,names=[],s_len=m.sets.length,i=0;i<s_len;i++){s=m.sets[i];var calcLastSet=!1;if(APP.session.isSetDone()&&(calcLastSet=!0),i==s_len-1?calcLastSet&&(s.wins[0]>s.wins[1]?m.set_wins[0]++:s.wins[1]>s.wins[0]&&m.set_wins[1]++):s.wins[0]>s.wins[1]?m.set_wins[0]++:s.wins[1]>s.wins[0]&&m.set_wins[1]++,s.forfeited)m.finish_time=s.forfeit_time;else if(m.game_count+=s.games.length,m.game_wins[0]+=s.wins[0],m.game_wins[1]+=s.wins[1],"HOST"==APP.device.role)for((g_len=s.games.length)&&(g=s.games[s.games.length-1],m.finish_time=new Date(new Date(g.start_time).valueOf()+g.elapsed_time)),j=0;j<g_len;j++)if(-1!=(g=s.games[j]).game_guid){if("GAME"==m.mode)for(o=0;o<2;o++)for(p_len=(players=g.opponents[o].team.players).length,p=0;p<p_len;p++){for(add_name=!0,n=0;n<names.length;n++)if(names[n]==players[p].first_name){add_name=!1;break}add_name&&names.push(players[p].first_name)}m.game_time+=g.elapsed_time,m.rounds+=g.opponents[0].stats.turns_played,m.rounds+=2==g.opponent_count?g.opponents[1].stats.turns_played:0,"POINTS"==g.options.stats_type?(m.points[0]+=g.opponents[0].stats.points,m.points[1]+=2==g.opponent_count?g.opponents[1].stats.points:0,m.point_darts[0]+=g.opponents[0].stats.darts_thrown,m.point_darts[1]+=2==g.opponent_count?g.opponents[1].stats.darts_thrown:0,setBest(m.high_points_turn,g,"HIGH POINTS"),setBest(m.high_points_in,g,"HIGH POINTS IN"),setBest(m.high_points_out,g,"HIGH POINTS OUT")):(m.marks[0]+=g.opponents[0].stats.marks_scored,m.marks[1]+=2==g.opponent_count?g.opponents[1].stats.marks_scored:0,m.mark_darts[0]+=g.opponents[0].stats.darts_thrown,m.mark_darts[1]+=2==g.opponent_count?g.opponents[1].stats.darts_thrown:0,setBest(m.high_marks_turn,g,"HIGH MARKS"),setBest(m.high_marks_in,g,"HIGH MARKS IN"),setBest(m.high_marks_out,g,"HIGH MARKS OUT"),setBest(m.high_bull_turn,g,"HIGH BULL MARKS"))}}if(g)switch(m.mode){case"TEAM":case"SINGLES":case"MATCH":case"TOURNAMENT":m.title=g.opponents[0].chalkboard_name+" v. "+g.opponents[1].chalkboard_name;break;case"GAME":m.title=names.join(", ");break;case"SOLO":m.title=m.game_count+" Practice Games"}else m.title=APP.game.opponent[0].chalkboard_name+" v. "+APP.game.opponent[1].chalkboard_name}function setBest(in_best,in_game,in_type){var add_it,b_len,i,j,match_best,my_best,your_best,v,t,oppo=[in_game.opponents[0],in_game.opponents[1]],best=[{turn:0,value:0},{turn:0,value:0}];for(i=0;i<in_game.opponent_count;i++){switch(in_type){case"HIGH POINTS":v=oppo[i].stats.hi_points,t=oppo[i].stats.hi_points_turn-1;break;case"HIGH POINTS IN":v=oppo[i].stats.first_score,t=oppo[i].stats.first_scoring_turn-1;break;case"HIGH POINTS OUT":oppo[i].stats.winning_score?(v=oppo[i].stats.winning_score,t=oppo[i].stats.winning_turn-1):(v=-1,t=-1);break;case"HIGH MARKS":v=oppo[i].stats.hi_marks,t=oppo[i].stats.hi_marks_turn-1;break;case"HIGH MARKS IN":v=oppo[i].stats.first_score,t=oppo[i].stats.first_scoring_turn-1;break;case"HIGH MARKS OUT":oppo[i].stats.winning_score?(v=oppo[i].stats.winning_score,t=oppo[i].stats.winning_turn-1):(v=-1,t=-1);break;case"HIGH BULL MARKS":v=oppo[i].stats.hi_bull,t=oppo[i].stats.hi_bull_turn-1}v>best[i].value&&(best[i].value=v,best[i].turn=t)}for(i=0;i<in_game.opponent_count;i++)try{var my_chalkboard_name;if(my_best=best[i].value,your_best=best[0==i?1:0].value,match_best=0==in_best.length?0:in_best[0].value,my_chalkboard_name=oppo[i].player_order.length&&oppo[i].player_tracking&&oppo[i].team.players[oppo[i].turns[best[i].turn].player_index]?oppo[i].team.players[oppo[i].turns[best[i].turn].player_index].chalkboard_name:oppo[i].chalkboard_name,my_best>match_best&&my_best>=your_best)in_best.length=0,in_best.push(new APP.session.Best({opponent_index:i,player_chalkboard_name:my_chalkboard_name,value:my_best}));else if(my_best==match_best){for(add_it=!0,b_len=in_best.length,j=0;j<b_len;j++)if(in_best[j].player_chalkboard_name==my_chalkboard_name){add_it=!1;break}add_it&&in_best.push(new APP.session.Best({opponent_index:i,player_chalkboard_name:my_chalkboard_name,value:my_best}))}}catch(e){throw APP.reload(),Error("Stop processing")}}},calculateRealSetWins:function(sets){for(var oppo1=0,oppo2=0,i=0;i<sets.length;i++){var set=sets[i];try{var wins=set.wins;wins[0]>wins[1]&&oppo1++,wins[1]>wins[0]&&oppo2++}catch(e){}}return[oppo1,oppo2]},getAGP:function(in_stats_type){var cm,v,p,d,sess=APP.session;return cm=sess.matches[sess.current_match],"POINTS"==in_stats_type?(v=cm.points[0]+cm.points[1],d=cm.point_darts[0]+cm.point_darts[1],p=0):(v=cm.marks[0]+cm.marks[1],d=cm.mark_darts[0]+cm.mark_darts[1],p=1),0==d?0:BBAT.round(v/d*3,p)},getM3DA:function(in_stats_type,in_opponent_index,non_rounded){var cm,v,p,d,name,set,s,s_len,game,g,g_len,stats,sess=APP.session,o=in_opponent_index;function calcM3DA(in_d,in_v,in_p,non_rounded){return in_v&&in_d?non_rounded?APP.user_options.running_1da?0==in_d?0:(in_v/in_d).toFixed(3):0==in_d?0:(in_v/in_d*3).toFixed(3):APP.user_options.running_1da?0==in_d?0:BBAT.round(in_v/in_d,in_p):0==in_d?0:BBAT.round(in_v/in_d*3,in_p):0}if(null===sess.current_match)return 0;if(cm=sess.matches[sess.current_match],p="POINTS"==in_stats_type?0:1,"GAME"==sess.getMatchMode()){for(d=0,v=0,name=APP.game.opponent[o].getChalkboardName(),s_len=cm.sets.length,s=0;s<s_len;s++)for(g_len=(set=cm.sets[s]).games.length,g=0;g<g_len;g++)if((game=set.games[g]).options&&game.options.stats_type==in_stats_type){if(game.opponents[0].chalkboard_name==name)stats=game.opponents[0].stats;else{if(game.opponents[1].chalkboard_name!=name)continue;stats=game.opponents[1].stats}d+=stats.darts_thrown,v+="POINTS"==in_stats_type?stats.points||0:stats.marks_scored||0}return calcM3DA(d,v,p,non_rounded)}"POINTS"==in_stats_type?(v=cm.points[o],d=cm.point_darts[o]):(v=cm.marks[o],d=cm.mark_darts[o]);try{if(!APP.game.finished){for(var turns=APP.game.opponent[in_opponent_index].turn,currentGameScore=0,currentGameDarts=0,i=0;i<turns.length;i++){var turn=turns[i];currentGameDarts+=turn.darts_thrown,currentGameScore+="POINTS"==in_stats_type?turn.points:turn.marks_scored}currentGameDarts>0&&(d+=currentGameDarts),currentGameScore>0&&(v+=currentGameScore)}}catch(e){}return calcM3DA(d,v,p,non_rounded)},getWins:function(in_match,in_type,in_opponent_index,in_final){var m,len,s,i,io,oo,sess=APP.session,wins=0;if(0==(m=in_match||sess.matches[sess.current_match]).sets.length)return 0;if("LEGS"==in_type)return m.sets[m.sets.length-1].wins[in_opponent_index];for(oo=0==(io=in_opponent_index)?1:0,len=m.sets.length,"SETS"!=in_type||in_final||(len=m.sets.length-1),i=0;i<len;i++)s=m.sets[i],"SETS"==in_type?s.wins[io]>s.wins[oo]&&wins++:wins+=s.forfeited?0:s.wins[io];return wins},setMatchNotes:function(in_notes,is_manual){var cm,sess=APP.session;"HOST"==APP.device.role&&null!=sess.current_set&&(cm=sess.matches[sess.current_match],in_notes=(in_notes=in_notes.trim()).left(1500),cm.notes=in_notes.length?in_notes:null,is_manual&&(cm.manual_notes=!0),sess.store(sess.current_match))},getMatchNotes:function(){var cm,sess=APP.session;return"HOST"!=APP.device.role?"":(cm=sess.matches[sess.current_match]).notes?cm.notes:""},setGameNotes:function(in_notes){var g,gs,sess=APP.session;"HOST"==APP.device.role&&null!=sess.current_set&&0!=(gs=sess.matches[sess.current_match].sets[sess.current_set].games).length&&(g=gs[gs.length-1],0==(in_notes=(in_notes=in_notes.trim()).left(1500)).length?g.notes=null:g.notes=in_notes,sess.store(sess.current_match))},getGameNotes:function(){var g,gs,sess=APP.session;return"HOST"!=APP.device.role||null==sess.current_set||0==(gs=sess.matches[sess.current_match].sets[sess.current_set].games).length?"":(g=gs[gs.length-1]).notes?g.notes:""},isGameRecorded:function(in_game_start_time){var len,cs,sess=APP.session;return!!in_game_start_time&&(!!(len=(cs=sess.matches[sess.current_match].sets[sess.current_set]).game_results.length)&&new Date(cs.game_results[len-1].start_time).valueOf()==in_game_start_time.valueOf())},addGameResults:function(in_spec){var cm,cs,i,ig,g,o,io,it,its,its_len,j,t,sess=APP.session;if(("HOST"==APP.device.role||APP.device.has_chalk)&&null!=sess.current_set){if(cm=sess.matches[sess.current_match],APP.game.isBotPlaying()&&(cm.suppress_recap_email=APP.user_options.dartbot_suppress_email,sess.store(sess.current_match)),"TOURNAMENT"==APP.session.getMatchMode()){var mf=APP.session.getMatchFormat()||{};mf.legs&&"PLAY-ALL"==mf.legs.mode?cm.suppress_recap_email=!0:cm.suppress_recap_email=!1,sess.store(sess.current_match)}for((cs=cm.sets[sess.current_set]).game_results.push(new sess.GameResult(in_spec)),cs.wins[in_spec.winning_opponent]++,ig=in_spec.game,g={game_guid:null,abandoned:in_spec.abandoned,remote_play:!!APP.device.is_hosting,reload_count:ig.reload_count,type:ig.name,name:in_spec.game_name,start_time:ig.start_time,elapsed_time:ig.elapsed_time,deepest_initiated_edit:ig.deepest_initiated_edit,winning_dart:ig.winning_dart,winning_opponent:ig.winning_opponent,cork_winner:ig.cork_winner,sudden_death_win:ig.sudden_death_win,leg_forfeit:ig.leg_forfeit,opponent_count:ig.opponent_count,opponent_order:ig.opponent_order.slice(0),track_do_attempts:in_spec.track_do_attempts,opponents:[],score_edits:[],league_practice_game:APP.nlf.rails.isPracticeMatch()},APP.ffwd.isActive&&(g.game_guid="ffwd"),ig.score_edits&&(g.score_edits=ig.score_edits),g.options={},$.extend(g.options,ig.options),g.dyg_target=[],$.extend(g.dyg_target,ig.dyg_target),g.target=[],$.extend(g.target,ig.target),i=0;i<ig.opponent_count;i++)for(g.opponents[i]={},o=g.opponents[i],io=ig.opponent[i],o.chalkboard_name=APP.game.isBotChalkboardName(io.chalkboard_name)?"DartConnect":io.chalkboard_name,o.starting_score=io.starting_score,o.current_score=io.current_score,o.handicap=io.handicap,o.handicap_marks=io.handicap_marks?io.handicap_marks.slice(0):[],o.player_tracking=io.player_tracking,o.player_order=io.player_order.slice(0),o.team=APP.game.cloneTeam(io.team),o.stats={},$.extend(o.stats,io.stats),o.player_order.length!=o.team.players.length&&APP.recordError("HEY! Player Order Error!",!1),o.turns=[],its_len=(its=io.turn).length,j=0;j<its_len;j++)it=its[j],o.turns.push({}),(t=o.turns[j]).current_score=it.current_score,t.do_attempts=it.do_attempts,t.darts_thrown=it.darts_thrown,t.r3da=it.r3da,t.r1da=it.r1da,t.color=it.color,t.player_index=it.player_index,t.marks_recorded=it.marks_recorded,t.marks_scored=it.marks_scored,t.points=it.points,t.target_marks=it.target_marks.slice(0),t.target_points=it.target_points.slice(0),t.user_input=it.user_input.slice(0);cs.games.push(g),sess.setMatchDynamicInfo(cm),sess.store(sess.current_match)}},isNewSet:function(){var cm,sess=APP.session;return null==sess.current_match||null==sess.current_set||(!(cm=sess.matches[sess.current_match]).sets||0==cm.sets.length||(!cm.sets[sess.current_set].game_results||0==cm.sets[sess.current_set].game_results.length))},getPrevSetStartingOpponent:function(){var ps,sess=APP.session;return"HOST"==APP.device.role||APP.device.has_chalk?null==sess.current_set||0==sess.current_set?null:(ps=sess.matches[sess.current_match].sets[sess.current_set-1]).game_results[0]?ps.game_results[0].starting_opponent:null:null},getPrevGameStartingOpponent:function(){var cs,pg,sess=APP.session;return APP.device.has_chalk?null==sess.current_set||(pg=(cs=sess.matches[sess.current_match].sets[sess.current_set]).game_results.length-1)<0?null:cs.game_results[pg]?cs.game_results[pg].starting_opponent:null:null},getPrevGameWinningOpponent:function(){var cm,cs,pg,ps,sess=APP.session;return null==sess.current_set?null:(cs=(cm=sess.matches[sess.current_match]).sets[sess.current_set]).game_results.length?(pg=cs.game_results.length-1,cs.game_results[pg].winning_opponent):0==sess.current_set?null:(ps=cm.sets[sess.current_set-1]).forfeited?ps.wins[0]?0:1:(pg=ps.game_results.length-1,ps.game_results[pg].winning_opponent)},getPrevSetWinningOpponent:function(){var cm,pg,cs,sess=APP.session;return null==sess.current_set?null:(cs=(cm=sess.matches[sess.current_match]).sets[sess.current_set]).game_results.length?(pg=cs.game_results.length-1,cs.game_results[pg].winning_opponent):0==sess.current_set?null:(cs=cm.sets[sess.current_set-1]).wins[0]>cs.wins[1]?0:cs.wins[1]>cs.wins[0]?1:null},getMessage:function(in_wins_only){var cm,cs,i,len,wins_a,wins_b,sess=APP.session,games_a=0,games_b=0,played_a=0,played_b=0,sets_a=0,sets_b=0;if("IN-GAME"!=APP.mode)return APP.game.shooting_for_bull?"":null!=APP.game.bull_shoot_winner?'<span class="text-gold">'+APP.game.opponent[APP.game.bull_shoot_winner].getStartButtonName()+" Starts</span>":null==APP.game.name?'<span class="text-gold">Set '+(APP.session.current_set+1)+" - Selecting Game</span>":'<span class="text-gold">Set '+(APP.session.current_set+1)+" - "+APP.game.getGameName()+"</span>";if(null==APP.game.name)return"";var name_a=APP.game.opponent[0].chalkboard_name,name_b=APP.game.opponent[1].chalkboard_name;function sumGamesPlayed(in_name){var played=0;for(i=0;i<len;i++)(in_name==(cs=cm.sets[i]).chalkboard_names[0]||in_name==cs.chalkboard_names[1]||APP.game.isBotChalkboardName(in_name)&&(APP.game.isBotChalkboardName(cs.chalkboard_names[0])||APP.game.isBotChalkboardName(cs.chalkboard_names[1])))&&(played+=cs.game_results.length);return played}function sumGameWins(in_name){var wins=0;for(i=0;i<len;i++)in_name==(cs=cm.sets[i]).chalkboard_names[0]?wins+=cs.wins[0]:in_name==cs.chalkboard_names[1]?wins+=cs.wins[1]:APP.game.isBotChalkboardName(in_name)&&(APP.game.isBotChalkboardName(cs.chalkboard_names[0])?wins+=cs.wins[0]:APP.game.isBotChalkboardName(cs.chalkboard_names[1])&&(wins+=cs.wins[1]));return wins}function sumSetWins(in_name){var wins=0;for(i=0;i<len-1;i++)(in_name==(cs=cm.sets[i]).chalkboard_names[0]&&cs.wins[0]>cs.wins[1]||in_name==cs.chalkboard_names[1]&&cs.wins[1]>cs.wins[0]||APP.game.isBotChalkboardName(in_name)&&(APP.game.isBotChalkboardName(cs.chalkboard_names[0])&&cs.wins[0]>cs.wins[1]||APP.game.isBotChalkboardName(cs.chalkboard_names[1])&&cs.wins[1]>cs.wins[0]))&&wins++;return wins}if(cm=sess.matches[sess.current_match],len=cm.sets.length,wins_a=cm.sets[sess.current_set].wins[0],wins_b=cm.sets[sess.current_set].wins[1],in_wins_only)return'<div class="mb-session-sets round-corners">'+wins_a+" - "+wins_b+"</div>";if("GAME"==cm.mode||"SOLO"==cm.mode){if(games_a=sumGameWins(name_a),games_b=sumGameWins(name_b),played_a=sumGamesPlayed(name_a),played_b=sumGamesPlayed(name_b),APP.game.opponent[0].team.is_default)var txt_a="";else txt_a='<div class="mb-session-sets-0">'+games_a+'W <span class="mb-session-percent">'+(100*(played_a?games_a/played_a:0)).toFixed(0)+"%</span></div>";if(APP.game.opponent[1].team.is_default)var txt_b="";else txt_b='<div class="mb-session-sets-1"><span class="mb-session-percent">'+(100*(played_b?games_b/played_b:0)).toFixed(0)+"%</span> "+games_b+"W</div>";return txt_a+'<div class="mb-session-sets round-corners">'+wins_a+" - "+wins_b+"</div>"+txt_b}if(sets_a=sumSetWins(name_a),sets_b=sumSetWins(name_b),APP.game.opponent[0].team.is_default)txt_a="";else txt_a='<div class="mb-session-sets-0">'+sets_a+" Sets</div>";if(APP.game.opponent[1].team.is_default)txt_b="";else txt_b='<div class="mb-session-sets-1">'+sets_b+" Sets</div>";return txt_a+'<div class="mb-session-sets round-corners">'+wins_a+" - "+wins_b+"</div>"+txt_b},resetMatch:function(){APP.session.tournament_id=APP.session.getTournamentID(),APP.session.startNew("TOURNAMENT"),APP.exitAlley()},handleMatchScore:function(in_id,tournament_correct_exit){var cm,sess=APP.session;function finish(in_post_save_review,wasOnlineBracketMatch){in_post_save_review&&(APP.flushState(),APP.flushSettings(),"TOURNAMENT"!=sess.getMatchMode()||wasOnlineBracketMatch?(APP.changeMode("PRE-ROLE"),APP.session.startNew("BASIC GAME")):(APP.session.tournament_id=APP.session.getTournamentID(),APP.changeMode("PRE-GAME"),APP.session.startNew("TOURNAMENT")),APP.device.disableButton("pss-close"),APP.device.disableButton("pss-score"),APP.device.enableButton("pss-exit",!0)),$("#pms-score-0").val("0").blur(),$("#pms-score-1").val("0").blur(),APP.popup.hide("popup-match-score"),$("#popup-match-score-overlay").hide(0)}function convertInput(in_input){return""==in_input||"-"==in_input?"0":parseFloat(in_input)}function saveMatchNotations(){cm.match_points[0]=convertInput($("#pms-score-0").val()),cm.match_points[1]=convertInput($("#pms-score-1").val()),sess.store(sess.current_match)}function saveMatch(in_exit){APP.server.has_history_sync_failed=!1,cm.scored=!0,cm.signed_off=!0,sess.refreshMatchScores(cm);try{if(APP.nlf.data.rails){var mInfo=APP.session.getLeagueMatchInfo(),mHomeScore=mInfo.amb_set_score_0,mAwayScore=mInfo.amb_set_score_1;"number"==typeof mHomeScore&&"number"==typeof mAwayScore&&Array.isArray(cm.set_wins)&&(mHomeScore+=cm.set_wins[0],mAwayScore+=cm.set_wins[1],cm.league_amb_set_scores=[mHomeScore,mAwayScore])}}catch(e){}if(sess.store(sess.current_match),"TEAM"==cm.mode||"SINGLES"==cm.mode||"MATCH"==cm.mode||"TOURNAMENT"==cm.mode)if(cm.bracket_match_premature_end)cm.title=cm.bracket_match_premature_end.type;else if(null!=cm.match_points[0]){var vi="",lft="",len=0,rght="";cm.title&&(vi=cm.title.indexOf(" v. "),lft=cm.title.left(vi),len=cm.title.length,rght=cm.title.right(len-vi-4)),cm.title=lft+"("+cm.match_points[0]+") v. "+rght+"("+cm.match_points[1]+")"}$("#pss-f-pending").hide(0),sess.tournament_id=sess.getTournamentID(),APP.is_reloading=!1;var wasOnlineBracketMatch=APP.session.isOnlineBracketMatch();sess.tournament_id&&sess.sendMatchScoreToPlatform(),sess.isBracketMatch()&&!sess.isOnlineBracketMatch()&&sess.resetBracketMatch(),wasOnlineBracketMatch||sess.startNew("TOURNAMENT"==sess.getMatchMode()?"TOURNAMENT":void 0),in_exit?APP.exitAlley():(finish(!0,wasOnlineBracketMatch),"TOURNAMENT"!=sess.getMatchMode()||wasOnlineBracketMatch||(APP.device.enableButton("pss-score",!0),APP.device.disableButton("pss-exit")))}switch(cm=sess.matches[sess.current_match],in_id){case"pms-info":APP.info.show("info-text-league-points","League Points");break;case"pms-close":finish();break;case"pms-confirm":saveMatchNotations(),sess.store(sess.current_match),APP.device.disableButton("pms-confirm"),APP.device.enableButton("pms-save",!0),$(".pms-points-row").removeClass("text-gold");break;case"pms-continue":saveMatchNotations(),finish();break;case"pms-notes":APP.showGameNoteEditor();break;case"pms-save":var matchMode=APP.session.getMatchMode(),isBasicGame="BASIC GAME"==matchMode,isTournamentMatch="TOURNAMENT"==matchMode,isTournamentEarlyExit=!1;if(isTournamentMatch&&!tournament_correct_exit&&(isTournamentEarlyExit=!0),APP.session.isLeaguePlay()&&APP.nlf.data.rails,isTournamentEarlyExit||saveMatch(),APP.lobby.isLobbyMatch())return void APP.session.startAutoExit();if(isTournamentEarlyExit)return saveMatch(),void APP.session.handleSummaryOption("pss-score");isBasicGame||-1==_timers.findTimerByName("newMatchTimer")&&APP.session.autoExitLocalMatch(isTournamentMatch)}},sendMatchScoreToPlatform:function(){var sess=APP.session,cm=sess.matches[sess.current_match],isBracketMatch=sess.isBracketMatch(),matchScore=sess.getMatchScore();if(isBracketMatch&&cm&&matchScore&&cm.match_guid&&!cm.bracket_match_premature_end){var data={tournament_id:sess.tournament_id,match:{bracket_event_id:cm.bracket_event_id,bracket_board_id:cm.bracket_board_id,bracket_match_id:cm.bracket_match_id,match_id:cm.match_guid,match_score:sess.getMatchScore()}};BBAT.storeData({send_match_score:data}),APP.server.squeue.enQueue({type:"HISTORY",caller:"forwardFinishedGames",url:APP.getApi2Url()+"update-tournament-match/"+cm.bracket_event_id,process_data:!1,data:JSON.stringify(data),is_api2:!0,on_success:function(in_data){BBAT.flushData("send_match_score")},on_error:function(in_a,in_b,in_c){}})}},isValidSetPoint:function(in_value){return/^[0-9]{0,3}(\.|(\.[0-9]{1,2}))?$/i.test(in_value)},showMatchScore:function(){var cm,sess=APP.session;if("D"!=APP.user.member_level||"PASSED"==APP.exit_password_test){if(APP.device.pauseKeyboardHandler(),$("#popup-match-score").on("keydown",(function(e){if(13==e.which)return BBAT.killDOMEvent(e),$("#pms-score-0").blur(),$("#pms-score-1").blur(),APP.device.resumeKeyboardHandler(),!1})),$("#pms-score-0").on("input",(function(e){sess.isValidSetPoint(this.value)||(this.value=this.value.left(this.value.length-1))})),$("#pms-score-1").on("input",(function(e){sess.isValidSetPoint(this.value)||(this.value=this.value.left(this.value.length-1))})),cm=sess.matches[sess.current_match],APP.session.isLeaguePlay()){$("#pms-title").html("Match Score"),$("#pms-end-league").show(0),$("#pms-score-choices").show(0),$("#pms-hint").show(0),cm.signed_off?($(".pms-points-row").removeClass("text-gold"),APP.device.disableButton("pms-confirm"),APP.device.enableButton("pms-save")):($(".pms-points-row").addClass("text-gold"),APP.device.enableButton("pms-confirm"),APP.device.disableButton("pms-save"));var homeScore=cm.match_points[0],awayScore=cm.match_points[1],leagueMatchScore=APP.session.getLeagueMatchScore();leagueMatchScore&&(homeScore=leagueMatchScore.home_match_points,awayScore=leagueMatchScore.away_match_points),homeScore=APP.noZero(null==homeScore?"-":homeScore),awayScore=APP.noZero(null==awayScore?"-":awayScore),$("#pms-opponent-0").html(APP.game.opponent[0].getChalkboardName()),$("#pms-score-0").val(homeScore),$("#pms-opponent-1").html(APP.game.opponent[1].getChalkboardName()),$("#pms-score-1").val(awayScore)}else $("#pms-title").html("End of Match Options"),$("#pms-end-league").hide(0),$("#pms-score-choices").hide(0),$("#pms-hint").hide(0),APP.device.disableButton("pms-confirm");_timers.removeTimer("newMatchTimer"),$("#popup-match-score-overlay").show(0),APP.popup.show("popup-match-score")}else APP.showExitPassword()},getMatchPoints:function(in_match,in_opponent_index,in_final){var m,len,s,i,io,oo,sess=APP.session,pts=0;if(0==(m=in_match||sess.matches[sess.current_match]).sets.length)return 0;for(oo=0==(io=in_opponent_index)?1:0,len=m.sets.length,in_final||(len=m.sets.length-1),i=0;i<len;i++)"PER-LEG"==(s=m.sets[i]).points_style?pts+=s.wins[io]:s.wins[io]>s.wins[oo]&&(pts+=s.points);return pts},setDefaultMatchScore:function(in_final){var cm,sess=APP.session;sess.isMatchScored()||(cm=sess.matches[sess.current_match],APP.session.isSuppressPoints()?(cm.match_points[0]=0,cm.match_points[1]=0):0==APP.session.current_set?(cm.match_points[0]=sess.getWins(cm,"GAMES",0,!0),cm.match_points[1]=sess.getWins(cm,"GAMES",1,!0),sess.store(sess.current_match)):(cm.format&&"PER-LEG"==cm.format.points_style?(cm.match_points[0]=sess.getWins(cm,"GAMES",0,in_final),cm.match_points[1]=sess.getWins(cm,"GAMES",1,in_final)):(cm.match_points[0]=sess.getMatchPoints(cm,0,in_final),cm.match_points[1]=sess.getMatchPoints(cm,1,in_final)),sess.store(sess.current_match)))},isMatchSignedOff:function(){var sess=APP.session;return sess.matches[sess.current_match].signed_off},isMatchScored:function(){var sess=APP.session;return null!=sess.matches[sess.current_match].match_points[0]},handleSummaryOption:function(in_id){var m,s,sess=APP.session;switch(in_id){case"psd-close":APP.popup.hide("popup-set-details"),$("#popup-set-details-overlay").hide(0),$(".psd-table").remove();break;case"pss-close":if(APP.popup.hide("popup-session-summary"),$(".pss-tr").remove(),"PRE-ROLE"!=APP.mode){var cm=sess.matches[sess.current_match];cm.match_points=[null,null],cm.signed_off=!1,sess.store(sess.current_match),sess.refreshMatchScores(cm)}break;case"pss-score":if("TOURNAMENT"==sess.getMatchMode())return APP.device.is_hosting?void APP.session.exitOnlineBracketMatch():void APP.exitAlley();sess.setDefaultMatchScore(!0),sess.showMatchScore();break;case"pss-exit":APP.device.is_hosting?APP.confirm.show({msg:"Exiting the match will also end any active VideoConnect calls",ok_text:"Exit Match",cancel_text:"Cancel",ok:function(){APP.session.exitSummary()},cancel:function(){}}):APP.session.exitSummary();break;case"countdown-exit":APP.session.exitSummary();break;default:m=APP.extractSegment(in_id,4,"-"),s=APP.extractSegment(in_id,5,"-"),APP.session.buildSetDetails(m,s)}},exitSummary:function(){APP.starpubs.isStarPubsMatch()&&APP.starpubs.endMatch(),advLog.completeLog();var sess=APP.session;if(APP.session.isOnlineBracketMatch())APP.session.exitOnlineBracketMatch("pss-exit");else if(APP.lobby.isLobbyMatch())APP.session.exitLobbyMatch("pss-exit");else if(APP.session.isBracketMatch()&&!APP.session.isOnlineBracketMatch()&&APP.device.is_hosting)APP.session.exitOnlineBracketMatch("exit-from-tournament");else{if("PARTICIPANT"==APP.device.role)return APP.session.isOnlineBracketMatch(!0)&&APP.game.finished?(APP.session.killBracket(),APP.exitTournament(!0),void APP.exitAlley()):void(APP.device.is_hosting||"PARTICIPANT"==APP.device.role?APP.device.has_chalk?(APP.device.showSpinnerOverlay(),APP.device.releaseChalk(!1,APP.exitAlley)):APP.exitAlley():APP.confirm.show({msg:"Exit the match?",ok:function(){APP.device.has_chalk?(APP.device.showSpinnerOverlay(),APP.device.releaseChalk(!1,APP.exitAlley)):APP.exitAlley()}}));if(!sess.isNewMatch())return sess.isPartyPlay()||APP.session.isLeaguePlay()&&APP.getMatch().signed_off?(sess.setDefaultMatchScore(!0),void APP.exitAlley()):void(isSolo501(!0)?APP.exitAlley():(sess.setDefaultMatchScore(!0),sess.showMatchScore()));APP.exitAlley()}},bundleBroadcastSetDetails:function(){var s_len,s,sess=APP.session,bundle=[];for(s_len=sess.matches[sess.current_match].sets.length,s=0;s<s_len;s++)APP.session.buildSetDetails(sess.current_match,s,!0),bundle[s]=$("#psd-scroll-box-internal").html();return bundle},buildSetDetails:function(in_match_index,in_set_index,in_build_only){var cm,g,gs,oppo_0,oppo_1,num,leg,len,t_len,s,i,j,html,id,din,dout,adin,names_2,names_3,ss_0,ss_1,es_0,es_1,p,first_peak_r3da_0,first_peak_r3da_1,da0,da1,r3da_0,r3da_1,initials_0,initials_1,sess=APP.session,pss=$("#psd-scroll-box-internal");function getPlayerInitials(in_oppo,in_player_index){var i,p;return null!=in_player_index?"Pfiller"==(p=in_oppo.team.players[in_player_index]).obj_id?"":(i=p.first_name.left(1),p.last_name>""&&(i+=p.last_name.left(1)),i):""}function formatName(in_oppo){return in_oppo.last_name?in_oppo.first_name+" "+in_oppo.last_name.left(1):in_oppo.first_name}function formatTargets(in_user_input,in_targets,in_marksman){var html,delim,len,i,counts,entry,modifier,target_index,multiplier;if(html="",delim="",len=in_user_input.length,in_marksman)for(i=0;i<len;i++)"S"!=(modifier=(entry=in_user_input[i]).right(1))&&"0"!=modifier||(modifier=""),html=html+delim+modifier+in_targets[target_index=parseInt(entry,10)].label,delim=", ";else if(counts=BBAT.getUniqueFrequencies(in_user_input),BBAT.objectHasProperties(counts))for(entry in counts)html=html+delim+in_targets[target_index=parseInt(entry,10)].label,(multiplier=counts[target_index])>1&&(html=html+'<span style="font-size:0.75em">x'+multiplier+"</span>"),delim=", ";return html}function highlightRecap(in_opponent,in_set,in_game,in_round){$("#psd-gd-round-"+in_set+"-"+in_game+"-"+in_round+" > .esp-r-"+in_opponent).addClass("esp-r-highlight")}function addRecapRow(in_id,in_set,in_game,in_row,in_value_0,in_initials_0,in_r3da_0,in_value_1,in_initials_1,in_r3da_1){var id,st;st=g.options.stats_type,id="psd-gd-round-"+in_set+"-"+in_game+"-"+in_row,$("#psd-gd-round-x").clone(!0).attr("id",id).appendTo($("#"+in_id)).removeClass("template"),in_row%2==0?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).html(null==in_r3da_0?"":in_r3da_0.toFixed("MARKS"==st?1:0));break;case 1:$(el).html(null==in_value_0?"":in_initials_0);break;case 2:$(el).html(null==in_value_0?"":in_value_0),"MARKS"==st?$(el).addClass("esp-r-score-marks-0"):$(el).addClass("esp-r-score-points-0");break;case 3:$(el).html(in_row+1);break;case 4:$(el).html(null==in_value_1?"":in_value_1),"MARKS"==st?$(el).addClass("esp-r-score-marks-1"):$(el).addClass("esp-r-score-points-1");break;case 5:$(el).html(null==in_value_1?"":in_initials_1);break;case 6:$(el).html(null==in_r3da_1?"":in_r3da_1.toFixed("MARKS"==st?1:0))}}))}for(cm=sess.matches[in_match_index],pss.html(""),s=cm.sets,num=0,i=0;i<in_set_index;i++)num+=s[i].games.length;for(len=(gs=cm.sets[in_set_index].games).length,i=0;i<len;i++)if((g=gs[i]).opponents){for(num++,leg=i+1,oppo_0=g.opponents[0],oppo_1=g.opponents[1],din=g.options.double_in,adin=g.options.all_player_double_in,dout=g.options.double_out,ss_0=oppo_0.starting_score,ss_1=oppo_1.starting_score,es_0=oppo_0.current_score,es_1=oppo_1.current_score,names_2=["",""],names_3=["",""],j=0;j<g.opponent_count;j++)switch((p=0==j?oppo_0.team.players:oppo_1.team.players).length){case 1:names_3[j]=formatName(p[0]);break;case 2:names_3[j]=formatName(p[0])+", "+formatName(p[1]);break;case 3:names_2[j]=formatName(p[2]),names_3[j]=formatName(p[0])+", "+formatName(p[1]);break;case 4:names_2[j]=formatName(p[2])+", "+formatName(p[3]),names_3[j]=formatName(p[0])+", "+formatName(p[1])}if(id="psd-gd-header-"+in_set_index+"-"+i,$("#psd-gd-header-x").clone(!0).attr("id",id).appendTo(pss).addClass("psd-table").removeClass("template"),"01"==g.name?(html=ss_0==ss_1?""+ss_0:"x01",html+=din?" DI":adin?" ADI":" SI",html+=dout?" DO":" SO"):html=g.name,$("#"+id+" .psd-gd-label-1").html(html),$("#"+id+" .psd-gd-names-2-0").html(names_2[0]),$("#"+id+" .psd-gd-score-2-0").html(es_0),$("#"+id+" .psd-gd-label-2").html("Game "+num+", Leg "+leg),$("#"+id+" .psd-gd-score-2-1").html(es_1),$("#"+id+" .psd-gd-names-2-1").html(names_2[1]),$("#"+id+" .psd-gd-names-3-0").html(names_3[0]),$("#"+id+" .psd-gd-label-3").html(BBAT.formatElapsedMilliseconds(g.elapsed_time,"MS")),$("#"+id+" .psd-gd-names-3-1").html(names_3[1]),id="psd-gd-rounds-"+in_set_index+"-"+i,$("#psd-gd-rounds-x").clone(!0).attr("id",id).appendTo(pss).addClass("psd-table").removeClass("template"),"POINTS"==g.options.stats_type){for(first_peak_r3da_0=0,first_peak_r3da_1=0,t_len=oppo_0.turns.length,j=0;j<t_len;j++)da0=0==(da0=oppo_0.turns[j].points)?oppo_0.turns[j].color:da0,r3da_0=oppo_0.turns[j].r3da,initials_0=getPlayerInitials(oppo_0,oppo_0.turns[j].player_index),r3da_0>oppo_0.turns[first_peak_r3da_0].r3da&&(first_peak_r3da_0=j),da1=0==(da1=oppo_1.turns[j].points)?oppo_1.turns[j].color:da1,r3da_1=oppo_1.turns[j].r3da,initials_1=getPlayerInitials(oppo_1,oppo_1.turns[j].player_index),r3da_1>oppo_1.turns[first_peak_r3da_1].r3da&&(first_peak_r3da_1=j),addRecapRow(id,in_set_index,i,j,da0,initials_0,r3da_0,da1,initials_1,r3da_1),(0==g.winning_opponent&&j+1==oppo_0.stats.turns_played||0==j&&0==g.opponent_order[0])&&highlightRecap(0,in_set_index,i,j),(1==g.winning_opponent&&j+1==oppo_1.stats.turns_played||0==j&&1==g.opponent_order[0])&&highlightRecap(1,in_set_index,i,j);highlightRecap(0,in_set_index,i,first_peak_r3da_0),highlightRecap(1,in_set_index,i,first_peak_r3da_1)}if("MARKS"==g.options.stats_type){for(first_peak_r3da_0=0,first_peak_r3da_1=0,t_len=oppo_0.turns.length,j=0;j<t_len;j++)da0=0==(da0=oppo_0.turns[j].user_input)?oppo_0.turns[j].color:formatTargets(da0,g.target,g.options.marksman_scoring),r3da_0=oppo_0.turns[j].r3da,initials_0=getPlayerInitials(oppo_0,oppo_0.turns[j].player_index),r3da_0>oppo_0.turns[first_peak_r3da_0].r3da&&(first_peak_r3da_0=j),da1=0==(da1=oppo_1.turns[j].user_input)?oppo_1.turns[j].color:formatTargets(da1,g.target,g.options.marksman_scoring),r3da_1=oppo_1.turns[j].r3da,initials_1=getPlayerInitials(oppo_1,oppo_1.turns[j].player_index),r3da_1>oppo_1.turns[first_peak_r3da_1].r3da&&(first_peak_r3da_1=j),addRecapRow(id,in_set_index,i,j,da0,initials_0,r3da_0,da1,initials_1,r3da_1),(0==g.winning_opponent&&j+1==oppo_0.stats.turns_played||0==j&&0==g.opponent_order[0]||oppo_0.turns[j].marks_scored>=5)&&highlightRecap(0,in_set_index,i,j),(1==g.winning_opponent&&j+1==oppo_1.stats.turns_played||0==j&&1==g.opponent_order[0]||oppo_1.turns[j].marks_scored>=5)&&highlightRecap(1,in_set_index,i,j);highlightRecap(0,in_set_index,i,first_peak_r3da_0),highlightRecap(1,in_set_index,i,first_peak_r3da_1)}}in_build_only||($("#popup-set-details-overlay").show(0),APP.popup.show("popup-set-details"),$("#psd-scroll-box").css("height",$("#popup-set-details").outerHeight(!0)-$("#popup-set-details > .popup-title").outerHeight(!0)),$("#psd-scroll-box").scrollTop(0))},refreshMatchScores:function(in_match){APP.session;null!=in_match.match_points[0]&&in_match.signed_off&&"GAME"!=in_match.mode?($("#pss-match-points-0").html(in_match.match_points[0]),$("#pss-match-points-1").html(in_match.match_points[1])):($("#pss-match-points-0").html("&nbsp;"),$("#pss-match-points-1").html("&nbsp;"))},buildSummary:function(in_match_index,in_checking_match){var mi,cm,cs,dt,i,id,gr,j,id_g,game_count,round_count,last_mark_0,last_mark_1,sess=APP.session,gamex=$("#pss-game-x"),forfeitx=$("#pss-forfeit-x");function formatTDA(in_tda){return null==in_tda?"":parseFloat(in_tda).toFixed(1)}function formatPercent(in_value){return null==in_value?"":(100*parseFloat(in_value)).toFixed(0)+"%"}if(null!=sess.current_match){$(".pss-tr").remove(),mi=null==in_match_index?sess.current_match:in_match_index,cm=sess.matches[mi];var set_is_pending=(in_checking_match||$("#seo-set-control").html().indexOf("New Set or End Match")>=0||APP.session.isNewSet())&&"PRE-ROLE"!=APP.mode&&!APP.session.isSetDone();if("PRE-ROLE"!=APP.mode||APP.game.finished)if(sess.setDefaultMatchScore(!set_is_pending),"SOLO"==cm.mode){var cn=APP.game.opponent[0].getChalkboardName();$("#pss-name-0").html(APP.game.isBotChalkboardName(cn)?"DartConnect":cn),$("#pss-name-1").html("&nbsp;")}else if("GAME"==cm.mode)$("#pss-name-0").html("&nbsp;"),$("#pss-name-1").html("&nbsp;");else{cn=APP.game.opponent[0].getChalkboardName();$("#pss-name-0").html(APP.game.isBotChalkboardName(cn)?"DartConnect":cn);cn=APP.game.opponent[1].getChalkboardName();$("#pss-name-1").html(APP.game.isBotChalkboardName(cn)?"DartConnect":cn)}else APP.device.disableButton("pss-exit"),APP.device.disableButton("pss-score"),$("#pss-match-points-0").html("&nbsp;"),$("#pss-match-points-1").html("&nbsp;"),$("#pss-name-0").html("&nbsp;"),$("#pss-name-1").html("&nbsp;");for(dt=new Date(cm.start_time),$("#pss-start-time").html(BBAT.getDayName(dt).slice(0,3)+". "+BBAT.formatTime(dt,"HM")),s_len=cm.sets.length,0,0,0,0,game_count=0,0,i=0;i<s_len;i++)if((cs=cm.sets[i]).forfeited)cs.wins[0],cs.wins[1],id="pss-forfeit-"+mi+"-"+i+"-f",forfeitx.clone(!0).attr("id",id).appendTo("#pss-sets").addClass("pss-tr").removeClass("template"),i%2==1?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),$("#"+id+" > td").each((function(index,el){switch(index){case 0:$(el).html(1==cs.wins[0]?"&#9733;":"");break;case 1:"SET-WIN"==cs.forfeit_type?$(el).html(1==cs.wins[0]?"* Set Win *":""):$(el).html(0==cs.wins[0]?"* Forfeit *":"");break;case 2:$(el).html("Set "+(i+1));break;case 3:"SET-WIN"==cs.forfeit_type?$(el).html(1==cs.wins[1]?"* Set Win *":""):$(el).html(0==cs.wins[1]?"* Forfeit *":"");break;case 4:$(el).html(1==cs.wins[1]?"&#9733;":"")}}));else if(cs.game_results.length>0){for(cs.wins[0],cs.wins[1],g_len=cs.game_results.length,j=0;j<g_len;j++)game_count++,gr=cs.game_results[j],round_count=gr.rounds_played,id="pss-game-"+mi+"-"+i+"-"+j,gamex.clone(!0).attr("id",id).appendTo("#pss-sets").addClass("pss-set-"+i).addClass("pss-tr").removeClass("template"),"HOST"!=APP.device.role&&APP.device.disableFieldSelector(id+" .pss-g-name"),i%2==1?$("#"+id).addClass("greenbar-a"):$("#"+id).addClass("greenbar-b"),$("#"+id+" > td").each((function(index,el){switch(index){case 0:last_mark_0=id+"_mark_0",$(el).attr("id",last_mark_0).html(0==gr.winning_opponent?"&#9830;":"");break;case 1:$(el).html(game_count);break;case 2:$(el).html(formatTDA(gr.three_da[0]));break;case 3:$(el).html(gr.ending_scores[0]),0==gr.winning_opponent&&$(el).css("color","white");break;case 4:id_g="pss-g-name-"+mi+"-"+i+"-"+j,$(el).html(gr.game_name).attr("id",id_g),APP.device.addFieldHandler([id_g],sess.handleSummaryOption);break;case 5:$(el).html(gr.ending_scores[1]),1==gr.winning_opponent&&$(el).css("color","white");break;case 6:$(el).html(formatTDA(gr.three_da[1]));break;case 7:$(el).html(round_count);break;case 8:last_mark_1=id+"_mark_1",$(el).attr("id",last_mark_1).html(1==gr.winning_opponent?"&#9830;":"")}}));cs.wins[0]>cs.wins[1]?((APP.session.isSetDone()||cm.signed_off||i<s_len-1)&&$("#"+last_mark_0).html("&#9733;")):cs.wins[0]<cs.wins[1]&&((APP.session.isSetDone()||cm.signed_off||i<s_len-1)&&$("#"+last_mark_1).html("&#9733;"))}var cricket_games=0,marksman_games=0,crick_0={darts:0,targets:0,bulls:0,trips:0},crick_1={darts:0,targets:0,trips:0,bulls:0},first_nine={games:0,tda_first_3:[0,0]},fin_0={points:0,games_won:0},fin_1={points:0,games_won:0},do_0={points:0,attempts:0,games_won:0},do_1={points:0,attempts:0,games_won:0},s_len=cm.sets.length;if("HOST"==APP.device.role)for(var si=0;si<s_len;si++)for(var g_len=cm.sets[si].games.length,gi=0;gi<g_len;gi++){var g=cm.sets[si].games[gi];if(-1!=g.game_guid){if("Cricket"==g.type&&(cricket_games++,g.options.marksman_scoring)){marksman_games++;var bull_index=g.options.no_bull?null:g.target.length-1,oppo=g.opponents[0];crick_0.darts+=oppo.stats.darts_thrown;for(var t_len=oppo.turns.length,ti=0;ti<t_len;ti++)for(var u_len=(t=oppo.turns[ti]).user_input.length,ui=0;ui<u_len;ui++){"0"!=(u=t.user_input[ui])&&crick_0.targets++,u.indexOf("T")>=0&&crick_0.trips++,parseInt(u,10)==bull_index&&crick_0.bulls++}if(2==g.opponent_count){oppo=g.opponents[1];crick_1.darts+=oppo.stats.darts_thrown;for(t_len=oppo.turns.length,ti=0;ti<t_len;ti++){var t;for(u_len=(t=oppo.turns[ti]).user_input.length,ui=0;ui<u_len;ui++){var u;"0"!=(u=t.user_input[ui])&&crick_1.targets++,u.indexOf("T")>=0&&crick_1.trips++,parseInt(u,10)==bull_index&&crick_1.bulls++}}}}if("01"==g.type&&null==g.leg_forfeit){first_nine.games++,first_nine.tda_first_3[0]+=g.opponents[0].stats.tda_first_3,first_nine.tda_first_3[1]+=2==g.opponent_count?g.opponents[1].stats.tda_first_3:0;oppo=g.opponents[0];0==g.winning_opponent&&(fin_0.games_won++,fin_0.points+=oppo.stats.winning_score);oppo=g.opponents[1];2==g.opponent_count&&1==g.winning_opponent&&(fin_1.games_won++,fin_1.points+=oppo.stats.winning_score)}if(g.options&&g.options.double_out){oppo=g.opponents[0];0==g.winning_opponent&&do_0.games_won++;for(var p_len=oppo.team.players.length,pi=0;pi<p_len;pi++){(p=oppo.team.players[pi]).do_attempts&&(do_0.attempts+=p.do_attempts)}if(2==g.opponent_count){oppo=g.opponents[1];1==g.winning_opponent&&do_1.games_won++;for(p_len=oppo.team.players.length,pi=0;pi<p_len;pi++){var p;(p=oppo.team.players[pi]).do_attempts&&(do_1.attempts+=p.do_attempts)}}}}}if(set_is_pending?(APP.device.disableButton("pss-exit"),$("#pss-f-pending").html("Set "+(sess.current_set+1)+": Pending").show(0)):$("#pss-f-pending").hide(0),"GAME"==cm.mode){if(0==cm.point_darts[0]&&0==cm.point_darts[1])var ppr="-";else ppr=formatTDA((cm.points[0]+cm.points[1])/(cm.point_darts[0]+cm.point_darts[1])*3);if(0==cm.mark_darts[0]&&0==cm.mark_darts[1])var mpr="-";else mpr=formatTDA((cm.marks[0]+cm.marks[1])/(cm.mark_darts[0]+cm.mark_darts[1])*3);if($("#pss-f-ppr-1").html(ppr),$("#pss-f-mpr-1").html(mpr),$("#pss-leaderboard").hide(0),"-"==ppr?$(".pss-f-ppr-section").hide(0):$(".pss-f-ppr-section").show(0),"-"==mpr?$(".pss-f-mpr-section").hide(0):$(".pss-f-mpr-section").show(0),crick_0.darts+crick_1.darts==0)var misses_1="-",bull_trips_1="-";else misses_1=formatPercent(1-(crick_0.targets+crick_1.targets)/(crick_0.darts+crick_1.darts)),bull_trips_1=formatPercent((crick_0.trips+crick_0.bulls+(crick_1.trips+crick_1.bulls))/(crick_0.darts+crick_1.darts));$("#pss-f-targets-1").html(misses_1),$("#pss-f-bull-trips-1").html(bull_trips_1),$("#pss-f-marksman").html("Marksman Cricket Games "+marksman_games+"/"+cricket_games);var first_nine_pts=first_nine.games?((first_nine.tda_first_3[0]+first_nine.tda_first_3[1])/(2*first_nine.games)).toFixed(1):"-";$("#pss-f-first-9-1").html(first_nine_pts);var do_avg_points_1=do_0.games_won+do_1.games_won?((do_0.points+do_1.points)/(do_0.games_won+do_1.games_won)).toFixed(0):"-";do_0.attempts+do_1.attempts&&Math.round((do_0.games_won+do_1.games_won)/(do_0.attempts+do_1.attempts)*100);$("#pss-f-do-1").html(do_avg_points_1)}else{if(0==crick_0.darts)var misses_0="-",bull_trips_0="-";else misses_0=formatPercent(1-crick_0.targets/crick_0.darts),bull_trips_0=formatPercent((crick_0.trips+crick_0.bulls)/crick_0.darts);if($("#pss-f-targets-0").html(misses_0),$("#pss-f-bull-trips-0").html(bull_trips_0),0==crick_1.darts)misses_1="-",bull_trips_1="-";else misses_1=formatPercent(1-crick_1.targets/crick_1.darts),bull_trips_1=formatPercent((crick_1.trips+crick_1.bulls)/crick_1.darts);if($("#pss-f-targets-1").html(misses_1),$("#pss-f-bull-trips-1").html(bull_trips_1),$("#pss-f-marksman").html("Marksman Cricket Games "+marksman_games+"/"+cricket_games),0==fin_0.games_won)var fin_avg_0="-";else fin_avg_0=formatTDA(fin_0.points/fin_0.games_won);if($("#pss-f-avg-fin-0").html(fin_avg_0),0==fin_1.games_won)var fin_avg_1="-";else fin_avg_1=formatTDA(fin_1.points/fin_1.games_won);if($("#pss-f-avg-fin-1").html(fin_avg_1),0==cm.point_darts[0])var ppr_0="-";else ppr_0=formatTDA(cm.points[0]/cm.point_darts[0]*3);if(0==cm.mark_darts[0])var mpr_0="-";else mpr_0=formatTDA(cm.marks[0]/cm.mark_darts[0]*3);var mm=APP.session.getMatchMode();APP.getDomain("TV"),APP.game.opponent[0].chalkboard_name;if("TOURNAMENT"==mm||"TEAM"==mm||"SINGLES"==mm){if("TOURNAMENT"==mm){var tid=APP.session.getTournamentID();$("#pss-leaderboard").attr("href",APP.getDomain("LEADERBOARD")+"#t-"+tid+"-all_01-all-all-all-per-all")}else{var lk=APP.session.getMatchLeagueKey(),ula=APP.user.league_associations;if(ula&&ula.length)for(var la_len=ula.length,ok=!1,la_i=0;la_i<la_len;la_i++){var l=ula[la_i];if(l.league_id==lk.league_id&&l.league_division_guid==lk.league_division_guid&&l.season_status==lk.season_status){$("#pss-leaderboard").attr("href",APP.getDomain("LEADERBOARD")+"#l-"+l.league_guid+"_"+l.season_id+"_"+l.season_status.toLowerCase()),ok=!0;break}}ok||$("#pss-leaderboard").hide(0)}$("#pss-f-ppr-0").html(ppr_0),$("#pss-f-mpr-0").html(mpr_0)}else $("#pss-leaderboard").hide(0),$("#pss-f-ppr-0").html(ppr_0),$("#pss-f-mpr-0").html(mpr_0);if(0==cm.point_darts[1])var ppr_1="-";else ppr_1=formatTDA(cm.points[1]/cm.point_darts[1]*3);if(0==cm.mark_darts[1])var mpr_1="-";else mpr_1=formatTDA(cm.marks[1]/cm.mark_darts[1]*3);APP.getDomain("TV"),APP.game.opponent[1].chalkboard_name;$("#pss-f-ppr-1").html(ppr_1),$("#pss-f-mpr-1").html(mpr_1),"-"==ppr_0&&"-"==ppr_1?$(".pss-f-ppr-section").hide(0):$(".pss-f-ppr-section").show(0);first_nine_pts=first_nine.games?(first_nine.tda_first_3[0]/first_nine.games).toFixed(1):"-";$("#pss-f-first-9-0").html(first_nine_pts);first_nine_pts=first_nine.games?(first_nine.tda_first_3[1]/first_nine.games).toFixed(1):"-";if($("#pss-f-first-9-1").html(first_nine_pts),"-"==mpr_0&&"-"==mpr_1?$(".pss-f-mpr-section").hide(0):$(".pss-f-mpr-section").show(0),do_0.attempts||do_1.attempts){var do_avg=do_0.attempts?do_0.games_won+"/"+do_0.attempts+" = "+Math.round(do_0.games_won/do_0.attempts*100)+"%":"-";$("#pss-f-do-0").html(do_avg);do_avg=do_1.attempts?do_1.games_won+"/"+do_1.attempts+" = "+Math.round(do_1.games_won/do_1.attempts*100)+"%":"-";$("#pss-f-do-1").html(do_avg)}else $("#pss-f-do-0").parent().hide(),$("#pss-f-do-0").html("n/a"),$("#pss-f-do-1").parent().hide(),$("#pss-f-do-1").html("n/a")}"PRE-ROLE"==APP.mode||sess.isNewMatch()||sess.isPartyPlay()||"SOLO"==mm?APP.device.disableButton("pss-score"):APP.device.enableButton("pss-score",!0),sess.refreshMatchScores(cm)}},isSummaryShowing:function(){return"block"==$("#popup-session-summary").css("display")},showSummary:function(in_jump_to_notation,ignore_rails){var sess=APP.session,isLeague=(sess.getMatchFormat(),sess.isLeaguePlay()),isTournament=!1;"TOURNAMENT"==APP.session.getMatchMode()&&(isTournament=!0);var isRails=!1;if(isLeague&&APP.nlf.data.rails&&!ignore_rails&&(isRails=!0),isTournament||isLeague){if(isRails)return APP.device.showSpinnerOverlay(),APP.nlf.rails.isForfeit||APP.nlf.rails.saveCompleteLocal(),void window.setTimeout((function(){APP.nlf.rails.exitSet()}),2e3);in_jump_to_notation||APP.game.finished&&APP.session.autoExitLocalMatch(isTournament),$("#pss-score").html("New Match"),APP.device.disableButton("pss-score"),"PARTICIPANT"!==APP.device.role&&APP.device.disableButton("pss-exit")}("PARTICIPANT"==APP.device.role||APP.session.isPartyPlay())&&($("#pss-score").html("New Match"),APP.device.disableButton("pss-score")),APP.popup.show("popup-session-summary"),$("#pss-scroll-box").css("height",$("#popup-session-summary").outerHeight(!0)-$("#pss-header").outerHeight(!0)-$("#pss-button-bar").outerHeight(!0)),$("#pss-scroll-box").scrollTop(0),in_jump_to_notation&&"D"!=APP.user.member_level&&"HOST"==APP.device.role&&sess.handleSummaryOption("pss-score"),APP.server.updateSyncMessages(),APP.nlf.data.rails&&(APP.nlf.rails.injections.pss(),APP.nlf.rails.isForfeit||APP.nlf.rails.saveCompleteLocal())},handleDeviceLog:function(in_id){switch(in_id){case"pdl-close":$(".pdl-tr").remove(),APP.popup.hide("popup-device-log");break;case"pdl-retry-sync":APP.session.resetStuckGames(),APP.session.buildDeviceLog();break;default:APP.session.buildSummary(APP.extractLastNumberSegment(in_id)),APP.session.showSummary()}},getMatchRecapURL:function(in_match){var m,sess=APP.session;if(in_match)m=in_match;else{if(null==sess.current_match)return null;m=sess.matches[sess.current_match]}return m.match_guid?"https://"+location.host.replace("app","members")+"/history/report/match/"+m.match_guid:null},buildDeviceLog:function(){var m,i,id,pdlm,d,day,dat,ttl,lnk,sess=APP.session;for(lnk=APP.getDomain("MEMBERS"),$("#pdl-member-link").attr("href",lnk),pdlm=$("#pdl-matches"),$("#pdl-old-matches"),$(".pdl-tr").remove(),i=sess.matches.length-1;i>=0;i--)if((m=sess.matches[i]).start_time&&!m.closed){d=new Date(m.start_time),day=BBAT.getDayName(d).left(3),dat=d.getMonth()+1+"/"+d.getDate()+"/"+d.getFullYear(),ttl=m.title;var isStuck=APP.session.checkStuckGames(m);id="pdl-match-"+i;var btn=$("#pdl-match-x").clone(!0).attr("id",id).appendTo(pdlm).addClass("pdl-tr").removeClass("template"),btnText=day+" "+dat+" "+ttl;isStuck&&(btn.addClass("button-red"),btn.removeClass("button-green"),btnText+="<br />Sync Failed"),$("#"+id).html(btnText),APP.device.addButtonHandler([id],sess.handleDeviceLog)}},getMatchAverages:function(in_oppo_index){var oppo0=0,oppo1=0,type="MPR",obj=!1;try{"01"==APP.game.name?(type="PPR",oppo0={leg:APP.game.opponent[0].getRunning3DA(2),match:APP.session.getM3DA("POINTS",0,!0)},oppo1={leg:APP.game.opponent[1].getRunning3DA(2),match:APP.session.getM3DA("POINTS",1,!0)}):(oppo0={leg:APP.game.opponent[0].getRunning3DA(2),match:APP.session.getM3DA("MARKS",0,!0)},oppo1={leg:APP.game.opponent[1].getRunning3DA(2),match:APP.session.getM3DA("MARKS",1,!0)}),obj={opponent_0_xpr:oppo0,opponent_1_xpr:oppo1,type:type}}catch(e){return!1}if(void 0===in_oppo_index)return obj;switch(in_oppo_index){case 0:return{xpr:oppo0,type:type};case 1:return{xpr:oppo1,type:type};default:return obj}},bracket:null,bracket_selected_match_parts:null,bracket_offline_error_visible:!1,bracketFunctions:{teamOrderTournaments:["arnowdfworldcup23a","wdfworldcup23a","wdfworldcup23y"],isSetTeamOrder:function(){try{if(!APP.session.isBracketMatch())return!1;var tournamentId=APP.session.tournament_id;if(!tournamentId)return!1;if(APP.session.bracketFunctions.teamOrderTournaments.indexOf(tournamentId)>=0)return!0}catch(e){}return!1},retryCounter:0,retryBroadcast:function(){if(!APP.device.is_broadcasting&&"PARTICIPANT"!=APP.device.role&&!APP.session.isOnlineBracketMatch())if(APP.session.bracketFunctions.retryCounter++,APP.session.bracketFunctions.retryCounter%4==0)try{var in_params={no_spinner:!0,requesting_broadcast:!0,callback:function(r){"FAILED"==r||(APP.game_master="DEVICE",APP.device.role="HOST",APP.server.startTimer("SEND"),APP.device.has_chalk=!0,APP.device.is_broadcasting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.reveal.updateDCTVKey(),APP.message_bar.promo.active&&APP.session.isNewMatch()&&APP.message_bar.showPromo(null,null,null,!1,!0),APP.game.started&&APP.game.initGameBroadcast())}};APP.server.openAlley(in_params)}catch(e){}else console.log("Not retrying broadcast, counter: "+APP.session.bracketFunctions.retryCounter)},stuckData:{check:function(){var match=APP.getMatch();if(!match)return!1;try{if("MATCH"==match.mode)for(var checkArr=["bracket_interface_id","bracket_board_id","bracket_event_id","bracket_match_id","tournament_id"],i=0;i<checkArr.length;i++)if(match[checkArr[i]])return!0}catch(e){}return!1},clean:function(){var match=APP.getMatch();if(match)try{match.bracket_interface_id=null,match.bracket_board_id=null,match.bracket_event_id=null,match.bracket_match_id=null,match.tournament_id=null,match.broadcast_matches_id=null,match.broadcast_matches_status=null,APP.session.store(APP.session.current_match)}catch(e){}},inject:function(){var match=APP.getMatch();if(match)try{match.bracket_interface_id="DartConnect",match.bracket_board_id=69,match.bracket_event_id="57081",match.bracket_match_id="8_1",match.tournament_id="richtest",match.broadcast_matches_id=3544073,match.broadcast_matches_status="O",APP.session.store(APP.session.current_match)}catch(e){}}}},isPremierLeague:function(){try{if(!APP.session.bracket)return!1;if(!APP.session.bracket.tournament_id)return!1;var isPremierLeague=!1;switch(APP.session.bracket.tournament_id){case"pdcpremlg21":case"arnopltest":isPremierLeague=!0}return isPremierLeague}catch(e){return!1}},getBracketMatchInfo:function(){if(!APP.session.isBracketMatch())return{};if(!APP.session.getBracketMatchBoardNo())return{};var extendedBracketMatchInfo=APP.session.getExtendedBracketMatchInfo();try{return extendedBracketMatchInfo.board_id=APP.getMatch().bracket_board_id,extendedBracketMatchInfo.event_id=APP.getMatch().bracket_event_id,extendedBracketMatchInfo.match_id=APP.getMatch().bracket_match_id,extendedBracketMatchInfo}catch(e){return{}}},getExtendedBracketMatchInfo:function(){try{if(!APP.getMatch().bracket_match_id)return{};if(!APP.getMatch().bracket_event_id)return{};if(!APP.session.bracket)return{};if(APP.session.bracket.match_list){var matchId=APP.getMatch().bracket_match_id+"_"+APP.getMatch().bracket_event_id,match=APP.session.bracket.match_list[matchId];if(!match)return{};var tournamentCity=null,tournamentCountry=null,tournamentCountryCode=null,tournamentState=null,tournamentRegion=null,tournamentVenue=null;if(APP.getMatch().tournament_id){var tournament=APP.session.tournaments[APP.getMatch().tournament_id];tournament&&(tournamentCity=tournament.city,tournamentCountry=tournament.country,tournamentCountryCode=tournament.country_code,tournamentState=tournament.state,tournamentRegion=tournament.region,tournamentVenue=tournament.venue)}return{round_label:match.round_label,round_id:match.round_id,city:tournamentCity,country:tournamentCountry,country_code:tournamentCountryCode,state:tournamentState,region:tournamentRegion,venue:tournamentVenue}}}catch(e){}return{}},createPlayerName:function(player,type){if(!player)return!1;if(-1==player)return"-SHORT-";if(player.obj_id&&("Phost"===player.obj_id||"Pguest"===player.obj_id))return player.chalkboard_name;if(!type)return player.last_name?player.last_name+" "+player.first_name.substring(0,1):player.first_name;if(player.first_name&&!player.last_name)return player.first_name;if(player.last_name&&!player.first_name)return player.last_name;switch(type){case 1:return player.first_name+" "+player.last_name;case 2:return player.first_name.substring(0,1)+" "+player.last_name;case 3:return player.first_name+" "+player.last_name.substring(0,1);case 4:return player.last_name+", "+player.first_name.substring(0,1)}},warnBracketConnectivity:function(){var sess=APP.session;APP.alert.show('This device\tdoes not appear to be connected to the internet.<br /><br />Please check the WIFI connection to receive event match assignments.<br /><br /><a href="http://www.fast.com" style="color:#0000ff; text-decoration: underline;" target="_blank" style>Click here to test your Wifi</a>',null,null,"Notice!"),sess.bracket_offline_error_visible=!0},checkBracketConnectivity:function(){var sess=APP.session;sess.bracket_offline_error_visible||sess.isBracketMatch()&&!sess.isBracketPracticeMatch()&&(sess.getBracketBoardId()||sess.warnBracketConnectivity())},setBracketBSButtons:function(){var sess=APP.session;if($("#bs-reset").hide(0),unsetButton("bs-money"),unsetButton("bs-points-format"),unsetButton("bs-event-type"),APP.game.name||unsetButton("bs-game-info"),$("#bs-event-type").html(sess.getBracketEventText()).show(0),"* unspecified *"==$("#bs-event-type").text()&&$("#bs-event-type").hide(0),sess.isBracketOfficialMatch()&&(1==sess.getBracketMatchGameCount()&&unsetButton("bs-game-info"),sess.isBracketPrescribedMatch())){var mf=APP.session.getMatchFormat();mf&&"ROUND ROBIN"===!mf.event_type&&unsetButton("bs-set-format")}function unsetButton(in_id){$("#"+in_id).removeClass("button").css("border","unset").css("background-image","unset")}},isBracketRoundRobinEnabled:function(){var b=APP.session.bracket,roundRobin=!1;try{$.each(b.events,(function(key,value){"ROUND ROBIN"===this.event_type&&"C"!==this.status&&(roundRobin=!0)}))}catch(e){return!1}return roundRobin},isBracketTournamentInterface:function(in_bracket_interface){return in_bracket_interface&&"None"!=in_bracket_interface},isBracketMatch:function(){return null!=APP.session.bracket},isOptimizedBracketRoster:function(){try{var optRoster=APP.session.getFromTournament("optimized_roster");if(optRoster&&"Y"==optRoster)return!0}catch(e){}return!1},isOnlineBracketMatch:function(checkGuest){return"TOURNAMENT"==APP.session.getMatchMode()&&"PARTICIPANT"==APP.device.role||!checkGuest&&!(!APP.session.isBracketPrescribedMatch()||!APP.device.is_hosting)},exitOnlineBracketMatch:function(exit_type){if(APP.lobby.isLobbyMatch())APP.session.exitLobbyMatch(exit_type);else switch(APP.header.killTempPlayers(),APP.header.storeDirectory(),exit_type){case"pss-exit":if("PARTICIPANT"==APP.device.role?console.log("Guest Leaves via Exit Screen"):console.log("Host Leaves via Exit Screen"),!APP.session.tournament_id)return APP.revertToLocalPlay(),void APP.exitAlley({new_match_mode:!0});BBAT.storeData({reload_bracket:APP.session.tournament_id}),BBAT.storeData({reload_bracket_board:APP.session.bracket.board_id}),APP.message_bar.resetPromo(),APP.session.resetBracketMatch(!0),APP.session.setMatchFormat(null),APP.exitAlley({new_match_mode:!0});break;case"exit-from-menu":if("PARTICIPANT"==APP.device.role?console.log("Guest Leaves via Menu"):console.log("Host Leaves via Menu"),!APP.session.tournament_id)return APP.revertToLocalPlay(),void APP.exitAlley({new_match_mode:!0});BBAT.storeData({reload_bracket:APP.session.tournament_id}),BBAT.storeData({reload_bracket_board:APP.session.bracket.board_id}),APP.handleAlleyOption("pcm-disconnect-host-button"),APP.message_bar.resetPromo(),APP.session.resetBracketMatch(!0),APP.session.setMatchFormat(null),APP.exitAlley({new_match_mode:!0});break;case"exit-from-tournament":APP.message_bar.resetPromo(),APP.server.closeAlley(),APP.session.killBracket(),APP.revertToLocalPlay(),APP.exitAlley({new_match_mode:!0});break;default:APP.revertToLocalPlay(),APP.exitAlley({new_match_mode:!0})}},exitLobbyMatch:function(exit_type){switch(APP.header.killTempPlayers(),exit_type){case"pss-exit":"PARTICIPANT"==APP.device.role?(console.log("Guest Leaves via Menu"),APP.lobby.data.isInMatch=!1,APP.lobby.data.guestExit=!0,APP.lobby.save()):(console.log("Host Leaves via Menu"),APP.lobby.data.isInMatch=!1,APP.lobby.save());try{APP.session.setMatchFormat(null)}catch(e){}APP.exitAlley({new_match_mode:!0});break;case"exit-from-menu":"PARTICIPANT"==APP.device.role?(console.log("Guest Leaves via Menu"),APP.lobby.data.isInMatch=!1,APP.lobby.data.guestExit=!0,APP.lobby.save()):(console.log("Host Leaves via Menu"),APP.lobby.data.isInMatch=!1,APP.lobby.save(),APP.session.setDefaultMatchScore()),APP.handleAlleyOption("pcm-disconnect-host-button"),APP.exitAlley({new_match_mode:!0})}},reloadOnlineBracket:function(){var bracketId=BBAT.fetchData("reload_bracket");bracketId?APP.session.handleTournamentListing(bracketId):"PRE-ROLE"==APP.mode&&APP.session.tournament_id&&(APP.session.killBracket(),APP.exitTournament())},showOnlineBracketOptions:function(isLobby){var title="End Leg Options";APP.game.started?($("#pobrg-opponent-0").show(),$("#pobrg-opponent-1").show(),$("#pobrg-opponentff-0").show(),$("#pobrg-opponentff-1").show(),$("#pobrg-delete").show(),$(".pobrg-linebreak").show()):($("#pobrg-opponent-0").hide(),$("#pobrg-opponent-1").hide(),$("#pobrg-opponentff-0").hide(),$("#pobrg-opponentff-1").hide(),$("#pobrg-delete").hide(),$(".pobrg-linebreak").hide(),title="End Match Options"),$("#popup-online-bracket-reset-game .popup-title span").html(title),!APP.device.has_chalk||APP.game.plugin.is_edit_mode?(APP.device.disableButton("pobrg-opponent-0"),APP.device.disableButton("pobrg-opponent-1"),APP.device.disableButton("pobrg-opponentff-0"),APP.device.disableButton("pobrg-opponentff-1"),APP.device.disableButton("pobrg-delete")):(APP.device.enableButton("pobrg-opponent-0"),APP.device.enableButton("pobrg-opponent-1"),APP.device.enableButton("pobrg-opponentff-0"),APP.device.enableButton("pobrg-opponentff-1"),APP.device.enableButton("pobrg-delete")),2==APP.game.opponent.length?($("#pobrg-opponent-0 span").html(APP.game.opponent[0].chalkboard_name),$("#pobrg-opponent-1 span").html(APP.game.opponent[1].chalkboard_name),$("#pobrg-opponentff-0 span").html(APP.game.opponent[0].chalkboard_name),$("#pobrg-opponentff-1 span").html(APP.game.opponent[1].chalkboard_name)):($("#pobrg-opponent-0 span").html("Home"),$("#pobrg-opponent-1 span").html("Away"),$("#pobrg-opponentff-0 span").html("Home"),$("#pobrg-opponentff-1 span").html("Away")),isLobby&&($(".pobrg-linebreak").hide(),$("#pobrg-opponent-0").hide(),$("#pobrg-opponent-1").hide(),$("#pobrg-opponentff-0").hide(),$("#pobrg-opponentff-1").hide());var sess=APP.session;APP.popup.show("popup-online-bracket-reset-game"),APP.device.addButtonHandler(["pobrg-close","pobrg-exit","pobrg-delete","pobrg-opponent-0","pobrg-opponent-1","pobrg-opponentff-0","pobrg-opponentff-1"],sess.handleOnlineBracketOption)},hideOnlineBracketOptions:function(){APP.popup.hide("popup-online-bracket-reset-game"),$("#chalkboard-overlay").hide()},handleOnlineBracketOption:function(in_id){var sess=APP.session;switch(in_id){case"pobrg-delete":sess.hideOnlineBracketOptions(),APP.handleResetGameOption("prg-delete");break;case"pobrg-close":sess.hideOnlineBracketOptions();break;case"pobrg-opponentff-0":case"pobrg-opponentff-1":sess.hideOnlineBracketOptions(),APP.confirm.show({title:"Forfeit Leg",msg:'<p>This will award a forfeit leg win to the opponent and <span class="text-bold">DELETE</span> both player\'s game data for this leg.</p>',ok:function(){var forfeiter=APP.extractLastNumberSegment(in_id);forfeiter=0==forfeiter?1:0,APP.game.winning_opponent=forfeiter,APP.game.sudden_death_win=!0,APP.game.leg_forfeit=forfeiter,APP.game.finish(3)}});break;case"pobrg-opponent-0":case"pobrg-opponent-1":sess.hideOnlineBracketOptions(),APP.confirm.show({title:"Player Wins",msg:'<p>This will award a leg win to the player and <span class="text-bold">SAVE</span> both player\'s game data for this leg.</p>',ok:function(){APP.game.winning_opponent=APP.extractLastNumberSegment(in_id),APP.game.sudden_death_win=!0,APP.game.finish(3)}});break;case"pobrg-exit":var msg="This will end the match and delete any data associated with the current leg";"PARTICIPANT"!==APP.device.role||APP.lobby.isLobbyMatch()||(msg="This device will leave the match. The Host device can continue to score the match on their device."),APP.confirm.show({title:"DANGER!",msg:msg,ok:function(){APP.session.exitOnlineBracketMatch("exit-from-menu")},cancel:function(){}})}},isBracketPrescribedMatch:function(){var b=APP.session.bracket;return null!=b&&(null!=b.event_id&&null!=b.match_id)},isBracketOfficialMatch:function(){var b=APP.session.bracket;return null!=b&&(null!=b.event_id&&"PRACTICE"!=b.event_id)},isBracketPracticeMatch:function(){var b=APP.session.bracket;return null!=b&&"PRACTICE"==b.event_id},resetBracketMatch:function(in_remove_match_from_list){var b=APP.session.bracket;function resetMatch(){delete b.match_id,delete b.event_id,delete b.event_type,BBAT.storeData({bracket:b})}if(b.match_list&&in_remove_match_from_list){var realMatchId=b.match_id+"_"+b.event_id;delete b.match_list[realMatchId],BBAT.objectHasProperties(b.match_list)||"E"===APP.session.getTournamentTablets()?resetMatch():APP.session.resetBracketBoard()}else resetMatch();APP.user_options.tournament_mode=null,APP.storeUserOptions()},setBracketMatch:function(in_event_id,in_match_id){var sess=APP.session,t_id=sess.tournament_id,t=sess.tournaments[t_id],b=sess.bracket;in_event_id&&"PRACTICE"!=in_event_id?(b.event_type=t.events[in_event_id].event_type,APP.user_options.tournament_mode=b.event_type,APP.storeUserOptions()):(b.event_type=null,APP.user_options.tournament_mode=null,APP.storeUserOptions());var ml=sess.bracket.match_list,realMatchId=null;ml&&void 0!==ml[in_match_id]&&(realMatchId=ml[in_match_id].bracket_match_id),b.event_id=in_event_id||null,b.match_id=realMatchId,BBAT.storeData({bracket:b})},setBracketMatchFormat:function(in_bracket_event_id,in_override){var ro,mf,sess=APP.session,b=sess.bracket||{};if("PRACTICE"==in_bracket_event_id)sess.setMatchFormat(null);else{var e=b.events[in_bracket_event_id];if(sess.setMatchFormat(e.match_settings),APP.user_options.tournament_leg_max=e.match_settings.legs.max,APP.storeUserOptions(),"DEFAULT"==in_override)return;(ro=e.round_overides[in_override])&&((mf=sess.getMatchFormat()).legs.limit=ro.legs,mf.legs.mode=ro.mode,ro.sets&&(mf.sets.limit=ro.sets),ro.ignore_win_by_two&&"Y"==ro.ignore_win_by_two&&(mf.win_by_two="N"),ro.max_legs&&(mf.legs.max=ro.max_legs),sess.setMatchFormat(mf))}},getBracketEventId:function(useSelectedMatch){var b=APP.session.bracket||{};if(useSelectedMatch){try{var sess=APP.session;return e_id=sess.bracket_selected_match_parts[1],e_id||""}catch(e){}return b.event_id||""}return b.event_id||""},getBracketBoardId:function(){return(APP.session.bracket||{}).board_id||""},getBracketEventText:function(){var e,b=APP.session.bracket||{},dflt="* unspecified *";return b.events&&b.event_id?"PRACTICE"==b.event_id?"* Practice Match *":(e=b.events[b.event_id])?e.event_label:dflt:dflt},getBracketMatchGameCount:function(){var e,b=APP.session.bracket||{};return b.events&&b.event_id&&(e=b.events[b.event_id])&&e.game_menu?e.game_menu.length:0},getBracketMatchObject:function(in_bracket_match_id){var b=APP.session.bracket||{},ml=b.match_list,matchObj=null;if(!ml)return null;if(!in_bracket_match_id){try{matchObj=ml[b.match_id+"_"+b.event_id]}catch(e){return null}if(matchObj)return matchObj}try{matchObj=ml[in_bracket_match_id]}catch(e){return null}return matchObj},getBracketMatchBoardNo:function(){var b=APP.session.bracket||{},ml=b.match_list,boardNo=null;if(!ml)return null;try{boardNo=ml[b.match_id+"_"+b.event_id].board_number}catch(e){return null}return boardNo},initBracket:function(in_tournament_id,in_interface_id){var sess=APP.session,t=sess.tournaments[in_tournament_id];sess.bracket={tournament_id:in_tournament_id,interface_id:in_interface_id,events:t.events,user_options:t.user_options},BBAT.storeData({bracket:sess.bracket})},killBracket:function(){APP.session.bracket=null,BBAT.flushData("bracket")},resetBracketBoard:function(){var key,b=APP.session.bracket;for(key in b)switch(key){case"tournament_id":case"interface_id":case"events":case"user_options":break;default:delete b[key]}BBAT.storeData({bracket:b})},setBracketBoard:function(in_board_id,in_callback){var sess=APP.session,b=sess.bracket;function getMatches(in_board_id,in_callback){APP.server.getBracketMatches({tournament_id:b.tournament_id,board_id:in_board_id,on_success:function(in_payload){b.match_list=in_payload.matches,b.match_order=in_payload.match_order,BBAT.storeData({bracket:b}),in_callback()},on_logic_error:function(){in_callback()},on_network_error:function(){APP.session.bracket_offline_error_visible=!1,APP.session.warnBracketConnectivity(),"function"==typeof in_callback&&in_callback()}})}b.board_id=in_board_id,BBAT.storeData({bracket:b}),sess.getBracketEventsSetup((function(){var currentBracket=sess.tournaments[sess.bracket.tournament_id];currentBracket.events&&(b.events=currentBracket.events),APP.session.applyAdditionalTournamentOptions(),currentBracket.user_options&&(b.user_options=sess.tournaments[sess.bracket.tournament_id].user_options,APP.session.applyUserOptions(b.user_options)),BBAT.storeData({bracket:b}),function(in_board_id,in_callback){APP.server.getTournamentPlayers({spinner:!0,tournament_id:b.tournament_id,on_success:function(in_players){APP.header.loadTournamentDirectory(in_players),getMatches(in_board_id,in_callback)},on_error:function(){getMatches(in_board_id,in_callback)}})}(in_board_id,in_callback)}))},getBracketEventsSetup:function(in_callback){var t_id,t,sess=APP.session;t_id=sess.tournament_id||sess.getTournamentID(),APP.server.getBracketTournamentSetup({dc_tournament_id:t_id,on_success:function(in_payload){t=sess.tournaments[t_id],in_payload.audience&&(t.audience=in_payload.audience),t.events=in_payload.events,t.user_options=in_payload.user_options,in_payload.opponent_connection_method&&(t.opponent_connection_method=in_payload.opponent_connection_method),in_payload.optimized_roster&&(t.optimized_roster=in_payload.optimized_roster),t.user_options.floating_set_score=!0,BBAT.storeData({tournaments:sess.tournaments}),in_callback&&in_callback()},on_logic_error:function(){in_callback&&in_callback()},on_network_error:function(){in_callback&&in_callback()}})},deleteBracketMatchList:function(){delete APP.session.bracket.match_list,delete APP.session.bracket.match_order},webSocketBracketUpdate:function(noPlayers){if(APP.session.isBracketMatchListing&&"ready"===APP.session.bracketMatchTabHelper.currentTab){var sess=APP.session,b=sess.bracket;b.board_id;sess.getBracketEventsSetup((function(){var currentBracket=sess.tournaments[sess.bracket.tournament_id];currentBracket.events&&(b.events=currentBracket.events),APP.session.applyAdditionalTournamentOptions(),currentBracket.user_options&&(b.user_options=sess.tournaments[sess.bracket.tournament_id].user_options,APP.session.applyUserOptions(b.user_options)),BBAT.storeData({bracket:b}),noPlayers||APP.server.getTournamentPlayers({spinner:!0,tournament_id:b.tournament_id,on_success:function(in_players){APP.header.loadTournamentDirectory(in_players)},on_error:function(){}})}))}},webSocketBracketScoreUpdate:function(in_payload){if(APP.session.isBracketMatchListing){var m=in_payload,b=APP.session.bracket;try{var scoreId="live_score_"+m.bracket_event_id+"_"+m.bracket_match_id,scoreDisplay=$("#"+scoreId);if(scoreDisplay.length){var match=b.match_list[m.bracket_match_id+"_"+m.bracket_event_id];match.match_score=m.score0+" - "+m.score1;var scoreHtml=APP.session.createBracketScoreDisplay(match,scoreId);scoreDisplay.html(scoreHtml)}}catch(e){}}},createBracketScoreDisplay:function(m,scoreId){m.match_score=m.match_score.replace(/\s+/g,"");var currentScore=m.match_score.split("-"),display="";if(m.sets_limit>1)return display+='\n\t\t\t\t<div style="text-align: center">\n\t\t\t\t\tMatch in progress\n\t\t\t\t</div>\n\t\t\t';try{display+=`\n\t\t\t\t<div class="live-scores">\n\t\t\t\t\t${currentScore[0]} - ${currentScore[1]}\n\t\t\t\t</div>\n\t\t\t`}catch(e){display='<span class="no-score">vs.</span>'}return display},webSocketBracketMatchUpdate:function(in_payload){if(APP.session.isBracketMatchListing){var b=APP.session.bracket;b.match_list=in_payload.matches,b.match_order=in_payload.match_order,BBAT.storeData({bracket:b}),APP.session.buildTabbedBracketMatchListing()}},buildTabbedBracketMatchListing:function(){var sess=APP.session,matchList=sess.bracket.match_list,matchOrder=sess.bracket.match_order||sess.buildMatchOrder(matchList),context=this.getMatchContext(matchOrder,matchList),currentEventId=context.currentEventId,isRoundRobin=context.isRoundRobin,isSportRadar=context.isSportRadar;isRoundRobin&&(matchOrder=this.sortRoundRobinMatches(matchOrder,matchList));for(var matchCardsReady=[],matchCardsLive=[],matchCardsPending=[],matchCardsReadyWithHeader=[],matchCardsLiveWithHeader=[],matchCardsPendingWithHeader=[],buttonIds=[],lastRoundId={ready:null,live:null,pending:null},i=0;i<matchOrder.length;i++){var match=matchList[matchOrder[i]];if(match&&match.bracket_match_id&&match.bracket_event_id){var buttonId=`pbml-${match.bracket_event_id}-${match.round_id||"DEFAULT"}-${match.bracket_match_id}_${match.bracket_event_id}`;(match.is_pending||match.is_bye)&&(buttonId="-1");var matchCard=this.createMatchCard({match:match,isSportRadar:isSportRadar,isRR:isRoundRobin,hasCurrentPlayer:this.hasCurrentPlayer(match),bId:buttonId});if(match.is_pending){this.checkAddRoundHeader(matchCardsPendingWithHeader,match,"pending",isRoundRobin,lastRoundId);var dupePendingMatchCard=this.createPendingMatchBlock({match:match,isSportRadar:isSportRadar,isRR:isRoundRobin,hasCurrentPlayer:this.hasCurrentPlayer(match),bId:buttonId});matchCardsReadyWithHeader.push(dupePendingMatchCard),matchCardsPendingWithHeader.push(dupePendingMatchCard),matchCardsPending.push(dupePendingMatchCard)}else match.match_score?(this.checkAddRoundHeader(matchCardsLiveWithHeader,match,"live",isRoundRobin,lastRoundId),matchCardsLiveWithHeader.push(matchCard),matchCardsLive.push(matchCard)):(this.checkAddRoundHeader(matchCardsReadyWithHeader,match,"ready",isRoundRobin,lastRoundId),matchCardsReadyWithHeader.push(matchCard),matchCardsReady.push(matchCard));match.is_bye||buttonIds.push(buttonId)}}try{if(currentEventId){var eventLabel=sess.bracket.events[currentEventId].event_label;eventLabel&&$("#pbml-event-label").text(eventLabel)}$("#pbml-tournament-label").text(sess.tournaments[sess.bracket.tournament_id].match_description)}catch(e){console.log("Label error:",e)}var readyHeader="Ready";matchCardsReady.length&&(readyHeader=`Ready (${matchCardsReady.length})`);var liveHeader="Live";matchCardsLive.length&&(liveHeader=`Live (${matchCardsLive.length})`);var pendingHeader="Pending";matchCardsPending.length&&(pendingHeader=`Pending (${matchCardsPending.length})`);var headers=[readyHeader,liveHeader,pendingHeader],readyContent="",liveContent="",pendingContent="",isOnline="online"==APP.session.getFromTournament("opponent_connection_method");matchCardsReadyWithHeader.length?(readyContent='\n\t\t\t\t<div class="pbml-match-title text-gold">\n\t\t\t\t\tSelect a Match to Play\n\t\t\t\t</div>\n\t\t\t',readyContent+=matchCardsReadyWithHeader.join("")):readyContent='\n\t\t\t\t<div class="pbml-match-title">\n\t\t\t\t\tNo Matches Ready\n\t\t\t\t</div>\n\t\t\t',matchCardsLiveWithHeader.length?(liveContent=isOnline?matchCardsLive.length?'\n\t\t\t\t\t\t<div class="pbml-match-title text-gold">\n\t\t\t\t\t\t\tLive Matches\n\t\t\t\t\t\t</div>\n\t\t\t\t\t':'\n\t\t\t\t\t\t<div class="pbml-match-title">\n\t\t\t\t\t\t\tNo Live Matches\n\t\t\t\t\t\t</div>\n\t\t\t\t\t':'\n\t\t\t\t\t<div class="highlight-box danger mLgBottom" id="pbml-match-download">\n\t\t\t\t\t\t<h4 class="text-gold mNoneBottom">Match Download</h4>\n\t\t\t\t\t\t<p class="bold mMdBottom">For tournament officials only.</p>\n\t\t\t\t\t\t<p class="mMdBottom">Use this feature to download an in-progress match to this device.</p>\n\t\t\t\t\t\t<p><span class="bold">IMPORTANT:</span> Confirm the most recent turns to ensure match accuracy.</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="pbml-match-title text-gold">\n\t\t\t\t\t\tSelect a match to download\n\t\t\t\t\t</div>\n\t\t\t\t',liveContent+=matchCardsLiveWithHeader.join("")):liveContent='\n\t\t\t\t<div class="highlight-box primary mLgBottom" id="pbml-match-download">\n\t\t\t\t\t<h4 class="text-gold">Match Download</h4>\n\t\t\t\t\t<p>If a device fails mid-match, a tournament official can download the match to a new device. Verify recent scores to ensure syncing was successful before the failure.</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="pbml-match-title">\n\t\t\t\t\tNo live matches found for this board number. Check the number and WiFi connection.\n\t\t\t\t</div>\n\t\t\t',matchCardsPendingWithHeader.length?(pendingContent='\n\t\t\t\t<div class="pbml-match-title text-gold">\n\t\t\t\t\tUpcoming Matches\n\t\t\t\t</div>\n\t\t\t',pendingContent+=matchCardsPendingWithHeader.join("")):pendingContent='\n\t\t\t\t<div class="pbml-match-title">\n\t\t\t\t\tNo Upcoming Matches\n\t\t\t\t</div>\n\t\t\t';var contents=[readyContent,liveContent,pendingContent];APP.fns.createMyTabs("#pbml-bracket-tabs",headers,contents,sess.bracketMatchTabHelper.changeTab),APP.device.addButtonHandler(buttonIds,this.handleBracketMatchListing),APP.device.setButtonEvents("#pbml-bracket-tabs .button")},checkAddRoundHeader:function(arr,match,groupKey,isRoundRobin,lastRoundId){if(isRoundRobin&&"string"==typeof match.round_id){var round=parseFloat(match.round_id);isNaN(round)||lastRoundId[groupKey]!==round&&(lastRoundId[groupKey]=round,arr.push(`<h4 class="pbml-round-label">Round ${round}</h4>`))}},hasCurrentPlayer:function(match){if(APP.user.pa)return!1;for(var id=APP.user.member_id,i=0;i<(match.home_players||[]).length;i++)if(match.home_players[i].member_id==id)return!0;for(i=0;i<(match.away_players||[]).length;i++)if(match.away_players[i].member_id==id)return!0;return!1},sortRoundRobinMatches:function(matchOrder,matchList){for(var matchArr=[],i=0;i<matchOrder.length;i++){var m=matchList[matchOrder[i]];m&&matchArr.push(m)}matchArr.sort((function(a,b){var aNum=parseInt(a.bracket_match_id.replace(/[^\d]/g,""),10),bNum=parseInt(b.bracket_match_id.replace(/[^\d]/g,""),10);return aNum!==bNum?aNum-bNum:a.bracket_match_id<b.bracket_match_id?-1:a.bracket_match_id>b.bracket_match_id?1:0}));for(var result=[],j=0;j<matchArr.length;j++)result.push(matchArr[j].bracket_match_id+"_"+matchArr[j].bracket_event_id);return result},getMatchContext:function(matchOrder,matchList){for(var currentEventId=null,isSingleEvent=!0,i=0;i<matchOrder.length;i++){var match=matchList[matchOrder[i]];if(currentEventId){if(match.bracket_event_id!==currentEventId){isSingleEvent=!1;break}}else currentEventId=match.bracket_event_id}var isRoundRobin=!1,isSportRadar=!1;if(isSingleEvent&&currentEventId)try{var tourney=APP.session.tournaments[APP.session.bracket.tournament_id],ev=tourney.events[currentEventId];ev&&"ROUND ROBIN"===ev.event_type&&(isRoundRobin=!0),"Sportradar"===tourney.bracket_interface&&(isSportRadar=!0)}catch(e){console.log("event type check failed",e)}if(!isSingleEvent){isRoundRobin=!0;for(var j=0;j<matchOrder.length;j++){var match2=matchList[matchOrder[j]];try{var ev2=APP.session.tournaments[APP.session.bracket.tournament_id].events[match2.bracket_event_id];if(ev2&&"ROUND ROBIN"!==ev2.event_type){isRoundRobin=!1;break}}catch(e){isRoundRobin=!1;break}}}return{currentEventId:currentEventId,isSingleEvent:isSingleEvent,isRoundRobin:isRoundRobin,isSportRadar:isSportRadar}},buildMatchOrder:function(matchList){var matchOrder=[],matchesWithSequence=[],matchesWithoutSequence=[];for(var key in matchList){if(matchList.hasOwnProperty(key))(match=matchList[key]).bracket_match_id&&match.bracket_event_id?null==match.match_sequence||isNaN(match.match_sequence)?matchesWithoutSequence.push(key):matchesWithSequence.push({key:key,sequence:match.match_sequence}):console.log(`Invalid match key: ${key}, missing bracket_match_id or bracket_event_id`)}matchesWithSequence.sort((function(a,b){return a.sequence-b.sequence})),matchesWithoutSequence.sort((function(a,b){for(var aParts=a.split("_"),bParts=b.split("_"),len=Math.min(aParts.length,bParts.length),i=0;i<len;i++){var aPart=aParts[i],bPart=bParts[i],aNum=parseFloat(aPart),bNum=parseFloat(bPart);if(isNaN(aNum)||isNaN(bNum)){if(aPart!==bPart)return aPart<bPart?-1:1}else if(aNum!==bNum)return aNum-bNum}return aParts.length-bParts.length}));for(var i=0;i<matchesWithSequence.length;i++)matchOrder.push(matchesWithSequence[i].key);for(var j=0;j<matchesWithoutSequence.length;j++)matchOrder.push(matchesWithoutSequence[j]);if(!matchOrder.length){for(var k in matchList){var match;if(matchList.hasOwnProperty(k))(match=matchList[k]).bracket_match_id&&match.bracket_event_id?matchOrder.push(k):console.log(`Invalid match key: ${k}, missing bracket_match_id or bracket_event_id`)}matchOrder.sort((function(a,b){for(var aParts=a.split("_"),bParts=b.split("_"),len=Math.min(aParts.length,bParts.length),i=0;i<len;i++){var aPart=aParts[i],bPart=bParts[i],aNum=parseFloat(aPart),bNum=parseFloat(bPart);if(isNaN(aNum)||isNaN(bNum)){if(aPart!==bPart)return aPart<bPart?-1:1}else if(aNum!==bNum)return aNum-bNum}return aParts.length-bParts.length}))}return matchOrder},createMatchCard:function(in_obj){var m=in_obj.match,content="";try{var buttonClass="button button-menu round-corners pbml-button button-white";APP.user.pa||in_obj.hasCurrentPlayer||(buttonClass+=" button-de-highlight"),m.is_bye&&(buttonClass+=" button-bye"),m.is_pending&&(buttonClass+=" button-pending"),m.is_forfeit&&(buttonClass+=" button-forfeit");var legCountOverride;legCountOverride=this.getRoundRobinOverride(m);var deOverrides=!1;try{(deOverrides=APP.session.getDEOverrides(m))&&(m.legs_limit=deOverrides.legs,m.legs_mode=deOverrides.mode,m.sets_limit=deOverrides.sets)}catch(e){}var headerInfo="",timeInfo="",markerInfo="",raceInfo="",matchInfo="";if(m.round_id&&m.bracket_match_id){var matchId=m.bracket_match_id.replace("_","-");headerInfo=in_obj.isSportRadar?m.round_label:`\n\t\t\t\t\t\t${m.round_label} | Match ${matchId}\n\t\t\t\t\t`}if(m.is_forfeit){headerInfo='\n\t\t\t\t\t<span class="ff-info text-gold">\n\t\t\t\t\t\tThis Match is Subject to Forfeit\n\t\t\t\t\t</span>\n\t\t\t\t'+headerInfo}if(m.sched_time)if(m.sched_time&&(timeInfo+=`\n\t\t\t\t\t\t\t<svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 6px;">\n\t\t\t\t\t\t\t\t<use xlink:href="#icon-clock"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span class="bold">${m.sched_time}</span>\n\t\t\t\t\t`),m.sched_date)timeInfo+=`\n\t\t\t\t\t \t <svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 6px;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-calendar"></use>\n\t\t\t\t\t \t</svg>\n\t\t\t\t\t\t <span class="bold">${moment(m.sched_date).format("DD MMM")}</span>\n\t\t\t\t\t `;m.marker_label&&(markerInfo+=`\n\t\t\t\t\t<svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 3px;">\n\t\t\t\t\t\t<use xlink:href="#icon-edit"></use>\n\t\t\t\t\t</svg> ${m.marker_label}\n\t\t\t\t`);try{var race=m.legs_limit,firstRaceVal=m.legs_limit,maxRace=m.legs_limit;if(legCountOverride&&(maxRace=legCountOverride,race=legCountOverride,firstRaceVal=legCountOverride),"BEST-OF"==m.legs_mode?(race=Math.round(race/2),firstRaceVal%2==0?raceInfo=`First to ${race+1} - Best of ${maxRace}`:(raceInfo="First to "+race+" leg",raceInfo+=race>1?"s":"")):(raceInfo="Play "+race+" leg",raceInfo+=race>1?"s":""),m.sets_limit&&m.sets_limit>1)raceInfo=`First to ${Math.round(m.sets_limit/2)} sets`+" ("+raceInfo+")"}catch(e){}if(m.match_score&&(buttonClass+=" button-live"),content+=`\n\t\t\t\t<div id="${in_obj.bId}" class="${buttonClass}">\n\t\t\t`,m.is_bye&&(matchInfo+=`\n\t\t\t\t\t<span class="match-info text-info-dark">\n\t\t\t\t\t\t${headerInfo} ${headerInfo&&raceInfo?"|":""} ${raceInfo}\n\t\t\t\t\t</span>\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t${m.home_button_label?m.home_button_label:m.away_button_label} has a bye\t\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`),m.is_pending&&(matchInfo+=`\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-right">\n\t\t\t\t\t\t\t\t${m.home_button_label?m.home_button_label:m.away_button_label}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="pbml-vs">vs.</td>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-left">\n\t\t\t\t\t\t\t\t&hellip;\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`),!m.is_bye&&!m.is_pending){var scoreId="live_score_"+m.bracket_event_id+"_"+m.bracket_match_id;if(matchInfo=`\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-right">${m.home_button_label}</td>\n\t\t\t\t\t\t\t<td class="pbml-live-score" id="${scoreId}">\n\t\t\t\t`,m.match_score)m.match_score=m.match_score.replace(/\s+/g,""),2==m.match_score.split("-").length&&(matchInfo+=this.createBracketScoreDisplay(m,scoreId));else matchInfo+='<span class="no-score">vs.</span>';matchInfo+=`\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-left">${m.away_button_label}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`}content+=`\n\t\t\t\t${timeInfo?"<p class='extras-info'>":""}\n\t\t\t\t${timeInfo}\n\t\t\t\t${timeInfo?"</p>":""}\n\n\t\t\t\t<span class="match-info text-info-dark">\n\t\t\t\t\t${headerInfo} ${headerInfo&&raceInfo?"|":""} ${raceInfo}\n\t\t\t\t</span>\n\n\t\t\t\t${matchInfo}\n\n\t\t\t\t${markerInfo?"<p class='pbml-race-marker'>":""}\n\t\t\t\t${markerInfo}\n\t\t\t\t${markerInfo?"</p>":""}\n\t\t\t`,content+="</div>"}catch(e){console.log(e.message)}return content},createPendingMatchBlock:function(in_obj){var m=in_obj.match,content="";try{var buttonClass="button button-menu round-corners pbml-button";APP.user.pa||in_obj.hasCurrentPlayer||(buttonClass+=" button-de-highlight"),m.is_bye&&(buttonClass+=" button-bye"),m.is_forfeit&&(buttonClass+=" button-forfeit"),buttonClass+=" button-pending";var legCountOverride;legCountOverride=this.getRoundRobinOverride(m);var deOverrides=!1;try{(deOverrides=APP.session.getDEOverrides(m))&&(m.legs_limit=deOverrides.legs,m.legs_mode=deOverrides.mode,m.sets_limit=deOverrides.sets)}catch(e){}var headerInfo="",timeInfo="",markerInfo="",raceInfo="",matchInfo="";if(m.round_id&&m.bracket_match_id){var matchId=m.bracket_match_id.replace("_","-");headerInfo=in_obj.isSportRadar?m.round_label:`\n\t\t\t\t\t\t${m.round_label} | Match ${matchId}\n\t\t\t\t\t`}if(m.is_forfeit){headerInfo='\n\t\t\t\t\t<span class="ff-info text-gold">\n\t\t\t\t\t\tThis Match is Subject to Forfeit\n\t\t\t\t\t</span>\n\t\t\t\t'+headerInfo}if(m.sched_time)if(m.sched_time&&(timeInfo+=`\n\t\t\t\t\t\t<svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 6px;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-clock"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span class="bold">${m.sched_time}</span>\n\t\t\t\t\t`),m.sched_date)timeInfo+=`\n\t\t\t\t\t\t<svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 6px;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-calendar"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span class="bold">${moment(m.sched_date).format("DD MMM")}</span>\n\t\t\t\t\t`;m.marker_label&&(markerInfo+=`\n\t\t\t\t\t<svg viewBox="0 0 25 25" style="width: 1.3em; height: 1.3em; position: relative;top: 3px;">\n\t\t\t\t\t\t<use xlink:href="#icon-edit"></use>\n\t\t\t\t\t</svg> ${m.marker_label}\n\t\t\t\t`);try{var race=m.legs_limit,firstRaceVal=m.legs_limit,maxRace=m.legs_limit;if(legCountOverride&&(maxRace=legCountOverride,race=legCountOverride,firstRaceVal=legCountOverride),"BEST-OF"==m.legs_mode?(race=Math.round(race/2),firstRaceVal%2==0?raceInfo=`First to ${race+1} - Best of ${maxRace}`:(raceInfo="First to "+race+" leg",raceInfo+=race>1?"s":"")):(raceInfo="Play "+race+" leg",raceInfo+=race>1?"s":""),m.sets_limit&&m.sets_limit>1)raceInfo=`First to ${Math.round(m.sets_limit/2)} sets`+" ("+raceInfo+")"}catch(e){}if(m.match_score&&(buttonClass+=" button-live"),content+=`\n\t\t\t\t<div class="${buttonClass}">\n\t\t\t`,m.is_bye&&(matchInfo+=`\n\t\t\t\t\t<span class="match-info text-info-dark">\n\t\t\t\t\t\t${headerInfo} ${headerInfo&&raceInfo?"|":""} ${raceInfo}\n\t\t\t\t\t</span>\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t${m.home_button_label?m.home_button_label:m.away_button_label} has a bye\t\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`),m.is_pending&&(matchInfo+=`\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-right">\n\t\t\t\t\t\t\t\t${m.home_button_label?m.home_button_label:m.away_button_label}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="pbml-vs">vs.</td>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-left">\n\t\t\t\t\t\t\t\t&hellip;\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`),!m.is_bye&&!m.is_pending){var scoreId="live_score_"+m.bracket_event_id+"_"+m.bracket_match_id;if(matchInfo=`\n\t\t\t\t\t<table style="width:100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-right">${m.home_button_label}</td>\n\t\t\t\t\t\t\t<td class="pbml-live-score" id="${scoreId}">\n\t\t\t\t`,m.match_score)m.match_score=m.match_score.replace(/\s+/g,""),2==m.match_score.split("-").length&&(matchInfo+=this.createBracketScoreDisplay(m,scoreId));else matchInfo+='<span class="no-score">vs.</span>';matchInfo+=`\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="pbml-button-label text-left">${m.away_button_label}</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`}content+=`\n\t\t\t\t${timeInfo?"<p class='extras-info'>":""}\n\t\t\t\t${timeInfo}\n\t\t\t\t${timeInfo?"</p>":""}\n\n\t\t\t\t<span class="match-info text-info-dark">\n\t\t\t\t\t${headerInfo} ${headerInfo&&raceInfo?"|":""} ${raceInfo}\n\t\t\t\t</span>\n\n\t\t\t\t${matchInfo}\n\n\t\t\t\t${markerInfo?"<p class='pbml-race-marker'>":""}\n\t\t\t\t${markerInfo}\n\t\t\t\t${markerInfo?"</p>":""}\n\t\t\t`,content+="</div>"}catch(e){console.log(e.message)}return content},bracketMatchTabHelper:{timer:null,tabs:["ready","live","pending"],currentTab:"ready",changeTab:function(tabEle){var bmth=APP.session.bracketMatchTabHelper,tab=$("#"+tabEle).attr("data-opt");tab=parseFloat(tab),bmth.currentTab=bmth.tabs[tab]||"ready","ready"!==bmth.currentTab?bmth.startTimer():bmth.stopTimer()},startTimer:function(){var bmth=APP.session.bracketMatchTabHelper;bmth.timer&&(bmth.timer.stopTimer(),bmth.timer=null),window.setTimeout((function(){APP.session.bracketMatchTabHelper.timer=new Timer({name:"bracketMatchTabHelper",runTime:59,callback:function(){APP.session.isBracketMatchListing&&APP.session.bracketMatchTabHelper.changeTab("pbml-tab-ready")},debugMode:!1})}),100)},stopTimer:function(){var bmth=APP.session.bracketMatchTabHelper;bmth.timer&&(bmth.timer.stopTimer(),bmth.timer=null)}},hideBracketMatchListing:function(){APP.session.pauseBracketMatchTimer=!0,APP.session.isBracketMatchListing=!1,APP.session.updateBracketMatchTimer=!1,APP.popup.hide("popup-bracket-match-listing")},showBracketMatchListing:function(){APP.session.pauseBracketMatchTimer=!1,APP.session.isBracketMatchListing=!0,APP.session.updateBracketMatchTimer=!0,APP.session.updateBracketMatchListing(),APP.popup.show("popup-bracket-match-listing");var headerText="v."+APP.version;APP.user&&APP.user.first_name&&!APP.user.pa||APP.user.home_alley_id&&(headerText+=" | DCTV Tablet ID: "+APP.user.home_alley_id),$("#popup-bracket-match-listing .popup-title span").html(headerText),-1==APP.session.getBracketBoardId()?($("#pbml-title").html("Your Matches"),$("#pbml-change").html("View Matches By Board")):$("#pbml-title").html("Board "+APP.session.getBracketBoardId()),APP.server.checkGamePostBroadcast();var sbh=$("#popup-bracket-match-listing").outerHeight(!0)-$("#popup-bracket-match-listing .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#pbml-scroll-box").css("padding-top")));$("#pbml-scroll-box").css("max-height",sbh)},showBracketPlayerSelect:function(){var m,m_id,html,sess=APP.session;if($("#popup-bracket-player-select").removeClass("wdf-version"),$("#pbps-desc").empty(),"IN_PERSON"==APP.session.bracket_play_mode){$("#popup-bracket-player-select").addClass("wdf-version");$("#pbps-desc").html("Select your name only"),$("#pbps-content").html('\n\t\t\t\t<div class="pbps-countdown">Player Check-In</div>\n\t\t\t')}else $("#pbps-content").html("Online Match");sess.pauseBracketMatchTimer=!0,m_id=sess.bracket_selected_match_parts[3],m=sess.getBracketMatchObject(m_id),$("#pbps-host").html(m.home_button_label),$("#pbps-guest").html(m.away_button_label),html=m.home_button_label+'<br><span style="font-size:0.8em;line-height:2.0em;">vs</span><br>'+m.away_button_label,$("#pbmc-content").html(html),$("#pbmc-round-label").html(m.round_id?m.round_id:""),$("#popup-bracket-player-select-overlay").show(0),$("#popup-bracket-player-select").show(0),APP.device.addButtonHandler(["pbps-host","pbps-guest","pbps-cancel","pbps-play","pbps-report-late-oppo"],sess.handleBracketPlayerSelect)},oppoWaitTimer:null,startOppoWaitTimer:function(){APP.session.oppoWaitTimer&&(APP.session.oppoWaitTimer.stopTimer(),APP.session.oppoWaitTimer=null);var timerVars={name:"oppoWaitTimer",runTime:180,callback:function(r){r||($(".pbps-countdown").html("<span class='text-red'>Match Delayed</span>"),$("#pbps-report-late-oppo").show())},eachTick:function(){var content=`\n\t\t\t\t\tPlayer Check-In: <span class="text-red">${this.getCountDown()}</span>\n\t\t\t\t`;$(".pbps-countdown").html(content)},returnMinutes:!0};APP.session.oppoWaitTimer=new Timer(timerVars)},stopOppoWaitTimer:function(){$(".pbps-countdown").html("Player Check-In"),APP.session.oppoWaitTimer&&(APP.session.oppoWaitTimer.stopTimer(),APP.session.oppoWaitTimer=null,$("#pbps-report-late-oppo").hide())},handleBracketPlayerSelect:function(in_id){var sess=APP.session;switch(in_id){case"pbps-play":sess.handleBracketMatchListing("pbmc-play"),closeOverlay();break;case"pbps-host":if("IN_PERSON"==sess.bracket_play_mode){if(-1!==(arrPos=APP.session.bracket_player_waiting.indexOf("HOST")))return APP.session.bracket_player_waiting.splice(arrPos,1),$("#pbps-host").removeClass("button-green").addClass("button-outline"),void(sess.bracket_player_waiting.length||APP.session.stopOppoWaitTimer());sess.bracket_player_waiting.length?(APP.session.startBracketMatch(),closeOverlay(),sess.bracket_player_waiting=null):($("#pbps-host").removeClass("button-outline").addClass("button-green"),sess.bracket_player_waiting.push("HOST"),APP.session.startOppoWaitTimer())}else sess.handleBracketMatchListing("pbmc-play"),APP.handleAlleyOption("pcm-broadcast-start-button",sess.startHostAutoConnect),sess.autoConnectRole="HOST",closeOverlay();break;case"pbps-guest":if("IN_PERSON"==sess.bracket_play_mode){var arrPos;if(-1!==(arrPos=APP.session.bracket_player_waiting.indexOf("GUEST")))return APP.session.bracket_player_waiting.splice(arrPos,1),$("#pbps-guest").removeClass("button-green").addClass("button-gray"),void(sess.bracket_player_waiting.length||APP.session.stopOppoWaitTimer());sess.bracket_player_waiting.length?(APP.session.startBracketMatch(),closeOverlay(),sess.bracket_player_waiting=null):($("#pbps-guest").addClass("button-green").removeClass("button-outline"),sess.bracket_player_waiting.push("GUEST"),APP.session.startOppoWaitTimer())}else sess.handleBracketMatchListing("pbmc-play"),sess.startGuestAutoConnect(),sess.autoConnectRole="GUEST",closeOverlay();break;case"pbps-cancel":sess.stopOppoWaitTimer(),$("#pbps-host").removeClass("button-green").addClass("button-outline"),$("#pbps-guest").removeClass("button-green").addClass("button-outline"),sess.pauseBracketMatchTimer=!1,sess.bracket_player_waiting=[],$("#pbps-host").removeClass("button-disabled").removeClass("button-down"),$("#pbps-guest").removeClass("button-disabled").removeClass("button-down"),closeOverlay();break;case"start-match":APP.session.startBracketMatch();break;case"pbps-report-late-oppo":try{var m_id=(sess=APP.session).bracket_selected_match_parts[3],m=sess.getBracketMatchObject(m_id),matchString=m.home_button_label+" Vs. "+m.away_button_label;if(-1!==APP.session.bracket_player_waiting.indexOf("HOST")){var lateMsg={message:"lateOppo",responses:[],lateOppo:m.away_button_label};APP.message.log("Send from Helper Tree");var message={action:"HELP__MSG",message:lateMsg,tournament_id:APP.session.getTournamentID(),board_number:m.board_number,event_id:m.bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:m.bracket_match_id};APP.message.send.helpMessage(message)}if(-1!==APP.session.bracket_player_waiting.indexOf("GUEST")){lateMsg={message:"lateOppo",responses:[],lateOppo:m.home_button_label};APP.message.log("Send from Helper Tree");message={action:"HELP__MSG",message:lateMsg,tournament_id:APP.session.getTournamentID(),board_number:m.board_number,event_id:m.bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:m.bracket_match_id};APP.message.send.helpMessage(message)}}catch(e){}$("#pbps-report-late-oppo").hide()}function closeOverlay(){$("#popup-bracket-player-select-overlay").hide(0),$("#popup-bracket-player-select").hide(0)}},bracket_match_timer:null,bracket_play_mode:null,bracket_player_waiting:[],ffwd_preflight:!1,ffwd_active:!1,ffwd_no_score:!1,handleBracketMatchListing:function(in_id){var sess=APP.session;if(-1!=in_id)switch(in_id){case"pbml-close":APP.reveal.handleButtons("reveal-exit");break;case"pbml-change":APP.session.isUserMatchesOnly()&&APP.session.switchBracketMatchListingType(),APP.session.resetBracketBoard(),APP.reload();break;case"pbml-refresh":sess.setBracketBoard(sess.getBracketBoardId(),(function(){sess.buildTabbedBracketMatchListing()}));break;case"pbml-practice":APP.session.setBracketMatch("PRACTICE",null),APP.session.hideBracketMatchListing(),APP.session.startNew("TOURNAMENT"),APP.session.setBracketMatchFormat("PRACTICE",null);break;case"pbml-official":APP.session.webSocketBracketUpdate(),sess.showCreateEventMatch();break;default:try{sess.bracket_selected_match_parts=in_id.split("-"),5==sess.bracket_selected_match_parts.length&&(sess.bracket_selected_match_parts[3]=sess.bracket_selected_match_parts[3]+"-"+sess.bracket_selected_match_parts[4]),m_id=sess.bracket_selected_match_parts[3],m=sess.getBracketMatchObject(m_id)}catch(e){}try{var mIsLive=$("#"+in_id).hasClass("button-live");if("online"==APP.session.getFromTournament("opponent_connection_method")&&(mIsLive=!1),mIsLive&&!sess.ffwd_preflight)return void APP.confirm.show({title:"Confirm!",msg:"This match is in progress. Do you want to download it to this device?",ok:function(){APP.session.ffwd_preflight=!0,APP.session.ffwd_active=!0,"0-0"==m.match_score&&(APP.session.ffwd_no_score=!0),sess.handleBracketMatchListing(in_id)},cancel:function(){APP.session.ffwd_preflight=!0,APP.session.ffwd_active=!1,APP.session.ffwd_no_score=!1}})}catch(e){}sess.ffwd_preflight=!1;try{APP.fns.checkPlayersExistInRoster(m)?APP.session.webSocketBracketUpdate(!0):APP.session.webSocketBracketUpdate()}catch(e){APP.session.webSocketBracketUpdate()}if(sess.ffwd_active)return APP.session.startBracketMatch(!0),void APP.ffwd._getData(m.bracket_match_id,m.bracket_event_id);try{if(sess.tournaments[sess.tournament_id]){var connectionMethod=sess.tournaments[sess.tournament_id].opponent_connection_method;if($(".pbmc-online-mode").hide(),$(".pbmc-in-person-mode").hide(),$(".pbmc-mixed-mode").hide(),connectionMethod)switch(connectionMethod){case"in-person":var m,m_id;if(m_id=sess.bracket_selected_match_parts[3],(m=sess.getBracketMatchObject(m_id)).checkin_info&&m.checkin_info.type)return void APP.cif.loadMatch(m);$(".pbmc-in-person-mode").show();break;case"online":$(".pbmc-online-mode").show();break;case"mixed":default:$(".pbmc-mixed-mode").show()}else $(".pbmc-mixed-mode").show()}}catch(e){$(".pbmc-online-mode").hide(),$(".pbmc-in-person-mode").hide(),$(".pbmc-mixed-mode").hide(),$(".pbmc-mixed-mode").show()}!function(){var m,m_id,html;m_id=sess.bracket_selected_match_parts[3],m=sess.getBracketMatchObject(m_id),html=m.home_button_label+'<br><span style="font-size:0.8em;line-height:2.0em;">vs</span><br>'+m.away_button_label,$("#pbmc-content").html(html);var roundName="";m.round_label&&(roundName=m.round_label,$("#pbmc-round-label").html(roundName));$("#popup-bracket-match-confirm-overlay").show(0),$("#popup-bracket-match-confirm").show(0),APP.session.pauseBracketMatchTimer=!0}();break;case"pbmc-play":hideConfirm(),APP.session.bracket_play_mode="IN_PERSON",APP.session.showBracketPlayerSelect();break;case"pbmc-play-in-person":hideConfirm(),APP.session.startBracketMatch();break;case"pbmc-play-online":case"pbmc-play-online-btn":hideConfirm(),APP.session.bracket_play_mode="ONLINE",APP.session.showBracketPlayerSelect();break;case"pbmc-change":hideConfirm();break;case"pbmc-other":sess.showBracketPrematureEndOptions(sess.bracket_selected_match_parts[3]);break;case"pbml-round-robin":APP.session.showBracketRoundRobinEventListing();break;case"pbmo-disqualify-0":setupEndMatch("DISQUALIFY",0,$("#"+in_id).text());break;case"pbmo-forfeit-0":setupEndMatch("FORFEIT",0,$("#"+in_id).text());break;case"pbmo-disqualify-1":setupEndMatch("DISQUALIFY",1,$("#"+in_id).text());break;case"pbmo-forfeit-1":setupEndMatch("FORFEIT",1,$("#"+in_id).text());break;case"pbmo-disqualify-both":setupEndMatch("DISQUALIFY",2,$("#"+in_id).text());break;case"pbmo-forfeit-both":setupEndMatch("FORFEIT",2,$("#"+in_id).text());break;case"pbmo-confirm":sess.hideBracketPrematureEndOptions(),APP.header.players_checked_in||(hideConfirm(),APP.session.startBracketMatch()),APP.cif.data.pageNo>0&&APP.cif.exitCheckIn(!0),function(){var m=sess.matches[sess.current_match],bmpe=sess.bracket_match_premature_end;m.start_time||(m.start_time=new Date);m.end_time||(m.end_time=new Date((new Date).valueOf()+1e3));m.bracket_match_premature_end={type:bmpe.type,opponent_0:0==bmpe.opponent_index||2==bmpe.opponent_index,opponent_1:1==bmpe.opponent_index||2==bmpe.opponent_index},sess.bracket_match_premature_end=void 0,APP.session.handleMatchScore("pms-save"),APP.exitAlley()}();break;case"pbmo-cancel":sess.bracket_match_premature_end=void 0,sess.hideBracketPrematureEndOptions()}function hideConfirm(){$("#popup-bracket-match-confirm").hide(0),$("#popup-bracket-match-confirm-overlay").hide(0),APP.session.pauseBracketMatchTimer=!1}function setupEndMatch(in_type,in_opponent_index,in_message){sess.bracket_match_premature_end={type:in_type,opponent_index:in_opponent_index},APP.confirm.show({msg:in_message,ok:function(){sess.handleBracketMatchListing("pbmo-confirm")},cancel:function(){sess.handleBracketMatchListing("pbmo-cancel")}})}},updateBracketMatchTimer:!1,pauseBracketMatchTimer:!1,isBracketMatchListing:!1,updateBracketMatchListing:function(){APP.session.bracketUpdater.init()},startBracketMatch:function(ffwd){var e_id,m_id,r_id,i,j,p,m,roster,head=APP.header,sess=APP.session;e_id=sess.bracket_selected_match_parts[1],r_id=sess.bracket_selected_match_parts[2],m_id=sess.bracket_selected_match_parts[3],m=sess.getBracketMatchObject(m_id);var rrGroup,match,rrOverride=!1;try{if((match=APP.session.bracket.match_list[m_id]).rr_group)APP.session.getRoundRobinOverride(match)&&(rrOverride=!0,rrGroup=match.rr_group)}catch(e){}var deOverride=!1;try{match=APP.session.bracket.match_list[m_id],deOverride=APP.session.getDEOverrides(match,!0)}catch(e){}sess.setBracketMatch(e_id,m_id),sess.hideBracketMatchListing(),sess.startNew("TOURNAMENT");var override=r_id;rrOverride&&(override=rrGroup),deOverride&&(override=deOverride),sess.setBracketMatchFormat(e_id,override),sess.setMatchMoney(m.round_id),sess.isOptimizedBracketRoster()&&APP.cif.loadMatchPlayers(m);var homePlayers=m.home_players,awayPlayers=m.away_players,playerIdArr=[];try{for(i=0;i<homePlayers.length;i++)playerIdArr.push(homePlayers[i].dc_tournament_player_id);for(i=0;i<awayPlayers.length;i++)playerIdArr.push(awayPlayers[i].dc_tournament_player_id);for(i=0;i<APP.header.teams[0].players.length;i++){var player=APP.header.teams[0].players[i];if(player&&player.player_guid)for(j=playerIdArr.length-1;j>=0;j--){if(playerIdArr[j]==player.player_guid&&playerIdArr.splice(j,1),!playerIdArr.length)break}}}catch(e){}if(playerIdArr.length)APP.alert.show('This match requires a roster update before it can be started. Click "Check for Updates" BEFORE selecting your match again.');else{homePlayers=m.home_players,awayPlayers=m.away_players;for(head.roster_left=new head.Roster,head.roster_right=new head.Roster,(roster=head.roster_left).select_players=!0,j=0;j<homePlayers.length;j++)p=homePlayers[j],roster.addPlayer({obj_id:"P"+p.dc_tournament_player_id,player_guid:p.dc_tournament_player_id});for((roster=head.roster_right).select_players=!0,j=0;j<awayPlayers.length;j++)p=awayPlayers[j],roster.addPlayer({obj_id:"P"+p.dc_tournament_player_id,player_guid:p.dc_tournament_player_id});head.recordOpponentChange(),ffwd||APP.device.is_broadcasting||APP.handleAlleyOption("pcm-broadcast-start-button");try{APP.session.getBracketMatchGameCount()>1&&APP.session.showBullShoot()}catch(e){}}},bracketUpdater:{timer:null,ignoreUpdates:["dpflonlineleague8"],init:function(){var sess=APP.session,tId=sess.tournament_id;if(!(sess.bracketUpdater.ignoreUpdates.indexOf(tId)>-1)&&sess.isBracketMatchListing){var timerVars={name:"bracketUpdater",runTime:60,callback:function(){window.setTimeout((function(){APP.session.bracketUpdater.doPlatformCalls(),APP.session.bracketUpdater.init()}),100)},eachTick:function(){},debugMode:!1};sess.bracketUpdater.timer=new Timer(timerVars)}},doPlatformCalls:function(force){try{if(APP.cif.active&&!force)return;var sess=APP.session;if(!sess.isBracketMatchListing)return;if(sess.pauseBracketMatchTimer)return;var tournamentId=APP.session.tournament_id,boardId=APP.session.getBracketBoardId();if(!tournamentId||!boardId)return;var dataArr=[];function getBracketMatches(){url="/getBracketMatches",data={user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,dc_tournament_id:tournamentId,data_version_number:APP.data_version_number,board_id:boardId},APP.fns.doOldCall(url,data,(function(r){dataArr.push(r),APP.session.bracketUpdater.applyUpdate(dataArr)}),!1,"")}!function(){var data={user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,dc_tournament_id:tournamentId};APP.fns.doOldCall("/getBracketTournamentSetup",data,(function(r){dataArr.push(r),function(){if(APP.session.isOptimizedBracketRoster())return dataArr.push({players:[]}),void getBracketMatches();var data={member_id:APP.user.member_id,user_token:APP.user.token,device_token:APP.device.token,device_time:new Date,device_timezone:APP.device.timezone,tournament_id:tournamentId};APP.fns.doOldCall("/tournamentPlayers",data,(function(r){dataArr.push(r),getBracketMatches()}),!1,"")}()}),!1,"")}()}catch(e){console.log("bracketUpdater failed"),console.log(e)}},applyUpdate:function(r){if((sess=APP.session).isBracketMatchListing&&!sess.pauseBracketMatchTimer&&"ready"===APP.session.bracketMatchTabHelper.currentTab)try{var sess,tournamentSetup=r[0],tournamentPlayers=r[1],tournamentMatches=r[2],tournamentId=(sess=APP.session).getTournamentID(),tournament=sess.tournaments[tournamentId],bracket=sess.bracket;if(tournamentSetup&&(tournamentSetup.audience&&(tournament.audience=tournamentSetup.audience),tournament.events=tournamentSetup.events,tournament.user_options=tournamentSetup.user_options,tournamentSetup.opponent_connection_method&&(tournament.opponent_connection_method=tournamentSetup.opponent_connection_method),void 0!==tournament.bracket_interface&&("DartConnect"!=tournament.bracket_interface&&"Sportradar"!=tournament.bracket_interface||(tournament.user_options.floating_set_score=!0)),BBAT.storeData({tournaments:sess.tournaments})),tournamentPlayers){var players=tournamentPlayers.players;APP.header.loadTournamentDirectory(players)}tournamentMatches&&(bracket.match_list=tournamentMatches.matches,bracket.match_order=tournamentMatches.match_order,BBAT.storeData({bracket:bracket}),APP.device.showSpinnerOverlay(),sess.buildTabbedBracketMatchListing(),window.setTimeout((function(){APP.device.hideSpinnerOverlay()}),200))}catch(e){console.log("applyUpdate failed"),console.log(e)}}},showBracketPrematureEndOptions:function(in_match_id){var m,name,i,names,j,len;for(m=APP.session.getBracketMatchObject(in_match_id),i=0;i<2;i++){if(m){var oppo=m.away_players;if(i%2==0&&(oppo=m.home_players),1==(len=oppo.length))name=oppo[0].name_first+" "+oppo[0].name_last;else{for(names=[],j=0;j<len;j++)names.push(oppo[j].name_last);name=names.join(", ")}}else name=APP.game.opponent[i].chalkboard_name;$("#pbmo-disqualify-"+i).html("DQ "+name),$("#pbmo-forfeit-"+i).html("Forfeit "+name)}$("#popup-bracket-match-options-overlay").show(0),$("#popup-bracket-match-options").show(0)},hideBracketPrematureEndOptions:function(){$("#popup-bracket-match-options").hide(0),$("#popup-bracket-match-options-overlay").hide(0)},showCreateEventMatch:function(){APP.session.hideBracketMatchListing(),-1==APP.session.getBracketBoardId()?$(".ds-board").html("Your Matches"):$(".ds-board").html("Board "+APP.session.getBracketBoardId()),$(".pcem-hint").text("Players should create a manual match for an event, only if tournament staff have instructed players to do so. If there is any doubt, please check for assigned matches again."),$("#pcem-refresh").show(),$(".pcem-label").text("Event List"),APP.session.createBracketEventListing(),APP.popup.show("popup-create-event-match")},hideCreateEventMatch:function(in_id){switch(in_id){case"pcem-close":case"pcem-cancel":APP.session.showBracketMatchListing();break;case"refresh":APP.session.showBracketMatchListing(),APP.session.handleBracketMatchListing("pbml-refresh")}$("#popup-create-event-match").hide(0)},createBracketEventListing:function(){var key,e,b_id,sess=APP.session,content=$("#pcem-event-list"),ids=[],html=[],el=sess.tournaments[sess.tournament_id].events,sortedEvents=[];for(key in el)"C"!==(e=el[key]).bracket_status&&sortedEvents.push(e);[].sort&&(sortedEvents=sortedEvents.sort((function(a,b){return a.display_order-b.display_order})));for(var i=0;i<sortedEvents.length;i++)b_id="pbel-"+(e=sortedEvents[i]).bracket_event_id,html.push('<div id="'+b_id+'" class="button button-menu button-green round-corners">'+e.event_label+"</div>"),ids.push(b_id);var cancelBtn='<div id="pcem-cancel" class="button button-menu button-gold round-corners">Cancel</div>';html.length?content.html(html.join("")+cancelBtn):content.html('<p style="padding-top:1em">No Events Found</p>'+cancelBtn);try{"adafinals22e"==sess.tournament_id&&($(".pcem-manual-label").hide(),$(".pcem-hint").hide(),$(".pcem-refresh").hide())}catch(e){}ids.push("pcem-cancel"),APP.device.addButtonHandler(ids,APP.session.handleBracketEventListing),APP.device.setButtonEvents("#pcem-event-list .button")},showBracketRoundRobinEventListing:function(event_id){var sess=APP.session,el={};el[event_id]=sess.tournaments[sess.tournament_id].events[event_id];var key,e,b_id,content=$("#pcem-event-list"),ids=[],html=[];for(key in el)"ROUND ROBIN"===(e=el[key]).event_type&&(b_id="pbrr-"+e.bracket_event_id,html.push('<div id="'+b_id+'" class="button button-menu button-green round-corners">Standard Match</div>'),ids.push(b_id),b_id="pbrr-"+e.bracket_event_id+"-tiebreaker",html.push('<div id="'+b_id+'" class="button button-menu button-green round-corners">Tie Breaker</div>'),ids.push(b_id));$(".pcem-hint").text("When using this option, players MUST report the match result to event staff"),$("#pcem-refresh").hide(),$(".pcem-label").text("Select Match Type"),html.push('<div id="rr-cancel" class="button button-menu button-gold round-corners">Cancel</div>'),ids.push("rr-cancel"),content.html(html.join("")),APP.device.addButtonHandler(ids,APP.session.handleBracketRoundRobinEventListing),APP.device.setButtonEvents("#pcem-event-list .button")},handleBracketRoundRobinEventListing:function(in_id){var sess=APP.session;switch(in_id){case"rr-cancel":return void APP.session.showCreateEventMatch();default:var tiebreaker=!1;if("tiebreaker"===(event_id=APP.extractLastSegment(in_id,"-"))){tiebreaker=!0;var event_id=in_id.split("-")[1]}sess.setBracketMatch(event_id,null);try{if("ROUND ROBIN"===sess.bracket.events[event_id].match_settings.event_type)APP.user_options.tournament_mode="ELIMINATION"}catch(e){}return sess.hideBracketMatchListing(),sess.startNew("TOURNAMENT"),sess.setBracketMatchFormat(event_id),tiebreaker&&sess.setTiebreaker(!0),void APP.session.hideCreateEventMatch()}APP.session.hideCreateEventMatch(),sess.getBracketBoardId()||($("#popup-bracket-board-selector").show(0),$("#popup-bracket-board-selector-overlay").show(0))},handleBracketEventListing:function(in_id){switch(in_id){case"pcem-close":break;case"pcem-cancel":APP.session.hideCreateEventMatch("pcem-cancel");break;case"pcem-refresh":APP.session.hideCreateEventMatch("refresh");break;default:var event_id=APP.extractLastSegment(in_id,"-");if(APP.session.isEventRoundRobin(event_id))return void APP.session.showBracketRoundRobinEventListing(event_id);var e_id=APP.extractLastSegment(in_id,"-");APP.session.setBracketMatch(e_id,null),APP.session.hideBracketMatchListing(),APP.session.startNew("TOURNAMENT"),APP.session.setBracketMatchFormat(e_id)}APP.session.hideCreateEventMatch()},isEventRoundRobin:function(event_id){var sess=APP.session,isRR=!1;try{"ROUND ROBIN"===sess.tournaments[sess.tournament_id].events[event_id].event_type&&(isRR=!0)}catch(e){return!1}return isRR},checkRoundRobinStatus:function(){APP.session.isBracketRoundRobinEnabled()||($(".round-robin-enabled").hide(),"number"!=typeof APP.session.getBracketBoardId()&&"rr"===APP.session.getBracketBoardId().toLowerCase()&&(APP.session.resetBracketBoard(),APP.reload()))},getRoundRobinLegs:function(){try{if(APP.session.isBracketMatch()){var mf=APP.session.getMatchFormat();if(!mf)return;if(null===mf.legs)return;null===mf.legs.limit&&APP.header.showSetSetup({callback:function(){$("#bs-set-format").html(APP.session.getMatchFormatSummary(!0))}})}}catch(e){}},getRoundRobinOverride:function(match){try{var event=APP.session.getFromTournament("events")[match.bracket_event_id];if(event&&"roundrobin"==event.bracket_type&&event.round_overides&&match.rr_group&&event.round_overides[match.rr_group]&&event.round_overides[match.rr_group].legs)return event.round_overides[match.rr_group].legs}catch(e){}return!1},getDEOverrides:function(match,return_round_val){try{var isDEMatch=!1;if("L"==match.round_id[0]&&(isDEMatch=!0),"L-"==match.bracket_match_id.substr(0,2)&&(isDEMatch=!0),isDEMatch){var event=APP.session.getFromTournament("events")[match.bracket_event_id];if(event.round_overides.L1)return return_round_val?"L1":event.round_overides.L1}}catch(e){}return!1},setBracketMatchTypeOverride:function(val){if("boolean"==typeof val)try{var event=APP.session.tournaments[APP.session.getTournamentID()];event&&(event.show_all_matches_override=val,BBAT.storeData({tournaments:APP.session.tournaments}))}catch(e){}},getBracketMatchTypeOverride:function(){try{var event=APP.session.tournaments[APP.session.getTournamentID()];if(event&&event.show_all_matches_override)return event.show_all_matches_override}catch(e){return!1}return!1},switchBracketMatchListingType:function(){APP.session.getBracketMatchTypeOverride()?APP.session.setBracketMatchTypeOverride(!1):APP.session.setBracketMatchTypeOverride(!0),APP.session.handleBracketMatchListing("pbml-refresh")},isUserMatchesOnly:function(){return!1},showUserMatches:function(){var boardId=-1;try{var storedBoard=parseFloat(BBAT.fetchData("reload_bracket_board"));storedBoard&&(-1!=storedBoard&&($("#pbbs-board-id").val(storedBoard),APP.session.setBracketMatchTypeOverride(!0),boardId=storedBoard),APP.session.bracket.board_id=boardId,BBAT.flushData("reload_bracket_board"),BBAT.flushData("reload_bracket"))}catch(e){}APP.session.setBracketBoard(boardId,APP.reload)},autoConnectMatchObj:null,autoConnectRole:null,autoConnectShowingOptions:!1,startHostAutoConnect:function(){var sess=APP.session,matchParts=sess.bracket_selected_match_parts[3],matchObj=sess.getBracketMatchObject(matchParts);sess.autoConnectMatchObj=matchObj;var data={role:"HOST",step:"CHECKIN",member_id:APP.user.member_id,tournament_id:sess.tournament_id,event_id:matchObj.bracket_event_id,bracket_match_id:matchObj.bracket_match_id,device_token:APP.device.token};APP.session.autoConnectCall("/onlineMatchInit",data,(function(r){if("FAILED"==r.status){console.log(r);var error="Host Connect Failed";if(r.status_text&&(error=r.status_text),"Host Alley Not Open"===error)return void APP.handleAlleyOption("pcm-broadcast-start-button",(function(r){if(APP.server.participant_device_key)APP.alert.show("A network error occurred connecting to your match. We have attempted to fix this, please try again."),APP.popup.hide("popup-bracket-online-auto-connect"),APP.popup.hide("popup-bracket-online-auto-connect-overlay");else{APP.session.autoConnectError("A server error occurred connecting to your match. We have attempted to fix this, please try again.",!0),window.setTimeout((function(){$("#pboac-error-exit").text("Reload Tournament")}),100)}}));var exitOnly=!1;"Error connecting: Your opponent selected the same player as you."==error&&(error="It appears that both participants have selected the same player. Please reset the match and select your name.",exitOnly=!0),sess.autoConnectError(error,exitOnly)}else"ALL_PLAYERS_READY"===r.payload.handshake_status&&(APP.session.showAutoConnectWaiting({role:"HOST",step:"READY"}),window.setTimeout((function(){APP.session.autoConnectGetAlleyCode()}),2e3))}),(function(r){console.log(r);APP.session.autoConnectError("An error occurred finding your opponent")})),APP.session.showAutoConnectWaiting({role:"HOST",step:"WAITING"}),APP.reveal.setBackButton()},startGuestAutoConnect:function(){var sess=APP.session,matchParts=sess.bracket_selected_match_parts[3],matchObj=sess.getBracketMatchObject(matchParts);sess.autoConnectMatchObj=matchObj,("SERVER"==APP.game_master||APP.device.is_broadcasting)&&APP.handleAlleyOption("pcm-broadcast-end-button");var data={role:"GUEST",step:"CHECKIN",member_id:APP.user.member_id,tournament_id:sess.tournament_id,event_id:matchObj.bracket_event_id,bracket_match_id:matchObj.bracket_match_id};APP.session.autoConnectCall("/onlineMatchInit",data,(function(r){if("FAILED"==r.status){console.log(r);var error="Guest Connect Failed";r.status_text&&(error=r.status_text);var exitOnly=!1;"Error connecting: Your opponent selected the same player as you."==error&&(error="It appears that both participants have selected the same player. Please reset the match and select your name.",exitOnly=!0),sess.autoConnectError(error,exitOnly)}else APP.session.doAutoConnectGuest(r)}),(function(r){console.log(r);APP.session.autoConnectError("An error occurred finding your opponent")})),APP.session.showAutoConnectWaiting({role:"GUEST",step:"WAITING"}),APP.reveal.setBackButton()},showAutoConnectWaiting:function(in_params){if(!APP.session.autoConnectShowingOptions){APP.message_bar.pause_promo=!0;APP.session.autoConnectMatchObj;var homePlayerLabel="",awayPlayerLabel="";if(APP.session.autoConnectMatchObj&&APP.session.autoConnectMatchObj.opponents?(homePlayerLabel=APP.session.autoConnectMatchObj.opponents[0].button_label_html,awayPlayerLabel=APP.session.autoConnectMatchObj.opponents[1].button_label_html):(homePlayerLabel=APP.session.autoConnectMatchObj.home_button_label,awayPlayerLabel=APP.session.autoConnectMatchObj.away_button_label),in_params&&in_params.role&&in_params.step){var content="Waiting&hellip;";if("HOST"==in_params.role)switch(in_params.step){case"WAITING":content="Waiting for your opponent to connect";break;case"READY":content="<span class='text-bold'>"+awayPlayerLabel+"</span><br />Has Connected, Please Wait."}if("GUEST"==in_params.role)switch(in_params.step){case"WAITING":content="Waiting for your opponent to connect";break;case"READY":content="<span class='text-bold'>"+homePlayerLabel+"</span><br />Has Connected, Please Wait."}$(".pbaoc-content").html(content)}APP.device.addButtonHandler(["pboac-close","pboac-show-options"],APP.session.autoConnectHandleButtonOption),APP.session.pauseBracketMatchTimer=!0,APP.popup.show("popup-bracket-online-auto-connect"),$("#popup-bracket-online-auto-connect-overlay").show(0)}},hideAutoConnectWaiting:function(){APP.message_bar.pause_promo=!1,APP.popup.hide("popup-bracket-online-auto-connect"),$("#popup-bracket-online-auto-connect-overlay").hide(0)},autoConnectCall:function(url,data,success,error){if(!url)return console.log("No URL sent"),!1;data||(data={}),success||(success=function(){}),error||(error=function(in_a,in_b,in_c){return in_params.callback("FAILED"),!1}),APP.server.squeue.enQueue({type:"ALLEY",caller:"autoConnectCall",url:url,spinner:"70%",show_network_message:!0,data:data,on_success:success,on_error:error})},doAutoConnect:function(in_call){var sess=APP.session;"HOST"===in_call.yourRole?sess.autoConnectGetAlleyCode():sess.doAutoConnectGuest()},doAutoConnectHost:function(r){var sess=APP.session;if(APP.server.participant_device_key){APP.handleAlleyOption("pcm-compete-host-button");var matchObj=sess.autoConnectMatchObj,data={role:"HOST",step:"START_MATCH",member_id:APP.user.member_id,tournament_id:sess.tournament_id,event_id:matchObj.bracket_event_id,bracket_match_id:matchObj.bracket_match_id,participant_code:APP.server.participant_device_key,device_token:APP.device.token};error=function(r){console.log(r);APP.session.autoConnectError("An error occurred finding your opponent")};APP.session.autoConnectCall("/onlineMatchInit",data,(function(r){"failed"!=r.status?"MATCH_STARTED"===r.payload.handshake_status&&(APP.session.hideAutoConnectWaiting(),APP.session.handleBracketPlayerSelect("start-match"),APP.message.userMessage.changeBtn(!0)):APP.session.autoConnectError(r.status_text)}),error),APP.session.showAutoConnectWaiting()}else{var error="Error getting Alley Code";sess.autoConnectError(error)}},doAutoConnectGuest:function(r){if(r.payload)switch(r.payload.handshake_status){case"MATCH_STARTED":r.payload.participant_code&&APP.session.autoConnectSetAlleyCode(r.payload)}APP.session.showAutoConnectWaiting({role:"GUEST",step:"WAITING"})},autoConnectGetAlleyCode:function(){var in_open_call_id,in_success,fail_msg,requesting_broadcast;APP.server.participant_device_key?APP.session.doAutoConnectHost():APP.device.is_broadcasting?(APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.game_master="SERVER",APP.storeState(),APP.setConnectMenuControls(),APP.server.startTimer("SEND")):(in_success=function(){APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.session.doAutoConnectHost()},requesting_broadcast=(in_open_call_id="pcm-compete-host-button").indexOf("broadcast")>=0,fail_msg="Unable to connect to the DartConnect Server. Your match will not be broadcast on DCTV. Check your WiFi and use the Connect Menu to try again later.",APP.server.openAlley({requesting_broadcast:requesting_broadcast,callback:function(in_status,in_text){if("OK"==in_status)APP.game_master=in_open_call_id.indexOf("broadcast")>=0?"DEVICE":"SERVER",APP.device.role="HOST",APP.server.startTimer("SEND"),in_success();else if(APP.revertToLocalPlay(),APP.reveal.setChalkButton(),in_text)if(in_text.indexOf("already open")>=0)APP.confirm.show({title:"Connection Notice!",msg:"You have connections open on<br />another device/session.<br />Do you want to force them closed?",ok_text:"Yes, Close Them",cancel_text:"No, Leave Them Open",ok:function(){APP.server.closeAlley({force_close:!0,success:function(){APP.handleAlleyOption(in_open_call_id)}})}});else if(in_text.indexOf("No alleys available")>=0){var error="Due to high demand, on-line match play and DCTV broadcasting are unavailable. Please try again shortly. This does NOT affect in-person or computer play.";APP.session.autoConnectError(error)}else error='An unexpected error has occurred<br /> Please try again later or email <a href="mailto:customerservice@dartconnect.com">customerservice@dartconnect.com</a>',APP.session.autoConnectError(error);else APP.isOffline()||APP.session.autoConnectError(fail_msg)}}))},autoConnectSetAlleyCode:function(r){var sess=APP.session;if(r.participant_code){APP.session.handleBracketMatchListing("pbmc-play");var m_id=sess.bracket_selected_match_parts[3],match_info=sess.getBracketMatchObject(m_id);APP.session.setBracketMatch(match_info.bracket_event_id,match_info.bracket_match_id),APP.showGuestConnect(),APP.guestConnectDisplay("pgc-join"),$("#pgc-participant-input").val(r.participant_code),APP.handleGuestConnect("pgc-continue"),$("#popup-bracket-player-select-overlay").hide(0),$("#popup-bracket-player-select").hide(0)}else{sess.autoConnectError("Issue getting Alley Code")}},autoConnectError:function(e,exitOnly){APP.session.autoConnectShowHelper(!0),$(".pbaoch-content span").html(e),APP.session.pauseBracketMatchTimer=!1,exitOnly&&($("#pboac-manual").hide(),$("#pboac-error-exit").text("Reset Match"),APP.session.pauseBracketMatchTimer=!0),APP.session.hideAutoConnectWaiting()},autoConnectHandleButtonOption:function(in_id){switch(in_id){case"pboac-close":case"pboac-show-options":APP.session.autoConnectShowHelper(),APP.session.hideAutoConnectWaiting();break;case"pboac-manual":APP.session.autoConnectShowManual();break;case"pboac-exit":APP.device.showSpinnerOverlay(),APP.session.cancelAutoConnect((function(){APP.session.resetBracketMatch(),APP.session.setMatchFormat(null),APP.message_bar.resetPromo(),BBAT.flushData("players_checked_in"),APP.newGame("DELETE")}));break;case"pboac-error-exit":BBAT.storeData({reload_bracket:APP.session.tournament_id}),BBAT.storeData({reload_bracket_board:APP.session.bracket.board_id}),BBAT.flushData("players_checked_in"),APP.session.exitOnlineBracketMatch("exit-from-tournament");break;case"pboac-cancel":APP.session.showAutoConnectWaiting(),APP.session.autoConnectHideHelper()}},autoConnectShowManual:function(){APP.session.hideAutoConnectWaiting(),APP.session.autoConnectHideHelper(),APP.session.handleBracketPlayerSelect("start-match"),"HOST"==APP.session.autoConnectRole&&(APP.handleMatchOption("bb-e-alley"),APP.handleAlleyOption("pcm-compete-host-button"),$("#pcm-compete-host-button").hide(),$(".pcm-broadcast-wrap").hide()),"GUEST"==APP.session.autoConnectRole&&(APP.showGuestConnect(),APP.guestConnectDisplay("pgc-join"),$(".pgc-blurb").hide(),APP.handleAlleyOption("pcm-broadcast-end-button")),APP.reveal.setBackButton()},autoConnectShowHelper:function(is_error){APP.popup.show("popup-bracket-online-auto-connect-helper"),$("#popup-bracket-online-auto-connect-helper-overlay").show(0),APP.session.autoConnectShowingOptions=!0,is_error?($("#pboac-error-exit").show(),$("#pboac-exit").hide()):($("#pboac-error-exit").hide(),$("#pboac-exit").show()),APP.device.addButtonHandler(["pboac-manual","pboac-exit","pboac-error-exit","pboac-cancel"],APP.session.autoConnectHandleButtonOption)},autoConnectHideHelper:function(){APP.session.autoConnectShowingOptions=!1,APP.popup.hide("popup-bracket-online-auto-connect-helper"),$("#popup-bracket-online-auto-connect-helper-overlay").hide(0)},cancelAutoConnect:function(callback){var sess=APP.session,matchParts=sess.bracket_selected_match_parts[3],matchObj=sess.getBracketMatchObject(matchParts);sess.autoConnectMatchObj=matchObj;var data={role:"HOST",step:"CANCEL",member_id:APP.user.member_id,tournament_id:sess.tournament_id,event_id:matchObj.bracket_event_id,bracket_match_id:matchObj.bracket_match_id,device_token:APP.device.token};APP.session.autoConnectCall("/onlineMatchInit",data,(function(r){console.log("Success Cancelling Auto Connect"),console.log(r),APP.device.hideSpinnerOverlay(),callback()}),(function(r){console.log("Error Cancelling Auto Connect"),console.log(r),APP.device.hideSpinnerOverlay(),callback()}))},startAutoExit:function(){if("PARTICIPANT"==APP.device.role||APP.device.is_hosting){APP.session;$("#pss-cancel-control").click((function(){APP.session.stopAutoExit()})),$("#pss-auto-exit").show();var timeout=30,returnMinutes=!1;APP.lobby.isLobbyMatch()&&(timeout=600,returnMinutes=!0,$("#pss-cancel-control").hide()),(APP.device.is_hosting||"PARTICIPANT"==APP.device.role)&&(timeout=600,returnMinutes=!0,$("#pss-cancel-control").hide()),"test"!=APP.location&&"dev"!=APP.location||(timeout=30);new Timer({name:"autoExit",runTime:timeout,callback:function(){APP.lobby.isLobbyMatch()?APP.session.exitLobbyMatch("pss-exit"):APP.session.handleSummaryOption("countdown-exit")},eachTick:function(){540==this.timer&&APP.alert.show("This match will exit in 60 seconds. This will also end any current VideoConnect call."),$("#pss-auto-exit-message").html("Match will exit in "+this.getCountDown())},returnMinutes:returnMinutes});$("#pss-auto-exit-message").html("&nbsp;")}},countdownAutoExit:function(){var sess=APP.session,as=sess.auto_exit;as?as.seconds>0?($("#pss-auto-exit-message").html("Match will exit in "+as.seconds),as.seconds--):(sess.stopAutoExit(),APP.session.handleSummaryOption("pss-exit")):sess.stopAutoExit()},stopAutoExit:function(){var sess=APP.session;sess.auto_exit&&(clearInterval(sess.auto_exit.timer),sess.auto_exit=null),$("#pss-auto-exit").hide()},autoExitLocalMatch:function(isTournament){var exitCallback=function(manual){manual||APP.session.handleSummaryOption("pss-exit")};isTournament&&(exitCallback=function(manual){manual||($("#pss-score").length?($("#pss-score").hasClass("button-disabled"),APP.session.handleSummaryOption("pss-exit")):APP.session.handleSummaryOption("pss-score"))});var counter=60;"test"!=APP.location&&"dev"!=APP.location||(counter=10);new Timer({name:"newMatchTimer",forceClose:!0,runTime:counter,callback:exitCallback,eachTick:function(){},debugMode:!1})},isChangingPlayerMidSet:!1,leagueAllowsChangePlayerMidSet:function(){if(!APP.session.isLeaguePlay())return!1;if("PARTICIPANT"==APP.device.role)return!1;if(APP.nlf.data.rails)return!1;try{var ld=APP.session.getMatchLeagueKey(),als=APP.getAssociatedLeagueSeason(ld.league_division_guid);if("SINGLES"==als.league_type)return!1;var tms=APP.game.opponent,tm1=tms[0].team.players.length,tm2=tms[1].team.players.length;return!(tm1>1||tm2>1)&&(!!als.mid_set_player_change_enabled&&"N"!=als.mid_set_player_change_enabled)}catch(e){}return!1},changePlayerEndLeg:function(){try{if(APP.nlf.rails.forcePlayerSelect())return BBAT.storeData({change_player_set:!0}),void APP.newGame();BBAT.storeData({change_player_set:!0});var startingOppo=1;APP.game.opponent_order[0]&&(startingOppo=0),BBAT.storeData({change_player_set_starting_player:startingOppo}),APP.newGame()}catch(e){BBAT.flushData("change_player_set"),BBAT.flushData("change_player_set_starting_player"),APP.recordError("changePlayerMidSet failed")}},changePlayerMidSet:function(){try{BBAT.storeData({change_player_set:!0});var startingOppo=0;1==APP.game.opponent_order[0]&&(startingOppo=1),BBAT.storeData({change_player_set_starting_player:startingOppo}),APP.newGame("DELETE")}catch(e){BBAT.flushData("change_player_set"),BBAT.flushData("change_player_set_starting_player"),APP.recordError("changePlayerMidSet failed")}},checkPlayerMidSetChange:function(){try{if(BBAT.fetchData("change_player_set")){APP.handleMatchOption("bb-e-new-players"),APP.session.isChangingPlayerMidSet=!0,APP.header.roster_left.getPlayerCount()&&APP.header.handleOpponentChange("oph-bb-reset-left"),APP.header.roster_right.getPlayerCount()&&APP.header.handleOpponentChange("oph-bb-reset-right");var startingPlayer=BBAT.fetchData("change_player_set_starting_player");null!==startingPlayer&&APP.game.setBullShootWinner(startingPlayer,!1),BBAT.flushData("change_player_set"),BBAT.flushData("change_player_set_starting_player")}}catch(e){BBAT.flushData("change_player_set"),BBAT.flushData("change_player_set_starting_player"),APP.recordError("checkPlayerMidSetChange failed")}},changePlayerDivDisplayed:!1,showChangePlayerDiv:function(){APP.session.leagueAllowsChangePlayerMidSet()&&"IN-GAME"===APP.mode&&0!=APP.session.getCurrentSetLegsPlayed()&&(APP.session.changePlayerDivDisplayed=!0,$("#sb-cp-box").show(),APP.device.addButtonHandler(["sb-cp-btn-continue","sb-cp-btn-change"],APP.session.handleChangePlayerBtn))},hideChangePlayerDiv:function(fade){fade?$("#sb-cp-box").fadeOut():$("#sb-cp-box").hide(),APP.session.changePlayerDivDisplayed=!1},handleChangePlayerBtn:function(in_id){switch(in_id){case"sb-cp-btn-continue":APP.session.hideChangePlayerDiv();break;case"sb-cp-btn-change":APP.session.changePlayerMidSet()}}},APP.quickplay={data:{showLegsMenu:!1},showLegsMenu:function(){APP.header.has_seen_legs_menu||(APP.header.showSetSetup({game_start:!0}),APP.quickplay.data.showLegsMenu=!1)},matchModes:[],customMatchMode:function(){APP.device.handleRoleSelection("drm-play"),APP.header.handleOpponentChange("bb-o-match-format"),APP.info.hide(),APP.popup.hide("popup-quick-play-mode"),APP.quickplay.data.showLegsMenu=!0},play:function(in_match,in_game,dcbot_level){var matchMode;dcbot_level&&(dcbot_level="dsm-level-"+(dcbot_level-1)),matchMode="object"==typeof in_match?in_match:this.matchModes[in_match],this.startRoutine(matchMode,in_game,dcbot_level)},startRoutine:function(in_routine,game_number,opponent,solo){if(APP.header.startOpponentChange("",!0),APP.device.handleRoleSelection("drm-play"),solo&&APP.session.startNew("SOLO"),APP.session.setMatchFormat(in_routine[0]),APP.info.hide(),game_number)if(-1===game_number){var gameMenu=APP.session.getGameSelector();if("Other"!==gameMenu[gameMenu.length-1].type)game_number=1;else{var gameBtnId="lgs-custom-game-"+(gameMenu.length-1);APP.session.handleGameSelector(gameBtnId)}}else{("test"===APP.location||"dev"===APP.location)&&APP.inject101?APP.session.handleGameSelector("lgs-game-"+(game_number+1)):APP.session.handleGameSelector("lgs-game-"+game_number)}opponent&&(APP.header.startOpponentChange(),APP.header.handleOpponentChange("op-right-Pdartbot",!0),APP.header.handleDartBotSettings(opponent),APP.header.handleDartBotSettings("dsm-continue")),in_routine[1]&&in_routine[1](),APP.popup.hide("popup-quick-play-mode"),APP.reveal.showButtonBar("button-bar-opponents","","",!0)},startLobbyRoutine:function(race,game_number,randomStart){APP.device.handleRoleSelection("drm-play"),APP.info.hide();var generic_game={sets:{limit:"1",mode:"BEST-OF"},legs:{mode:"BEST-OF",limit:race,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!!randomStart,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1};APP.session.setMatchFormat(generic_game),race&&-1!=race||(race=1),APP.header.handleSetSetup("pssm-set-"+race),APP.header.players_checked_in=!0,void 0!==game_number&&-1!=game_number||(game_number=1),"test"!=APP.location&&"dev"!=APP.location||APP.inject101&&game_number++,APP.session.handleGameSelector("lgs-game-"+game_number),APP.popup.hide("popup-lobby")},startTestFormat:function(match_format){APP.device.handleRoleSelection("drm-play"),APP.session.setMatchFormat(match_format),APP.info.hide()},startChallengeLobbyRoutine:function(match_format){APP.device.handleRoleSelection("drm-play"),APP.session.setMatchFormat(match_format),APP.info.hide()},init:function(){APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:9,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"CORK",next_game_options:null,same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"SELECT",next_game_options:null,same_game:"PER-LEG",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:5,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:11,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:5,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}]),APP.quickplay.matchModes.push([{sets:null,legs:{mode:"BEST-OF",limit:11,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!0,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){}])},createMatchMode:function(config,callback){return config||(config={}),config.legs||(config.legs={}),config.sets&&(config.sets.mode||(config.sets.mode="BEST-OF"),config.sets.limit||(config.sets.limit=1)),[{sets:config.sets||null,legs:{mode:config.legs.mode||"BEST-OF",limit:config.legs.limit||3,locked:config.legs.locked||!1},next_game:config.next_game||"ALTERNATE",next_game_options:config.next_game_options||{random_start:!1,cork_first:!0,cork_last:!1},same_game:config.same_game||"PER-MATCH",same_legs:void 0===config.same_legs||config.same_legs,points_style:config.points_style||null,points:config.points||1},callback||function(){}]},addTacticsToGameMenu:function(){"Tactics NL"!=APP.game.getGameName(!0)&&(APP.game_selector.selectGame("gs-cricket"),APP.game.setOptions(APP.plugin_cricket.default_options),APP.game.setOptions({variation:"TACTICS NL",dutch_tactics:!0}),APP.plugin_cricket.storeSettings(),APP.popup.hide(),BBAT.storeData({other_game:{type:"Cricket",label:APP.game.getGameName(!0),drop_10:APP.game.getOption("drop_10"),dutch_tactics:APP.game.getOption("dutch_tactics"),no_bull:APP.game.getOption("no_bull"),no_points:APP.game.getOption("no_points"),targets:APP.game.getOption("targets"),variation:APP.game.getOption("variation"),call:APP.game.getOption("call"),ascending_score:!0,custom:!0}}),APP.game_selector.selectGame(null),APP.session.showGameSelector())},addGameToGameMenu:function(gameName){var game;switch(gameName){case"701 SIDO":game={type:"01",label:"701 SIDO",starting_score:701,all_player_double_in:!1,double_in:!1,double_out:!0,ascending_score:!1,custom:!0};break;case"305 SIDO":case"505 SIDO":case"705 SIDO":case"705 DIDO":case"705 DIDO":case"705 DIDO":var isDoubleIn=gameName.indexOf("DI")>-1;game={type:"01",label:gameName,starting_score:parseInt(gameName.split(" ")[0]),all_player_double_in:!1,double_in:isDoubleIn,double_out:!0,ascending_score:!1,custom:!0}}game?APP.game.getGameName(!0)!=game.label&&(BBAT.storeData({other_game:game}),APP.game_selector.selectGame(null),APP.session.showGameSelector()):console.log("Game not found")},playSolo501:function(){APP.fns.newLoader.show();var routine=[{sets:null,legs:{mode:"BEST-OF",limit:null,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!1,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){window.setTimeout((function(){APP.header.finishOpponentChange(),APP.session.handleBullShoot("bs-opponent-0"),APP.session.handleGameSelector("lgs-game-0"),window.setTimeout((function(){APP.fns.newLoader.hide(!0)}),100)}),100)}];APP.quickplay.startRoutine(routine,0,!1,!0)},playerMasterOut:function(doubleIn){APP.fns.newLoader.show();var gameMenu={type:"01",label:`501 ${doubleIn?"DI":"SI"}MO`,starting_score:501,all_player_double_in:!1,double_in:doubleIn,double_out:!1,master_out:!0,ascending_score:!1,custom:!0};APP.quickplay.injectGameMenu([gameMenu]);var routine=[{sets:null,legs:{mode:"BEST-OF",limit:3,locked:!1},next_game:"ALTERNATE",next_game_options:{random_start:!1,cork_first:!1,cork_last:!1},same_game:"PER-MATCH",same_legs:!0,points_style:null,points:1},function(){window.setTimeout((function(){APP.header.finishOpponentChange(),APP.session.handleBullShoot("bs-opponent-0"),APP.session.handleGameSelector("lgs-game-0"),window.setTimeout((function(){APP.fns.newLoader.hide(!0)}),100)}),100)}];APP.quickplay.startRoutine(routine,0,!1)},injectGameMenu:function(menu){menu||(menu=[{type:"01",label:"1001 DIDO",starting_score:1001,double_in:!0,double_out:!0}]),APP.quickplay.customGameMenu=menu,BBAT.storeData({other_game:menu[0]})},customGameMenu:[]},APP.quickplay.init(),APP.practicePopup={isShowing:!1,legCount:null,throwCount:null,timer:null,idleCount:0,checkAppPosition:function(){var sess=APP.session;return!sess.isBracketMatch()||(sess.isBracketPracticeMatch()?void 0:!(APP.session.isMatchSummaryShowing()&&APP.session.matches&&APP.session.matches.length>0&&"PRACTICE"===APP.session.matches[0].bracket_event_id))},checkForAction:function(){if(!this.checkAppPosition()){var sess=APP.session;null!==APP.game.start_time?this.throwCount===this.calculateThrows()&&this.legCount===sess.getMatchScore().join()?this.idleCount++:(this.legCount=sess.getMatchScore().join(),this.throwCount=this.calculateThrows(),this.idleCount=0):this.idleCount=this.idleCount+.5}},calculateThrows:function(){var throws=0,db=APP.game.opponent[1];return throws+=db.turn.length,null===db.turn[db.turn.length-1].darts_thrown&&throws--,throws+=(db=APP.game.opponent[0]).turn.length,null===db.turn[db.turn.length-1].darts_thrown&&throws--,throws},start:function(){"TOURNAMENT"===APP.session.getMatchMode()?(clearTimeout(this.timer),this.timer=setTimeout((function(){APP.practicePopup.checkForAction(),APP.practicePopup.idleCount>6?APP.practicePopup.showPopup():APP.practicePopup.start()}),1e4)):APP.nlf.data.rails&&APP.nlf.data.railsPractice&&APP.practicePopup.rails.start()},stop:function(){clearTimeout(this.timer),this.timer=null,this.idleCount=0},reset:function(){clearTimeout(this.timer),this.idleCount=0,this.start()},on:function(){return null!==this.timer},showPopup:function(){APP.practicePopup.stop(),APP.practicePopup.isShowing=!0,APP.popup.show("popup-practice-timeout");var popup=$("#popup-practice-timeout").height(),title=$("#popup-practice-timeout .popup-title").height(),hint=$("#popup-practice-timeout .pdl-hint").height();$("#pdl-scroll-box").css("height",.9*(popup-title-hint)),APP.device.addButtonHandler(["ppt-close","ppt-resume"],APP.practicePopup.closePopup),APP.device.addButtonHandler(["ppt-new"],APP.practicePopup.startNew)},startNew:function(){APP.session.resetBracketMatch(),APP.session.setMatchFormat(null),APP.message_bar.resetPromo(),BBAT.flushData("players_checked_in"),APP.newGame("DELETE"),APP.session.startNew("TOURNAMENT")},closePopup:function(){APP.practicePopup.isShowing=!1,APP.popup.hide("popup-practice-timeout"),APP.message_bar.hidePromo(),APP.practicePopup.start()},rails:{start:function(){var lengthToWait=1e4;APP.is_reloading&&(lengthToWait=1e3),clearTimeout(this.parent.timer),this.parent.timer=setTimeout((function(){APP.practicePopup.rails.checkForAction()}),lengthToWait)},checkAppPosition:function(){return"IN-GAME"==APP.mode},checkForAction:function(bypass){if(this.checkAppPosition())try{var now=moment(),lastAction=localStorage.timestamp;lastAction&&(lastAction=JSON.parse(lastAction)),lastAction=moment(lastAction);var diff=now.diff(lastAction,"minutes"),timeBetweenActions=10;"test"==APP.location&&(timeBetweenActions=1),diff>timeBetweenActions?APP.practicePopup.rails.showPopup():APP.practicePopup.rails.start()}catch(e){APP.practicePopup.rails.start()}},showPopup:function(){if(!APP.practicePopup.isShowing){APP.practicePopup.stop(),APP.practicePopup.isShowing=!0,$("#popup-practice-timeout h1").html("This Practice Match appears abandoned. Would you like to end it?"),$("#rails-practice-tip").removeClass("hide"),$("#ppt-new").html("Continue Match"),$("#ppt-resume").html("End Match"),APP.popup.show("popup-practice-timeout");var popup=$("#popup-practice-timeout").height(),title=$("#popup-practice-timeout .popup-title").height(),hint=$("#popup-practice-timeout .pdl-hint").height();$("#pdl-scroll-box").css("height",.9*(popup-title-hint)),APP.device.addButtonHandler(["ppt-close","ppt-new"],APP.practicePopup.rails.closePopup),APP.device.addButtonHandler(["ppt-resume"],(function(){APP.nlf.reset(),APP.nlf.rails.clearRailsData(),APP.exitAlley()}))}},closePopup:function(){APP.practicePopup.isShowing=!1,APP.popup.hide("popup-practice-timeout"),APP.message_bar.hidePromo(),BBAT.storeData({timestamp:(new Date).toISOString()}),APP.practicePopup.rails.start()}}},APP.practicePopup.rails.parent=APP.practicePopup,APP.lobby={data:{accessLevel:"none",gameStartedGuest:!1,matchInfo:{participantKey:null},isInMatch:!1,blockFirstErrorLobby:!1,matchList:[],offerList:[],reloaded:!1,version:19,matchOfferId:null,guestDeviceToken:null,guestPlayerRosterId:null,guestTeamGuid:null,mode:0,room:{gameType:null,race:null,start:null},filters:{gameType:null,race:null,oppoAvg:null,region:null,view:null,vc:null},hasLeagues:!1,activeLeague:null,matchCounts:null,oppoLeftMsg:!1,notificationSound:new Audio,lastLobbyUse:null,guestExit:!1},timers:{matchWaitTimer:null,offerWaitTimer:null,offerSoundTimer:null,oppoWaitTimer:null,kickPlayerTimer:null,killTimers:function(){var timers=APP.lobby.timers;timers.matchWaitTimer&&(timers.matchWaitTimer.stopTimer(),APP.lobby.timers.matchWaitTimer=null),timers.offerWaitTimer&&(timers.offerWaitTimer.stopTimer(),APP.lobby.timers.offerWaitTimer=null),timers.offerSoundTimer&&(timers.offerSoundTimer.stopTimer(),APP.lobby.timers.offerSoundTimer=null),timers.oppoWaitTimer&&(timers.oppoWaitTimer.stopTimer(),APP.lobby.timers.oppoWaitTimer=null),timers.kickPlayerTimer&&(timers.kickPlayerTimer.stopTimer(),APP.lobby.timers.kickPlayerTimer=null)}},ele:{main:$("#popup-lobby"),content:$("#lobby-content"),exitBtn:$("#lobby-btn-close")},reset:function(matchStarting){this.log("resetting data"),matchStarting?(this.data.mode=1,this.data.isInMatch=!0,this.data.blockFirstErrorLobby=!0):this.data.mode=0,this.data.gameStartedGuest=!1,this.data.matchInfo.participantKey=null,this.data.reloaded=!1,this.data.matchOfferId=null,this.data.guestDeviceToken=null,this.data.guestPlayerRosterId=null,this.data.guestTeamGuid=null,this.data.matchCounts=null,this.save()},debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="Lobby: ";message+=msg,console.log(message)}},init:function(page){this.checkVersionGate()&&(page||(page=1),APP.lobby.displayPage(page),this.data.lastLobbyUse=new Date,this.save())},reloadCheck:function(){if(window.self!==window.top){var message={type:"userCheck",data:APP.user.member_id};message=JSON.stringify(message),window.top.postMessage(message,"*")}APP.lobby.data.accessLevel=APP.lobby.lobbyAccessLevel(),this.getLeagues().length&&(this.data.hasLeagues=!0);var savedData=BBAT.fetchData("lobby_data");if(savedData){if(this.data.mode=savedData.mode,savedData.version!=this.data.version)return void APP.lobby.updateDataStructure();if(this.data.room=savedData.room,this.data.gameStartedGuest=savedData.gameStartedGuest,this.data.matchOfferId=savedData.matchOfferId,this.data.guestDeviceToken=savedData.guestDeviceToken,this.data.guestPlayerRosterId=savedData.guestPlayerRosterId,this.data.guestTeamGuid=savedData.guestTeamGuid,this.data.filters=savedData.filters,this.data.version=savedData.version,this.data.activeLeague=savedData.activeLeague,this.data.isInMatch=savedData.isInMatch,this.data.blockFirstErrorLobby=savedData.blockFirstErrorLobby,this.data.lastLobbyUse=savedData.lastLobbyUse,this.data.guestExit=savedData.guestExit,this.data.reloaded=!0,this.log("Reloaded"),this.data.mode>0){if("PRE-ROLE"==APP.mode){if(!this.checkVersionGate())return void(this.data.isInMatch&&(this.data.isInMatch=!1,this.data.blockFirstErrorLobby=!1,this.save(),this.closeLiveMatch(),this.log("Close live match")));this.showContent(),this.log("Show reloaded content"),this.data.isInMatch&&(this.data.isInMatch=!1,this.data.blockFirstErrorLobby=!1,this.save(),this.closeLiveMatch(),this.log("Close live match"))}}else this.log("Last lobby game was finished, nothing to reload"),BBAT.fetchData("exit_lobby")&&(APP.lobby.cancelOnlineMatchOffer(!0),APP.lobby.cancelWatchOnlineMatchOffers(),APP.server.alley_id&&APP.exitAlley({new_match_mode:!0}))}this.data.guestExit&&(this.data.guestExit=!1,this.save(),APP.lobby.exitMatchGuest()),this.data.gameStartedGuest?(APP.popup.hide("popup-lobby"),this.cancelWatchOnlineMatchOffers(),this.reset(!0),APP.lobby.playSound()):(this.log("Check Freshness"),this.checkFreshness())},displayPage:function(mode){this.data.mode=mode,this.save(),$("#lobby-footer").empty(),this.showContent()},updateDataStructure:function(){var mode=this.data.mode;this.clear(),this.data.mode=mode,this.save(),APP.reload()},getLeagues:function(){var activeLeagues=[];if(!APP.user.lobby_leagues)return!1;if(!APP.user.lobby_leagues)return!1;for(var i=0;i<APP.user.lobby_leagues.length;i++){var league=APP.user.lobby_leagues[i];if("REG"===league.season_status&&("S"!=league.league_status&&"I"!=league.access_status)){var leagueGuid=league.team_guid;leagueGuid&&-1!==(leagueGuid=leagueGuid.toString()).indexOf("teamgroup~")||activeLeagues.push(league)}}return activeLeagues},activateBtn:function(ids,callback){Array.isArray(ids)||(ids=[ids]),APP.device.addButtonHandler(ids,callback);for(var i=0;i<ids.length;i++){var id="#"+ids[i];APP.device.setButtonEvents(id)}},checkFreshness:function(){if(this.data.mode){if(!this.data.lastLobbyUse)return this.data.lastLobbyUse=new Date,void this.save();var lastLobbyUse=new Date(this.data.lastLobbyUse),diff=((new Date).getTime()-lastLobbyUse.getTime())/1e3;diff/=3600,(diff=Math.abs(Math.round(diff)))>=4?(APP.lobby.mode=0,this.save(),APP.lobby.exit()):(this.data.lastLobbyUse=new Date,this.save())}},updateMatchListArr:function(matches){for(var cleanMatches=[],i=0;i<matches.length;i++){var match=matches[i];APP.user.member_id!==match.params.member_id&&cleanMatches.push(match)}cleanMatches.length&&(this.data.matchList=cleanMatches)},checkVersionGate:function(){return!!APP.versionCheck.compare("3.0.20")||(APP.alert.show('This version of DartConnect does not support access to the Global Lobby. From the <span class="bold">Welcome Screen</span>, select "Check for Updates" and install the latest version.'),this.reset(),!1)},showContent:function(){this.log("Showing content"),this.ele.main.is(":visible")||APP.popup.show("popup-lobby"),this.loadContent(),this.exitBtnOn(),this.fixScroll()},loadContent:function(){var content,page;this.log("Loading content for "+this.data.mode);var contentDiv=this.ele.content;switch(this.data.mode){case 1:page=this.pages.lobby;break;case 2:page=this.pages.offer;break;case 3:page=this.pages.accepted;break;case 4:page=this.pages.create;break;case 5:page=this.pages.waitOpponent;break;case 6:page=this.pages.opponentSelected;break;case 7:page=this.pages.filters;break;case 8:page=this.pages.leagues;break;default:this.log("Content doesn't exist"),page=this.pages.lobby}if(content=page.content,"function"==typeof page.content&&(content=page.content()),contentDiv.empty().append(content),page.init(),null!==this.data.activeLeague){var league=this.data.activeLeague;$("#popup-lobby .popup-title span").text(league.shortname+" Lobby")}this.extendKickTimer()},exitBtnOn:function(){APP.device.addButtonHandler(["lobby-btn-close"],(function(){APP.confirm.show({msg:"Are you sure you want to exit the online lobby?",ok:function(){APP.lobby.exit()}})}))},fixScroll:function(){var sbh=$("#popup-lobby").outerHeight(!0)-$("#popup-lobby .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#lobby-scroll-box").css("padding-top")));sbh-=$("#lobby-footer").outerHeight(!0),$("#lobby-scroll-box").css("max-height",sbh),$("#lobby-scroll-box").css("min-height",sbh),$("#lobby-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#lobby-scroll-box"),l=$("#lobby-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0}))},exit:function(){BBAT.storeData({exit_lobby:!0}),BBAT.flushData("keep_alley_open"),this.log("User is exiting"),this.timers.killTimers(),APP.popup.hide("popup-lobby"),this.data.activeLeague=null,this.reset(),APP.exitAlley({new_match_mode:!0})},buildMatchList:function(matches){var content="",header="";if(matches.length?(header="\n\t\t\t\tSelect Match Offer To Play Now!\n\t\t\t",$("#lobby-main #matchOfferText").html(header)):(header='\n\t\t\t\t<span style="font-weight: normal; color:#d3d3d3">There are no match offers</span><br />\n\t\t\t\t<span class="bold">Create one now!</span>\n\t\t\t',$("#lobby-main #matchOfferText").html(header)),!matches.length)return content;for(var i=0;i<matches.length;i++){var match=matches[i];content+=this.createMatchCard(match)}return content},updateMatchList:function(data){var matches=data.filtered_offers;matches.length>1?this.data.matchList=matches.filtered_offers:this.data.matchList=[],this.updateMatchListArr(data.filtered_offers);var content=this.buildMatchList(matches);$("#lobby-match-list").empty().html(content),this.matchListOn(),5==this.data.mode&&APP.lobby.checkBGMatches()},injectMatchList:function(data){var content=this.buildMatchList([data]);0===this.data.matchList.length?$("#lobby-match-list").empty().html(content):$("#lobby-match-list").append(content),this.matchListOn()},addMatchToList:function(newMatch){for(var isDupe=!1,currentMatches=this.data.matchList,i=0;i<currentMatches.length;i++){currentMatches[i].subscriptionId==newMatch.subscriptionId&&(isDupe=!0)}APP.user.member_id==newMatch.params.member_id&&(isDupe=!0),isDupe||(this.injectMatchList(newMatch),5==this.data.mode&&this.injectBGMatch(newMatch),this.data.matchList.push(newMatch))},removeMatchFromList:function(match){$("#lobby-match-list .new-button").each((function(){$(this).attr("data-id")==match.subscriptionId&&$(this).remove()}));for(var i=this.data.matchList.length-1;i>=0;i--){this.data.matchList[i].subscriptionId==match.subscriptionId&&this.data.matchList.splice(i,1)}this.data.matchList.length||(header="\n\t\t\t\tThere are no active match offers <br />\n\t\t\t\tCreate one now!\n\t\t\t",$("#lobby-main #matchOfferText").html(header)),5==this.data.mode&&this.removeBGMatch(match)},matchListOn:function(){$("#lobby-match-list .new-button").off("click touchend"),$("#lobby-match-list .new-button").on("click touchend",(function(ev){if(!1!==ev.handled){ev.stopPropagation(),ev.preventDefault(),ev.handled=!0;var id=$(this).attr("data-id");if("league"!==APP.lobby.data.accessLevel||APP.lobby.data.activeLeague)APP.lobby.showHostPlayerStats(id);else{var content=`\n\t\t\t\t\t\tYou must be a Premium User to play matches from the Global Lobby.\n\t\t\t\t\t\t<br /><br />\n\t\t\t\t\t\t<a style="color:#0000FF; text-decoration: underline" href="${APP.getDomain("MEMBERS")}/membership">Upgrade Now</a>\n\t\t\t\t\t`;APP.alert.show(content)}}}))},buildWaitMatchList:function(matches){for(var content="",i=0;i<matches.length;i++){var match=matches[i];content+=this.createOfferCard(match)}return content},updateWaitMatchList:function(matches){var content=this.buildWaitMatchList(matches);$("#wait-match-list").empty().html(content),this.waitMatchListOn(),matches.length?(APP.lobby.playSound(),$("#oppo-search-text").html("Select Your Opponent")):$("#oppo-search-text").html("Awaiting Challengers&hellip;")},waitMatchListOn:function(){$("#wait-match-list .new-button").off("click touchend"),$("#wait-match-list .new-button").on("click touchend",(function(ev){if(!1!==ev.handled){ev.stopPropagation(),ev.preventDefault(),ev.handled=!0;var id=$(this).attr("data-id"),playerRosterId=$(this).attr("data-player-roster-id"),teamGuid=$(this).attr("data-team-guid");APP.lobby.showGuestPlayerStats(id,playerRosterId,teamGuid)}}))},createMatchCard:function(match,noBg){var content="",params=match.params,gameType=params.match_description.game_type,matchGame='<span class="bold">'+gameType+"</span>";gameType.split(" ").length>1&&(matchGame='<span class="bold">'+gameType.split(" ")[0]+"</span>",matchGame+=`\n\t\t\t\t<span class="text-hint text-vm">${gameType.split(" ")[1]}</span>\n\t\t\t`);var matchRace=params.match_description.leg_count;matchRace=2*matchRace-1;var startType=params.match_description.start_type;switch(startType){case"bull":startType="<span class='bold'>Bull</span> <span class='text-hint text-vm'>start</span>";break;case"random":startType="<span class='bold'>Rnd</span> <span class='text-hint text-vm'>start</span>"}var averageArr,averageInfo="",textHighlight="text-red";if(noBg&&(textHighlight="text-gold"),this.isChallengeLeagueFormat()){var avg501=this.getGameAverage("501",match.params.host3daStats,!0),avgCric=this.getGameAverage("cricket",match.params.host3daStats,!0);avg501[0].length&&(averageInfo+=`\n\t\t\t\t\t<span class="bold ${textHighlight}">${avg501[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${avg501[1]}</span> <span>|</span>\n\t\t\t\t`),avgCric[0].length&&(averageInfo+=`\n\t\t\t\t\t<span class="bold ${textHighlight}">${avgCric[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${avgCric[1]}</span>\n\t\t\t\t`)}else averageInfo=(averageArr=this.getGameAverage(gameType,match.params.host3daStats,!0))[0].length?`\n\t\t\t\t\t<span class="bold ${textHighlight}">${averageArr[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${averageArr[1]}</span> -\n\t\t\t\t`:"";var hasVideo=!1;"Active"==params.videoConnectStatus&&(hasVideo=!0);var oppoName=params.first_name;params.last_name&&(oppoName+=" "+params.last_name[0]);var country=params.iso2_country,countryCode=params.iso3_country,countryData="",countryName=this.getCountryShortName(params.country);countryName&&(countryData=`\n\t\t\t\t- <span class="bold">${countryName}</span>\n\t\t\t`);var flag='\n\t\t\t<div class="profile-flag">\n\t\t';hasVideo&&(flag+=noBg?'\n\t\t\t\t\t<img src="images/video_icon_white.png" class="videoIcon" />\n\t\t\t\t':'\n\t\t\t\t\t<img src="images/video_icon.png" class="videoIcon" />\n\t\t\t\t'),flag+='\n\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-ZZ" />\n\t\t\t</div>\n\t\t',country&&(flag='\n\t\t\t\t<div class="profile-flag">\n\t\t\t',hasVideo&&(flag+=noBg?'\n\t\t\t\t\t\t<img src="images/video_icon_white.png" class="videoIcon" />\n\t\t\t\t\t':'\n\t\t\t\t\t\t<img src="images/video_icon.png" class="videoIcon" />\n\t\t\t\t\t'),flag+=`\n\t\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-${country}" />\n\t\t\t`,countryCode&&(flag+=`\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class="countryCode">${countryCode}</span>\n\t\t\t\t`),flag+="</div>");var leagueInfo="";if(null!==this.data.activeLeague){var teamName=match.params.publish_filters.audience_team_name,divisionName=match.params.publish_filters.audience_division_label,leagueShortName=this.data.activeLeague.shortname;leagueInfo+='<hr style="margin-bottom:0" />',leagueInfo+='<p class="league-info text-hint">',teamName&&(leagueInfo+=`\n\t\t\t\t\t${teamName} -\n\t\t\t\t`),divisionName&&(leagueInfo+=`\n\t\t\t\t\tDiv: ${divisionName} -\n\t\t\t\t`),leagueShortName&&(leagueInfo+=`\n\t\t\t\t\t${leagueShortName}\n\t\t\t\t`),leagueInfo+="</p>"}var header=`\n\t\t\t${matchGame} <span class="lobby-pipe">|</span>\n\t\t\t<span class="text-hint text-vm">Best of</span> <span class="bold">${matchRace}</span> <span class="lobby-pipe">|</span>\n\t\t\t${startType}\n\t\t`;return this.isChallengeLeagueFormat()&&(header="\n\t\t\t\t<span class='bold'>Division Match Format</span>\n\t\t\t"),countryData="",(match.params.city||match.params.state)&&(countryData="<span class='lobby-country-data'>",match.params.city?(countryData+=this.getCountryShortName(match.params.city),match.params.state&&(countryData+=", "+match.params.state)):match.params.state&&(countryData+=match.params.state),countryData+="</span>"),content+=`\n\t\t\t<div class="new-button button-menu ${noBg?"":"button-white"} round-corners text-left" data-id="${match.subscriptionId}">\n\t\t\t\t${flag}\n\t\t\t\t${header}\n\t\t\t\t<br />\n\t\t\t\t<p class="match-offer-second-line">\n\t\t\t\t\t${averageInfo}\n\t\t\t\t\t<span class="bold">${oppoName}</span> ${countryData}\n\t\t\t\t</p>\n\t\t\t\t${leagueInfo}\n\t\t\t</div>\n\t\t`},createOfferCard:function(match){var content="",oppo_device_token=(match.acceptanceId,match.device_token),oppoName=match.first_name;match.last_name&&(oppoName+=" "+match.last_name[0]);var gameType=this.data.room.gameType,hasVideo=!1;"Active"==match.videoConnectStatus&&(hasVideo=!0);var player_roster_id=!1;match.player_roster_id&&(player_roster_id=match.player_roster_id);var team_guid=!1;match.team_guid&&(team_guid=match.team_guid);var country=match.iso2_country,countryCode=match.iso3_country,countryName=this.getCountryShortName(match.country);var flag='\n\t\t\t<div class="profile-flag">\n\t\t';hasVideo&&(flag+='\n\t\t\t\t<img src="images/video_icon.png" class="videoIcon" />\n\t\t\t'),flag+='\n\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-ZZ" />\n\t\t\t</div>\n\t\t',country&&(flag='\n\t\t\t\t<div class="profile-flag">\n\t\t\t',hasVideo&&(flag+='\n\t\t\t\t\t<img src="images/video_icon.png" class="videoIcon" />\n\t\t\t\t'),flag+=`\n\t\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-${country}" />\n\t\t\t`,countryCode&&(flag+=`\n\t\t\t\t\t<br />\n\t\t\t\t\t<span class="countryCode">${countryCode}</span>\n\t\t\t\t`),flag+="</div>");var averageArr,averageInfo="";if(this.isChallengeLeagueFormat()){var avg501=this.getGameAverage("501",match.guest3daStats,!0),avgCric=this.getGameAverage("cricket",match.guest3daStats,!0);avg501[0].length&&(averageInfo+=`\n\t\t\t\t\t<span class="bold text-red">${avg501[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${avg501[1]}</span> -\n\t\t\t\t`),avgCric[0].length&&(averageInfo+=`\n\t\t\t\t\t<span class="bold text-red">${avgCric[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${avgCric[1]}</span>\n\t\t\t\t`)}else averageInfo=(averageArr=this.getGameAverage(gameType,match.guest3daStats,!0))[0].length?`\n\t\t\t\t\t<span class="bold text-red">${averageArr[0]}</span>\n\t\t\t\t\t<span class="text-vm text-hint">${averageArr[1]}</span> <span class="lobby-pipe">|</span>\n\t\t\t\t`:"";var leagueInfo="";if(null!==this.data.activeLeague){var teamName=match.team_name,divisionName=match.division_label,leagueShortName=this.data.activeLeague.shortname;leagueInfo+='<hr style="margin-bottom:0" />',leagueInfo+='<p class="league-info text-hint">',teamName&&(leagueInfo+=`\n\t\t\t\t\t${teamName} -\n\t\t\t\t`),divisionName&&(leagueInfo+=`\n\t\t\t\t\tDiv: ${divisionName} -\n\t\t\t\t`),leagueShortName&&(leagueInfo+=`\n\t\t\t\t\t${leagueShortName}\n\t\t\t\t`),leagueInfo+="</p>"}var countryInfo="";return match.city||match.state?match.city?(countryInfo+=match.city,match.state&&(countryInfo+=", "+match.state)):match.state&&(countryInfo+=match.state):match.country&&(countryInfo=this.getCountryShortName(match.country)),content+=`\n\t\t\t<div class="new-button button-menu button-white round-corners text-left"\n\t\t\t\tdata-id="${oppo_device_token}"\n\t\t\t\t${player_roster_id?"data-player-roster-id="+player_roster_id:""}\n\t\t\t\t${team_guid?"data-team-guid="+team_guid:""}\n\t\t\t\t>\n\t\t\t\t${flag}\n\t\t\t\t${averageInfo}<span class="bold">${oppoName}</span>\n\n\t\t\t\t<br />\n\t\t\t\t<p class="match-offer-second-line">\n\t\t\t\t\t<span>${countryInfo}</span>\n\t\t\t\t</p>\n\t\t\t\t${leagueInfo}\n\t\t\t</div>\n\t\t`},checkBGMatches:function(){var matchList=this.data.matchList;if(!matchList)return $("#BG-match-info-offers").hide(),void $("#BG-match-info-no-offers").show();for(var aMatches=[],i=0;i<matchList.length;i++){var match=matchList[i];match.params.member_id!=APP.user.member_id&&aMatches.push(match)}aMatches.length?($("#BG-match-info-offers").show(),$("#BG-match-info-no-offers").hide(),this.updateBGMatches(aMatches)):($("#BG-match-info-offers").hide(),$("#BG-match-info-no-offers").show())},removeBGMatch:function(match){$("#BG-match-list .new-button").each((function(){$(this).attr("data-id")==match.subscriptionId&&$(this).remove()})),this.data.matchList.length||($("#BG-match-info-offers").hide(),$("#BG-match-info-no-offers").show())},injectBGMatch:function(newMatch){for(var isDupe=!1,currentMatches=this.data.matchList,i=0;i<currentMatches.length;i++){currentMatches[i].subscriptionId==newMatch.subscriptionId&&(isDupe=!0),APP.user.member_id==newMatch.params.member_id&&(isDupe=!0)}if(!isDupe){var content=this.createMatchCard(newMatch,!0);$("#BG-match-list").append(content),this.bgMatchListOn(),$("#BG-match-info-offers").show(),$("#BG-match-info-no-offers").hide()}},updateBGMatches:function(matches){for(var content="",i=0;i<matches.length;i++){var match=matches[i];content+=this.createMatchCard(match,!0)}$("#BG-match-list").empty().append(content),this.bgMatchListOn()},bgMatchListOn:function(){$("#BG-match-list .new-button").off("click touchend"),$("#BG-match-list .new-button").on("click touchend",(function(ev){if(!1!==ev.handled){ev.stopPropagation(),ev.preventDefault(),ev.handled=!0;var id=$(this).attr("data-id");APP.lobby.showHostPlayerStats(id,"create")}}))},updateUserCount:function(data){if(void 0!==data.live_count)try{this.data.matchCounts=data,this.save();for(var leagueOffers=0,leagueWatchers=0,leagueLive=0,i=0;i<data.league_counts.length;i++){leagueOffers+=(league=data.league_counts[i]).offers,leagueWatchers+=league.watchers,leagueLive+=league.live}var activeMatches=data.live_count-leagueLive,lobbyPlayers=activeMatches+(data.watchers_count-leagueWatchers),matchOffers=(data.scoring_apps_connected,"("+(data.offers_count-leagueOffers)+")");if(this.data.activeLeague)for(this.data.activeLeague.league_id,i=0;i<data.league_counts.length;i++){(league=data.league_counts[i]).league_id,lobbyPlayers=(activeMatches=league.live)+league.watchers}var lobbyActivityMatchCount=activeMatches;lobbyActivityMatchCount+=1==lobbyActivityMatchCount?" Active Match":" Active Matches";var lobbyActivityPlayerCount=lobbyPlayers;if(lobbyActivityPlayerCount+=1==lobbyActivityPlayerCount?" Lobby Player":" Lobby Players",this.data.activeLeague){var leagueData,activeLeague=this.data.activeLeague;for(i=0;i<data.league_counts.length;i++){var league=data.league_counts[i];activeLeague.league_id==league.league_id&&(leagueData=league)}leagueData&&(`\n\t\t\t\t\t\t${leagueData.live} Active Matches |\n\t\t\t\t\t\t${leagueData.watchers+leagueData.live} Lobby Players\n\t\t\t\t\t`,matchOffers="("+leagueData.offers+")")}$(".lobbyMatchCount").html(matchOffers),$(".lobbyActivityMatchCount").html(""),$(".lobbyActivityPlayerCount").html("")}catch(e){}},updateLobbyActivityPlayers:function(data){if(data.length){var content="<p>Current Lobby Players</p>";content+='<table class="table">';for(var count=0,i=0;i<data.length;i++){var info=data[i];if(this.data.activeLeague){var leagueId=this.data.activeLeague.league_id;if(info.league_id!==leagueId)continue}else if(info.league_id)continue;content+=this.buildPlayerRow(info),count++}count||(content=""),content+="</table>","G"===APP.user.member_level&&APP.lobby.data.activeLeague?$("#lobby-activity .upgrade-text").show():$("#lobby-activity .upgrade-text").hide(),$("#lobby-activity-players").empty().append(content)}else $("#lobby-activity-players").empty().append("")},buildPlayerRow:function(player){var flag='\n\t\t\t<div class="profile-flag">\n\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-ZZ" />\n\t\t\t</div>\n\t\t';player.iso2_country&&(flag=`\n\t\t\t\t<div class="profile-flag">\n\t\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-${player.iso2_country}" />\n\t\t\t\t</div>\n\t\t\t`);var name="";name+=player.first_name,player.last_name&&(name+=" "+player.last_name[0]);var averages="<td class='activity-avg' width='20%'>";return player.ppr&&(averages+=`\n\t\t\t\t<span class="text-avg text-gold">${player.ppr.toFixed(0)}</span>\n\t\t\t\t<span class='text-hint'>PPR</span>\n\t\t\t`),averages+="</td>",averages+="<td class='activity-avg' width='20%'>",player.mpr&&(averages+=`\n\t\t\t\t<span class="text-avg text-gold">${player.mpr.toFixed(1)}</span>\n\t\t\t\t<span class='text-hint'>MPR</span>\n\t\t\t`),`\n\t\t\t<tr>\n\t\t\t\t<td width="10%">${flag}</td>\n\t\t\t\t<td class="activity-name" width="50%">${name}</td>\n\t\t\t\t${averages+="</td>"}\n\t\t\t</tr>\n\t\t`},updateLobbyActivityMatches:function(data){if(data.length){var content="<p>Live DCTV Matches - Click to Follow!</p>";content+='<table class="table">';for(var count=0,i=0;i<data.length;i++){var info=data[i];if(this.data.activeLeague){var leagueId=this.data.activeLeague.league_id;if(info.league_id!==leagueId)continue}else if(info.league_id)continue;content+=this.buildMatchRow(info),count++}content+="</table>",count||(content=""),$("#lobby-activity-matches").empty().append(content),this.lobbyActivityMatchOn()}else $("#lobby-activity-matches").empty().append("")},buildMatchRow:function(match){var homePlayer="";homePlayer+=match.opponents.host.first_name,match.opponents.host.last_name&&(homePlayer+=" "+match.opponents.host.last_name[0]);var homeFlag='\n\t\t\t<div class="profile-flag">\n\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-ZZ" />\n\t\t\t</div>\n\t\t';match.opponents.host.iso2_country&&(homeFlag=`\n\t\t\t\t<div class="profile-flag">\n\t\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-${match.opponents.host.iso2_country}" />\n\t\t\t\t</div>\n\t\t\t`);var awayPlayer="";awayPlayer+=match.opponents.guest.first_name,match.opponents.guest.last_name&&(awayPlayer+=" "+match.opponents.guest.last_name[0]);var awayFlag='\n\t\t\t<div class="profile-flag">\n\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-ZZ" />\n\t\t\t</div>\n\t\t';match.opponents.guest.iso2_country&&(awayFlag=`\n\t\t\t\t<div class="profile-flag">\n\t\t\t\t\t<img src="images/blank.png" class="flag fflag ff-lt fflag-${match.opponents.guest.iso2_country}" />\n\t\t\t\t</div>\n\t\t\t`);var score=["",""],cleanScore="vs";return match.score&&-1==match.score.indexOf("First to")&&(match.score.split(" - ").length&&(score[0]=match.score.split(" - ")[0],score[1]=match.score.split(" - ")[1]),cleanScore=score[0]+" - "+score[1]),`\n\t\t\t<tr class="live-match" data-spectator-key="${match.spectator_key}">\n\t\t\t\t<td width="10%">\n\t\t\t\t\t${homeFlag}\n\t\t\t\t</td>\n\t\t\t\t<td style="text-align: center" width="31%">\n\t\t\t\t\t${homePlayer}\n\t\t\t\t</td>\n\t\t\t\t<td style="text-align: center" width="18%">\n\t\t\t\t\t\x3c!--<img src="images/tv-icon.png" class="tv-icon" />--\x3e\n\t\t\t\t\t<span class="live-scores bold" style="color: #fff">\n\t\t\t\t\t\t${cleanScore}\n\t\t\t\t\t</span>\n\t\t\t\t</td>\n\t\t\t\t<td style="text-align: center" width="31%">\n\t\t\t\t\t${awayPlayer}\n\t\t\t\t</td>\n\t\t\t\t<td width="10%">\n\t\t\t\t\t${awayFlag}\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t`},lobbyActivityMatchOn:function(){$("#lobby-activity-matches .live-match").off("click touchend"),$("#lobby-activity-matches .live-match").on("click touchend",(function(ev){if(!1!==ev.handled){ev.stopPropagation(),ev.preventDefault(),ev.handled=!0;var tvUrl,spectatorKey=$(this).attr("data-spectator-key");switch(APP.location){case"test":tvUrl="https://tv.dartconnect.red/";break;case"train":tvUrl="https://train.tv.dartconnect.com/";break;case"live":tvUrl="https://tv.dartconnect.com/"}var url=tvUrl+"watch/"+spectatorKey;APP.showIframePopOver(url,"DCTV")}}))},createOptions:function(data){var isMultiLevel=!1;if(data)if(data.options)if(data.callback)if(data.title)if(data.defaultText)if(void 0!==data.saveData){if(data.multiLevel&&(isMultiLevel=!0),APP.lobby.activateBtn(data.id,(function(){var buttonIds;if(isMultiLevel){var content=data.options();if(content.isError)return APP.alert.show(content.errorMsg),!1;APP.dialog.show({title:data.title,msg:APP.lobby.buildOptionBtns(content.options)}),buttonIds=APP.lobby.createBtnIds(content.options)}else APP.dialog.show({title:data.title,msg:APP.lobby.buildOptionBtns(data.options)}),buttonIds=APP.lobby.createBtnIds(data.options);APP.lobby.activateBtn(buttonIds,(function(e){var btn=$("#"+e),val=btn.attr("data-value"),display=btn.attr("data-display");data.callback(val,display),-1!=btn.attr("data-value")?$("#"+data.id).html(display).removeClass("button-gray").addClass("button-white"):$("#"+data.id).html(data.defaultText).removeClass("button-white").addClass("button-gray"),APP.dialog.hide()}))})),null!==data.saveData){var optionList=data.options;isMultiLevel&&(optionList=data.options()).options&&(optionList=optionList.options);for(var i=0;i<optionList.length;i++){var option=optionList[i];option.value==data.saveData&&$("#"+data.id).html(option.display).removeClass("button-gray").addClass("button-white")}}}else this.log("Create Options - Check Save Data");else this.log("Create Options - Check default text");else this.log("Create Options - Check title");else this.log("Create Options - Check callback");else this.log("Create Options - Check options");else this.log("Create Options - No data passed")},buildOptionBtns:function(options){for(var content="",i=0;i<options.length;i++){var option=options[i];content+=`\n\t\t\t\t<div class="dialogBtn button button-menu button-gray round-corners"\n\t\t\t\t\tdata-value="${option.value}"\n\t\t\t\t\tdata-display="${option.display}"\n\t\t\t\t\tid="optionBtn-${i}"\n\t\t\t\t>\n\t\t\t\t\t${option.display}\n\t\t\t\t</div>\n\t\t\t`}return content+='\n\t\t\t<div class="dialogBtn button button-menu button-red round-corners"\n\t\t\t\t\tdata-value="-1"\n\t\t\t\t\tid="optionBtnCancel">\n\t\t\t\tCancel\n\t\t\t</div>\n\t\t'},createBtnIds:function(options){for(var buttonIds=["optionBtnCancel"],i=0;i<options.length;i++)buttonIds.push("optionBtn-"+i);return buttonIds},areFiltersApplied:function(){var filtersApplied=0,filters=APP.lobby.data.filters;return filters.gameType&&filtersApplied++,filters.race&&filtersApplied++,filters.oppoAvg&&filtersApplied++,filters.region&&filtersApplied++,this.data.activeLeague&&filters.view&&filtersApplied++,filtersApplied},prepareMatchGuest:function(data){this.log("participant key: "+data.participant_key),APP.popup.hide("popup-lobby"),APP.server.alley_key=data.participant_key,APP.server.registerDevice({success:function(){APP.game_master="SERVER",APP.device.has_chalk=!1,APP.changeMode("PRE-GAME"),APP.lobby.data.gameStartedGuest=!0,APP.lobby.data.isInMatch=!0,APP.lobby.save(),window.location.reload()},error:function(){APP.server.alley_key=null,APP.alert.show("An Error Occurred setting up this Match",(function(){APP.lobby.displayPage(1)}))}})},prepareMatchHost:function(data){var game,race=2*this.data.room.race-1;switch(this.data.room.gameType){case"301":game=0;break;case"501":game=1;break;case"cricket":case"Cricket":game=2}var randomStart=!1;"random"===this.data.room.start&&(randomStart=!0),this.isChallengeLeagueFormat()?APP.quickplay.startChallengeLobbyRoutine(this.data.activeLeague.match_settings):APP.quickplay.startLobbyRoutine(race,game,randomStart),APP.handleAlleyOption("pcm-compete-host-button"),data.opponents.host.chalkboard_name=data.opponents.host.first_name,data.opponents.guest.chalkboard_name=data.opponents.guest.first_name;var players=[];players.push(data.opponents.host),players.push(data.opponents.guest),this.injectPlayers(players),this.injectTeamGuid(),this.reset(!0),this.data.isInMatch=!0,this.data.blockFirstErrorLobby=!0,this.save(),"random"===this.data.room.start&&window.setTimeout((function(){APP.session.handleBullShoot("bs-random")}),1e3),this.isChallengeLeagueFormat()&&APP.header.showSetSetup(),APP.message.userMessage.changeBtn(!0),this.cancelWatchOnlineMatchOffers()},injectPlayers:function(players){var head=APP.header;for(head.roster_left=new head.Roster,head.roster_right=new head.Roster,i=0;i<players.length;i++){0==i?roster=head.roster_left:roster=head.roster_right,roster.select_players=!0;var playerId=APP.header.addLobbyPlayer(players[i]);if(APP.lobby.data.activeLeague)if("Y"===APP.lobby.data.activeLeague.is_challenge_league){var playerGuid=null;playerGuid=0==i?APP.lobby.data.activeLeague.player_roster_id:APP.lobby.data.guestPlayerRosterId,roster.addPlayer({obj_id:playerId,player_guid:playerGuid})}else roster.addPlayer({obj_id:playerId,player_guid:null});else roster.addPlayer({obj_id:playerId,player_guid:null})}head.recordOpponentChange()},injectTeamGuid:function(){this.data.guestTeamGuid&&(APP.session.matches[APP.session.current_match].guest_team_guid=parseFloat(this.data.guestTeamGuid),APP.session.store(APP.session.current_match))},showHostPlayerStats:function(id,bgMatch){for(var oppo=null,matches=APP.lobby.data.matchList,i=0;i<matches.length;i++){var opponent=matches[i];opponent.subscriptionId==id&&(oppo=opponent)}if(!oppo)return APP.alert.show("Opponent not found, please try again"),!1;var content="";if(bgMatch&&"create"==bgMatch&&(content+=`\n\t\t\t\t\t<p>Are you sure you want to cancel your match offer and challenge <span class="bold">${oppo.params.first_name}</span> instead?</p>\n\t\t\t\t\t<hr />\n\t\t\t\t`),content+=`\n\t\t\t<h4>${oppo.params.first_name}</h4>\n\t\t`,this.isChallengeLeagueFormat()){var my501Avg=this.buildHostAvgDisplay(oppo,"501 SIDO"),myCricAvg=this.buildHostAvgDisplay(oppo,"cricket"),testPhrase="<p class='text-hint'>We don't have any average data for this player yet.</p>";my501Avg==testPhrase&&myCricAvg==testPhrase?content+=testPhrase:(content+=my501Avg,content+=myCricAvg)}else content+=this.buildHostAvgDisplay(oppo);APP.confirm.show({title:"Player 3 Dart Averages",msg:content,ok_text:"Send Challenge",cancel_text:"Change Match",ok:function(){bgMatch&&"create"==bgMatch&&(APP.lobby.cancelOnlineMatchOffer(),APP.lobby.killTimer("offerWaitTimer")),APP.lobby.acceptOnlineMatchOffer(id),APP.lobby.data.matchOfferId=id,APP.lobby.save()}})},showGuestPlayerStats:function(id,playerRosterId,teamGuid){for(var oppo=null,i=0;i<APP.lobby.data.offerList.length;i++){var opponent=APP.lobby.data.offerList[i];opponent.device_token==id&&(oppo=opponent)}if(!oppo)return APP.alert.show("Opponent not found, please try again"),!1;var content=`\n\t\t\t<h4>${oppo.first_name}</h4>\n\t\t`;if(this.isChallengeLeagueFormat()){var my501Avg=this.buildGuestAvgDisplay(oppo,"501"),myCricAvg=this.buildGuestAvgDisplay(oppo,"cricket"),testPhrase="<p class='text-hint'>We don't have any average data for this player yet.</p>";my501Avg==testPhrase&&myCricAvg==testPhrase?content+=testPhrase:(content+=my501Avg,content+=myCricAvg)}else content+=this.buildGuestAvgDisplay(oppo);APP.confirm.show({title:"Player 3 Dart Averages",msg:content,ok_text:"Accept Challenge",cancel_text:"Change Opponent",ok:function(){APP.lobby.acceptGameHost(id,playerRosterId,teamGuid)}})},buildHostAvgDisplay:function(oppo,gameType){var game=oppo.params.match_description.game_type;this.isChallengeLeagueFormat()&&(game=gameType);var paramName,averages="",avgEnding="3DA";switch(game){case"501 SIDO":paramName="501_SIDO";break;case"301 DIDO":paramName="301_DIDO";break;case"cricket":case"Cricket":paramName="Cricket",avgEnding="PPR"}try{var stats={allStats:oppo.params.host3daStats.All[paramName],leagueStats:oppo.params.host3daStats.League[paramName],onlineStats:oppo.params.host3daStats.Online[paramName],socialStats:oppo.params.host3daStats.Social[paramName],tournamentStats:oppo.params.host3daStats.Tournament[paramName],botStats:oppo.params.host3daStats["Against DartConnect"][paramName]};return this.isChallengeLeagueFormat()&&(stats={allStats:oppo.params.host3daStats.All[paramName],leagueStats:oppo.params.host3daStats.League[paramName]}),'<tableclass="tableAverages"><tbody>'===(averages+=this.buildAvgTable(stats,avgEnding,paramName)).replace(/\s/g,"")&&(averages="<p class='text-hint'>We don't have any average data for this player yet.</p>"),averages}catch(e){return"<p class='text-hint'>We don't have any average data for this player yet.</p>"}},buildGuestAvgDisplay:function(oppo,gameType){var game=this.data.room.gameType;this.isChallengeLeagueFormat()&&(game=gameType);var paramName,averages="",avgEnding="3DA";switch(game){case"501":paramName="501_SIDO";break;case"301":paramName="301_DIDO";break;case"cricket":case"Cricket":paramName="Cricket",avgEnding="PPR"}try{var stats={allStats:oppo.guest3daStats.All[paramName],leagueStats:oppo.guest3daStats.League[paramName],onlineStats:oppo.guest3daStats.Online[paramName],socialStats:oppo.guest3daStats.Social[paramName],tournamentStats:oppo.guest3daStats.Tournament[paramName],botStats:oppo.guest3daStats["Against DartConnect"][paramName]};return this.isChallengeLeagueFormat()&&(stats={allStats:oppo.guest3daStats.All[paramName],leagueStats:oppo.guest3daStats.League[paramName]}),'<tableclass="tableAverages"><tbody>'===(averages+=this.buildAvgTable(stats,avgEnding,paramName)).replace(/\s/g,"")&&(averages="<p class='text-hint'>We don't have any average data for this player yet.</p>"),averages}catch(e){return"<p class='text-hint'>We don't have any average data for this player yet.</p>"}},buildAvgTable:function(stats,avgEnding,paramName){var gameType;switch(paramName){case"501_SIDO":case"501":gameType="501";break;case"301_DIDO":case"301":gameType="301";break;case"cricket":case"Cricket":gameType="Cricket"}var allStats=stats.allStats,leagueStats=stats.leagueStats,onlineStats=stats.onlineStats,socialStats=stats.socialStats,tournamentStats=stats.tournamentStats,botStats=stats.botStats;var averages='\n\t\t\t<table class="tableAverages">\n\t\t\t\t<tbody>\n\t\t';return onlineStats&&onlineStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<strong class="bold">All Online ${gameType} Legs:</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t<span class="bold">${onlineStats.xpr.toFixed(2)}</span> \n\t\t\t\t\t\t\t<span class="legCount">(${onlineStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),allStats&&allStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<strong class="bold">All ${gameType} Legs:</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t<span class="bold">${allStats.xpr.toFixed(2)}</span> \n\t\t\t\t\t\t\t<span class="legCount">(${allStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),(onlineStats||allStats)&&(onlineStats.xpr>0||allStats.xpr>0)&&(averages+='\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan="2">\n\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t'),leagueStats&&leagueStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\tLeague ${gameType} Legs:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t${leagueStats.xpr.toFixed(2)} \n\t\t\t\t\t\t\t<span class="legCount">(${leagueStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),tournamentStats&&tournamentStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\tTournament ${gameType} Legs:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t${tournamentStats.xpr.toFixed(2)} \n\t\t\t\t\t\t\t<span class="legCount">(${tournamentStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),socialStats&&socialStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\tSocial ${gameType} Legs:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t${socialStats.xpr.toFixed(2)} \n\t\t\t\t\t\t\t<span class="legCount">(${socialStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),botStats&&botStats.xpr>0&&(averages+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t${gameType} Vs. Bot:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="45%">\n\t\t\t\t\t\t\t${botStats.xpr.toFixed(2)} \n\t\t\t\t\t\t\t<span class="legCount">(${botStats.legs} Legs)</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`),averages},getGameAverage:function(game,averageArr,returnArr){try{var gameType,avgEnd="PPR";switch(game){case"501":case"501 SIDO":gameType="501_SIDO";break;case"301":case"301 DIDO":gameType="301_DIDO";break;case"cricket":case"Cricket":gameType="Cricket",avgEnd="MPR"}if(averageArr.All[gameType].xpr&&averageArr.All[gameType].xpr>0){var avgDisplay=averageArr.All[gameType].xpr;return"cricket"===gameType&&"Cricket"===gameType||(avgDisplay=averageArr.All[gameType].xpr.toFixed(1)),returnArr?[avgDisplay,avgEnd]:averageArr.All[gameType].xpr+" "+avgEnd}return["",""]}catch(e){return["",""]}},buildRoomDetails:function(){var roomData=APP.lobby.data.room,gameType=roomData.gameType,gameStart=roomData.start;switch(gameType){case"501_SIDO":gameType="501";break;case"301_DIDO":gameType="301";break;case"cricket":case"Cricket":gameType="Cricket"}switch(gameStart){case"bull":gameStart="Bull Start";break;case"random":gameStart="Random Start"}var race=roomData.race;return`\n\t\t\t${gameType} /\n\t\t\tBest of ${race=2*race-1} /\n\t\t\t${gameStart}\n\t\t`},showLegsEditor:function(){var el=$("#plle-legs");APP.device.pauseKeyboardHandler(),el.off("focus"),el.on("focus",(function(e){$("#plle-legs").val("")})),el.off("keydown"),el.on("keydown",(function(e){return 13==e.which?(BBAT.killDOMEvent(e),APP.lobby.updateCustomLegs(),!0):27==e.which?(BBAT.killDOMEvent(e),APP.lobby.updateCustomLegs(!0),!1):void 0})),$("#plle-title").html("Best of"),$("#popup-lobby-legs-editor-overlay").show(0),$("#popup-lobby-legs-editor").show(0),$("#plle-close").off("click touchend"),$("#plle-close").on("click touchend",(function(ev){APP.lobby.updateCustomLegs(!0)})),$("#plle-continue").off("click touchend"),$("#plle-continue").on("click touchend",(function(ev){APP.lobby.updateCustomLegs()}))},updateCustomLegs:function(cancel){if(cancel)return APP.lobby.data.room.race=null,this.save(),$("#plle-legs").val("").blur(),$("#popup-lobby-legs-editor").hide(0),void $("#popup-lobby-legs-editor-overlay").hide(0);var legs=$("#plle-legs").val();function invalidLegs(msg){APP.alert.show(msg,(function(){$("#plle-legs").focus()}),null,"Try Again")}legs.match(/^[0-9]+$/i)&&0!=legs?legs%2!=0?(legs=Math.round(legs/2),this.data.room.race=legs,this.save(),this.updateLegsSelect(legs),$("#plle-legs").val("").blur(),$("#popup-lobby-legs-editor").hide(0),$("#popup-lobby-legs-editor-overlay").hide(0)):invalidLegs('Legs quantity must be an <span class="bold">ODD</span> number'):invalidLegs("Invalid legs quantity")},updateLegsSelect:function(legs){-1!=legs?(legs=Math.floor(2*legs-1),$("#ol-create-race").html("Best of "+legs+" legs").addClass("button-white").removeClass("button-gray")):$("#ol-create-race").html("Select Match Length").removeClass("button-white").addClass("button-gray")},selectLeagueDialog:function(){var leagues=APP.lobby.getLeagues();if(leagues.length){for(var content="",btnIds=[],i=0;i<leagues.length;i++){var league=leagues[i];if(league.challenge_days.length||"N"!=league.is_challenge_league){var leagueInfo=this.getLeagueInfo(league);content+=`\n\t\t\t\t<div class="button ${leagueInfo.isEnabled?"":"button-disabled"} button-menu  round-corners button-green"\n\t\t\t\t\tid="ls-${league.league_id}"\n\t\t\t\t>\n\t\t\t\t\t${league.longname}\n\t\t\t\t</div>\n\t\t\t\t<span class="text-hint span-block">${leagueInfo.leagueText}</span>\n\t\t\t`,btnIds.push("ls-"+league.league_id)}}content+='\n\t\t\t<div class="button button-menu button-red round-corners"\n\t\t\t\tid="ls-cancel"\n\t\t\t>\n\t\t\t\tCancel\n\t\t\t</div>\n\t\t',APP.dialog.show({title:"Select Your League",msg:content,use_close_icon:!1,post_display:function(){APP.lobby.activateBtn(btnIds,APP.lobby.activateLeague),APP.lobby.activateBtn("ls-cancel",(function(){APP.dialog.hide()}))}})}else APP.alert.show("No leagues available")},buildLeagueDisplay:function(){$("#ol-leagueList").empty();var leagues=APP.lobby.getLeagues();if(leagues.length){for(var content="",btnIds=[],i=0;i<leagues.length;i++){var league=leagues[i];if(league.challenge_days.length||"N"!=league.is_challenge_league){var leagueInfo=this.getLeagueInfo(league);content+=`\n\t\t\t\t<div class="button ${leagueInfo.isEnabled?"":"button-disabled button-disabled-35"} button-menu  round-corners button-green"\n\t\t\t\t\tid="ls-${league.league_id}"\n\t\t\t\t>\n\t\t\t\t\t${league.longname}\n\t\t\t\t</div>\n\t\t\t\t<span class="text-hint span-block">${leagueInfo.leagueText}</span>\n\t\t\t`,btnIds.push("ls-"+league.league_id)}}$("#ol-leagueList").append(content);APP.lobby.activateBtn(btnIds,(function(ele){APP.lobby.activateLeague(ele),APP.lobby.displayPage(1)}))}},activateLeague:function(ele){var leagueId=ele;leagueId=leagueId.replace("ls-","");for(var selectedLeague=null,leagues=APP.lobby.getLeagues(),i=0;i<leagues.length;i++){var league=leagues[i];leagueId===league.league_id&&(selectedLeague=league)}selectedLeague&&(APP.lobby.data.activeLeague=selectedLeague,APP.lobby.save(),APP.lobby.displayPage(APP.lobby.data.mode)),APP.dialog.hide(),$(".lobbyMatchCount").html(""),$(".lobbyActivityMatchCount").html(""),$(".lobbyActivityPlayerCount").html("")},exitLeague:function(){APP.lobby.data.activeLeague=null,APP.lobby.save(),APP.lobby.displayPage(APP.lobby.data.mode)},getLeagueInfo:function(league){var dayArr=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],date=new Date,isEnabled=!1,leagueText="";if(league.challenge_days.length){for(var days=[],i=0;i<league.challenge_days.length;i++){var day=league.challenge_days[i];days.push(dayArr[day])}leagueText=days.length>1?"Challenge Days: "+days.join(", "):"Challenge Day is on "+days[0]}return"Y"==league.is_challenge_league&&(league.challenge_days.length?7==league.challenge_days.length&&(leagueText="Create a Match Challenge Any Day!"):leagueText="This is a Challenge League"),isEnabled=!!this.isLeagueActive(league.challenge_days,date),league.challenge_day_prime_time&&(leagueText+=`\n\t\t\t\t<br />Prime Time is ${league.challenge_day_prime_time}\n\t\t\t`),{isEnabled:isEnabled,leagueText:leagueText}},isLeagueActive:function(leagueDays,today){for(var leagueIsActive=!1,i=0;i<leagueDays.length;i++){var leagueDay=leagueDays[i];leagueDay==today.getDay()&&(leagueIsActive=!0),leagueDay==today.getDay()+1&&today.getHours()<3&&(leagueIsActive=!0)}return leagueIsActive},isChallengeLeagueFormat:function(){var isChallengeLeague=!1,aLeague=this.data.activeLeague;return aLeague&&"Y"==aLeague.is_challenge_league&&"D"==aLeague.challenge_league_match_format&&(isChallengeLeague=!0),isChallengeLeague},updateLeagues:function(successCb,errorCb){APP.device.showSpinnerOverlay();try{successCb||(successCb=function(in_payload){var new_med=new Date(in_payload.membership_expires).valueOf();if(APP.user.first_name=in_payload.first_name,APP.user.last_name=in_payload.last_name,APP.user.email=in_payload.email,APP.user.premium_pay_type=in_payload.premium_pay_type,APP.user.token_expire_date=new Date(in_payload.user_token_expires).valueOf(),APP.flushLeagueDirectories(),in_payload.league_associations){APP.user.league_associations=in_payload.league_associations.slice(0);for(var lalen=in_payload.league_associations.length,i=0;i<lalen;i++){var l=in_payload.league_associations[i],key="_"+l.team_guid+"_"+l.season_status;if("I"!=l.access_status){var d=in_payload.directory_divisions[key];if(d){d.league_guid=l.league_guid,d.season_status=l.season_status,d.edit_date=null,"TEAM"==l.league_type&&d.teams.unshift({});var obj={};obj["directory_division"+key]=d,BBAT.storeData(obj)}}}}else delete APP.user.league_associations;if(in_payload.lobby_leagues?APP.user.lobby_leagues=in_payload.lobby_leagues:delete APP.user.lobby_leagues,APP.lobby.data.accessLevel=APP.lobby.lobbyAccessLevel(),BBAT.storeData({user:APP.user}),in_payload.tournaments){APP.session.tournaments={};var len=in_payload.tournaments.length;for(i=0;i<len;i++){var t=in_payload.tournaments[i];APP.session.tournaments[t.id]={active:t.active,start_date:t.start_date,promo_line_1:t.promo_line_1,promo_line_2:t.promo_line_2,promo_line_3:t.promo_line_3,menu_title:t.menu_title,menu_description:t.menu_description,match_description:t.match_description,reset_match_format:t.reset_match_format,bracket_interface:t.bracket_interface,tournament_type:t.tournament_type,checkin_tagline:t.checkin_tagline,checkin_type:t.checkin_type,expiration_date:t.expiration_date,tablet:t.tablet,checkin_start_date:t.checkin_start_date,proxy_account:t.proxy_account,start_timestamp:t.start_timestamp,expiration_timestamp:t.expiration_timestamp,show_all_matches_override:!1,new_scoreboard_only:t.new_scoreboard_only}}BBAT.storeData({tournaments:APP.session.tournaments})}in_payload.member_level==APP.user.member_level&&new_med==APP.user.med||(BBAT.storeData({mcache:{l:in_payload.member_level,e:new_med}}),APP.user.med=new_med),location.reload()}),errorCb||(errorCb=function(in_payload){}),APP.server.memberCheckin(successCb,errorCb)}catch(e){APP.device.hideSpinnerOverlay()}},getFilterData:function(){try{var data={filters:{game_types:null,leg_counts:null}};if(this.data.filters.gameType){var gameType;switch(this.data.filters.gameType){case"501_SIDO":gameType="501 SIDO";break;case"301_DIDO":gameType="301 DIDO";break;case"cricket":gameType="Cricket"}data.filters.game_types=gameType}if(this.data.filters.race&&(data.filters.leg_counts=this.data.filters.race),this.data.filters.region&&(data.filters.region=this.data.filters.region),this.data.filters.oppoAvg&&(data.filters.xpr_range=this.data.filters.oppoAvg),this.data.filters.vc&&(data.filters.videoConnectStatus=this.data.filters.vc),null!==this.data.activeLeague)switch(data.filters.league_id=this.data.activeLeague.league_id,"Y"==this.data.activeLeague.is_challenge_league&&(data.filters.is_challenge_league="Y",data.filters.player_roster_id=this.data.activeLeague.player_roster_id),delete data.filters.region,this.data.filters.view){case"division":data.filters.division_guid=this.data.activeLeague.team_guid;break;case"team":"SINGLES"!==this.data.activeLeague.league_type&&(data.filters.team_guid=this.data.activeLeague.team_guid)}return data}catch(e){return{filters:{game_types:null,leg_counts:null}}}},clearFilters:function(){var filters=this.data.filters;$.each(filters,(function(index,value){filters[index]=null})),this.save(),this.displayPage(this.data.mode)},clearMatchSettings:function(){var settings=this.data.room;$.each(settings,(function(index,value){settings[index]=null})),this.save(),this.displayPage(this.data.mode)},killTimer:function(timerName){APP.lobby.timers[timerName]&&(APP.lobby.timers[timerName].stopTimer(),APP.lobby.timers[timerName]=null)},isLobbyMatch:function(){return this.data.mode&&this.data.isInMatch},playSound:function(){if(!this.timers.offerSoundTimer){this.data.notificationSound.src="sounds/DCalert.mp3";try{this.data.notificationSound.play()}catch(e){}var timerVars={name:"offerSoundTimer",runTime:30,callback:function(){APP.lobby.killTimer("offerSoundTimer")},eachTick:function(){},debugMode:!1};this.timers.offerSoundTimer=new Timer(timerVars)}},handleVCCommand:function(data){data.hasOwnProperty("newVideoConnectStatus")&&this.log("VC Connect Status Received")},lobbyAccessLevel:function(){var memberLevel=APP.getMembershipName(APP.user.member_level);return"Premium"==memberLevel||"Super User"==memberLevel||APP.user.lobbyGuestAccess?"full":"league"},getCountryShortName:function(countryName){var countries={"United Kingdom of Great Britain and Northern Ireland":"United Kingdom","United States of America":"United States"};return countries[countryName]?countries[countryName]:countryName},isLobbyPermitted:function(){return!0},extendKickTimer:function(){this.timers.kickPlayerTimer&&APP.lobby.killTimer("kickPlayerTimer");var timerVars={name:"kickPlayerTimer",runTime:3600,callback:function(manualStop){if(!manualStop){if(APP.lobby.killTimer("kickPlayerTimer"),APP.lobby.data.isInMatch)return;if(!APP.lobby.data.mode)return;APP.lobby.exit()}},eachTick:function(){},debugMode:!1};APP.lobby.timers.kickPlayerTimer=new Timer(timerVars)},offerRematch:function(guest){guest?APP.message.send.lobbyRematchMessage("offer_guest"):(APP.session.stopAutoSave(),APP.message.send.lobbyRematchMessage("offer"));new Timer({name:"coolDownTimer",runTime:10,callback:function(){$("#seo-sb-rematch").removeClass("button-disabled button-down").text("Request Rematch")},eachTick:function(){$("#seo-sb-rematch").text("Request Sent ("+this.getCountDown()+")")},debugMode:!1});$("#seo-sb-rematch").addClass("button-disabled")},declineRematch:function(){APP.alert.show("Your rematch offer has been declined",(function(){APP.device.is_hosting&&($("#seo-set-control").show(),APP.session.startAutoSave())}))},informGuestRematch:function(){$("#seo-sb-table tbody").empty();$("#seo-sb-table tbody").append("\n\t\t\t<tr>\n\t\t\t\t<td>&nbsp;</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>Host is preparing a new match</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>&nbsp;</td>\n\t\t\t</tr>\n\t\t"),$("#seo-sb-rematch").remove()},startRematch:function(){if("HOST"==APP.device.role){var sess=APP.session;if(!sess.getMatchFormat().sets)return APP.alert.show("Please create a new challenge in the lobby"),void APP.message.send.lobbyRematchMessage("fail_host");APP.message.send.lobbyRematchMessage("accept_host"),sess.getMatchFormat().sets.limit=parseInt(sess.getMatchFormat().sets.limit)+1+"",sess.store(sess.current_match),APP.handleEOGMenuOption("seo-sb-new-set")}},save:function(){BBAT.storeData({lobby_data:APP.lobby.data})},clear:function(){this.reset(),BBAT.flushData("lobby_data")},watchOnlineMatchOffers:function(){var data=this.getFilterData();data.member_level=APP.user.member_level;this.doCall("/watchOnlineMatchOffers",data,(function(r){var matchCount=r.payload.total_match_offers+r.payload.filtered_offers.length;APP.lobby.log("Success: Found "+matchCount+" match(es)"),APP.lobby.updateMatchListArr(r.payload.filtered_offers),APP.lobby.updateMatchList(r.payload),APP.lobby.updateUserCount(r.payload),APP.lobby.data.activeLeague?(APP.lobby.updateLobbyActivityPlayers(r.payload.lobbyActivity.league_watching),APP.lobby.updateLobbyActivityMatches(r.payload.lobbyActivity.league_live)):(APP.lobby.updateLobbyActivityPlayers(r.payload.lobbyActivity.global_watching),APP.lobby.updateLobbyActivityMatches(r.payload.lobbyActivity.global_live))}),(function(r,status){if(status&&"Lobby is full"===status){APP.alert.show('\n\t\t\t\t\t\tDue to overwhelming demand, the lobby has reached its maximum capacity for players with Guest Accounts. Please try again shortly.<br /><br />\n\n\t\t\t\t\t\tThis limit does not affect Premium Memberships<br /><br />\n\t\t\t\t\t\t<a href="https://my.dartconnect.com/membership" target="_blank" class="fake-link">Upgrade now</a>\n\t\t\t\t\t',(function(){APP.lobby.exit()}))}else APP.lobby.log("watchOnlineMatchOffers Error: "+r.status_text),$("#matchOfferText").html('\n\t\t\t\t<div class="highlight-box" style="cursor: pointer" onclick="APP.lobby.displayPage(1)">\n\t\t\t\t<span class="text-gold">Connectivity Issue!</span><br />\n\t\t\t\t<span style="font-weight: normal">DartConnect is attempting to reconnect. To attempt to manually connect, </span>Click Here\n\t\t\t\t</div>\n\t\t\t'),window.setTimeout((function(){APP.lobby.watchOnlineMatchOffers()}),5e3)}))},openAlley:function(){APP.handleAlleyOption("pcm-broadcast-start-button",(function(r){APP.server.participant_device_key?(APP.lobby.log("Alley opened"),APP.lobby.isChallengeLeagueFormat()&&(APP.lobby.createOnlineMatchOffer(),APP.device.disableButton("olf-ready"))):(APP.lobby.log("Failed to open alley"),APP.confirm.show({msg:"An error occurred preparing your match, Would you like to try again?",ok:function(){APP.lobby.openAlley()},cancel:function(){APP.lobby.displayPage(1)}}))}))},createOnlineMatchOffer:function(isChallengeMatch){var participantKey,spectatorKey,gameType=this.data.room.gameType;switch(gameType){case"501":gameType="501 SIDO";break;case"301":gameType="301 DIDO";break;case"cricket":gameType="Cricket"}if(!APP.server.participant_device_key)return APP.device.disableButton("olf-ready"),void APP.alert.show("An Errror Occurred Opening a Lobby. <br />Please try again later",(function(){APP.lobby.displayPage(1)}));participantKey=APP.server.participant_device_key.replace(/\D/g,""),spectatorKey=APP.server.spectator_device_key;var data={alley_id:APP.server.alley_id,participant_key:participantKey,spectator_key:spectatorKey,member_leagues:[],member_teams:[],match_description:{game_type:gameType,leg_count:this.data.room.race,start_type:this.data.room.start},publish_filters:{audience_league_id:null,region:[]}};if(BBAT.storeData({keep_alley_open:!0,game_id:APP.server.game_id,alley_id:APP.server.alley_id,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,participant_device_key:APP.server.participant_device_key,spectator_device_key:APP.server.spectator_device_key}),APP.lobby.isChallengeLeagueFormat()&&(data.match_description.game_type="501 SIDO",data.match_description.leg_count="1",data.match_description.start_type="bull"),null!==this.data.activeLeague){var league=this.data.activeLeague;data.publish_filters.audience_league_id=league.league_id,league.team_guid&&(data.publish_filters.audience_division_guid=league.team_guid,data.publish_filters.audience_division_label=league.division_label),"SINGLES"!==league.league_type&&(data.publish_filters.audience_team_guid=league.team_guid,data.publish_filters.audience_team_name=league.team_name),"Y"==league.is_challenge_league&&(data.publish_filters.is_challenge_league="Y",data.publish_filters.player_roster_id=league.player_roster_id)}var errorFn=function(r){r&&(r.status_text?APP.lobby.log("createOnlineMatchOffer Error: "+r.status_text):APP.lobby.log("createOnlineMatchOffer Unexpected Error")),APP.alert.show("An error occurred creating your match."),APP.device.enableButton("olf-ready")};this.doCall("/createOnlineMatchOffer",data,(function(r){"OK"===r.status?(APP.lobby.log("Success: Room Created"),APP.lobby.displayPage(5)):errorFn(r)}),errorFn)},acceptOnlineMatchOffer:function(matchOfferId){var data={matchOfferId:matchOfferId};if(this.data.activeLeague){var activeLeague=this.data.activeLeague;"Y"===activeLeague.is_challenge_league&&(data.player_roster_id=activeLeague.player_roster_id,data.team_guid=activeLeague.team_guid)}null!==this.data.activeLeague&&(data.division_label=this.data.activeLeague.division_label,"SINGLES"!==this.data.activeLeague.league_type&&(data.team_name=this.data.activeLeague.team_name));this.doCall("/acceptOnlineMatchOffer",data,(function(r){APP.lobby.log("Match Offer Sent for: "+matchOfferId),APP.lobby.displayPage(2)}),(function(r){APP.lobby.log("acceptOnlineMatchOffer Error: "+r.status_text),APP.alert.show("This match is no longer available",(function(){var match={subscriptionId:matchOfferId};APP.lobby.removeMatchFromList(match)}))}))},acceptGameHost:function(guestDeviceToken,guestPlayerRosterId,guestTeamGuid){this.killTimer("offerWaitTimer");var data={guest_device_token:guestDeviceToken};this.data.guestDeviceToken=guestDeviceToken,this.data.guestPlayerRosterId=guestPlayerRosterId,this.data.guestTeamGuid=guestTeamGuid,this.save();var errorFn=function(r){APP.alert.show("An error occurred connecting with your opponent",(function(){APP.lobby.data.guestDeviceToken=null,APP.lobby.data.guestPlayerRosterId=null,APP.lobby.save(),APP.lobby.displayPage(5)}))};this.doCall("/beginOnlineMatch",data,(function(r){"OK"===r.status?APP.lobby.displayPage(3):errorFn()}),errorFn)},confirmGameHost:function(){this.killTimer("oppoWaitTimer");var data={guest_device_token:this.data.guestDeviceToken},errorFn=function(r){APP.confirm.show({msg:"An error occurred connecting with your opponent, Would you like to try again?",ok:function(){APP.lobby.confirmGameHost()},cancel:function(){APP.lobby.data.guestDeviceToken=null,APP.lobby.save(),APP.lobby.displayPage(5)}})};this.doCall("/finalizeBeginOnlineMatch",data,(function(r){"OK"===r.status?(APP.lobby.log("Success: confirmGameHost"),APP.lobby.prepareMatchHost(r.payload)):errorFn()}),errorFn)},beginOnlineMatch:function(guest_device_token){APP.lobby.killTimer("offerWaitTimer");var data={guest_device_token:guest_device_token},errorFn=function(r){APP.confirm.show({msg:"An error occurred accepting this match, Would you like to try again?",ok:function(){APP.lobby.beginOnlineMatch(guest_device_token)}})};this.doCall("/beginOnlineMatch",data,(function(r){"OK"===r.status?(APP.lobby.log("Success: beginOnlineMatch"),APP.lobby.prepareMatchHost(r.payload)):errorFn()}),errorFn)},getOfferAcceptances:function(){var errorFn=function(r){APP.alert.show("Your match offer timed out",(function(){APP.lobby.cancelOnlineMatchOffer()}))};this.doCall("/getOfferAcceptances",{},(function(r){"OK"===r.status?(APP.lobby.log("Success: getOfferAcceptances"),APP.lobby.updateWaitMatchList(r.payload),APP.lobby.data.offerList=r.payload):errorFn()}),errorFn)},withdrawMatchAcceptances:function(){var data={matchOfferId:APP.lobby.data.matchOfferId};this.doCall("/withdrawMatchAcceptance",data,(function(r){APP.lobby.log("Success: Withdrawed acceptance")}),(function(r){APP.lobby.log("Failed to withdrawed acceptance")})),this.data.matchOfferId=null,this.save()},cancelOnlineMatchOffer:function(exiting){this.doCall("/cancelOnlineMatchOffer",{},(function(r){APP.lobby.log("Success: Cancelled any rooms"),APP.lobby.cancelWatchOnlineMatchOffers(),APP.lobby.data.mode&&APP.lobby.displayPage(1),APP.lobby.killTimer("offerWaitTimer"),APP.lobby.killTimer("offerSoundTimer"),APP.device.enableButton("ol-cancel-match")}),(function(r){APP.lobby.log("Failed to cancel room - force quitting"),APP.lobby.cancelWatchOnlineMatchOffers(),exiting||APP.lobby.displayPage(1),APP.lobby.killTimer("offerWaitTimer"),APP.lobby.killTimer("offerSoundTimer")}))},cancelWatchOnlineMatchOffers:function(){this.doCall("/cancelWatchOnlineMatchOffers",{},(function(r){APP.lobby.log("Success: Cancelled Room, stopped watching for opponents"),BBAT.flushData("exit_lobby")}),(function(r){APP.lobby.log("Failed to cancel room"),BBAT.flushData("exit_lobby")}))},closeLiveMatch:function(){var data={member_id:APP.user.member_id,device_token:APP.device.token};this.doCall("/closeLiveMatch",data,(function(r){APP.lobby.log("Success: Closed Live Match")}),(function(r){APP.lobby.log("Failed to close live match")}))},reconnectWS:function(){1===this.data.mode&&(this.log("Wake up sleeping device"),this.watchOnlineMatchOffers())},doCall:function(url,data,success,error){data.device_token=APP.device.token,data.member_id=APP.user?APP.user.member_id:"n/a",data=JSON.stringify(data);var srvr=APP.server;$.ajax({url:url,type:"POST",cache:!1,timeout:srvr.dflt_timeout,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?success(in_data):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){error("FAILED",in_a,in_b,in_c)}})},exitMatchGuest:function(){var data={member_id:APP.user.member_id,device_token:APP.device.token};this.doCall("/exitOnlineMatch",data,(function(r){APP.lobby.log("Success: Exited live match")}),(function(r){APP.lobby.log("Failed to exit live match")}))},handleWebSockets:function(call){var callType=call.subscriptionMsg.dataset,data=call.subscriptionMsg.data;switch(callType){case"matchOffers":this.updateMatchList(data),this.updateMatchListArr(data.filtered_offers),5==this.data.mode&&this.checkBGMatches();break;case"newMatchOffer":this.addMatchToList(data);break;case"cancelMatchOffer":this.removeMatchFromList(data);break;case"lobbyClosed":if(!APP.lobby.data.mode)return;APP.alert.show("This match is no longer available",(function(){APP.lobby.displayPage(1)}));break;case"matchAcceptances":this.updateWaitMatchList(data),this.data.offerList=data;break;case"enterMatch":this.prepareMatchGuest(data);break;case"lobbyCounts":this.updateUserCount(data),data.lobbyActivity&&(APP.lobby.data.activeLeague?(APP.lobby.updateLobbyActivityPlayers(data.lobbyActivity.league_watching),APP.lobby.updateLobbyActivityMatches(data.lobbyActivity.league_live)):(APP.lobby.updateLobbyActivityPlayers(data.lobbyActivity.global_watching),APP.lobby.updateLobbyActivityMatches(data.lobbyActivity.global_live)));break;case"videoConnectCommand":this.handleVCCommand(data);break;case"updateMatchOffer":for(var updated=!1,match=data,savedMatches=this.data.matchList,i=0;i<savedMatches.length;i++){savedMatches[i].subscriptionId==match.subscriptionId&&(updated=!0,savedMatches[i]=match)}if(updated){var update={filtered_offers:savedMatches};this.updateMatchList(update),5==this.data.mode&&this.checkBGMatches()}else this.removeMatchFromList(data),this.addMatchToList(data);break;default:this.log("ERROR - Websocket Not Handled:"),console.log(call)}},pages:{lobby:{content:function(){APP.lobby.isChallengeLeagueFormat();var filterClass="button-gray";return APP.lobby.areFiltersApplied()&&(filterClass="button-gold"),`\n\t\t\t\t\t<div id='lobby-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t\t<div class="button button-menu button-green round-corners" id="ol-createMatch">\n\t\t\t\t\t\t\tCreate a Match Offer\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu ${filterClass} round-corners" id="ol-filterMatches">\n\t\t\t\t\t\t\tFilter Available Matches\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='lobby-main'>\n\t\t\t\t\t\t<h4 id="matchOfferText" class="subheading"></span>\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<div id="lobby-match-list">\n\t\t\t\t\t\t\t<span class="lobbyActivityMatchCount text-hint span-block"></span>\n\t\t\t\t\t\t\t<div id="lobby-activity-matches">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="lobbyActivityPlayerCount text-hint span-block"></span>\n\t\t\t\t\t\t\t<div id="lobby-activity-players">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="lobby-activity">\n\t\t\t\t\t\t\t<hr class="lobbyActivityHr" />\n\t\t\t\t\t\t\t<span class="lobbyFiltersDisplay"></span>\n\t\t\t\t\t\t\t<span class="lobbyActivityMatchCount text-hint span-block"></span>\n\t\t\t\t\t\t\t<div id="lobby-activity-matches">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span class="lobbyActivityPlayerCount text-hint span-block"></span>\n\t\t\t\t\t\t\t<div id="lobby-activity-players">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="upgrade-text">\n\t\t\t\t\t\t\t\t<p>Looking for more Darts? Become a premium member and gain access to the Global Match Lobby<br />Only $2 per month!</p>\n\n\t\t\t\t\t\t\t\t<p><a id="lobby-upgrade-link" href="https://my.dartconnect.com/membership" target="dc_member_page">Upgrade Now</a></p>\n\n\t\t\t\t\t\t\t\t\x3c!--<p id="lobby-upgrade-link" class="button">Upgrade Now!</p>--\x3e\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){var content="";APP.lobby.data.hasLeagues&&(null!==APP.lobby.data.activeLeague?content+=`\n\t\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-exitLeague">\n\t\t\t\t\t\t\t\tExit to Global Lobby\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<h4 class="text-gold">${APP.lobby.data.activeLeague.longname}</h4>\n\t\t\t\t\t\t\t<hr class="clean-hr red" />\n\t\t\t\t\t\t`:content+='\n\t\t\t\t\t\t\t<div class="button button-menu button-gold round-corners" id="ol-enterLeague">\n\t\t\t\t\t\t\t\tEnter Private Lobbies\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<hr class="clean-hr red" />\n\t\t\t\t\t\t');return content},getSubHeader:function(){var content="",league=APP.lobby.data.activeLeague;return null!==league&&(content+=`\n\t\t\t\t\t\t<span class="text-gold bold">${league.shortname}</span>\n\t\t\t\t\t`),content},init:function(){APP.header.killTempPlayers(),APP.lobby.watchOnlineMatchOffers(),$("#lobby-footer").hide(),APP.lobby.activateBtn("ol-createMatch",(function(){APP.lobby.displayPage(4),APP.lobby.data.notificationSound.play(),APP.lobby.data.notificationSound.pause()})),APP.lobby.activateBtn("ol-filterMatches",(function(){APP.lobby.displayPage(7)})),$("#ol-enterLeague").length&&APP.lobby.activateBtn("ol-enterLeague",(function(){APP.lobby.displayPage(8)})),$("#ol-exitLeague").length&&APP.lobby.activateBtn("ol-exitLeague",(function(){APP.lobby.exitLeague(),$(".lobbyMatchCount").html(""),$(".lobbyActivityMatchCount").html(""),$(".lobbyActivityPlayerCount").html("")}));var filtersCount=APP.lobby.areFiltersApplied();if(filtersCount){var filterTxt=" Filters Applied";1==filtersCount&&(filterTxt=" Filter Applied"),$("#ol-filterMatches").text(filtersCount+filterTxt+" - Edit Filters")}else $(".lobbyFiltersDisplay").html("");"league"===APP.lobby.data.accessLevel&&(APP.lobby.data.activeLeague||(APP.lobby.log("User is not premium, block features"),APP.device.disableButton("ol-createMatch"),APP.device.disableButton("ol-filterMatches")));var matchCounts=APP.lobby.data.matchCounts;matchCounts&&APP.lobby.updateUserCount(matchCounts),$("#popup-lobby .popup-title span").text("Global Match Lobby")}},offer:{content:'\n\t\t\t\t<div id=\'lobby-header\'>\n\t\t\t\t\t<p>Your match challenge has been sent!</p>\n\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-back">\n\t\t\t\t\t\tCancel Challenge\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id=\'lobby-main\'>\n\t\t\t\t\t<h4>Waiting for Host to Accept <span class="text-gold" id="matchWaitTimer"></span></h4>\n\t\t\t\t</div>\n\t\t\t',init:function(){APP.lobby.activateBtn("ol-back",(function(){APP.lobby.displayPage(1),APP.lobby.withdrawMatchAcceptances(),APP.lobby.killTimer("matchWaitTimer")})),APP.lobby.killTimer("matchWaitTimer");var timerVars={name:"matchWaitTimer",manualStop:!0,callback:function(){},eachTick:function(){$("#matchWaitTimer").html(this.getRunTime())},debugMode:!1,returnMinutes:!0};APP.lobby.timers.matchWaitTimer=new Timer(timerVars)}},accepted:{content:'\n\t\t\t\t<div id=\'lobby-header\'>\n\t\t\t\t\t<h4>Connecting your opponent</h4>\n\t\t\t\t</div>\n\t\t\t\t<div id=\'lobby-main\'>\n\t\t\t\t\t<p>Please wait while we connect you and your opponent&hellip;</p>\n\t\t\t\t\t<br/>\n\t\t\t\t\t<span class="text-gold" id="oppoWaitTimer"></span>\n\t\t\t\t\t<div id="ola-cancel-oppo-div">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',init:function(){APP.lobby.killTimer("oppoWaitTimer");var timerVars={name:"oppoWaitTimer",manualStop:!0,callback:function(){},eachTick:function(){$("#oppoWaitTimer").html(this.getRunTime()),30==this.timer&&($("#ola-cancel-oppo-div").append('\n\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ola-cancel-oppo">\n\t\t\t\t\t\t\tChange Opponent\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.lobby.activateBtn("ola-cancel-oppo",(function(){APP.lobby.log("Cancelled Waiting on Oppo"),APP.lobby.data.guestDeviceToken=null,APP.lobby.data.guestPlayerRosterId=null,APP.lobby.save(),APP.lobby.displayPage(5)})))},debugMode:!1,returnMinutes:!0};APP.lobby.timers.oppoWaitTimer=new Timer(timerVars)}},create:{content:function(){var content='\n\t\t\t\t\t<div id=\'lobby-header\'>\n\t\t\t\t\t\t<p>Create a match by selecting Game Type and Match Length. Click "Ready to Play" to post your match in the lobby to invite opponents</p>\n\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-back">\n\t\t\t\t\t\t\tBack\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\'lobby-main\'>\n\t\t\t\t\t\t<h4>Create Match</h4>\n\t\t\t\t';return APP.lobby.isChallengeLeagueFormat()?content+=`\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<h4>This Match will be played with the <span class="text-gold">${APP.lobby.data.activeLeague.division_label}</span> Match Format. <br /><br /> Click the button below to begin.</h4>\n\t\t\t\t\t`:content+='\n\t\t\t\t\t\t<div class="button button-menu button-gold round-corners" id="ol-create-removeAll">\n\t\t\t\t\t\t\tReset Match Settings\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-create-gameType">\n\t\t\t\t\t\t\tSelect Game Type\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-create-race">\n\t\t\t\t\t\t\tSelect Match Length\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-create-start">\n\t\t\t\t\t\t\tSelect Match Start Type\n\t\t\t\t\t\t</div>\n\t\t\t\t\t',content+='\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="highlight-box bull-info">\n\t\t\t\t\t\t<p style="margin-top: 0;">\n\t\t\t\t\t\t\t<span class="bold text-gold">New!</span> Use the <span class="bold text-gold">Chat Function</span> to communicate your Bull Hits\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p style="padding-top: 0.33em; color: #ccc">\n\t\t\t\t\t\t\t(Located in Red Control Bar)\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(){var data;APP.lobby.activateBtn("ol-back",(function(){APP.lobby.displayPage(1),APP.server.alley_id&&APP.server.closeAlley()})),data={id:"ol-create-gameType",title:"Select Game Type",options:[{display:"501 SIDO",value:"501"},{display:"Cricket",value:"cricket"},{display:"301 DIDO",value:"301"}],defaultText:"Select Game Type",saveData:APP.lobby.data.room.gameType,callback:function(val,display){APP.lobby.data.room.gameType=-1!=val?val:null,APP.lobby.save()}},APP.lobby.createOptions(data),data={id:"ol-create-race",title:"Select Legs",options:[{display:"Best of 1 Leg",value:1},{display:"Best of 3 Legs",value:2},{display:"Best of 5 Legs",value:3},{display:"Best of 7 Legs",value:4},{display:"Best of 9 Legs",value:5},{display:"Best of 11 Legs",value:6},{display:"Custom Leg Count",value:"custom"}],defaultText:"Select Match Length",saveData:APP.lobby.data.room.race,callback:function(val,display){-1!=val?"custom"===val?(APP.lobby.showLegsEditor(),window.setTimeout((function(){APP.lobby.updateLegsSelect(-1)}),100)):APP.lobby.data.room.race=val:APP.lobby.data.room.race=null,APP.lobby.save()}},APP.lobby.createOptions(data),APP.lobby.data.room.race&&APP.lobby.updateLegsSelect(APP.lobby.data.room.race),data={id:"ol-create-start",title:"Select Match Start Type",options:[{display:"Bull Start",value:"bull"},{display:"Random Start",value:"random"}],defaultText:"Select Match Start Type",saveData:APP.lobby.data.room.start,callback:function(val,display){APP.lobby.data.room.start=-1!=val?val:null,APP.lobby.save(),"bull"==val?$(".highlight-box.bull-info").show():$(".highlight-box.bull-info").hide()}},APP.lobby.createOptions(data);$("#lobby-footer").empty().append('\n\t\t\t\t\t<div class="button button-menu button-green round-corners" id="olf-ready">\n\t\t\t\t\t\tCreate Match Offer\n\t\t\t\t\t</div>\n\t\t\t\t').show(),APP.lobby.activateBtn("olf-ready",(function(){var data=APP.lobby.data.room,error=!1,errorMsg="";if(data.start||(error=!0,errorMsg="Please select the Match Start Type"),data.race||(error=!0,errorMsg="Please select the Match Length"),data.gameType||(error=!0,errorMsg="Please select a Game Type"),error&&!APP.lobby.isChallengeLeagueFormat())return errorMsg||(errorMsg="Please select a value for all fields"),void APP.alert.show(errorMsg);APP.lobby.createOnlineMatchOffer(),APP.device.disableButton("olf-ready")})),APP.lobby.activateBtn("ol-create-removeAll",(function(){APP.lobby.clearMatchSettings()})),APP.lobby.openAlley(),"bull"===APP.lobby.data.room.start&&$(".highlight-box.bull-info").show()}},waitOpponent:{content:function(){var content="\n\t\t\t\t\t<div id='lobby-header'>\n\t\t\t\t";return APP.lobby.isChallengeLeagueFormat()?content+='\n\t\t\t\t\t\t<p class="bold">Your League Match Settings are Active</p>\n\t\t\t\t\t':(content+='\n\t\t\t\t\t\t<h4 style="margin: 0">My Match Offer</h4>\n\t\t\t\t\t',content+='\n\t\t\t\t\t\t<p class="lobbyGameSettings"></p>\n\t\t\t\t\t'),content+='\n\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-cancel-match">\n\t\t\t\t\t\t\tCancel My Match Offer\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id="lobby-main">\n\t\t\t\t\t\t<div id="wait-match-timer">\n\t\t\t\t\t\t\t<h4>This match offer will expire <span id="offerWaitTimer"></span></h4>\n\t\t\t\t\t\t\t<p id="oppo-search-text">Awaiting Challengers&hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="wait-match-list">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="BG-match-list-div">\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t<p class="bold" id="BG-match-info-no-offers">\n\t\t\t\t\t\t\t\tThere are no other offers at this time\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p class="bold" id="BG-match-info-offers" style="display: none">\n\t\t\t\t\t\t\t\tYou may select other match offers at any time\n\t\t\t\t\t\t\t\t<span class="waitFiltersDisplay"></span>\n\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t<div id="BG-match-list">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(){var cancelMatchFn=function(){APP.device.disableButton("ol-cancel-match"),APP.lobby.cancelOnlineMatchOffer(),APP.server.alley_id&&APP.server.closeAlley()};APP.lobby.activateBtn("ol-cancel-match",(function(){cancelMatchFn()}));var content=APP.lobby.buildRoomDetails();$(".lobbyGameSettings").html(content);var matches=APP.lobby.buildWaitMatchList([]);if($("#wait-match-list").append(matches),APP.lobby.checkBGMatches(),APP.lobby.areFiltersApplied()){content='\n\t\t\t\t\t\t<br />\n\t\t\t\t\t\t<span class="text-gold filters-text">\n\t\t\t\t\t\t\tMatch filters are active - Return to lobby to reset\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';$(".waitFiltersDisplay").html(content)}else $(".waitFiltersDisplay").html("");APP.lobby.killTimer("offerWaitTimer");var timeOut=1200;"Test"===APP.getEnvironment()&&(timeOut=1800);var timerVars={name:"offerWaitTimer",runTime:timeOut,callback:function(earlyStop){earlyStop||(cancelMatchFn(),APP.alert.show("This match has expired. You will be returned to the Lobby."))},eachTick:function(){var countDown=`\n\t\t\t\t\t\t\tin <span class="bold text-gold">${this.getCountDown()}</span>\n\t\t\t\t\t\t`;$("#offerWaitTimer").html(countDown)},debugMode:!1,returnMinutes:!0};APP.lobby.timers.offerWaitTimer=new Timer(timerVars),APP.lobby.waitMatchListOn(),APP.lobby.data.reloaded&&APP.lobby.getOfferAcceptances()}},opponentSelected:{content:"\n\t\t\t\t<div id='lobby-header'>\n\t\t\t\t\tIt's opponentSelected\n\t\t\t\t</div>\n\t\t\t\t<div id='lobby-main'>\n\t\t\t\t\tNothing doing\n\t\t\t\t</div>\n\t\t\t",init:function(){}},filters:{content:function(){var content='\n\t\t\t\t\t<div id=\'lobby-header\'>\n\t\t\t\t\t\t<p>Set filters to help you find your perfect match</p>\n\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-back">\n\t\t\t\t\t\t\tBack\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id=\'lobby-main\'>\n\t\t\t\t\t\t<h4>Filters</h4>\n\t\t\t\t\t\t<div class="button button-menu button-gold round-corners" id="ol-filter-removeAll">\n\t\t\t\t\t\t\tReset Filters\n\t\t\t\t\t\t</div>\n\t\t\t\t';return APP.lobby.isChallengeLeagueFormat()||(content+='\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-gameType">\n\t\t\t\t\t\t\tGame Type\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-race">\n\t\t\t\t\t\t\tMatch Length\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-average">\n\t\t\t\t\t\t\tOpponent Average\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),null==APP.lobby.data.activeLeague&&(content+='\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-region">\n\t\t\t\t\t\t\tOpponent Region\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),content+='\n\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-vc">\n\t\t\t\t\t\tVideoConnect Status\n\t\t\t\t\t</div>\n\t\t\t\t',null!=APP.lobby.data.activeLeague&&(content+='\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="ol-filter-view">\n\t\t\t\t\t\t\tShow All Matches\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),content+="\n\t\t\t\t\t</div>\n\t\t\t\t"},init:function(){var data;APP.lobby.activateBtn("ol-back",(function(){APP.lobby.displayPage(1)})),data={id:"ol-filter-gameType",title:"Game Type",options:[{display:"501 SIDO",value:"501_SIDO"},{display:"Cricket",value:"cricket"},{display:"301 DIDO",value:"301_DIDO"}],defaultText:"Game Type",saveData:APP.lobby.data.filters.gameType,callback:function(val,display){APP.lobby.data.filters.gameType=-1!=val?val:null,APP.lobby.data.filters.oppoAvg&&(APP.lobby.data.filters.oppoAvg=null,$("#ol-filter-average").html("Opponent Average").removeClass("button-white").addClass("button-gray")),APP.lobby.save()}},APP.lobby.createOptions(data),data={id:"ol-filter-race",title:"Select Match Length",options:[{display:"Best of 1 - 3 Legs",value:"1-2"},{display:"Best of 5 - 7 Legs",value:"3-4"},{display:"Best of 9 - 11 Legs",value:"5-6"}],defaultText:"Match Length",saveData:APP.lobby.data.filters.race,callback:function(val,display){APP.lobby.data.filters.race=-1!=val?val:null,APP.lobby.save()}},APP.lobby.createOptions(data),data={id:"ol-filter-average",title:"Opponent Average",multiLevel:!0,options:function(){var data=APP.lobby.data.filters;return data.gameType?"cricket"==data.gameType?{isError:!1,options:[{display:"< 2 mpr",value:"0-2"},{display:"2 - 2.9 mpr",value:"2-3"},{display:"3 - 3.9 mpr",value:"3-4"},{display:"4+ mpr",value:"4-9"}]}:{isError:!1,options:[{display:"< 40 ppr",value:"0-40"},{display:"40 - 59 ppr",value:"40-60"},{display:"60 - 79 ppr",value:"60-80"},{display:"80+ ppr",value:"80-167"}]}:{isError:!0,errorMsg:"Please Select a Game Type First"}},defaultText:"Opponent Average",saveData:APP.lobby.data.filters.oppoAvg,callback:function(val,display){APP.lobby.data.filters.oppoAvg=-1!=val?val:null,APP.lobby.save()}},APP.lobby.createOptions(data),data={id:"ol-filter-region",title:"Select Opponent Region",options:[{display:"Asia",value:"asia"},{display:"Europe",value:"europe"},{display:"North America",value:"north_america"},{display:"Oceania",value:"oceania"},{display:"UK",value:"united_kingdom"},{display:"Rest of the World",value:"row"}],defaultText:"Opponent Region",saveData:APP.lobby.data.filters.region,callback:function(val,display){APP.lobby.data.filters.region=-1!=val?val:null,APP.lobby.save()}},APP.lobby.createOptions(data),data={id:"ol-filter-vc",title:"VideoConnect Status",options:[{display:"VC Required",value:"Active"},{display:"Don't show VC Players",value:"Inactive"}],defaultText:"VideoConnect Status",saveData:APP.lobby.data.filters.vc,callback:function(val,display){APP.lobby.data.filters.vc=-1!=val?val:null,APP.lobby.save()}},APP.lobby.createOptions(data);var league=APP.lobby.data.activeLeague;null!==league&&(data={id:"ol-filter-view",title:"View Matches",options:[{display:"Show My Division",value:"division"}],defaultText:"Show All Matches",saveData:APP.lobby.data.filters.view,callback:function(val,display){APP.lobby.data.filters.view=-1!=val?val:null,APP.lobby.save()}},"TEAM"===league.league_type&&data.options.push({display:"Show My Team",value:"team"}),APP.lobby.createOptions(data));$("#lobby-footer").empty().append('\n\t\t\t\t\t<div class="button button-menu button-green round-corners" id="olf-ready">\n\t\t\t\t\t\tFind Matches\n\t\t\t\t\t</div>\n\t\t\t\t').show(),APP.lobby.activateBtn("olf-ready",(function(){APP.lobby.displayPage(1)})),APP.lobby.activateBtn("ol-filter-removeAll",(function(){APP.lobby.clearFilters()}))}},leagues:{content:'\n\t\t\t\t<div id=\'lobby-header\'>\n\t\t\t\t\t<div class="button button-menu button-red round-corners" id="ol-back">\n\t\t\t\t\t\tExit to Global Lobby\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id=\'lobby-main\'>\n\n\t\t\t\t\t<h4>Select Your League</h4>\n\t\t\t\t\t<div id="ol-leagueList">\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t<h4 class="subheading" style="margin-top: 0;">\n\t\t\t\t\t\t\t<span class="text-gold">Don\'t see a lobby for one of your leagues?</span>\n\t\t\t\t\t\t</h4>\n\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\tYour league may have a different email address than your DartConnect Account\n\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t<div class="button button-menu button-gold round-corners" id="ol-lookup">\n\t\t\t\t\t\t\tCheck my Email\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<p style="margin-top: 0.67em;">\n\t\t\t\t\t\t\tCheck to see if your league has recently activated their lobby\n\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t<div class="button button-menu button-info round-corners" id="ol-update-leagues">\n\t\t\t\t\t\t\tCheck for Updates\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',init:function(){APP.lobby.buildLeagueDisplay(),APP.lobby.activateBtn("ol-lookup",(function(){APP.showIframePopOver("https://league.dartconnect.com/league-lookup","League Lookup")})),APP.lobby.activateBtn("ol-update-leagues",(function(){APP.lobby.updateLeagues()})),APP.lobby.activateBtn("ol-back",(function(){APP.lobby.displayPage(1)})),$("#popup-lobby .popup-title span").text("Private Match Lobbies")}}}},APP.qp2={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="qp2: ";message+=msg,console.log(message)}},init:function(pageNo){this.flowData.pageNo=pageNo||"gameMode",this.flow=new UIFlow(this.flowData),this.reset()},flow:null,data:{version:1,pageNo:0,mode:null,bot:{game:null,race:null,skill:null}},selector:null,reloadCheck:function(){this.log("Reload Check");var savedData=BBAT.fetchData("qp2_data");if(savedData){if(this.data.pageNo=savedData.pageNo,savedData.version!=this.data.version)return void this.updateDataStructure();this.data.pageNo>0&&"PRE-ROLE"==APP.mode&&(this.log("Show reloaded content"),this.init(this.data.pageNo))}},updateDataStructure:function(){var pageNo=this.data.pageNo;this.clear(),this.data.pageNo=pageNo,this.save(),APP.reload()},update:function(pageNo){this.data.pageNo=pageNo,this.save()},save:function(){BBAT.storeData({qp2_data:APP.qp2.data})},reset:function(){this.log("resetting data"),this.data.pageNo=0,this.data.mode=null,this.data.bot={game:null,race:null,skill:null},this.save()},clear:function(){this.reset(),BBAT.flushData("qp2_data")},fns:{setMode:function(mode){APP.qp2.data.mode=mode,APP.qp2.save()},getMode:function(){return APP.qp2.data.mode},handleQuickPlayButton:function(in_id){var legLength,gameType,closeFlow=!0;switch(in_id){case"qp2-qp-custom":APP.quickplay.customMatchMode();break;case"qp2-qp-501-3":APP.quickplay.play(0,1);break;case"qp2-qp-501-9":APP.quickplay.play(1,1);break;case"qp2-qp-cricket-3":APP.quickplay.play(2,2);break;case"qp2-qp-chicago-3":APP.quickplay.play(3);break;case"qp2-qp-bot-501-3":case"qp2-qp-bot-501-5":case"qp2-qp-bot-501-7":case"qp2-qp-bot-501-9":case"qp2-qp-bot-501-11":legLength=parseInt(in_id.split("-").pop()),gameType=in_id.split("-")[3],APP.qp2.data.bot.game=gameType,APP.qp2.data.bot.race=legLength,APP.qp2.flow.displayPage("selectBot"),closeFlow=!1;break;case"qp2-qp-bot-cricket-3":case"qp2-qp-bot-cricket-5":case"qp2-qp-bot-cricket-7":case"qp2-qp-bot-cricket-9":case"qp2-qp-bot-cricket-11":legLength=parseInt(in_id.split("-").pop()),gameType=in_id.split("-")[3],APP.qp2.data.bot.game=gameType,APP.qp2.data.bot.race=legLength,APP.qp2.flow.displayPage("selectBot"),closeFlow=!1;break;case"qp2-qp-bot-exact-3":case"qp2-qp-bot-exact-5":case"qp2-qp-bot-exact-7":case"qp2-qp-bot-exact-9":case"qp2-qp-bot-exact-11":legLength=parseInt(in_id.split("-").pop()),gameType=in_id.split("-")[3],APP.qp2.data.bot.game=gameType,APP.qp2.data.bot.race=legLength,APP.qp2.flow.displayPage("selectExactBot"),closeFlow=!1;break;default:APP.alert.show("No action for this button"),closeFlow=!1}closeFlow&&window.setTimeout((function(){APP.qp2.flow.exit()}),100)},createBotSpiceSelector:function(){for(var spices=[],spiceColours=["#ECFFD9","#D2F5B0","#B8EC86","#9EE25D","#97D43A","#B6BE29","#D5A917","#F49306","#FF7402","#FF5005","#FF2D07","#FF0A0A"],i=0;i<12;i++){var averageText=APP.dartbot.levels[i].ppr+" ppr";"cricket"==APP.qp2.data.bot.game&&(averageText=APP.dartbot.levels[i].mpr+" mpr");var level=APP.dartbot.levels[i],content=`\n\t\t\t\t\t<span class="bold">Level ${level.label}</span><br />\n\t\t\t\t\t<span class="subheader">${averageText}</span>\n\t\t\t\t`;spices.push({content:content,class:"dual-button-list round-corners button-white pSmTop pSmBottom",attr:[{style:"background-color: "+spiceColours[i]+" !important;"}],name:"skill-"+level.skill})}this.selector=new SpiceSelector({id:"qp2ss",ele:"#qp2-bot-spice-selector",min:1,max:1,spices:spices,defaultClass:"button-white",highlightClass:"button-white",callbacks:{preInit:function(){},postInit:function(){},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){for(var btns=document.querySelectorAll(self.ele.selector+" .button"),i=0;i<btns.length;i++)btns[i].classList.add("de-highlight");$("#"+selectedSpice).removeClass("de-highlight");var skill=parseFloat(selectedSpice.split("-").pop());APP.qp2.data.bot.skill=skill,$("#qp2-bot-start").removeClass("button-disabled")},deselected:function(self,selectedSpice){for(var btns=document.querySelectorAll(self.ele.selector+" .button"),i=0;i<btns.length;i++)btns[i].classList.remove("de-highlight");APP.qp2.data.bot.skill=null,$("#qp2-bot-start").addClass("button-disabled")},complete:function(self){},incomplete:function(self){}}})},createExactBotSpiceSelector:function(){var spices=[],spiceColours=["#B8EC86","#9EE25D","#97D43A","#B6BE29","#F49306","#FF7402","#FF5005","#FF0A0A"],exactBotLevels=[{botLevel:12,level:"15 Darts",average:"100",script:"darter15"},{botLevel:10,level:"18 Darts",average:"84",script:"darter18"},{botLevel:9,level:"21 Darts",average:"72",script:"darter21"},{botLevel:8,level:"24 Darts",average:"63",script:"darter24"},{botLevel:6,level:"27 Darts",average:"56",script:"darter27"},{botLevel:5,level:"30 Darts",average:"50",script:"darter30"},{botLevel:4,level:"33 Darts",average:"46",script:"darter33"},{botLevel:3,level:"36 Darts",average:"42",script:"darter36"}];exactBotLevels.reverse();for(var i=0;i<exactBotLevels.length;i++){var level=exactBotLevels[i],averageText=level.average+" ppr",content=`\n\t\t\t\t\t<span class="bold">Level ${level.botLevel}</span><br />\n\t\t\t\t\t<span class="subheader">${level.level} / ${averageText}</span>\n\t\t\t\t`;spices.push({content:content,class:"dual-button-list round-corners button-white pSmTop pSmBottom",attr:[{style:"background-color: "+spiceColours[i]+" !important;"}],name:"script-"+level.script})}this.selector=new SpiceSelector({id:"qp2eb",ele:"#qp2-exact-bot-spice-selector",min:1,max:1,spices:spices,defaultClass:"button-white",highlightClass:"button-white",callbacks:{preInit:function(){},postInit:function(){},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){for(var btns=document.querySelectorAll(self.ele.selector+" .button"),i=0;i<btns.length;i++)btns[i].classList.add("de-highlight");$("#"+selectedSpice).removeClass("de-highlight");var skill=selectedSpice.split("-").pop();APP.qp2.data.bot.skill=skill,$("#qp2-exact-bot-start").removeClass("button-disabled")},deselected:function(self,selectedSpice){for(var btns=document.querySelectorAll(self.ele.selector+" .button"),i=0;i<btns.length;i++)btns[i].classList.remove("de-highlight");APP.qp2.data.bot.skill=null,$("#qp2-exact-bot-start").addClass("button-disabled")},complete:function(self){},incomplete:function(self){}}})},enableBotOptions:function(){var adaptivePlay=APP.user_options.dartbot_adaptive_play,noDelay=APP.user_options.dartbot_quick_play,autoAlt=APP.user_options.dartbot_auto_alt_start;new RadioList({ele:"#qp2-bot-opt-adaptive-play",opts:[{content:"Bot skill level adjusts after each leg",name:"qp2BotOptAdaptivePlay",active:adaptivePlay}],callbacks:{selected:function(){APP.user_options.dartbot_adaptive_play=!0,APP.storeUserOptions()},deselected:function(r){APP.user_options.dartbot_adaptive_play=!1,APP.storeUserOptions()}}}),new RadioList({ele:"#qp2-bot-opt-no-delay",opts:[{content:"Bot throws immediately (no delay)",name:"qp2BotOptNoDelay",active:noDelay}],callbacks:{selected:function(){APP.user_options.dartbot_quick_play=!0,APP.storeUserOptions()},deselected:function(r){APP.user_options.dartbot_quick_play=!1,APP.storeUserOptions()}}}),new RadioList({ele:"#qp2-bot-opt-auto-alternate",opts:[{content:"Bot starts every other leg",name:"qp2BotOptAutoAlternate",active:autoAlt}],callbacks:{selected:function(){APP.user_options.dartbot_auto_alt_start=!0,APP.storeUserOptions()},deselected:function(r){APP.user_options.dartbot_auto_alt_start=!1,APP.storeUserOptions()}}})},startBotMatch:function(){var botSkill=APP.qp2.data.bot.skill,botGame=APP.qp2.data.bot.game,botRace=APP.qp2.data.bot.race,dcBotLevel=4;if(botSkill){var foundSkill=APP.findInObjArray("skill",APP.dartbot.levels,botSkill,!0)[0];foundSkill&&(dcBotLevel=foundSkill+1)}var dcGame=1;switch(botGame){case"501":case"exact":break;case"cricket":dcGame=2}var myMatchFormat={next_game:"ALTERNATE",same_game:"PER-MATCH",legs:{limit:botRace||5}};if("exact"==botGame){var darts=botSkill.replace(/\D/g,"");darts=parseInt(darts),APP.dartbot.enableExactBot(darts),dcBotLevel=-1}var matchFormat=APP.quickplay.createMatchMode(myMatchFormat,(function(){}));APP.quickplay.play(matchFormat,dcGame,dcBotLevel),APP.qp2.flow.exit()},loadBeta:function(){APP.qp2.flow.displayPage("confirmBeta")}}},APP.qp2.flowData={name:"qp2",pageNo:"playLocal",usePageNames:!0,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){APP.qp2.update(scope.data.pageNo)},exit:function(){APP.qp2.reset()}},pages:{gameMode:{hideFooter:!0,hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'qp2-game-mode\'>\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header mNoneTop mMdBottom">How do you want to play today?</h4>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-play-local">\n\t\t\t\t\t\t\t\t<span class="bold">Local Play</span><br />\n\t\t\t\t\t\t\t\tPlay with friends on the same device\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-play-bot">\n\t\t\t\t\t\t\t\t<span class="bold">vs. DC Bot</span><br />\n\t\t\t\t\t\t\t\tPlay against the Bot - you set the difficulty!\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-play-online">\n\t\t\t\t\t\t\t\t<span class="bold">Play Online</span><br />\n\t\t\t\t\t\t\t\tPlay friends or compete in the Global Lobby\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header text-left mNoneTop mMdBottom">Introducing DartConnect Preview</h4>\n\t\t\t\t\t\t\t\x3c!--<p class="text-left mMdBottom">Try the Preview App to test new and upcoming features!</p>--\x3e\n\n\t\t\t\t\t\t\t<div class="button-gold round-corners button button-qp2" id="qp2-play-beta">\n\t\t\t\t\t\t\t\t<span class="bold">Download DC Preview</span><br />\n\t\t\t\t\t\t\t\tReturn to DC Scoring App Anytime\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<p class="text-left">\n\t\t\t\t\t\t\t\t<span class="bold">What\'s New in Preview?</span><br />\n\t\t\t\t\t\t\t\tSupport for Special Board Types, including a Training Board and the <span class="bold">Harrows Quadro 240 Board!</span>\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.fns.activateBtn("qp2-play-local",(function(){scope.displayPage("playLocal")})),APP.fns.activateBtn("qp2-play-bot",(function(){scope.displayPage("playBot")})),APP.fns.activateBtn("qp2-play-online",(function(){APP.device.handleRoleSelection("drm-guest-connect"),scope.exit()})),APP.fns.activateBtn("qp2-play-beta",(function(){APP.qp2.fns.loadBeta()})),scope.ele.main.find(".popup-title span").text("Choose Game Mode")}},playLocal:{hideFooter:!0,content:function(){return'\n\t\t\t\t\t<div id=\'qp2-play-local\'>\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header text-left mNoneTop mSmBottom">Local Play</h4>\n\t\t\t\t\t\t\t<p class="text-left mMdBottom">Select a quick option or create a custom match format.</p>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-501-3">\n\t\t\t\t\t\t\t\t<span class="bold">Quick 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 3 legs</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-501-9">\n\t\t\t\t\t\t\t\t<span class="bold">Extended 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 9 legs</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-cricket-3">\n\t\t\t\t\t\t\t\t<span class="bold">Quick Cricket</span><br />\n\t\t\t\t\t\t\t\t<span class="subheader">Best of 3 legs</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-chicago-3">\n\t\t\t\t\t\t\t\t<span class="bold">Chicago</span>&nbsp;<span class="italic">(Game Choice)</span><br />\n\t\t\t\t\t\t\t\t<span class="subheader">Best of 3 legs</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button-gold round-corners button button-qp2 mNoneBottom" id="qp2-qp-custom">\n\t\t\t\t\t\t\t\t<span class="bold">Custom Match Menu</span><br />\n\t\t\t\t\t\t\t\t<span class="subheader">Create your own match rules</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){scope.goBackFn=function(){scope.displayPage("gameMode")};APP.fns.activateBtn(["qp2-qp-501-3","qp2-qp-501-9","qp2-qp-cricket-3","qp2-qp-chicago-3","qp2-qp-custom"],(function(btnId){APP.qp2.fns.handleQuickPlayButton(btnId)})),scope.ele.main.find(".popup-title span").text("Choose Game Mode")}},playBot:{hideFooter:!0,content:function(){return'\n\t\t\t\t\t<div id=\'qp2-play-bot\'>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<h4 class="header text-left mNoneTop mSmBottom">vs. DC Bot</h4>\n\t\t\t\t\t\t<p class="text-left mLgBottom">Choose your Bot Option.</p>\n\n\t\t\t\t\t\t<div class="accordion secondary mLgBottom">\n\t\t\t\t\t\t\t<div class="header button" id="dc-bot-501-accordion">\n\t\t\t\t\t\t\t\tDC Bot 501 Trainer\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t<p class="text-left text-left mMdBottom">Select your match length and then set the Bot difficulty</p>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-501-3">\n\t\t\t\t\t\t\t\t\t<span class="bold">Quick 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 3 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-501-5">\n\t\t\t\t\t\t\t\t\t<span class="bold">Classic 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 5 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-501-7">\n\t\t\t\t\t\t\t\t\t<span class="bold">Challenge 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 7 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-501-9">\n\t\t\t\t\t\t\t\t\t<span class="bold">Extended 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 9 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2 mNoneBottom" id="qp2-qp-bot-501-11">\n\t\t\t\t\t\t\t\t\t<span class="bold">Long Format 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 11 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="accordion secondary mLgBottom">\n\t\t\t\t\t\t\t<div class="header button" id="dc-bot-cricket-accordion">\n\t\t\t\t\t\t\t\tDC Bot Cricket Trainer\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t<p class="text-left text-left mMdBottom">Select your match length and then set the Bot difficulty</p>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-cricket-3">\n\t\t\t\t\t\t\t\t\t<span class="bold">Quick Cricket</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Best of 3 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-cricket-5">\n\t\t\t\t\t\t\t\t\t<span class="bold">Classic Cricket</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Best of 5 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-cricket-7">\n\t\t\t\t\t\t\t\t\t<span class="bold">Challenge Cricket</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Best of 7 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-cricket-9">\n\t\t\t\t\t\t\t\t\t<span class="bold">Extended Cricket</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Best of 9 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2 mNoneBottom" id="qp2-qp-bot-cricket-11">\n\t\t\t\t\t\t\t\t\t<span class="bold">Long Format Cricket</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Best of 11 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="accordion secondary mLgBottom">\n\t\t\t\t\t\t\t<div class="header button" id="dc-bot-exact-accordion">\n\t\t\t\t\t\t\t\tExact Bot 501 Trainer\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t<p class="text-left text-left mMdBottom"><span class="bold text-gold">NEW!</span> Select match length and then set Exact Bot to finish each leg with the same number of darts</p>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-exact-3">\n\t\t\t\t\t\t\t\t\t<span class="bold">Quick 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 3 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-exact-5">\n\t\t\t\t\t\t\t\t\t<span class="bold">Classic 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 5 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-exact-7">\n\t\t\t\t\t\t\t\t\t<span class="bold">Challenge 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 7 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2" id="qp2-qp-bot-exact-9">\n\t\t\t\t\t\t\t\t\t<span class="bold">Extended 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 9 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button-white round-corners button button-qp2 mNoneBottom" id="qp2-qp-bot-exact-11">\n\t\t\t\t\t\t\t\t\t<span class="bold">Long Format 501</span>&nbsp;<span class="italic">SIDO</span><br />\n\t\t\t\t\t\t\t\t\t<span class="subheader">Alternate start, Best of 11 legs</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.qp2.data.bot.game=null,APP.qp2.data.bot.race=null,APP.qp2.data.bot.skill=null,scope.goBackFn=function(){scope.displayPage("gameMode")};APP.fns.activateBtn(["dc-bot-501-accordion","dc-bot-cricket-accordion","dc-bot-exact-accordion"],APP.fns.toggleAccordion);APP.fns.activateBtn(["qp2-qp-bot-501-3","qp2-qp-bot-501-5","qp2-qp-bot-501-7","qp2-qp-bot-501-9","qp2-qp-bot-501-11","qp2-qp-bot-cricket-3","qp2-qp-bot-cricket-5","qp2-qp-bot-cricket-7","qp2-qp-bot-cricket-9","qp2-qp-bot-cricket-11","qp2-qp-bot-exact-3","qp2-qp-bot-exact-5","qp2-qp-bot-exact-7","qp2-qp-bot-exact-9","qp2-qp-bot-exact-11"],(function(btnId){APP.qp2.fns.handleQuickPlayButton(btnId)})),scope.ele.main.find(".popup-title span").text("Choose Game Mode")}},selectBot:{hideFooter:!1,content:function(){return'\n\t\t\t\t\t<div id=\'qp2-select-bot\'>\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header text-left mNoneTop mSmBottom">vs. DC Bot</h4>\n\t\t\t\t\t\t\t<p class="text-left mLgBottom">Select the skill level of the DC Bot</p>\n\t\t\t\t\t\t\t<div id="qp2-bot-spice-selector"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="qp2-bot-options">\n\t\t\t\t\t\t\t<div id="qp2-bot-opt-adaptive-play"></div>\n\t\t\t\t\t\t\t<div id="qp2-bot-opt-no-delay"></div>\n\t\t\t\t\t\t\t<div id="qp2-bot-opt-auto-alternate"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},addFooter:function(){APP.qp2.flow.ele.footerContent.empty().append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="qp2-bot-start"\n\t\t\t\t\t\t\t\t\tclass="button button-md button-center button-disabled button-green round-corners" \n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("qp2-bot-start",(function(){APP.qp2.fns.startBotMatch()}))},init:function(scope){this.addFooter(),scope.goBackFn=function(){scope.displayPage("playBot")},APP.qp2.fns.createBotSpiceSelector(),APP.qp2.fns.enableBotOptions(),scope.ele.main.find(".popup-title span").text("Choose Bot Difficulty")}},selectExactBot:{hideFooter:!1,content:function(){return'\n\t\t\t\t\t<div id=\'qp2-select-exact-bot\'>\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header text-left mNoneTop mSmBottom">vs. Exact Bot</h4>\n\t\t\t\t\t\t\t<p class="text-left mLgBottom">Select the number of darts for each leg of the match</p>\n\t\t\t\t\t\t\t<div id="qp2-exact-bot-spice-selector"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="qp2-bot-options">\n\t\t\t\t\t\t\t<div id="qp2-bot-opt-no-delay"></div>\n\t\t\t\t\t\t\t<div id="qp2-bot-opt-auto-alternate"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},addFooter:function(){APP.qp2.flow.ele.footerContent.empty().append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="qp2-exact-bot-start"\n\t\t\t\t\t\t\t\t\tclass="button button-md button-disabled button-green round-corners" \n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("qp2-exact-bot-start",(function(){APP.qp2.fns.startBotMatch()}))},init:function(scope){this.addFooter(),scope.goBackFn=function(){scope.displayPage("playBot")},APP.qp2.fns.createExactBotSpiceSelector(),APP.qp2.fns.enableBotOptions(),scope.ele.main.find(".popup-title span").text("Choose Bot Difficulty")}},confirmBeta:{content:function(){return'\n\t\t\t\t\t<div id=\'qp2-select-exact-bot\'>\n\t\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t\t<h4 class="header text-left mNoneTop mSmBottom">DartConnect Preview</h4>\n\t\t\t\t\t\t\t<p class="text-left mLgBottom">This will download a companion app to the DC Scoring App, called DC Preview (DCP). The DCP allows players to explore new features and games that are actively being developed and evaluated before formal integration into the Scoring App. Some features may not be migrated to the Scoring App and could eventually be removed from Preview.</p>\n\n\t\t\t\t\t\t\t<p class="text-left mLgBottom">While testing new features, players are encouraged to provide feedback and report bugs. This input is invaluable for product development and can help accelerate the formal release of features. Players can submit bug reports directly within the Preview app.</p>\n\n\t\t\t\t\t\t\t<p class="text-left mLgBottom">Participation in Preview is optional, and players can switch back to the Scoring App at any time. Game data from DCP can be temporary and Preview matches may be removed from member accounts.</p>\n\n\t\t\t\t\t\t\t<p class="text-left mLgBottom"><span class="bold">Note:</span> Match play in Preview is not available for formal competitions, such as tournaments and leagues.</p>\n\n\t\t\t\t\t\t\t<p class="text-left">You can return to the DC Scoring App at any time.</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},addFooter:function(scope){APP.qp2.flow.ele.footerContent.empty().append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="qp2-beta-cancel"\n\t\t\t\t\t\t\t\t\tclass="button button-md button-red round-corners" \n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="qp2-beta-confirm"\n\t\t\t\t\t\t\t\t\tclass="button button-md button-green round-corners" \n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tContinue\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("qp2-beta-cancel",(function(){scope.displayPage("gameMode")})),APP.fns.activateBtn("qp2-beta-confirm",(function(){scope.exit(),APP.loginLink.init(),APP.loginLink.switchApp()}))},init:function(scope){this.addFooter(scope),scope.goBackFn=function(){scope.displayPage("gameMode")},scope.ele.main.find(".popup-title span").text("DartConnect Preview")}}}},APP.qp3={flowData:null,init:function(){this.flow=new UIFlow(this.flowData)}},APP.qp3.flowData={name:"qp3",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{page1:{content:function(){return"\n\t\t\t\t\t<div id='qp3-main'>\n\t\t\t\t\t\t<div id=\"my-tab-test\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<p>This Content is not part of the tab code</p>\n\t\t\t\t\t</div>\n\t\t\t\t"},getHeader:function(){return"Second Pop Over"},init:function(scope){scope.ele.footer&&scope.ele.footer.hide();var contentArr=['\n\t\t\t\t\t<div id="qp3-radio-opt">Opt</div>\n\t\t\t\t\t<div id="qp3-radio-list">List</div>\n\n\t\t\t\t\tContent 1 Test\n\t\t\t\t\t<div>\n\t\t\t\t\t\tContent 1 internal div test\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion">\n\t\t\t\t\t\t<div class="header button" id="my-first-accordion">\n\t\t\t\t\t\t\tAccordion 1\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tAccordions and tabs can save a crazy amount of space\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t','\n\t\t\t\t\tContent 2 Test\n\t\t\t\t\t<div>\n\t\t\t\t\t\tContent 2 internal div test\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion invert-content">\n\t\t\t\t\t\t<div class="header button" id="my-second-accordion">\n\t\t\t\t\t\t\tAccordion 2\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tSee? Madness. Madness I tell you.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t','\n\t\t\t\t\tContent 3 Test\n\t\t\t\t\t<div>\n\t\t\t\t\t\tContent 3 internal div test\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion success">\n\t\t\t\t\t\t<div class="header button" id="success-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion primary">\n\t\t\t\t\t\t<div class="header button" id="primary-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion warning">\n\t\t\t\t\t\t<div class="header button" id="warning-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion danger">\n\t\t\t\t\t\t<div class="header button" id="danger-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion secondary">\n\t\t\t\t\t\t<div class="header button" id="secondary-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion info">\n\t\t\t\t\t\t<div class="header button" id="info-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="accordion default">\n\t\t\t\t\t\t<div class="header button" id="default-accordion">\n\t\t\t\t\t\t\tAccordion 3\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\tGo away now!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'];APP.fns.createMyTabs("#my-tab-test",["Header 1","Header 2","Header 3"],contentArr);APP.fns.activateBtn(["my-first-accordion","my-second-accordion","success-accordion","default-accordion","info-accordion","secondary-accordion","danger-accordion","warning-accordion","primary-accordion"],APP.fns.toggleAccordion);new RadioList({ele:"#qp3-radio-opt",opts:[{content:"This is an option",name:"opt1"}]}),new RadioList({ele:"#qp3-radio-list",opts:[{content:"This is a list (select one)",class:"success",name:"opt1_2"},{content:"This is a list (select one)",class:"primary",name:"opt2"},{content:"This is a list (select one)",class:"warning",name:"opt3"},{content:"This is a list (select one)",class:"danger",name:"opt4"},{content:"This is a list (select one)",class:"secondary",name:"opt5"},{content:"This is a list (select one)",class:"info",name:"opt6"},{content:"This is a list (select one)",class:"default",name:"opt7"},{content:"This is a list (select one)",class:"gray",name:"opt8"},{content:"This is a list (select one)",class:"gray-dark",name:"opt9"},{content:"This is a list (select one)",class:"outline",name:"opt10"}],callbacks:{preInit:function(){},postInit:function(){},exit:function(self){console.log(self.activeName)},selected:function(self){console.log(self.activeName+" has been selected")},deselected:function(self){console.log(self.activeName+" has been deselected")}}});APP.fns.activateBtn("qp3-link-2",(function(){scope.displayPage(2)})),scope.ele.main.find(".popup-title span").text("Second Pop Over")}}}},APP.message={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="Messages: ";message+=msg,console.log(message)}},queue:[],isActive:!1,init:function(msg,optionArr){if(this.log("Message Received"),this.isActive)return this.queue.push([msg,optionArr]),void this.log("Message added to queue");var isError=!1;msg.title&&msg.msg||(isError=!0,this.log("Title or Message missing")),isError?(this.log("Error parsing Message",!0),console.log(msg)):this.showMessage(msg,optionArr)},showMessage:function(msg,optionArr){this.log("Building Message");var params={title:msg.title,msg:msg.msg,use_close_icon:msg.use_close_icon};msg.on_show&&(params.post_display=msg.on_show);var closeFn=function(){APP.message.hide()},callback=function(){closeFn()};msg.on_close&&(callback=function(){msg.on_close(),closeFn()}),params.close=callback;var buildError=!1,options=null;if(optionArr&&(this.log("Building Options"),(options=this.buildOptions(optionArr))?params.msg+=options:buildError=!0),buildError)this.log("Error building Options",!0),console.log(optionArr);else if(APP.dialog.show(params),this.isActive=!0,this.log("Message Displayed"),options)for(var i=0;i<optionArr.length;i++){var option=optionArr[i];option.callback&&this.activateBtn("messageBtn"+i,option.callback,option.keep_open)}},hide:function(){this.log("Message Closed"),this.isActive=!1,APP.dialog.hide(),window.setTimeout((function(){APP.message.checkNext()}),100)},checkNext:function(){if(this.queue.length){this.log("Load next message from queue");var msg=this.queue.shift();this.init(msg[0],msg[1])}},buildOptions:function(options){var content="";try{for(var i=0;i<options.length;i++){var option=options[i];if(!option.title||!option.callback)return this.log("Malformed Option"),!1;content+=`\n\t\t\t\t\t<div class="button button-menu round-corners ${option.class_list}" id="messageBtn${i}">\n\t\t\t\t\t\t${option.title}\n\t\t\t\t\t</div>\n\t\t\t\t`}}catch(e){return console.log("Error in APP.messages (buildOptions)"),!1}return content},activateBtn:function(ids,callback,keepOpen){var newCallback;Array.isArray(ids)||(ids=[ids]),newCallback=keepOpen?callback:function(){callback(),APP.message.hide()},APP.device.addButtonHandler(ids,newCallback);for(var i=0;i<ids.length;i++){var id="#"+ids[i];APP.device.setButtonEvents(id)}},createOptions:function(data){var buttonIds;data?data.options?data.callback?data.title?(APP.dialog.show({title:data.title,msg:APP.fns.buildOptionBtns(data.options)}),buttonIds=APP.fns.createBtnIds(data.options),APP.fns.activateBtn(buttonIds,(function(e){var btn=$("#"+e),val=btn.attr("data-value"),display=btn.attr("data-display");data.callback(val,display),-1!=btn.attr("data-value")?$("#"+data.id).html(display).removeClass("button-gray").addClass("button-white"):$("#"+data.id).html(data.defaultText).removeClass("button-white").addClass("button-gray"),APP.dialog.hide()}))):this.log("Create Options - Check title"):this.log("Create Options - Check callback"):this.log("Create Options - Check options"):this.log("Create Options - No data passed")},userMessage:{init:function(){this.isConnected()?APP.message.showMessageTree():(APP.alert.show("You must be in an online match to use messaging"),this.changeBtn(!1))},changeBtn:function(isOnline){isOnline&&this.isConnected()?$("#reveal-message").attr("src","images/icon_message.png"):$("#reveal-message").attr("src","images/icon_message_disabled.png")},isConnected:function(){return APP.device.is_hosting||"PARTICIPANT"==APP.device.role}},helpMessage:{init:function(){var messages=APP.message.preMatchHelp;"IN-GAME"==APP.mode&&(messages=APP.message.liveMatchHelp),APP.message.showHelpMessages(messages)},changeBtn:function(isOnline){isOnline&&this.isConnected()?$("#reveal-message").attr("src","images/icon_message.png"):$("#reveal-message").attr("src","images/icon_message_disabled.png")},isConnected:function(){return APP.device.is_hosting||"PARTICIPANT"==APP.device.role}},showMessageTree:function(level){var msgs=APP.message.messageTree,options=[],title="Select Category";if(level){if(!msgs[level])return;msgs=msgs[level].messages,$.each(msgs,(function(key,value){var opt={display:value.message,value:key};options.push(opt)}));title="Select Message"}else $.each(msgs,(function(key,value){var opt={display:value.buttonText,value:key};options.push(opt)}));var data={title:title,options:options,callback:function(val){if(-1!=val)if(level){APP.message.log(`Send from Tree "${level}" - Message "${val}"`);var message={tree:level,message:val};APP.message.send.userMessage(message)}else window.setTimeout((function(){APP.message.showMessageTree(val)}),100)}};APP.message.createOptions(data)},showReplyTree:function(level,message){var msgs=APP.message.messageTree;if(msgs[level]&&msgs[level].messages[message]){for(var replies=(msgs=msgs[level].messages[message]).responses,options=[],i=0;i<replies.length;i++){var reply=replies[i],opt={display:reply,value:reply};options.push(opt)}var data={title:"Select Message",options:options,callback:function(val){if(-1!=val){APP.message.log(`Reply from Tree "${level} / ${message}" - Message "${val}"`);var replyMessage={tree:-1,message:val};APP.message.send.userMessage(replyMessage)}}};window.setTimeout((function(){APP.message.createOptions(data)}),100)}},messageTree:{niceDarts:{buttonText:"Nice Darts",messages:{wellDone:{message:"Great Shot!",responses:["Thanks","Got lucky","Boom!"]},unlucky:{message:"Tough Darts!",responses:["Thanks","Unlucky","I'll Get You Next time"]},thanks:{message:"Thanks for the Game!",responses:["You're welcome","Well Done!","Lets Play Again!","I'll Get You Next Time"]}}},matchStatus:{buttonText:"Match Status",messages:{youThere:{message:"Are you there?",responses:["Yes","I Need a Moment","Having Technical Issues","I Have to Quit"]},pause:{message:"I need to pause for two minutes",responses:["OK","Sorry, Can't Wait - I Quit"]},quit:{message:"Sorry, I need to quit the match",responses:["Ok","See you next time"]},badData:{message:"I Entered the Wrong Score!",responses:["You take control and correct it now","Correct it on your next turn","Too Late, it Needs to Stand"]}}},startSingle:{buttonText:"Start: Single Dart at Bull",messages:{miss:{message:"Miss",displayMessage:"Throw a single dart at the Bull.<br /> I missed",responses:["Miss - throw again","Single Bull (25) - I start","Double Bull (50) - I start"]},single:{message:"Single Bull (25)",displayMessage:"Throw a single dart at the Bull.<br /> I hit a Single Bull (25)",responses:["Miss - you start","Single Bull (25) - throw again","Double Bull (50) - I start"]},double:{message:"Double Bull (50)",displayMessage:"Throw a single dart at the Bull.<br /> I hit a Double Bull (50)",responses:["Miss - you start","Single Bull (25) - you start","Double Bull (50) - throw again"]}}},startMultiple:{buttonText:"Start: Throw 3 Darts at Bull",messages:{miss:{message:"Miss",displayMessage:"Throw Three Darts at the Bull.<br /> I missed",responses:["Miss - throw again","1 Bull - I start","2 Bulls - I start","3 Bulls - I start","4 Bulls - I start","5 Bulls - I start","6 Bulls - I start"]},one:{message:"1 Bull",displayMessage:"Throw Three Darts at the Bull.<br /> I hit 1 Bull",responses:["Miss - you start","1 Bull - throw again","2 Bulls - I start","3 Bulls - I start","4 Bulls - I start","5 Bulls - I start","6 Bulls - I start"]},two:{message:"2 Bulls",displayMessage:"Throw Three Darts at the Bull.<br /> I hit 2 Bulls",responses:["Miss - you start","1 Bull - you start","2 Bulls - throw again","3 Bulls - I start","4 Bulls - I start","5 Bulls - I start","6 Bulls - I start"]},three:{message:"3 Bulls",displayMessage:"Throw Three Darts at the Bull.<br /> I hit 3 Bulls",responses:["Miss - you start","1 Bull - you start","2 Bulls - you start","3 Bulls - throw again","4 Bulls - I start","5 Bulls - I start","6 Bulls - I start"]},four:{message:"4 Bulls",displayMessage:"Throw Three Darts at the Bull.<br /> I hit 4 Bulls",responses:["Miss - you start","1 Bull - you start","2 Bulls - you start","3 Bulls - you start","4 Bulls - throw again","5 Bulls - I start","6 Bulls - I start"]},five:{message:"5 Bulls",displayMessage:"Throw Three Darts at the Bull.<br /> I hit 5 Bulls",responses:["Miss - you start","1 Bull - you start","2 Bulls - you start","3 Bulls - you start","4 Bulls - you start","5 Bulls - throw again","6 Bulls - I start"]},six:{message:"6 Bulls",displayMessage:"Throw Three Darts at the Bull<br /> I hit 6 Bulls",responses:["Miss - you start","1 Bull - you start","2 Bulls - you start","3 Bulls - you start","4 Bulls - you start","5 Bulls - you start","6 Bulls - throw again"]}}},myVideoConnect:{buttonText:"My VideoConnect",messages:{canYouSee:{message:"Can you see my video?",responses:["Yes","No","Let's Try Refreshing VideoConnect"]},canYouHear:{message:"Can you hear me?",responses:["Yes","No","Let's Try Refreshing VideoConnect"]},areYouMuted:{message:"Are you on mute?",responses:["Yes","No"]}}},yourVideoConnect:{buttonText:"Your VideoConnect",messages:{cantSee:{message:"I can't see your video",responses:["Let's refresh VideoConnect","My camera is not working","Let's play without video?"]},cantHear:{message:"I can't hear you",responses:["Let's both refresh VideoConnect","My microphone is not working","Let's play without Audio"]}}}},showHelpMessages:function(tree){var msgs=tree,options=[];msgs=msgs.messages,$.each(msgs,(function(key,value){var opt={display:value.message,value:key};options.push(opt)}));var matchString="";try{matchString=APP.game.opponent[0].start_button_name+" Vs. "+APP.game.opponent[1].start_button_name}catch(e){}var data={title:"What help do you need?",options:options,callback:function(val){if("-1"!=val)if("lateOpponent"!=val){APP.message.log("Send from Helper Tree");var message={action:"HELP__MSG",message:{message:val},tournament_id:APP.session.getTournamentID(),board_number:APP.getMatch().bracket_board_id,event_id:APP.getMatch().bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:APP.getMatch().bracket_match_id};APP.message.send.helpMessage(message)}else window.setTimeout((function(){APP.message.showOpponentOptions()}),100)}};APP.message.createOptions(data)},showOpponentOptions:function(){var options=[],opt1={display:APP.game.opponent[0].start_button_name,value:"oppo1Late"},opt2={display:APP.game.opponent[1].start_button_name,value:"oppo2Late"};options.push(opt1),options.push(opt2),options.push({display:"All Players",value:"oppoBothLate"});var matchString="";try{matchString=APP.game.opponent[0].start_button_name+" Vs. "+APP.game.opponent[1].start_button_name}catch(e){}var data={title:"Which player is late?",options:options,callback:function(val){if("-1"!=val){var lateMsg={message:"lateOppo",responses:[],lateOppo:null};"oppo1Late"==val&&(lateMsg.lateOppo=APP.game.opponent[0].start_button_name),"oppo2Late"==val&&(lateMsg.lateOppo=APP.game.opponent[1].start_button_name),"oppoBothLate"==val&&(lateMsg.lateOppo="All Players"),APP.message.log("Send from Helper Tree");var message={action:"HELP__MSG",message:lateMsg,tournament_id:APP.session.getTournamentID(),board_number:APP.getMatch().bracket_board_id,event_id:APP.getMatch().bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:APP.getMatch().bracket_match_id};APP.message.send.helpMessage(message)}}};APP.message.createOptions(data)},preMatchHelp:{messages:{lateOpponent:{message:"Opponent is late to match",responses:[]},markerNeeded:{message:"Request a Marker for this Match",responses:[]},officialNeeded:{message:"Request an Event Official",responses:[]}}},liveMatchHelp:{messages:{scoringHelp:{message:"Correcting a Scoring Error",responses:[]},tabletHelp:{message:"Problems with Tablet/Program",responses:[]},officialNeeded:{message:"Request an Event Official",responses:[]}}},send:{userMessage:function(message){console.log(message);var data={member_id:APP.user.member_id,device_token:APP.device.token,action:"OPPONENT__MSG",title:"Incoming Message",msg:message};data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+JSON.stringify(error))};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?APP.message.log("Message Sent: "+JSON.stringify(message)):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){error("FAILED")}})},editMessage:function(editDetails){var data={member_id:APP.user.member_id,device_token:APP.device.token,action:"EDIT_MESSAGE",title:"Edit Notification",msg:editDetails};data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+error)};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?APP.message.log("Message Sent: "+JSON.stringify(editDetails)):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){error("FAILED")}})},tacticsMessage:function(){var msg="\n\t\t\t\tThe leg has been tied and will have to be replayed\n\t\t\t",data={member_id:APP.user.member_id,device_token:APP.device.token,action:"TACTICS_MESSAGE",title:"Game Notification",msg:msg};data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+msg)};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?APP.message.log("Message Sent: "):error(0,in_data.status_text)},error:function(in_a,in_b,in_c){error(0)}})},lobbyRematchMessage:function(type){var data={member_id:APP.user.member_id,device_token:APP.device.token};switch(type){case"offer":data.action="OFFER_LOBBY_REMATCH_MSG",data.title="Rematch Offer",data.msg="Would you like to play a rematch?";break;case"offer_guest":data.action="OFFER_LOBBY_REMATCH_GUEST_MSG",data.title="Rematch Offer",data.msg="Would you like to play a rematch?";break;case"accept":data.action="ACCEPT_LOBBY_REMATCH_MSG",data.title="Rematch Accepted",data.msg="Yes";break;case"decline":data.action="DECLINE_LOBBY_REMATCH_MSG",data.title="Rematch Declined",data.msg="No";break;case"accept_host":data.action="LOBBY_REMATCH_ACCEPTED_MSG",data.title="Rematch Accepted Host",data.msg="No";break;case"fail_host":data.action="LOBBY_REMATCH_FAILED_MSG",data.title="Rematch Failed",data.msg="Host cannot accept rematch"}data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+error)};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?APP.message.log("Message Sent: Rematch "+type):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){error("FAILED")}})},helpMessage:function(message){var data={member_id:APP.user.member_id,device_token:APP.device.token,action:"HELP__MSG",title:"Incoming Message",msg:message,broadcast_matches_id:APP.session.getMatchBroadcastID()};data=JSON.stringify(data);var url=APP.getApi2Url();url+="sendSosMsg";$.ajax({url:url,type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){if("OK"==in_data.status)!function(data){APP.message.log("Message Sent: "+message),APP.alert.show("Message sent");new Timer({name:"hideMessageAlertTimer",runTime:2,callback:function(){APP.alert.hide()},eachTick:function(){},debugMode:!1})}();else{var error="";in_data.status_text&&(error=in_data.status_text),APP.message.log("Message Failed: "+error),APP.alert.show("Message failed to send.<br />"+error);new Timer({name:"hideMessageAlertTimer",runTime:2,callback:function(){APP.alert.hide()},eachTick:function(){},debugMode:!1})}},error:function(in_a,in_b,in_c){!function(error,in_a,in_b,in_c){APP.message.log("Message Failed: "+error),APP.alert.show("Message failed to send. Please try again.");new Timer({name:"hideMessageAlertTimer",runTime:2,callback:function(){APP.alert.hide()},eachTick:function(){},debugMode:!1})}("FAILED")}})},playerLineUpSend:function(lineUpArr){var msg=lineUpArr;msg=JSON.stringify(msg);var data={member_id:APP.user.member_id,device_token:APP.device.token,action:"PLAYER_LINEUP_MSG",title:"Player lineup",msg:msg};data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+msg)};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?function(data){APP.message.log("Message Sent: "+data)}(in_data):error(0,in_data.status_text)},error:function(in_a,in_b,in_c){error(0)}})},playerLineUpConf:function(){var msg="Player Lineup Received",data={member_id:APP.user.member_id,device_token:APP.device.token,action:"PLAYER_LINEUP_MSG",title:"Player lineup",msg:msg};data=JSON.stringify(data);var error=function(error){APP.message.log("Message Failed: "+msg)};$.ajax({url:"/sendOpponentMsg",type:"POST",cache:!1,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){"OK"==in_data.status?APP.message.log("Message Sent: conf"):error(0,in_data.status_text)},error:function(in_a,in_b,in_c){error(0)}})}},receive:{userMessage:function(message){var msg=message.msg;if(-1===msg.tree){var msgObj={title:message.title,msg:`\n\t\t\t\t\t\t<h4 style="margin-top:0.67em">${message.msg.message}</h4>\n\t\t\t\t\t`};return optionArr=[{title:"Close",class_list:"button-red",callback:function(){}}],void APP.message.init(msgObj,optionArr)}if(msg.tree&&msg.message){var messages=APP.message.messageTree;if(messages[msg.tree]&&messages[msg.tree].messages[msg.message]){var displayMessage=messages[msg.tree].messages[msg.message].message;messages[msg.tree].messages[msg.message].displayMessage&&(displayMessage=messages[msg.tree].messages[msg.message].displayMessage);msgObj={title:message.title,msg:`\n\t\t\t\t\t<h4 style="margin-top:0.67em">${displayMessage}</h4>\n\t\t\t\t`};optionArr=[{title:"Reply",class_list:"button-green",callback:function(){APP.message.showReplyTree(msg.tree,msg.message)}},{title:"Close",class_list:"button-red",callback:function(){}}],APP.message.init(msgObj,optionArr)}}},editMessage:function(message){var editDetails=message.msg,round=editDetails.display_round,scoreFrom=editDetails.score_from,scoreTo=editDetails.score_to,whoGotEdited="";(whoGotEdited=APP.device.is_hosting?message.msg.side_edited?"Their":"Your":message.msg.side_edited?"Your":"Their",APP.device.is_hosting)&&(editDetails.edit_made_by="GUEST",editDetails.timestamp=new Date,APP.session.matches[APP.session.current_match].leg_score_edits.push(editDetails),APP.session.store(APP.session.current_match));var editNotification=`\n\t\t\t\t<p>\n\t\t\t\t\tYour Opponent changed a prior turn\n\t\t\t\t<p>\n\n\t\t\t\t<p>\n\t\t\t\t\t<span class="bold">${whoGotEdited}</span> score in <span class="bold">Round ${round}</span>\n\t\t\t\t</p>\n\n\t\t\t\t<p>\n\t\t\t\t\tWas changed from <span class="bold">${scoreFrom}</span> points to <span class="bold">${scoreTo}</span>\n\t\t\t\t</p>\n\t\t\t`;message={title:message.title,msg:editNotification},optionArr=[{title:"Dismiss",class_list:"button-green",callback:function(){}}],APP.message.init(message,optionArr)},tacticsMessage:function(message){var myMessage={title:message.title,msg:"<p>"+message.msg+"</p>"};optionArr=[{title:"Okay",class_list:"button-green",callback:function(){}}],APP.message.init(myMessage,optionArr)},lobbyRematchMessage:function(message){var msg,optionArr;switch(message.action){case"OFFER_LOBBY_REMATCH_GUEST_MSG":if(!APP.session.getMatchFormat())return void APP.message.send.lobbyRematchMessage("fail_host");msg={title:message.title,msg:"<p>"+message.msg+"</p>"},optionArr=[{title:"Play Rematch",class_list:"button-green",callback:function(){APP.lobby.startRematch()}},{title:"No Thanks",class_list:"button-red",callback:function(){APP.message.send.lobbyRematchMessage("decline")}}];break;case"LOBBY_REMATCH_FAILED_MSG":msg={title:message.title,msg:"<p>"+message.msg+"</p>"},optionArr=[{title:"Okay",class_list:"button-green",callback:function(){}}];break;default:msg={title:message.title,msg:"<p>"+message.msg+"</p>"},optionArr=[{title:"Play Rematch",class_list:"button-green",callback:function(){APP.message.send.lobbyRematchMessage("accept")}},{title:"No Thanks",class_list:"button-red",callback:function(){APP.message.send.lobbyRematchMessage("decline")}}]}APP.message.init(msg,optionArr)},playerLineUpMessage:function(message){APP.message.send.playerLineUpConf();var lineUp=JSON.parse(message.msg);APP.starpubs.saveReceivedLineUp(lineUp)}}},window.setTimeout((function(){}),5e3);var testbot={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="testbot: ";message+=msg,console.log(message)}},save:function(){BBAT.storeData({testbot_data:{matchData:testbot.matchData,pbPlayer:testbot.pbPlayer,pbLeg:testbot.pbLeg,pbSpeed:testbot.pbSpeed}})},clear:function(){BBAT.flushData("testbot_data")},isRunning:!1,hasStarted:!1,isActive:!1,isThrowing:!1,isFastForward:!1,matchData:null,turnData:null,isTap:!1,doStop:!1,pbPlayer:null,pbLeg:null,pbSpeed:null,pbType:"click",pbTotalTurns:0,pbSet:0,turnCounter:0,playTurn:function(){if(testbot.log("Attempting to play turn"),testbot.isActive)testbot.log("Already Active");else if(APP.device.has_chalk){if(!testbot.turnData)return testbot.say("I don't have any data to play with"),void testbot.stop();if(testbot.turnData.length){var turn;if(testbot.isActive=!0,"both"==testbot.pbPlayer){var startPlayer=0;testbot.matchData[testbot.pbLeg].game_data.opponent_order[1]||(startPlayer=1),startPlayer?testbot.turnCounter%2==0?(turn=testbot.turnData[1].shift(),testbot.log("Home Throws")):(turn=testbot.turnData[0].shift(),testbot.log("Away Throws")):testbot.turnCounter%2==0?(turn=testbot.turnData[0].shift(),testbot.log("Away Throws")):(turn=testbot.turnData[1].shift(),testbot.log("Home Throws"))}else turn=testbot.turnData.shift();if(!turn||testbot.turnIsFiller(turn)){if(testbot.isFastForward){var leg=testbot.matchData[testbot.pbLeg];if(leg.game_data.sudden_death_win)APP.game.winning_opponent=leg.game_data.winning_opponent,APP.game.sudden_death_win=!0,APP.game.finish(3),testbot.isFastForward=!1;else if(leg.game_data.winning_dart){var winningDart="#swdm-dart-"+leg.game_data.winning_dart;leg.game_data.winning_opponent||0===leg.game_data.winning_opponent?APP.game.winning_opponent=leg.game_data.winning_opponent:APP.game.winning_opponent=APP.game.current_opponent,testbot.emulateClick(winningDart),testbot.isFastForward=!1}}return testbot.log("No turn detected"),testbot.isActive=!1,void(testbot.isFastForward&&APP.ffwd.boombox.testbotError("inputs_complete"))}if(turn.user_input&&(turn.user_input.length||"BUST"==turn.color&&(turn.user_input=["BUST"])),!turn.user_input)return testbot.log("No user input detected for this turn"),testbot.isActive=!1,testbot.isFastForward?void APP.ffwd.boombox.testbotError("no_inputs"):void 0;if("both"==testbot.pbPlayer&&!turn.user_input.length){var isLastThrow=!1;if(testbot.turnCounter%2==0?testbot.turnData[0].length||(isLastThrow=!0):testbot.turnData[1].length||(isLastThrow=!0),isLastThrow)return testbot.log("Empty user input detected for this turn"),void(testbot.isActive=!1)}testbot.log("Playing Turn");for(var turnArr=[],i=0;i<turn.user_input.length;i++){var ele,dart=turn.user_input[i];if("Cricket"==APP.game.name)"0"==dart?turnArr.push("#mb-ig-funcr"):(ele="#"+(dart="sb-c-b"+dart),$(ele).length?turnArr.push(ele):testbot.log("No action available for: "+ele),i==turn.user_input.length-1&&turnArr.push("#mb-ig-funcr"));else switch(0==dart&&(dart="MISS"),dart){case"MISS":ele="#mb-ig-funcr",turnArr.push(ele);break;case"BUST":ele="BUST",turnArr.push(ele);break;default:for(var j=0;j<dart.length;j++){switch(dart[j]){case"+":ele="#kp-p-plus";break;case"x":ele="#kp-p-times";break;default:ele="#kp-p-0"+dart[j]}turnArr.push(ele)}turnArr.push("#mb-ig-funcr")}}if(testbot.isFastForward){var msg=`\n\t\t\t\tRestoring Turn <span class="bold">${testbot.turnCounter+1}</span> of  <span class="bold">${testbot.pbTotalTurns}</span><br />\n\t\t\t`;$("#ffwd-progress").html(msg)}testbot.throwQueue=turnArr,testbot.log(turnArr),testbot.clickAction()}else testbot.log("No turns to play")}else testbot.log("I don't have the chalk")},turnIsFiller:function(turn){try{if(null!==turn.current_score)return!1;if(turn.user_input&&!turn.user_input.length)return!0}catch(e){}return!1},throwQueue:[],clickAction:function(){var ele;testbot.throwQueue.length&&(ele=testbot.throwQueue.shift(),testbot.isThrowing||(testbot.isThrowing=!0,window.setTimeout((function(){testbot.isTap?testbot.emulateTap(ele):testbot.emulateClick(ele)}),testbot.getSingleDelay())))},emulateClick:function(ele){var clickTimeOut=50,enterTimeOut=500;testbot.isFastForward&&(clickTimeOut=1,enterTimeOut=1);var isBust=!1;"BUST"==ele&&(isBust=!0,ele="#kp-p-00"),window.setTimeout((function(){var e=new Event("mousedown");$(ele)[0].dispatchEvent(e)}),clickTimeOut),window.setTimeout((function(){var e=new Event("mouseup");$(ele)[0].dispatchEvent(e),testbot.isThrowing=!1,"#mb-ig-funcr"==ele||isBust?window.setTimeout((function(){testbot.turnCounter++,testbot.isActive=!1}),enterTimeOut):testbot.throwQueue.length&&testbot.clickAction()}),clickTimeOut)},emulateTap:function(ele){window.setTimeout((function(){var e=new Event("touchstart");$(ele)[0].dispatchEvent(e)}),50),window.setTimeout((function(){var e=new Event("touchend");$(ele)[0].dispatchEvent(e),testbot.isThrowing=!1,"#mb-ig-funcr"==ele?window.setTimeout((function(){testbot.turnCounter++,testbot.isActive=!1}),500):testbot.throwQueue.length&&testbot.clickAction()}),50)},getSingleDelay:function(){switch(testbot.pbSpeed){case"instant":return 100;case"slow":return 1e3;case"quick":default:return 500}},getThrowDelay:function(){switch(testbot.pbSpeed){case"instant":return 0;case"slow":return 2e3;case"quick":default:return 1e3}},init:function(){var savedData=BBAT.fetchData("testbot_data");savedData&&(testbot.matchData=savedData.matchData,void 0!==savedData.pbLeg&&(testbot.pbLeg=savedData.pbLeg),savedData.pbPlayer&&(testbot.pbPlayer=savedData.pbPlayer),savedData.pbSpeed&&(testbot.pbSpeed=savedData.pbSpeed),savedData.pbType&&(testbot.pbType=savedData.pbType));var tbIsAvailable="test"==APP.location||"dev"==APP.location||savedData;APP.beta&&(tbIsAvailable=!1),tbIsAvailable&&(testbot.build.main(),"PRE-ROLE"==APP.mode&&testbot.build.gameLoader())},build:{main:function(){if("IN-GAME"===APP.mode&&!$("#testbot-btn").length){$("#hdr-logo").remove();$("#hdr-center").prepend('\n\t\t\t\t<div id="testbot-btn" style="font-size: 280%;padding: 10px;"></div>\n\t\t\t'),$("#testbot-btn").click((function(){testbot.hasStarted?testbot.isRunning?testbot.stop():testbot.resume():testbot.startWizard()}))}},gameLoader:function(){if("IN-GAME"!=APP.mode&&!$("#testbot-loader-btn").length){$("#drm-practice").append('\n\t\t\t\t<div id="testbot-loader-btn" class="button" style="display: inline-block;"></div>\n\t\t\t'),APP.fns.activateBtn("testbot-loader-btn",(function(){testbot.loadGame()}))}},popUp:function(){testbot.pbLeg=APP.getMatch().game_count;$("#testbot-content").html('\n\t\t\t\t<div class="button button-menu button-gray round-corners" id="tb-player-type">\n\t\t\t\t\tWho is Test Bot Playing As?\n\t\t\t\t</div>\n\t\t\t\t<div class="button button-menu button-gray round-corners" id="tb-leg-number">\n\t\t\t\t\tWhich Leg is Test Bot Playing?\n\t\t\t\t</div>\n\t\t\t\t<div class="button button-menu button-gray round-corners" id="tb-speed">\n\t\t\t\t\tWhat Speed do you want to Play?\n\t\t\t\t</div>\n\t\t\t'),data={id:"tb-player-type",title:"Which Player?",options:[{display:"Home",value:"home"},{display:"Away",value:"away"},{display:"Both",value:"both"}],defaultText:"Who is Test Bot Playing As",saveData:testbot.pbPlayer,callback:function(val,display){testbot.pbPlayer=-1!=val?val:null,testbot.save()}},APP.fns.createOptions(data);for(var options=[],i=0;i<testbot.matchData.length;i++)options.push({display:"Leg "+(i+1),value:i,class:"button button-gray round-corners tb-leg-btn"});data={id:"tb-leg-number",title:"Which Leg?",options:options,defaultText:"Which Leg is Test Bot Playing?",saveData:testbot.pbLeg,callback:function(val,display){testbot.pbLeg=-1!=val?parseFloat(val):null,testbot.save()},onLoad:function(){$("#dialog-message").wrapInner('<div id="tb-leg-wrap" />');var predictedLeg=APP.getMatch().game_count,predictedLegBtn=$(".tb-leg-btn")[predictedLeg];predictedLegBtn&&($("#tb-leg-wrap").prepend($(predictedLegBtn)),$(predictedLegBtn).removeClass("button-gray").removeClass("tb-leg-btn").addClass("button-green").addClass("button-menu"))}},APP.fns.createOptions(data),data={id:"tb-speed",title:"What Speed?",options:[{display:"Adderall",value:"instant"},{display:"Ricky Evans",value:"quick"},{display:"Justin Pipe",value:"slow"}],defaultText:"Who is Test Bot Playing As",saveData:testbot.pbSpeed,callback:function(val,display){testbot.pbSpeed=-1!=val?val:null,testbot.save()}},APP.fns.createOptions(data);$("#testbot-footer").empty().append('\n\t\t\t\t<div class="button button-menu button-green round-corners" id="tb-ready">\n\t\t\t\t\tStart Test Bot\n\t\t\t\t</div>\n\t\t\t').show(),APP.popup.show("popup-testbot"),testbot.build.fixScroll(),APP.device.addButtonHandler(["testbot-btn-close"],(function(){APP.popup.hide("popup-testbot")})),APP.fns.activateBtn(["tb-ready"],(function(){testbot.log("Let's Go, Eskimo!"),isNaN(testbot.pbLeg)?testbot.say("You need to select a leg to play"):testbot.pbPlayer?testbot.pbSpeed?(APP.popup.hide("popup-testbot"),testbot.prepData()):testbot.say("You need to select a speed"):testbot.say("You need to select a player")}))},fixScroll:function(){var sbh=$("#popup-testbot").outerHeight(!0)-$("#popup-testbot .popup-title").outerHeight(!0)-2*Math.ceil(parseFloat($("#testbot-scroll-box").css("padding-top")));sbh-=$("#testbot-footer").outerHeight(!0),$("#testbot-scroll-box").css("max-height",sbh),$("#testbot-scroll-box").css("min-height",sbh),$("#testbot-scroll-box").on("touchstart touchend touchmove",(function(e){var sb=$("#testbot-scroll-box"),l=$("#testbot-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0}))}},startWizard:function(){if(testbot.matchData)testbot.confirm("You already have saved data - do you want to use this match?",(function(){APP.confirm.hide(),testbot.build.popUp()}),(function(){APP.confirm.hide(),testbot.matchData=null,testbot.save(),testbot.startWizard()}));else{testbot.log("Start Wizard");APP.confirm.show({msg:"*<span class='bold'>Bleep Bloop</span>*<br />Do you want to wipe this tablet?",ok:function(){localStorage.clear(),location.reload()}})}},loadGame:function(){testbot.log("Start Game Loader");var match=prompt("*Bleep Bloop* - What's the Match Format JSON?"),matchFormat;if(!match)return testbot.isFastForward?void APP.ffwd.boombox.testbotError("match_format"):void testbot.say("I need a match format to work");try{matchFormat=eval("("+match+")")}catch(e){if(testbot.isFastForward)return void APP.ffwd.boombox.testbotError("match_format");testbot.say("Invalid Match Format")}matchFormat&&APP.quickplay.startTestFormat(matchFormat)},prepData:function(){try{var leg=testbot.matchData[testbot.pbLeg];if("Cricket"!==APP.game.name){if(leg.game_data.options&&leg.game_data.options.starting_score!=APP.game.options.starting_score)return testbot.isFastForward?void APP.ffwd.boombox.testbotError("leg_type"):void testbot.say(`\n\t\t\t\t\t\t\tThe saved leg is ${leg.game_data.name}, but this match is ${APP.game.options.starting_score}. I can't play this leg!\n\t\t\t\t\t\t`);try{if(leg.game_data.options){var handicaps=[0,0];try{handicaps=[leg.game_data.opponents[0].handicap,leg.game_data.opponents[1].handicap]}catch(e){}testbot.log("Handicaps: "+handicaps),handicaps[0]&&APP.game.opponent[0].setHandicap(handicaps[0]),handicaps[1]&&APP.game.opponent[1].setHandicap(handicaps[1]),APP.header.refresh()}}catch(e){}}else if(leg.game_data.type!==APP.game.name)return testbot.isFastForward?void APP.ffwd.boombox.testbotError("leg_type"):void testbot.say(`\n\t\t\t\t\t\tThe saved leg is ${leg.game_data.name}, but this match is ${APP.game.name}. I can't play this leg!\n\t\t\t\t\t`);if(leg.game_data&&leg.game_data.winning_dart){var winningDart=leg.game_data.winning_dart;$(".swdm-dart").each((function(){-1==$(this).attr("id").indexOf(winningDart)&&$(this).addClass("hide")}))}var turnData=[];switch(testbot.pbPlayer){case"home":turnData=leg.game_data.opponents[0].turns,testbot.pbTotalTurns=leg.game_data.opponents[0].turns.length;break;case"away":turnData=leg.game_data.opponents[1].turns,testbot.pbTotalTurns=leg.game_data.opponents[1].turns.length;break;case"both":turnData.push(leg.game_data.opponents[0].turns),turnData.push(leg.game_data.opponents[1].turns),testbot.pbTotalTurns=leg.game_data.opponents[0].turns.length+leg.game_data.opponents[1].turns.length}testbot.turnData=turnData,leg.game_data.opponent_order[0]!==APP.game.opponent_order[0]&&(APP.game.opponent_order.reverse(),APP.game.current_opponent=APP.game.opponent_order[0],APP.game.active_opponent=APP.game.current_opponent,APP.header.refresh()),testbot.isFastForward&&APP.fns.appendToMatch({var:"fast_forwarded",val:!0}),testbot.run(),testbot.isRunning=!0,testbot.hasStarted=!0}catch(e){return testbot.isFastForward?void APP.ffwd.boombox.testbotError("general_error"):void testbot.say("I couldn't play this leg. Please report this to my creator!")}},getData:function(matchId){$.ajax({method:"POST",url:"/corsform/getMatchLegs",data:{match_id:matchId}}).done((function(resp){try{resp=JSON.parse(resp)}catch(e){return void testbot.say("I couldn't figure that match out")}resp.payload&&resp.payload.length?(testbot.matchData=resp.payload,testbot.save(),testbot.build.popUp()):testbot.say("That match appears to have no leg data")}))},start:function(){testbot.doStop=!1,window.setTimeout((function(){testbot.run()}),testbot.getSingleDelay())},run:function(){testbot.doStop?testbot.log("Stopped"):(testbot.playTurn(),window.setTimeout((function(){testbot.run()}),testbot.getThrowDelay()))},stop:function(){testbot.doStop=!0,testbot.isRunning=!1,$("#testbot-btn").html("")},resume:function(){testbot.doStop=!1,testbot.isRunning=!0,testbot.run(),$("#testbot-btn").html("")},say:function(message){APP.alert.show("*<span class='bold'>Bleep Bloop</span>*<br />"+message)},confirm:function(message,ok,cancel){ok||(ok=function(){}),cancel||(cancel=function(){}),APP.confirm.show({msg:"*<span class='bold'>Bleep Bloop</span>*<br />"+message,ok:function(){ok()},cancel:function(){cancel()}})},loadExcelReader:function(){this.getJsZip()},getJsZip:function(){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js",(function(){console.log("js zip loaded"),testbot.getXlsx()}))},getXlsx:function(){$.getScript("https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js",(function(){console.log("xlsx loaded"),testbot.enableFileImport()}))},enableFileImport:function(){$("#debug-description").after("<input type='file' id='excel-import' />");var styleSheet=document.createElement("style");styleSheet.innerText="\n\t\t\t#excel-import {\n\t\t\t\tborder: 1px solid red;\n\t\t\t\twidth: 100%;\n\t\t\t\tmargin: 0 auto;\n\t\t\t\ttext-align: center;\n\t\t\t\tpadding: 20px 0;\n\t\t\t\tmargin: 20px 0;\n\t\t\t\tbackground: red;\n\t\t\t}\n\t\t",document.head.appendChild(styleSheet),document.getElementById("excel-import").addEventListener("change",(function(r){testbot.excelToJSON(r)}),!1)},excelToJSON:function(file){var i,j;file=file.target.files[0];var reader=new FileReader;reader.onload=function(e){var data=e.target.result,workbook=XLSX.read(data,{type:"binary"});for(i=0;i<workbook.SheetNames.length;i++){var sheetName=workbook.SheetNames[i],worksheet=workbook.Sheets[sheetName],rowMajor=XLSX.utils.sheet_to_json(worksheet,{header:1}),rawTransposed=[];for(j=0;j<rowMajor.length;j++){rawTransposed[j]=[];for(var k=0;k<rowMajor[j].length;k++)rawTransposed[j].push(rowMajor[j][k])}var transposed=[];for(j=0;j<rawTransposed.length;j++){var row=rawTransposed[j];row.length&&transposed.push(row)}testbot.buildPlayByPlay(transposed)}reader.onerror=function(ex){alert("This sheet could not be parsed"),console.log(ex)}},reader.readAsBinaryString(file)},buildPlayByPlay:function(matchArr){try{var i,j,turn,turnObj,score1="",score2="";for(i=0;i<matchArr.length;i++){(row=matchArr[i])&&row.length&&(row[0]&&(row[0]+="",-1!==row[0].indexOf("Set 1 :")&&(row[1]&&(score1=" ("+row[1]+")"),row[2]&&(score2=" ("+row[2]+")"))))}var startingPlayer=-1,legBreakDown=[],hasMatchData=!1;for(i=0;i<matchArr.length;i++){var row=matchArr[i];hasMatchData&&row.length&&2!=row.length&&legBreakDown.push(row),"Leg Breakdown"==row[0]&&(hasMatchData=!0)}if(!legBreakDown.length)return void alert("This sheet could not be parsed");var matchData=[],player1={chalkboard_name:"ROBO",first_name:"ROBO",last_name:"--"},player2={chalkboard_name:"ROBO",first_name:"ROBO",last_name:"--"},player1Name=legBreakDown[0][0];player1Name=player1Name.split("(")[0],player1.last_name=player1Name;var player2Name=legBreakDown[1][0];player2Name=player2Name.split("(")[0],player2.last_name=player2Name;var gameIndex=0;for(i=0;i<legBreakDown.length;i+=2){var leg1=legBreakDown[i],leg2=legBreakDown[i+1],dartsThrown1=leg1[0].split("(")[1];dartsThrown1=dartsThrown1.split(")")[0],dartsThrown1=parseFloat(dartsThrown1),0==(dartsThrown1%=3)&&(dartsThrown1=3);var dartsThrown2=leg2[0].split("(")[1];dartsThrown2=dartsThrown2.split(")")[0],dartsThrown2=parseFloat(dartsThrown2),0==(dartsThrown2%=3)&&(dartsThrown2=3);var turnArr1=[],turnArr2=[],winningDart=0,winningOpponent=0;for(j=1;j<leg1.length;j++)"..."!=(turn=leg1[j])?(turnObj={points:turn,user_input:[turn]},j==leg1.length-1&&(turnObj.darts_thrown=dartsThrown1,winningDart=dartsThrown1,winningOpponent=0),turnArr1.push(turnObj)):0==i&&1==j&&(startingPlayer=1);for(j=1;j<leg2.length;j++)"..."!=(turn=leg2[j])?(turnObj={points:turn,user_input:[turn]},j==leg2.length-1&&(turnObj.darts_thrown=dartsThrown2,winningDart=dartsThrown2,winningOpponent=1),turnArr2.push(turnObj)):0==i&&1==j&&(startingPlayer=0);var oppoOrder=[0,1];"..."==leg1[1]&&(oppoOrder=[1,0]);var legObj={game_index:gameIndex,set_index:0,game_data:{opponent_order:oppoOrder,opponents:[{team:{players:[player1]},turns:turnArr1},{team:{players:[player2]},turns:turnArr2}],winning_dart:winningDart,winning_opponent:winningOpponent,name:"501",type:"01"}};matchData.push(legObj),gameIndex++}testbot.matchData=matchData,testbot.save();var p1Class="",p2Class="";-1!==startingPlayer&&(startingPlayer?p2Class="text-green":p1Class="text-green"),$("#debug").hide(0),APP.alert.show(`\n\t\t\t\tMatch Data Ready! <br />\n\t\t\t\t<hr />\n\t\t\t\t<span class="bold ${p1Class}">${player1.last_name}${score1}</span><br />\n\t\t\t\tvs.<br />\n\t\t\t\t<span class="bold ${p2Class}">${player2.last_name}${score2}</span>\n\t\t\t`),$("#alert-ok").html("Please wait&hellip;"),$("#alert-ok").addClass("button-disabled");new Timer({name:"tbUpdateCheckTimer",forceClose:!0,runTime:5,callback:function(){$("#alert-ok").html("OK"),$("#alert-ok").removeClass("button-disabled")},eachTick:function(){$("#alert-ok").html("Please Wait ("+this.getCountDown()+")")},debugMode:!1})}catch(e){alert("This sheet could not be parsed"),console.log(e)}}},testClick={clickedEles:[],visibleEles:[],paused:!1,blockedEles:["testbot-btn","reveal-reset"],getAllVisibleEles:function(){for(var allEles=document.querySelectorAll("[id]"),i=0;i<allEles.length;i++){var ele=allEles[i];$(ele).is(":visible")&&-1==testClick.blockedEles.indexOf($(ele).attr("id"))&&testClick.visibleEles.push($(ele).attr("id"))}},getRandVisibleEle:function(){var max=testClick.visibleEles.length-1,rand=Math.floor(Math.random()*(max-0+1)+0);return testClick.visibleEles[rand]},doFakePress:function(){var ele=testClick.getRandVisibleEle();testClick.clickedEles.push(ele),BBAT.storeData({testclick_data:JSON.stringify(testClick.clickedEles)}),Math.floor(10*Math.random())%2==0?testbot.emulateTap("#"+ele):testbot.emulateClick("#"+ele)},startFakePressing:function(){window.setTimeout((function(){testClick.paused||(testClick.getAllVisibleEles(),testClick.doFakePress(),testClick.startFakePressing())}),500)},stop:function(){testClick.paused=!0,testClickReplay.listSavedClicks()},init:function(){testClick.startFakePressing()}},testClickReplay={rightArrowPressed:!1,autoForwardReplay:!0,replayEles:[],doFakePress:function(ele){if(!ele)return console.log("Couldn't find ele"),!1;Math.floor(10*Math.random())%2==0?testbot.emulateTap("#"+ele):testbot.emulateClick("#"+ele)},startFakePressing:function(){window.setTimeout((function(){if(!testClickReplay.autoForwardReplay){if(!testClickReplay.rightArrowPressed)return void testClickReplay.startFakePressing();testClickReplay.rightArrowPressed=!1,console.log("Click Right Arrow to move forward")}var ele=testClickReplay.replayEles.shift();testClickReplay.doFakePress(ele),console.log("Clicked: #"+ele),testClickReplay.replayEles.length?testClickReplay.startFakePressing():testbot.say("Clicks finished")}),500)},init:function(rightArrowForward){rightArrowForward&&(testClickReplay.autoForwardReplay=!1,testClickReplay.rightArrowPressed=!0,document.addEventListener("keydown",(function(event){"ArrowRight"==event.key&&(testClickReplay.rightArrowPressed=!0)})));var savedClicks=BBAT.fetchData("testclick_data");savedClicks?(testClickReplay.replayEles=JSON.parse(savedClicks),testClickReplay.startFakePressing()):testbot.say("No Click Array to replay")},listSavedClicks:function(){var savedClicks=BBAT.fetchData("testclick_data");savedClicks?(testClickReplay.replayEles=JSON.parse(savedClicks),console.table(testClickReplay.replayEles)):testbot.say("No Click Array to log")}},advLog={enabled:!1,inited:!1,processing:!1,shrinkLog:!0,watchLog:!1,debugLog:!1,localOnly:!1,init:function(){if(advLog.checkTournament()&&(advLog.enabled=!0),advLog.checkIsLeague()&&(advLog.enabled=!0),advLog.enabled){var savedData=BBAT.fetchData("advlog_data");savedData&&(advLog.data=savedData);var savedLogs=BBAT.fetchData("advlog_logs");savedLogs&&(advLog.logs=savedLogs),advLog.inited=!0,advLog.startTimer()}else advLog.clear()},save:function(){BBAT.storeData({advlog_data:advLog.data,advlog_logs:advLog.logs})},clear:function(){advLog.data=[],advLog.logs=[],BBAT.flushData("advlog_data"),BBAT.flushData("advlog_logs"),advLog.save()},data:[],logs:[],doLog:function(obj){try{if(advLog.watchLog&&console.log(obj),advLog.debugLog,obj.timestamp=new Date,obj=advLog.deflateLog(obj),advLog.data.push(obj),advLog.save(),obj.data){var eol=!1;APP.device.has_chalk?void 0!==obj.data.match_summary&&(eol=!0):void 0!==obj.data.winning_opponent&&(eol=!0),eol&&obj.type.indexOf("Process")}}catch(e){}},completeLog:function(){try{if(advLog.enabled){if(!advLog.data.length)return;var obj={role:APP.device.role,game_id:APP.server.game_id,match_guid:APP.getMatch().match_guid,device_token:APP.device.token,member_id:APP.user.member_id,data:advLog.data};advLog.logs.push(obj),advLog.data=[],advLog.save()}}catch(e){}},sendLog:function(){if(!advLog.localOnly)try{if(APP.isOffline())return;var data=advLog.logs[0];data=JSON.stringify(data);var url="";switch(window.location.hostname){case"app.dartconnect.com":url="https://logs.dartconnect.com";break;case"testapp.dartconnect.red":url="https://testlogs.dartconnect.red";break;case"train.app.dartconnect.com":url="https://train.logs.dartconnect.com";break;case"dev.app.dartconnect.red":url="https://dev.logs.dartconnect.red";break;default:url=""}url+="/corsapi/scoringAppDebugLog",$.ajax({url:url,type:"POST",cache:!1,timeout:0,dataType:"json",data:data,success:function(data){advLog.processing=!1,advLog.logs.splice(0,1),advLog.save(),advLog.logs.length&&advLog.startTimer()},error:function(){advLog.processing=!1;var failLog=advLog.logs.splice(0,1)[0];advLog.logs.push(failLog),advLog.save(),advLog.logs.length&&advLog.startTimer(!0)}})}catch(e){}},startTimer:function(ext){if(!advLog.processing&&advLog.logs.length){advLog.processing=!0;var attemptTime=4e3;ext&&(attemptTime=8e3),window.setTimeout((function(){advLog.sendLog()}),attemptTime)}},startNewMatch:function(){advLog.enabled&&(advLog.data=[],advLog.save())},checkTournament:function(){try{var storedTournament=BBAT.fetchData("bracket");if(storedTournament)switch(storedTournament.tournament_id){case"ddd02":case"dpflonlineleague5":return!0}location.host.split(".")[0]}catch(e){}return!1},checkIsLeague:function(){try{if(APP.session.isLeaguePlay())return!0;if(APP.nlf.data.league)return!0}catch(e){}return!1},deflateLog:function(data){if(!advLog.shrinkLog)return data;try{var shortData={};data.type&&(shortData.ty=data.type),data.cmd&&(shortData.cm=data.cmd),data.timestamp&&(shortData.ts=new Date(data.timestamp).toISOString());var isLegEnd=!1;if(data.cmd&&"FINISH_GAME"==data.cmd&&(isLegEnd=!0),data.data){var myData=data.data,newData={};if(myData.code&&(newData.cd=myData.code),myData.dctv_key&&(newData.dc=myData.dctv_key),myData.do_attempts&&(newData.do=myData.do_attempts),myData.fast_finish_flights&&(newData.ff=myData.fast_finish_flights),myData.game_shot&&(newData.gs=myData.game_shot),"number"==typeof myData.opponent&&(newData.op=myData.opponent),myData.start_time&&(newData.st=myData.start_time),myData.caller&&(newData.cl=myData.caller),myData.type&&(newData.ty=myData.type),myData.url&&(newData.ul=myData.url),myData.data){var myData2=myData.data,newData2={};myData2.alley_id&&(newData2.ai=myData2.alley_id),myData2.cmd_seq&&(newData2.cs=myData2.cmd_seq),myData2.device_time,myData2.device_token,myData2.member_id,myData2.user_token,newData.da=newData2}isLegEnd&&(myData.is_match_end&&(newData.me=myData.is_match_end),myData.is_set_end&&(newData.se=myData.is_set_end),myData.winning_opponent&&(newData.wo=myData.winning_opponent),myData.match_summary&&(newData.ms=myData.match_summary)),shortData.da=newData}return shortData}catch(e){return data}},inflateLog:function(data){try{var longData={};data.ty&&(longData.type=data.ty),data.cm&&(longData.cmd=data.cm),data.ts&&(longData.timestamp=data.ts);var isLegEnd=!1;if(data.cm&&"FINISH_GAME"==data.cm&&(isLegEnd=!0),data.da){var myData=data.da,newData={};if(myData.cd&&(newData.code=myData.cd),myData.dctv_key&&(newData.dctv_key=myData.cd),myData.do_attempts&&(newData.do_attempts=myData.do),myData.ff&&(newData.fast_finish_flights=myData.ff),myData.gs&&(newData.game_shot=myData.gs),void 0!==myData.op&&(newData.opponent=myData.op),myData.st&&(newData.start_time=myData.st),myData.cl&&(newData.caller=myData.cl),myData.ty&&(newData.type=myData.ty),myData.ul&&(newData.url=myData.ul),myData.da){var myData2=myData.da,newData2={};myData2.ai&&(newData2.alley_id=myData2.ai),myData2.cs&&(newData2.cmd_seq=myData2.cs),myData2.dt,myData2.to,myData2.mi,myData2.ut,newData.data=newData2}isLegEnd&&(myData.me&&(newData.is_match_end=myData.me),myData.se&&(newData.is_set_end=myData.se),myData.wo&&(newData.winning_opponent=myData.wo),myData.ms&&(newData.match_summary=myData.ms)),longData.data=newData}return longData}catch(e){return data}return data},playBackCmds:function(obj,fromApp){fromApp&&console.log(`\n\t\t\t\tMember Id: ${obj.member_id} - Role: ${obj.role}\n\t\t\t`);var commands=obj;fromApp&&(commands=obj.data);for(var i=0;i<commands.length;i++){var cmd=commands[i],done=!1;if((cmd=advLog.inflateLog(cmd)).type.indexOf(!0)&&cmd.data){var code=cmd.data.code;if(code){var inputType=" (touch)";if(-1==code.indexOf("btn"))switch(inputType=" (keyboard)",(code=parseInt(code))>=96&&code<=105&&(code-=48),code){case 8:code="BACKSPACE";break;case 9:code="TAB";break;case 13:code="ENTER";break;case 27:code="ESC";break;case 107:code="+";break;case 106:code="x";break;case 187:code="EQUALS";break;default:code=String.fromCharCode(code)}console.log(cmd.type+": "+code+inputType),done=!0}}if(cmd.type.indexOf(!0)&&cmd.data){var caller=cmd.data.caller;caller&&(console.log(cmd.type+": "+caller+" - "+cmd.data.url),done=!0)}done||console.log(cmd)}},replayLeg:function(){var data=prompt("Enter Leg JSON");"function"==typeof clear&&clear(),advLog.playBackCmds(JSON.parse(data))}};advLog.init(),APP.zanis={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="Zanis: ";message+=msg,console.log(message)}},newSetCheck:function(){var action=!1;try{if(APP.session.isDecidingSet(!0))action=this.checkAction(["FIRST","DECIDING"]);else{var mf=APP.getMatch().format;if(mf.next_set)switch(mf.next_set){case"MUGS_AWAY":return"MUGS_AWAY";default:return!1}}}catch(e){return!1}return action},simpleLegCheck:function(){return APP.session.isFirstLeg()?"FIRST":APP.session.isDecidingLeg()?"DECIDING":"NORMAL"},simpleSetCheck:function(){return APP.session.isFirstSet()?"FIRST":APP.session.isDecidingSet()?"DECIDING":"NORMAL"},masterCheck:function(type){this.log("Master Check: "+type);var setDetails=this.simpleSetCheck(),legDetails=this.simpleLegCheck();this.log("SET: "+setDetails),this.log("LEG: "+legDetails);return this.checkAction([legDetails,setDetails])},checkAction:function(in_array){try{if(APP.ffwd._checkFFWDActive())return"PLAYER";var mf=APP.getMatch().format;if("FIRST"===in_array[1]&&"FIRST"===in_array[0]){if(mf.next_set_options){if(mf.next_set_options.cork_first)return"CORK";if(mf.next_set_options.random_start)return"RANDOM";if(mf.next_set_options.player)return"PLAYER"}if(mf.next_game_options){if(mf.next_game_options.cork_first)return"CORK";if(mf.next_game_options.random_start)return"RANDOM";if(mf.next_game_options.player)return"PLAYER"}}if("FIRST"===in_array[0]){if("DECIDING"===in_array[1]&&mf.next_set_options.cork_last)return"CORK";if(APP.session.current_set>0&&APP.session.isNewSet())return this.log("First Leg of a new set"),this.log(mf.next_set),mf.next_set}var isMatchPlay=!1;if(mf.win_by_two&&"Y"==mf.win_by_two&&APP.session.isDecidingSet()&&(isMatchPlay=!0),isMatchPlay&&"DECIDING"===in_array[0])return mf.cork_sudden_death&&"Y"==mf.cork_sudden_death?"CORK":"ALTERNATE";if("DECIDING"===in_array[1]&&"FIRST"===in_array[0]&&mf.next_set_options.cork_last)return"CORK";if("DECIDING"===in_array[0]&&mf.next_game_options&&mf.next_game_options.cork_last)return"CORK";if("NORMAL"==in_array[0])return mf.next_game}catch(e){return!1}return!1}},APP.nlf={data:{version:17,mode:0,league:null,matchLoaded:!1,matchId:null,homePlayer:null,awayPlayer:null,matchBtnId:null,selectedTeamId:!1,selectedTeamLabel:!1,selectedPlayerId:!1,selectedPlayerLabel:!1,rails:!1,railsChapter:null,railsMatch:null,railsFormat:null,railsGameMenu:null,railsTransFormat:null,railsReturn:null,railsRetry:!1,railsLocal:{},railsPractice:!1,railsPracticeId:null,railsScore:{home_league_points:0,away_league_points:0,loaded:!1}},ele:{main:$("#popup-nlf"),content:$("#nlf-content"),scrollBox:$("#nlf-scroll-box"),exitBtn:$("#nlf-btn-close"),backBtn:$("#nlf-btn-back"),footer:$("#nlf-footer"),footerContent:$("#nlf-footer-content")},reset:function(force){this.log("resetting data"),this.data.mode=0,this.data.league=null,this.data.matchLoaded=!1,this.data.matchId=null,this.data.homePlayer=null,this.data.awayPlayer=null,this.data.matchBtnId=null,this.data.selectedTeamId=!1,this.data.selectedTeamLabel=!1,this.data.selectedPlayerId=!1,this.data.selectedPlayerLabel=!1,this.data.rails=!1,this.data.railsChapter=null,this.data.railsMatch=null,this.data.railsFormat=null,this.data.railsGameMenu=null,this.data.railsTransFormat=null,this.data.railsComplete=[],this.data.railsRetry=!1,this.data.railsPractice=!1,this.data.railsPracticeId=null,this.save()},debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="nlf: ";message+=msg,console.log(message)}},init:function(page,freshLoad){this.cleanLocal(),page||(page=1),this.displayPage(page),freshLoad?this.clear():this.load(),this.save()},displayPage:function(mode){this.data.mode=mode,this.save(),this.ele.footerContent&&this.ele.footerContent.empty(),this.showContent()},reloadCheck:function(){var data=BBAT.fetchData("nlf_data");if(data&&data.railsReturn){this.rails.reloadChapterList();try{data.railsReturn.earlyExit&&(data.railsChapter&&data.railsChapter.set_id&&this.rails.updateSetStatus(data.railsChapter.set_id,"UNPLAYED"),delete data.railsReturn.earlyExit)}catch(e){}}else if(APP.session.isLeaguePlay())this.log("Reload Check - Keep Data"),this.load();else{this.log("Reload Check - Wipe Data");this.clear({keepRailsLocal:!0})}},showContent:function(){this.log("Showing content"),this.ele.main.is(":visible")||APP.popup.show("popup-nlf"),this.loadContent(),this.exitBtnOn(),this.backBtnOn(),this.fixScroll()},loadContent:function(){var content,page;this.log("Loading content for "+this.data.mode);var contentDiv=this.ele.content;switch(this.data.mode){case 1:page=this.pages.matchSelect;break;case 2:page=this.pages.teamSelect;break;case 3:page=this.pages.playerSelect;break;case 4:page=this.pages.noSchedule;break;case 5:page=this.pages.chapterSelect;break;case 6:page=this.pages.chapterInstructions;break;case 7:page=this.pages.setOptions;break;case 8:page=this.pages.endMatchOptions;break;case 9:page=this.pages.legacyMatch;break;case 10:page=this.pages.forfeitPlayers;break;case 11:page=this.pages.newShield;break;case 12:page=this.pages.manualMatchBuilder;break;case 13:page=this.pages.playerLineUps;break;case 14:page=this.pages.selectLineUp;break;case 15:page=this.pages.editLineUp;break;case 16:page=this.pages.teamLineUps;break;case 17:page=this.pages.addFilter;break;case 18:page=this.pages.confFilters;break;default:this.log("Content doesn't exist"),page=this.pages.matchSelect}content=page.content,"function"==typeof page.content&&(content=page.content()),contentDiv.empty().append(content),page.hideFooter?this.ele.footer.hide():this.ele.footer.show(),page.hideBackBtn?this.ele.backBtn.hide():this.ele.backBtn.show(),page.hideExitBtn?this.ele.exitBtn.hide():this.ele.exitBtn.show(),page.scrollClass?this.ele.scrollBox.addClass(page.scrollClass):this.ele.scrollBox.removeAttr("class"),page.init(this)},exitBtnOn:function(){APP.device.addButtonHandler(["nlf-btn-close"],(function(){var msg="Are you sure you want to exit this league?";APP.nlf.rails.checkWdfRules()&&(msg="Are you sure you want to exit this competition?"),APP.confirm.show({msg:msg,ok:function(){if(BBAT.flushData("keep_alley_open"),APP.nlf.data.rails)return APP.nlf.rails.closeMatch(),void APP.nlf.rails.exitAlleyRails();APP.nlf.exit()}})}))},backBtnOn:function(){APP.device.addButtonHandler(["nlf-btn-back"],(function(){APP.nlf.goBackFn()}))},fixScroll:function(){var scrollBox=this.ele.scrollBox,main=this.ele.main,footer=this.ele.footer,footerHeight=0;footer.is(":visible")&&(footerHeight=footer.outerHeight(!0));var scrollPad=Math.ceil(parseFloat(scrollBox.css("padding-top")))+Math.ceil(parseFloat(scrollBox.css("padding-bottom"))),sbh=main.outerHeight(!0)-(main.find(".popup-title").outerHeight(!0)+scrollPad);sbh-=footerHeight,scrollBox.css("max-height",sbh),scrollBox.css("min-height",sbh);scrollBox.off("touchstart touchend touchmove"),scrollBox.on("touchstart touchend touchmove",(function(e){var sb=$("#nlf-scroll-box"),l=$("#nlf-content"),viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),scrollBox.scrollTop(0)},exit:function(noReset){APP.revertToLocalPlay(),this.log("User is exiting"),APP.popup.hide("popup-nlf"),this.reset(),this.rails.clearRailsData(),APP.user_options.auto_balance=!1,APP.storeUserOptions(),APP.userOptions.restoreFromBackup(),noReset||APP.reload()},getLeagueRoster:function(){var ld=this.data.league,roster=!1;ld.league_division_guid&&ld.season_status&&(roster=BBAT.fetchData("directory_division_"+ld.league_division_guid+"_"+ld.season_status));try{var i;if("POST"==APP.nlf.data.league.season_status)if("SINGLES"==APP.nlf.data.league.league_type)for(i=roster.teams[0].players.length-1;i>=0;i--){"I"==roster.teams[0].players[i].player_postseason_status&&roster.teams[0].players.splice(i,1)}else for(i=roster.teams.length-1;i>=0;i--){"I"==roster.teams[i].postseason_status&&roster.teams.splice(i,1)}}catch(e){}return roster},updateDataStructure:function(){var mode=this.data.mode;this.clear(),this.data.mode=mode,this.save(),APP.reload()},checkPlayerExists:function(id,playerList){try{playerList||(playerList=APP.header.teams[0].players);for(var i=0;i<playerList.length;i++){if("P"+id==playerList[i].obj_id)return!0}}catch(e){}return!1},autoSelectPlayers:function(){if(APP.nlf.data.matchLoaded){var i,homeTeam,awayTeam,home_id=APP.nlf.data.homePlayer,away_id=APP.nlf.data.awayPlayer;APP.header.home_away_selected=!0;var errorSelectingPlayer=!1;try{if("TEAM"==APP.nlf.data.league.league_type?(APP.header.roster_left.getTeamIndex()||APP.header.handleOpponentChange("op-button-left-T"+home_id),APP.header.roster_right.getTeamIndex()||APP.header.handleOpponentChange("op-button-right-T"+away_id),$("#oph-bb-reset-left").addClass("button-disabled"),$("#oph-bb-reset-right").addClass("button-disabled")):(APP.header.roster_left.getPlayerCount()||(APP.nlf.checkPlayerExists(home_id)?APP.header.handleOpponentChange("op-button-left-P"+home_id):errorSelectingPlayer=!0),APP.header.roster_right.getPlayerCount()||(APP.nlf.checkPlayerExists(away_id)?APP.header.handleOpponentChange("op-button-right-P"+away_id):errorSelectingPlayer=!0)),APP.nlf.rails.checkWdfRules()&&APP.nlf.data.railsChapter&&(homeTeam=APP.findInObjArray("team_guid",APP.header.teams,home_id)[0],awayTeam=APP.findInObjArray("team_guid",APP.header.teams,away_id)[0],homeTeam&&awayTeam)){var setNumber=APP.nlf.data.railsChapter.set_number;if(setNumber){var players,home_player_id,away_player_id,isPairs=!1;if("pairs"==APP.nlf.data.league.season_label.toLowerCase()&&(isPairs=!0),isPairs){var homePlayers=(players=APP.nlf.rails.wdfRules.getDoublesMatchPlayers(setNumber))[0],awayPlayers=players[1];if(homePlayers&&awayPlayers){for(i=0;i<homePlayers.length;i++)(home_player_id=homePlayers[i].player_guid)&&(APP.findInObjArray("player_guid",homeTeam.players,home_player_id)[0]?APP.header.handleOpponentChange("op-button-left-P"+home_player_id):errorSelectingPlayer=!0);for(i=0;i<awayPlayers.length;i++)(away_player_id=awayPlayers[i].player_guid)&&(APP.findInObjArray("player_guid",awayTeam.players,away_player_id)[0]?APP.header.handleOpponentChange("op-button-right-P"+away_player_id):errorSelectingPlayer=!0)}}else home_player_id=(players=APP.nlf.rails.wdfRules.getMatchPlayers(setNumber))[0].player_guid,away_player_id=players[1].player_guid,home_player_id&&away_player_id&&(APP.findInObjArray("player_guid",homeTeam.players,home_player_id)[0]?APP.header.handleOpponentChange("op-button-left-P"+home_player_id):errorSelectingPlayer=!0,APP.findInObjArray("player_guid",awayTeam.players,away_player_id)[0]?APP.header.handleOpponentChange("op-button-right-P"+away_player_id):errorSelectingPlayer=!0)}}if(APP.nlf.rails.isForfeit){var ff=APP.nlf.rails.ff;if(ff.displayTeam&&ff.selector&&ff.selector.selectionArr){var playerArr=[],ffPlayers=ff.selector.selectionArr;for(i=0;i<ffPlayers.length;i++){var ffPlayer=ffPlayers[i];ffPlayer&&(ffPlayer=ffPlayer.split("_")[2])&&playerArr.push(ffPlayer)}if(playerArr.length){homeTeam=APP.findInObjArray("team_guid",APP.header.teams,home_id)[0],awayTeam=APP.findInObjArray("team_guid",APP.header.teams,away_id)[0];var buttonId="op-button-left-P",activeTeam=homeTeam;for("away"==ff.displayTeam&&(buttonId="op-button-right-P",activeTeam=awayTeam),i=0;i<playerArr.length;i++){var playerId=playerArr[i];APP.findInObjArray("player_guid",activeTeam.players,playerId)[0]?APP.header.handleOpponentChange(buttonId+playerId):errorSelectingPlayer=!0}}}}}catch(e){errorSelectingPlayer=!0}try{APP.nlf.playerRails.autoSelectPlayers()}catch(e){}errorSelectingPlayer&&(APP.header.home_away_selected=!1,APP.device.hideSpinnerOverlay())}},launchGame:function(manual){var matchId,homeId,awayId,btn=null;manual||(matchId=(btn=$("#"+this.data.matchBtnId)).attr("data-id"),homeId=btn.attr("data-home"),awayId=btn.attr("data-away"),this.data.rails||(this.data.matchLoaded=!0),this.data.matchId=matchId,this.data.homePlayer=homeId,this.data.awayPlayer=awayId,this.save());try{this.data.railsReturn||BBAT.storeData({pr_tooltip_seen:!1})}catch(e){}if(!this.data.rails||manual){var sess=APP.session,league=this.data.league;if(APP.nlf.data.league.league_id==APP.starpubs.leagueId&&!manual){var oppoConnectDetails,oppoTeam,cMatch,connectVars={type:"leagueConnect",connectCode1:this.data.league.league_id,connectCode2:this.data.league.season_status,connectCode3:this.data.matchId,callbacks:{connectionMadeGuest:function(scope){APP.starpubs.data.match.home.lineup=[],APP.starpubs.data.match.home.confirmed=!1,APP.starpubs.data.match.away.lineup=[],APP.starpubs.data.match.away.confirmed=!1,APP.starpubs.save()},connectionMadeHost:function(scope){APP.starpubs.data.match.home.lineup=[],APP.starpubs.data.match.home.confirmed=!1,APP.starpubs.data.match.away.lineup=[],APP.starpubs.data.match.away.confirmed=!1,APP.starpubs.save(),APP.starpubs.showSelectPlayers()}}},currentTeamId=this.data.league.team_guid;APP.nlf.checkForProxy()&&(currentTeamId=this.data.selectedTeamId),APP.starpubs.data.teamId=currentTeamId,APP.starpubs.save(),this.data.homePlayer==currentTeamId?(connectVars.role="HOST",oppoTeam=APP.starpubs.getTeam(awayId)):(connectVars.role="GUEST",oppoTeam=APP.starpubs.getTeam(homeId)),oppoTeam&&oppoTeam.phone&&oppoTeam.captain_name&&(oppoConnectDetails=`\n\t\t\t\t\t<div class="highlight-box mMdBottom">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<span class="bold">Opponent Contact Details:</span><br />\n\t\t\t\t\t\t\t${oppoTeam.captain_name} ${oppoTeam.phone}\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t`),APP.magiconnect.init(connectVars);for(var schedule=APP.nlf.data.league.league_schedule,i=0;i<schedule.length;i++){var match=schedule[i];if(match.league_match_id==matchId){cMatch=match;break}}APP.fns.buildLocalDate(cMatch.sched_start_year,cMatch.sched_start_month,cMatch.sched_start_day);cMatch.sched_match_start_time&&" ("+cMatch.sched_match_start_time+")";var topContent=`\n\t\t\t\t<div class="text-center mMdBottom">\n\t\t\t\t\t<span class="bold ${this.data.homePlayer==currentTeamId?"text-gold":""}">\n\t\t\t\t\t\t${cMatch.home_label}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="text-hint"> vs. </span>\n\t\t\t\t\t<span class="bold ${this.data.awayPlayer==currentTeamId?"text-gold":""}">\n\t\t\t\t\t\t${cMatch.away_label}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t`,bottomContent=`\n\t\t\t\t${oppoConnectDetails}\n\t\t\t`;if($("#magiconnect-injection-top").html(topContent),oppoConnectDetails&&$("#magiconnect-injection-bottom").html(bottomContent),"GUEST"==connectVars.role)return APP.starpubs.data.guestSelectPlayers=!0,APP.starpubs.data.guestLeagueData=APP.nlf.data.league,APP.starpubs.save(),APP.nlf.save(),void APP.popup.hide()}if(!this.isMagiconnectLeague()||manual||this.isMagicconnectHost()){sess.startNew(league.league_type,league),sess.applyAdditionalOptions(league),league.user_options&&sess.applyUserOptions(league.user_options),manual||(APP.getMatch().league_match_id=this.getLeagueMatchId(),sess.store(sess.current_match)),APP.header.fetchDirectory(),APP.popup.hide();var appIsBroadCasting=!0;APP.server.alley_id&&APP.device.is_broadcasting||(appIsBroadCasting=!1),appIsBroadCasting||"Y"==league.can_broadcast&&APP.handleAlleyOption("pcm-broadcast-start-button"),APP.device.has_chalk=!0,APP.changeMode("PRE-GAME"),APP.chalkboard.unshield(),APP.popup.hide(),APP.game_selector.show(!0),APP.reveal.showButtonBar("button-bar-match","","",!0),APP.header.refresh(),APP.reveal.setChalkButton(),APP.session.setupLeagueDefaults(),this.continueAutomation(manual)}else this.attemptMagiconnect()}else this.rails.launchRails()},manuallyBroadcastInitMatch:function(){try{var mm=APP.session.getMatchMode(),isRails=APP.nlf.data.rails,do_listing=APP.device.is_broadcasting&&(APP.user.seba||"TOURNAMENT"==mm||"TEAM"==mm||"SINGLES"==mm),leftRoster=new APP.header.Roster;leftRoster.loadTeam(APP.game.opponent[0].getTeam()),leftRoster.loadPlayers(APP.game.opponent[0].getPlayers());var rightRoster=new APP.header.Roster;if(rightRoster.loadTeam(APP.game.opponent[1].getTeam()),rightRoster.loadPlayers(APP.game.opponent[1].getPlayers()),!(do_listing="TEAM"==mm?do_listing&&!leftRoster.team.is_default&&!rightRoster.team.is_default:do_listing&&leftRoster.team.players[0]&&!leftRoster.team.players[0].is_default&&rightRoster.team.players[0]&&!rightRoster.team.players[0].is_default))return;var ol=[],pl=[],buildBoth="TEAM"==mm&&isRails,leftTeamIndex=leftRoster.getTeamIndex(),rightTeamIndex=rightRoster.getTeamIndex();if(ol.push(APP.header.teams[leftTeamIndex].chalkboard_name),ol.push(APP.header.teams[rightTeamIndex].chalkboard_name),"TEAM"!=mm||buildBoth){for(var i=0;i<leftRoster.team.players.length;i++){(p=APP.header.teams[leftTeamIndex].getPlayer(leftRoster.team.players[i].obj_id))&&pl.push({opponent_index:0,last_name:"*"==p.last_name?"":p.last_name,first_name:"*"==p.first_name?"":p.first_name,iso2_country:p.iso2_country,iso3_country:p.iso3_country,email:p.email,player_guid:p.player_guid})}for(var j=0;j<rightRoster.team.players.length;j++){var p;(p=APP.header.teams[rightTeamIndex].getPlayer(rightRoster.team.players[j].obj_id))&&pl.push({opponent_index:1,last_name:"*"==p.last_name?"":p.last_name,first_name:"*"==p.first_name?"":p.first_name,iso2_country:p.iso2_country,iso3_country:p.iso3_country,email:p.email,player_guid:p.player_guid})}}var html=$("#header").html();html=(html=html.replace(/(<div id="hdr-score-0".*?>).*?(<\/div>)/g,"$10$2")).replace(/(<div id="hdr-score-1".*?>).*?(<\/div>)/g,"$10$2"),APP.server.postBroadcast({header:html,scoreboard:$("#scoreboard-center").html(),message_bar:'<div style="font-size:2.5em; color: gray; padding-top: 0.4em;">Waiting for Game Start...</div>',suggested_out:"",notable:""},ol,pl)}catch(e){}},continueAutomation:function(isManual){if(APP.header.startOpponentChange(!1,!0),"SINGLES"==APP.nlf.data.league.league_type){var home_id=APP.nlf.data.homePlayer,away_id=APP.nlf.data.awayPlayer;if(APP.nlf.checkPlayerExists(home_id)&&APP.nlf.checkPlayerExists(away_id)){var homePlayerCount=APP.header.roster_left.getPlayerCount(),awayPlayerCount=APP.header.roster_right.getPlayerCount();1==homePlayerCount&&1==awayPlayerCount&&(APP.header.handleOpponentChange("oph-bb-continue",!0),APP.fns.checkLegsAndSets()&&APP.header.handleSetSetup("pssm-continue"),APP.fns.activateBtn("bb-e-new-players",APP.nlf.changePlayerConfirmation))}}this.isMagiconnectLeague()&&!isManual&&this.attemptMagiconnect()},changePlayerConfirmation:function(){APP.confirm.show({title:"Player Change Disabled",msg:'This match has been scheduled by your league.<br /><br /><span class="bold">You cannot change the players</span>. <br /><br />If this match is displaying the wrong players, please exit and select the correct match.',ok:function(){},cancel:function(){APP.reveal.handleButtons("reveal-exit")},ok_text:"Continue Match",cancel_text:"Select New Match"})},launchLeaguePortal:function(){var myUrl;switch(APP.location){case"test":myUrl="https://testmy.dartconnect.red/";break;case"train":myUrl="https://train.my.dartconnect.com/";break;case"live":myUrl="https://my.dartconnect.com/"}var leagueId=this.data.league.league_id,seasonId=this.data.league.season_id,teamGuid=this.data.league.team_guid;!teamGuid&&this.data.selectedTeamId&&(teamGuid=this.data.selectedTeamId);var url=myUrl+`league/schedule/${leagueId}/${seasonId}/${teamGuid}`;APP.showIframePopOver(url,"League Schedule")},getLeagueMatchId:function(){return this.data.matchId?this.data.matchId:null},getScheduleServer:function(opponentGuid,callback,errCallback){if(APP.nlf.data.league)if(APP.nlf.data.league.league_type){var data={league_type:APP.nlf.data.league.league_type,opponent_guid:opponentGuid,season_status:APP.nlf.data.league.season_status},error=function(r,status){errCallback&&errCallback(),APP.device.hideSpinnerOverlay(),console.log(r)};this.doNonJSONCall("/getLeagueSchedule",data,(function(r){if("OK"===r.status)if(r.payload.length)APP.nlf.data.league.league_schedule=r.payload,APP.nlf.save(),APP.nlf.displayPage(1),callback&&callback();else{if(APP.nlf.data.railsPractice){var league=APP.nlf.data.league,practiceBtnId="plm-ula-"+league.league_id+"-"+league.league_division_guid+"-PRACTICE";return void APP.nlf.rails.startPracticeMatch(practiceBtnId)}APP.nlf.rails.isAdHocLeague()?(APP.nlf.data.league.league_schedule=r.payload,APP.nlf.save(),APP.nlf.displayPage(1)):APP.nlf.displayPage(4)}else error()}),error)}else this.log("No league type data");else this.log("No league data")},checkForProxy:function(){try{if(APP.user.pa){var league=APP.nlf.data.league;return league&&"TEAM"==league.league_type?"TEAM":!league||"SINGLES"!=league.league_type||"SINGLES"}}catch(e){}return!1},updateLeagues:function(callback){APP.device.showSpinnerOverlay();try{APP.server.memberCheckin((function(in_payload){var leagueUpdated=!1;try{if(in_payload.league_associations){APP.user.league_associations=in_payload.league_associations.slice(0);for(var lalen=in_payload.league_associations.length,i=0;i<lalen;i++){var l=in_payload.league_associations[i];APP.nlf.data.league.league_division_guid==l.league_division_guid&&(APP.nlf.data.league=JSON.parse(JSON.stringify(l)),APP.nlf.save(),leagueUpdated=!0);var key="_"+l.team_guid+"_"+l.season_status;if("I"!=l.access_status){var d=in_payload.directory_divisions[key];if(d){d.league_guid=l.league_guid,d.season_status=l.season_status,d.edit_date=null,"TEAM"==l.league_type&&d.teams.unshift({});var obj={};obj["directory_division"+key]=d,BBAT.storeData(obj)}}}}APP.device.hideSpinnerOverlay(),callback?callback(in_payload):leagueUpdated&&APP.nlf.init(APP.nlf.data.mode)}catch(e){APP.device.hideSpinnerOverlay()}}),(function(){APP.device.hideSpinnerOverlay();APP.alert.show("Couldn't update Leagues, please check your connectivity and try again later")}))}catch(e){APP.device.hideSpinnerOverlay()}},hideNonActiveTeams:function(){try{(APP.nlf.data.awayPlayer||APP.nlf.data.homePlayer)&&$("#pol-list li").each((function(){var teamId=$(this).attr("data-id");teamId&&teamId!=APP.nlf.data.homePlayer&&teamId!=APP.nlf.data.awayPlayer&&$(this).hide()}))}catch(e){}},isMagiconnectLeague:function(){try{if(!APP.nlf.data.league)return!1;if("LEGACY"!==APP.nlf.data.league.match_format_style)return!1;if("ONLINE"!==APP.nlf.data.league.opponent_connection_method)return!1;if(APP.nlf.data.league.league_schedule&&APP.nlf.data.league.league_schedule.length){var permittedLeagues=[];return"live"===APP.location?permittedLeagues=["TheLDL"]:"test"===APP.location&&(permittedLeagues=["WoOPL","TheLDL","BDML"]),!permittedLeagues.length||-1!=permittedLeagues.indexOf(APP.nlf.data.league.league_id)}}catch(e){}return!1},attemptMagiconnect:function(){try{var connectVars={connectCode1:this.data.league.league_id,connectCode2:this.data.league.season_status,connectCode3:this.data.matchId,type:"leagueConnect",callbacks:{preInit:function(){console.log("Pre Init")},postInit:function(){console.log("Post Init")},connectionMadeHost:function(){console.log("Host Connected")},connectionMadeGuest:function(){console.log("Guest Connected")},showManualGuest:function(){APP.nlf.exit(!0)},exit:function(){}}};connectVars.role=this.isMagicconnectHost()?"HOST":"GUEST",APP.magiconnect.init(connectVars)}catch(e){return void APP.alert.show("Couldn't automatically connect to your opponent, please connect manually or try again later")}},isMagicconnectHost:function(){try{var homePlayer=APP.nlf.data.homePlayer,leaguePlayer=APP.nlf.data.league.player_roster_id;"TEAM"==APP.nlf.data.league.league_type&&(leaguePlayer=APP.nlf.data.league.team_guid);var proxyType=APP.nlf.checkForProxy();if(proxyType)switch(proxyType){case"TEAM":leaguePlayer=APP.nlf.data.selectedTeamId;break;case"SINGLES":default:leaguePlayer=APP.nlf.data.selectedPlayerId}return homePlayer==leaguePlayer}catch(e){}},goBackFn:function(){},save:function(){BBAT.storeData({nlf_data:APP.nlf.data})},load:function(){var savedData=BBAT.fetchData("nlf_data");if(savedData){if(this.data.mode=savedData.mode,savedData.version!=this.data.version)return void this.updateDataStructure();this.data.awayPlayer=savedData.awayPlayer,this.data.homePlayer=savedData.homePlayer,this.data.league=savedData.league,this.data.matchBtnId=savedData.matchBtnId,this.data.matchId=savedData.matchId,this.data.matchLoaded=savedData.matchLoaded,this.data.mode=savedData.mode,this.data.version=savedData.version,this.data.rails=savedData.rails,this.data.railsChapter=savedData.railsChapter,this.data.railsMatch=savedData.railsMatch,this.data.railsFormat=savedData.railsFormat,this.data.railsGameMenu=savedData.railsGameMenu,this.data.railsTransFormat=savedData.railsTransFormat,this.data.railsReturn=savedData.railsReturn,this.data.railsRetry=savedData.railsRetry,this.data.railsLocal=savedData.railsLocal,this.data.railsPractice=savedData.railsPractice,this.data.railsPracticeId=savedData.railsPracticeId}if(!this.rails){if(void 0===Rails)return;APP.nlf.rails=new Rails({id:"rails",parent:APP.nlf,callbacks:{preInit:function(){},postInit:function(scope){}}})}if(!this.playerRails){if(void 0===PlayerRails)return;APP.nlf.playerRails=new PlayerRails({id:"playerRails",parent:APP.nlf,callbacks:{preInit:function(){},postInit:function(scope){}}})}},clear:function(options){var data=APP.nlf.data,keptData={};try{if(options)for(var opt in options)data[opt]&&(keptData[opt]=data[opt])}catch(e){}BBAT.flushData("nlf_data");try{if(keptData){for(var key in keptData)data[key]=keptData[key];this.save()}}catch(e){}},setLocal:function(matchId,variable,updateData){if(!variable)return APP.nlf.log("Set Local Requires a Variable",!0),!1;if(void 0===updateData)return APP.nlf.log("Set Local UpdateData not defined",!0),!1;var data=APP.nlf.data.railsLocal;data||(data={});var eventData=data[matchId];eventData||(data[matchId]={},eventData=data[matchId]);var eventVariable=eventData[variable];eventVariable||(eventVariable=eventData[variable]),data[matchId][variable]=updateData,data[matchId]._ts=Date.now(),data=JSON.stringify(data),APP.nlf.save(),APP.nlf.log(variable+" stored locally")},getLocal:function(matchId,variable){if(!variable)return APP.nlf.log("getLocal Requires a Variable"),-1;var data=APP.nlf.data.railsLocal;if(!data)return APP.nlf.log("getLocal No Data Found"),-1;var eventData=data[matchId];if(!eventData)return APP.nlf.log("getLocal No Event Data Found"),-1;var eventVariable=eventData[variable];return void 0===eventVariable?(APP.nlf.log("getLocal Variable Not Found - "+variable),-1):eventVariable},removeLocal:function(matchId,variable){if(!variable)return!1;var data=APP.nlf.data.railsLocal;data||(data={});var eventData=data[matchId];eventData||(data[matchId]={},eventData=data[matchId]),eventData[variable]&&delete eventData[variable],data=JSON.stringify(data),APP.nlf.save(),APP.nlf.log(variable+" removed locally")},removeLocalRecord:function(matchId){var data=APP.nlf.data.railsLocal;data||(data={}),data[matchId]&&delete data[matchId],data=JSON.stringify(data),APP.nlf.save(),APP.nlf.log(matchId+" wiped locally")},cleanLocal:function(){APP.nlf.log("House Keeping!");var localObj=APP.nlf.data.railsLocal,wipeArr=[];$.each(localObj,(function(key,value){try{value._ts&&Date.now()-value._ts>6048e5&&wipeArr.push(key)}catch(e){}}));for(var i=0;i<wipeArr.length;i++){var matchId=wipeArr[i];APP.nlf.removeLocalRecord(matchId),APP.nlf.log("Wiping old data: "+matchId)}},exitTournament:function(){APP.exitTournament(!0),BBAT.flushData("bracket")},doCall:function(url,data,success,error){APP.device.showSpinnerOverlay(),data.device_token=APP.device.token,data.member_id=APP.user?APP.user.member_id:"n/a",data=JSON.stringify(data);var srvr=APP.server;$.ajax({url:url,type:"POST",cache:!1,timeout:srvr.dflt_timeout,dataType:"json",contentType:"application/json",processData:!1,data:data,success:function(in_data){APP.device.hideSpinnerOverlay(),"OK"==in_data.status?success(in_data):error("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){APP.device.hideSpinnerOverlay(),error("FAILED",in_a,in_b,in_c)}})},doNonJSONCall:function(url,data,successCb,errorCb){APP.device.showSpinnerOverlay();var srvr=APP.server;$.ajax({url:url,type:"POST",cache:!1,timeout:srvr.dflt_timeout,data:data,success:function(in_data){APP.device.hideSpinnerOverlay(),"OK"==(in_data=JSON.parse(in_data)).status?successCb&&successCb(in_data):errorCb&&errorCb("FAILED",in_data.status_text)},error:function(in_a,in_b,in_c){APP.device.hideSpinnerOverlay(),errorCb&&errorCb("FAILED",in_a,in_b,in_c)}})},callFailedError:function(){APP.device.hideSpinnerOverlay(),APP.alert.show("Couldn't reach the DartConnect Platform.<br />Please check your Internet Connection and try again")},rails:null,playerRails:null,pages:{matchSelect:{hideFooter:!0,hideBackBtn:!0,content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<h4 class="subheading">Match List</span>\n\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t<div id="nlf-matches">\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){var teamName,league=APP.nlf.data.league;return teamName=league.team_name,APP.nlf.data.selectedTeamLabel&&(teamName=APP.nlf.data.selectedTeamLabel),APP.nlf.data.selectedPlayerLabel&&(teamName=APP.nlf.data.selectedPlayerLabel),"SINGLES"==league.league_type&&(teamName=""),`\n\t\t\t\t\t<div id="nlf-ad-hoc-warning" class="hide">\n\t\t\t\t\t\tThis league is not is not using the DartConnect Scheduling Tool or Division Standings\n\t\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\t<h3 style="line-height: 1.2em;">\n\t\t\t\t\t\t${teamName?`\n\t\t\t\t\t\t<span class="bold">${teamName}</span><br />\n\t\t\t\t\t\t${league.season_label?league.season_label:league.longname}\n\t\t\t\t\t`:league.season_label?league.season_label:league.longname}\n\t\t\t\t\t</h3>\n\n\t\t\t\t\t<div id="nlf-check-updates" class="button-info round-corners button button-menu">\n\t\t\t\t\t\tCheck for Updates\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="nlf-view-schedule" class="button button-menu">\n\t\t\t\t\t\tView Schedule Details\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<hr class="nlf-hr" />\n\t\t\t\t`},init:function(scope){APP.nlf.rails.replayMatch=!1,APP.nlf.data.rails=!1,APP.nlf.save();var isProxy=scope.checkForProxy();if(isProxy){var proxySelected=!1;if(APP.nlf.rails.isAdHocLeague()&&("TEAM"==isProxy?APP.nlf.data.selectedTeamId&&(proxySelected=!0):APP.nlf.data.selectedPlayerId&&(proxySelected=!0)),!APP.nlf.data.league.league_schedule.length&&!proxySelected)return"TEAM"==isProxy?(APP.nlf.log("Proxy - Load Teams"),void APP.nlf.displayPage(2)):(APP.nlf.log("Proxy - Load Singles"),void APP.nlf.displayPage(3));if(APP.nlf.data.railsPractice){var league=APP.nlf.data.league,practiceBtnId="plm-ula-"+league.league_id+"-"+league.league_division_guid+"-PRACTICE";APP.nlf.rails.startPracticeMatch(practiceBtnId)}}APP.fns.activateBtn("nlf-view-schedule",(function(){APP.nlf.launchLeaguePortal()})),APP.fns.activateBtn("nlf-check-updates",(function(){APP.nlf.updateLeagues()})),this.createNewMatchBtns(scope);var divLabel="Your Division";APP.nlf.data.league.division_label&&(divLabel=APP.nlf.data.league.division_label),scope.ele.main.find(".popup-title span").text(divLabel),APP.nlf.rails.isAdHocLeague()&&($("#nlf-view-schedule").hide(),$(".nlf-hr").css("margin-top","1em"),$("#nlf-ad-hoc-warning").removeClass("hide")),"POST"==APP.nlf.data.league.season_status&&"MANUAL"!=APP.nlf.data.league.post_season_process&&$("#nlf-create-manual").parent().hide()},createNewMatchBtns:function(scope){var sched=scope.data.league.league_schedule,content="",isPostSeason="POST"==scope.data.league.season_status;if(isPostSeason&&scope.data.league.postseason_2match_format,APP.nlf.rails.isAdHocLeague()&&(content+='\n\t\t\t\t\t\t<div class="highlight-box primary-grad" style="margin: 0 0 1.5em 0;">\n\t\t\t\t\t\t\t<p style="font-size: 0.9em">To create a league match, you will need to select the opposing teams and players.</p>\n\t\t\t\t\t\t\t<div id="nlf-create-manual" class="button-green round-corners button button-menu">\n\t\t\t\t\t\t\t\tPlay a League Match!\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),!sched)return'\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\tThe schedule for this division has not been published. Check again later or contact the league for more information.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';if(!sched.length&&!APP.nlf.rails.isAdHocLeague())return'\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\tNo Matches Found\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';for(var today=moment(),lowerRange=moment(today).subtract(1,"d"),upperRange=moment(today).add(1,"d"),nextMatch=[],delayedMatches=[],futureMatches=[],completedMatches=[],i=0;i<sched.length;i++){var match=sched[i],matchDate=moment(match.sched_date);isPostSeason&&!match.sched_date&&(matchDate=moment(),match.noDate=!0);var matchId=`${scope.data.league.season_status}-${match.league_match_id}`;"C"===match.status||-1!==scope.getLocal(matchId,"matchComplete")?completedMatches.push(match):matchDate.isBetween(lowerRange,upperRange)?nextMatch.push(match):matchDate.isAfter(upperRange)?futureMatches.push(match):matchDate.isBefore(lowerRange)&&delayedMatches.push(match)}!nextMatch.length&&futureMatches.length&&nextMatch.push(futureMatches.shift());var matchBtnArr=[];if(nextMatch.length){var currentMatch=[];if(nextMatch.length>1)for(var l=nextMatch.length-1;l>=0;l--){var nMatch=nextMatch[l];(nMatch.op0_score||nMatch.op1_score)&&(nextMatch.splice(l,1),currentMatch.push(nMatch))}if(currentMatch.length){currentMatch.length>1?content+='\n\t\t\t\t\t\t\t\t\t<h4 class="nlf-match-list next-match">Active Matches</h4>\n\t\t\t\t\t\t\t\t':content+='\n\t\t\t\t\t\t\t\t\t<h4 class="nlf-match-list next-match">Current Match</h4>\n\t\t\t\t\t\t\t\t';for(var j=0;j<currentMatch.length;j++)content+=this.createNewMatchBtn(currentMatch[j],"next-match",scope),matchBtnArr.push("nlf-match-"+currentMatch[j].league_match_id)}var nextMatchIsBye=!1;if(nextMatch.length){for(var k=0;k<nextMatch.length;k++){if(nextMatch[k].home_id&&nextMatch[k].away_id){nextMatchIsBye=!1;break}nextMatchIsBye=!0}var title="Next Match";nextMatch.length>1&&(title="Next Matches"),(nextMatch[0].op0_league_points||nextMatch[0].op1_league_points)&&(title="Current Match");var nextMatchClass="next-match";if(nextMatchIsBye&&(nextMatchClass="completed-match"),content+=`\n\t\t\t\t\t\t\t\t<h4 class="nlf-match-list ${nextMatchClass}">${title}</h4>\n\t\t\t\t\t\t\t`,content+=this.createNewMatchBtn(nextMatch[0],"next-match",scope),matchBtnArr.push("nlf-match-"+nextMatch[0].league_match_id),nextMatch.length>1){content+='\n\t\t\t\t\t\t\t\t\t<h4 class="nlf-match-list next-match">Next Matches</h4>\n\t\t\t\t\t\t\t\t';for(k=1;k<nextMatch.length;k++)content+=this.createNewMatchBtn(nextMatch[k],"next-match",scope),matchBtnArr.push("nlf-match-"+nextMatch[k].league_match_id)}}}var delayedActiveMatches=[];if(delayedMatches.length)for(k=delayedMatches.length-1;k>=0;k--)if(delayedMatches[k].op0_league_points||delayedMatches[k].op1_league_points){var delayedActiveMatch=delayedMatches.splice(k,1);delayedActiveMatches.push(delayedActiveMatch[0])}if(delayedActiveMatches.length){var daTitle="Active Match (Delayed)";delayedActiveMatches.length>1&&(daTitle="Active Matches (Delayed)"),content+=`<h4 class="nlf-match-list next-match">${daTitle}</h4>`;for(k=0;k<delayedActiveMatches.length;k++)content+=this.createNewMatchBtn(delayedActiveMatches[k],"next-match",scope),matchBtnArr.push("nlf-match-"+delayedActiveMatches[k].league_match_id)}if(delayedMatches.length){content+='<h4 class="nlf-match-list delayed-match">Delayed Matches</h4>',delayedMatches.sort((function(a,b){return new Date(a.sched_date)-new Date(b.sched_date)}));for(k=0;k<delayedMatches.length;k++)content+=this.createNewMatchBtn(delayedMatches[k],"delayed-match",scope),matchBtnArr.push("nlf-match-"+delayedMatches[k].league_match_id)}if(futureMatches.length){content+='<h4 class="nlf-match-list future-match">Future Matches</h4>',futureMatches.sort((function(a,b){return new Date(a.sched_date)-new Date(b.sched_date)}));for(var m=0;m<futureMatches.length;m++)content+=this.createNewMatchBtn(futureMatches[m],"future-match",scope),matchBtnArr.push("nlf-match-"+futureMatches[m].league_match_id)}if(APP.nlf.rails.isAdHocLeague()||APP.nlf.data.league.league_id===APP.starpubs.leagueId||(content+='\n\t\t\t\t\t\t\t<div class="highlight-box primary-grad" style="margin: 1.5em 0;">\n\t\t\t\t\t\t\t\t<p class="text-gold">Can\'t find your match?</p>\n\t\t\t\t\t\t\t\t<div id="nlf-create-manual" class="button-red round-corners button button-menu">\n\t\t\t\t\t\t\t\t\tCreate Unscheduled Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'),completedMatches.length){content+='<h4 class="nlf-match-list completed-match">Completed Matches</h4>',completedMatches.sort((function(a,b){return new Date(b.sched_date)-new Date(a.sched_date)}));for(var n=0;n<completedMatches.length;n++)content+=this.createNewMatchBtn(completedMatches[n],"completed-match",scope),matchBtnArr.push("nlf-match-"+completedMatches[n].league_match_id)}$("#nlf-matches").empty().append(content),matchBtnArr.length&&APP.fns.activateBtn(matchBtnArr,this.matchClick),APP.fns.activateBtn("nlf-create-manual",this.manualMatchClick)},createNewMatchBtn:function(match,type,scope){var content="",matchDate="";APP.nlf.data.league.league_id;APP.nlf.playerRails.isPlayerRails();var hasYear=void 0!==match.sched_start_year,hasMonth=void 0!==match.sched_start_month;match.sched_start_day;hasYear&&hasMonth&&hasYear&&(matchDate=APP.fns.buildLocalDate(match.sched_start_year,match.sched_start_month,match.sched_start_day)),match.sched_match_start_time&&(matchDate+=" ("+match.sched_match_start_time+")");var isBye=!1;match.home_id&&match.away_id||(isBye=!0);match.venue_label&&(match.venue_label,match.venue_board_label&&match.venue_board_label);var isMatchCompleted=!1;"C"==match.status&&(isMatchCompleted=!0);var matchId=scope.data.league.season_status+"-"+match.league_match_id;-1!==scope.getLocal(matchId,"matchComplete")&&(isMatchCompleted=!0);var reverseLayout=!1;"away-home"===APP.nlf.data.league.sched_layout&&(reverseLayout=!0);var midDisplay,matchScore=!1;match.op1_league_points||match.op0_league_points?matchScore=reverseLayout?match.op1_league_points+" - "+match.op0_league_points:match.op0_league_points+" - "+match.op1_league_points:(match.op0_score||match.op1_score)&&(matchScore=reverseLayout?match.op1_score+" - "+match.op0_score:match.op0_score+" - "+match.op1_score),midDisplay=matchScore||(reverseLayout?"@":"vs");if("Non-Scheduled Match"==match.seq&&!0,isBye){0;nflMatchHeader=`Match ${match.seq}: TBD`;matchDate&&(nflMatchHeader=`Match ${match.seq}: ${matchDate}`),content+=`\n\t\t\t\t\t\t<div class="nlf-new-match-btn new-match-btn-bye">\n\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td width="8%" class="nlf-new-match-header-stripe bye">\n\t\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td width="96%">\n\t\t\t\t\t\t\t\t\t\t<table class="nlf-match-table" width="100%">\n\t\t\t\t\t\t\t\t\t\t\t<tr class="nlf-new-match-header deemphasise">\n\t\t\t\t\t\t\t\t\t\t\t\t<td width="100%" colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t${nflMatchHeader}\n\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;" width="41%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tBYE\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}else{var nflMatchHeader=`Match ${match.seq}: TBD`;0,matchDate&&(nflMatchHeader=`Match ${match.seq}: ${matchDate}`,match.noDate&&(nflMatchHeader=""+match.seq)),match.round_label&&(nflMatchHeader=""+match.round_label,matchDate&&(nflMatchHeader=`${match.round_label}: ${matchDate}`)),scope.rails.isAdHocLeague()&&(nflMatchHeader=matchDate,!1);var isPostSeason=!1;try{"POST"==scope.data.league.season_status&&(isPostSeason=!0)}catch(e){}var matchIdDisplay=match.seq;isPostSeason&&(matchIdDisplay="&nbsp;"),matchIdDisplay.length>2&&(matchIdDisplay="&nbsp;"),content+=`\n\t\t\t\t\t\t<div class="nlf-new-match-btn ${type}">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tid="nlf-match-${match.league_match_id}" \n\t\t\t\t\t\t\t\tclass="nlf-match round-corners button ${isMatchCompleted?"completed":"button-white"}"\n\t\t\t\t\t\t\t\tdata-id="${match.league_match_id}"\n\t\t\t\t\t\t\t\tdata-home="${match.home_id}"\n\t\t\t\t\t\t\t\tdata-away="${match.away_id}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td width="8%" class="nlf-new-match-header-stripe ${type}">\n\t\t\t\t\t\t\t\t\t\t\t${matchIdDisplay}\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td width="92%">\n\t\t\t\t\t\t\t\t\t\t\t<table class="nlf-match-table" width="100%">\n\t\t\t\t\t\t\t\t\t\t\t\t<tr class="nlf-new-match-header ${isMatchCompleted?"deemphasise":""}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="100%" colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${nflMatchHeader}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td style="text-align: right; vertical-align: middle;" width="40%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.away_label:match.home_label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle; padding: 0" width="20%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="live-scores ${matchScore?"bold":""}" style="color: #fff">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${midDisplay}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td style="text-align: left; vertical-align: middle;" width="40%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.home_label:match.away_label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}return content},createPostSeasonMatchBtn:function(match,forceUnplayed,header,isDupe){var content="",isBye=!1;match.home_id&&match.away_id||(isBye=!0);var isMatchCompleted=!1;"C"==match.status&&(isMatchCompleted=!0,forceUnplayed&&(isMatchCompleted=!1));var reverseLayout=!1;"away-home"===APP.nlf.data.league.sched_layout&&(reverseLayout=!0);var midDisplay,matchScore=!1;return isDupe||(match.op0_score||match.op1_score)&&(matchScore=reverseLayout?match.op1_score+" - "+match.op0_score:match.op0_score+" - "+match.op1_score),midDisplay=matchScore||"&amp;",match.seq&&(header=match.seq+" | "+header),content+=isBye?`\n\t\t\t\t\t<h4 class="nlf-match-header">${header}</h4>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="nlf-match button-white round-corners button completed"\n\t\t\t\t\t\t\tstyle="cursor: initial;"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<table class="nlf-match-table">\n\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t<td style="text-align: center; color: black; font-weight: bold;">\n\t\t\t\t\t\t\t\t\t\tBYE\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`:`\n\t\t\t\t\t\t<h4 class="nlf-match-header">${header}</h4>\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tid="nlf-match-${match.league_match_id}${isDupe?"-dupe":""}" \n\t\t\t\t\t\t\tclass="nlf-match round-corners button ${isMatchCompleted?"completed":"button-white"}"\n\t\t\t\t\t\t\tdata-id="${match.league_match_id}"\n\t\t\t\t\t\t\tdata-home="${match.home_id}"\n\t\t\t\t\t\t\tdata-away="${match.away_id}"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<table class="nlf-match-table">\n\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t<td style="text-align: center" width="41%">\n\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.away_label:match.home_label}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td style="text-align: center" width="18%">\n\t\t\t\t\t\t\t\t\t\t<span class="live-scores ${matchScore?"bold":""}" style="color: #fff">\n\t\t\t\t\t\t\t\t\t\t\t${midDisplay}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td style="text-align: center" width="41%">\n\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.home_label:match.away_label}\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`},createNewPostSeasonMatchBtn:function(match,forceUnplayed,header,isDupe,type){var content="",isBye=!1;match.home_id&&match.away_id||(isBye=!0);var isMatchCompleted=!1;"C"==match.status&&(isMatchCompleted=!0,forceUnplayed&&(isMatchCompleted=!1));var reverseLayout="away-home"===APP.nlf.data.league.sched_layout,matchScore=!1;isDupe||(match.op0_score||match.op1_score)&&(matchScore=reverseLayout?match.op1_score+" - "+match.op0_score:match.op0_score+" - "+match.op1_score);var midDisplay=matchScore||"&amp;";console.log(type),type||(type="next-match");var nflMatchHeader="";return nflMatchHeader=match.seq?match.seq+" | "+header:header,content+=isBye?`\n\t\t\t\t\t\t<h4 class="nlf-match-header">${nflMatchHeader}</h4>\n\t\t\t\t\t\t<div class="nlf-match button-white round-corners button completed" style="cursor: initial;">\n\t\t\t\t\t\t\t<table class="nlf-match-table">\n\t\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t\t<td style="text-align: center; color: black; font-weight: bold;">\n\t\t\t\t\t\t\t\t\t\t\tBYE\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`:`\n\t\t\t\t\t\t<div class="nlf-new-match-btn ${type}">\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tid="nlf-match-${match.league_match_id}${isDupe?"-dupe":""}" \n\t\t\t\t\t\t\t\tclass="nlf-match round-corners button ${isMatchCompleted?"completed":"button-white"}"\n\t\t\t\t\t\t\t\tdata-id="${match.league_match_id}"\n\t\t\t\t\t\t\t\tdata-home="${match.home_id}"\n\t\t\t\t\t\t\t\tdata-away="${match.away_id}"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td width="8%" class="nlf-new-match-header-stripe ${type}">\n\t\t\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td width="92%">\n\t\t\t\t\t\t\t\t\t\t\t<table class="nlf-match-table" width="100%">\n\t\t\t\t\t\t\t\t\t\t\t\t<tr class="nlf-new-match-header ${isMatchCompleted?"deemphasise":""}">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="100%" colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${nflMatchHeader}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="home-oppo" width="40%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.away_label:match.home_label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle; padding: 0" width="20%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="live-scores ${matchScore?"bold":""}" style="color: #fff">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${midDisplay}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td class="away-oppo" width="40%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${reverseLayout?match.home_label:match.away_label}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`},matchClick:function(id,force){var homeTeam,awayTeam,btn=$("#"+id);APP.nlf.data.matchBtnId=id;for(var cMatch,matchId=btn.attr("data-id"),league=APP.nlf.data.league,schedule=APP.nlf.data.league.league_schedule,i=0;i<schedule.length;i++){var match=schedule[i];if(match.league_match_id==matchId){cMatch=match;break}}if(cMatch&&(homeTeam=cMatch.home_label,awayTeam=cMatch.away_label),league.match_format_style&&"AMB"==league.match_format_style&&(APP.nlf.data.rails=!0,APP.nlf.save()),force)APP.nlf.launchGame();else if(btn.hasClass("completed")){if("SINGLES"==league.league_type){return void APP.alert.show('This match is completed. To play an additional match, use the "Create Manual League Match" feature.',null,"")}APP.confirm.show({msg:`\n\t\t\t\t\t\t\t\tThis match already has completed results. Are you sure want to add more legs to:\n\t\t\t\t\t\t\t\t<br /><br />\n\t\t\t\t\t\t\t\t<span class="bold">${homeTeam}</span><br />\n\t\t\t\t\t\t\t\tvs. <br />\n\t\t\t\t\t\t\t\t<span class="bold">${awayTeam}</span>\n\t\t\t\t\t\t\t`,ok:function(){APP.nlf.launchGame()}})}else APP.confirm.show({msg:`\n\t\t\t\t\t\tYou have selected:\n\t\t\t\t\t\t<br /><br />\n\t\t\t\t\t\t<span class="bold">${homeTeam}</span><br />\n\t\t\t\t\t\tvs. <br />\n\t\t\t\t\t\t<span class="bold">${awayTeam}</span>\n\t\t\t\t\t`,ok:function(){APP.nlf.launchGame()}})},manualMatchClick:function(id){"AMB"!=APP.nlf.data.league.match_format_style?APP.confirm.show({msg:'\n\t\t\t\t\t\tThis should only be used if you cannot find your scheduled match in the list above. Before playing a manual match, please <span class="bold">check for updates</span> to confirm you have the latest schedule (WIFI required).\n\t\t\t\t\t\t<br /><br />\n\t\t\t\t\t\t<span class="bold">Manual matches must be approved by the league.</span>\n\t\t\t\t\t',ok:function(){APP.nlf.launchGame(!0)}}):APP.nlf.rails.manualMatch.startBuilder()}},teamSelect:{hideFooter:!0,hideBackBtn:!0,content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id='nlf-teams'>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){return"<h4 style='margin-top: 0;'>Select your team</h4>"},init:function(scope){var content=this.createTeamBtns(scope);$("#nlf-team-select").append(content),scope.ele.main.find(".popup-title span").text("Team Select")},createTeamBtns:function(scope){var content="",teams=APP.nlf.getLeagueRoster(),teamBtnArr=[];if(teams)if(teams.teams.length){for(var i=0;i<teams.teams.length;i++)if(0!=i){var team=teams.teams[i];jQuery.isEmptyObject(team)||(content+=this.createTeamBtn(team),teamBtnArr.push("nlf-team-"+team.team_guid))}}else content='\n\t\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t\tNo Teams Found\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t';else content='\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\tNo League Teams Found\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';content+='\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>Can\'t find your Team?</p>\n\t\t\t\t\t<div id="nlf-reload-teams" class="button-red round-corners button button-menu">\n\t\t\t\t\t\tUpdate Teams\n\t\t\t\t\t</div>\n\t\t\t\t',$("#nlf-teams").empty().append(content),teamBtnArr.length&&APP.fns.activateBtn(teamBtnArr,this.teamClick),APP.fns.activateBtn("nlf-reload-teams",this.reloadTeams)},createTeamBtn:function(team){var content="";return content+=`\n\t\t\t\t\t<div \n\t\t\t\t\t\tid="nlf-team-${team.team_guid}" \n\t\t\t\t\t\tclass="nlf-team button-white round-corners button"\n\t\t\t\t\t\tdata-id="${team.team_guid}"\n\t\t\t\t\t>\n\t\t\t\t\t\t${team.team_name}\n\t\t\t\t\t</div>\n\t\t\t\t`},teamClick:function(id){var btn=$("#"+id),teamId=btn.attr("data-id");APP.nlf.data.selectedTeamId=teamId;var teamName=btn.text().trim();APP.confirm.show({msg:`\n\t\t\t\t\t\tIs this your team: <span class="bold">${teamName}</span>?\n\t\t\t\t\t`,ok:function(){var errorCb=APP.nlf.callFailedError;APP.nlf.data.selectedTeamId=teamId,APP.nlf.data.selectedTeamLabel=teamName,APP.nlf.getScheduleServer(teamId,"",errorCb)}})},reloadTeams:function(){var ld=APP.nlf.data.league;ld?APP.server.getLeagueDivisionDirectory({league_division_guid:ld.league_division_guid,season_status:ld.season_status,edit_date:null,spinner:!0,on_network_error:function(){APP.nlf.displayPage(2)},on_success:function(in_payload){in_payload&&("TEAM"==ld.league_type&&in_payload.teams.unshift({}),APP.header.loadLeagueDivisionDirectory(in_payload,APP.nlf.data.league),APP.header.storeDirectory()),APP.nlf.displayPage(2)}}):APP.alert.show('A problem with your user profile was detected.<br /><br />\n\t\t\t\t\t\t<span class="bold">Please log out and back in again</span><br /><br />If you continue to see this, please contact your league admin or DartConnect Support')}},playerSelect:{hideFooter:!0,hideBackBtn:!0,content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id='nlf-players'>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){return"<h4 style='margin-top: 0;'>Select your name</h4>"},init:function(scope){this.createPlayerBtns(scope),scope.ele.main.find(".popup-title span").text("Player Select")},createPlayerBtns:function(scope){var playerList,content="",players=APP.nlf.getLeagueRoster(),playerBtnArr=[];try{playerList=players.teams[0].players}catch(e){players=!1,APP.nlf.log("Couldn't find player team obj",!0)}if(players)if(playerList.length)for(var i=0;i<playerList.length;i++){var player=playerList[i];jQuery.isEmptyObject(player)||(content+=this.createPlayerBtn(player),playerBtnArr.push("nlf-player-"+player.player_guid))}else content='\n\t\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t\tNo Players Found\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t';else content='\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\tNo Players Found\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';content+='\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>Can\'t find your name?</p>\n\t\t\t\t\t<div id="nlf-reload-players" class="button-red round-corners button button-menu">\n\t\t\t\t\t\tUpdate Players\n\t\t\t\t\t</div>\n\t\t\t\t',$("#nlf-players").empty().append(content),playerBtnArr.length&&APP.fns.activateBtn(playerBtnArr,this.playerClick),APP.fns.activateBtn("nlf-reload-players",this.reloadPlayers)},createPlayerBtn:function(player){var content="";return content+=`\n\t\t\t\t\t<div \n\t\t\t\t\t\tid="nlf-player-${player.player_guid}" \n\t\t\t\t\t\tclass="nlf-team button-white round-corners button"\n\t\t\t\t\t\tdata-id="${player.player_guid}"\n\t\t\t\t\t>\n\t\t\t\t\t\t${player.first_name} ${player.last_name}\n\t\t\t\t\t</div>\n\t\t\t\t`},playerClick:function(id){var btn=$("#"+id),playerId=btn.attr("data-id");APP.nlf.data.selectedPlayerId=playerId;var playerName=btn.text().trim();APP.confirm.show({msg:`\n\t\t\t\t\t\tIs this you: <span class="bold">${playerName}</span>?\n\t\t\t\t\t`,ok:function(){var errorCb=APP.nlf.callFailedError;APP.nlf.data.selectedPlayerId=playerId,APP.nlf.data.selectedPlayerLabel=playerName,APP.nlf.getScheduleServer(playerId,"",errorCb)}})},reloadPlayers:function(){var ld=APP.nlf.data.league;ld?APP.server.getLeagueDivisionDirectory({league_division_guid:ld.league_division_guid,season_status:ld.season_status,edit_date:null,spinner:!0,on_network_error:function(){APP.nlf.displayPage(2)},on_success:function(in_payload){in_payload&&("TEAM"==ld.league_type&&in_payload.teams.unshift({}),APP.header.loadLeagueDivisionDirectory(in_payload,APP.nlf.data.league),APP.header.storeDirectory()),APP.nlf.displayPage(3)}}):APP.alert.show('A problem with your user profile was detected.<br /><br />\n\t\t\t\t\t\t<span class="bold">Please log out and back in again</span><br /><br />If you continue to see this, please contact your league admin or DartConnect Support')}},noSchedule:{hideBackBtn:!0,content:function(){var content='\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t<span class="text-gold bold">No Schedule Found!</span><br />\n\t\t\t\t\t\t\t<span style="font-weight: normal">The schedule for this division has not been published. Check again later or contact the league for more information.</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<h4 id="matchOfferText" class="subheading">\n\t\t\t\t\t\t\tNo League Schedule Found\n\t\t\t\t\t\t</h4>\n\t\t\t\t';return"AMB"!==APP.nlf.data.league.match_format_style&&(content+='\n\t\t\t\t\t\t<div id="nlf-create-manual" class="button-green round-corners button button-menu">\n\t\t\t\t\t\t\tCreate Unscheduled Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),content+="\n\t\t\t\t\t</div>\n\t\t\t\t"},init:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<div \n\t\t\t\t\t\tid="nlf-go-back" \n\t\t\t\t\t\tclass="button-red button-md round-corners button"\n\t\t\t\t\t>\n\t\t\t\t\t\tBack\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("nlf-go-back",(function(){APP.nlf.displayPage(1),APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save()})),APP.fns.activateBtn("nlf-create-manual",APP.nlf.pages.matchSelect.manualMatchClick);var headerTxt="League Schedule";APP.nlf.data.selectedTeamLabel&&(headerTxt=APP.nlf.data.selectedTeamLabel),APP.nlf.data.selectedPlayerLabel&&(headerTxt=APP.nlf.data.selectedPlayerLabel),scope.ele.main.find(".popup-title span").text(headerTxt)}},chapterSelect:{scrollClass:"full-height-page",content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id="rails-chapters">\n\t\t\t\t\t\t\t<h4 class="subheading">\n\t\t\t\t\t\t\t\tChapter Select\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>Loading &hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){return""},addFooter:function(){var filters,footerContent="";APP.nlf.rails.filters.filtersAvailable()?(footerContent='\n\t\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tid="nlf-match-options"\n\t\t\t\t\t\t\t\t\t\tclass="button button-md button-gray round-corners" \n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tMatch Options\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t',(filters=APP.nlf.rails.filters.getCurrentFilters())&&filters.length?footerContent+='\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tid="nlf-filter-options"\n\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tChange Filter\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t':footerContent+='\n\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tid="nlf-filter-options"\n\t\t\t\t\t\t\t\tclass="button-gold button-md button-block round-corners button"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tMultiple Tablets\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t',footerContent+="\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t"):footerContent='\n\t\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tid="nlf-match-options"\n\t\t\t\t\t\t\t\t\t\tclass="button button-md button-gray round-corners" \n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tMatch Options\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t',APP.nlf.ele.footerContent.empty().append(footerContent),APP.fns.activateBtn(["nlf-match-options"],(function(){APP.nlf.displayPage(8)})),APP.fns.activateBtn(["nlf-filter-options"],(function(){APP.nlf.displayPage(17)})),APP.fns.activateBtn("nlf-suspend-match",(function(){APP.confirm.show({msg:'<span class="bold">Suspend this match?</span><br />You may resume this match at any time. ',ok:function(){APP.nlf.rails.closeMatch(),APP.nlf.exit()}})}))},init:function(scope){APP.nlf.playerRails.isPlayerRails()&&APP.nlf.playerRails.editData.reset(!0),APP.nlf.rails.tieBreaker.init(),APP.nlf.rails.breaks.init();var onBreak=!1,onTiebreakerBreak=!1;if(APP.nlf.rails.breaks.hasBreaks()&&APP.nlf.rails.breaks.checkShowBreak()&&(onBreak=!0,APP.nlf.rails.breaks.isTieBreakerBreak()&&(onTiebreakerBreak=!0)),APP.nlf.rails.replayMatch||!APP.nlf.rails.calculateMatchScore(!0).match_complete){var filters,filterData,title="Select Competition to Play";onBreak&&(title=onTiebreakerBreak?"Tiebreaker":"Break Time");var filtersAvailable=APP.nlf.rails.filters.filtersAvailable();filtersAvailable&&(filters=APP.nlf.rails.filters.getCurrentFilters(),(filterData=APP.nlf.rails.filters.getData())&&filterData.label&&(title=`\n\t\t\t\t\t\t\t<span class="filtered">\n\t\t\t\t\t\t\t\t${filterData.label}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t`),filters&&filters.length&&filterData&&!filterData.label&&(title='\n\t\t\t\t\t\t\t\t<span class="filtered">\n\t\t\t\t\t\t\t\t\tMatches Filtered\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t')),APP.nlf.ele.main.find(".popup-title span").html(title),APP.nlf.data.railsChapter=null,APP.nlf.save(),this.addFooter();var returnArr=scope.rails.buildChapterList(),content=returnArr[0],chapterBtnArr=returnArr[1]?returnArr[1]:[],accordionArr=returnArr[2]?returnArr[2]:[],emptyMatchBtnArr=returnArr[3]?returnArr[3]:[],setLineUpBtnArr=returnArr[4]?returnArr[4]:[];if(onBreak&&(content=onTiebreakerBreak?APP.nlf.rails.breaks.buildTieBreakerBreakDisplay():APP.nlf.rails.breaks.buildBreakDisplay()),$("#rails-chapters").empty().append(content),onBreak)APP.fns.activateBtn("rails-resume-match",(function(){APP.nlf.rails.breaks.continueMatch()})),APP.fns.activateBtn("rails-suspend-match",(function(){APP.nlf.rails.updateMatchStatus("B",(function(){APP.nlf.exit()}))}));else{if(APP.fns.activateBtn("rails-show-hidden",(function(){APP.nlf.rails.showHiddenSets=!APP.nlf.rails.showHiddenSets,$("#rails-hide-sets").toggleClass("show")})),APP.fns.activateBtn("rails-view-match-report",APP.nlf.rails.launchMatchReport),APP.fns.activateBtn(accordionArr,APP.fns.toggleAccordion),chapterBtnArr.length&&APP.fns.activateBtn(chapterBtnArr,APP.nlf.rails.chapterClick),emptyMatchBtnArr.length)for(var i=0;i<emptyMatchBtnArr.length;i++){var setId=emptyMatchBtnArr[i],ffBtn="player-rails-ff-"+setId,editBtn="player-rails-edit-"+setId;APP.fns.activateBtn(ffBtn,(function(r){var setId=r.split("-")[3];APP.nlf.rails.playerRailsFFShortcut(setId),APP.nlf.goBackFn=function(){APP.nlf.save(),APP.nlf.displayPage(5)},APP.fns.activateBtn("nlf-footer-cancel",APP.nlf.goBackFn)})),APP.fns.activateBtn(editBtn,(function(r){var setId=r.split("-")[3];APP.nlf.rails.playerRailsEditShortcut(setId),APP.nlf.goBackFn=function(){APP.nlf.save(),APP.nlf.displayPage(5)}}))}setLineUpBtnArr.length&&(APP.fns.activateBtn(setLineUpBtnArr,APP.nlf.playerRails.launchLineUpManager),BBAT.fetchData("pr_seen")||APP.nlf.playerRails.showWelcome()),APP.fns.activateBtn("rails-check-update",(function(){APP.reload()})),APP.fns.activateBtn("rails-wipe-local",(function(){APP.confirm.show({title:"Start Over",msg:"Are you sure you want to start this Practice Match again?",ok:function(){APP.nlf.rails.wipePracticeMatch(),APP.reload()}})}))}APP.nlf.data.railsPractice&&$("#nlf-btn-back").hide(),!filtersAvailable||onBreak||APP.nlf.data.railsPractice||APP.nlf.rails.filters.showFilterDialog(),APP.nlf.goBackFn=function(){APP.nlf.rails.closeMatch(),APP.nlf.rails.exitChapterSelect()},APP.nlf.rails.showHiddenSets=!1,APP.nlf.rails.automaticUpdate(),APP.nlf.playerRails.backgroundUpdater.init(),APP.nlf.rails.moveCompleteChapters()}else APP.nlf.displayPage(8)}},chapterInstructions:{content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id="rails-chapters">\n\t\t\t\t\t\t\t<p>Loading &hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){return""},init:function(scope){APP.nlf.ele.main.find(".popup-title span").text("Set Confirmation");var footerContent='\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rails-additional-options" \n\t\t\t\t\t\t\t\t\tclass="button-gray button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tForfeit Options\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t',playerRails=!1,matchInfo=scope.data.railsMatch;matchInfo.player_rails&&"Y"==matchInfo.player_rails&&(playerRails=!0),footerContent+=playerRails?'\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tid="rails-player-rails" \n\t\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tConfirm Teams\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t':'\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\tid="rails-start-match" \n\t\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tStart Set\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t',scope.ele.footerContent.append(footerContent);var content=scope.rails.buildChapterInstructions();$("#rails-chapters").empty().append(content),APP.fns.activateBtn(["rails-start-match"],APP.nlf.rails.startMatch),APP.fns.activateBtn(["rails-player-rails"],(function(){APP.nlf.displayPage(13)})),APP.fns.activateBtn(["rails-additional-options"],(function(){APP.nlf.displayPage(7)})),APP.nlf.goBackFn=function(){APP.nlf.displayPage(5)}}},setOptions:{hideBackBtn:!1,hideExitBtn:!0,content:function(){var data=APP.nlf.data;return`\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id="rails-set-options">\n\t\t\t\t\t\t\t\x3c!--<div class="highlight-box segment-accordion">--\x3e\n\t\t\t\t\t\t\t<div class="accordion segment-accordion invert-content">\n\t\t\t\t\t\t\t\t<div class="header button" id="rails-set-forfeit-opts">\n\t\t\t\t\t\t\t\t\tSelect Forfeit Option\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t\t<div id="rails-set-ff-home" class="button button-red button-lg">\n\t\t\t\t\t\t\t\t\t\tForfeit ${data.railsMatch.home_label}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="rails-set-ff-away" class="button button-red button-lg">\n\t\t\t\t\t\t\t\t\t\tForfeit ${data.railsMatch.away_label}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="rails-set-ff-both" class="button button-red button-lg">\n\t\t\t\t\t\t\t\t\t\tForfeit Both Opponents\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!--<div class="highlight-box segment-accordion">--\x3e\n\t\t\t\t\t\t\t<div class="accordion segment-accordion invert-content">\n\t\t\t\t\t\t\t\t<div class="header button" id="rails-set-win-opts">\n\t\t\t\t\t\t\t\t\tSelect Winning Opponent\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t\t<div id="rails-set-win-home" class="button button-red button-lg">\n\t\t\t\t\t\t\t\t\t\tAward win to ${data.railsMatch.home_label}\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="rails-set-win-away" class="button button-red button-lg">\n\t\t\t\t\t\t\t\t\t\tAward win to ${data.railsMatch.away_label}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\x3c!--<div class="accordion button segment-accordion" id="rails-set-player-opts">--\x3e\n\t\t\t\t\t\t\t\x3c!--<div class="highlight-box segment-accordion">\n\t\t\t\t\t\t\t\t<div class="header">\n\t\t\t\t\t\t\t\t\tPlayer Options\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t\tComing Soon&hellip;\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>--\x3e\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){},init:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<div id="nlf-footer-cancel" class="button-red button-md round-corners button">\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("nlf-footer-cancel",APP.nlf.goBackFn),APP.nlf.ele.main.find(".popup-title span").text("Forfeit Options");APP.fns.activateBtn(["rails-set-forfeit-opts","rails-set-win-opts"],APP.fns.toggleAccordion);APP.fns.activateBtn(["rails-set-ff-home","rails-set-ff-away","rails-set-ff-both","rails-set-win-home","rails-set-win-away"],APP.nlf.rails.ff.handleFF),APP.nlf.goBackFn=function(){APP.nlf.displayPage(6)}}},endMatchOptions:{hideFooter:!1,hideBackBtn:!1,hideExitBtn:!0,content:function(){APP.nlf.data;return'\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div id="rails-save-match-options">\n\t\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t\tLoading&hellip;\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},getHeader:function(){},addFooter:function(){APP.nlf.ele.footerContent.empty().append('\n\t\t\t\t\t<div \n\t\t\t\t\t\tid="nlf-go-back" \n\t\t\t\t\t\tclass="button-red button-md round-corners button"\n\t\t\t\t\t>\n\t\t\t\t\t\tReturn to Match\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("nlf-exit-match",(function(){APP.nlf.rails.closeMatch(),APP.nlf.exit()})),APP.fns.activateBtn("nlf-go-back",(function(){APP.nlf.rails.closeMatch(),APP.nlf.displayPage(5)})),APP.nlf.goBackFn=function(){APP.nlf.displayPage(1),APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save()}},init:function(scope){var matchIsComplete=APP.nlf.rails.calculateMatchScore().match_complete;APP.nlf.ele.main.find(".popup-title span").text("Match Options");var content=scope.rails.buildMatchResults();$("#rails-save-match-options").empty().append(content),APP.fns.activateBtn("rails-view-match-report",APP.nlf.rails.launchMatchReport),APP.fns.activateBtn("rails-opt-report",APP.nlf.rails.launchMatchReport),APP.fns.activateBtn("rails-opt-suspend",(function(){APP.confirm.show({msg:'<span class="bold">Suspend this match?</span><br />You may resume this match at any time. ',ok:function(){APP.nlf.rails.closeMatch(),APP.nlf.exit()}})})),APP.fns.activateBtn("rails-opt-new",(function(){APP.nlf.rails.closeMatch(),APP.nlf.playerRails.isPlayerRails()?APP.nlf.rails.exitChapterSelect():APP.nlf.rails.isTempTeamTournament()?APP.nlf.exit(!0):APP.nlf.rails.exitChapterSelect()})),APP.fns.activateBtn("rails-opt-exit",(function(){var msg="Are you sure you want to exit this league?";APP.nlf.rails.checkWdfRules()&&(msg="Are you sure you want to exit this competition?"),APP.confirm.show({msg:msg,ok:function(){if(BBAT.flushData("keep_alley_open"),APP.nlf.data.rails)return APP.nlf.rails.closeMatch(),void APP.nlf.rails.exitAlleyRails();APP.nlf.exit()}})})),APP.fns.activateBtn("rails-opt-replay",(function(){APP.nlf.rails.replayMatch=!0,APP.nlf.displayPage(5)})),APP.fns.activateBtn("rails-opt-wipe-practice",(function(){APP.nlf.rails.wipePracticeMatch(),APP.reload()})),APP.fns.activateBtn("rails-opt-early-save",(function(){APP.nlf.rails.earlySave()})),APP.nlf.data.railsPractice&&$("#nlf-btn-back").hide(),matchIsComplete||this.addFooter(),APP.nlf.goBackFn=function(){APP.nlf.rails.calculateMatchScore().match_complete?(APP.nlf.rails.closeMatch(),APP.nlf.rails.exitChapterSelect()):APP.nlf.displayPage(5)}}},legacyMatch:{content:function(){return`\n\t\t\t\t\t<div id='nlf-header'>\n\t\t\t\t\t\t${this.getHeader()}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id="rails-chapters">\n\t\t\t\t\t\t\t<h4 class="subheading">\n\t\t\t\t\t\t\t\tChapter Select\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<p>Loading &hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},getHeader:function(){return""},addFooter:function(){APP.nlf.ele.footerContent.empty().append('\n\t\t\t\t\t<div\n\t\t\t\t\t\tid="nlf-go-back" \n\t\t\t\t\t\tclass="button-red button-md round-corners button"\n\t\t\t\t\t>\n\t\t\t\t\t\tBack\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("nlf-go-back",(function(){APP.nlf.displayPage(1),APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save()})),APP.nlf.goBackFn=function(){APP.nlf.displayPage(1),APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save()}},init:function(scope){APP.nlf.ele.main.find(".popup-title span").text("Match Complete"),this.addFooter(),content=scope.rails.buildLegacyMatchWarning(),$("#rails-chapters").empty().append(content),APP.fns.activateBtn("rails-view-match-report",APP.nlf.rails.launchMatchReport),APP.nlf.goBackFn=function(){APP.nlf.rails.exitChapterSelect()}}},forfeitPlayers:{content:function(){return'\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div style="margin-bottom: 0.67em">\n\t\t\t\t\t\t\t<h4 id="rails-ff-intro-text" class="noMargin text-gold" style="margin-top: 0"></h4>\n\t\t\t\t\t\t\t<div id="rails-ff-match-type"></div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="rails-ff" class="player-select">\n\t\t\t\t\t\t\t<p>Loading &hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.nlf.ele.main.find(".popup-title span").text("Select Players"),this.addFooter(scope);$("#rails-ff").empty().append("Loading &hellip;"),APP.nlf.rails.ff.init(),APP.nlf.goBackFn=function(){APP.nlf.displayPage(7)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rails-cancel-ff" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rails-do-ff" \n\t\t\t\t\t\t\t\t\tclass="button-green button-disabled button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tConfirm\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("rails-do-ff",APP.nlf.rails.ff.doFF),APP.fns.activateBtn("rails-cancel-ff",(function(){APP.nlf.displayPage(7)}))}},newShield:{hideFooter:!0,hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div id="nlf-matches">\n\t\t\t\t\t\t\t<svg class="svg-icon" viewBox="0 0 40 28" style="height: 6em; width: 12em;">\n\t\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="pp-red-line" style="width: 100%; font-size: 0.3em;">&nbsp;</div>\n\n\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t<h4 class="text-gold subheading noMargin">\n\t\t\t\t\t\t\t\tLoading\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<h4 class="noMargin" style="font-weight: normal;">\n\t\t\t\t\t\t\t\tPlease Wait&hellip;\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.nlf.ele.main.find(".popup-title span").html("&nbsp;"),$("#nlf-btn-close").hide();$(".popup-title").append('\n\t\t\t\t\t<a id="nlf-shield-reload" href=\'javascript:void(0); APP.reload();\' class="button popup-header-svg-button right button-info">\n\t\t\t\t\t\t<svg class="svg-icon" viewBox="0 0 40 28" style="height: 1em; width: 1em;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-reload"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</a>\n\t\t\t\t')}},manualMatchBuilder:{content:function(){return'\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div style="margin-bottom: 0.67em">\n\t\t\t\t\t\t\t<h4 id="rails-mm-intro-text" class="noMargin text-gold" style="margin-top: 0"></h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="rails-mm" class="oppo-select">\n\t\t\t\t\t\t\t<p>Loading &hellip;</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.nlf.ele.main.find(".popup-title span").text("Select Opponent"),this.addFooter(scope);$("#rails-mm").empty().append("Loading &hellip;"),APP.nlf.rails.manualMatch.init(),APP.nlf.goBackFn=function(){APP.nlf.displayPage(1)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rails-cancel-mm" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rails-do-mm" \n\t\t\t\t\t\t\t\t\tclass="button-green button-disabled button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCreate Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("rails-do-mm",APP.nlf.rails.manualMatch.createMatch),APP.fns.activateBtn("rails-cancel-mm",(function(){APP.nlf.displayPage(7)}))}},playerLineUps:{hideExitBtn:!0,content:function(){return"\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id=\"p-rails-lineups\">\n\t\t\t\t\t\t\tLoading &hellip;\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"},init:function(scope){APP.nlf.ele.main.find(".popup-title span").html("Lineups"),this.addFooter(scope);var content=APP.nlf.playerRails.buildLineUps();$("#p-rails-lineups").empty().append(content),APP.fns.activateBtn("p-rails-reload-lineups",(function(){APP.nlf.playerRails.updateLineUpPlatform()})),APP.fns.activateBtn("p-rails-start-match-err",(function(){APP.nlf.playerRails.startMatch(!0)})),$("#p-rails-edit-players-home").length&&APP.fns.activateBtn("p-rails-edit-players-home",(function(){APP.nlf.playerRails.selectLineUp("home")})),$("#p-rails-edit-players-away").length&&APP.fns.activateBtn("p-rails-edit-players-away",(function(){APP.nlf.playerRails.selectLineUp("away")})),$("#p-rails-add-players-home").length&&APP.fns.activateBtn("p-rails-add-players-home",(function(){APP.nlf.playerRails.selectLineUp("home")})),$("#p-rails-add-players-away").length&&APP.fns.activateBtn("p-rails-add-players-away",(function(){APP.nlf.playerRails.selectLineUp("away")})),APP.nlf.goBackFn=function(){APP.nlf.displayPage(5)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\x3c!--<div \n\t\t\t\t\t\t\t\t\tid="p-rails-reload-lineups" \n\t\t\t\t\t\t\t\t\tclass="button-info button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tReload Lineups\n\t\t\t\t\t\t\t\t</div>--\x3e\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tid="p-rails-do-ff"\n\t\t\t\t\t\t\t\t\tclass="button-gray button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tForfeit Options\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-start-match" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tStart\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("p-rails-reload-lineups",(function(){APP.nlf.playerRails.updateLineUpPlatform()})),APP.fns.activateBtn("p-rails-do-ff",(function(){APP.nlf.displayPage(7)})),APP.fns.activateBtn("p-rails-start-match",(function(){APP.nlf.playerRails.startMatch()}))}},selectLineUp:{hideExitBtn:!0,content:function(){return"\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id=\"p-rails-select-lineup\">\n\t\t\t\t\t\t\tLoading &hellip;\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"},init:function(scope){APP.nlf.ele.main.find(".popup-title span").html("Select Lineup"),this.addFooter(scope),APP.nlf.playerRails.setEditData();var content=APP.nlf.playerRails.buildSelectLineUp();$("#p-rails-select-lineup").empty().append(content),$("#p-rails-add-player-0").length&&APP.fns.activateBtn("p-rails-add-player-0",(function(){APP.nlf.playerRails.addPlayer(0)})),$("#p-rails-add-player-1").length&&APP.fns.activateBtn("p-rails-add-player-1",(function(){APP.nlf.playerRails.addPlayer(1)})),$("#p-rails-add-player-2").length&&APP.fns.activateBtn("p-rails-add-player-2",(function(){APP.nlf.playerRails.addPlayer(2)})),$("#p-rails-add-player-3").length&&APP.fns.activateBtn("p-rails-add-player-3",(function(){APP.nlf.playerRails.addPlayer(3)})),$("#p-rails-edit-player-0").length&&APP.fns.activateBtn("p-rails-edit-player-0",(function(){APP.nlf.playerRails.editPlayer(0)})),$("#p-rails-edit-player-1").length&&APP.fns.activateBtn("p-rails-edit-player-1",(function(){APP.nlf.playerRails.editPlayer(1)})),$("#p-rails-edit-player-2").length&&APP.fns.activateBtn("p-rails-edit-player-2",(function(){APP.nlf.playerRails.editPlayer(2)})),$("#p-rails-edit-player-3").length&&APP.fns.activateBtn("p-rails-edit-player-3",(function(){APP.nlf.playerRails.editPlayer(3)})),APP.nlf.goBackFn=function(){try{if(APP.nlf.playerRails.editData.teamLineUp)return void APP.nlf.displayPage(16)}catch(e){}APP.nlf.displayPage(13)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-reload-lineups-edit" \n\t\t\t\t\t\t\t\t\tclass="button-info button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCheck for Updates\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-confirm-team" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tContinue\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("p-rails-reload-lineups-edit",(function(){APP.nlf.playerRails.updateLineUpPlatform()})),APP.fns.activateBtn("p-rails-confirm-team",(function(){var msg,title,activeTeam=APP.nlf.playerRails.editData.activeTeam,playerRailsObj=APP.nlf.playerRails.getPlayerRailsObj(),expectedTeamSize=APP.nlf.playerRails.getExpectedTeamSize();try{if(APP.nlf.playerRails.editData.teamLineUp)return void APP.nlf.displayPage(16)}catch(e){}switch(playerRailsObj[activeTeam]){case"ready":return void APP.nlf.displayPage(13);case"error":title="An Error Occurred",msg="\n\t\t\t\t\t\t\t\tWe could not load your player list<br />\n\t\t\t\t\t\t\t\tYou can continue to select players manually\n\t\t\t\t\t\t\t";break;case"empty":title="No Players Selected",msg="\n\t\t\t\t\t\t\t\tYou have not selected any players<br />\n\t\t\t\t\t\t\t\tDo you want to continue?\n\t\t\t\t\t\t\t";break;case"short":var teamSize=0,teamPlayers=playerRailsObj.homePlayers;"away"==activeTeam&&(teamPlayers=playerRailsObj.awayPlayers);for(var i=0;i<teamPlayers.length;i++)-1!==teamPlayers[i]&&teamSize++;title="Team is short",msg=`\n\t\t\t\t\t\t\t\tYou have selected <span class="bold text-red">${teamSize}</span> of <span class="bold text-green">${expectedTeamSize}</span> players\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\tAre you sure you want to play at a disadvantage?\n\t\t\t\t\t\t\t`}APP.confirm.show({title:title,msg:msg,ok:function(){APP.nlf.displayPage(13)}})}))}},editLineUp:{hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'nlf-main\'>\n\t\t\t\t\t\t<div id="p-rails-edit-lineup-header" class="mMdBottom"></div>\n\t\t\t\t\t\t<div id="p-rails-player-selector"></div>\n\t\t\t\t\t\t<div id="p-rails-edit-lineup-tip"></div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){var title="Edit Lineup",editData=APP.nlf.playerRails.editData,editMode=editData.mode,editSize=editData.size,editLabel=editData.label,editTeam=editData.teamLabel;"add"==editMode&&(title="Select Players",APP.nlf.data.railsChapter.set_number&&(title="Set "+APP.nlf.data.railsChapter.set_number,APP.nlf.data.railsChapter.segment_label?title+=": "+APP.nlf.data.railsChapter.segment_label:title+=" - Select Players")),APP.nlf.ele.main.find(".popup-title span").html(title);$("#p-rails-edit-lineup").empty().append("Loading &hellip;");var header="Select Player";"add"==editMode&&(header=editSize>1?`Select ${editSize} Players from <span class="bold text-gold">${editTeam}</span>`:`Select Player from <span class="bold text-gold">${editTeam}</span>`),"edit"==editMode&&(header=`Select a Player to replace<br /><span class="bold text-gold">${editLabel}</span>`),$("#p-rails-edit-lineup-header").empty().append(header);var tip="";"add"==editMode&&(tip=`\n\t\t\t\t\t\t<div class="highlight-box rails-tip">\n\t\t\t\t\t\t\t<span class="bold">Pro Tip:</span> Select ${editSize} players to add to your lineup.\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`),$("#p-rails-edit-lineup-tip").empty().append(tip),$("#p-rails-player-selector").empty(),APP.nlf.playerRails.buildPlayerList(),this.addFooter(scope),APP.nlf.goBackFn=function(){APP.nlf.playerRails.cancelEditPlayer()}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-edit-lineup-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-confirm-lineup" \n\t\t\t\t\t\t\t\t\tclass="button-disabled button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSave Changes\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("p-rails-edit-lineup-cancel",(function(){APP.nlf.playerRails.cancelEditPlayer()})),APP.fns.activateBtn("p-rails-confirm-lineup",(function(){APP.nlf.playerRails.confirmEditPlayer()}))}},teamLineUps:{hideExitBtn:!0,content:function(){return"\n\t\t\t\t\t<div id='nlf-main'>\n\t\t\t\t\t\t<div id=\"p-rails-team-line-up\">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t"},init:function(scope){var lineUpBlock=APP.nlf.playerRails.buildLineUpManager();$("#p-rails-team-line-up").empty().append(lineUpBlock.content);var title="Lineup Manager";try{var match=APP.nlf.data.railsMatch;"home"==APP.nlf.playerRails.editData.lineUp.selectedTeam?(teamLabel=match.home_label,team="home"):(teamLabel=match.away_label,team="away"),title=`Create Lineup for <span class="text-gold bold" style="display: inline">${teamLabel}</span></h4>`}catch(e){console.log(e)}APP.nlf.ele.main.find(".popup-title span").html(title),lineUpBlock.btnArr&&lineUpBlock.btnArr.length&&APP.fns.activateBtn(lineUpBlock.btnArr,APP.nlf.playerRails.handlePlayerRailsBtn),this.addFooter(scope);var selectedSegment=APP.nlf.playerRails.editData.lineUp.selectedSegment;selectedSegment&&window.setTimeout((function(){APP.nlf.playerRails.scrollToLineUpBlock(selectedSegment),APP.nlf.playerRails.editData.lineUp.selectedSegment=null}),100),BBAT.storeData({pr_tooltip_seen:!0}),APP.nlf.goBackFn=function(){APP.nlf.displayPage(5)},window.setTimeout((function(){APP.nlf.playerRails.editData.lineUp.scrollPos&&(document.getElementById("nlf-scroll-box").scrollTop=APP.nlf.playerRails.editData.lineUp.scrollPos)}),1)},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\x3c!--<td width="50%">\n\t\t\t\t\t\t\t\t\x3c!--<div \n\t\t\t\t\t\t\t\t\tid="p-rails-edit-lineup-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>--\x3e\n\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="p-rails-confirm-team-line-up" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tBack to Matches\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("p-rails-edit-lineup-cancel",(function(){APP.nlf.displayPage(5)})),APP.fns.activateBtn("p-rails-confirm-team-line-up",(function(){APP.nlf.displayPage(5)}))}},addFilter:{hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id="nlf-main">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="highlight-box primary mLgBottom"\n\t\t\t\t\t\t\tstyle="margin-top: 0; font-size: 0.7em;"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tSelect which sets are to be displayed on this tablet.<br />\n\t\t\t\t\t\t\tAt any time during the match, you can display ALL SETS when needed.\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="grid-container">\n\t\t\t\t\t\t\t<div class="left-col-33">\n\t\t\t\t\t\t\t\t<h4 class="noMargin text-gold text-left" style="padding-top: 0.3em;">\n\t\t\t\t\t\t\t\t\tTablet Label\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="right-col-66">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-md button-gray round-corners" id="rails-filter-tablet-label"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSet Label\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="rails-filters-content">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="ss-rails-filter" class="text-left">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){var tabletLabel=APP.nlf.rails.filters.getData().label,data={id:"rails-filter-tablet-label",title:"Set Label",options:[{display:"Tablet 1",value:"tl-1"},{display:"Tablet 2",value:"tl-2"},{display:"Tablet 3",value:"tl-3"},{display:"Tablet 4",value:"tl-4"},{display:"Custom",value:"tl-custom",class:"dialogBtn button button-menu button-info mLgBottom round-corners"}],defaultText:tabletLabel||"Set Label",callback:function(val,display){"tl-custom"!=val?APP.nlf.rails.filters.updateLabel(display):APP.prompt.show({title:"Enter Custom Label",msg:"",use_close_icon:!0,type:"text",post_display:function(){},close:function(r){if(r)return APP.nlf.rails.filters.updateLabel(r),!0}})}};APP.fns.createOptions(data,!0),tabletLabel&&APP.nlf.rails.filters.updateLabel(tabletLabel);var format,sets,filterObj={},segArr=[];try{sets=(format=scope.data.railsFormat).sets,segArr=scope.rails.getSetSegmentArr(sets)}catch(e){}format&&sets&&segArr.length?(filterObj=scope.rails.filters.createQuickSelect(format),scope.rails.filters.getCurrentFilters(segArr),scope.rails.filters.createSpiceSelector(segArr)):(APP.recordError("Filters - No Chapter Detected"),filterObj.content='\n\t\t\t\t\t\t<div class="mLgTop">No Sets Detected - Please Try Again Later</div>\n\t\t\t\t\t'),$("#rails-filters-content").empty().append(filterObj.content);scope.ele.main.find(".popup-title span").html("Create a Match Filter"),this.addFooter(scope),APP.fns.activateBtn("rf-select-even",(function(){APP.nlf.rails.filters.quickFilter("even")})),APP.fns.activateBtn("rf-select-odd",(function(){APP.nlf.rails.filters.quickFilter("odd")})),APP.fns.activateBtn("rf-reset-all",(function(){APP.nlf.rails.filters.quickFilter("reset")})),APP.nlf.goBackFn=function(){APP.nlf.displayPage(5)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rf-filters-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rf-filters-apply" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tApply Filter\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("rf-filters-apply",(function(){APP.nlf.rails.filters.applyFilters()})),APP.fns.activateBtn("rf-filters-cancel",(function(){APP.nlf.displayPage(5)}))}},confFilters:{hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id="nlf-main">\n\t\t\t\t\t\t\x3c!--<div\n\t\t\t\t\t\t\tclass="highlight-box primary mLgBottom"\n\t\t\t\t\t\t\tstyle="margin-top: 0; font-size: 0.7em;"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tSelect which sets are to be displayed on this tablet.<br />\n\t\t\t\t\t\t\tAt any time during the match, you can display ALL SETS when needed.\n\t\t\t\t\t\t</div>--\x3e\n\n\t\t\t\t\t\t<div id="rails-filters-confirm">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){for(var filterData=APP.nlf.rails.filters.getData(),filters=filterData.arr,tabletLabel=filterData.label,content=`\n\t\t\t\t\t<h4 class="nlf-header mNoneTop">\n\t\t\t\t\t\tConfirm Sets For<br />\n\t\t\t\t\t\t<span class="text-gold" style="font-size:1.6em; line-height: 1.4em;">${tabletLabel||"This Tablet"}</span>\n\t\t\t\t\t</h4>\n\n\t\t\t\t\t<hr />\n\t\t\t\t`,setSegArr=APP.nlf.rails.getSetSegmentArr(),incSets={},i=0;i<setSegArr.length;i++)for(var sets=(seg=setSegArr[i]).sets,j=0;j<sets.length;j++){var set=sets[j];-1!==filters.indexOf(set.set_number)&&(incSets["seg"+seg.segNo]||(incSets["seg"+seg.segNo]={seg:seg.segLabel,sets:[]}),incSets["seg"+seg.segNo].sets.push(set.set_number))}for(var key in content+='<div class="text-left">',incSets){var seg;content+=`\n\t\t\t\t\t\t<div class="left-col-100 bold pMdBottom mLgTop">\n\t\t\t\t\t\t\t${(seg=incSets[key]).seg}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;for(i=0;i<seg.sets.length;i++)content+=`\n\t\t\t\t\t\t\t<div class="pSmBottom" style="font-style: italic;font-size: 0.9em;margin-bottom: 0.3em;">\n\t\t\t\t\t\t\t\t<span class="pMedRight">\n\t\t\t\t\t\t\t\t\tSet ${seg.sets[i]}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;content+="<hr>"}content+="</div>",$("#rails-filters-confirm").empty().append(content);scope.ele.main.find(".popup-title span").html("Add Match Filter"),this.addFooter(scope),APP.nlf.goBackFn=function(){APP.nlf.displayPage(17)}},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rf-filters-conf-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tEdit/Change\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="rf-filters-conf-confirm" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tConfirm\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("rf-filters-conf-confirm",(function(){APP.nlf.displayPage(5)})),APP.fns.activateBtn("rf-filters-conf-cancel",(function(){APP.nlf.displayPage(17)}))}}}},APP.cif={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="Check In: ";message+=msg,console.log(message)}},active:!1,init:function(pageNo){APP.user_options.backup_tablet?APP.cif.startMatch():(pageNo&&(this.flowData.pageNo=pageNo),this.flow=new UIFlow(this.flowData),APP.cif.buildBracketSelectedMatchParts()&&(APP.popup.hide("popup-bracket-match-listing"),this.startMatchCheckTimer()))},flow:null,timers:{waitTimer:null,lateTimer:null,statusTimer:null,killTimers:function(){var timers=APP.cif.timers;timers.waitTimer&&(timers.waitTimer.stopTimer(),timers.waitTimer=null),timers.lateTimer&&(timers.lateTimer.stopTimer(),timers.lateTimer=null),timers.statusTimer&&(timers.statusTimer.stopTimer(),timers.statusTimer=null)}},killTimer:function(timerName){APP.cif.timers[timerName]&&(APP.cif.timers[timerName].stopTimer(),APP.cif.timers[timerName]=null)},lastTimerVal:"",matchStarted:!1,data:{version:8,pageNo:0,markerType:0,markerOpt:0,forfeitOpt:1,type:4,paidMarkers:!1,forfeitWarningSeen:!1,forfeitNoticeSent:!1,matchCallTime:null,markerTimerLate:10,markerTimerMax:10,homeLabel:null,awayLabel:null,markerLabel:null,checkedIn:{home:!1,away:!1,marker:null},raceInfo:null,matchData:null},reloadCheck:function(){this.log("Reload Check");var savedData=BBAT.fetchData("checkin_data");if(savedData){if(!savedData.matchData)return this.log("No match data"),void this.clear();if(this.data.pageNo=savedData.pageNo,savedData.version!=this.data.version)return void this.updateDataStructure();for(var myData=APP.cif.data,keys=Object.keys(savedData),i=0;i<keys.length;i++){var key=keys[i];void 0!==key&&(myData[key]=savedData[key])}if(this.data.pageNo>0)if("PRE-ROLE"!==APP.mode){this.log("Show reloaded content");var displayPage=APP.cif.checkDisplayPage();-1!=displayPage&&(this.data.pageNo=displayPage,this.save(),this.init(this.data.pageNo))}else APP.cif.exitCheckIn(!0,!0)}},updateDataStructure:function(){this.clear(),this.data.pageNo=-1,this.save(),APP.reload()},update:function(pageNo){this.data.pageNo=pageNo,this.save()},save:function(){BBAT.storeData({checkin_data:APP.cif.data})},reset:function(){this.log("resetting data"),this.data.pageNo=0,this.data.type=4,this.data.markerType=0,this.data.markerOpt=0,this.data.forfeitOpt=1,this.data.matchCallTime=null,this.data.markerTimerLate=10,this.data.markerTimerMax=10,this.data.type=2,this.data.forfeitWarningSeen=!1,this.data.forfeitNoticeSent=!1,this.data.homeLabel=null,this.data.awayLabel=null,this.data.markerLabel=null,this.data.checkedIn={home:!1,away:!1,marker:!1},this.data.raceInfo=null,this.data.matchData=null,this.timers.killTimers(),this.save()},clear:function(){this.reset(),BBAT.flushData("checkin_data")},loadMatch:function(matchData,forfeitPassOver){if(matchData.is_forfeit&&!forfeitPassOver)return APP.device.hideSpinnerOverlay(),void APP.confirm.show({title:"Play Match?",msg:"A forfeit request has been sent to event staff. Should you begin match play before it is reviewed, it will be dismissed. <br /><br />Do you want to play this match?",ok:function(){APP.cif.loadMatch(matchData,!0)}});this.reset(),APP.cif.matchStarted=!1;var timestamp=(new Date).toISOString();this.data.matchData=matchData,this.data.raceInfo=APP.fns.buildMatchRace(matchData,1),this.data.homeLabel=matchData.home_button_label,this.data.awayLabel=matchData.away_button_label,this.data.markerLabel=matchData.marker_label;var checkinInfo=matchData.checkin_info;this.data.matchCallTime=checkinInfo.started_checkin_at?checkinInfo.started_checkin_at:timestamp,this.data.markerTimerLate=matchData.checkin_info.marker_timer_late,this.data.markerTimerMax=matchData.checkin_info.marker_timer_max,this.data.type=matchData.checkin_info.type,matchData.paid_markers&&(this.data.paidMarkers=!0),"scotopen22"!=APP.session.getTournamentID()&&"welshopen22"!=APP.session.getTournamentID()||(this.data.paidMarkers=!0),this.setType(this.data.type),this.save(),this.init(),APP.user_options.backup_tablet||(this.getPlatformData(),this.putPlatformCheckin())},setType:function(type){switch(type){case 1:this.data.markerType=1,this.data.markerOpt=0,this.data.forfeitOpt=0;break;case 2:this.data.markerType=1,this.data.markerOpt=1,this.data.forfeitOpt=1;break;case 3:this.data.markerType=2,this.data.markerOpt=0,this.data.forfeitOpt=1;break;case 4:this.data.markerType=0,this.data.markerOpt=0,this.data.forfeitOpt=1;break;case 5:this.data.markerType=0,this.data.markerOpt=0,this.data.forfeitOpt=0;break;case 6:this.data.markerType=1,this.data.markerOpt=1,this.data.forfeitOpt=0;break;default:this.data.markerType=0,this.data.markerOpt=0,this.data.forfeitOpt=1}this.save()},extendHeader:function(){var markerRequired=1==this.data.markerType&&this.data.markerLabel,ele=$("#popup-cif .popup-title");ele.removeClass("waiting").removeClass("active").removeClass("late");var title='\n\t\t\t<div class="content">\n\t\t\t\t<img id="check-in-exit" class="button popup-icon-close" src="images/icon_close.png">\n\t\t\t\t<h4>Player Tablet Check-In</h4>\n\t\t',titleClass="",checkInHelper="";switch(this.data.checkedIn.home&&this.data.checkedIn.away?markerRequired?(this.data.checkedIn.marker&&(checkInHelper='\n\t\t\t\t\t\t<p class="check-in-status">\n\t\t\t\t\t\t\t<span class="status status-positive">Match Ready:</span> Click Start Match\n\t\t\t\t\t\t</p>\n\t\t\t\t\t'),checkInHelper='\n\t\t\t\t\t<p class="check-in-status">\n\t\t\t\t\t\t<span class="status status-negative">Match Not Ready:</span> Scorekeeper must check in\n\t\t\t\t\t</p>\n\t\t\t\t'):checkInHelper='\n\t\t\t\t\t<p class="check-in-status">\n\t\t\t\t\t\t<span class="status status-positive">Match Ready:</span> Click Start Match\n\t\t\t\t\t</p>\n\t\t\t\t':(this.data.checkedIn.home||this.data.checkedIn.away)&&(checkInHelper='\n\t\t\t\t\t<p class="check-in-status">\n\t\t\t\t\t\t<span class="status status-negative">Match Not Ready:</span> All opponents must check in\n\t\t\t\t\t</p>\n\t\t\t\t'),this.data.checkedIn.home||this.data.checkedIn.away||(checkInHelper='\n\t\t\t\t<p class="check-in-status">\n\t\t\t\t\t<span class="status status-negative">Match Not Ready:</span> Opponents must check in\n\t\t\t\t</p>\n\t\t\t'),title+=checkInHelper,this.data.pageNo){case 3:titleClass="late"}title+="</div>",ele.html(title).addClass(titleClass),APP.fns.activateBtn("check-in-exit",APP.cif.exitCheckIn)},exitCheckIn:function(preflight,silent){"boolean"==typeof preflight?(APP.cif.data.checkedIn.home=!1,APP.cif.data.checkedIn.away=!1,APP.cif.data.checkedIn.marker=!1,APP.cif.save(),silent||APP.cif.putPlatformCheckin(),APP.cif.reset(),APP.cif.flow.exit(),APP.popup.show("popup-bracket-match-listing")):APP.confirm.show({title:"Exit Check In",msg:"Are you sure you want to change match?",ok:function(){APP.cif.exitCheckIn(!0)}})},resetCheckIn:function(){APP.cif.timers.killTimers(),APP.cif.data.checkedIn.home=!1,APP.cif.data.checkedIn.away=!1,APP.cif.data.checkedIn.marker=!1,APP.cif.save(),APP.cif.putPlatformCheckin(),APP.cif.loadCorrectPage()},calculateTime:function(force){if(!this.data.matchCallTime)return!1;var callTime=moment(this.data.matchCallTime),now=moment();callTime.date()!==now.date()&&(callTime=callTime.set("date",now.date())),callTime.month()!==now.month()&&(callTime=callTime.set("month",now.month())),callTime.year()!==now.year()&&(callTime=callTime.set("year",now.year()));var diff=now.diff(callTime,"seconds");return!isNaN(diff)&&((force||!(diff>60*APP.cif.data.markerTimerLate))&&diff)},buildTimeDisplay:function(timerName,isLate){var content=`\n\t\t\t<p id="${timerName}">\n\t\t\t\t<span class="cif-timer bold ${isLate?"text-red":""}"></span>\n\t\t\t\t<span class="cif-timer-blurb">Time since first DC match notification</span>\n\t\t\t</p>\n\t\t`,noDisplay=`\n\t\t\t<p id="${timerName}">\n\t\t\t\t<span class="cif-timer bold">&nbsp;</span>\n\t\t\t</p>\n\t\t`;return APP.cif.lastTimerVal&&-1===APP.cif.lastTimerVal.toString().indexOf("-")?content:noDisplay},updateTimeDisplay:function(timerName,isLate){var content=`\n\t\t\t<span class="cif-timer bold ${isLate?"text-red":""}">\n\t\t\t\t${APP.cif.lastTimerVal}\n\t\t\t</span>\n\t\t\t<span class="cif-timer-blurb">Time since first DC match notification</span>\n\t\t`,ele=document.querySelector("#"+timerName);ele&&(APP.cif.lastTimerVal&&-1===APP.cif.lastTimerVal.toString().indexOf("-")?ele.innerHTML=content:ele.innerHTML='\n\t\t\t<span class="cif-timer bold">&nbsp;</span>\n\t\t')},matchIsLate:function(){APP.cif.log("Match is late"),APP.cif.timers.killTimers(),APP.cif.flow.displayPage(3)},checkInPlayer:function(player,preflight){var reqPreFlight=!1;if(1==player||2==player)switch(player){case 1:this.data.checkedIn.home||this.data.checkedIn.away&&(reqPreFlight=!0);break;case 2:this.data.checkedIn.away||this.data.checkedIn.home&&(reqPreFlight=!0)}if(!reqPreFlight||preflight){switch(player){case 1:this.data.checkedIn.home=!this.data.checkedIn.home,this.save();break;case 2:this.data.checkedIn.away=!this.data.checkedIn.away,this.save();break;case 3:this.data.checkedIn.marker=!this.data.checkedIn.marker,this.save()}this.putPlatformCheckin(),this.loadCorrectPage()}else{switch(player){case 1:if(this.data.checkedIn.home)return void APP.cif.checkInPlayer(player,!0);break;case 2:if(this.data.checkedIn.away)return void APP.cif.checkInPlayer(player,!0);break;case 3:if(this.data.checkedIn.marker)return void APP.cif.checkInPlayer(player,!0)}switch(player){case 1:APP.cif.data.homeLabel;break;case 2:APP.cif.data.awayLabel;break;case 3:APP.cif.data.markerLabel}APP.confirm.show({title:"Confirm Check In",msg:"\n\t\t\t\t<p>Please confirm both opponents are ready to begin the match. If not, select CANCEL.</p>\n\t\t\t",ok_text:"Confirm",cancel_text:"Cancel",ok:function(){APP.cif.checkInPlayer(player,!0),APP.cif.loadCorrectPage()}})}},checkDisplayPage:function(){var markerRequired=1==this.data.markerType&&this.data.markerLabel;return this.calculateTime()?this.data.checkedIn.home&&this.data.checkedIn.away?markerRequired?this.data.checkedIn.marker?-1:2:-1:this.data.checkedIn.home||this.data.checkedIn.away?2:1:this.data.checkedIn.home&&this.data.checkedIn.away?markerRequired?this.data.checkedIn.marker?-1:3:-1:3},loadCorrectPage:function(){if(!APP.cif.matchStarted){var displayPage=APP.cif.checkDisplayPage();if(-1==displayPage)return APP.cif.log("Match is ready"),APP.cif.startMatch(),APP.cif.reset(),void APP.cif.flow.exit();APP.cif.timers.killTimers(),APP.cif.data.pageNo=displayPage,APP.cif.save(),APP.cif.flow.displayPage(APP.cif.data.pageNo)}},playWithoutMarker:function(preflight,differentMarker){if(!preflight){var content="\n\t\t\t\tAre you sure you want to play this match without a scorekeeper?\n\t\t\t";return differentMarker&&(content="Are you sure you want to play this match with a different scorekeeper?"),void APP.confirm.show({title:"Confirm Scorekeeper Option",msg:content,ok_text:"Confirm",cancel_text:"Cancel",ok:function(){APP.cif.playWithoutMarker(!0)}})}APP.cif.data.markerType=0,APP.cif.save(),APP.cif.loadCorrectPage()},activateForfeitBtn:function(){data={id:"cif-request-forfeit",title:"Report Missing Opponent",options:[{display:"Report "+APP.cif.data.homeLabel,value:"ff-home"},{display:"Report "+APP.cif.data.awayLabel,value:"ff-away"},{display:"Report Both Opponents",value:"ff-both"}],defaultText:"Report Missing Opponent",callback:function(val,display){if(-1!=val)return APP.device.showSpinnerOverlay(),APP.alert.show("Your report has been sent"),void APP.cif.putPlatformEarlyExit(val)}},APP.fns.createOptions(data,!0)},activateReportBtn:function(){var data={id:"cif-report-oppo",title:"Report Missing Opponent",options:[{display:"Report "+APP.cif.data.homeLabel,value:"ff-home"},{display:"Report "+APP.cif.data.awayLabel,value:"ff-away"},{display:"Report Both Opponents",value:"ff-both"}],defaultText:"Report Missing Opponent",callback:function(val,display){if(-1==val);else{var missingOppo=display,msg=missingOppo=missingOppo.replace("Report ",""),matchString=msg+="Both Opponents"==missingOppo?" have been reported missing":" has been reported missing",message={action:"HELP__MSG",message:{message:val="missingOpponent"},tournament_id:APP.session.getTournamentID(),board_number:APP.cif.data.matchData.board_number,event_id:APP.cif.data.matchData.bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:APP.cif.data.matchData.bracket_match_id};APP.message.send.helpMessage(message)}}};APP.fns.createOptions(data,!0)},activateMoreMarkerOptsBtn:function(){data={id:"cif-marker-options",title:"More Scorekeeper Options",options:[{display:"Play with a different Scorekeeper",value:"marker-different"},{display:"Play without Scorekeeper",value:"marker-without"},{display:APP.cif.data.paidMarkers?"Request a <span class='bold'>Paid</span> Scorekeeper":"Request a Scorekeeper",value:"marker-request"}],defaultText:"More Scorekeeper Options",callback:function(val,display){switch(val){case"marker-different":APP.cif.playWithoutMarker(!1,!0);break;case"marker-without":APP.cif.playWithoutMarker();break;case"marker-request":APP.cif.requestMarker()}}},APP.fns.createOptions(data,!0)},checkChalkerUpdate:function(matchList){if(matchList.matches)try{var matchData=APP.cif.data.matchData,matchName=matchData.bracket_match_id+"_"+matchData.bracket_event_id,updatedMatch=matchList.matches[matchName];if(updatedMatch){var checkInTime=updatedMatch.checkin_info.started_checkin_at,markerLabel=updatedMatch.marker_label,updated=!1;APP.cif.data.matchCallTime!==checkInTime&&(APP.cif.data.matchCallTime=checkInTime,updated=!0),APP.cif.data.markerLabel!==markerLabel&&(APP.cif.data.markerLabel=markerLabel,updated=!0),updated&&(APP.cif.save(),APP.cif.loadCorrectPage())}}catch(e){}},putPlatformCheckin:function(){try{var matchId=APP.cif.data.matchData.match_id,url=APP.getApi2Url()+"tournament-matches/checkin/"+matchId,data={home_competitor:APP.cif.data.checkedIn.home,away_competitor:APP.cif.data.checkedIn.away,marker:APP.cif.data.checkedIn.marker};APP.server.squeue.enQueue({type:"API2",mode:"PUT",caller:"APP.cif",url:url,process_data:!1,data:JSON.stringify(data),on_success:function(in_data){}})}catch(e){}},getPlatformData:function(){APP.device.showSpinnerOverlay();var matchId=APP.cif.data.matchData.match_id,url=APP.getApi2Url()+"tournament-matches/checkin/"+matchId;APP.fns.doCall(url,{_emptyData:!0},"GET",(function(r){r&&r.payload&&r.payload.started_checkin_at&&(APP.cif.data.matchCallTime=r.payload.started_checkin_at,APP.cif.save(),APP.cif.loadCorrectPage()),APP.device.hideSpinnerOverlay()}),(function(e){APP.device.hideSpinnerOverlay()}),{Authorization:"Bearer DacslVVURVO11d5i2ZIQYlfqlR9lrcqgVJWvdV6rLJnNtVpjC1VqpCzvD2xypila"})},putPlatformEarlyExit:function(type,inMatch){var matchId=APP.cif.data.matchData.match_id;if(type){var result=type.split("-"),exitType=result[0];exitType="ff"==exitType?"forfeit":"disqualification";var player=result[1],url=APP.getApi2Url()+"tournament-matches/request-forfeit/"+matchId,data={type:exitType,competitor:player,source:"Scoring App"};APP.fns.doCall(url,data,"PUT",(function(r){APP.device.hideSpinnerOverlay(),APP.alert.show("Your forfeit request has been sent"),APP.cif.exitCheckIn(!0,!0)}),(function(e){APP.device.hideSpinnerOverlay(),APP.alert.show("Your forfeit request failed to send. Please try again.")}),{Authorization:"Bearer DacslVVURVO11d5i2ZIQYlfqlR9lrcqgVJWvdV6rLJnNtVpjC1VqpCzvD2xypila"})}},sendForfeitNotice:function(){APP.cif.data.forfeitNoticeSent=!0,APP.cif.save()},requestAssistant:function(preflight){if(preflight){var matchString=APP.cif.data.matchData.home_button_label.replace("<br />"," &amp; ")+" Vs. "+APP.cif.data.matchData.away_button_label.replace("<br />"," &amp; "),message={action:"HELP__MSG",message:{message:"officialNeeded"},tournament_id:APP.session.getTournamentID(),board_number:APP.cif.data.matchData.board_number,event_id:APP.cif.data.matchData.bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:APP.cif.data.matchData.bracket_match_id};APP.message.send.helpMessage(message)}else{APP.confirm.show({title:"Request Assistance",msg:"\n\t\t\t\tAre you sure you want to request assistance?\n\t\t\t",ok_text:"Yes - Help",cancel_text:"No - I'm fine",ok:function(){APP.cif.requestAssistant(!0)}})}},requestMarker:function(preflight){if(preflight){var matchString=APP.cif.data.matchData.home_button_label.replace("<br />"," &amp; ")+" Vs. "+APP.cif.data.matchData.away_button_label.replace("<br />"," &amp; "),message={action:"HELP__MSG",message:{message:"markerNeeded"},tournament_id:APP.session.getTournamentID(),board_number:APP.cif.data.matchData.board_number,event_id:APP.cif.data.matchData.bracket_event_id,match_string:matchString,bracket_api_url:APP.session.getFromTournament("bracket_api_url"),bracket_match_id:APP.cif.data.matchData.bracket_match_id};APP.message.send.helpMessage(message)}else{var content=`\n\t\t\t\tAre you sure you want to ${APP.cif.data.paidMarkers?"request a <span class='bold'>Paid</span> scorekeeper":"request a scorekeeper"}?\n\t\t\t`;APP.confirm.show({title:APP.cif.data.paidMarkers?"Request a Paid Scorekeeper":"Request a Scorekeeper",msg:content,ok_text:"Yes",cancel_text:"No",ok:function(){APP.cif.requestMarker(!0)}})}},startMatch:function(){var e_id,m_id,r_id,j,p,m,roster;APP.cif.matchStarted=!0;var head=APP.header,sess=APP.session;e_id=sess.bracket_selected_match_parts[1],r_id=sess.bracket_selected_match_parts[2],m_id=sess.bracket_selected_match_parts[3];var rrGroup,match,rrOverride=!1;try{if((match=APP.session.bracket.match_list[m_id]).rr_group)APP.session.getRoundRobinOverride(match)&&(rrOverride=!0,rrGroup=match.rr_group)}catch(e){}var deOverride=!1;try{match=APP.session.bracket.match_list[m_id],deOverride=APP.session.getDEOverrides(match,!0)}catch(e){}sess.setBracketMatch(e_id,m_id),sess.hideBracketMatchListing();var override=r_id;if(rrOverride&&(override=rrGroup),deOverride&&(override=deOverride),sess.startNew("TOURNAMENT"),sess.setBracketMatchFormat(e_id,override),m=sess.getBracketMatchObject(m_id)){sess.setMatchMoney(m.round_id),APP.session.isOptimizedBracketRoster()&&APP.cif.loadMatchPlayers(m),head.roster_left=new head.Roster,head.roster_right=new head.Roster;var homePlayers=m.home_players;for((roster=head.roster_left).select_players=!0,j=0;j<homePlayers.length;j++)p=homePlayers[j],roster.addPlayer({obj_id:"P"+p.dc_tournament_player_id,player_guid:p.dc_tournament_player_id});var awayPlayers=m.away_players;for((roster=head.roster_right).select_players=!0,j=0;j<awayPlayers.length;j++)p=awayPlayers[j],roster.addPlayer({obj_id:"P"+p.dc_tournament_player_id,player_guid:p.dc_tournament_player_id});head.recordOpponentChange(),APP.device.is_broadcasting||APP.handleAlleyOption("pcm-broadcast-start-button");try{APP.session.getBracketMatchGameCount()>1&&APP.session.showBullShoot()}catch(e){}}else APP.alert.show("Match not found - you may have to manually select opponents")},getCheckInStatus:function(){var markerRequired=1==this.data.markerType&&this.data.markerLabel;return this.data.checkedIn.home||this.data.checkedIn.away?this.data.checkedIn.home&&this.data.checkedIn.away?this.data.checkedIn.home&&this.data.checkedIn.away&&markerRequired?this.data.checkedIn.marker?"matchReady":"missingMarker":"matchReady":markerRequired&&!this.data.checkedIn.marker?"missingPlayerNoMarker":"missingPlayer":markerRequired&&!this.data.checkedIn.marker?"noPlayersNoMarker":"noPlayers"},fakeStartMatch:function(){var matchStatusMsg="";switch(this.getCheckInStatus()){case"noPlayersNoMarker":case"missingPlayerNoMarker":matchStatusMsg='\n\t\t\t\t\t<span class="bold">Missing Player(s) & Scorekeeper</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tTo start this match, confirm all participants have arrived at the tablet by tapping each name.\n\n\t\t\t\t\t<br /><br />\n\n\t\t\t\t\t<span class="bold text-red">Don\'t Select Absent Players</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tDC notifies event staff of late players and scorekeepers. This enables staff to notify them of their \n\t\t\t\t\tcurrent match assignment.\n\t\t\t \t';break;case"noPlayers":case"missingPlayer":matchStatusMsg='\n\t\t\t\t\t<span class="bold">Missing Player(s)</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tTo start this match, confirm all participants have arrived at the tablet by tapping each name.\n\n\t\t\t\t\t<br /><br />\n\n\t\t\t\t\t<span class="bold text-red">Don\'t Select Absent Players</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tDC notifies event staff of late players. This enables staff to notify them of their \n\t\t\t\t\tcurrent match assignment.\n\t\t\t\t';break;case"missingMarker":matchStatusMsg='\n\t\t\t\t\t<span class="bold">Missing Scorekeeper</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tTo start this match, tap the scorekeeper\'s name to confirm the have arrived.\n\n\t\t\t\t\t<br /><br />\n\n\t\t\t\t\t<span class="bold">Additional Scorekeeper Options</span>\n\t\t\t\t\t<br />\n\t\t\t\t\tIf the assigned scorekeeper appears to be a no-show, select <span class="bold">More Scorekeeping Options</span> to determine what the event offers.\n\t\t\t\t';break;case"matchReady":return void APP.cif.startMatch()}APP.alert.show(matchStatusMsg)},buildBracketSelectedMatchParts:function(){APP.session.bracket_selected_match_parts=[];var matchData=APP.cif.data.matchData;return!!matchData&&(bsmp=APP.session.bracket_selected_match_parts,bsmp.push("pbml"),bsmp.push(matchData.bracket_event_id),bsmp.push(matchData.round_id),bsmp.push(matchData.bracket_match_id+"_"+matchData.bracket_event_id),!0)},showToolTip:function(player){if(1==player||2==player)switch(player){case 1:if(!this.data.checkedIn.home)return'\n\t\t\t\t\t\t\t<div class="tooltip tooltip-check-in">\n\t\t\t\t\t\t\t\t<div class="tooltip-inner">Tap to check in!</div>\n\t\t\t\t\t\t\t\t<div class="triangle-down"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t';break;case 2:if(!this.data.checkedIn.away)return'\n\t\t\t\t\t\t\t<div class="tooltip tooltip-check-in">\n\t\t\t\t\t\t\t\t<div class="tooltip-inner">Tap to check in!</div>\n\t\t\t\t\t\t\t\t<div class="triangle-down"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'}return 3!=player||this.data.checkedIn.marker?"":'\n\t\t\t\t\t<div class="tooltip tooltip-chalker">\n\t\t\t\t\t\t<div class="tooltip-inner">Tap to check in!</div>\n\t\t\t\t\t\t<div class="triangle-down"></div>\n\t\t\t\t\t</div>\n\t\t\t\t'},loadMatchPlayers:function(match){var playerArr=[],cleanPlayerArr=[];match.home_players&&(playerArr=playerArr.concat(match.home_players)),match.away_players&&(playerArr=playerArr.concat(match.away_players)),playerArr=JSON.parse(JSON.stringify(playerArr));for(var i=0;i<playerArr.length;i++){var p=playerArr[i],player={chalkboard_name:p.chalkboard_name,last_name:p.name_last,first_name:p.name_first,id:p.dc_tournament_player_id,email:p.dc_player_email,iso2_country:p.country_code,iso3_country:p.iso3_country,country_name:p.country_name};cleanPlayerArr.push(player)}APP.header.loadTournamentDirectory(cleanPlayerArr)},startMatchCheckTimer:function(){var timerVars={name:"cifStatusTimer",runTime:10,callback:function(){APP.cif.active&&APP.cif.checkMatchStatus()},eachTick:function(){},debugMode:!1};APP.cif.timers.cifStatusTimer=new Timer(timerVars)},checkMatchStatus:function(){try{var matchData=APP.cif.data.matchData,data={tournament_id:APP.session.getTournamentID(),bracket_match_id:matchData.bracket_match_id,event_id:matchData.bracket_event_id};APP.fns.doOldCall("/getTournamentMatchStatus",data,(function(r){try{if(r&&r.status&&"C"==r.status){var m=APP.cif.data.matchData;APP.cif.exitCheckIn(!0,!0),APP.alert.show("The selected match has been completed","",!0);var b_id="pbml-"+m.bracket_event_id+"-"+(m.round_id||"DEFAULT")+"-"+m.bracket_match_id+"_"+m.bracket_event_id,btn=$("#"+b_id);return void(btn.length&&btn.hide())}}catch(e){}window.setTimeout((function(){APP.cif.startMatchCheckTimer()}),100)}),(function(e){window.setTimeout((function(){APP.cif.startMatchCheckTimer()}),100)}),!1)}catch(e){window.setTimeout((function(){APP.cif.startMatchCheckTimer()}),100)}}},APP.cif.flowData={scope:APP.cif,name:"cif",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){APP.cif.active=!0},pageChange:function(scope){APP.cif.update(scope.data.pageNo),APP.cif.extendHeader()},exit:function(){APP.cif.active=!1,APP.cif.reset()}},pages:{page1:{content:function(){APP.cif.data.checkedIn.home,APP.cif.data.checkedIn.away;return`\n\t\t\t\t\t<div id='cif-main'>\n\t\t\t\t\t\t<div class="highlight-div">\n\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tSelect players who have <span class="bold">arrived</span> for the match\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(1)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu button-white round-corners"\n\t\t\t\t\t\t\t\t\tid="cif-player-1"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${APP.cif.data.homeLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(2)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu button-white round-corners"\n\t\t\t\t\t\t\t\t\tid="cif-player-2"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${APP.cif.data.awayLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t${this.buildChalkerInfo()}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="cif-start-match" class="button round-corners button-md button-center button-green">\n\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},buildChalkerInfo:function(){var content="",hasMarker=APP.cif.data.checkedIn.marker;switch(APP.cif.data.markerType){case 0:content="";break;case 1:content=APP.cif.data.markerLabel?`\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tConfirm the Scorekeeper is <span class="bold">present</span>\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tooltip-wrap"> \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t\t\t${APP.cif.showToolTip(3)}\n\t\t\t\t\t\t\t\t\t\t<div class="button button-menu round-corners ${hasMarker?"button-flat-green":"button-white"} " id="cif-marker">\n\t\t\t\t\t\t\t\t\t\t\t${hasMarker?" ":""} ${APP.cif.data.markerLabel}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="cif-marker-options" class="fake-link button">More Scorekeeping Options</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`:'\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t';break;case 2:content='\n\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'}return content},init:function(scope){var footerContent=`\n\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t${APP.cif.buildTimeDisplay("cif-wait-timer")}\n\t\t\t\t\t\t<p class="cif-absent-warn">Staff will be notified of absent players and scorekeeper</p>\n\t\t\t\t\t\t<div id="cif-assistant" class="fake-link button">Request Assistance</div>\n\t\t\t\t\t </div>\n\t\t\t\t`;scope.ele.footer.empty().append(footerContent).show(),APP.fns.activateBtn("cif-assistant",(function(){APP.cif.requestAssistant()})),APP.fns.activateBtn("cif-start-match",(function(){APP.cif.fakeStartMatch()}));var startTimer=APP.cif.calculateTime();if(startTimer)window.setTimeout((function(){APP.cif.matchIsLate()}),100);else{var timerVars={name:"cifWaitTimer",manualStop:!0,callback:function(manualStop){},eachTick:function(){APP.cif.lastTimerVal=this.getRunTime(),APP.cif.updateTimeDisplay("cif-wait-timer");var lateSeconds=60*APP.cif.data.markerTimerLate;this.timer>lateSeconds&&APP.cif.matchIsLate()},debugMode:!1,returnHours:!0};APP.cif.timers.waitTimer=new Timer(timerVars),APP.cif.timers.waitTimer.timer=startTimer,APP.fns.activateBtn("cif-player-1",(function(){APP.cif.checkInPlayer(1)})),APP.fns.activateBtn("cif-player-2",(function(){APP.cif.checkInPlayer(2)})),APP.fns.activateBtn("cif-marker",(function(){APP.cif.checkInPlayer(3)})),APP.cif.activateMoreMarkerOptsBtn()}}},page2:{content:function(){var hasPlayer1=APP.cif.data.checkedIn.home,hasPlayer2=APP.cif.data.checkedIn.away;return`\n\t\t\t\t\t<div id='cif-main'>\n\t\t\t\t\t\t<div class="highlight-div">\n\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tSelect players who have <span class="bold">arrived</span> for the match\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(1)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu round-corners ${hasPlayer1?"button-flat-green":"button-white"} "\n\t\t\t\t\t\t\t\t\tid="cif-player-1"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${hasPlayer1?" ":""} ${APP.cif.data.homeLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(2)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu round-corners ${hasPlayer2?"button-flat-green":"button-white"} "\n\t\t\t\t\t\t\t\t\tid="cif-player-2"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${hasPlayer2?" ":""} ${APP.cif.data.awayLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t${this.buildChalkerInfo()}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="cif-start-match" class="button round-corners button-small button-green">\n\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},buildChalkerInfo:function(){var content="",hasMarker=APP.cif.data.checkedIn.marker;switch(APP.cif.data.markerType){case 0:content="";break;case 1:content=APP.cif.data.markerLabel?`\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tConfirm the Scorekeeper is <span class="bold">present</span>\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tooltip-wrap"> \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t\t\t${APP.cif.showToolTip(3)}\n\t\t\t\t\t\t\t\t\t\t<div class="button button-menu round-corners ${hasMarker?"button-flat-green":"button-white"} " id="cif-marker">\n\t\t\t\t\t\t\t\t\t\t\t${hasMarker?" ":""} ${APP.cif.data.markerLabel}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="cif-marker-options" class="fake-link button">More Scorekeeping Options</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`:'\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t';break;case 2:content='\n\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'}return content},buildExtChalkerInfo:function(){var content="";switch(APP.cif.data.markerType){case 1:content=`\n\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tPlay match with a Scorekeeper\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-marker">\n\t\t\t\t\t\t\t\t\t${APP.cif.data.markerLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,1==APP.cif.data.markerOpt&&(content+=`\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-different-marker">\n\t\t\t\t\t\t\t\t\tPlay with a different Scorekeeper\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tOther Match Start Options\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-request-marker">\n\t\t\t\t\t\t\t\t\t${APP.cif.data.paidMarkers?"Request a <span class='bold'>Paid</span> Scorekeeper":"Request a Scorekeeper"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-continue-marker">\n\t\t\t\t\t\t\t\t\tPlay without Scorekeeper\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`),content+="</div>"}return content},init:function(scope){var footerContent=`\n\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t${APP.cif.buildTimeDisplay("cif-wait-timer")}\n\t\t\t\t\t\t<p class="cif-absent-warn">Staff will be notified of absent players and scorekeeper</p>\n\t\t\t\t\t\t<div id="cif-assistant" class="fake-link button">Request Assistance</div>\n\t\t\t\t\t </div>\n\t\t\t\t`;scope.ele.footer.empty().append(footerContent).show(),APP.fns.activateBtn("cif-assistant",(function(){APP.cif.requestAssistant()})),APP.fns.activateBtn("cif-start-match",(function(){APP.cif.fakeStartMatch()}));var startTimer=APP.cif.calculateTime();if(startTimer)window.setTimeout((function(){APP.cif.matchIsLate()}),100);else{var timerVars={name:"cifWaitTimer",manualStop:!0,callback:function(manualStop){},eachTick:function(){APP.cif.lastTimerVal=this.getRunTime(),APP.cif.updateTimeDisplay("cif-wait-timer");var lateSeconds=60*APP.cif.data.markerTimerLate;this.timer>lateSeconds&&APP.cif.matchIsLate()},debugMode:!1,returnHours:!0};APP.cif.timers.waitTimer=new Timer(timerVars),APP.cif.timers.waitTimer.timer=startTimer,APP.fns.activateBtn("cif-player-1",(function(){APP.cif.checkInPlayer(1)})),APP.fns.activateBtn("cif-player-2",(function(){APP.cif.checkInPlayer(2)})),APP.fns.activateBtn("cif-marker",(function(){APP.cif.checkInPlayer(3)})),APP.fns.activateBtn("cif-continue-marker",(function(){APP.cif.playWithoutMarker()})),APP.fns.activateBtn("cif-different-marker",(function(){APP.cif.playWithoutMarker(!1,!0)})),APP.cif.activateMoreMarkerOptsBtn()}}},page3:{content:function(){var hasPlayer1=APP.cif.data.checkedIn.home,hasPlayer2=APP.cif.data.checkedIn.away;return`\n\t\t\t\t\t<div id='cif-main'>\n\t\t\t\t\t\t<div class="highlight-div">\n\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tSelect players who have <span class="bold">arrived</span> for the match\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(1)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu round-corners ${hasPlayer1?"button-flat-green":"button-white"} "\n\t\t\t\t\t\t\t\t\tid="cif-player-1"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${hasPlayer1?" ":""} ${APP.cif.data.homeLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="tooltip-wrap">  \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t${APP.cif.showToolTip(2)}\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-menu round-corners ${hasPlayer2?"button-flat-green":"button-white"} "\n\t\t\t\t\t\t\t\t\tid="cif-player-2"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${hasPlayer2?" ":""} ${APP.cif.data.awayLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t${this.buildReportOppoBtn()}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t${this.buildChalkerInfo()}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="cif-start-match" class="button round-corners  button-md button-center button-green">\n\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},buildRequestForfeitBtn:function(){var content="";return APP.cif.data.forfeitOpt&&(content='\n\t\t\t\t\t\t<div class="button round-corners button-small button-red" id="cif-request-forfeit">\n\t\t\t\t\t\t\tReport Missing Opponent\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),content},buildReportOppoBtn:function(){var content="";return APP.cif.data.forfeitOpt&&(content='\n\t\t\t\t\t\t<div class="button round-corners button-small button-red" id="cif-report-oppo">\n\t\t\t\t\t\t\tReport Missing Opponent\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),content},buildChalkerInfo:function(){var content="",hasMarker=APP.cif.data.checkedIn.marker;switch(APP.cif.data.markerType){case 0:content="";break;case 1:content=APP.cif.data.markerLabel?`\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tConfirm the Scorekeeper is <span class="bold">present</span>\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="tooltip-wrap"> \x3c!-- wrap for tool tip --\x3e\n\t\t\t\t\t\t\t\t\t\t${APP.cif.showToolTip(3)}\n\t\t\t\t\t\t\t\t\t\t<div class="button button-menu round-corners ${hasMarker?"button-flat-green":"button-white"} " id="cif-marker">\n\t\t\t\t\t\t\t\t\t\t\t${hasMarker?" ":""} ${APP.cif.data.markerLabel}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t<div id="cif-marker-options" class="fake-link button">More Scorekeeping Options</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`:'\n\t\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t';break;case 2:content='\n\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t\t\t<div class="cif-title">\n\t\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\t\tScorekeeper\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="info-box">\n\t\t\t\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t\t\t\t<span class="bold">Missing Scorekeeper</span><br />\n\t\t\t\t\t\t\t\t\t\tThe scorekeeper for this match will be assigned shortly. If a marker is already available, begin the match now.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t'}return content},buildExtChalkerInfo:function(){var content="";switch(APP.cif.data.markerType){case 1:content=`\n\t\t\t\t\t\t\t<div class="cif-marker-box">\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tPlay match with a Scorekeeper\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-marker">\n\t\t\t\t\t\t\t\t\t${APP.cif.data.markerLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,1==APP.cif.data.markerOpt&&(content+=`\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-different-marker">\n\t\t\t\t\t\t\t\t\tPlay with a different Scorekeeper\n\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t<h4 class="text-gold">\n\t\t\t\t\t\t\t\t\tOther Match Start Options\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-request-marker">\n\t\t\t\t\t\t\t\t\t${APP.cif.data.paidMarkers?"Request a <span class='bold'>Paid</span> Scorekeeper":"Request a Scorekeeper"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="button button-menu round-corners button-white" id="cif-continue-marker">\n\t\t\t\t\t\t\t\t\tPlay without Scorekeeper\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`),content+="</div>"}return content},init:function(scope){var footerContent=`\n\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t${APP.cif.buildTimeDisplay("cif-late-timer",!0)}\n\t\t\t\t\t\t<p class="cif-absent-warn">Staff will be notified of absent players and scorekeeper</p>\n\t\t\t\t\t\t<div id="cif-assistant" class="fake-link button">Request Assistance</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;scope.ele.footer.empty().append(footerContent).show(),APP.fns.activateBtn("cif-assistant",(function(){APP.cif.requestAssistant()})),APP.fns.activateBtn("cif-start-match",(function(){APP.cif.fakeStartMatch()}));var startTimer=APP.cif.calculateTime(!0);if(startTimer){var timerVars={name:"cifLateTimer",manualStop:!0,callback:function(manualStop){},eachTick:function(){APP.cif.lastTimerVal=this.getRunTime(),APP.cif.updateTimeDisplay("cif-late-timer",!0),Math.round(this.timer/60)>=APP.cif.data.markerTimerMax&&(APP.cif.data.forfeitNoticeSent||APP.cif.sendForfeitNotice())},debugMode:!1,returnHours:!0};APP.cif.timers.lateTimer=new Timer(timerVars),APP.cif.timers.lateTimer.timer=startTimer}APP.fns.activateBtn("cif-player-1",(function(){APP.cif.checkInPlayer(1)})),APP.fns.activateBtn("cif-player-2",(function(){APP.cif.checkInPlayer(2)})),APP.fns.activateBtn("cif-marker",(function(){APP.cif.checkInPlayer(3)})),APP.cif.activateReportBtn(),APP.cif.activateMoreMarkerOptsBtn()}}}},APP.magiconnect={isActive:!1,showingOptions:!1,connectionMade:!1,isManualConnect:!1,debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="magiconnect: ";message+=msg,console.log(message)}},callbackObj:null,callbacks:function(cycle){if(this.callbackObj)try{this.callbackObj[cycle]&&(this.callbackObj[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},init:function(vars){if(this.flow=null,this.clear(),vars){if(this.validateVars(vars)){switch(this.data.type){case"leagueConnect":this.flowData=magiconnectFlows.leagueConnect,this.flow=new UIFlow(this.flowData);break;default:this.flowData=magiconnectFlows.default,this.flow=new UIFlow(this.flowData)}var pageNo=null;vars&&vars.pageNo&&(pageNo=vars.pageNo),"HOST"!=this.data.role&&"GUEST"!=this.data.role||(pageNo=2),this.callbacks("preInit"),this.start(pageNo),"HOST"==this.data.role&&this.startHostMagiconnect(),"GUEST"==this.data.role&&this.startGuestMagiconnect(),this.callbacks("postInit")}}else this.log("Vars are required",!0)},validateVars:function(vars){if(vars.connectCode1)if(vars.connectCode2){if(vars.connectCode3)return this.data.connectCode1=vars.connectCode1,this.data.connectCode2=vars.connectCode2,this.data.connectCode3=vars.connectCode3,vars.callbacks&&(this.callbackObj=vars.callbacks),vars.type&&(this.data.type=vars.type),vars.role&&(this.data.role=vars.role),!0;this.log("required variable connectCode3 not sent to class",!0)}else this.log("required variable connectCode2 not sent to class",!0);else this.log("required variable connectCode1 not sent to class",!0)},start:function(pageNo){pageNo&&(this.flowData.pageNo=pageNo),this.flow=new UIFlow(this.flowData)},flowData:null,flow:null,data:{version:1,pageNo:0,log:[],role:null,isActive:!1,connectCode1:null,connectCode2:null,connectCode3:null},reloadCheck:function(){this.log("Reload Check");var savedData=BBAT.fetchData("magiconnect_data");if(savedData){if(this.data.pageNo=savedData.pageNo,savedData.version!=this.data.version)return void this.updateDataStructure();this.data.pageNo>0&&"PRE-ROLE"==APP.mode&&(this.log("Show reloaded content"),this.init(this.data.pageNo))}},updateDataStructure:function(){var pageNo=this.data.pageNo;this.clear(),this.data.pageNo=pageNo,this.save(),APP.reload()},update:function(pageNo){this.data.pageNo=pageNo,this.save()},save:function(){BBAT.storeData({magiconnect_data:APP.magiconnect.data})},reset:function(){this.log("resetting data"),this.data.pageNo=0,this.save()},clear:function(){this.reset(),BBAT.flushData("magiconnect_data")},startHostMagiconnect:function(){var mc=APP.magiconnect;mc.isActive=!0,mc.data.role="HOST",mc.isActive=!0,mc.save();APP.session;var data={role:"HOST",step:"CHECKIN",member_id:APP.user.member_id,tournament_id:APP.magiconnect.data.connectCode1,event_id:APP.magiconnect.data.connectCode2,bracket_match_id:APP.magiconnect.data.connectCode3,device_token:APP.device.token};APP.magiconnect.magiconnectCall("/onlineMatchInit",data,(function(r){if("FAILED"==r.status){var error="Host Connect Failed";if(r.status_text&&(error=r.status_text),error.indexOf("Could not find Websocket open for your device/member_id")&&(WS.init(APP.getSessionInfo),window.setTimeout((function(){APP.magiconnect.startHostMagiconnect()}),2e3)),"Host Alley Not Open"===error)return void APP.handleAlleyOption("pcm-broadcast-start-button",(function(r){if(APP.server.participant_device_key);else{mc.logOutput("A server error occurred connecting to your match. We have attempted to fix this, please try again.")}}));"Error connecting: Your opponent selected the same player as you."==error&&(error="It appears that both participants have selected the same player. Please reset the match and select your name.",!0),mc.logOutput(error)}else"ALL_PLAYERS_READY"===r.payload.handshake_status?(mc.logOutput(r.payload.handshake_status),window.setTimeout((function(){mc.getAlleyCode()}),2e3)):mc.logOutput(r.payload.handshake_status)}),(function(r){APP.magiconnect.logOutput("An error occurred finding your opponent")}))},startGuestMagiconnect:function(){var mc=APP.magiconnect;mc.data.role="GUEST",mc.isActive=!0,mc.save();APP.session;var data={role:"GUEST",step:"CHECKIN",member_id:APP.user.member_id,tournament_id:APP.magiconnect.data.connectCode1,event_id:APP.magiconnect.data.connectCode2,bracket_match_id:APP.magiconnect.data.connectCode3,device_token:APP.device.token};mc.magiconnectCall("/onlineMatchInit",data,(function(r){if("FAILED"==r.status){var error="Guest Connect Failed";r.status_text&&(error=r.status_text);"Error connecting: Your opponent selected the same player as you."==error&&(error="It appears that both participants have selected the same player. Please reset the match and select your name.",!0),mc.logOutput(error)}else mc.doMagiconnectGuest(r)}),(function(r){mc.logOutput("An error occurred finding your opponent")})),APP.reveal.setBackButton()},magiconnectCall:function(url,data,success,error){if(!url)return this.log("No URL sent"),!1;data||(data={}),success||(success=function(){}),error||(error=function(in_a,in_b,in_c){return in_params.callback("FAILED"),!1}),APP.server.squeue.enQueue({type:"ALLEY",caller:"magiconnectCall",url:url,spinner:!1,show_network_message:!0,data:data,on_success:success,on_error:error})},doMagiconnectHost:function(r){var error;APP.session;if(APP.server.participant_device_key){APP.handleAlleyOption("pcm-compete-host-button"),APP.device.is_broadcasting||APP.handleAlleyOption("pcm-broadcast-start-button");var data={role:"HOST",step:"START_MATCH",member_id:APP.user.member_id,tournament_id:APP.magiconnect.data.connectCode1,event_id:APP.magiconnect.data.connectCode2,bracket_match_id:APP.magiconnect.data.connectCode3,participant_code:APP.server.participant_device_key,device_token:APP.device.token};error=function(r){APP.magiconnect.logOutput("An error occurred finding your opponent")},APP.magiconnect.magiconnectCall("/onlineMatchInit",data,(function(r){"failed"!=r.status?"MATCH_STARTED"===r.payload.handshake_status&&(APP.message.userMessage.changeBtn(!0),APP.magiconnect.log("CONNECTED"),APP.magiconnect.connectionMadeHost()):APP.magiconnect.logOutput(r.status_text)}),error)}else error="Error getting Alley Code"},doMagiconnectGuest:function(r){if(r.payload)switch(r.payload.handshake_status){case"MATCH_STARTED":r.payload.participant_code&&APP.magiconnect.setAlleyCode(r.payload)}APP.magiconnect.logOutput(r.payload.handshake_status)},cancelMagiconnect:function(callback){APP.session;var data={role:APP.magiconnect.data.role,step:"CANCEL",member_id:APP.user.member_id,tournament_id:this.data.connectCode1,event_id:this.data.connectCode2,bracket_match_id:this.data.connectCode3,device_token:APP.device.token};APP.magiconnect.magiconnectCall("/onlineMatchInit",data,(function(r){APP.magiconnect.log("Success Cancelling MagiConnect"),APP.magiconnect.log(r),callback&&callback()}),(function(r){APP.magiconnect.log("Error Cancelling MagiConnect"),APP.magiconnect.log(r),callback&&callback()}))},getAlleyCode:function(){var in_open_call_id,in_success,fail_msg,error,requesting_broadcast;APP.server.participant_device_key?APP.magiconnect.doMagiconnectHost():APP.device.is_broadcasting?(APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.game_master="SERVER",APP.storeState(),APP.setConnectMenuControls(),APP.server.startTimer("SEND")):(in_success=function(){APP.device.has_chalk=!0,APP.device.is_hosting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.magiconnect.doMagiconnectHost()},requesting_broadcast=(in_open_call_id="pcm-compete-host-button").indexOf("broadcast")>=0,fail_msg="Unable to connect to the DartConnect Server. Your match will not be broadcast on DCTV. Check your WiFi and use the Connect Menu to try again later.",APP.server.openAlley({spinner:!1,requesting_broadcast:requesting_broadcast,callback:function(in_status,in_text){"OK"==in_status?(APP.game_master=in_open_call_id.indexOf("broadcast")>=0?"DEVICE":"SERVER",APP.device.role="HOST",APP.server.startTimer("SEND"),in_success()):(APP.revertToLocalPlay(),APP.reveal.setChalkButton(),in_text?in_text.indexOf("already open")>=0?APP.confirm.show({title:"Connection Notice!",msg:"You have connections open on<br />another device/session.<br />Do you want to force them closed?",ok_text:"Yes, Close Them",cancel_text:"No, Leave Them Open",ok:function(){APP.server.closeAlley({force_close:!0,success:function(){APP.handleAlleyOption(in_open_call_id)}})}}):in_text.indexOf("No alleys available")>=0?(error="Due to high demand, on-line match play and DCTV broadcasting are unavailable. Please try again shortly. This does NOT affect in-person or computer play.",APP.magiconnect.logOutput(error)):(error='An unexpected error has occurred<br /> Please try again later or email <a href="mailto:customerservice@dartconnect.com">customerservice@dartconnect.com</a>',APP.magiconnect.logOutput(error)):APP.isOffline()||APP.magiconnect.logOutput(fail_msg))}}))},setAlleyCode:function(r){APP.session;if(r.participant_code)APP.guestConnectDisplay("pgc-join"),$(".pgc-blurb").hide(),$("#pgc-participant-input").val(r.participant_code),APP.handleGuestConnect("pgc-continue"),this.connectionMadeGuest();else{APP.magiconnect.logOutput("Issue getting Alley Code")}},showManual:function(){this.isManualConnect=!0,this.cancelMagiconnect(),"HOST"==this.data.role&&(this.callbacks("showManualHost"),APP.handleMatchOption("bb-e-alley"),APP.handleAlleyOption("pcm-compete-host-button"),$("#pcm-compete-host-button").hide(),$(".pcm-broadcast-wrap").hide()),"GUEST"==this.data.role&&(this.callbacks("showManualGuest"),APP.showGuestConnect(),APP.guestConnectDisplay("pgc-join"),$(".pgc-blurb").hide(),APP.handleAlleyOption("pcm-broadcast-end-button")),this.flow.exit()},logOutput:function(msg){var log=this.data.log;log.push(msg);var content=log.join("<hr />");$("#magiconnect-output").empty().html(content)},connectionMadeHost:function(data){APP.magiconnect.connectionMade=!0,this.callbacks("connectionMadeHost"),APP.magiconnect.flow.exit()},connectionMadeGuest:function(data){APP.magiconnect.connectionMade=!0,this.callbacks("connectionMadeGuest"),APP.magiconnect.flow.exit()},exitCallback:function(){APP.magiconnect.isActive=!1,this.callbacks("exit")}};var magiconnectFlows={default:{name:"magiconnect",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){APP.magiconnect.cancelMagiconnect()}},pages:{page1:{hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t\t<div id=\'qp3-main\'>\n\t\t\t\t\t\t\t<div id="my-tab-test">\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<h4 style="margin-top: 0">Auto Connect Test</h4>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="button button-green button-menu" id="magiconnect-host">\n\t\t\t\t\t\t\t\tConnect as Host\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="button button-gold button-menu" id="magiconnect-guest">\n\t\t\t\t\t\t\t\tConnect as Guest\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<hr />\n\n\t\t\t\t\t\t\t<div id="magiconnect-output" class="highlight-box">\n\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'},getHeader:function(){return"Second Pop Over"},init:function(scope){var mc=APP.magiconnect;scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t<div class="button button-md button-red" id="magiconnect-exit">\n\t\t\t\t\t\t\tCancel Connection\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.fns.activateBtn("magiconnect-host",(function(){scope.show(2),mc.startHostMagiconnect()})),APP.fns.activateBtn("magiconnect-guest",(function(){scope.show(2),mc.startGuestMagiconnect()})),APP.fns.activateBtn("magiconnect-exit",(function(){APP.magiconnect.isActive=!1,scope.exit()})),scope.ele.main.find(".popup-title span").text("Connecting")}},page2:{hideBackBtn:!0,hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t\t<div id=\'qp3-main\'>\n\t\t\t\t\t\t\t<div id="my-tab-test">\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<h4 style="margin-top: 0">Please wait - we are trying to connect you with your opponent &hellip;</h4>\n\n\t\t\t\t\t\t\t<div id="magiconnect-output" class="highlight-box">\n\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'},getHeader:function(){return"Second Pop Over"},addFooter:function(scope){var mc=APP.magiconnect;scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div class="button button-md button-red" id="magiconnect-cancel-connect">\n\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div class="button-gray button-md button" id="magiconnect-manual-connect">\n\t\t\t\t\t\t\t\t\t\t\tManual Connect\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.fns.activateBtn("magiconnect-cancel-connect",(function(){mc.cancelMagiconnect((function(){scope.show(1)}))})),APP.fns.activateBtn("magiconnect-manual-connect",(function(){mc.showManual()}))},init:function(scope){mc=APP.magiconnect,this.addFooter(scope),scope.ele.main.find(".popup-title span").text("Connecting")}}}},leagueConnect:{name:"magiconnect",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){APP.magiconnect.isActive=!1,APP.magiconnect.cancelMagiconnect(),APP.magiconnect.isManualConnect||APP.magiconnect.connectionMade||($("#app-overlay").show(),APP.device.showSpinnerOverlay(),APP.starpubs.endMatch(),APP.handleMatchOption("bb-e-new-match"))}},pages:{page1:{hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t\t<div id=\'qp3-main\'>\n\t\t\t\t\t\t\t<div id="my-tab-test">\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<h4 style="margin-top: 0">Auto Connect Test</h4>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="button button-green button-menu" id="magiconnect-host">\n\t\t\t\t\t\t\t\tConnect as Host\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class="button button-gold button-menu" id="magiconnect-guest">\n\t\t\t\t\t\t\t\tConnect as Guest\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<hr />\n\n\t\t\t\t\t\t\t<div id="magiconnect-output" class="highlight-box">\n\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'},getHeader:function(){return"Second Pop Over"},init:function(scope){var mc=APP.magiconnect;scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t<div class="button button-md button-red" id="magiconnect-exit">\n\t\t\t\t\t\t\tCancel Connection\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.fns.activateBtn("magiconnect-host",(function(){scope.show(2),mc.startHostMagiconnect()})),APP.fns.activateBtn("magiconnect-guest",(function(){scope.show(2),mc.startGuestMagiconnect()})),APP.fns.activateBtn("magiconnect-exit",(function(){scope.exit()})),scope.ele.main.find(".popup-title span").text("Connecting")}},page2:{hideBackBtn:!0,hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t\t<div id=\'mc-main\'>\n\t\t\t\t\t\t\t<div id="magiconnect-injection-top"></div>\n\n\t\t\t\t\t\t\t<div id="magiconnect-info" class="highlight-box primary-grad button">\n\t\t\t\t\t\t\t\t<h4>You have connected successfully!</h4>\n\t\t\t\t\t\t\t\t<p>Waiting for your opponent</p>\n\n\t\t\t\t\t\t\t\t<div id="magiconnect-output" class="hide">\n\t\t\t\t\t\t\t\t\t&nbsp;\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\t\t\tStill waiting for your opponent?\n\t\t\t\t\t\t\t\tConfirm you have selected the correct match. If not, cancel and re-start the match.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\t\t\tIf you have selected the correct match, <span class="bold">contact your opponent</span> to determine if they are delayed.\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\t\t\tIf they are having connection issues, you can attempt to provide your opponent with a verbal connect code.\n\t\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t\t<table width="100%" class="mLgTop">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<img src="/images/icon-app-connected.png" alt="DartConnect" style="width: 50%;" />\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td style="vertical-align: middle;"">\n\t\t\t\t\t\t\t\t\t\t<div class="lds-facebook"><div></div><div></div><div></div></div>\n\t\t\t\t\t\t\t\t\t\t<div id="magiconnect-timer"></div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<img src="/images/icon-app-not-connected.png" alt="DartConnect" style="width: 50%;" />\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\n\t\t\t\t\t\t\t<div id="magiconnect-injection-bottom" class="mMdTop"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'},getHeader:function(){return"Second Pop Over"},addFooter:function(scope){var mc=APP.magiconnect;scope.ele.footerContent.empty().append('\n\t\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div class="button button-md button-red" id="magiconnect-cancel-connect">\n\t\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div class="button-gray button-md button" id="magiconnect-manual-connect">\n\t\t\t\t\t\t\t\t\t\t\tManual Connect\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t\t'),APP.fns.activateBtn("magiconnect-cancel-connect",(function(){scope.exit(),mc.cancelMagiconnect()})),APP.fns.activateBtn("magiconnect-manual-connect",(function(){mc.showManual()}))},init:function(scope){mc=APP.magiconnect,this.addFooter(scope),APP.fns.activateBtn("magiconnect-info",(function(){$("#magiconnect-output").toggleClass("hide")}));new Timer({name:"magiConnectWaitTimer",manualStop:!0,callback:function(manualStop){},eachTick:function(){$("#magiconnect-timer").html(this.getRunTime())},debugMode:!1,returnMinutes:!0});scope.ele.main.find(".popup-title span").text("League Connect")}}}}};APP.proxyflow={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="proxyflow: ";message+=msg,console.log(message)}},isProxyFlow:null,proxyFlowLeagues:["adaallstar","adanationalteams","adayouthadult","wdfwc"],proxyFlowTournaments:["adanationals23","wdfworldcup23a","wdfworldcup23y"],flowData:null,flow:null,launchAttempted:!1,tryToLaunch:function(position){if(this.launchAttempted)return!1;var tryToLaunch=!1;switch(position){case 1:try{APP.user.league_associations&&(tryToLaunch=!0)}catch(e){}return tryToLaunch;case 2:return!0}},isProxyFlowAccount:function(){if("boolean"==typeof this.isProxyFlow)return this.isProxyFlow;if(!APP.fns.checkForProxy())return this.isProxyFlow=!1,!1;var key;if(!APP.user||!APP.user.league_associations)return this.isProxyFlow=!1,!1;for(var leagues=APP.user.league_associations,i=0;i<leagues.length;i++){var league=leagues[i];if(league.opt_proxy_flow&&"Y"==league.opt_proxy_flow)return this.isProxyFlow=!0,!0;if(key=leagues[i].league_id,-1!==this.proxyFlowLeagues.indexOf(key))return this.isProxyFlow=!0,!0}for(key in APP.session.tournaments){var tournament=APP.session.tournaments[key];if(tournament.opt_proxy_flow&&"Y"==tournament.opt_proxy_flow)return this.isProxyFlow=!0,!0;if(-1!==this.proxyFlowTournaments.indexOf(key))return this.isProxyFlow=!0,!0}return this.isProxyFlow=!1,!1},useCustomProxyFlow:function(){for(var customLeagues=["wdfwc"],leagues=APP.user.league_associations,i=0;i<leagues.length;i++){var key=leagues[i].league_id;if(-1!==customLeagues.indexOf(key))return!0}return!1},checkIntro:function(){APP.nlf.rails.data.railsReturn||"PRE-ROLE"==APP.mode&&(this.log("Show Intro"),this.showIntro())},showIntro:function(){this.flowData=proxyFlow,APP.proxyflow.useCustomProxyFlow()&&(this.flowData=customProxyFlow),isSolo501(!0)&&(this.flowData=jasonProxyFlow),this.flow=null,this.flow=new UIFlow(this.flowData)},injectHomeBtn:function(){"PRE-ROLE"==APP.mode&&($("#drm-practice").addClass("hide"),$("#drm-proxy-flow").removeClass("hide"),APP.fns.activateBtn("drm-proxy-flow",APP.proxyflow.showIntro))},buildProxyBtns:function(){var i,key,content="",tournamentContent="",leagueContent="",tournamentBtns=[],leagueBtns=[];for(key in APP.session.tournaments){var tournament=APP.session.tournaments[key],secondaryLabel="";tournament.event_number_label?secondaryLabel+=`\n\t\t\t\t\t<br />\n\t\t\t\t\t<span style="font-size:0.7em; font-weight: normal;">${tournament.event_number_label}</span>\n\t\t\t\t`:tournament.checkin_tagline&&(secondaryLabel+=`\n\t\t\t\t\t<br />\n\t\t\t\t\t<span style="font-size:0.7em; font-weight: normal;">${tournament.checkin_tagline}</span>\n\t\t\t\t`),tournamentContent+=`\n\t\t\t\t<div class="button button-lg button-info mLgTop" id="pf-tournament-${key}">\n\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t<span style="font-size:0.7em;">\n\t\t\t\t\t\t\t${tournament.match_description}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</span>\n\t\t\t\t\t${secondaryLabel}\n\t\t\t\t</div>\n\t\t\t`,tournamentBtns.push("pf-tournament-"+key)}tournamentContent&&(content+=`\n\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\tTournament Mode\n\t\t\t\t</p>\n\t\t\t\t${tournamentContent}\n\t\t\t`);var leagues=APP.user.league_associations,uniqueLeagues=[],uniqueLeagueIds=[];for(i=0;i<leagues.length;i++){var leagueId=(league=leagues[i]).league_division_guid;-1==uniqueLeagueIds.indexOf(leagueId)&&(uniqueLeagueIds.push(leagueId),uniqueLeagues.push(league))}for(leagues=uniqueLeagues,i=0;i<leagues.length;i++){var league,buttonId="plm-ula-";buttonId+=(league=leagues[i]).league_id+"-",buttonId+=league.league_division_guid+"-",buttonId+=league.season_status;var nameDisplay=`\n\t\t\t\t<span style="display: block; font-size:0.7em;">\n\t\t\t\t\t${league.longname}\n\t\t\t`;nameDisplay+=`\n\t\t\t\t<br />\n\t\t\t\t<span style="display: block; line-height: 1.2em; font-size:0.9em; font-weight: normal !important;">\n\t\t\t\t\t${league.season_label} ${"POST"==league.season_status?" Post Season":""}\n\t\t\t\t</span>\n\t\t\t`,nameDisplay+="</span>",league.division_label&&(nameDisplay+=`\n\t\t\t\t\t<div class="hr" style="\n\t\t\t\t\t\tmargin: 0.3em 0;\n\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\tbackground: #84B4D7;\n\t\t\t\t\t"></div>\n\n\t\t\t\t\t<span class="bold" style="display: block; font-size:0.7em;">\n\t\t\t\t\t\t${league.division_label}\n\t\t\t\t\t</span>\n\t\t\t\t`);var btnClass="button-info";"POST"==league.season_status&&(btnClass="button-gold round-corners"),leagueContent+=`\n\t\t\t\t<div class="button button-lg ${btnClass}" id="${buttonId}">\n\t\t\t\t\t<span class="bold">${nameDisplay}</span>\n\t\t\t\t</div>\n\t\t\t`,leagueBtns.push(buttonId)}return leagueContent&&(content+=`\n\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\tLeague Mode\n\t\t\t\t</p>\n\t\t\t\t${leagueContent}\n\t\t\t`),{content:content,leagueBtns:leagueBtns,tournamentBtns:tournamentBtns}},activateLeagueBtns:function(btns,scope){if(scope){if(btns.length)for(var i=0;i<btns.length;i++){var leagueId=btns[i];APP.fns.activateBtn(leagueId,(function(leagueId){scope.exit(),APP.session.handleLeagueMenu(leagueId)}))}}else this.log("You need to pass through scope (league)!",!0)},activateTournamentBtns:function(btns,scope){if(scope){if(btns.length)for(var i=0;i<btns.length;i++){var tournamentId=btns[i];APP.fns.activateBtn(tournamentId,(function(tournamentId){scope.exit(),APP.session.handleTournamentListing(tournamentId)}))}}else this.log("You need to pass through scope (tournaments)!",!0)},enterLeague:function(){APP.session.handleLeagueMenu("plm-ula-meshinteroffice-18418-REG"),APP.nlf.pages.matchSelect.matchClick("nlf-match-802418")},canDisplay:function(){try{if("PRE-ROLE"!==APP.mode)return!1;if(APP.nlf.data.mode>0)return!1;if($("#popup-league-menu").is(":visible"))return!1;if(APP.nlf.data&&APP.nlf.data.railsReturn)return!1}catch(e){}return!0},init:function(){this.canDisplay()?(this.isProxyFlowAccount()&&(this.checkIntro(),this.injectHomeBtn()),this.launchAttempted=!0):this.launchAttempted=!0}};var proxyFlow={name:"proxyflow",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{page1:{hideHeader:!0,content:function(){return'\n\t\t\t\t\t<div id=\'pf-intro\'>\n\t\t\t\t\t\t<svg class="svg-icon mLgBottom mLgTop" viewBox="0 0 40 25" style="height: 5em; width: 10em;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t</svg> \n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 class="text-gold noMargin bold">Welcome to DartConnect!</h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="pf-buttons" class="mLgTop">\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){var pf=APP.proxyflow;scope.ele.main.find(".popup-title span").html("&nbsp;"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");var eventInfo=pf.buildProxyBtns();$("#pf-buttons").empty().append(eventInfo.content),eventInfo.leagueBtns.length&&APP.proxyflow.activateLeagueBtns(eventInfo.leagueBtns,scope),eventInfo.tournamentBtns.length&&APP.proxyflow.activateTournamentBtns(eventInfo.tournamentBtns,scope);scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="fp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("fp-intro-exit",(function(){console.log(scope),scope.exit()}))}}}},customProxyFlow={selectedFlow:null,name:"customProxyflow",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},getLeagueEvents:function(category,type){var i,leagues=APP.user.league_associations,categoryArr=[];for(i=0;i<leagues.length;i++){var league=leagues[i];switch(category){case"men":-1!==league.division_label.indexOf("Mens")&&categoryArr.push(league);break;case"women":-1!==league.division_label.indexOf("Womens")&&categoryArr.push(league);break;case"open":-1!==league.division_label.indexOf("Open")&&categoryArr.push(league)}}return categoryArr.length?categoryArr:[]},buildProxyButton:function(league){var btnId="plm-ula-";btnId+=league.league_id+"-",btnId+=league.league_division_guid+"-",btnId+=league.season_status;var nameDisplay=league.division_label+"<br />",displayTeams=!1,roster=BBAT.fetchData("directory_division_"+league.league_division_guid+"_"+league.season_status),teamDisplay="";if(roster&&roster.teams&&roster.teams.length>1){displayTeams=!0,nameDisplay+='\n\t\t\t\t\t<div class="pf-team-list">\n\t\t\t\t\t\t<div class="pf-hr"></div>\n\t\t\t\t';for(var j=1;j<roster.teams.length;j++)teamDisplay+=`\n\t\t\t\t\t\t<span class="pf-team-name">\n\t\t\t\t\t\t\t${roster.teams[j].team_name}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`;teamDisplay+="</div>"}return{content:`\n\t\t\t<div class="button round-corners button-lg button-info" id="${btnId}">\n\t\t\t\t<span class="pf-group-name">${nameDisplay}</span>\n\t\t\t\t${displayTeams?teamDisplay:""}\n\t\t\t</div>\n\t\t`,btnId:btnId}},pages:{page1:{hideHeader:!0,content:function(){return'\n\t\t\t\t\t<div id=\'pf-intro\'>\n\t\t\t\t\t\t<svg class="svg-icon mLgBottom mLgTop" viewBox="0 0 40 25" style="height: 5em; width: 10em;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t</svg> \n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 class="text-gold noMargin bold">Welcome to DartConnect!</h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="cpf-buttons" class="mLgTop">\n\t\t\t\t\t\t\t\n\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\tSingles &amp; Pairs Events\n\t\t\t\t\t</p>\n\t\t\t\t\t<div class="button button-lg button-info mLgTop" id="cpf-tournaments">\n\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\tSingles &amp; Pairs Events\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\n\n\t\t\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\t\t\tTeam Events\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t<div class="button button-lg button-info" id="cpf-open">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\tTeam Open Events\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button button-lg button-info" id="cpf-men">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\tTeam Men\'s Events\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="button button-lg button-info" id="cpf-women">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\tTeam Women\'s Events\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.proxyflow;var cpf=customProxyFlow;scope.ele.main.find(".popup-title span").html("&nbsp;"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");cpf.getLeagueEvents("men").length||$("#cpf-men").hide(),cpf.getLeagueEvents("women").length||$("#cpf-women").hide(),cpf.getLeagueEvents("open").length||$("#cpf-open").hide();APP.fns.activateBtn(["cpf-men","cpf-open","cpf-women","cpf-youth"],(function(in_id){switch(in_id){case"cpf-men":customProxyFlow.selectedFlow="men";break;case"cpf-open":customProxyFlow.selectedFlow="open";break;case"cpf-women":customProxyFlow.selectedFlow="women";break;case"cpf-youth":customProxyFlow.selectedFlow="youth"}scope.displayPage(2)})),APP.fns.activateBtn("cpf-tournaments",(function(){scope.displayPage(3)}));scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="fp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("fp-intro-exit",(function(){console.log(scope),scope.exit()}))}},page2:{hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'pf-intro\'>\n\t\t\t\t\t\t<div id="cpf-buttons">\n\t\t\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\t\t\tNo Events Found\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.proxyflow;var i,events,event,cpf=customProxyFlow,header="Welcome Players",btnContent='\n\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\tSelect Event\n\t\t\t\t\t</p>\n\t\t\t\t',btnArr=[];switch(cpf.selectedFlow){case"men":for(header="Men's Events",events=cpf.getLeagueEvents("men"),i=0;i<events.length;i++)btnContent+=(event=cpf.buildProxyButton(events[i])).content,btnArr.push(event.btnId);break;case"women":for(header="Women's Events",events=cpf.getLeagueEvents("women"),i=0;i<events.length;i++)btnContent+=(event=cpf.buildProxyButton(events[i])).content,btnArr.push(event.btnId);break;case"open":for(header="Open Events",events=cpf.getLeagueEvents("open"),i=0;i<events.length;i++)btnContent+=(event=cpf.buildProxyButton(events[i])).content,btnArr.push(event.btnId)}scope.ele.main.find(".popup-title span").html(header),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark"),btnArr.length&&$("#cpf-buttons").empty().append(btnContent),btnArr.length&&APP.proxyflow.activateLeagueBtns(btnArr,scope);scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="sp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),scope.goBackFn=function(){scope.displayPage(1)},APP.fns.activateBtn("sp-intro-exit",(function(){scope.exit()}))}},page3:{hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'pf-intro\'>\n\t\t\t\t\t\t<div id="cpf-buttons">\n\t\t\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\t\t\tNo Events Found\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){var pf=APP.proxyflow;scope.ele.main.find(".popup-title span").html("Singles &amp; Pairs Events"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");var tournamentBtns=[],tournamentContent="";if(APP.session.tournaments)for(key in APP.session.tournaments){var matchDescription=APP.session.tournaments[key].match_description;matchDescription=matchDescription.replace("WDF World Cup 2023 - ",""),tournamentContent+=`\n\t\t\t\t\t\t\t<div class="button button-lg button-info mLgTop" id="pf-tournament-${key}">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t${matchDescription}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,tournamentBtns.push("pf-tournament-"+key)}tournamentBtns.length&&(tournamentContent=`\n\t\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\t\tSelect Event\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t${tournamentContent}\n\t\t\t\t\t`,$("#cpf-buttons").html(tournamentContent),pf.activateTournamentBtns(tournamentBtns,scope));scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="fp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),scope.goBackFn=function(){scope.displayPage(1)},APP.fns.activateBtn("sp-intro-exit",(function(){scope.exit()}))}}}},jasonProxyFlow={name:"jasonProxyflow",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{page1:{hideHeader:!0,content:function(){return'\n\t\t\t\t\t<div id=\'pf-intro\'>\n\t\t\t\t\t\t<svg class="svg-icon mLgBottom mLgTop" viewBox="0 0 40 25" style="height: 5em; width: 10em;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t</svg> \n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<h4 class="text-gold noMargin bold">Welcome to DartConnect!</h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="custom-pf-buttons" class="mLgTop">\n\t\t\t\t\t\t\t<p class="text-gray mLgBottom">\n\t\t\t\t\t\t\t\tSolo 501 Challenge\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="button button-lg button-gold mLgTop round-corners" id="pf-solo-501">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t<span style="font-size:0.7em;">\n\t\t\t\t\t\t\t\t\t\tPlay 501 Solo\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div id="pf-buttons" class="mLgTop">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){var pf=APP.proxyflow;scope.ele.main.find(".popup-title span").html("&nbsp;"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");var eventInfo=pf.buildProxyBtns();$("#pf-buttons").empty().append(eventInfo.content),eventInfo.leagueBtns.length&&APP.proxyflow.activateLeagueBtns(eventInfo.leagueBtns,scope),eventInfo.tournamentBtns.length&&APP.proxyflow.activateTournamentBtns(eventInfo.tournamentBtns,scope);scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="fp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("fp-intro-exit",(function(){console.log(scope),scope.exit()})),APP.fns.activateBtn("pf-solo-501",(function(){scope.exit(),APP.quickplay.playSolo501()}))}}}},isSolo501=function(userOnly){try{return(userOnly||"SOLO"==APP.getMatch().mode&&1==APP.game.opponent_count)&&"jasonmad"==APP.user.login}catch(e){return!1}};APP.userOptions={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="userOptions: ";message+=msg,console.log(message)}},isUserOptions:!1,flow:null,nSync:null,myOpts:null,startSync:function(){APP.userOptions.nSync=new NSync({name:"myUserOptions",defaultData:APP.user_options,offline:!1,getUrl:"player-options/"+APP.user.member_id+"/",postUrl:"player-options",validateFn:function(data){return!!data},callbacks:{preInit:function(scope){var matchMode=APP.session.getMatchMode(),inMatch=!1;matchMode&&(inMatch="BASIC GAME"!==matchMode);var isTournamentMatch="TOURNAMENT"==matchMode,isLeagueMatch=APP.session.isLeaguePlay(),isRails=!1,railsData=BBAT.fetchData("nlf_data");if(railsData&&railsData.railsReturn&&(isRails=!0),isTournamentMatch||isLeagueMatch||inMatch||isRails){var reason="In match";isTournamentMatch?reason="In tournament match":isLeagueMatch?reason="In league match":isRails&&(reason="In Rails"),scope.log("Disabling user options nsync: "+reason),scope.pauseSyncing=!0}},postInit:function(scope){APP.userOptions.myOpts=scope.data},preLocalGet:function(){},postLocalGet:function(scope){try{scope.data&&(APP.user_options=scope.data,APP.userOptions.myOpts=scope.data,scope.data.custom_keys&&(APP.keypad_points.speed_keys_custom=scope.data.custom_keys))}catch(e){}},preLocalSet:function(){},postLocalSet:function(){},prePlatformGet:function(scope){},postPlatformGetSuccess:function(scope){try{scope.data&&(APP.user_options=scope.data,APP.userOptions.myOpts=scope.data,APP.storeUserOptions(!0,!0),scope.data.custom_keys&&(APP.keypad_points.speed_keys_custom=scope.data.custom_keys))}catch(e){}},postPlatformGetError:function(){},prePlatformSet:function(){},postPlatformSet:function(){},prePlatformSync:function(){APP.userOptions.myOpts.custom_keys=APP.keypad_points.speed_keys_custom},PlatformSyncSuccess:function(){},PlatformSyncError:function(){}}})},showUserOptions:function(){this.flowData=this.flow,this.flow=null,this.flow=new UIFlow(this.flowData)},radios:{uoNotables:null,uoRunning3DA:null,uoCricketCues:null,uoTacticsResize:null,uoSpeedKeys:null,uoFastFinishFlights:null,uoDoAttempts:null,uoBustDarts:null,uoGameShot:null,uoFloatingSetScore:null,uoSuggestedOutLeft:null,uoSuggestedOutRight:null,uoSuggestedOutStandard:null,uoSuggestedOutNumeric:null,uoAutoBalance:null,uoBigUI:null,uoForceFullScreen:null,uoRemoteScoreUpdate:null,uoBackUpTablet:null},createOptions:function(){var uo=APP.user_options,notables=uo.notables,running3DA=uo.running_3da,running1DA=uo.running_1da,cricketCues=uo.cricket_cues,tacticsResize=uo.tactics_resize,speedKeys=uo.speed_keys,fastFinishFlights=uo.fast_finish_flights,doAttempts=uo.do_attempts,bustDarts=uo.bust_darts,gameShot=uo.game_shot,floatingSetScore=uo.floating_set_score,suggestedOutLeft=uo.suggested_out_left,suggestedOutRight=uo.suggested_out_right,suggestedOutStandard=uo.suggested_out_standard,suggestedOutNumeric=uo.suggested_out_numeric,autoBalance=uo.auto_balance,bigUI=uo.big_ui,forceFullScreen=uo.force_full_screen,remoteScoreUpdate=uo.remote_score_update,backupTablet=uo.backup_tablet;this.radios.uoNotables=new RadioList({ele:"#uo-notables",opts:[{content:"Show Notables",name:"uoNotables",active:notables}]});var noAverages=!running3DA&&!running1DA;this.radios.uoRunningAverages=new RadioList({ele:"#uo-running-averages",opts:[{content:"Show Game 3DA",name:"1",class:"radio",active:running3DA},{content:"Show Game 1DA",name:"2",class:"radio",active:running1DA},{content:"Don't show Averages",name:"0",class:"radio",active:noAverages}],min:1,max:1,callbacks:{deselected:function(r,e){if(r.returnSelected()==e){var _this=r;window.setTimeout((function(){_this.toggle(e)}),0)}}}}),this.radios.uoCricketCues=new RadioList({ele:"#uo-cricket-cues",opts:[{content:"Show DC Cricket Enhancements",name:"uoCricketCues",active:cricketCues}]}),this.radios.uoTacticsResize=new RadioList({ele:"#uo-tactics-resize",opts:[{content:"Use Display Mode for Tactics",name:"uoTacticsResize",active:tacticsResize}]}),this.radios.uoSpeedKeys=new RadioList({ele:"#uo-speed-keys",opts:[{content:"Use Basic '01 Quick Keys",name:"0",class:"radio",active:0===speedKeys},{content:"Use Advanced '01 Quick Keys",name:"1",class:"radio",active:1===speedKeys},{content:"Use Pro '01 Quick Keys",name:"2",class:"radio",active:2===speedKeys},{content:"Use Custom '01 Quick Keys",name:"3",class:"radio",active:3===speedKeys}],min:1,max:1,callbacks:{selected:function(r,e){"3"==e?$("#uo-set-speed-keys").removeClass("hide"):$("#uo-set-speed-keys").addClass("hide")},deselected:function(r,e){if(r.returnSelected()==e){var _this=r;window.setTimeout((function(){_this.toggle(e)}),0)}}}}),this.radios.uoFastFinishFlights=new RadioList({ele:"#uo-fast-finish-flights",opts:[{content:"Show '01 Game Finish Flights",name:"uoFastFinishFlights",active:fastFinishFlights}]}),this.radios.uoDoAttempts=new RadioList({ele:"#uo-do-attempts",opts:[{content:"Track Double Out Attempts",name:"uoDoAttempts",active:doAttempts}]}),this.radios.uoBustDarts=new RadioList({ele:"#uo-bust-darts",opts:[{content:"Track Bust Darts",name:"uoBustDarts",active:bustDarts}]}),this.radios.uoGameShot=new RadioList({ele:"#uo-game-shot",opts:[{content:"Confirm Game Shot Player",name:"uoGameShot",active:gameShot}]}),this.radios.uoFloatingSetScore=new RadioList({ele:"#uo-floating-set-score",opts:[{content:"<span class='bold'>NEW</span> Show 01 Match Score Banner",name:"uoFloatingSetScore",active:floatingSetScore}]}),this.radios.uoSuggestedOutLeft=new RadioList({ele:"#uo-suggested-out-left",opts:[{content:"Show for LEFT Opponent",name:"uoSuggestedOutLeft",active:suggestedOutLeft}],callbacks:{selected:function(){APP.userOptions.manageSelectedOut("uoSuggestedOutLeft",1)},deselected:function(r){APP.userOptions.manageSelectedOut("uoSuggestedOutLeft",0)}}}),this.radios.uoSuggestedOutRight=new RadioList({ele:"#uo-suggested-out-right",opts:[{content:"Show for RIGHT Opponent",name:"uoSuggestedOutRight",active:suggestedOutRight}],callbacks:{selected:function(r){APP.userOptions.manageSelectedOut("uoSuggestedOutRight",1)},deselected:function(r){APP.userOptions.manageSelectedOut("uoSuggestedOutRight",0)}}}),this.radios.uoSuggestedOutStandard=new RadioList({ele:"#uo-suggested-out-standard",opts:[{content:"Style: Standard (T20 19 DB)",name:"uoSuggestedOutStandard",active:suggestedOutStandard}],callbacks:{selected:function(r){APP.userOptions.manageOutsType("uoSuggestedOutStandard",1)},deselected:function(r){APP.userOptions.manageOutsType("uoSuggestedOutStandard",0)}}}),this.radios.uoSuggestedOutNumeric=new RadioList({ele:"#uo-suggested-out-numeric",opts:[{content:"Style: Numeric (60 19 50)",name:"uoSuggestedOutNumeric",active:suggestedOutNumeric}],callbacks:{selected:function(r){APP.userOptions.manageOutsType("uoSuggestedOutNumeric",1)},deselected:function(r){APP.userOptions.manageOutsType("uoSuggestedOutNumeric",0)}}}),this.radios.uoAutoBalance=new RadioList({ele:"#uo-auto-balance",opts:[{content:"Dynamic Handicapping (beta)",name:"uoAutoBalance",active:autoBalance}]}),this.radios.uoBigUI=new RadioList({ele:"#uo-big-ui",opts:[{content:"Use Large Score Keys (small screens)",name:"uoBigUI",active:bigUI}]}),this.radios.uoForceFullScreen=new RadioList({ele:"#uo-force-full-screen",opts:[{content:"Force Full Screen Mode (beta)",name:"uoForceFullScreen",active:forceFullScreen}]}),this.radios.uoRemoteScoreUpdate=new RadioList({ele:"#uo-remote-score-update",opts:[{content:"Activate Remote Score Entry",name:"uoRemoteScoreUpdate",active:remoteScoreUpdate}]}),this.radios.uoBackUpTablet=new RadioList({ele:"#uo-back-up-tablet",opts:[{class:"danger",content:"Set as Backup Tablet",name:"uoBackUpTablet",active:backupTablet}],callbacks:{selected:function(r){APP.userOptions.confirmBackupTablet(1)},deselected:function(r){APP.userOptions.confirmBackupTablet(0)}}})},getOptions:function(){var notables=!!APP.userOptions.radios.uoNotables.returnSelected(),running3DA=!1,running1DA=!1;switch(APP.userOptions.radios.uoRunningAverages.returnSelected()){case"1":running3DA=!0,running1DA=!1;break;case"2":running3DA=!1,running1DA=!0;break;default:running3DA=!1,running1DA=!1}var cricketCues=!!APP.userOptions.radios.uoCricketCues.returnSelected(),tacticsResize=!!APP.userOptions.radios.uoTacticsResize.returnSelected(),fastFinishFlights=!!APP.userOptions.radios.uoFastFinishFlights.returnSelected(),doAttempts=!!APP.userOptions.radios.uoDoAttempts.returnSelected(),bustDarts=!!APP.userOptions.radios.uoBustDarts.returnSelected(),gameShot=!!APP.userOptions.radios.uoGameShot.returnSelected(),floatingSetScore=!!APP.userOptions.radios.uoFloatingSetScore.returnSelected(),speedKeys=APP.userOptions.radios.uoSpeedKeys.returnSelected(),suggestedOutLeft=!!APP.userOptions.radios.uoSuggestedOutLeft.returnSelected(),suggestedOutRight=!!APP.userOptions.radios.uoSuggestedOutRight.returnSelected(),suggestedOutStandard=!!APP.userOptions.radios.uoSuggestedOutStandard.returnSelected(),suggestedOutNumeric=!!APP.userOptions.radios.uoSuggestedOutNumeric.returnSelected(),autoBalance=!!APP.userOptions.radios.uoAutoBalance.returnSelected(),bigUI=!!APP.userOptions.radios.uoBigUI.returnSelected(),forceFullScreen=!!APP.userOptions.radios.uoForceFullScreen.returnSelected(),remoteScoreUpdate=!!APP.userOptions.radios.uoRemoteScoreUpdate.returnSelected(),backupTablet=!!APP.userOptions.radios.uoBackUpTablet.returnSelected();return{notables:notables,running3DA:running3DA,running1DA:running1DA,cricketCues:cricketCues,tacticsResize:tacticsResize,speedKeys:parseFloat(speedKeys),fastFinishFlights:fastFinishFlights,doAttempts:doAttempts,bustDarts:bustDarts,gameShot:gameShot,floatingSetScore:floatingSetScore,suggestedOutLeft:suggestedOutLeft,suggestedOutRight:suggestedOutRight,suggestedOutStandard:suggestedOutStandard,suggestedOutNumeric:suggestedOutNumeric,autoBalance:autoBalance,bigUI:bigUI,forceFullScreen:forceFullScreen,remoteScoreUpdate:remoteScoreUpdate,backupTablet:backupTablet}},applyOptions:function(ignoreExit){var uo=APP.user_options,mo=APP.userOptions.getOptions(),isAutoBalanceActive=APP.user_options.auto_balance;uo.notables=mo.notables,uo.running_3da=mo.running3DA,uo.running_1da=mo.running1DA,uo.cricket_cues=mo.cricketCues,uo.tactics_resize=mo.tacticsResize,uo.fast_finish_flights=mo.fastFinishFlights,uo.do_attempts=mo.doAttempts,uo.bust_darts=mo.bustDarts,uo.game_shot=mo.gameShot,uo.floating_set_score=mo.floatingSetScore,uo.speed_keys=mo.speedKeys,uo.suggested_out_left=mo.suggestedOutLeft,uo.suggested_out_right=mo.suggestedOutRight,uo.suggested_out_standard=mo.suggestedOutStandard,uo.suggested_out_numeric=mo.suggestedOutNumeric,uo.auto_balance=mo.autoBalance,uo.big_ui=mo.bigUI,uo.force_full_screen=mo.forceFullScreen,uo.remote_score_update=mo.remoteScoreUpdate,uo.backup_tablet=mo.backupTablet,APP.storeUserOptions(!0),APP.plugin_cricket.storeSettings(!0),APP.userOptions.nSync.updateData(APP.user_options),ignoreExit||APP.userOptions.flow.exit(),APP.keypad_points.setSpeedKeys(),mo.backupTablet?$("html").addClass("backup-tablet"):$("html").removeClass("backup-tablet"),uo.auto_balance&&(isAutoBalanceActive||APP.game.setInitialAutoBalanceHandicap()),ignoreExit||"PRE-ROLE"!==APP.mode&&APP.reload()},updateOption:function(obj,noReload){try{if(!obj)return void this.log("No obj passed",!0);if(!obj.option)return void this.log("No option passed",!0);if(void 0===obj.val)return void this.log("No val passed",!0);var options=APP.user_options;if(void 0===options[obj.option])switch(obj.option){case"bust_darts":options[obj.option]=obj.val;break;default:return void this.log("Option "+option+" does not exist",!0)}options[obj.option]=obj.val,APP.storeUserOptions(!0),APP.plugin_cricket.storeSettings(!0),"PRE-ROLE"===APP.mode||noReload||APP.reload()}catch(e){}},restoreFromBackup:function(reload){try{var backup=APP.userOptions.nSync.data;backup&&(APP.user_options=backup,APP.storeUserOptions(!0),reload&&APP.reload())}catch(e){}},manageSelectedOut:function(r,on){var soStandard=APP.userOptions.radios.uoSuggestedOutStandard,soNumeric=APP.userOptions.radios.uoSuggestedOutNumeric,soLeft=APP.userOptions.radios.uoSuggestedOutLeft,soRight=APP.userOptions.radios.uoSuggestedOutRight,types=0;(soStandard.returnSelected()||soNumeric.returnSelected())&&types++;var sides=[];soLeft.returnSelected()&&sides.push("uoSuggestedOutLeft"),soRight.returnSelected()&&sides.push("uoSuggestedOutRight");var index=sides.indexOf(r);if(index>-1&&sides.splice(index,1),sides=sides.length,on){if(types)return;soStandard.toggle("uoSuggestedOutStandard")}else sides||(soStandard.returnSelected()&&soStandard.toggle("uoSuggestedOutStandard"),soNumeric.returnSelected()&&soNumeric.toggle("uoSuggestedOutNumeric"))},manageOutsType:function(r,on){var soStandard=APP.userOptions.radios.uoSuggestedOutStandard,soNumeric=APP.userOptions.radios.uoSuggestedOutNumeric,soLeft=APP.userOptions.radios.uoSuggestedOutLeft,soRight=APP.userOptions.radios.uoSuggestedOutRight,sides=0;(soLeft.returnSelected()||soRight.returnSelected())&&sides++;var types=[];soStandard.returnSelected()&&types.push("uoSuggestedOutStandard"),soNumeric.returnSelected()&&types.push("uoSuggestedOutNumeric");var index=types.indexOf(r);if(index>-1&&types.splice(index,1),types=types.length,on){if(types&&("uoSuggestedOutStandard"==r?soNumeric.toggle("uoSuggestedOutNumeric"):soStandard.toggle("uoSuggestedOutStandard")),sides)return;return soLeft.toggle("uoSuggestedOutLeft"),void soRight.toggle("uoSuggestedOutRight")}types||(soLeft.returnSelected()&&soLeft.toggle("uoSuggestedOutLeft"),soRight.returnSelected()&&soRight.toggle("uoSuggestedOutRight"))},confirmBackupTablet:function(on){var msg="Are you sure you want to set this tablet as the Backup Tablet? This will stop the tablet from broadcasting to DCTV.";on||(msg="Are you sure you want to remove this tablet as the Backup Tablet? This will allow the tablet to broadcast to DCTV."),APP.alert.show(msg)},init:function(){this.showUserOptions()}},APP.userOptions.flow={name:"userOptions",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},scope:this,pages:{page1:{hideHeader:!1,hideBackBtn:!0,content:function(){return'\n\t\t\t\t\t<h4 class="text-gold mNoneLeft mNoneTop">Experience</h4>\n\t\t\t\t\t<div id="uo-notables"></div>\n\t\t\t\t\t<div id="uo-cricket-cues"></div>\n\t\t\t\t\t<div id="uo-tactics-resize"></div>\n\t\t\t\t\t<div id="uo-fast-finish-flights"></div>\n\t\t\t\t\t<div id="uo-do-attempts"></div>\n\t\t\t\t\t<div id="uo-bust-darts"></div>\n\t\t\t\t\t<div id="uo-game-shot"></div>\n\t\t\t\t\t<div id="uo-floating-set-score"></div>\n\n\t\t\t\t\t<h4 class="text-gold mNoneLeft">Averages</h4>\n\t\t\t\t\t<div id="uo-running-averages"></div>\n\n\t\t\t\t\t<h4 class="text-gold mNoneLeft">Speed Keys</h4>\n\t\t\t\t\t<div id="uo-speed-keys"></div>\n\t\t\t\t\t\n\t\t\t\t\t<div class="button button-md mLgBottom button-block button-gold round-corners hide" id="uo-set-speed-keys">\n\t\t\t\t\t\tSet Custom Speed Keys\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<h4 class="text-gold mNoneLeft">01 Out Chart</h4>\n\t\t\t\t\t<div id="uo-suggested-out-left"></div>\n\t\t\t\t\t<div id="uo-suggested-out-right"></div>\n\t\t\t\t\t<div id="uo-suggested-out-standard"></div>\n\t\t\t\t\t<div id="uo-suggested-out-numeric"></div>\n\n\t\t\t\t\t<h4 class="text-gold mNoneLeft">Other</h4>\n\t\t\t\t\t<div id="uo-auto-balance"></div>\n\t\t\t\t\t<div id="uo-big-ui"></div>\n\t\t\t\t\t<div id="uo-force-full-screen"></div>\n\t\t\t\t\t<div id="uo-remote-score-update"></div>\n\t\t\t\t\t<div id="uo-back-up-tablet"></div>\n\t\t\t\t'},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="my-uo-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="my-uo-save" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSave/Apply\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("my-uo-save",(function(){APP.userOptions.applyOptions()})),APP.fns.activateBtn("my-uo-cancel",(function(){APP.userOptions.flow.exit()}))},init:function(scope){scope.ele.main.find(".popup-title span").html("User Options"),scope.ele.scrollBox.addClass("primary-grad-dark"),APP.userOptions.createOptions(),3===APP.user_options.speed_keys&&$("#uo-set-speed-keys").removeClass("hide"),APP.fns.activateBtn("uo-set-speed-keys",(function(){APP.userOptions.applyOptions(!0),APP.userOptions.flow.displayPage(2)})),this.addFooter(scope)}},page2:{hideHeader:!1,hideBackBtn:!1,hideExitBtn:!0,content:function(){var customSpeedKeys=APP.keypad_points.speed_keys_custom;return`\n\t\t\t\t\t<h4 class="text-gold mNoneLeft mNoneTop">Custom Speed Keys</h4>\n\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t<p>\n\t\t\t\t\t\t\t<span class="bold">Speed Key Rules</span><br />\n\t\t\t\t\t\t\tSpeed Keys must be numeric and between 10 and 180<br />\n\t\t\t\t\t\t\tClick a number to change it\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<table class="speed-keys-table mLgTop" style="width: 100%; text-align: center">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t\t<p class="bold">Left Speed Keys</p>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0 0.3em 0.3em";>\n\t\t\t\t\t\t\t\t<p class="bold">Right Speed Keys</p>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[0]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-1"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0 0.3em 0.3em";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[4]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-5"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[1]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-2"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0 0.3em 0.3em";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[5]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-6"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[2]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-3"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0 0.3em 0.3em";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[6]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-7"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0.3em 0.3em 0";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[3]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-4"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="width: 50%; padding: 0.3em 0 0.3em 0.3em";>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype="number"\n\t\t\t\t\t\t\t\t\tmin="1"\n\t\t\t\t\t\t\t\t\tstep="1"\n\t\t\t\t\t\t\t\t\tvalue="${customSpeedKeys[7]}"\n\t\t\t\t\t\t\t\t\tclass="speed-key-input no-spinner"\n\t\t\t\t\t\t\t\t\tid="my-sk-8"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`},addFooter:function(scope){scope.ele.footerContent.append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="my-sk-cancel" \n\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\tid="my-sk-save" \n\t\t\t\t\t\t\t\t\tclass="button-green button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tSave\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("my-sk-save",(function(){var mySpeedKeys=[];mySpeedKeys.push(parseInt($("#my-sk-1").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-2").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-3").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-4").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-5").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-6").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-7").val(),10)),mySpeedKeys.push(parseInt($("#my-sk-8").val(),10));var resp=APP.keypad_points.setCustomSpeedKeys(mySpeedKeys),nSyncData=APP.userOptions.nSync.data;nSyncData.custom_keys=mySpeedKeys,APP.userOptions.nSync.updateData(nSyncData),resp.response?(APP.alert.show("Custom Speed Keys Saved"),APP.userOptions.flow.displayPage(1),APP.device.resumeKeyboardHandler()):APP.alert.show("Please check your speed keys are valid",(function(){window.setTimeout((function(){APP.device.pauseKeyboardHandler()}),100)}))})),APP.fns.activateBtn("my-sk-cancel",(function(){APP.device.resumeKeyboardHandler(),APP.userOptions.flow.displayPage(1)}))},init:function(scope){APP.device.pauseKeyboardHandler(),APP.fns.activateInput("speed-key-input",(function(ele){$(ele).val("")})),scope.ele.main.find(".popup-title span").html("Custom Speed Keys"),scope.ele.scrollBox.addClass("primary-grad-dark"),scope.goBackFn=function(){APP.device.resumeKeyboardHandler(),APP.userOptions.flow.displayPage(1)},this.addFooter(scope)}}}},APP.tacticsResize={inited:!1,active:!1,resized:!1,calculated:!1,forceOff:!1,ele:{sb:$("#scoreboard"),ch:$("#chalkboard"),sbCenter:$("#scoreboard-center"),sbCricket:$("#scoreboard-cricket"),sbButtons:null,sbModifiers:null,h:$("#header"),w:$(window),backBtn:$("#mb-ig-funcl"),missBtn:$("#mb-ig-funcr"),scoringOption:$("#sb-cricket-scoring-option"),body:$("body"),achieve:$(".sb-c-achieve"),gameTarget:$(".sb-c-game-target")},original:{sb:null,ch:null,sbCenter:null,sbCricket:null,fontSize:null},display:{calculated:!1,sb:null,ch:null,sbCenter:null,sbCricket:null,fontSize:null},init:function(){if("IN-GAME"===APP.mode){this.inited=!0;try{if(-1==APP.game.getGameName().indexOf("Tactics"))return void(this.active=!1)}catch(e){return void(this.active=!1)}APP.isOnlineMatch()||APP.user_options.big_ui||APP.game.isBotPlaying()?this.active=!1:APP.user_options.tactics_resize?(this.active=!0,APP.popup.hide("popup-notable"),BBAT.fetchData("tr_seen")||this.showWelcome()):this.active=!1}else this.inited=!1},showWelcome:function(){APP.alert.show('\n\t\t\t<span class="bold">This is Display Mode</span><br /><br />\n\t\t\tThis view helps you to see the status of Longer Format Target Games like Tactics a bit easier<br /><br />\n\t\t\t<span class="bold text-red">Tap anywhere to enter a turn</span><br /><br />\n\t\t\tDisplay Mode will automatically resume after each turn\n\t\t',"OKAY!",!1,"Welcome"),BBAT.storeData({tr_seen:!0})},toggle:function(forceOff){this.inited||this.init(),this.active&&(this.forceOff||"IN-GAME"===APP.mode&&(APP.user_options.notables=!1,this.calculated||this.calculateSizes(),forceOff||this.resized?this.showUI():this.hideUI()))},reloadToggle:function(){if(this.inited||this.init(),this.active){var cOppo=APP.game.current_opponent,oppo=APP.game.opponent[cOppo],cRound=APP.game.current_round;0==oppo.getUserInput(cRound).length&&this.toggle()}},hideUI:function(){if(this.display.calculated){this.ele.body.addClass("tactics"),this.ele.sb.height(this.display.sb),this.ele.ch.height(this.display.ch),this.ele.sbCenter.height(this.display.sbCenter),this.ele.sbCricket.height(this.display.sbCricket);for(var fontSize=this.display.fontSize,i=0;i<this.ele.sbButtons.length;i++){var btn=this.ele.sbButtons[i];btn.style.fontSize=fontSize,btn.classList.add("button-white")}for(elements=document.querySelectorAll(".sb-c-game-target-modifier"),this.ele.sbModifiers=elements,i=0;i<this.ele.sbModifiers.length;i++){this.ele.sbModifiers[i].classList.add("hide")}this.ele.backBtn.addClass("floating"),this.ele.missBtn.addClass("floating"),this.ele.scoringOption.addClass("hidden"),this.ele.achieve.addClass("hide"),this.resized=!0}else this.calculateDisplay()},showUI:function(){var i;if(this.ele.body.removeClass("tactics"),this.ele.sb.height(this.original.sb),this.ele.ch.height(this.original.ch),this.ele.sbCenter.height(this.original.sbCenter),this.ele.sbCricket.height(this.original.sbCricket),this.ele.sbButtons)for(i=0;i<this.ele.sbButtons.length;i++){var btn=this.ele.sbButtons[i];btn.style.fontSize="",btn.classList.remove("button-white")}if(this.ele.sbModifiers)for(i=0;i<this.ele.sbModifiers.length;i++){this.ele.sbModifiers[i].classList.remove("hide")}this.ele.backBtn.removeClass("floating"),this.ele.missBtn.removeClass("floating"),this.ele.scoringOption.removeClass("hidden"),this.ele.achieve.removeClass("hide"),this.ele.gameTarget.removeClass("button-white"),this.resized=!1},calculateLargestFontSize:function(container){return.8*document.querySelector(container).clientHeight+"px"},getFontSize:function(ele){var divElement=document.querySelector(ele);return window.getComputedStyle(divElement).fontSize},calculateSizes:function(){this.original.sb=this.ele.sb.height(),this.original.ch=this.ele.ch.height(),this.original.sbCenter=this.ele.sbCenter.height(),this.original.sbCricket=this.ele.sbCricket.height(),this.original.fontSize=this.getFontSize("#scoreboard-cricket"),this.calculated=!0},calculateDisplay:function(){this.ele.body.addClass("tactics");var sb=this.ele.w.height()-this.ele.h.height();this.ele.sb.height(sb),this.ele.ch.height(sb),this.ele.sbCenter.height(sb),this.ele.sbCricket.height(sb),this.display.sb=sb,this.display.ch=sb,this.display.sbCenter=sb,this.display.sbCricket=sb;var fontSize=this.calculateLargestFontSize("#sb-c-r1");this.display.fontSize=fontSize;var elements=document.querySelectorAll(".sb-c-game-target-button");this.ele.sbButtons=elements;for(var i=0;i<this.ele.sbButtons.length;i++){var btn=this.ele.sbButtons[i];btn.style.fontSize=fontSize,btn.classList.add("button-white")}for(elements=document.querySelectorAll(".sb-c-game-target-modifier"),this.ele.sbModifiers=elements,i=0;i<this.ele.sbModifiers.length;i++){this.ele.sbModifiers[i].classList.add("hide")}this.ele.backBtn.addClass("floating"),this.ele.missBtn.addClass("floating"),this.ele.scoringOption.addClass("hidden"),this.ele.achieve.addClass("hide"),this.resized=!0,this.display.calculated=!0}},APP.starpubs={debugMode:!1,log:function(msg,force){if(this.debugMode||force){var message="starpubs: ";message+=msg,console.log(message)}},leagueId:"dartsstarsukpubs",leagueBtnId:null,data:{version:8,teamId:null,introSeen:!1,guestSelectPlayers:!1,guestLeagueData:null,match:{id:null,home:{lineup:[],confirmed:!1},away:{lineup:[],confirmed:!1}},tiebreak:{home:{player:null,confirmed:!1},away:{player:null,confirmed:!1}}},flowData:null,flow:null,isSelectingPlayers:!1,isSelectingTiebreaker:!1,starterSet:!1,save:function(){BBAT.storeData({starpubs_data:APP.starpubs.data})},load:function(){var savedData=BBAT.fetchData("starpubs_data");if(savedData){if(savedData.version!=this.data.version)return void this.updateDataStructure();this.data.introSeen=savedData.introSeen,this.data.teamId=savedData.teamId,this.data.match=savedData.match,this.data.tiebreak=savedData.tiebreak,this.data.guestSelectPlayers=savedData.guestSelectPlayers,this.data.guestLeagueData=savedData.guestLeagueData}},clear:function(){BBAT.flushData("starpubs_data")},reloadCheck:function(){BBAT.fetchData("starpubs_data")&&this.load(),this.init()},updateDataStructure:function(){this.clear(),this.save(),APP.reload()},isStarPubsAccount:function(){var leagues=APP.user.league_associations;if(!leagues||0==leagues.length)return!1;var myLeague=APP.findInObjArray("league_id",leagues,this.leagueId)[0];return!!myLeague&&(this.leagueBtnId="plm-ula-"+myLeague.league_id+"-"+myLeague.league_division_guid+"-"+myLeague.season_status,!0)},isStarPubsMatch:function(){try{if(this.data.guestSelectPlayers)return!0;var leagueMatchId=APP.getMatch().league_id;if(this.leagueId==leagueMatchId)return!0}catch(e){}return!1},checkIntro:function(){APP.nlf.rails.data.railsReturn||this.data.introSeen||"PRE-ROLE"!=APP.mode||(this.log("Show Intro"),this.showIntro(),this.data.introSeen=!0,this.save())},showIntro:function(){this.flowData=starpubsFlow,this.flow=null,this.flow=new UIFlow(this.flowData)},injectHomeButton:function(){"PRE-ROLE"==APP.mode&&($("#drm-practice").addClass("hide"),$("#drm-star-pubs").removeClass("hide"),APP.fns.activateBtn("drm-star-pubs",APP.starpubs.showIntro))},isAway:function(){return"PARTICIPANT"==APP.device.role},reloadGuest:function(){this.isAway()&&(APP.nlf.data.league||this.data.guestLeagueData&&(this.log("reloaded data"),APP.nlf.data.league=this.data.guestLeagueData,APP.nlf.save()))},getLineUps:function(){var matchId=this.getMatchId();return this.data.match.id!==matchId&&(this.data.match.id=matchId,this.data.match.home.lineup=[],this.data.match.away.lineup=[],this.data.tiebreak.home.player=null,this.data.tiebreak.home.confirmed=!1,this.data.tiebreak.away.player=null,this.data.tiebreak.away.confirmed=!1,this.save()),[this.data.match.home.lineup,this.data.match.away.lineup]},getMatchId:function(){var matchId;return matchId=APP.nlf.data.matchId,matchId+="-",matchId+=APP.nlf.data.league.season_status},saveLineUp:function(){for(var lineUp=APP.starpubs.selector.selectionArr,i=0;i<lineUp.length;i++){var player=lineUp[i];player&&player.split("_").length>1&&(player=player.split("_")[2]),lineUp[i]=player}if(APP.starpubs.isAway())return this.data.match.away.lineup=lineUp,this.save(),this.isSelectingTiebreaker?(this.data.tiebreak.away.player=lineUp,this.save()):(this.data.match.away.lineup=lineUp,this.save()),APP.message.send.playerLineUpSend(APP.starpubs.selector.selectionArr),void this.flow.show(2);this.isSelectingTiebreaker?(this.data.tiebreak.home.player=lineUp,this.save()):(this.data.match.home.lineup=lineUp,this.save()),APP.message.send.playerLineUpSend(APP.starpubs.selector.selectionArr),this.checkLineUpsComplete()&&this.startMatch(),this.flow.show(2)},saveReceivedLineUp:function(lineUp){this.isAway()?this.isSelectingTiebreaker?(this.data.tiebreak.home.player=lineUp,this.data.tiebreak.home.confirmed=!0):(this.data.match.home.lineup=lineUp,this.data.match.home.confirmed=!0):this.isSelectingTiebreaker?(this.data.tiebreak.away.player=lineUp,this.data.tiebreak.away.confirmed=!0):(this.data.match.away.lineup=lineUp,this.data.match.away.confirmed=!0),this.save(),this.checkLineUpsComplete()&&this.startMatch()},confirmLineUpReceived:function(){this.isAway()?this.isSelectingTiebreaker?this.data.tiebreak.away.confirmed=!0:this.data.match.away.confirmed=!0:this.isSelectingTiebreaker?this.data.tiebreak.home.confirmed=!0:this.data.match.home.confirmed=!0,this.save()},setUpPlayers:function(){APP.handleMatchOption("bb-e-new-players"),this.autoSelectPlayers(),APP.header.handleOpponentChange("oph-bb-sfb")},checkLineUpsComplete:function(){var match=APP.starpubs.data.match;return this.isSelectingTiebreaker&&(match=APP.starpubs.data.tiebreak),!(!match.home.confirmed||!match.away.confirmed)},startMatch:function(){if(this.isSelectingTiebreaker)return APP.starpubs.save(),void APP.starpubs.flow.exit();if(this.isSelectingPlayers=!1,this.guestSelectPlayers=!1,this.guestLeagueData=null,this.save(),APP.starpubs.flow.exit(),this.isAway()){APP.popup.show("popup-notable",'\n\t\t\t\t<span style="font-size: 0.5em !important; line-height: 1.3em !important; display: block;">\n\t\t\t\t\tLineups confirmed - Match will begin shortly\n\t\t\t\t</span>\n\t\t\t')}else this.setLegsRace(),this.setUpPlayers(),this.runAutomations()},continueMatch:function(){this.checkLineUpsComplete()&&this.autoSelectNewGamePlayers()&&(APP.header.handleOpponentChange("oph-bb-sfb"),this.runAutomations())},continueTiebreaker:function(){this.autoSelectTieBreakPlayers()&&window.setTimeout((function(){APP.header.handleOpponentChange("oph-bb-sfb"),APP.session.handleBullShoot("bs-opponent-0"),APP.session.handleGameSelector("lgs-game-0")}),100)},runAutomations:function(){window.setTimeout((function(){APP.starpubs.setInitialStarter();var setNumber=APP.getMatch().sets.length;starter=setNumber%2==0?1:0,APP.session.handleBullShoot("bs-opponent-"+starter),"test"==APP.location?APP.session.handleGameSelector("lgs-game-1"):APP.session.handleGameSelector("lgs-game-0")}),100)},endMatch:function(){this.data.guestLeagueData=null,this.data.guestSelectPlayers=!1,this.save()},selector:null,showSelectPlayers:function(){this.isSelectingPlayers=!0,$("#popup-notice").addClass("hide");var lineUps=this.getLineUps();lineUps[0].length&&lineUps[1].length||(this.flowData=selectPlayersFlow,this.flow=null,this.flow=new UIFlow(this.flowData))},getTeamPlayers:function(getTeamOnly){var leagueData=APP.nlf.data.league;this.isAway()&&(leagueData=APP.starpubs.data.guestLeagueData);var leagueId=leagueData.league_division_guid;leagueId+="_",leagueId+=leagueData.season_status;var team,directory=BBAT.fetchData("directory_division_"+leagueId);return APP.starpubs.isAway()?(team=APP.findInObjArray("team_guid",directory.teams,APP.starpubs.data.teamId)[0])?getTeamOnly?team:team.players:[]:(team=APP.findInObjArray("team_guid",directory.teams,APP.nlf.data.homePlayer)[0])?team.players:[]},getTeam:function(teamId){var leagueData=APP.nlf.data.league;this.isAway()&&(leagueData=APP.starpubs.data.guestLeagueData);var leagueId=leagueData.league_division_guid;leagueId+="_",leagueId+=leagueData.season_status;var directory=BBAT.fetchData("directory_division_"+leagueId),team=APP.findInObjArray("team_guid",directory.teams,teamId)[0];return team||[]},buildPlayerList:function(){var players=this.getTeamPlayers();if(!players.length){return APP.alert.show("\n\t\t\t\t<h4>No Players Found</h4>\n\t\t\t\t<p>Please use the standard player select menu and sync players</p>\n\t\t\t"),void APP.starpubs.flow.exit()}for(var spices=[],i=0;i<players.length;i++){var player=players[i],content=`\n\t\t\t\t<span class="star-pubs-player-order"></span>\n\t\t\t\t<span class="bold">${player.last_name}</span><br />\n\t\t\t\t${player.first_name}\n\t\t\t`;spices.push({content:content,class:"button-lg round-corners button-white",name:player.player_guid})}if(spices.length){var minMax=4;APP.starpubs.isSelectingTiebreaker&&(minMax=1),this.selector=new SpiceSelector({id:"ps",ele:"#star-pubs-player-list",min:minMax,max:minMax,spices:spices,defaultClass:"button-white",highlightClass:"button-info",callbacks:{preInit:function(){},postInit:function(){},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){APP.starpubs.displayLineUpOrder(self.selectionArr)},deselected:function(self,selectedSpice){APP.starpubs.displayLineUpOrder(self.selectionArr)},complete:function(self){$("#sp-confirm-lineup").removeClass("button-disabled")},incomplete:function(self){$("#sp-confirm-lineup").addClass("button-disabled")}}})}},displayLineUpOrder:function(lineUpArr){$(".star-pubs-player-order").empty();for(var i=0;i<lineUpArr.length;i++){var btnId=lineUpArr[i];$("#"+btnId+" .star-pubs-player-order").html(i+1)}},checkForTiebreaker:function(){if(APP.is_reloading)return!1;if(!APP.starpubs.isStarPubsAccount())return!1;if(!APP.starpubs.isStarPubsMatch())return!1;var gm=APP.getMatch();return 2==gm.set_wins[0]&&2==gm.set_wins[1]},showSelectTieBreakPlayer:function(){this.isSelectingTiebreaker=!0,$("#popup-notice").addClass("hide");var tb=APP.starpubs.data.tiebreak;tb.home.confirmed&&tb.away.confirmed||(this.flowData=selectPlayersFlow,this.flow=null,this.flow=new UIFlow(this.flowData))},autoSelectPlayers:function(){if(APP.nlf.data.matchLoaded){var home_id=APP.nlf.data.homePlayer,away_id=APP.nlf.data.awayPlayer;APP.header.home_away_selected=!0;var errorSelectingPlayer=!1;try{"TEAM"==APP.nlf.data.league.league_type?(APP.header.roster_left.getTeamIndex()||APP.header.handleOpponentChange("op-button-left-T"+home_id),APP.header.roster_right.getTeamIndex()||APP.header.handleOpponentChange("op-button-right-T"+away_id),$("#oph-bb-reset-left").addClass("button-disabled"),$("#oph-bb-reset-right").addClass("button-disabled")):(APP.header.roster_left.getPlayerCount()||(APP.nlf.checkPlayerExists(home_id)?APP.header.handleOpponentChange("op-button-left-P"+home_id):errorSelectingPlayer=!0),APP.header.roster_right.getPlayerCount()||(APP.nlf.checkPlayerExists(away_id)?APP.header.handleOpponentChange("op-button-right-P"+away_id):errorSelectingPlayer=!0));var homeTeam=APP.findInObjArray("team_guid",APP.header.teams,home_id)[0],awayTeam=APP.findInObjArray("team_guid",APP.header.teams,away_id)[0],setNumber=APP.getMatch().sets.length-1,homeId=APP.starpubs.data.match.home.lineup[setNumber],awayId=APP.starpubs.data.match.away.lineup[setNumber],home_player_id=homeId,away_player_id=awayId;home_player_id&&away_player_id&&(APP.findInObjArray("player_guid",homeTeam.players,home_player_id)[0]?APP.header.handleOpponentChange("op-button-left-P"+home_player_id):errorSelectingPlayer=!0,APP.findInObjArray("player_guid",awayTeam.players,away_player_id)[0]?APP.header.handleOpponentChange("op-button-right-P"+away_player_id):errorSelectingPlayer=!0)}catch(e){errorSelectingPlayer=!0}errorSelectingPlayer&&(APP.header.home_away_selected=!1,APP.device.hideSpinnerOverlay())}},autoSelectNewGamePlayers:function(){var home_id=APP.header.roster_left.team.obj_id,away_id=APP.header.roster_right.team.obj_id;APP.header.home_away_selected=!0;var errorSelectingPlayer=!1;try{var homeTeam=APP.findInObjArray("obj_id",APP.header.teams,home_id)[0],awayTeam=APP.findInObjArray("obj_id",APP.header.teams,away_id)[0],setNumber=APP.getMatch().sets.length-1,homeId=APP.starpubs.data.match.home.lineup[setNumber],awayId=APP.starpubs.data.match.away.lineup[setNumber],home_player_id=homeId,away_player_id=awayId;home_player_id&&away_player_id&&(APP.findInObjArray("player_guid",homeTeam.players,home_player_id)[0]?APP.header.handleOpponentChange("op-button-left-P"+home_player_id):errorSelectingPlayer=!0,APP.findInObjArray("player_guid",awayTeam.players,away_player_id)[0]?APP.header.handleOpponentChange("op-button-right-P"+away_player_id):errorSelectingPlayer=!0)}catch(e){errorSelectingPlayer=!0}return!errorSelectingPlayer||(APP.header.home_away_selected=!1,APP.device.hideSpinnerOverlay(),!1)},autoSelectTieBreakPlayers:function(){APP.header.startOpponentChange(!0,!0);var home_id=APP.header.roster_left.team.obj_id,away_id=APP.header.roster_right.team.obj_id;APP.header.home_away_selected=!0;var errorSelectingPlayer=!1;try{var homeTeam=APP.findInObjArray("obj_id",APP.header.teams,home_id)[0],awayTeam=APP.findInObjArray("obj_id",APP.header.teams,away_id)[0],homeId=(APP.getMatch().sets.length,APP.starpubs.data.tiebreak.home.player[0]),awayId=APP.starpubs.data.tiebreak.away.player[0],home_player_id=homeId,away_player_id=awayId;home_player_id&&away_player_id&&(APP.findInObjArray("player_guid",homeTeam.players,home_player_id)[0]?APP.header.handleOpponentChange("op-button-left-P"+home_player_id):errorSelectingPlayer=!0,APP.findInObjArray("player_guid",awayTeam.players,away_player_id)[0]?APP.header.handleOpponentChange("op-button-right-P"+away_player_id):errorSelectingPlayer=!0)}catch(e){errorSelectingPlayer=!0}return!errorSelectingPlayer||(APP.header.home_away_selected=!1,APP.device.hideSpinnerOverlay(),!1)},setInitialStarter:function(){if(!this.starterSet){var starter=-1;-1!=(starter=APP.getMatch().sets.length%2==0?1:0)&&(this.starterSet=!0,APP.game.setBullShootWinner(starter,!1))}},setLegsRace:function(){var mf=APP.getMatch().format;if(mf&&mf.legs&&mf.legs.limit){var legsMode=mf.legs.mode,legsRace=mf.legs.limit,playAll="";"PLAY-ALL"==legsMode&&(playAll="-pa-"),APP.header.handleSetSetup("pssm-set-"+playAll+legsRace),APP.header.handleSetSetup("pssm-continue"),this.log("Legs race set ("+legsRace+")")}},enterLeague:function(){APP.session.handleLeagueMenu("plm-ula-meshinteroffice-18418-REG"),APP.nlf.pages.matchSelect.matchClick("nlf-match-802418")},init:function(){this.isStarPubsAccount()&&(this.checkIntro(),this.injectHomeButton())}};var starpubsFlow={name:"starpubs",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{page1:{hideHeader:!0,content:function(){return'\n\t\t\t\t\t<div id=\'star-pubs-intro\'>\n\t\t\t\t\t\t<svg class="svg-icon mLgBottom mLgTop" viewBox="0 0 40 25" style="height: 5em; width: 10em;">\n\t\t\t\t\t\t\t<use xlink:href="#icon-dc"></use>\n\t\t\t\t\t\t</svg> \n\n\t\t\t\t\t\t<div class="">\n\t\t\t\t\t\t\t<h4 class="text-gold mLgTop bold">Welcome to the Darts Stars UK Pub Championship!</h4>\n\t\t\t\t\t\t\t\x3c!--<p class="mSmTop">\n\t\t\t\t\t\t\t\tLorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ac venenatis arcu, eget varius nunc.\n\t\t\t\t\t\t\t</p>--\x3e\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class="button button-lg button-info mLgTop" id="sp-intro-start">\n\t\t\t\t\t\t\t<span class="bold">Dart Stars Championship</span><br />\n\t\t\t\t\t\t\t<span style="font-size: 0.67em">Click to Begin</span>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.starpubs;scope.ele.main.find(".popup-title span").html("&nbsp;"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="sp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("sp-intro-exit",(function(){scope.exit()})),APP.fns.activateBtn("sp-intro-start",(function(){scope.displayPage(2)}))}},page2:{hideBackBtn:!0,hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id=\'star-pubs-selection\'>\n\t\t\t\t\t\t<div class="mLgTop">\n\t\t\t\t\t\t\t<h4 class="text-gold mLgTop bold">\n\t\t\t\t\t\t\t\tHow are you using this device?\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t<div class="pSmTop">\n\t\t\t\t\t\t\t\t<h4 class="mlgTop" style="font-weight: normal;">\n\t\t\t\t\t\t\t\t\tDevice 1: Scorekeeping\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div id="sp-opt-league" class="button button-lg button-green round-corners">\n\t\t\t\t\t\t\t\t\tStart a Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="videoconnect-option">\n\t\t\t\t\t\t\t\t<h4 class="mlgTop" style="font-weight: normal;">\n\t\t\t\t\t\t\t\t\tDevice 2: Video Streaming\n\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t<div id="sp-opt-vc" class="button button-lg button-green round-corners">\n\t\t\t\t\t\t\t\t\tOpen VideoConnect\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t'},init:function(scope){APP.starpubs;scope.ele.main.find(".popup-title span").html("Welcome Players!"),scope.ele.main.find(".popup-title").addClass("no-bg"),scope.ele.main.addClass("primary-grad-dark");scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red round-corners" id="sp-intro-exit">\n\t\t\t\t\t\tMain Menu\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("sp-intro-exit",(function(){scope.exit()})),APP.fns.activateBtn("sp-opt-league",(function(){APP.session.handleLeagueMenu(APP.starpubs.leagueBtnId),scope.exit()})),window.self!==window.top&&$(".videoconnect-option").hide(),APP.fns.activateBtn("sp-opt-vc",(function(){APP.handleOnlineSelector("pos-vc-only"),scope.exit()})),APP.fns.activateBtn("sp-opt-both",(function(){APP.handleOnlineSelector("pos-dc-vc"),scope.exit()}))}}}},selectPlayersFlow={name:"selectPlayers",pageNo:1,debugMode:!1,callbacks:{preInit:function(){},postInit:function(){},pageChange:function(scope){},exit:function(){}},pages:{page1:{hideBackBtn:!0,content:function(){return`\n\t\t\t\t\t<div id="star-pubs-select-players">\n\t\t\t\t\t\t<h4 class="noMargin text-gold">Select ${APP.starpubs.isSelectingTiebreaker?"Player":"4 Players"}</h4>\n\t\t\t\t\t\t<div id="star-pubs-player-list">\n\t\t\t\t\t\t\tLoading&hellip;\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`},init:function(scope){APP.starpubs.isAway(),APP.starpubs;APP.starpubs.isSelectingTiebreaker?scope.ele.main.find(".popup-title span").text("Select Tiebreaker Player"):scope.ele.main.find(".popup-title span").text("Select Player Order");scope.ele.footerContent.empty().append('\n\t\t\t\t\t<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div class="button button-md button-red" id="sp-select-exit">\n\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div class="button-green button-md button button-disabled" id="sp-confirm-lineup">\n\t\t\t\t\t\t\t\t\t\tConfirm\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t'),APP.fns.activateBtn("sp-select-exit",(function(){scope.exit()})),APP.fns.activateBtn("sp-confirm-lineup",(function(){APP.starpubs.saveLineUp()})),window.setTimeout((function(){APP.starpubs.buildPlayerList()}),100)}},page2:{hideBackBtn:!0,hideExitBtn:!0,content:function(){return'\n\t\t\t\t\t<div id="starpub-main">\n\t\t\t\t\t\t<div id="magiconnect-info" class="highlight-box primary-grad button">\n\t\t\t\t\t\t\t<h4 class="noMargin">Waiting for your opponent\'s Lineup</h4>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\t\tIf your opponent is having trouble connecting, you can manually select players for each match.\n\t\t\t\t\t\t</p>\n\n\t\t\t\t\t\t<table width="100%" class="mLgTop">\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<img src="/images/icon-app-connected.png" alt="DartConnect" style="width: 50%;" />\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td style="vertical-align: middle;"">\n\t\t\t\t\t\t\t\t\t<div class="lds-facebook"><div></div><div></div><div></div></div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<img src="/images/icon-app-not-connected.png" alt="DartConnect" style="width: 50%;" />\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t'},getHeader:function(){return"Second Pop Over"},addFooter:function(scope){scope.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red" id="sp-cancel-waiting">\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("sp-cancel-waiting",(function(){APP.starpubs.data.guestSelectPlayers=!1,APP.starpubs.save(),APP.starpubs.isSelectingPlayers=!1,$("#popup-notice").removeClass("hide"),APP.starpubs.flow.exit()}))},init:function(scope){this.addFooter(scope),scope.ele.main.find(".popup-title span").text("Waiting")}}}};APP.boards={beta:!1},APP.loginLink={location:null,destination:null,pat:null,init:function(){var pat=BBAT.fetchData("pat");switch(pat&&(this.pat=pat),APP.location){case"live":APP.boards.beta?(this.location="https://previewapp.dartconnect.com",this.destination="https://app.dartconnect.com"):(this.location="https://app.dartconnect.com",this.destination="https://previewapp.dartconnect.com");break;case"test":APP.boards.beta?(this.location="https://testappbeta.dartconnect.red",this.destination="https://testapp.dartconnect.red"):(this.location="https://testapp.dartconnect.red",this.destination="https://testappbeta.dartconnect.red");break;case"train":APP.boards.beta?(this.location="https://train.appbeta.dartconnect.com",this.destination="https://train.app.dartconnect.com"):(this.location="https://train.app.dartconnect.com",this.destination="https://train.appbeta.dartconnect.com")}var host=location.host;"local.dartconnect.com"==(host=host.split(":")[0])&&(this.location="https://local.dartconnect.com",this.destination="https://testappbeta.dartconnect.red")},getToken:function(successCb,errorCb){if(APP.isLocal)successCb({payload:{token:"localtest"}});else try{var url=APP.getApi2Url()+"personal-access-token",data={member_id:APP.user.member_id};successCb||(successCb=function(data){}),errorCb||(errorCb=function(data){}),APP.fns.doCall(url,data,"POST",successCb,errorCb)}catch(e){APP.fns.newLoader.hide()}},injectImage:function(url,successCb,errorCb){var img=new Image;img.onload=successCb,img.onerror=errorCb,img.attributes.id="login-link-check",img.src=url+"#"+(new Date).getTime()},checkSiteAvailable:function(successCb,errorCb){if(APP.isLocal)successCb();else{var url=this.destination;url+="/images/favicon.ico",successCb||(successCb=function(){}),errorCb||(errorCb=function(){});this.injectImage(url,(function(){var img=document.getElementById("login-link-check");img&&img.remove(),successCb()}),(function(){var img=document.getElementById("login-link-check");img&&img.remove(),errorCb()}))}},switchApp:function(){var options=!1;if(this.destination.indexOf("beta")>-1&&(options={message:"Loading DartConnect Preview",waitMessage:"\n\t\t\t\t\tThis exciting feature allows DartConnect to roll out new Scoring App features more quickly.<br /><br />\n\t\t\t\t\tYou can contribute by exploring these features and providing valuable feedback to the DC Team.<br /><br />\n\t\t\t\t\tThank you for your support!\n\t\t\t\t"}),APP.fns.newLoader.show(options),this.pat)this.checkSiteAvailable(this.switchAppSuccess,this.failSwitch);else{this.getToken((function(data){data&&data.payload&&data.payload.token?(APP.loginLink.pat=data.payload.token,APP.loginLink.switchApp()):APP.loginLink.failSwitch()}),this.failSwitch)}},patLogin:function(token,memberId){var deviceToken=APP.device.token;deviceToken||localStorage.device_token&&(deviceToken=JSON.parse(localStorage.device_token)),deviceToken?(APP.server.init(),APP.device.spinner||(APP.device.spinner=new Spinner({color:"#fff",length:30,radius:30,width:12})),APP.server.squeue.enQueue({type:"REGISTER",caller:"loginMember",url:"/memberLogin",spinner:"70%",show_network_message:!0,data:{device_token:deviceToken,device_time:new Date,device_timezone:APP.device.timezone,token:token,member_id:memberId},on_success:function(in_data){APP.fns.newLoader.hide(),"OK"==in_data.status?APP.loginLink.patLoginSuccess(in_data):APP.loginLink.patLoginError("BAD_INPUT")},on_error:function(in_a,in_b,in_c){return APP.fns.newLoader.hide(),APP.loginLink.patLoginError("BAD_CONNECTION"),!1}})):APP.fns.newLoader.hide()},createClickThroughLink:function(url){if(url&&"string"==typeof url){var linkElement=document.createElement("a");linkElement.setAttribute("href",url),linkElement.setAttribute("target","_blank"),linkElement.setAttribute("rel","noopener noreferrer"),linkElement.textContent="Tap here to open the app",linkElement.style.position="absolute",linkElement.style.left="50%",linkElement.style.top="50%",linkElement.style.transform="translate(-50%, -50%)",linkElement.style.fontSize="2em",linkElement.style.zIndex=1e3,linkElement.classList.add("button","button-menu","button-green","round-corners"),document.body.appendChild(linkElement),linkElement.addEventListener("click",(function(){setTimeout((function(){document.body.removeChild(linkElement),APP.fns.newLoader.hide(),$("#newLoader-scroll-box").show()}),1e3)}))}else console.error("Invalid URL provided")},patLoginSuccess:function(in_data){var login=in_data.payload.handle;APP.user={},APP.user.login=login,APP.user.last_name=in_data.payload.last_name,APP.user.first_name=in_data.payload.first_name,APP.user.home_alley_id=in_data.payload.home_alley_id,APP.user.member_id=in_data.payload.member_id,APP.user.member_level=in_data.payload.member_level,APP.user.token=in_data.payload.user_token,APP.user.token_expire_date=new Date(in_data.payload.token_expire_date).valueOf(),APP.user.subscription_payment_method_is_valid=in_data.payload.subscription_payment_method_is_valid,APP.user.subscription_status=in_data.payload.subscription_status,APP.user.seba=login.search(/^EV\d{1,}$/i)>=0,APP.user.chx=login.search(/^CH\d{1,}$/i)>=0,APP.user.tx=login.search(/^T\d{1,}$/i)>=0,APP.user.pa="Y"==in_data.payload.proxy_account,APP.user.hash=APP.user.tx?APP.cheapHash(pwd):null,APP.user.pt=in_data.payload.proxy_type,BBAT.storeData({user:APP.user}),APP.header.forceRestoreProfile(),APP.popup.hide("popup-login"),APP.continueInit()},patLoginError:function(in_why){APP.user=null,BBAT.flushData("user"),APP.loginMember(in_why)},switchAppSuccess:function(resp){var host=location.host;"local.dartconnect.com"==(host=host.split(":")[0])&&(APP.loginLink.destination="http://local.dartconnect.com:3000");var urlEnd="?t="+APP.loginLink.pat;if(urlEnd+="&mId="+APP.user.member_id,APP.loadCheck.isWebApp())return APP.fns.newLoader.show({message:"",waitMessage:"",dcLogo:!1}),APP.loginLink.createClickThroughLink(APP.loginLink.destination+"/installer.html"+urlEnd),void $("#newLoader-scroll-box").hide();APP.fns.newLoader.hide(),location.href=APP.loginLink.destination+"/installer.html"+urlEnd},failSwitch:function(){APP.fns.newLoader.hide(),APP.alert.show("We were unable to switch to the other app. Please try again later.")},tryPatLogin:function(token,memberId){APP.fns.newLoader.show(),BBAT.flushData("loginLink");try{var user=BBAT.fetchData("user");if(user&&user.member_id)return void APP.fns.newLoader.hide()}catch(e){}APP.loginLink.patLogin(token,memberId)}};var UIFlow=function(vars){var _this=this;this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="UIFlow: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars?(this.vars=vars,function(){var vars=_this.vars;if(!vars.name)return void _this.log("required variable name not sent to class",!0);vars.ele={main:"popup-"+vars.name,content:vars.name+"-content",scrollBox:vars.name+"-scroll-box",exitBtn:vars.name+"-btn-close",backBtn:vars.name+"-btn-back",header:vars.name+"-header",footer:vars.name+"-footer",footerContent:vars.name+"-footer-content"};var ele=vars.ele;if(!(ele.main&&ele.content&&ele.exitBtn&&ele.backBtn&&ele.scrollBox))return _this.log("required eles not sent to class",!0),!1;return!0}()&&(this.name=vars.name,this.data={pageNo:1},vars.pageNo&&(this.data.pageNo=vars.pageNo),"boolean"==typeof this.vars.debugMode&&(this.debugMode=vars.debugMode),$("#popup-"+_this.name).length||function(){var content=`\n\t\t\t<div id="popup-${_this.name}" class="ui-flow">\n\t\t\t\t<div id="${_this.name}-header" class="popup-title">\n\t\t\t\t\t<img id="${_this.name}-btn-back" class="button popup-icon-back" src="images/icon_back.png" />\n\t\t\t\t\t<span>${_this.name} Header</span>\n\t\t\t\t\t<img id="${_this.name}-btn-close" class="button popup-icon-close" src="images/icon_close.png" />\n\t\t\t\t</div>\n\t\t\t\t<div id="${_this.name}-scroll-box" class="ui-flow-scroll-box">\n\t\t\t\t\t<div id="${_this.name}-content" class="ui-flow-content">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="${_this.name}-footer" class="ui-flow-footer">\n\t\t\t\t\t<div id="${_this.name}-footer-content" class="ui-flow-footer-content">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;$("#ui-flow").prepend(content)}(),this.ele={},_this.ele.main=$("#"+_this.vars.ele.main),_this.ele.content=$("#"+_this.vars.ele.content),_this.ele.scrollBox=$("#"+_this.vars.ele.scrollBox),_this.ele.exitBtn=$("#"+_this.vars.ele.exitBtn),_this.ele.backBtn=$("#"+_this.vars.ele.backBtn),_this.ele.header=$("#"+_this.vars.ele.header),_this.vars.ele.footer&&(_this.ele.footer=$("#"+_this.vars.ele.footer),_this.ele.footerContent=$("#"+_this.vars.ele.footerContent)),this.pages=vars.pages,this.publicFn=function(){this.log("I can be called from anywhere")},this.popUp={show:function(){_this.ele.main.show(),_this.ele.main.css("position","absolute"),void 0!==_flows&&(_flows.open(_this.ele.main),_flows.addFlow(_this))},hide:function(){_this.ele.main.hide(),_this.ele.main.removeAttr("style"),void 0!==_flows&&_flows.removeFlow(_this.name)}},this.show=function(pageNo){pageNo||(pageNo=1),this.displayPage(pageNo)},this.displayPage=function(pageIdentifier){this.vars.usePageNames?this.data.pageNo=pageIdentifier:this.data.pageNo=pageIdentifier||1,this.save(this.data.pageNo),this.ele.footerContent&&this.ele.footerContent.empty(),this.showContent()},this.showContent=function(){this.log("Showing content"),this.ele.main.is(":visible")||this.popUp.show(),this.loadContent(),this.exitBtnOn(),this.backBtnOn(),this.fixScroll()},this.loadContent=function(){var content,page;this.log("Loading content for "+this.data.pageNo);var contentDiv=this.ele.content;if(this.vars.usePageNames)page=this.pages[this.data.pageNo];else{var pageName="page"+this.data.pageNo;page=this.pages[pageName]}if(!page)if(this.log("Content doesn't exist",!0),this.vars.pageNo)if(this.vars.usePageNames)page=this.pages[this.vars.pageNo];else{pageName="page"+this.vars.pageNo;page=this.pages[pageName]}else page=this.pages.page1;content=page.content,"function"==typeof page.content&&(content=page.content()),contentDiv.empty().append(content),page.hideFooter?this.ele.footer.hide():this.ele.footer.show(),page.hideHeader?this.ele.header.hide():this.ele.header.show(),page.hideBackBtn?this.ele.backBtn.hide():this.ele.backBtn&&(this.ele.backBtn.show(),this.goBackFn=function(){this.log("Back Btn Fn Not Set",!0)}),page.hideExitBtn?this.ele.exitBtn.hide():this.ele.exitBtn.show(),page.scrollClass?this.ele.scrollBox.addClass(page.scrollClass):this.ele.scrollBox.attr("class","ui-flow-scroll-box"),page.init(this),this.callbacks("pageChange")},this.exitBtnOn=function(){APP.fns.activateBtn([this.vars.ele.exitBtn],(function(){_this.exit()}))},this.backBtnOn=function(){this.vars.ele.backBtn&&APP.fns.activateBtn([this.vars.ele.backBtn],(function(){_this.goBackFn()}))},this.fixScroll=function(){var scrollBox=this.ele.scrollBox,main=this.ele.main,footer=this.ele.footer,content=this.ele.content,header=this.ele.header,footerHeight=0;footer.is(":visible")&&(footerHeight=footer.outerHeight(!0));var headerHeight=0;header.is(":visible")&&(headerHeight=header.outerHeight(!0));var scrollPad=Math.ceil(parseFloat(scrollBox.css("padding-top")))+Math.ceil(parseFloat(scrollBox.css("padding-bottom"))),sbh=main.outerHeight(!0)-(headerHeight+scrollPad);sbh-=footerHeight,scrollBox.css("max-height",sbh),scrollBox.css("min-height",sbh),content.css("min-height",sbh);scrollBox.off("touchstart touchend touchmove"),scrollBox.on("touchstart touchend touchmove",(function(e){var sb=scrollBox,l=content,viewport=Math.floor(sb.height()),scroll_max=Math.ceil(l.height())+Math.ceil(parseFloat(l.css("margin-top")))+Math.ceil(parseFloat(l.css("margin-bottom")))-viewport,scroll_current=sb.scrollTop();if(scroll_max<=0)return BBAT.killDOMEvent(e);switch(e.type){case"touchstart":APP.device.touch_y=e.originalEvent.targetTouches[0].pageY;break;case"touchend":APP.device.touch_y=null;break;case"touchmove":if(e.originalEvent.targetTouches[0].pageY-APP.device.touch_y>0){if(0==scroll_current)return BBAT.killDOMEvent(e)}else if(scroll_current>=scroll_max)return BBAT.killDOMEvent(e);APP.device.touch_y=e.originalEvent.targetTouches[0].pageY}return e.stopPropagation(),!0})),scrollBox.scrollTop(0)},this.exit=function(){this.log("User is exiting"),this.popUp.hide(),this.ele.main.remove(),this.callbacks("exit"),this.reset()},this.reset=function(){this.log("resetting data"),this.data.pageNo=0,this.save()},this.save=function(pageNo){_this.data.pageNo=pageNo},this.clear=function(){this.reset()},this.goBackFn=function(){this.log("Back Btn Fn Not Set",!0)},_this.log("Initing"),_this.callbacks("preInit"),_this.show(_this.data.pageNo),_this.callbacks("postInit"))):this.log("vars not sent to class")},SpiceSelector=function(vars){var _this=this;if(this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="SpiceSelector: ";message+=msg,console.log(message)}},this.callbacks=function(cycle,data){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this,data),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars){if(this.vars=vars,this.maxSpices=1,this.minSpices=1,this.highlightClass="button-green",this.defaultClass="button-white",function(){var vars=_this.vars;if(!vars.id)return _this.log("required variable id not sent to class",!0),!1;if(!vars.ele)return _this.log("required variable ele not sent to class",!0),!1;try{_this.ele=$(vars.ele)}catch(e){return _this.log("ele "+vars.ele+" not recognised",!0),!1}if(!_this.ele.length)return _this.log("ele "+vars.ele+" not available",!0),!1;if(!vars.spices)return _this.log("required variable spices not sent to class",!0),!1;for(var error=!1,i=0;i<vars.spices.length;i++){var spice=vars.spices[i];if(!spice.name||!spice.content){if(spice.isLabel)continue;error=!0}}if(error)return _this.log("please check variable spices",!0),!1;vars.highlightClass&&(_this.highlightClass=vars.highlightClass);vars.defaultClass&&(_this.defaultClass=vars.defaultClass);vars.preSelected&&(_this.selectionArr=vars.preSelected);vars.min&&(_this.minSpices=vars.min);vars.max&&(_this.maxSpices=vars.max);if(!_this.maxSpices||!_this.minSpices)return _this.log("check min/max values",!0),!1;if(!_this.maxSpices||!_this.minSpices)return _this.log("check min/max values",!0),!1;if("number"!=typeof _this.maxSpices||"number"!=typeof _this.minSpices)return _this.log("check min/max values - must be number",!0),!1;if(_this.maxSpices<=0||_this.minSpices<=0)return _this.log("check min/max values - must be positive number",!0),!1;if(_this.maxSpices<_this.minSpices)return _this.log("check min/max values - max must be >= min",!0),!1;return!0}()){var idArr=[];this.selectionArr=[],this.isValid=function(){var qty=_this.selectionArr.length;return qty>=_this.minSpices&&qty<=_this.maxSpices},this.forceUpdate=function(){render()},this.returnSelected=function(){for(var arr=[],i=0;i<_this.selectionArr.length;i++){var id=_this.selectionArr[i],spice=APP.findInObjArray("eleId",_this.vars.spices,id)[0];arr.push(spice)}return arr},_this.log("Initing"),_this.callbacks("preInit"),_this.vars.preSelected&&(_this.selectionArr=_this.vars.preSelected),render(),_this.callbacks("postInit")}}else this.log("vars not sent to class");function selectSpice(id){var selectedSpice=id,deselect=!1;if(-1!==_this.selectionArr.indexOf(selectedSpice)&&(deselect=!0),deselect||function(){if(1==_this.maxSpices&&1==_this.minSpices){if(!_this.selectionArr.length)return!0;for(var i=0;i<_this.vars.spices.length;i++){var eleId=_this.vars.spices[i].eleId;$("#"+eleId).removeClass(_this.highlightClass).addClass(_this.defaultClass),_this.callbacks("deselected",eleId)}return _this.selectionArr=[],!0}if(_this.selectionArr.length>=_this.maxSpices)return!1;return!0}()){var inClass=_this.highlightClass,outClass=_this.defaultClass;deselect&&(outClass=_this.highlightClass,inClass=_this.defaultClass),$("#"+id).removeClass(outClass).addClass(inClass);var arrPos=_this.selectionArr.indexOf(selectedSpice);if(-1!==arrPos)return _this.selectionArr.splice(arrPos,1),function(selectedSpice){_this.callbacks("deselected",selectedSpice)}(selectedSpice),void(_this.isValid()?_this.callbacks("complete"):_this.callbacks("incomplete"));_this.selectionArr.push(selectedSpice),function(selectedSpice){_this.callbacks("selected",selectedSpice)}(selectedSpice),_this.isValid()?_this.callbacks("complete"):_this.callbacks("incomplete")}else _this.callbacks("maxReached",selectedSpice)}function render(){var content=function(){for(var content="",i=0;i<vars.spices.length;i++){var spice=vars.spices[i],eleId="ss_"+vars.id+"_"+spice.name;spice.eleId=eleId,idArr.push(eleId);var dataAttr="";if(spice.attr){for(var j=0;j<spice.attr.length;j++){var attr=spice.attr[j];for(var key in attr)dataAttr+=key+'="'+attr[key]+'" ';dataAttr+=" "}dataAttr=dataAttr.trim()}spice.isLabel?content+=`\n\t\t\t\t\t<div class="label ${spice.class?spice.class:""}">${spice.content}</div>\n\t\t\t\t`:content+=`\n\t\t\t\t<div \n\t\t\t\t\tid="${eleId}"\n\t\t\t\t\tclass="button ${spice.class?spice.class:""} ${spice.fauxDisabled?"button-faux-disabled":""}"\n\t\t\t\t\t${dataAttr}\n\t\t\t\t>\n\t\t\t\t\t${spice.content?spice.content:""}\n\t\t\t\t</div>\n\t\t\t`}return content}();_this.ele.empty().html(content),function(){for(var i=0;i<idArr.length;i++){var eleId=idArr[i];function selectCallback(id){var spice=APP.findInObjArray("eleId",_this.vars.spices,id)[0];spice.fauxDisabled?_this.callbacks("disabled",spice):selectSpice(id)}APP.fns.activateBtn(eleId,selectCallback)}}(),function(){for(var i=0;i<_this.selectionArr.length;i++){var spiceId=_this.selectionArr[i],inClass=_this.highlightClass,outClass=_this.defaultClass;$("#"+spiceId).removeClass(outClass).addClass(inClass)}}()}},_radioId=0,RadioList=function(vars){var _this=this;if(this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="RadioList: ";message+=msg,console.log(message)}},this.callbacks=function(cycle,data){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this,data),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars){if(this.vars=vars,this.highlightClass="on",this.defaultClass="",this.isList=!1,this.activeName=!1,function(){var vars=_this.vars;if(!vars.ele)return _this.log("required variable ele not sent to class",!0),!1;try{_this.ele=$(vars.ele)}catch(e){return _this.log("ele "+vars.ele+" not recognised",!0),!1}if(!_this.ele.length)return _this.log("ele "+vars.ele+" not available",!0),!1;if(!vars.opts)return _this.log("required variable opts not sent to class",!0),!1;for(var error=!1,activeCount=0,i=0;i<vars.opts.length;i++){var opt=vars.opts[i];opt.name&&opt.content||(error=!0),opt.active&&(activeCount++,_this.activeName=opt.name)}if(error)return _this.log("please check variable opt",!0),!1;if(activeCount>1)return _this.log("please check variable opt - only one can be active",!0),!1;vars.opts.length>1&&(_this.isList=!0);vars.highlightClass&&(_this.highlightClass=vars.highlightClass);vars.defaultClass&&(_this.defaultClass=vars.defaultClass);return!0}()){var idArr=[];this.forceUpdate=function(){render()},this.isValid=function(){var qty=_this.selectionArr.length;return qty>=_this.minSpices&&qty<=_this.maxSpices},this.returnSelected=function(){return _this.activeName},this.toggle=function(selectedName){Array.isArray(selectedName)||(selectedName=[selectedName]);for(var i=0;i<selectedName.length;i++){var ele=APP.findInObjArray("name",_this.vars.opts,selectedName[i])[0];ele&&selectOpt(ele.eleId)}},_this.log("Initing"),_this.callbacks("preInit"),render(),_this.callbacks("postInit"),_radioId++}}else this.log("vars not sent to class");function selectOpt(id){for(var selectedName="",idParts=id.split("_"),i=2;i<idParts.length;i++)selectedName+=idParts[i],selectedName+="_";var deselect=!1;(selectedName=selectedName.slice(0,-1))===_this.activeName&&(deselect=!0);var selectedOpt,inClass=_this.highlightClass,outClass=_this.defaultClass?_this.defaultClass:"";if(deselect&&(outClass=_this.highlightClass,inClass=_this.defaultClass?_this.defaultClass:""),_this.isList&&$(_this.ele).find(".on").removeClass("on"),$("#"+id).removeClass(outClass).addClass(inClass),deselect)return selectedOpt=selectedName,_this.callbacks("deselected",selectedOpt),void(_this.activeName=!1);_this.activeName=selectedName,function(selectedOpt){_this.callbacks("selected",selectedOpt)}(selectedName)}function render(){var content=function(){var content="",classList="";_this.vars.class&&(classList=_this.vars.class),_this.isList&&(content+='<div class="list-opt '+classList+'">');for(var i=0;i<vars.opts.length;i++){var opt=vars.opts[i],eleId="radio_"+_radioId+"_"+opt.name;opt.eleId=eleId,idArr.push(eleId),_this.activeName&&_this.activeName==opt.name&&(opt.class||(opt.class=""),opt.class+=" on"),content+=`\n\t\t\t\t<div id="${eleId}" class="radio-opt button ${opt.class?opt.class:""}">\n\t\t\t\t\t${opt.content?opt.content:""}\n\t\t\t\t</div>\n\t\t\t`}return _this.isList&&(content+="</div>"),content}();_this.ele.empty().html(content),function(){for(var i=0;i<idArr.length;i++){var eleId=idArr[i];function selectCallback(id){APP.findInObjArray("eleId",_this.vars.opts,id)[0];selectOpt(id)}APP.fns.activateBtn(eleId,selectCallback)}}()}},Alphabest=function(vars){var _this=this;function selectAlpha(id){try{for(var selectedOpt,i=0;i<_this.filterLettersArr.length;i++){var opt=_this.filterLettersArr[i];opt.id==id?selectedOpt=opt:opt.ele.removeClass("selected")}selectedOpt&&(_this.selectedAlpha!==id?(_this.selectedAlpha=id,selectedOpt.ele.addClass("selected"),_this.callbacks("selected")):(_this.selectedAlpha=null,selectedOpt.ele.removeClass("selected"))),function doFilter(){var filter=_this.selectedAlpha;if(filter){var letter=filter.split("-")[filter.split("-").length-1];if(letter)for(i=0;i<_this.filterArr.length;i++){(filterObj=_this.filterArr[i]).ele.hide(),filterObj.letter==letter&&filterObj.ele.show()}else _this.selectedAlpha=null,doFilter(),_this.log("Selected filter has no letter! "+filter,!0)}else for(var i=0;i<_this.filterArr.length;i++){var filterObj;(filterObj=_this.filterArr[i]).ele.show()}}()}catch(e){}}this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="Alphabest: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},this.filterArr=[],vars?(this.vars=vars,function(){var vars=_this.vars;if(!vars.id)return void _this.log("required variable id not sent to class",!0);if(!vars.targetEle)return void _this.log("required variable ele not sent to class",!0);try{_this.targetEle=$(vars.targetEle)}catch(e){return void _this.log("ele "+vars.targetEle+" not recognised",!0)}if(!_this.targetEle.length)return void _this.log("ele "+vars.targetEle+" not available",!0);for(var targetChildren=_this.targetEle.children(),i=0;i<targetChildren.length;i++){var target=targetChildren[i];if(target){var myTarget=$(target),letter=myTarget.attr("data-alpha");letter&&_this.filterArr.push({ele:myTarget,letter:letter.toLowerCase()})}}if(!_this.filterArr.length)return void _this.log("no targetChildren available - did you add data-alpha?",!0);return!0}()&&(this.selectedAlpha=null,this.idArr=null,this.filterLettersArr=[],this.isActive=function(){return!!_this.selectedAlpha&&_this.selectedAlpha},function(){_this.log("Initing"),_this.callbacks("preInit");var content=function(){var idArr=[],alphabets=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],content='<div class="alphabest">';content+=vars.title?'<div class="title">'+vars.title+"</div>":"";for(var i=0;i<alphabets.length;i++){var letter=alphabets[i];content+=`\n\t\t\t\t<div id="${vars.id}-${letter}" class="button">${letter.toUpperCase()}</div>\n\t\t\t`,idArr.push(vars.id+"-"+letter)}return content+="</div>",_this.idArr=idArr,content}();_this.targetEle.prepend(content),function(){for(var i=0;i<_this.idArr.length;i++){var id=_this.idArr[i];_this.filterLettersArr.push({ele:$("#"+id),id:id})}}(),function(){for(var i=0;i<_this.idArr.length;i++){var eleId=_this.idArr[i];function selectCallback(id){selectAlpha(id)}APP.fns.activateBtn(eleId,selectCallback)}}(),_this.callbacks("postInit")}())):this.log("vars not sent to class")},NSync=function(vars){var _this=this;this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="NSync: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error: "+(e&&e.message?e.message:"unknown"))}else this.log("No callbacks found")},vars?(this.vars=vars,function(){var vars=_this.vars;if(!vars.name)return _this.log("required variable name not sent to class",!0),!1;if(!vars.offline){if(!vars.getUrl)return _this.log("required variable getUrl not sent to class",!0),!1;if(!vars.postUrl)return _this.log("required variable postUrl not sent to class",!0),!1}return!0}()&&(this.name=vars.name,this.data=null,this.syncNeeded=!1,this.offline=vars.offline||!1,this.getUrl=vars.getUrl,this.postUrl=vars.postUrl,this.pauseSyncing=!1,this.validateFn=function(){return!0},vars.validateFn&&(this.validateFn=vars.validateFn),this.defaultData=null,vars.defaultData&&(this.defaultData=vars.defaultData,this.data||(this.data=this.defaultData)),this.local={getData:function(){_this.callbacks("preLocalGet");var data=localStorage.getItem("nsync-"+_this.name);if(null!==data){try{data=JSON.parse(data)}catch(e){}_this.data=data}var sync=localStorage.getItem("nsync-"+_this.name+"-sync");if(null!==sync){try{sync=JSON.parse(sync)}catch(e){}sync&&(_this.syncNeeded=!0)}_this.callbacks("postLocalGet")},setData:function(data,noSync){if(_this.callbacks("preLocalSet"),_this.data=data,_this.isJSON(data)){if("[object Object]"===Object.prototype.toString.call(data)){var ts=Date.now();_this.data._ts=ts,data._ts=ts}localStorage.setItem("nsync-"+_this.name,JSON.stringify(data))}else localStorage.setItem("nsync-"+_this.name,String(data));_this.syncNeeded=!noSync,noSync||localStorage.setItem("nsync-"+_this.name+"-sync","true"),_this.callbacks("postLocalSet")}},this.isJSON=function(obj){try{if(null===obj)return!1;var tag=Object.prototype.toString.call(obj);return"[object Object]"===tag||"[object Array]"===tag}catch(e){}return!1},this.platform={updateLocalData:function(data){try{data&&data.data&&(data=data.data)&&data.data&&(data=data.data)}catch(e){}try{if(_this.isJSON(data))for(var key in data)data.hasOwnProperty(key)&&("true"===data[key]?data[key]=!0:"false"===data[key]&&(data[key]=!1))}catch(e){}if(_this.isJSON(data)&&data._ts&&_this.data&&_this.data._ts)return data._ts=parseInt(data._ts,10),_this.data._ts=parseInt(_this.data._ts,10),data._ts>_this.data._ts?(_this.data=data,data=JSON.stringify(data),void localStorage.setItem("nsync-"+_this.name,data)):void _this.log("Data Not Updated - out of date | "+_this.name,!0);_this.data=data,data=JSON.stringify(data),localStorage.setItem("nsync-"+_this.name,data)},getData:function(){if(void 0!==APP&&APP.user_options&&APP.user_options.offline)return _this.log("Cannot get data - device is offline",!0),!1;if(_this.callbacks("prePlatformGet"),_this.pauseSyncing)return _this.log("Syncing is paused, cannot get data",!0),!1;var url=APP.getApi2Url();url+=_this.getUrl,$.ajax({url:url,type:"GET",cache:!1,timeout:15e3,dataType:"json",success:function(data){_this.platform.updateLocalData(data),_this.callbacks("postPlatformGetSuccess")},error:function(e){_this.log("Failed to getData (platform) "+_this.name,!0),_this.callbacks("postPlatformGetError")}})}},this.updateData=function(data){this.validateFn(data)?this.local.setData(data):this.log("Data passed to update data did not pass validation",!0)},this.syncComplete=function(){this.syncNeeded=!1,localStorage.removeItem("nsync-"+this.name+"-sync")},function(){if(-1!==_syncs.findByName(_this.name)){var errMsg="FATAL ERROR: An nSync with the id '"+_this.name+"' is already active";return _this.log(errMsg,!0),!1}_this.log("Initing"),_this.callbacks("preInit"),APP.fns.checkForProxy()&&(_this.log("Proxy detected - disabling syncing"),_this.pauseSyncing=!0),_this.local.getData(),_this.platform.getData(),_syncs.add(_this),_this.callbacks("postInit")}())):this.log("vars not sent to class")},DCConnect=function(vars){var _this=this;this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="DCConnect: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars||(vars={}),this.calls=[],this.active=!1,this.callbackDictionary={1:APP.nlf.log,2:APP.fns.log},this.getCalls=function(){var calls=BBAT.fetchData("dc_connect");calls&&(_this.calls=calls)},this.addCall=function(call){try{var localCalls=_this.calls;if(localCalls||(localCalls=[]),!_this.isJSON(call))return this.log("Call not JSON",!0),!1;var ts=Date.now();if(call._ts=ts,!_this.validateCall(call))return this.log("Call failed validation",!0),!1;var updated=!1,uid=call.uniqueId;if(uid)for(var i=0;i<localCalls.length;i++)if(localCalls[i].uid===uid){if(!(call=_this.shrinkCall(call)))return this.log("Error shrinking call",!0),!1;localCalls[i]=call,updated=!0;break}if(!updated){if(!(call=_this.shrinkCall(call)))return this.log("Error shrinking call",!0),!1;localCalls.push(call)}_this.calls=localCalls,localCalls=JSON.stringify(localCalls),localStorage.setItem("dc_connect",localCalls)}catch(e){this.log("Error adding call",!0),console.log(e)}},this.returnCalls=function(){return this.getCalls(),this.calls},this.store=function(ignoreStatus){var localCalls=JSON.stringify(_this.calls);localStorage.setItem("dc_connect",localCalls),ignoreStatus||(this.active=!1)},this.isJSON=function(obj){try{if("object"!=typeof obj)return!1;var str=JSON.stringify(obj);if("{"==str[0]&&"}"==str[str.length-1])return!0}catch(e){}return!1},this.validateCall=function(call){return call?call.url?call.type?call.data?call.successCb&&!_this.callbackDictionary[call.successCb]?(_this.log("Validate Call: Invalid success callback",!0),!1):!(call.errorCb&&!_this.callbackDictionary[call.errorCb])||(_this.log("Validate Call: Invalid error callback",!0),!1):(_this.log("Validate Call: No data",!0),!1):(_this.log("Validate Call: No type",!0),!1):(_this.log("Validate Call: No url",!0),!1):(_this.log("Validate Call: No call data",!0),!1)},this.shrinkCall=function(call){try{var newCall={};return newCall.url=call.url,newCall.typ=call.type,newCall.dat=call.data,call.overrideUrl&&(newCall.oUL=call.overrideUrl),call.uniqueId&&(newCall.uID=call.uniqueId),call.customHeaders&&(newCall.cHd=call.customHeaders),call.useDefaultHeaders&&(newCall.uDH=call.useDefaultHeaders),call.successCb&&(newCall.sCB=call.successCb),call.errorCb&&(newCall.eCB=call.errorCb),call.removeOnError&&(newCall.rOE=call.removeOnError),call.errorCount&&(newCall.eCo=call.errorCount),newCall}catch(e){return!1}},this.expandCall=function(call){try{var newCall={};return newCall.url=call.url,newCall.type=call.typ,newCall.data=call.dat,call.oUL&&(newCall.overrideUrl=call.oUL),call.uID&&(newCall.uniqueId=call.uID),call.cHd&&(newCall.customHeaders=call.cHd),call.uDH&&(newCall.useDefaultHeaders=call.uDH),call.sCB&&(newCall.successCb=call.sCB),call.eCB&&(newCall.errorCb=call.eCB),call.rOE&&(newCall.removeOnError=call.rOE),call.eCo&&(newCall.errorCount=call.eCo),newCall}catch(e){return!1}},this.run=function(){if(navigator&&0==navigator.onLine)return _this.log("Device is offline"),void setTimeout(_this.run,5e3);if(_this.calls.length&&!_this.active){if(_this.calls.length){_this.active=!0;var call=_this.calls.shift();_this.doCall(call)}}else _this.calls.length||_this.log("No calls found"),_this.active&&_this.log("Already running"),_this.active=!1,setTimeout(_this.run,2e3)},this.doCall=function(call){if(!(call=_this.expandCall(call)))return _this.log("Error expanding call",!0),_this.store(),void setTimeout(_this.run,2e3);if(call.errorCount&&call.errorCount>5)return _this.store(!0),void setTimeout(_this.run,2e3);var url=APP.getApi2Url()+call.url;call.overrideUrl&&(url=call.overrideUrl);var type=call.type,data=call.data,header=!1;call.useDefaultHeaders&&(header={Authorization:"Bearer DacslVVURVO11d5i2ZIQYlfqlR9lrcqgVJWvdV6rLJnNtVpjC1VqpCzvD2xypila"}),call.customHeaders&&(header=call.customHeaders);var successCb=function(){};call.successCb&&(successCb=_this.callbackDictionary[call.successCb]);var errorCb=function(){};call.errorCb&&(errorCb=_this.callbackDictionary[call.errorCb]);var myErrorCb=function(e){if(errorCb&&errorCb(e),call.removeOnError)_this.store(!0),setTimeout(_this.run,2e3);else{if(call.errorCount?call.errorCount++:call.errorCount=1,!(call=_this.shrinkCall(call)))return _this.log("Error shrinking call",!0),!1;_this.calls.push(call),setTimeout(_this.run,2e3)}};APP.fns.doCall(url,data,type,(function(r){"success"===r.status?(_this.log("Call successful",!0),_this.store(),successCb&&successCb(r),setTimeout(_this.run,2e3)):myErrorCb(r)}),myErrorCb,header)},_this.getCalls(),_this.run()},Rails=function(vars){var _this=this;this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="Rails: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars?(this.vars=vars,function(){if(!_this.vars.id)return _this.log("required variable id not sent to class",!0),!1;return!0}()&&(this.parent=this.vars.parent,this.data=this.parent.data,this.playerRails=null,this.matchUpdateTimer=!1,this.isForfeit=!1,this.initialLaunch=!1,this.confPopUpShowing=!1,this.getLeagueData=function(prop){try{return this.data.league[prop]}catch(e){this.log("Rails Format Not Found!",!0)}},this.launchRails=function(){var data=this.data,matchId=data.matchId,match=APP.findInObjArray("league_match_id",data.league.league_schedule,matchId)[0],btnId="plm-ula-"+data.league.league_id+"-"+data.league.league_division_guid+"-"+data.league.season_status;data.railsMatch=match,data.railsReturn={league_btn_id:btnId,league_id:data.league.league_id,match_id:matchId,game_master:null},this.parent.checkForProxy()&&(data.railsReturn.selectedTeamId=this.data.selectedTeamId,data.railsReturn.selectedTeamLabel=this.data.selectedTeamLabel,data.railsReturn.selectedPlayerId=this.data.selectedPlayerId,data.railsReturn.selectedPlayerLabel=this.data.selectedPlayerLabel,data.railsReturn.leagueSchedule=this.data.league.league_schedule),APP.nlf.data.railsFormat||(data.railsFormat=this.getLeagueData("match_settings")),this.parent.save(),"LEGACY"==match.match_format_style?APP.nlf.displayPage(9):APP.nlf.displayPage(5),this.getMatchStatus(),APP.nlf.playerRails.isPlayerRails()&&APP.nlf.playerRails.updateLineUpPlatform()},this.showHiddenSets=!0,this.replayMatch=!1,this.buildMatchScore=function(match,matchScoreObj){var scoreClass="";if(match.status)switch(match.status){case"A":scoreClass="active";break;case"P":scoreClass="pending";break;case"C":scoreClass="closed"}var matchScore="vs";(match.op0_score||match.op1_score)&&(matchScore=match.op0_score+" - "+match.op1_score);try{matchScoreObj&&((matchScoreObj.home.league_points||matchScoreObj.away.league_points)&&(matchScore=matchScoreObj.home.league_points+" - "+matchScoreObj.away.league_points,scoreClass="active"),matchScoreObj.match_complete&&(!0,scoreClass="closed"))}catch(e){}var matchRace="",raceDetails=this.getMatchRace();raceDetails&&(matchRace=`\n\t\t\t\t<br />\n\t\t\t\t<span class="match-race">${raceDetails}</span>\n\t\t\t`);var content=`\n\t\t\t<div id="rails-match-score" class="${scoreClass}">\n\t\t\t\t<table class="nlf-match-table">\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t<tr class="live-match">\n\t\t\t\t\t\t\t<td style="text-align: center" width="40%">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t${match.home_label}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center" width="20%">\n\t\t\t\t\t\t\t\t<span class="live-scores bold" style="color: #fff">\n\t\t\t\t\t\t\t\t\t${matchScore}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t${matchRace}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center" width="40%">\n\t\t\t\t\t\t\t\t<span class="bold">\n\t\t\t\t\t\t\t\t\t${match.away_label}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t`;return this.data.railsPractice?content+='\n\t\t\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t\t\t<div id="rails-wipe-local" class="button-red round-corners button button-md">\n\t\t\t\t\t\t\t\t\tStart Over\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t':content+='\n\t\t\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t\t\t<div id="rails-check-update" class="button-info round-corners button button-md">\n\t\t\t\t\t\t\t\t\tCheck for Updates\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t',content+="\n\t\t\t\t\t</tr>\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t"},this.getMatchRace=function(){try{var raceDetails,startTxt,setCount,myMf=APP.session.getLeagueDefinition(this.data.league).match_settings;if("BEST-OF"==myMf.sets_mode&&(startTxt="First to ",setCount=Math.round(myMf.sets_limit/2),myMf.sets_limit%2==0&&(startTxt="Best of ",setCount=myMf.sets_limit),raceDetails=startTxt+setCount),"PLAY-ALL"==myMf.sets_mode&&myMf.sets_limit&&(raceDetails="Play "+myMf.sets_limit),raceDetails)return raceDetails}catch(e){}return!1},this.buildMatchResults=function(){var homeScore,awayScore,data=this.data,match=data.railsMatch,matchScoreObj=this.calculateMatchScore(),isMatchComplete=!1;(match.op0_score||match.op1_score)&&(homeScore=match.op0_score,awayScore=match.op1_score);try{matchScoreObj&&((matchScoreObj.home.league_points||matchScoreObj.away.league_points)&&(homeScore=matchScoreObj.home.league_points,awayScore=matchScoreObj.away.league_points),matchScoreObj.match_complete&&(isMatchComplete=!0))}catch(e){}(match.op0_league_points||match.op1_league_points)&&(match.op0_league_points,match.op1_league_points);try{matchScoreObj&&(matchScoreObj.home.league_points||matchScoreObj.away.league_points)&&(matchScoreObj.home.league_points,matchScoreObj.away.league_points,!0)}catch(e){}homeScore||(homeScore=0),awayScore||(awayScore=0);var content="";return isMatchComplete?(content+=`\n\t\t\t\t<div id="match-state-info">\n\t\t\t\t\t<h4>Match is Complete</h4>\n\t\t\t\t\t<div class="match-score">\n\t\t\t\t\t\t${homeScore} - ${awayScore}\n\t\t\t\t\t</div>\n\t\t\t`,"SUPPRESS_LEAGUE"==data.league.match_settings.points_style?content+='\n\t\t\t\t\t<div class="highlight-box primary-grad mLgBottom">\n\t\t\t\t\t\t<p>The above score represents the match set score.<br />\n\t\t\t\t\t\tLeague administrators will update the final score for this match</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="bold">This Match is Complete. What would you like to do?</p>\n\t\t\t\t':content+='\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<p class="bold pMdBottom">This Match is Complete. What would you like to do?</p>\n\t\t\t\t',content+=this.buildEOMButtons(!0),content+="</div>"):(content+=`\n\t\t\t\t<div id="match-state-info">\n\t\t\t\t\t<h4>Match NOT complete</h4>\n\t\t\t\t\t<div class="match-score">\n\t\t\t\t\t\t${homeScore} - ${awayScore}\n\t\t\t\t\t</div>\n\t\t\t\t\t<hr />\n\n\t\t\t\t\t<p class="bold pMdBottom">This Match <span class="text-gold">Appears</span> Incomplete</p>\n\t\t\t\t\t\n\t\t\t\t\t<p>If additional league play has occurred \n\t\t\t\t\ton another device, DC will merge the \n\t\t\t\t\tmatch data. Otherwise, you may SUSPEND the \n\t\t\t\t\tmatch to resume it at another time.</p>\n\t\t\t`,content+=this.buildEOMButtons(),content+="</div>"),content},this.buildEOMButtons=function(matchComplete){var isPlayerRails=this.playerRails.isPlayerRails(),isWdfEvent=APP.nlf.rails.checkWdfRules(),isTempTeamEvent=this.isTempTeamTournament(),isRailsPractice=this.data.railsPractice,hasSaveButton=APP.nlf.data.league.app_save_button&&"Y"==APP.nlf.data.league.app_save_button,newMatchBtnText="Play Another League Match",additionalClass="";isWdfEvent&&(newMatchBtnText="Return to Match Listing",additionalClass=" hide "),isTempTeamEvent&&(newMatchBtnText="Return to Home Screen",additionalClass=" hide "),isPlayerRails&&(newMatchBtnText="Select Another Match",additionalClass="");var content="",matchReportBtn=`\n\t\t\t<div class="button button-lg button-gold round-corners ${additionalClass}" \t\t\tid='rails-opt-report'>\n\t\t\t\tShow Match Report\n\t\t\t</div>\n\t\t`,dartyPartyBtn='\n\t\t\t\x3c!--\n\t\t\t<div class="button button-lg button-gray round-corners">\n\t\t\t\tStart a Darty Party\n\t\t\t</div>\n\t\t\t--\x3e\n\t\t',exitBtn=`\n\t\t\t<div class="button button-lg button-red round-corners ${additionalClass}" id='rails-opt-exit'>\n\t\t\t\tReturn to Welcome Screen\n\t\t\t</div>\n\t\t`;return content+=matchComplete?isRailsPractice?`\n\t\t\t\t\t<div class="button-opts">\n\t\t\t\t\t\t${`\n\t\t\t<div class="button button-lg button-gold round-corners ${additionalClass}" id='rails-opt-wipe-practice'>\n\t\t\t\tPlay Practice Match Again\n\t\t\t</div>\n\t\t`}\n\t\t\t\t\t\t${exitBtn}\n\t\t\t\t\t</div>\n\t\t\t\t`:`\n\t\t\t\t\t\t<div class="button-opts">\n\t\t\t\t\t\t\t${matchReportBtn}\n\t\t\t\t\t\t\t\n\t\t\t<div class="button button-lg button-gray round-corners" id='rails-opt-replay'>\n\t\t\t\tReplay/Edit Set(s)\n\t\t\t</div>\n\t\t\n\t\t\t\t\t\t\t${dartyPartyBtn}\n\t\t\t\t\t\t\t${`\n\t\t\t<div class="button button-lg button-green round-corners" id='rails-opt-new'>\n\t\t\t\t${newMatchBtnText}\n\t\t\t</div>\n\t\t`}\n\t\t\t\t\t\t\t${exitBtn}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`:`\n\t\t\t\t<div class="button-opts">\n\t\t\t\t\t${hasSaveButton?"\n\t\t\t<div class=\"button button-lg button-green round-corners\" id='rails-opt-early-save'>\n\t\t\t\tEnd and Save Match\n\t\t\t</div>\n\t\t":""}\n\t\t\t\t\t${matchReportBtn}\n\t\t\t\t\t${`\n\t\t\t<div class="button button-lg button-gray round-corners ${additionalClass}" id='rails-opt-suspend'>\n\t\t\t\tSuspend Match\n\t\t\t</div>\n\t\t`}\n\t\t\t\t\t${dartyPartyBtn}\n\t\t\t\t\t${exitBtn}\n\t\t\t\t</div>\n\t\t\t`},this.openAccordions=[],this.moveCompleteChapters=function(){$(".segment-complete").each((function(){$(".segment-complete").parent().append($(this))})),$(".set-complete").each((function(){$(this).parent().append($(this))})),$(".set-live").each((function(){var e=$(this);e.next()&&e.next().insertBefore(e)}))},this.getSetSegmentArr=function(sets){if(!sets){try{sets=APP.nlf.data.railsFormat.sets}catch(e){}if(!sets)return[]}var segmentArr=[];try{var segmentLabel="All Sets";for(i=0;i<sets.length;i++)set=sets[i],segmentNumber=set.segment_number-1,segmentLabel=set.segment_label,segmentArr[segmentNumber]||(segmentArr[segmentNumber]={segNo:segmentNumber,segLabel:segmentLabel,sets:[]}),segmentArr[segmentNumber].sets.push(set);segmentArr=segmentArr.filter((function(el){return null!=el}))}catch(e){}return segmentArr},this.buildChapterList=function(){var i,j,set,segmentId,segmentNumber,data=this.data,content="",chapterBtnArr=[],format=data.railsFormat,match=data.railsMatch,matchScore=this.calculateMatchScore(),matchTitle=this.buildMatchScore(match,matchScore),accordionArr=[],emptyMatchBtnArr=[],setLineUpBtnArr=[],filters=this.filters.getCurrentFilters(),prTooltipSeen=BBAT.fetchData("pr_tooltip_seen"),isMatchComplete=!1;if(matchScore&&matchScore.match_complete&&(isMatchComplete=!0,!$("#nlf-go-back").length)){APP.nlf.ele.footerContent.empty().append('\n\t\t\t\t\t<div class="button button-md button-red" id="nlf-go-back">\n\t\t\t\t\t\tBack\n\t\t\t\t\t</div>\n\t\t\t\t'),APP.fns.activateBtn("nlf-go-back",APP.nlf.goBackFn)}content+=`\n\t\t\t${matchTitle}\n\t\t`,isMatchComplete&&(content+=`\n\t\t\t\t<div id="rails-match-complete">\n\t\t\t\t\t<h4 class="subheading text-gold">Match Complete</h4>\n\t\t\t\t\t<p>This match appears to be complete. If so, return to the league schedule to play a different one.</p>\n\n\t\t\t\t\t\x3c!--<table class="footer-table" width="100%">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div class="button button-md button-gray" id="rails-show-hidden">\n\t\t\t\t\t\t\t\t\t\tShow Match\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td width="100%">\n\t\t\t\t\t\t\t\t\t<div class="button-green button-md button" id="rails-view-match-report">\n\t\t\t\t\t\t\t\t\t\tView Match Recap\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>--\x3e\n\t\t\t\t</div>\n\n\n\t\t\t\t\x3c!--<div id="rails-hide-sets" class="${this.showHiddenSets?"show":""}">--\x3e\n\t\t\t\t<div id="rails-hide-sets" class="show">\n\t\t\t`);var sets=format.sets;if(!sets)return[content+='\n\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t<h4 class="subheading text-gold">No League Format Found</h4>\n\t\t\t\t\t<br />\n\t\t\t\t\tSeek help with your League Administrator\n\t\t\t\t</div>\n\t\t\t',!1];var segmentArr=[];for(i=0;i<sets.length;i++)set=sets[i],filters&&filters.length&&-1==filters.indexOf(set.set_number)||(segmentArr[segmentNumber=set.segment_number-1]||(segmentArr[segmentNumber]=[]),segmentArr[segmentNumber].push(set));var usingSegments=(segmentArr=segmentArr.filter((function(el){return null!=el}))).length>=1,nextMatchHighlighted=!1,lineUpSegmentData=[];for(this.playerRails.isPlayerRails()&&(lineUpSegmentData=APP.nlf.playerRails.getLineUpSegmentData()),i=0;i<segmentArr.length;i++){var segment=segmentArr[i],segmentComplete=!0;if(!this.tieBreaker.hasTiebreaker||"Y"!=segment[0].tiebreaker||this.tieBreaker.tieBreakerActive){for(j=0;j<segment.length;j++){if(set=segment[j],match.chapter_status)"PLAYED"!==this.getChapterStatus(match.chapter_status,set.set_id)&&(segmentComplete=!1);else segmentComplete=!1}var initialSet=segment[0];segmentId=initialSet.segment_id,segmentNumber=initialSet.segment_number;var segmentLabel=initialSet.segment_label,segmentIcon='<svg class="svg-icon left" viewBox="0 0 25 25">';switch(initialSet.player_format){case"singles":segmentIcon+='<use xlink:href="#icon-user"></use>';break;case"doubles":segmentIcon+='<use xlink:href="#icon-users"></use>';break;case"triples":case"quads":default:segmentIcon+='<use xlink:href="#icon-user-group"></use>'}var segmentHeader=(segmentIcon+="</svg>")+"Section "+segmentNumber;if(segmentLabel&&(segmentHeader=segmentIcon+segmentLabel),usingSegments){if(segmentComplete){var isOpen=!1;-1!==this.openAccordions.indexOf("rails-segment-"+segmentId)&&(isOpen=!0),content+=`\n\t\t\t\t\t\t<div class="accordion segment-accordion segment-container accordion-outline segment-complete ${isOpen?"open":""}">\n\t\t\t\t\t`,accordionArr.push("rails-segment-"+segmentId)}else content+=`\n\t\t\t\t\t\t<div class="segment-container" id="rails-segment-${segmentId}">\n\t\t\t\t\t`;content+=`\n\t\t\t\t\t<div class="header button" id="rails-segment-${segmentId}">\n\t\t\t\t\t\t<h4 class="segment-header">\n\t\t\t\t\t\t\t${segmentHeader}${segmentComplete?"<span class='complete-tag'>Complete</span>":""}\n\t\t\t\t\t\t</h4>\n\t\t\t\t`;var playerLineUpBtns="";if(this.playerRails.isPlayerRails()&&!APP.nlf.rails.allowMidChapterPlayerChanges(set)&&(playerLineUpBtns+=`\n\t\t\t\t\t\t<div class="rails-lineup-btns ${prTooltipSeen?"seen":""}">\n\t\t\t\t\t`,lineUpSegmentData.length&&lineUpSegmentData[i]&&(lineUpSegmentData[i].home||lineUpSegmentData[i].away)&&(playerLineUpBtns+='<div class="group mMdBottom">',lineUpSegmentData[i].home?(playerLineUpBtns+=`\n\t\t\t\t\t\t\t\t\t<div class="rails-lineup-button-wrap float-left">\n\t\t\t\t\t\t\t\t\t\t<div class="button button-md button-auto mBottom button-red round-corners team-lineup-btn"\n\t\t\t\t\t\t\t\t\t\t\tdata-team="home"\n\t\t\t\t\t\t\t\t\t\t\tdata-segment="${segmentId}"\n\t\t\t\t\t\t\t\t\t\t\tid="rails-add-lineup-home-${segmentId}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tAdd <span class="bold">Home</span> Lineup\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class="tooltip tooltip-lineup-home">\n\t\t\t\t\t\t\t\t\t\t\t<div class="triangle-up"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="tooltip-inner">\n\t\t\t\t\t\t\t\t\t\t\t\tSelect to enter<br />\n\t\t\t\t\t\t\t\t\t\t\t\tHome Lineup\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`,setLineUpBtnArr.push("rails-add-lineup-home-"+segmentId)):playerLineUpBtns+='\n\t\t\t\t\t\t\t\t\t<div class="rails-lineup-button-wrap float-left">\n\t\t\t\t\t\t\t\t\t\t<span class="pr-ready-text">\n\t\t\t\t\t\t\t\t\t\t\tHome Ready\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t',lineUpSegmentData[i].away?(playerLineUpBtns+=`\n\t\t\t\t\t\t\t\t\t<div class="rails-lineup-button-wrap float-right">\n\t\t\t\t\t\t\t\t\t\t<div class="tooltip tooltip-lineup-away">\n\t\t\t\t\t\t\t\t\t\t\t<div class="triangle-up"></div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="tooltip-inner">\n\t\t\t\t\t\t\t\t\t\t\t\tSelect to enter<br />\n\t\t\t\t\t\t\t\t\t\t\t\tAway Lineup\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t<div class="button button-md button-auto mBottom button-red round-corners team-lineup-btn"\n\t\t\t\t\t\t\t\t\t\t\tdata-team="away"\n\t\t\t\t\t\t\t\t\t\t\tdata-segment="${segmentId}"\n\t\t\t\t\t\t\t\t\t\t\tid="rails-add-lineup-away-${segmentId}"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tAdd <span class="bold">Away</span> Lineup\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`,setLineUpBtnArr.push("rails-add-lineup-away-"+segmentId)):playerLineUpBtns+='\n\t\t\t\t\t\t\t\t\t<div class="rails-lineup-button-wrap float-right">\n\t\t\t\t\t\t\t\t\t\t<span class="pr-ready-text">\n\t\t\t\t\t\t\t\t\t\t\tAway Ready\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t',playerLineUpBtns+="</div>"),playerLineUpBtns+="</div>"),playerLineUpBtns){var playerLineUpBtnsHtml=APP.stringToHtml(playerLineUpBtns);playerLineUpBtnsHtml.getElementsByClassName("rails-lineup-button-wrap").length||(playerLineUpBtnsHtml.getElementsByClassName("rails-lineup-btns")[0].classList.add("seen"),playerLineUpBtns=APP.htmlToString(playerLineUpBtnsHtml)),content+=playerLineUpBtns}content+="</div>"}content+='\n\t\t\t\t<div class="content">\n\t\t\t';var highlightNextMatch=!1;nextMatchHighlighted||segmentComplete||(highlightNextMatch=!0,nextMatchHighlighted=!0);var segmentBuild=this.buildSetButtons(match,segment,highlightNextMatch);content+=segmentBuild[0],chapterBtnArr=chapterBtnArr.concat(segmentBuild[1]),emptyMatchBtnArr=emptyMatchBtnArr.concat(segmentBuild[3]),segmentBuild[2]&&(accordionArr=accordionArr.concat(segmentBuild[2])),content+="\n\t\t\t\t</div>\n\t\t\t",usingSegments&&(content+="</div>");try{"Y"!=segment[segment.length-1].break_after_segment||segmentComplete||(content+='\n\t\t\t\t\t\t<div class="segment-break-div">\n\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\tScheduled Break\n\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t')}catch(e){}}}return isMatchComplete&&(content+="\n\t\t\t\t</div>\n\t\t\t"),[content,chapterBtnArr,accordionArr,emptyMatchBtnArr,setLineUpBtnArr]},this.buildLegacyMatchWarning=function(){return'\n\t\t\t<div id="rails-match-complete">\n\t\t\t\t<h4 class="subheading text-gold">Match Complete</h4>\n\t\t\t\t<p>If this match requires additional play, use the "Create a Manual Match" option to add league darts to this match.</p>\n\t\t\t\t<p>Important: Mark the hosting team as "Home" NOT "Away".</p>\n\n\t\t\t\t<div \n\t\t\t\t\tclass="button button-gold button-md round-corners"\n\t\t\t\t\tstyle="margin-top: 1em;"\n\t\t\t\t\tid="rails-view-match-report"\n\t\t\t\t>\n\t\t\t\t\tView Match Recap\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t'},this.buildSetButtons=function(match,sets,highlightNextMatch){for(var content="",chapterBtnArr=[],emptyMatchBtnArr=[],deEmphasise=!1,isPlayerRails=this.playerRails.isPlayerRails(),i=0;i<sets.length;i++){var set=sets[i],instructions=this.createRailsInstructions(set),chapterStatus=this.getChapterStatus(match.chapter_status,set.set_id),isSetCompleted="PLAYED"==chapterStatus,isSetLive="LIVE"==chapterStatus;instructions.scorekeeper&&"NONE"!==instructions.scorekeeper&&`\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<span class='bold chalker-text'>${this.transLangFromPlatform(instructions.scorekeeper)}</strong> to Score</span>\n\t\t\t\t\t</p>\n\t\t\t\t`;this.calculateLegInfo(set.legs_mode,set.legs_limit);var isNextMatch=!1,nextMatchClass="next-match",isHighlightedMatch=!1;highlightNextMatch&&(isSetCompleted||isSetLive||(isNextMatch=!0,highlightNextMatch=!1,0==i&&(nextMatchClass="next-match first-match",isHighlightedMatch=!0))),isPlayerRails&&(isNextMatch=!1);var matchId=match.league_match_id;this.data.railsPractice&&(matchId="practice_"+i),content+=`\n\t\t\t\t<div \n\t\t\t\t\tid="rails-chapter-${set.set_id}" \n\t\t\t\t\tclass="\n\t\t\t\t\t\tnlf-rails-match round-corners button \n\t\t\t\t\t\t${isSetCompleted?"set-complete":""} \n\t\t\t\t\t\t${isSetLive?"set-live":""} \n\t\t\t\t\t\t${isNextMatch?nextMatchClass:""}\n\t\t\t\t\t"\n\t\t\t\t\tdata-match-id="${matchId}"\n\t\t\t\t\tdata-home="${match.home_id}"\n\t\t\t\t\tdata-away="${match.away_id}"\n\t\t\t\t\tdata-set-id="${set.set_id}"\n\t\t\t\t>\n\t\t\t\t\t<div class="rails-match-display">\n\t\t\t`;var chapterInfo="";switch(set.first_leg){case"HOME_STARTS":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tHome Starts\n\t\t\t\t\t';break;case"HOME_CORKS":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tHome <span class="notBold">(Throws for Bull)</span>\n\t\t\t\t\t';break;case"HOME_OPTION":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tHome <span class="notBold">(Bull Option)</span>\n\t\t\t\t\t';break;case"AWAY_STARTS":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tAway Starts\n\t\t\t\t\t';break;case"AWAY_CORKS":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tAway <span class="notBold">(Throws for Bull)</span>\n\t\t\t\t\t';break;case"AWAY_OPTION":chapterInfo='\n\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t</svg> \n\t\t\t\t\t\tAway <span class="notBold">(Bull Option)</span>\n\t\t\t\t\t';break;default:if(chapterInfo=`\n\t\t\t\t\t\tCompetition ${set.set_number}\n\t\t\t\t\t`,this.isAlternateSets()&&!this.tieBreaker.tieBreakerActive){if(this.getAlternateSets())chapterInfo=this.getAlternateSetsStarterVal(set.set_number)?'\n\t\t\t\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t\t\t\t</svg> \n\t\t\t\t\t\t\t\t\tAway Starts\n\t\t\t\t\t\t\t\t':'\n\t\t\t\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t\t\t\t</svg> \n\t\t\t\t\t\t\t\t\tHome Starts\n\t\t\t\t\t\t\t\t';else chapterInfo='\n\t\t\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t\t\t</svg> \n\t\t\t\t\t\t\t',chapterInfo+=isHighlightedMatch?"Select Starter":"Alternate";if(this.isAlternateSetsBullDeciding()&&i==sets.length-1){var isDecidingSet=this.isDecidingAlternateSet(i,sets.length);isDecidingSet.isTriggered?chapterInfo='\n\t\t\t\t\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\tSelect Starter\n\t\t\t\t\t\t\t\t\t':isDecidingSet.isActive||(chapterInfo='\n\t\t\t\t\t\t\t\t\t\t\t<svg class="svg-icon left text-danger" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-bullseye"></use>\n\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t<span class="text-gray">Select Starter</span>\n\t\t\t\t\t\t\t\t\t\t')}}}var matchSetUp,player1,player2,matchScore="";if(isSetCompleted){var myScore=this.getChapterScore(match.chapter_status,set.set_id);myScore&&(matchScore+=`\n\t\t\t\t\t\t<span class="live-scores bold">\n\t\t\t\t\t\t\t${myScore}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t`)}if(this.checkWdfRules()){var isPairs=!1;player1="Player ",player2="Player ","pairs"==this.data.league.season_label.toLowerCase()&&(isPairs=!0),isPairs?(matchSetUp=this.wdfRules.getDoublesMatchUp(set.set_number),Array.isArray(matchSetUp)&&(chapterInfo=`\n\t\t\t\t\t\t\t<span class="bold">${player1=`${matchSetUp[0][0]} &amp; ${matchSetUp[0][1]}`}</span> vs. <span class="bold">${player2=`${matchSetUp[1][0]} &amp; ${matchSetUp[1][1]}`}</span>\n\t\t\t\t\t\t`)):(matchSetUp=this.wdfRules.getMatchUp(set.set_number),Array.isArray(matchSetUp)&&(chapterInfo=`\n\t\t\t\t\t\t\t<span class="bold">${player1+=matchSetUp[0]}</span> vs. <span class="bold">${player2+=matchSetUp[1]}</span>\n\t\t\t\t\t\t`))}if(isPlayerRails){var setBtnObj={set:set,startInfo:chapterInfo,setComplete:isSetCompleted,setLive:isSetLive,matchScore:matchScore},playerRailsObj=_this.playerRails.getPlayerRailsObj("","","",set.set_id),isMixedSize=_this.allowMidChapterPlayerChanges(set);if("empty"!=playerRailsObj.home&&"empty"!=playerRailsObj.away||isMixedSize||(deEmphasise=!0),content+=this.railsSetButtons.build(setBtnObj),playerRailsObj.allowShortOptions&&(playerRailsObj.awayAllEmpty||playerRailsObj.homeAllEmpty))if(playerRailsObj.homeAllEmpty&&"empty"==playerRailsObj.away);else if(playerRailsObj.awayAllEmpty&&"empty"==playerRailsObj.home);else if(!isMixedSize&&"team"!==instructions.player_format){emptyMatchBtnArr.push(set.set_id);continue}if(deEmphasise){var tempContent=APP.stringToHtml(content);if(tempContent){var btns=tempContent.getElementsByClassName("nlf-rails-match");if(btns.length)btns[btns.length-1].classList.add("pr-deemphasise");content=APP.htmlToString(tempContent)}}chapterBtnArr.push("rails-chapter-"+set.set_id)}else{var continueBtn="Continue";switch(instructions.scorekeeper){case"HOME":case"AWAY":continueBtn=`\n\t\t\t\t\t\t<span class='bold chalker-text'>${this.transLangFromPlatform(instructions.scorekeeper)}</span> to Score</span>\n\t\t\t\t\t`}var chapterId=set.set_number;isSetCompleted?content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${chapterId}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="chapter-info">\n\t\t\t\t\t\t\t\t<span class="bold">Match Complete</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="chapter-faux-button" width="40%">\n\t\t\t\t\t\t\t\t${matchScore}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`:isSetLive?content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${chapterId}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="chapter-info">\n\t\t\t\t\t\t\t\t<span class="bold">Match is Live</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`:(content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${chapterId}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td class="chapter-info">\n\t\t\t\t\t\t\t\t\t\t\t${chapterInfo}\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t<td class="chapter-faux-button" width="40%">\n\t\t\t\t\t\t\t\t\t\t\t<div class="button button-red round-corners button-md">\n\t\t\t\t\t\t\t\t\t\t\t\t${continueBtn} \n\t\t\t\t\t\t\t\t\t\t\t\t<svg class="svg-icon right" viewBox="0 0 25 25">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<use xlink:href="#icon-right"></use>\n\t\t\t\t\t\t\t\t\t\t\t\t</svg> \n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t`,content+="\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t"),content+="\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t",chapterBtnArr.push("rails-chapter-"+set.set_id)}}return[content,chapterBtnArr,[],emptyMatchBtnArr]},this.buildRailsSetButton=function(set,startInfo,setComplete,setLive,matchScore){var details=[],legsInfo=this.calculateLegInfo(set.legs_mode,set.legs_limit);details.push(legsInfo);var player1,player2,matchSetup=this.playerRails.getMatchUp(set.set_id),playersReady=!1;"ready"==matchSetup.status&&(player1=matchSetup.home.join("<br />"),player2=matchSetup.away.join("<br />"),playersReady=!0);var allowShorts=_this.playerRails.allowShortLineUp(set.set_id),playerRailsObj=_this.playerRails.getPlayerRailsObj("","","",set.set_id),missingTeam=!1;if(!("ready"==playerRailsObj.home&&"ready"==playerRailsObj.away)&&allowShorts)if(playerRailsObj.homeAllEmpty||playerRailsObj.awayAllEmpty)playerRailsObj.homeAllEmpty&&"empty"==playerRailsObj.away||playerRailsObj.awayAllEmpty&&"empty"==playerRailsObj.home||(missingTeam=!0);else if(!("ready"!=playerRailsObj.home&&"short"!=playerRailsObj.home||"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away)){var i,player;for(player1="",player2="",i=0;i<playerRailsObj.homePlayers.length;i++)-1==playerRailsObj.homePlayers[i]?player1+='<span class="bold text-red">No Player</span><br />':(player=playerRailsObj.homePlayers[i],player1+=APP.session.createPlayerName(player,1)+"<br />");for(i=0;i<playerRailsObj.awayPlayers.length;i++)-1==playerRailsObj.awayPlayers[i]?player2+='<span class="bold text-red">No Player</span><br />':(player=playerRailsObj.awayPlayers[i],player2+=APP.session.createPlayerName(player,1)+"<br />");playersReady=!0}var content="",matchStatus="waiting";switch(setLive?matchStatus="live":setComplete&&(matchStatus="complete"),matchStatus){case"waiting":if(content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${set.set_number}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-match-info text-info-dark">\n\t\t\t\t\t\t\t\t\t\t\t\t${details.join(" | ")}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-matchup" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t`,missingTeam){if(!isMixedSize)return content+='\n\t\t\t\t\t\t\t<div class="player-rails-missing-warning">\n\t\t\t\t\t\t\t\tThis Match Cannot Be Started\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t',playerRailsObj.homeAllEmpty&&(content+=`\n\t\t\t\t\t\t\t\t<div class="player-rails-missing-team">\n\t\t\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.home_label}</strong><br />\n\t\t\t\t\t\t\t\t\t<span class="text-danger">Team lineup is missing</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`),playerRailsObj.awayAllEmpty&&(content+=`\n\t\t\t\t\t\t\t\t<div class="player-rails-missing-team">\n\t\t\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.away_label}</strong><br />\n\t\t\t\t\t\t\t\t\t<span class="text-danger">Team lineup is missing</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`),content+=`\n\t\t\t\t\t\t\t<table class="player-rails-faux-button-holder" width="100%">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tid="player-rails-ff-${set.set_id}" \n\t\t\t\t\t\t\t\t\t\t\tclass="button-red button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tForfeit Options\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\t\t\t\tid="player-rails-edit-${set.set_id}" \n\t\t\t\t\t\t\t\t\t\t\tclass="button-gold button-md button-block round-corners button"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tEdit Lineups\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t`,content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-start-instructions">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${startInfo}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t</div></div>\n\t\t\t\t\t\t`;content+='\n\t\t\t\t\t\t\t\t<div class="player-rails-missing-warning">\n\t\t\t\t\t\t\t\t\tMixed Size Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\tsadas\n\t\t\t\t\t\t'}if(!isMixedSize)if(playersReady)content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-matchup-player text-right">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td> <span class="bold">vs.</span> </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-matchup-player text-left">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player2}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t`;else{var playerRailsMatchState="Lineup is Incomplete";"ready"==playerRailsObj.home||"short"==playerRailsObj.home?playerRailsMatchState="<span class='text-red'>Away Lineup Missing</span>":"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away||(playerRailsMatchState="<span class='text-red'>Home Lineup Missing</span>"),content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan="3" class="player-rails-matchup-player text-center">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">${playerRailsMatchState}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t`}content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-start-instructions">\n\t\t\t\t\t\t\t\t\t\t\t\t${startInfo}\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t`;break;case"live":content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${set.set_number}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-matchup" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-live" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">In Progress</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t`,playersReady&&(content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t<table width="100%" class="player-rails-live-lineup">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-live-player text-right">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td> vs. </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-live-player text-left">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player2}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t`),content+="\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t";break;case"complete":content+=`\n\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t\t${set.set_number}\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-matchup" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-complete" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">Complete</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\x3c!----\x3e\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t`,playersReady&&(content+=`\n\t\t\t\t\t\t\t\t\t\t\t\t<table width="100%" class="player-rails-complete-lineup">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-complete-player text-right">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player1}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td> ${matchScore||" vs. "} </td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<td width="" class="player-rails-complete-player text-left">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${player2}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t`),content+="\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t"}return content+="</div></div>"},this.railsSetButtons={build:function(setBtnObj){var set=setBtnObj.set,startInfo=setBtnObj.startInfo,setComplete=setBtnObj.setComplete,setLive=setBtnObj.setLive,matchScore=setBtnObj.matchScore,details=[];details.push(_this.calculateLegInfo(set.legs_mode,set.legs_limit));var player1,player2,matchSetup=_this.playerRails.getMatchUp(set.set_id),playersReady=!1,players=this.getPlayers(matchSetup);player1=players.player1,player2=players.player2,"ready"==matchSetup.status&&(player1=matchSetup.home.join("<br />"),player2=matchSetup.away.join("<br />"),playersReady=!0);var allowShorts=_this.playerRails.allowShortLineUp(set.set_id),playerRailsObj=_this.playerRails.getPlayerRailsObj("","","",set.set_id),missingTeam=!1;if(!("ready"==playerRailsObj.home&&"ready"==playerRailsObj.away)&&allowShorts)if(playerRailsObj.homeAllEmpty||playerRailsObj.awayAllEmpty)playerRailsObj.homeAllEmpty&&"empty"==playerRailsObj.away||playerRailsObj.awayAllEmpty&&"empty"==playerRailsObj.home||(missingTeam=!0);else if(!("ready"!=playerRailsObj.home&&"short"!=playerRailsObj.home||"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away)){var i,player;for(player1="",player2="",i=0;i<playerRailsObj.homePlayers.length;i++)-1==playerRailsObj.homePlayers[i]?player1+='<span class="bold text-red">No Player</span><br />':(player=playerRailsObj.homePlayers[i],player1+=APP.session.createPlayerName(player,1)+"<br />");for(i=0;i<playerRailsObj.awayPlayers.length;i++)-1==playerRailsObj.awayPlayers[i]?player2+='<span class="bold text-red">No Player</span><br />':(player=playerRailsObj.awayPlayers[i],player2+=APP.session.createPlayerName(player,1)+"<br />");playersReady=!0}return this.buildContent(set,startInfo,setComplete,setLive,matchScore,details,playersReady,player1,player2,missingTeam,playerRailsObj)},getPlayers:function(matchSetup){var player1="",player2="";return"ready"==matchSetup.status&&(player1=matchSetup.home.join("<br />"),player2=matchSetup.away.join("<br />")),{player1:player1,player2:player2}},checkMissingTeam:function(playerRailsObj,matchReady,allowShorts){return!(matchReady||!allowShorts||!playerRailsObj.homeAllEmpty&&!playerRailsObj.awayAllEmpty||playerRailsObj.homeAllEmpty&&"empty"==playerRailsObj.away||playerRailsObj.awayAllEmpty&&"empty"==playerRailsObj.home)},handleShortLineup:function(playerRailsObj,playerFormat,playersReady){if(!("ready"!=playerRailsObj.home&&"short"!=playerRailsObj.home||"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away)){playersReady=!0;var{player1:player1,player2:player2}=this.createPlayerStrings(playerRailsObj)}return playersReady},createPlayerStrings:function(playerRailsObj){for(var player1="",player2="",i=0;i<playerRailsObj.homePlayers.length;i++)player1+=this.createPlayerString(playerRailsObj.homePlayers[i]);for(i=0;i<playerRailsObj.awayPlayers.length;i++)player2+=this.createPlayerString(playerRailsObj.awayPlayers[i]);return{player1:player1,player2:player2}},createPlayerString:function(player){return-1==player?'<span class="bold text-red">No Player</span><br />':APP.session.createPlayerName(player,1)+"<br />"},buildContent:function(set,startInfo,setComplete,setLive,matchScore,details,playersReady,player1,player2,missingTeam,playerRailsObj){var content="";switch(this.getMatchStatus(setLive,setComplete)){case"waiting":content+=this.buildWaitingContent(set,details,startInfo,playersReady,player1,player2,missingTeam,playerRailsObj);break;case"live":content+=this.buildLiveContent(set,playersReady,player1,player2);break;case"complete":content+=this.buildCompleteContent(set,playersReady,player1,player2,matchScore)}return content+"</div></div>"},getMatchStatus:function(setLive,setComplete){return setLive?"live":setComplete?"complete":"waiting"},buildWaitingContent:function(set,details,startInfo,playersReady,player1,player2,missingTeam,playerRailsObj){var content=`\n\t\t\t\t<table width="100%">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">${set.set_number}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t\t<div class="player-rails-match-info text-info-dark">${details.join(" | ")}</div>\n\t\t\t\t\t\t\t\t\t\t<div class="player-rails-matchup" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t`,type=1;switch(missingTeam&&(type=2),playersReady&&(type=3),_this.allowMidChapterPlayerChanges(set)&&(type=4),"team"==set.player_format&&(type=5),type){case 1:content+=this.buildIncompleteLineupContent(playerRailsObj);break;case 2:content+=this.buildMissingTeamContent(set,playerRailsObj);break;case 3:content+=this.buildPlayersContent(player1,player2);break;case 4:content+='\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<div class="player-rails-missing-info">\n\t\t\t\t\t\t\t\t\t<span class="bold">Players must be manually selected</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\n\t\t\t\t\t';break;case 5:content+='\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<div class="player-rails-missing-info">\n\t\t\t\t\t\t\t\t\t<span class="bold">Team Match</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\n\t\t\t\t\t'}return content+=`\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div class="player-rails-start-instructions">${startInfo}</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t`},buildLiveContent:function(set,playersReady,player1,player2){var isMixedSize=_this.allowMidChapterPlayerChanges(set,!0),content=`\n\t\t\t\t<table width="100%">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">${set.set_number}</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="player-rails-matchup" colspan="3">\n\t\t\t\t\t\t\t\t\t\t<div style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t<table width="100%">\n\t\t\t\t\t\t\t\t\t\t\t\t<tr >\n\t\t\t\t\t\t\t\t\t\t\t\t\t<td colspan="3">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="player-rails-live pSmBottom" style="text-align: center;">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="bold">In Progress</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t`;return playersReady&&!isMixedSize&&(content+=this.buildPlayersContent(player1,player2)),content+="\n\t\t\t\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t",content+="\n\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t"},buildCompleteContent:function(set,playersReady,player1,player2,matchScore){return`\n\t\t\t\t<table width="100%">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width="8%" height="100%" class="chapter-id">\n\t\t\t\t\t\t\t${set.set_number}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class="chapter-info">\n\t\t\t\t\t\t\t<span class="bold">Match Complete</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td class="chapter-faux-button" width="40%">\n\t\t\t\t\t\t\t${matchScore}\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t`},buildMissingTeamContent:function(set,playerRailsObj){var content='\n\t\t\t\t<div class="player-rails-missing-warning">\n\t\t\t\t\tThis Match Cannot Be Started\n\t\t\t\t</div>\n\t\t\t';return playerRailsObj.homeAllEmpty&&(content+=`\n\t\t\t\t\t<div class="player-rails-missing-team">\n\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.home_label}</strong><br />\n\t\t\t\t\t\t<span class="text-danger">Team lineup is missing</span>\n\t\t\t\t\t</div>\n\t\t\t\t`),playerRailsObj.awayAllEmpty&&(content+=`\n\t\t\t\t\t<div class="player-rails-missing-team">\n\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.away_label}</strong><br />\n\t\t\t\t\t\t<span class="text-danger">Team lineup is missing</span>\n\t\t\t\t\t</div>\n\t\t\t\t`),content+=`\n\t\t\t\t<table class="player-rails-faux-button-holder" width="100%">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t<div id="player-rails-ff-${set.set_id}" class="button-red button-md button-block round-corners button">\n\t\t\t\t\t\t\t\tForfeit Options\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t<div id="player-rails-edit-${set.set_id}" class="button-gold button-md button-block round-corners button">\n\t\t\t\t\t\t\t\tEdit Lineups\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t`},buildPlayersContent:function(player1,player2,matchScore){return`\n\t\t\t\t<tr>\n\t\t\t\t\t<td width="" class="player-rails-matchup-player text-right">${player1}</td>\n\t\t\t\t\t<td>${matchScore||" vs. "}</td>\n\t\t\t\t\t<td width="" class="player-rails-matchup-player text-left">${player2}</td>\n\t\t\t\t</tr>\n\t\t\t`},buildIncompleteLineupContent:function(playerRailsObj){var playerRailsMatchState="Lineup is Incomplete";return"ready"==playerRailsObj.home||"short"==playerRailsObj.home?playerRailsMatchState="<span class='text-dark-red'>Away Lineup Missing</span>":"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away||(playerRailsMatchState="<span class='text-dark-red'>Home Lineup Missing</span>"),`\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan="3" class="player-rails-matchup-player text-center">\n\t\t\t\t\t\t<span class="bold">${playerRailsMatchState}</span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t`}},this.calculateLegInfo=function(legsMode,legsLimit){switch(legsMode){case"BEST-OF":legsMode="Best of";break;case"PLAY-ALL":legsMode="Play all"}var legsInfo=legsMode+" "+legsLimit+" legs";return 1==legsLimit&&(legsInfo="Play 1 leg"),legsInfo},this.buildChapterInstructions=function(){var data=this.data,match=(data.railsFormat,data.railsMatch),instructions=this.createRailsInstructions(),sets=APP.nlf.data.league.match_settings.sets,content="",matchTitle=match.home_label+" vs. "+match.away_label,playerFormat="";instructions.player_format&&(playerFormat=`\n\t\t\t\t<tr>\n\t\t\t\t\t<td>Player Format: </td>\n\t\t\t\t\t<td>${this.transLangFromPlatform(instructions.player_format)}</td>\n\t\t\t\t</tr>\n\t\t\t`);var gamesList="";if(this.data.railsGameMenu){gamesList+="\n\t\t\t\t<tr>\n\t\t\t\t\t<td>Games: </td>\n\t\t\t\t\t<td>\n\t\t\t\t\t";for(var i=0;i<this.data.railsGameMenu.length;i++){var game=this.data.railsGameMenu[i];if(game.label){if("Cricket"==game.type){var cricketVariant=APP.session.getCricketVariantName(game.cricket_variation);if(cricketVariant&&(game.label=cricketVariant),game.cricket_options){var extLbl=APP.game.getGameOptsLabel(game.cricket_options);extLbl&&(game.label+=" - "+extLbl)}}gamesList+=game.label;var handicapping=!1;game.dynamic_handicapping&&("Y"==game.dynamic_handicapping&&(handicapping="dynamic"),"S"==game.dynamic_handicapping&&(handicapping="standard")),(handicapping||"Y"==game.sudden_death)&&(gamesList+='\n\t\t\t\t\t\t\t<div class="highlight-box" style="margin-top: 0.3em;">\n\t\t\t\t\t\t\t\t<table>\n\t\t\t\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t\t\t<td class="text-gold">Special Rules:</td>\n\t\t\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t',"dynamic"==handicapping&&(gamesList+='\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="" style="font-weight: normal">\n\t\t\t\t\t\t\t\t\t\tDynamic Handicapping is active\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t'),"standard"==handicapping&&(gamesList+='\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td class="" style="font-weight: normal">\n\t\t\t\t\t\t\t\t\t\tHandicapping is active\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t'),"Y"==game.sudden_death&&(gamesList+='\n\t\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t\t<td style="font-weight: normal;">\n\t\t\t\t\t\t\t\t\t\tSudden Death',game.sudden_death_round&&(gamesList+=` after <span class="bold">${game.sudden_death_round}</span> rounds`),gamesList+="\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t"),gamesList+="\n\t\t\t\t\t\t\t\t\t</tbody>\n\t\t\t\t\t\t\t\t</table>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t"),gamesList+="<br />"}}gamesList+="\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t"}var remainingLegInfo="";instructions.remaining_legs&&instructions.legs_limit>1&&(remainingLegInfo+=`\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Remaining Legs: </td>\n\t\t\t\t\t\t<td>${this.transLangFromPlatform(instructions.remaining_legs)}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t`);var decidingLegInfo="";instructions.cork_last&&"Y"==instructions.cork_last&&instructions.legs_limit>1&&(decidingLegInfo+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Deciding Leg: </td>\n\t\t\t\t\t\t<td>Bull Up</td>\n\t\t\t\t\t</tr>\n\t\t\t\t");var notes="";instructions.set_instructions&&(notes+=`\n\t\t\t\t<div class="highlight-box primary-grad">\n\t\t\t\t\t<h4 class="subheading text-gold">Notes</h4>\n\t\t\t\t\t<p class="match-title">${instructions.set_instructions}</p>\n\t\t\t\t</div>\n\t\t\t`);var legsInfo=this.calculateLegInfo(instructions.legs_mode,instructions.legs_limit),matchHeader="",hasLabel=instructions.segment_label,hasScoreKeeper=instructions.scorekeeper&&"NONE"!==instructions.scorekeeper,hasSetNumber=instructions.set_number;(hasLabel||hasSetNumber||hasScoreKeeper)&&(matchHeader='<h4 class="subheading text-gold">',hasLabel&&(matchHeader+=`\n\t\t\t\t\t${instructions.segment_label}\n\t\t\t\t`),hasSetNumber&&(hasLabel&&(matchHeader+=" - "),matchHeader+="Set "+instructions.set_number),hasScoreKeeper&&((hasLabel||hasSetNumber)&&(matchHeader+="<br />"),matchHeader+=`\n\t\t\t\t\t<span>${this.transLangFromPlatform(instructions.scorekeeper)} To Score</span>\n\t\t\t\t`),matchHeader+="</h4>");var startingLeg="";if(instructions.first_leg)startingLeg=this.transLangFromPlatform(instructions.first_leg);else{if(this.isAlternateSets()&&!this.tieBreaker.tieBreakerActive)if(this.getAlternateSets())startingLeg=0==this.getAlternateSetsStarterVal(instructions.set_number)?this.transLangFromPlatform("HOME_STARTS"):this.transLangFromPlatform("AWAY_STARTS");else startingLeg="\n\t\t\t\t\t\tSelect Starter</span>\n\t\t\t\t\t";if(this.isAlternateSetsBullDeciding()&&instructions.set_number-1==sets.length-1){var isDecidingSet=this.isDecidingAlternateSet(instructions.set_number-1,sets.length);isDecidingSet.isTriggered?startingLeg="Select Starter":isDecidingSet.isActive||(startingLeg='<span class="text-muted">Select Starter</span>')}}return content+=`\n\t\t\t\x3c!--<div class="button button-green button-md round-corners mMdBottom">\n\t\t\t\tStart Game\n\t\t\t</div>\n\n\t\t\t<div class="button button-gold button-md round-corners mMdBottom">\n\t\t\t\tForfeit Options\n\t\t\t</div>\n\n\t\t\t<div class="button button-red button-md round-corners mMdBottom">\n\t\t\t\tBack\n\t\t\t</div>--\x3e\n\n\t\t\t<div class="highlight-box">\n\t\t\t\t${matchHeader}\n\n\t\t\t\t<p class="match-title">${matchTitle}</p>\n\n\t\t\t\t<hr class="instruction-divider" />\n\n\t\t\t\t<table class="rails-instructions" width="100%">\n\t\t\t\t\t${playerFormat}\n\t\t\t\t\t${gamesList}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Legs: </td>\n\t\t\t\t\t\t<td>${legsInfo}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Starting Leg: </td>\n\t\t\t\t\t\t<td>${startingLeg}</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t${remainingLegInfo}\n\t\t\t\t\t${decidingLegInfo}\n\t\t\t\t</table>\n\t\t\t</div>\n\n\t\t\t${notes}\n\t\t`},this.clearRailsData=function(){var data=this.data;data.railsMatch=null,data.railsFormat=null,data.matchId=null,data.homePlayer=null,data.awayPlayer=null,data.railsReturn=null,this.parent.save()},this.exitChapterSelect=function(){this.clearRailsData(),this.parent.displayPage(1)},this.chapterClick=function(id,preflight){APP.nlf.playerRails.isPlayerRails();var btn=$("#"+id),setId=btn.attr("data-set-id"),sets=(btn.attr("data-match-id"),APP.nlf.data.league.match_settings.sets),set=APP.findInObjArray("set_id",sets,setId)[0];if(!$("#"+id).hasClass("set-complete")||preflight)if(!$("#"+id).hasClass("set-live")||preflight){if(APP.nlf.data.railsChapter=set,APP.nlf.data.railsGameMenu=set.game_menu,_this.allowMidChapterPlayerChanges(set,!0)&&APP.nlf.playerRails.isPlayerRails()){if("team"==set.player_format){var match=APP.nlf.data.railsMatch;APP.dialog.show({title:"Play Match?",msg:`\n\t\t\t\t\t\t<div style="font-weight: bold; margin: 0.5em 0.5em 1em; font-size: 1.2em;">\n\t\t\t\t\t\t\t${match.home_label}<br />\n\t\t\t\t\t\t\t<span style="font-size:0.8em;line-height:2.0em;">vs</span><br />\n\t\t\t\t\t\t\t${match.away_label}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-confirm" class="bold button button-menu round-corners button-green">\n\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-cancel" class="bold button button-menu round-corners button-red">\n\t\t\t\t\t\t\tReturn to Set List\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`})}else APP.dialog.show({title:"Play Match?",msg:'\n\t\t\t\t\t\t<div style="font-weight: bold; margin: 0.5em 0.5em 1em; font-size: 1.2em;">\n\t\t\t\t\t\t\tPlayers must be manually selected for this Set\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-confirm" class="bold button button-menu round-corners button-green">\n\t\t\t\t\t\t\tStart Match\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-cancel" class="bold button button-menu round-corners button-red">\n\t\t\t\t\t\t\tReturn to Set List\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'});return APP.fns.activateBtn("pr-conf-confirm",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.nlf.save(),APP.nlf.playerRails.startMatch(),APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1})),void APP.fns.activateBtn("pr-conf-cancel",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1}))}if(_this.playerRails.isPlayerRails()){var allowShorts=_this.playerRails.allowShortLineUp(),playerRailsObj=_this.playerRails.getPlayerRailsObj(),matchReady="ready"==playerRailsObj.home&&"ready"==playerRailsObj.away;if(allowShorts&&("ready"!=playerRailsObj.home&&"short"!=playerRailsObj.home||"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away||(matchReady=!0)),matchReady){var playerName,i,homePlayers=playerRailsObj.homePlayers,awayPlayers=playerRailsObj.awayPlayers,homeLabel="",awayLabel="";for(i=0;i<homePlayers.length;i++)homePlayers[i],"-SHORT-"==(playerName=APP.session.createPlayerName(playerRailsObj.homePlayers[i],1))&&(playerName='<span class="bold text-red">No Player</span>'),homeLabel+=playerName,i<homePlayers.length-1&&(homeLabel+="<br />");for(i=0;i<awayPlayers.length;i++)awayPlayers[i],"-SHORT-"==(playerName=APP.session.createPlayerName(playerRailsObj.awayPlayers[i],1))&&(playerName='<span class="bold text-red">No Player</span>'),awayLabel+=playerName,i<awayPlayers.length-1&&(awayLabel+="<br />");return APP.nlf.playerRails.chapterPopUpShowing=!0,APP.dialog.show({title:"Play Match?",msg:`\n\t\t\t\t\t\t<div style="font-weight: bold; margin: 0.5em 0.5em 1em; font-size: 1.2em;">\n\t\t\t\t\t\t\t${homeLabel}\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t<span style="font-size:0.8em;line-height:2.0em;">vs</span>\n\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t${awayLabel}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-confirm" class="bold button button-menu round-corners button-green">\n\t\t\t\t\t\t\tContinue\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-cancel" class="bold button button-menu round-corners button-red">\n\t\t\t\t\t\t\tReturn to Set List\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<hr />\n\t\t\t\t\t\t<div id="pr-conf-ff" class="hide bold button button-menu round-corners button-gray">\n\t\t\t\t\t\t\tForfeit Options\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="pr-conf-edit" class="bold button button-menu round-corners button-gold">\n\t\t\t\t\t\t\tEdit Lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}),APP.nlf.rails.confPopUpShowing=!0,APP.fns.activateBtn("pr-conf-confirm",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.nlf.save(),APP.nlf.playerRails.startMatch(),APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1})),APP.fns.activateBtn("pr-conf-cancel",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1})),APP.fns.activateBtn("pr-conf-edit",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.nlf.displayPage(13),APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1})),APP.fns.activateBtn("pr-conf-ff",(function(btnId){APP.nlf.rails.confPopUpShowing=!1,APP.nlf.displayPage(7),APP.dialog.hide(),APP.nlf.playerRails.chapterPopUpShowing=!1})),void(APP.nlf.playerRails.isPlayerRails()&&$("#pr-conf-ff").removeClass("hide"))}}APP.nlf.save(),_this.playerRails.isPlayerRails()?APP.nlf.displayPage(13):APP.nlf.displayPage(6)}else APP.confirm.show({title:"Play Set?",msg:"This set appears to be in progress. Are you sure you want to play this set?",ok:function(){APP.nlf.rails.chapterClick(id,!0)}});else APP.confirm.show({title:"Replay Set?",msg:"This set appears to have already been played. Are you sure you want to replay this set?",ok:function(){APP.nlf.rails.chapterClick(id,!0)}})},this.earlySave=function(preflight){if(preflight){var matchId=APP.nlf.data.railsMatch.league_match_id,data={season_status:APP.nlf.data.league.season_status,league_match_id:matchId};APP.fns.doOldCall("/forceCloseAmbMatch",data,(function(r){APP.alert.show("Match Saved Successfully",(function(){APP.nlf.displayPage(1)}))}),(function(e){APP.alert.show("Couldn't reach the DartConnect Platform.<br />Please check your Internet Connection and try again")}))}else APP.confirm.show({title:"End and Save Match?",msg:"This will mark the match as complete and send the result to league administrators. Are you sure you want to do this?",ok:function(){APP.nlf.rails.earlySave(!0)}})},this.createRailsMatchFormat=function(){var set=this.data.railsChapter,settings=this.data.league.match_settings,matchId=this.data.matchId;if(!set)return APP.alert.show("Match Failed to Load<br />Seek help with your League Administrator"),void APP.nlf.rails.logError("Couldn't find set","Rails | createRailsMatchFormat");var corkFirstLeg=!1;switch(set.first_leg){case"HOME_OPTION":case"HOME_CORKS":case"AWAY_OPTION":case"AWAY_OPTION":corkFirstLeg=!0}var pointsStyle=settings.points_style,matchFormat={bonus_points:settings.bonus_points,bonus_points_win:settings.bonus_points_win,bonus_points_sweep:settings.bonus_points_sweep,sweep_requirement:settings.sweep_requirement,cork_last_set:"",cork_sudden_death:settings.cork_sudden_death,event_type:settings.event_type,id:matchId,chapter_id:set.set_id,chapter_number:set.set_number,legs:{mode:set.legs_mode,limit:set.legs_limit},legs_limit:set.legs_limit,maintain_team_throw_order:settings.maintain_team_throw_order,max_legs:null,next_game:set.remaining_legs,next_game_options:{cork_first:corkFirstLeg,cork_last:"Y"==set.cork_deciding_leg,random_start:"RANDOM"==set.first_leg,player:"PLAYER"==set.first_leg},next_set:null,next_set_options:{},org_id:settings.org_id,org_level:settings.org_level,same_game:set.game_menu.length>1?"PER-LEG":"PER-SET",points_style:pointsStyle,same_legs:!0,sets:{mode:"BEST-OF",limit:1},win_by_two:set.win_by_2};"CUSTOM"==pointsStyle&&(matchFormat.league_points=set.league_points),_this.allowMidChapterPlayerChanges(set)&&(matchFormat.next_game="MENU"),matchFormat.instructions=this.createRailsInstructions(),this.data.railsTransFormat=matchFormat,this.parent.save()},this.createRailsInstructions=function(set){return set||(set=this.data.railsChapter),{set_number:set.set_number,first_leg:set.first_leg,cork_last:set.cork_deciding_leg,legs_limit:set.legs_limit,legs_mode:set.legs_mode,player_format:set.player_format,remaining_legs:set.remaining_legs,scorekeeper:set.scorekeeper,segment_label:set.segment_label,set_instructions:set.set_instructions}},this.transLangFromPlatform=function(trans){switch(trans){case"HOME":trans="Home";break;case"AWAY":trans="Away";break;case"varies":trans="Varies";break;case"team":trans="Team";break;case"singles":trans="Singles";break;case"doubles":trans="Doubles";break;case"triples":trans="Triples";break;case"quads":trans="Quads";break;case"each-leg":trans="Select per Leg";break;case"MENU":trans="Show all Leg Start Options";break;case"RANDOM":trans="Random Start";break;case"HOME_STARTS":trans="Home Starts";break;case"HOME_CORKS":trans="Home Throws for Bull";break;case"HOME_OPTION":trans="Home Bull Option";break;case"AWAY_STARTS":trans="Away Starts";break;case"AWAY_CORKS":trans="Away Throws for Bull";break;case"AWAY_OPTION":trans="Away Bull Option";break;case"CORK":trans="Bull Start";break;case"ALTERNATE":trans="Alternate";break;case"PLAYER":trans="Player's Choice";break;case"MUGS_AWAY":trans="Loser Starts"}return trans},this.launchGame=function(manual,callback){var data=this.data;manual||(data.matchLoaded=!0,this.parent.save());var sess=APP.session,league=data.league;if(sess.startNew(league.league_type,league),this.checkWdfRules()&&this.wdfRules.applyWdfUserOptions(),league&&sess.applyAdditionalOptions(league),league.user_options&&sess.applyUserOptions(league.user_options),!manual){var match=APP.getMatch();match.league_match_id=this.parent.getLeagueMatchId(),match.league_set_id=data.railsChapter.set_id,sess.store(sess.current_match)}APP.header.fetchDirectory(),APP.popup.hide();var appIsBroadCasting=!0;APP.server.alley_id&&APP.device.is_broadcasting||(appIsBroadCasting=!1),appIsBroadCasting||this.data.railsPractice||"Y"==league.can_broadcast&&APP.handleAlleyOption("pcm-broadcast-start-button",(function(r){APP.nlf.manuallyBroadcastInitMatch()}),(function(e){APP.nlf.rails.confirmRetryBroadcast()})),APP.device.has_chalk=!0,APP.changeMode("PRE-GAME"),APP.chalkboard.unshield(),APP.popup.hide(),APP.game_selector.show(!0),APP.reveal.showButtonBar("button-bar-match","","",!0),APP.header.refresh(),APP.reveal.setChalkButton(),APP.session.setupLeagueDefaults(),APP.device.showSpinnerOverlay(),APP.header.startOpponentChange(!1,!0),APP.nlf.rails.setInitialStarter(),APP.nlf.rails.setLegsRace();try{if("team"==APP.nlf.data.railsChapter.player_format)APP.header.handleOpponentChange("rails-team-continue");else if(!APP.nlf.playerRails.isPlayerRails()){this.data.league.league_id;APP.nlf.playerRails.isPlayerRails()||APP.nlf.continueAutomation(manual)}}catch(e){}APP.nlf.save(),APP.device.hideSpinnerOverlay(),callback&&callback()},this.starterSet=!1,this.getInitialStarter=function(){var starter=-1;try{var transFormat=this.data.railsTransFormat,instructions=transFormat.instructions,sets=this.data.railsFormat.sets;if(this.isAlternateSets()&&!this.tieBreaker.tieBreakerActive){if(this.getAlternateSets()){var setNumber=instructions.set_number;starter=this.getAlternateSetsStarterVal(setNumber)}if(this.isAlternateSetsBullDeciding()&&instructions.set_number-1==sets.length-1){var isDecidingSet=this.isDecidingAlternateSet(instructions.set_number-1,sets.length);isDecidingSet.isTriggered?starter=-1:isDecidingSet.isActive||(starter=-1)}return starter}if(!transFormat||!transFormat.instructions||!transFormat.instructions.first_leg)return this.log("Can't set Starter"),-1;switch(transFormat.instructions.first_leg){case"HOME_STARTS":this.log("Found Home as Starter"),starter=0;break;case"AWAY_STARTS":this.log("Found Away as Starter"),starter=1;break;case"RANDOM":this.log("Found Random Starter"),starter=Math.floor(2*Math.random());break;default:this.log("No instruction for Starter")}}catch(e){starter=-1}return starter},this.isSingles=function(){try{var league=this.data.league;if(league.league_type&&"SINGLES"==league.league_type)return!0}catch(e){}return!1},this.allowMidChapterPlayerChanges=function(set,incTeam){switch(set.player_format){case"each-leg":case"varies":return!0}return!(!incTeam||"team"!=set.player_format)},this.setInitialStarter=function(){if(!this.starterSet){var starter=this.getInitialStarter();-1!=starter&&(this.starterSet=!0,APP.game.setBullShootWinner(starter,!1))}},this.setLegsRace=function(){var chapter=this.data.railsChapter;if(chapter&&chapter.legs_limit){var legsRace=chapter.legs_limit,playAll="";"PLAY-ALL"==APP.nlf.data.railsChapter.legs_mode&&(playAll="-pa-"),APP.header.handleSetSetup("pssm-set-"+playAll+legsRace),APP.header.handleSetSetup("pssm-continue"),this.log("Legs race set ("+legsRace+")")}else this.log("Unable to set legs race")},this.logError=function(e,title){e&&title&&newErrorReport(e,title,!1)},this.reloadChapterList=function(){if("IN-GAME"!=APP.mode&&"PRE-GAME"!=APP.mode){var data=BBAT.fetchData("nlf_data");if(data&&data.railsReturn&&data.railsReturn.league_btn_id){if(data.railsReturn.match_id&&-1==data.railsReturn.match_id){var rr=APP.nlf.data.railsReturn;return rr&&data.railsPractice&&(APP.nlf.data.selectedPlayerId=rr.selectedPlayerId,APP.nlf.data.selectedPlayerLabel=rr.selectedPlayerLabel,APP.nlf.data.selectedTeamId=rr.selectedTeamId,APP.nlf.data.selectedTeamLabel=rr.selectedTeamLabel,rr.leagueSchedule&&(APP.nlf.data.league.league_schedule=rr.leagueSchedule)),void this.startPracticeMatch(data.railsReturn.league_btn_id)}var matchId=data.railsReturn.league_btn_id,key={league_id:APP.extractSegment(matchId,3,"-"),league_division_guid:APP.extractSegment(matchId,4,"-"),season_status:APP.extractLastSegment(matchId)},ld=APP.session.getLeagueDefinition(key);if(ld&&"LEGACY"==ld.match_format_style)return APP.nlf.data.railsReturn=null,void APP.nlf.save();if(!ld)return APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save(),void APP.device.hideSpinnerOverlay();APP.device.showSpinnerOverlay(),window.setTimeout((function(){try{if(APP.session.handleLeagueMenu(data.railsReturn.league_btn_id),APP.nlf.checkForProxy()&&APP.nlf.data.league&&APP.nlf.data.league.league_schedule&&APP.nlf.displayPage(1),!$("#nlf-match-"+data.railsReturn.match_id).length)return APP.nlf.data.railsReturn&&(APP.nlf.data.railsReturn.match_id=null),APP.nlf.save(),void APP.device.hideSpinnerOverlay();data.railsReturn.match_id&&APP.nlf.pages.matchSelect.matchClick("nlf-match-"+data.railsReturn.match_id,!0)}catch(e){APP.device.hideSpinnerOverlay()}APP.device.hideSpinnerOverlay()}),1e3)}}},this.getLeagueHelperObj=function(){try{var self,homeId,homeLabel,i,playerArr,league=this.data.league,data=this.data,isProxy=!!this.parent.checkForProxy(),type=league.league_type,cleanOppoArr=[],oppoArr=APP.nlf.getLeagueRoster();if(isProxy?"SINGLES"==type?(homeId=data.selectedPlayerId,homeLabel=data.selectedPlayerLabel,playerArr=oppoArr.teams[0].players,self=APP.findInObjArray("player_guid",playerArr,homeId)[0]):(homeId=data.selectedTeamId,homeLabel=data.selectedTeamLabel,self=APP.findInObjArray("team_guid",oppoArr.teams,homeId)[0]):"SINGLES"==type?(homeId=league.player_roster_id,playerArr=oppoArr.teams[0].players,self=APP.findInObjArray("player_guid",playerArr,homeId)[0],homeLabel=APP.session.createPlayerName(self,1)):(homeId=league.team_guid,homeLabel=league.team_name,self=APP.findInObjArray("team_guid",oppoArr.teams,homeId)[0]),"SINGLES"==type)for(i=0;i<playerArr.length;i++)playerArr[i].player_guid!=homeId&&cleanOppoArr.push({id:playerArr[i].player_guid,name:APP.session.createPlayerName(playerArr[i],1)});else for(i=0;i<oppoArr.teams.length;i++)oppoArr.teams[i].team_guid&&oppoArr.teams[i].team_guid!=homeId&&cleanOppoArr.push({id:oppoArr.teams[i].team_guid,name:oppoArr.teams[i].team_name});return{self:self,type:type,isProxy:isProxy,homeId:homeId,homeLabel:homeLabel,oppoArr:cleanOppoArr}}catch(e){return APP.nlf.rails.logError(e.message,"getLeagueHelperObj"),!1}},this.startMatch=function(manual,launchCallback){manual&&"boolean"!=typeof manual&&(manual=!1),APP.nlf.rails.getRailsMatchData(!0),APP.nlf.rails.createRailsMatchFormat();var setId=APP.nlf.data.railsChapter.set_id;APP.nlf.rails.updateSetStatus(setId,"LIVE"),APP.nlf.rails.initialLaunch=!0,APP.nlf.rails.launchGame(manual,launchCallback),APP.nlf.data.mode=0,APP.nlf.save(),window.setTimeout((function(){APP.nlf.rails.initialLaunch=!1}),100)},this.enableAdditionalOptions=function(){var data=_this.data;data={id:"rails-additional-options",title:"Set Options",options:[{display:"Forfeit "+data.railsMatch.home_label,value:"ff-home"},{display:"Forfeit "+data.railsMatch.away_label,value:"ff-away"},{display:"Forfeit Both Opponents",value:"ff-both"}],defaultText:"Additional Set Options",callback:function(val,display){-1==val||_this.log(val)}},APP.fns.createOptions(data,!0)},this.getUniqueId=function(set_id){try{var uniqueId="";return uniqueId=this.data.league.season_status,uniqueId+="-",uniqueId+=this.data.railsMatch.league_match_id,set_id&&(uniqueId+="-",uniqueId+=set_id),uniqueId}catch(e){}return!1},this.getChapterStatus=function(chapterArr,setId){var chapterStatus="UNPLAYED";if(chapterArr&&chapterArr.length){var setStatus=APP.findInObjArray("set_id",chapterArr,setId)[0];setStatus&&setStatus.played_status&&(chapterStatus=setStatus.played_status)}var uniqueId=this.getUniqueId(),completedArr=APP.nlf.getLocal(uniqueId,"completed");return-1!==completedArr&&Array.isArray(completedArr)&&-1!==completedArr.indexOf(setId)&&(chapterStatus="PLAYED"),chapterStatus},this.getChapterScore=function(chapterArr,setId){var chapterScore=!1;try{if(chapterArr&&chapterArr.length){var mySet=APP.findInObjArray("set_id",chapterArr,setId)[0];mySet&&(mySet.home_league_points||mySet.away_league_points)&&(chapterScore=mySet.home_league_points+" - "+mySet.away_league_points)}var uniqueId=this.getUniqueId(),localScoreObj=APP.nlf.getLocal(uniqueId,setId);-1!==localScoreObj&&Array.isArray(localScoreObj)&&(chapterScore=localScoreObj[0]+" - "+localScoreObj[1])}catch(e){}return chapterScore},this.playerRailsFFShortcut=function(setId){APP.nlf.data.railsMatch.league_match_id;if(!setId)return!1;var sets=APP.nlf.data.league.match_settings.sets,set=APP.findInObjArray("set_id",sets,setId)[0];APP.nlf.data.railsChapter=set,APP.nlf.data.railsGameMenu=set.game_menu,APP.nlf.save(),APP.nlf.displayPage(7),$("#rails-set-forfeit-opts").parent().addClass("open"),$("#rails-set-win-opts").parent().hide()},this.playerRailsEditShortcut=function(setId){APP.nlf.data.railsMatch.league_match_id;if(!setId)return!1;var sets=APP.nlf.data.league.match_settings.sets,set=APP.findInObjArray("set_id",sets,setId)[0];APP.nlf.data.railsChapter=set,APP.nlf.data.railsGameMenu=set.game_menu,APP.nlf.save(),APP.nlf.displayPage(13)},this.matchScore=null,this.calculateMatchScore=function(force){if(this.matchScore&&!force)return this.matchScore;var matchScore=!1;try{var settings=APP.session.getLeagueDefinition(this.data.league);settings=settings.match_settings;var sets=APP.nlf.data.railsFormat.sets,uniqueId=this.getUniqueId();settings.points_style;matchScore={points_style:settings.points_style,bonus_points:settings.bonus_points,bonus_points_win:null,bonus_points_sweep:null,match_complete:!1,home:{set_wins:0,league_points:0},away:{set_wins:0,league_points:0},sets_played:0,total_sets:0};for(var i=0;i<sets.length;i++){var set=sets[i],setId=set.set_id;if(set.bonus_points_sweep&&(matchScore.bonus_points_sweep=set.bonus_points_sweep),set.bonus_points_win&&(matchScore.bonus_points_win=set.bonus_points_win),"Y"!=set.tiebreaker){matchScore.total_sets++;var localScore=this.parent.getLocal(uniqueId,setId);if(-1!==localScore)matchScore=this.doSetScoreCalculation(0,localScore,set,matchScore),(matchScore=this.doSetScoreCalculation(1,localScore,set,matchScore)).sets_played++;else if(this.data.railsMatch&&this.data.railsMatch.chapter_status){var chapterArr=APP.nlf.data.railsMatch.chapter_status,mySet=APP.findInObjArray("set_id",chapterArr,set.set_id)[0];mySet&&(mySet.home_score||mySet.away_score)&&(localScore=[mySet.home_score,mySet.away_score],matchScore=this.doSetScoreCalculation(0,localScore,mySet,matchScore),(matchScore=this.doSetScoreCalculation(1,localScore,mySet,matchScore)).sets_played++)}}}var isCompleted=!1;if("BEST-OF"==settings.sets_mode){var maxLegs=Math.round(settings.sets_limit/2);settings.sets_limit%2==0&&maxLegs++,matchScore.home.set_wins>=maxLegs&&(matchScore.match_complete=!0,isCompleted=!0),matchScore.away.set_wins>=maxLegs&&(matchScore.match_complete=!0,isCompleted=!0)}else"PLAY-ALL"==settings.sets_mode&&matchScore.sets_played>=settings.sets_limit&&(matchScore.match_complete=!0,isCompleted=!0);try{if(settings&&settings.min_sets){var minSets=settings.min_sets;matchScore.sets_played<minSets&&(matchScore.match_complete=!1,isCompleted=!1)}}catch(e){}if(this.tieBreaker.hasTiebreaker&&this.tieBreaker.tieBreakerActive&&(isCompleted=this.tieBreaker.tieBreakerComplete,matchScore.match_complete=isCompleted,matchScore.home.league_points+=this.tieBreaker.tieBreakerScore.home,matchScore.away.league_points+=this.tieBreaker.tieBreakerScore.away),matchScore.match_complete)try{var railsFormat=APP.nlf.data.railsFormat,bonusPointsWin=railsFormat.bonus_points_win,bonusPointsSweep=railsFormat.bonus_points_sweep,sweepRequirement=railsFormat.sweep_requirement,pointsFormat=railsFormat.points_style;if("SUPPRESS_PLAYER"!=pointsFormat&&"SUPPRESS_LEAGUE"!=pointsFormat){var sweep,chapters,winner=-1,homePoints=matchScore.home.league_points,awayPoints=matchScore.away.league_points;if(homePoints>awayPoints&&(winner=0),awayPoints>homePoints&&(winner=1),-1!==winner)if(0==winner){if(matchScore.home.league_points+=bonusPointsWin,"ALL_SETS"==sweepRequirement)matchScore.home.set_wins==matchScore.total_sets&&(matchScore.home.league_points+=bonusPointsSweep);else if("ALL_LEGS"==sweepRequirement&&matchScore.home.set_wins==matchScore.total_sets){for(chapters=APP.nlf.data.railsMatch.chapter_status,sweep=!0,i=0;i<chapters.length;i++)if(chapters[i].away_score>0){sweep=!1;break}sweep&&(matchScore.home.league_points+=bonusPointsSweep)}}else if(matchScore.away.league_points+=bonusPointsWin,"ALL_SETS"==sweepRequirement)matchScore.away.set_wins==matchScore.total_sets&&(matchScore.away.league_points+=bonusPointsSweep);else if("ALL_LEGS"==sweepRequirement&&matchScore.away.set_wins==matchScore.total_sets){for(chapters=APP.nlf.data.railsMatch.chapter_status,sweep=!0,i=0;i<chapters.length;i++)if(chapters[i].home_score>0){sweep=!1;break}sweep&&(matchScore.away.league_points+=bonusPointsSweep)}}}catch(e){this.log(e)}this.markMatchStatus(isCompleted),uniqueId=this.getUniqueId(),this.parent.setLocal(uniqueId,"matchScore",matchScore)}catch(e){}return this.matchScore=matchScore,matchScore},this.doSetScoreCalculation=function(oppoIndex,setScore,set,matchScore){var leaguePoints=0,pointsStyle=matchScore.points_style,bonusPointsWin=(matchScore.bonus_points,matchScore.bonus_points_win),bonusPointsSweep=matchScore.bonus_points_sweep,addedPoints=0,isWinner=setScore[oppoIndex]>setScore[oppoIndex?0:1],isTie=setScore[oppoIndex]==setScore[oppoIndex?0:1];switch(bonusPointsWin&&isWinner&&(addedPoints=bonusPointsWin,bonusPointsSweep&&(0!=setScore[0]&&0!=setScore[1]||(addedPoints=bonusPointsSweep))),pointsStyle){case"PER-LEG":leaguePoints=setScore[oppoIndex];break;case"PER-SET":leaguePoints=isWinner?1:0;break;case"PER-SET-PLAYER":if(leaguePoints=0,isWinner)switch(set.player_format){case"singles":leaguePoints=1;break;case"doubles":leaguePoints=2;break;case"triples":leaguePoints=3;break;case"quads":leaguePoints=4}break;case"PER-LEG-PLAYER":if(leaguePoints=0,0==setScore[oppoIndex])break;switch(set.player_format){case"singles":leaguePoints=setScore[oppoIndex];break;case"doubles":leaguePoints=2*setScore[oppoIndex];break;case"triples":leaguePoints=3*setScore[oppoIndex];break;case"quads":leaguePoints=4*setScore[oppoIndex]}break;case"MATCH_WINS_1_WIN_.5_TIE":isWinner?leaguePoints=1:isTie&&(leaguePoints=.5);break;case"MATCH_WINS_2_WIN_1_TIE":isWinner?leaguePoints=2:isTie&&(leaguePoints=1);break;case"MATCH_WINS_3_WIN_1_TIE":isWinner?leaguePoints=3:isTie&&(leaguePoints=1);break;case"MATCH_WINS_3_WIN_2_TIE_1_LOSS":leaguePoints=isWinner?3:isTie?2:1;break;case"CUSTOM":isWinner&&(leaguePoints=set.league_points)}return oppoIndex?(isWinner&&(matchScore.away.set_wins++,addedPoints&&(matchScore.away.league_points+=addedPoints)),matchScore.away.league_points+=leaguePoints):(isWinner&&(matchScore.home.set_wins++,addedPoints&&(matchScore.home.league_points+=addedPoints)),matchScore.home.league_points+=leaguePoints),matchScore},this.getTeamRoster=function(teamId){var data=APP.nlf.data,leagueKey="";leagueKey+=data.league.league_division_guid,leagueKey+="_",leagueKey+=data.league.season_status;var divisionTeams=BBAT.fetchData("directory_division_"+leagueKey);return APP.findInObjArray("team_guid",divisionTeams.teams,teamId)[0]},this.checkForMatchFlip=function(set){return!!set&&APP.nlf.data.railsMatch.home_id==set.away_id},this.getMatchStatus=function(bgMode,callback){try{if(this.data.railsPractice)return;if(this.confPopUpShowing)return;var scrollPos,useLoader=!0;bgMode&&(useLoader=!1,scrollPos=document.querySelector("#nlf-scroll-box").scrollTop);var data={season_status:APP.nlf.data.league.season_status,league_match_id:APP.nlf.data.railsMatch.league_match_id};APP.fns.doOldCall("/getCurrentMatchSetStatus",data,(function(r){if(r){if(APP.nlf.rails.checkForMatchFlip(r[0])){var isProxy=APP.nlf.checkForProxy(),msg="This match has been updated. Please reselect your match.";isProxy&&(msg="This match has been updated. Please reselect your team and match."),APP.alert.show(msg,(function(){var uniqueId=APP.nlf.rails.getUniqueId();APP.nlf.removeLocalRecord(uniqueId),isProxy?APP.nlf.displayPage(2):APP.nlf.exit()}))}APP.nlf.data.railsMatch.chapter_status=r,APP.nlf.save(),APP.nlf.rails.openAccordions=[],$(".accordion.open").each((function(){var header=$(this).children(".header"),id=$(header).attr("id");id&&APP.nlf.rails.openAccordions.push(id)}));var currentChapter=!1;if(APP.nlf.data.railsChapter&&(currentChapter=APP.nlf.data.railsChapter),APP.nlf.displayPage(APP.nlf.data.mode),currentChapter&&(APP.nlf.data.railsChapter=currentChapter),bgMode&&scrollPos&&(document.querySelector("#nlf-scroll-box").scrollTop=scrollPos),5==APP.nlf.data.mode)try{APP.nlf.rails.calculateMatchScore().match_complete&&APP.nlf.displayPage(8)}catch(e){}callback&&callback(!0)}}),(function(e){APP.nlf.rails.log(e);try{if(e.responseJSON)switch(e.responseJSON.status_text){case"Match not found":var uniqueId=APP.nlf.rails.getUniqueId();APP.nlf.removeLocalRecord(uniqueId);APP.alert.show("This match cannot be found. Please select another match.",(function(){APP.nlf.exit()}))}}catch(e){}callback&&callback(!1)}),useLoader,2500)}catch(e){}},this.updateSetStatus=function(setId,status){try{if(this.data.railsPractice)return;var data={season_status:APP.nlf.data.league.season_status,league_match_id:APP.nlf.data.railsMatch.league_match_id,set_id:setId,set_number:APP.nlf.data.railsChapter.set_number,played_status:status,alley_id:APP.server.alley_id};APP.fns.doOldCall("/setMatchSetStatus",data,(function(r){}),(function(e){APP.nlf.rails.log(e)}),!0)}catch(e){}},this.updateMatchStatus=function(status,callback){try{var data={season_status:APP.nlf.data.league.season_status,league_match_id:APP.nlf.data.railsMatch.league_match_id,status:status,alley_id:APP.server.alley_id};APP.fns.doOldCall("/setMatchStatus",data,(function(r){callback&&callback()}),(function(e){APP.nlf.rails.log(e),callback&&callback()}),!0)}catch(e){}},this.saveCompleteLocal=function(scoreOverride){var uniqueId=this.getUniqueId();if(uniqueId&&this.data.railsChapter){var setId=this.data.railsChapter.set_id,completedArr=this.parent.getLocal(uniqueId,"completed");-1==completedArr&&(completedArr=[]),-1===completedArr.indexOf(setId)&&(completedArr.push(setId),this.parent.setLocal(uniqueId,"completed",completedArr));var matchScore=APP.session.getMatchScore();scoreOverride&&(matchScore=scoreOverride),0==matchScore[0]&&0==matchScore[1]||this.parent.setLocal(uniqueId,setId,matchScore)}},this.markMatchStatus=function(complete){var uniqueId=this.getUniqueId();complete?this.parent.setLocal(uniqueId,"matchComplete",!0):this.parent.removeLocal(uniqueId,"matchComplete")},this.checkGameLevelSettings=function(selectedId){try{if(!APP.nlf.data.rails)return;var id=selectedId.split("-")[2],selectedGame=APP.nlf.data.railsGameMenu[id],sess=APP.session,mf=APP.getMatch().format;if(mf.sudden_death=null,mf.dynamic_handicapping=null,sess.store(sess.current_match),!selectedGame)return;this.checkSuddenDeath(selectedGame),this.checkDynamicHandicapping(selectedGame)}catch(e){this.log("checkForGameLevelSettings has crashed")}},this.checkSuddenDeath=function(selectedGame){try{if(selectedGame.sudden_death&&"Y"==selectedGame.sudden_death){if(!selectedGame.sudden_death_round)return;var sess=APP.session,mf=APP.getMatch().format;mf.sudden_death={active:"Y",round:selectedGame.sudden_death_round,type:"RAILS"},selectedGame.sudden_death_instructions&&(mf.sudden_death.instructions=selectedGame.sudden_death_instructions),sess.store(sess.current_match)}}catch(e){this.log("checkSuddenDeath has crashed")}},this.checkDynamicHandicapping=function(selectedGame){try{var handicapping=!1;if(selectedGame.dynamic_handicapping&&("Y"==selectedGame.dynamic_handicapping&&(handicapping="dynamic"),"S"==selectedGame.dynamic_handicapping&&(handicapping="standard")),handicapping){var sess=APP.session,mf=APP.getMatch().format;"dynamic"==handicapping&&(mf.dynamic_handicapping="Y"),"standard"==handicapping&&(mf.dynamic_handicapping="S"),sess.store(sess.current_match),APP.user_options.auto_balance=!0,APP.storeUserOptions()}else APP.user_options.auto_balance=!1,APP.storeUserOptions()}catch(e){this.log("checkDynamicHandicapping has crashed")}},this.canChangePlayersMidSet=function(){try{this.data.rails&&this.data.railsChapter&&this.data.railsChapter.player_format&&this.data.railsChapter.player_format}catch(e){}return!1},this.isValidLineUp=function(teamArr){var correctSize;try{if(this.data.rails&&this.data.railsChapter&&this.data.railsChapter.player_format)switch(this.data.railsChapter.player_format){case"singles":return correctSize=1,this.buildValidLineUpInfo(correctSize,teamArr);case"doubles":return correctSize=2,this.buildValidLineUpInfo(correctSize,teamArr);case"triples":return correctSize=3,this.buildValidLineUpInfo(correctSize,teamArr);case"quads":return correctSize=4,this.buildValidLineUpInfo(correctSize,teamArr);case"team":case"varies":return{success:!0}}}catch(e){}return{success:!0}},this.autoBullShoot=function(){var data=this.data;this.log("Attempt auto bullshoot");try{if(data.rails&&"FIRST"==APP.zanis.simpleLegCheck()){var transFormat=data.railsTransFormat;if(!transFormat||!transFormat.instructions||!transFormat.instructions.first_leg)return void this.log("Can't set Starter");var starter=-1;switch(transFormat.instructions.first_leg){case"HOME_STARTS":this.log("Setting Home as Starter"),starter=0;break;case"AWAY_STARTS":this.log("Setting Away as Starter"),starter=1;break;case"RANDOM":this.log("Setting Random Starter"),starter=Math.floor(2*Math.random());break;default:this.log("No instruction for Starter")}-1!=starter&&APP.game.setBullShootWinner(starter,!1)}}catch(e){}},this.gameMenu={scope:this,getOptions:function(){if(!this.scope.data)return!1;if(!this.scope.data.rails)return!1;var obj={isOrdered:!1,isChicago:!1,decidingLeg:!1};try{var railsChapter=this.scope.data.railsChapter;if(!railsChapter)return!1;railsChapter.game_menu_ordered&&"Y"==railsChapter.game_menu_ordered&&(obj.isOrdered=!0),railsChapter.game_menu_chicago&&"Y"==railsChapter.game_menu_chicago&&(obj.isChicago=!0),railsChapter.game_menu_chicago&&"Y"==railsChapter.deciding_leg_open&&(obj.decidingLeg=!0)}catch(e){}return obj},setOrder:function(gameArr){var i,hasError=!1;try{for(i=0;i<gameArr.length;i++)gameArr[i].game_order_disabled=!1;var loopStart=APP.session.getLegsCount()%gameArr.length;for(i=0;i<gameArr.length;i++)gameArr[i].game_order_disabled=i!=loopStart}catch(e){hasError=!0}if(hasError&&gameArr)for(i=0;i<gameArr.length;i++)gameArr[i].game_order_disabled=!1;return gameArr},setChicago:function(gameArr){var i,k,game,playedGame,hasError=!1;try{for(i=0;i<gameArr.length;i++)(game=gameArr[i]).game_order_disabled=!1;var playedGamesArr=[],playedGames=APP.getMatch().sets[0].games;if(!playedGames||!playedGames.length)return gameArr;for(i=0;i<playedGames.length;i++)(playedGame=playedGames[i]).options&&playedGame.options.label&&playedGamesArr.push(playedGame.options.label);var lastLoopPlayed=playedGamesArr.length%gameArr.length;for(i=playedGamesArr.length-lastLoopPlayed;i<playedGamesArr.length;i++)for(playedGame=playedGamesArr[i],k=0;k<gameArr.length;k++)(game=gameArr[k]).label===playedGame&&(game.game_order_disabled=!0)}catch(e){hasError=!0}if(hasError&&gameArr)for(i=0;i<gameArr.length;i++)(game=gameArr[i]).game_order_disabled=!1;return gameArr},allowAll:function(gameArr){var i;try{for(i=0;i<gameArr.length;i++)gameArr[i].game_order_disabled=!1}catch(e){}return gameArr}},this.autoGameSelect=function(){this.log("Attempt auto game select");try{var te=APP.session.getGameSelector();te&&1==te.length&&APP.session.handleGameSelector("lgs-game-0")}catch(e){}},this.buildValidLineUpInfo=function(correctSize,teamArr){var hasError=!1,errorMsg="",homeBlock=!1,awayBlock=!1,msgTitle=!1;try{if(this.playerRails.isPlayerRails()){var playerRailsObj=this.playerRails.getPlayerRailsObj();playerRailsObj&&playerRailsObj.allowShortOptions&&!0}}catch(e){}var errorType=0;switch(correctSize){case 1:msgTitle="This is a Singles set";break;case 2:msgTitle="This is a Doubles set";break;case 3:msgTitle="This is a Triples set";break;case 4:msgTitle="This is a Quads set"}try{return teamArr[0]!==correctSize?(hasError=!0,teamArr[0]<correctSize?(errorMsg+=`\n\t\t\t\t\t\t<p style="font-size: 1em;">\n\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.home_label}</span><br />\n\t\t\t\t\t\t\t<span class="text-red"><span class="bold">${teamArr[0]} of ${correctSize}</span> - missing player(s)</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`,errorType=teamArr[0]?2:1):(homeBlock=!0,errorMsg+=`\n\t\t\t\t\t\t<p style="font-size: 1em;">\n\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.home_label}</span><br />\n\t\t\t\t\t\t\t<span class="text-red"><span class="bold">${teamArr[0]} of ${correctSize}</span> - too many players</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`)):errorMsg+=`\n\t\t\t\t\t<p style="font-size: 1em;">\n\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.home_label}</span><br />\n\t\t\t\t\t\t<span>${teamArr[0]} player(s)</span>\n\t\t\t\t\t</p>\n\t\t\t\t`,teamArr[1]!==correctSize?(hasError=!0,teamArr[1]<correctSize?(errorMsg+=`\n\t\t\t\t\t\t<p style="font-size: 1em; margin-top: 1em;">\n\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.away_label}</span><br />\n\t\t\t\t\t\t\t<span class="text-red"><span class="bold">${teamArr[1]} of ${correctSize}</span> - missing player(s)</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`,errorType=errorType?3:teamArr[1]?2:1):(awayBlock=!0,errorMsg+=`\n\t\t\t\t\t\t<p style="font-size: 1em; margin-top: 1em;">\n\t\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.away_label}</span><br />\n\t\t\t\t\t\t\t<span class="text-red"><span class="bold">${teamArr[1]} of ${correctSize}</span> - too many players</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t`)):errorMsg+=`\n\t\t\t\t\t<p style="font-size: 1em; margin-top: 1em;">\n\t\t\t\t\t\t<span class="bold">${APP.nlf.data.railsMatch.away_label}</span><br />\n\t\t\t\t\t\t<span>${teamArr[1]} player(s)</span>\n\t\t\t\t\t</p>\n\t\t\t\t`,hasError?{success:!1,errorMsg:errorMsg,title:msgTitle,homeBlock:homeBlock,awayBlock:awayBlock,errorType:errorType}:{success:!0}}catch(e){}return{success:!0}},this.railsPracticeEnabled=function(in_league){try{if(in_league.match_format_style&&"AMB"==in_league.match_format_style){var myMs=in_league.match_settings;if(myMs&&myMs.allow_practice_matches)return!0}}catch(e){}return!1},this.checkMissingRailsFormat=function(in_league){try{if(in_league.match_format_style&&"AMB"==in_league.match_format_style){var myMs=in_league.match_settings;if(myMs){if(myMs.settings_status&&"MISSING_SCHEDULE"==myMs.settings_status)return{missing:!0,type:"schedule"};if(myMs.settings_status&&"MISSING_FORMAT"==myMs.settings_status)return{missing:!0,type:"format"}}}}catch(e){}return{missing:!1}},this.injections={eom:function(){$("#seo-set-inner-box").removeClass("seo-eom-color").addClass("seo-eos-color");APP.fns.replaceText("#bb-eg-end","Match","Set"),APP.fns.replaceText("#pss-score","Match","Set"),$("#seo-sb-match-end").addClass("button-green").removeClass("button-death-star").removeClass("text-gold").text("Continue"),$("#seo-sb-set-label").html("-");var matchScore=APP.session.getMatchScore();matchScore&&($("#seo-sb-set-score-0").text(matchScore[0]),$("#seo-sb-set-score-1").text(matchScore[1])),$("#seo-set-control").text("Cancel"),$("#seo-sb-edit-points").hide(),$("#set-control-wrapper").hide(),$("#seo-auto-save-message").hide()},pss:function(){},selectPlayers:function(){APP.nlf.rails.checkWdfRules()&&(APP.nlf.data.railsChapter&&APP.nlf.data.railsChapter.set_number)},bullshoot:function(){unsetButton("bs-set-format"),unsetButton("bs-points-format");try{var chapter=APP.nlf.data.railsChapter;chapter&&chapter.game_menu&&1==chapter.game_menu.length&&unsetButton("bs-game-info")}catch(e){}function unsetButton(in_id){$("#"+in_id).removeClass("button").css("border","unset").css("background-image","unset")}},showGameSelector:function(){}},this.automaticUpdate=function(){},this.launchMatchReport=function(){var url,matchId=APP.nlf.data.railsMatch.league_match_id,seasonStatus=APP.nlf.data.league.season_status;switch(APP.location){case"live":url="https://recap.dartconnect.com/league-matches/"+matchId+seasonStatus;break;case"test":url="https://testrecap.dartconnect.red/league-matches/"+matchId+seasonStatus;break;case"train":url="https://train.recap.dartconnect.com/league-matches/"+matchId+seasonStatus;break;case"dev":url="https://dev.recap.dartconnect.com/league-matches/"+matchId+seasonStatus}APP.showIframePopOver(url,"Match Recap")},this.earlySetExit=function(){try{if(0==APP.session.getLegsCount()){var ms=APP.session.getMatchScore();0==ms[0]&&0==ms[1]&&(APP.nlf.data.railsReturn.earlyExit=!0,APP.game_master&&(this.data.railsReturn.game_master=APP.game_master),APP.nlf.save())}}catch(e){}},this.exitSet=function(){if(APP.game_master)try{APP.nlf.data.railsReturn.game_master=APP.game_master,APP.nlf.save()}catch(e){blockerErrorReport("Rails Exit Error Bug | Practice Group?",e.message)}APP.flushSettings(),APP.changeMode("PRE-ROLE"),APP.session.startNew("BASIC GAME"),APP.message_bar.turnOffPromo(),BBAT.storeData({keep_alley_open:!0,alley_id:APP.server.alley_id,is_hosting:APP.device.is_hosting,is_broadcasting:APP.device.is_broadcasting,participant_device_key:APP.server.participant_device_key,spectator_device_key:APP.server.spectator_device_key}),APP.reload()},this.closeMatch=function(){APP.device.is_broadcasting&&APP.server.postBroadcast({other_data:{match_over:!0}})},this.exitAlleyRails=function(){APP.session.startNew("BASIC GAME"),APP.device.showSpinnerOverlay(),APP.server.alley_id?APP.server.closeAlley({success:function(){APP.device.hideSpinnerOverlay(),APP.nlf.exit()},error:function(){APP.device.hideSpinnerOverlay(),APP.nlf.exit()}}):(APP.device.hideSpinnerOverlay(),APP.nlf.exit())},this.getRailsMatchData=function(forceUpdate,liveScores){var liveMatchData;try{if(this.data.rails){if(!forceUpdate&&this.data.railsScore&&this.data.railsScore.loaded)return this.data.railsScore;this.log("running rails match data");var uniqueId=this.getUniqueId(),railsScore=APP.nlf.getLocal(uniqueId,"matchScore");-1!==railsScore?(this.log("updating rails match data"),railsScore.home&&(this.data.railsScore.home_set_wins=railsScore.home.set_wins,this.data.railsScore.home_match_points=railsScore.home.league_points),railsScore.away&&(this.data.railsScore.away_set_wins=railsScore.away.set_wins,this.data.railsScore.away_match_points=railsScore.away.league_points),this.data.railsScore.loaded=!0,APP.nlf.save()):(this.data.railsScore.home_match_points=0,this.data.railsScore.away_match_points=0),liveScores&&(liveMatchData=this.getLiveRailsMatchData())&&(this.data.railsScore.home_match_points+=liveMatchData.home,this.data.railsScore.away_match_points+=liveMatchData.away);var obj=this.data.railsScore;return obj.season_status=this.data.league.season_status,obj.match_format_style=this.data.league.match_format_style,obj}}catch(e){}return!1},this.getLiveRailsMatchData=function(){try{if(this.data.railsFormat){var pointsStyle=this.data.railsFormat.points_style,ms=APP.session.getMatchScore(),scoreObj={home:0,away:0};switch(pointsStyle){case"PER-LEG":scoreObj.home=ms[0],scoreObj.away=ms[1]}return scoreObj}}catch(e){}return!1},this.saveOnlineState=function(){var alleyId=APP.server.alley_id,hasChalk=APP.device.has_chalk,participantDeviceKey=APP.server.participant_device_key,spectatorDeviceKey=APP.server.spectator_device_key,isBroadcasting=APP.device.is_broadcasting,isHosting=APP.device.is_hosting;APP.flushState(),APP.flushSettings(),BBAT.flushData("no_player_warning"),alleyId&&BBAT.storeData({keep_alley_open:!0,alley_id:alleyId,has_chalk:hasChalk,participant_device_key:participantDeviceKey,spectator_device_key:spectatorDeviceKey,is_hosting:isHosting,is_broadcasting:isBroadcasting})},this.isAlternateSets=function(){try{var oppoStart=this.data.league.match_settings.opponent_start;if("ALTERNATE"===oppoStart)return!0;if("ALTERNATE_BULL_DECIDING"===oppoStart)return!0}catch(e){}return!1},this.isAlternateSetsBullDeciding=function(){try{if("ALTERNATE_BULL_DECIDING"===this.data.league.match_settings.opponent_start)return!0}catch(e){}return!1},this.isDecidingAlternateSet=function(i,setLength){var returnObj={isActive:!1,isDeciding:!1,isTriggered:!1};try{if(!this.isAlternateSetsBullDeciding())return returnObj;if(i==setLength-1){var scores=this.calculateMatchScore(),homeScore=scores.home.league_points,awayScore=scores.away.league_points;if(returnObj.isDeciding=!0,scores.sets_played==scores.total_sets-1)return returnObj.isActive=!0,returnObj.isTriggered=homeScore===awayScore,returnObj}}catch(e){}return returnObj},this.setAlternateSets=function(in_index){if("number"==typeof in_index){var starter,uniqueId=this.getUniqueId(),setNumber=APP.nlf.data.railsChapter.set_number;starter=BBAT.isEven(setNumber)?in_index?"home":"away":in_index?"away":"home",APP.nlf.setLocal(uniqueId,"alternateSets",starter)}},this.getAlternateSets=function(){var uniqueId=this.getUniqueId(),starter=APP.nlf.getLocal(uniqueId,"alternateSets");return-1!=starter&&starter},this.getAlternateSetsStarterVal=function(setId){var uniqueId=this.getUniqueId(),starter=APP.nlf.getLocal(uniqueId,"alternateSets"),isEven=BBAT.isEven(setId);return"home"==starter?isEven?1:0:isEven?0:1},this.reloadOnlineState=function(){},this.confirmRetryBroadcast=function(){APP.confirm.show({title:"Unable to Broadcast",msg:"We couldn't to the DartConnect Server. Your match will not be broadcast on DCTV. Would you like us to automatically retry to broadcast in the background?",ok:function(){APP.nlf.data.railsRetry=!0,APP.nlf.save()},cancel:function(){APP.nlf.data.railsRetry=!1,APP.nlf.save()}})},this.retryBroadcast=function(){try{if(APP.device.is_broadcasting)return;if("PARTICIPANT"==APP.device.role)return;if(APP.device.is_hosting)return;var data=this.data;if(!data.rails)return!1;if(!data.railsRetry)return!1;var in_params={no_spinner:!0,requesting_broadcast:!0,callback:function(r){"FAILED"==r?window.setTimeout((function(){APP.nlf.rails.retryBroadcast()}),2e3):(APP.game_master="DEVICE",APP.device.role="HOST",APP.server.startTimer("SEND"),APP.device.has_chalk=!0,APP.device.is_broadcasting=!0,APP.storeState(),APP.setConnectMenuControls(),APP.reveal.updateDCTVKey(),APP.message_bar.promo.active&&APP.session.isNewMatch()&&APP.message_bar.showPromo(null,null,null,!1,!0),APP.game.started&&APP.game.initGameBroadcast())}};APP.server.openAlley(in_params)}catch(e){}},this.forcePlayerSelect=function(){try{if(APP.nlf.data.rails&&"each-leg"==APP.nlf.data.railsChapter.player_format)return!0}catch(e){}return!1},this.wdfTournaments=["austriamaltasingles","austriamaltapairs","austriamaltateams"],this.tieBreaker={scope:this,inited:!1,hasTiebreaker:!1,tieBreakerActive:!1,tieBreakerComplete:!1,tieBreakerScore:{home:0,away:0},reset:function(){this.inited=!1,this.hasTiebreaker=!1,this.tieBreakerActive=!1,this.tieBreakerComplete=!1,this.tieBreakerScore.home=0,this.tieBreakerScore.away=0},init:function(){this.reset();try{this.inited||(this.hasTiebreaker=this.checkTiebreaker(),this.inited=!0,this.hasTiebreaker&&this.checkTiebreakerActive())}catch(e){this.scope.log("tiebreaker init error: "+e.message,!0),this.inited=!1}},checkTiebreaker:function(){var railsFormat=APP.nlf.data.railsFormat;return!!railsFormat&&(!!railsFormat.tiebreaker_segment&&"Y"==APP.nlf.data.railsFormat.tiebreaker_segment)},checkTiebreakerActive:function(){var i,set,settings=APP.session.getLeagueDefinition(this.scope.data.league),sets=(settings=settings.match_settings).sets;if(!Array.isArray(sets))try{APP.nlf.data.league.match_settings.sets&&(sets=APP.nlf.data.league.match_settings.sets)}catch(e){return!1}var matchScore={points_style:settings.points_style,bonus_points:settings.bonus_points,bonus_points_win:settings.bonus_points_win,bonus_points_sweep:settings.bonus_points_sweep,sweep_requirement:settings.sweep_requirement,match_complete:!1,home:{set_wins:0,league_points:0},away:{set_wins:0,league_points:0},sets_played:0},tieBreakerSets=[],noneTiebreakerSets=[];for(i=0;i<sets.length;i++)"Y"!=(set=sets[i]).tiebreaker?noneTiebreakerSets.push(set):tieBreakerSets.push(set);for(i=0;i<noneTiebreakerSets.length;i++){var setId=(set=noneTiebreakerSets[i]).set_id;if("Y"!=set.tiebreaker){var uniqueId=this.scope.getUniqueId(),localScore=this.scope.parent.getLocal(uniqueId,setId);if(-1!==localScore)matchScore=this.scope.doSetScoreCalculation(0,localScore,set,matchScore),(matchScore=this.scope.doSetScoreCalculation(1,localScore,set,matchScore)).sets_played++;else if(this.scope.data.railsMatch&&this.scope.data.railsMatch.chapter_status){var chapterArr=APP.nlf.data.railsMatch.chapter_status,mySet=APP.findInObjArray("set_id",chapterArr,set.set_id)[0];mySet&&(mySet.home_score||mySet.away_score)&&(localScore=[mySet.home_score,mySet.away_score],matchScore=this.scope.doSetScoreCalculation(0,localScore,mySet,matchScore),(matchScore=this.scope.doSetScoreCalculation(1,localScore,mySet,matchScore)).sets_played++)}}}if(noneTiebreakerSets.length===matchScore.sets_played)return matchScore.home.league_points==matchScore.away.league_points?(this.tieBreakerActive=!0,void this.checkTiebreakerComplete(tieBreakerSets)):void 0;this.tieBreakerActive=!1},checkTiebreakerComplete:function(tieBreakerSets){var settings=APP.session.getLeagueDefinition(this.scope.data.league);if(!(settings=settings.match_settings)||!settings.sets)return!1;for(var tieBreakerLength=tieBreakerSets.length,maxLegs=Math.round(tieBreakerLength/2),matchScore={match_complete:!1,home:{set_wins:0},away:{set_wins:0},sets_played:0},i=0;i<tieBreakerSets.length;i++){var set=tieBreakerSets[i],setId=set.set_id,uniqueId=this.scope.getUniqueId(),localScore=this.scope.parent.getLocal(uniqueId,setId);if(-1!==localScore)matchScore=this.scope.doSetScoreCalculation(0,localScore,set,matchScore),(matchScore=this.scope.doSetScoreCalculation(1,localScore,set,matchScore)).sets_played++;else if(this.scope.data.railsMatch&&this.scope.data.railsMatch.chapter_status){var chapterArr=APP.nlf.data.railsMatch.chapter_status,mySet=APP.findInObjArray("set_id",chapterArr,set.set_id)[0];mySet&&(mySet.home_score||mySet.away_score)&&(localScore=[mySet.home_score,mySet.away_score],matchScore=this.scope.doSetScoreCalculation(0,localScore,mySet,matchScore),(matchScore=this.scope.doSetScoreCalculation(1,localScore,mySet,matchScore)).sets_played++)}}matchScore.home.set_wins>=maxLegs&&(matchScore.match_complete=!0,this.tieBreakerComplete=!0,this.tieBreakerScore.home=1),matchScore.away.set_wins>=maxLegs&&(matchScore.match_complete=!0,this.tieBreakerComplete=!0,this.tieBreakerScore.away=1)},checkSetIsTiebreaker:function(setId){var format=_this.data.railsFormat;try{var i,set,sets=format.sets;if(!sets)return returnObj;for(i=0;i<sets.length;i++)if((set=sets[i]).set_id==setId)return"Y"==set.tiebreaker}catch(e){}return!1}},this.breaks={scope:this,inited:!1,breakArr:[],reset:function(){this.inited=!1,this.breakArr=[]},init:function(){this.reset();try{this.inited||(this.calculateBreaks(),this.inited=!0)}catch(e){this.scope.log("breaks init error: "+e.message,!0),this.inited=!1}},calculateBreaks:function(){for(var sets=this.scope.data.railsFormat.sets,i=0;i<sets.length;i++){var set=sets[i];set.break_after_segment&&"Y"==set.break_after_segment&&-1==this.breakArr.indexOf(set.segment_number)&&this.breakArr.push(set.segment_number),set.tiebreaker&&"Y"==set.tiebreaker&&-1==this.breakArr.indexOf(set.segment_number)&&this.breakArr.push(set.segment_number)}},hasBreaks:function(segmentId){if(this.inited||this.init(),!segmentId)return this.breakArr.length>0;try{if(-1!==this.breakArr.indexOf(segmentId))return!0}catch(e){this.scope.log("hasBreaks error: "+e.message,!0)}return!1},checkBreakSeen:function(segmentId){var uniqueId=this.scope.getUniqueId(),breakSeen=this.scope.parent.getLocal(uniqueId,"breakSeen");return breakSeenArr=-1!==breakSeen?breakSeen:[],-1!==breakSeenArr.indexOf(segmentId)},markBreakSeen:function(segmentId){var uniqueId=this.scope.getUniqueId(),breakSeen=this.scope.parent.getLocal(uniqueId,"breakSeen");breakSeenArr=-1!==breakSeen?breakSeen:[],-1==breakSeenArr.indexOf(segmentId)&&breakSeenArr.push(segmentId),this.scope.parent.setLocal(uniqueId,"breakSeen",breakSeenArr)},checkShowBreak:function(returnSegmentId){for(var sets=APP.nlf.data.railsFormat.sets,i=0;i<sets.length;i++){var set=sets[i],segmentId=set.segment_number;if(-1!=this.breakArr.indexOf(segmentId)&&!this.checkBreakSeen(segmentId)){if(set.tiebreaker&&"Y"==set.tiebreaker){if(!this.scope.tieBreaker.tieBreakerActive)continue;if(!this.checkShowBreakSegment(segmentId))return!returnSegmentId||segmentId}if(this.checkShowBreakSegment(segmentId))return!returnSegmentId||segmentId}}return!1},checkShowBreakSegment:function(segmentId){for(var match=this.scope.data.railsMatch,sets=APP.nlf.data.railsFormat.sets,allMatchesPlayed=!0,i=0;i<sets.length;i++){var set=sets[i];if(set.segment_number===segmentId){var setId=set.set_id;"PLAYED"!=this.scope.getChapterStatus(match.chapter_status,setId)&&(allMatchesPlayed=!1)}}return allMatchesPlayed},isTieBreakerBreak:function(){var blocker=APP.nlf.rails.breaks.checkShowBreak(!0);if("number"==typeof blocker)for(var settings=APP.session.getLeagueDefinition(APP.nlf.data.league),sets=(settings=settings.match_settings).sets,i=0;i<sets.length;i++){var set=sets[i];if(set.segment_number==blocker&&"Y"==set.tiebreaker)return!0}return!1},buildBreakDisplay:function(){return`\n\t\t\t\t<div id="matchbreak-info" class="highlight-box primary-grad button">\n\t\t\t\t\t<h4 class="noMargin">Match Break Notice</h4>\n\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\tThis match has completed <span class="bold">${this.scope.matchScore.sets_played}</span> of <span class="bold">${this.scope.matchScore.total_sets}</span> possible sets with a score of <span class="bold">${this.scope.matchScore.home.set_wins+"-"+this.scope.matchScore.away.set_wins}</span>.\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<p class="mMdTop bold text-gold">\n\t\t\t\t\t\tLeague rules recommend suspending this match and resuming it on a future date.\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<table class="button-table mLgTop">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div class="button-gray button-md button round-corners" id="rails-suspend-match">\n\t\t\t\t\t\t\t\t\t\tSuspend Match\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td width="50%">\n\t\t\t\t\t\t\t\t\t<div class="button button-md button-green round-corners" id="rails-resume-match">\n\t\t\t\t\t\t\t\t\t\tContinue Match\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t`},buildTieBreakerBreakDisplay:function(){return`\n\t\t\t\t<div id="matchbreak-info" class="highlight-box primary-grad button">\n\t\t\t\t\t<h4 class="noMargin">Tiebreaker Required</h4>\n\t\t\t\t\t<p class="mMdTop">\n\t\t\t\t\t\tThis match has resulted in a tie. ${APP.nlf.data.league.shortname} requires teams to determine a winner by playing a special tie-breaker Match.\n\t\t\t\t\t</p>\n\n\t\t\t\t\t<table class="button-table mLgTop">\n\t\t\t\t\t\t<tbody>\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t\t<div class="button button-md button-green round-corners" id="rails-resume-match">\n\t\t\t\t\t\t\t\t\t\tPlay Tiebreaker\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</tbody>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t`},continueMatch:function(){var blocker=APP.nlf.rails.breaks.checkShowBreak(!0);"number"==typeof blocker&&APP.nlf.rails.breaks.markBreakSeen(blocker),APP.nlf.init(APP.nlf.data.mode)}},this.ff={scope:this,displayTeam:null,mode:null,id:null,selector:null,getTeamPlayers:function(){var leagueData=APP.nlf.data.league,leagueId=leagueData.league_division_guid;leagueId+="_",leagueId+=leagueData.season_status;var team,directory=BBAT.fetchData("directory_division_"+leagueId);return"home"==this.displayTeam?(team=APP.findInObjArray("team_guid",directory.teams,APP.nlf.data.homePlayer)[0])?team.players:[]:(team=APP.findInObjArray("team_guid",directory.teams,APP.nlf.data.awayPlayer)[0])?team.players:[]},buildPlayerList:function(){if((players=this.getTeamPlayers()).length){for(var spices=[],i=0;i<players.length;i++){var player=players[i],content=`\n\t\t\t\t\t<span class="bold">${player.last_name}</span><br />\n\t\t\t\t\t${player.first_name}\n\t\t\t\t`;spices.push({content:content,class:"button-lg round-corners button-white",name:player.player_guid})}if(spices.push({content:"No Players",class:"round-corners button-white button-ps-full-width bold text-red",name:-1}),spices.length){var instructions=this.scope.createRailsInstructions(),max=!1,matchTypeText="";switch(instructions.player_format){case"singles":max=1,matchTypeText=this.scope.transLangFromPlatform(instructions.player_format);break;case"doubles":max=2,matchTypeText=this.scope.transLangFromPlatform(instructions.player_format);break;case"triples":max=3,matchTypeText=this.scope.transLangFromPlatform(instructions.player_format);break;case"quads":max=4,matchTypeText=this.scope.transLangFromPlatform(instructions.player_format)}matchTypeText?$("#rails-ff-match-type").html(`\n\t\t\t\t\t\t<h4 class="noMargin">(${matchTypeText})</h4>\n\t\t\t\t\t`):$("#rails-ff-match-type").empty();var preSelected=[];try{var playerRailsObj=APP.nlf.playerRails.getPlayerRailsObj();if("ready"==playerRailsObj[APP.nlf.rails.ff.displayTeam]){var players=[];if((players="away"==APP.nlf.rails.ff.displayTeam?playerRailsObj.awayPlayers:playerRailsObj.homePlayers).length)for(var j=0;j<players.length;j++)preSelected.push("ss_ps_"+players[j].player_guid)}}catch(e){}this.selector=new SpiceSelector({id:"ps",ele:"#rails-ff",min:1,max:max,spices:spices,defaultClass:"button-white",highlightClass:"button-info",preSelected:preSelected,callbacks:{preInit:function(){},postInit:function(){},exit:function(self){},maxReached:function(self,selectedSpice){"ss_ps_-1"==selectedSpice&&(self.selectionArr=["ss_ps_-1"],self.forceUpdate())},selected:function(self,selectedSpice){if("ss_ps_-1"==selectedSpice&&(self.selectionArr=["ss_ps_-1"],self.forceUpdate(),$("#ss_ps_-1").addClass("text-white").removeClass("text-red")),"ss_ps_-1"!=selectedSpice){var index=self.selectionArr.indexOf("ss_ps_-1");index>-1&&(self.selectionArr.splice(index,1),self.forceUpdate())}},deselected:function(self,selectedSpice){"ss_ps_-1"==selectedSpice&&$("#ss_ps_-1").addClass("text-red").removeClass("text-white")},complete:function(self){$("#rails-do-ff").removeClass("button-disabled")},incomplete:function(self){$("#rails-do-ff").addClass("button-disabled")}}}),preSelected.length&&$("#rails-do-ff").removeClass("button-disabled")}}else{APP.alert.show("\n\t\t\t\t\t<h4>No Players Found</h4>\n\t\t\t\t\t<p>To create a Forfeit please start the match and select the Forfeit option from the player select menu</p>\n\t\t\t\t")}},init:function(){var introText="Select the player(s) who are awarded the WIN for this set";"win"==this.mode&&(introText="Select the player(s) who are awarded the WIN for this set"),$("#rails-ff-intro-text").text(introText),this.buildPlayerList()},handleFF:function(id,preflight){switch(id){case"rails-set-ff-home":if(!preflight)return void APP.confirm.show({title:"Confirm Forfeit",msg:`Are you sure you want to forfeit <span class="bold">${APP.nlf.data.railsMatch.home_label}</span> this set?`,ok:function(){APP.nlf.rails.ff.displayTeam="away",APP.nlf.rails.ff.mode="ff",APP.nlf.rails.ff.id=id,"SINGLES"==APP.nlf.data.league.league_type?APP.nlf.rails.ff.doFF():APP.nlf.displayPage(10)}});break;case"rails-set-ff-away":if(!preflight)return void APP.confirm.show({title:"Confirm Forfeit",msg:`Are you sure you want to forfeit <span class="bold">${APP.nlf.data.railsMatch.away_label}</span> this set?`,ok:function(){APP.nlf.rails.ff.displayTeam="home",APP.nlf.rails.ff.mode="ff",APP.nlf.rails.ff.id=id,"SINGLES"==APP.nlf.data.league.league_type?APP.nlf.rails.ff.doFF():APP.nlf.displayPage(10)}});break;case"rails-set-ff-both":if(!preflight)return void APP.confirm.show({title:"Confirm Forfeit",msg:'Are you sure you want to forfeit <span class="bold">both opponent</span> this set?',ok:function(){APP.nlf.rails.ff.displayTeam=null,APP.nlf.rails.ff.mode=null,APP.nlf.rails.ff.id=id,APP.nlf.rails.ff.doFF()}});break;case"rails-set-win-home":if(!preflight)return void APP.confirm.show({title:"Confirm Win",msg:`Are you sure you want to award <span class="bold">${APP.nlf.data.railsMatch.home_label}</span> a win for this set?`,ok:function(){APP.nlf.rails.ff.displayTeam="home",APP.nlf.rails.ff.mode="win",APP.nlf.rails.ff.id=id,"SINGLES"==APP.nlf.data.league.league_type?APP.nlf.rails.ff.doFF():APP.nlf.displayPage(10)}});break;case"rails-set-win-away":if(!preflight)return void APP.confirm.show({title:"Confirm Win",msg:`Are you sure you want to award <span class="bold">${APP.nlf.data.railsMatch.away_label}</span> a win for this set?`,ok:function(){APP.nlf.rails.ff.displayTeam="away",APP.nlf.rails.ff.mode="win",APP.nlf.rails.ff.id=id,"SINGLES"==APP.nlf.data.league.league_type?APP.nlf.rails.ff.doFF():APP.nlf.displayPage(10)}})}},doFF:function(){var id=APP.nlf.rails.ff.id;if(id){var idSplit=id.split("-");if(type=idSplit[2],team=idSplit[3],type&&"undefined"!=typeof team){switch(team){case"home":team=0;break;case"away":team=1;break;case"both":team="b"}switch(type){case"ff":"forfeit";break;case"win":"setwin"}APP.nlf.rails.isForfeit=!0,APP.nlf.rails.startMatch(!1,(function(){APP.nlf.displayPage(11),APP.device.hideSpinnerOverlay();var sess=APP.session;"SINGLES"!=APP.nlf.data.league.league_type&&APP.header.recordOpponentChange(!0);var lbl,plyrs=[[],[]];if("TEAM"==APP.session.getMatchMode())for(var oi=0;oi<2;oi++){var oppo=APP.game.opponent[oi];if(!oppo.is_default&&oppo.team.players.length>0)for(var plst=oppo.team.players,plen=plst.length,pi=0;pi<plen;pi++)"Pfiller"!=plst[pi].obj_id&&(plyrs[oi][pi]={first_name:plst[pi].first_name,last_name:plst[pi].last_name,email:plst[pi].email,player_guid:plst[pi].player_guid})}"b"!=team&&(team=parseInt(team,10),lbl=APP.game.opponent[team].chalkboard_name,"TEAM"==APP.session.getMatchMode()&&!APP.game.opponent[team].is_default&&APP.game.opponent[team].team.players.length>0&&(lbl=APP.game.opponent[team].getTeamPlayerNames()));var cm=sess.matches[sess.current_match],cs=cm.sets[sess.current_set],msg="Set #"+(sess.current_set+(cs.games.length?2:1))+": ",lf=String.fromCharCode(13);cm=sess.matches[sess.current_match],sess.addSet(),(cs=cm.sets[sess.current_set]).forfeited=!0,cs.forfeit_time=new Date,"ff"==type?(cs.forfeit_type="FORFEIT","b"!=team?(msg+=lbl+" forfeited.",cs.wins[0==team?1:0]=1,cm.set_wins[0==team?1:0]++):msg+="Both Opponents forfeited."):(msg+=lbl+" won.",cs.forfeit_type="SET-WIN",cs.wins[team]=1,cm.set_wins[team]++),cs.forfeit_players=plyrs,cm.notes+=lf+msg,APP.nlf.rails.saveCompleteLocal(cm.set_wins),sess.setMatchDynamicInfo(cm),sess.store(sess.current_match),sess.buildSummary(),function(){APP.session.handleMatchScore("pms-confirm"),APP.session.handleMatchScore("pms-save");exitCallback=function(){APP.session.handleSummaryOption("pss-exit")};var timerVars={name:"newMatchTimer",runTime:2,callback:exitCallback,eachTick:function(){},debugMode:!0,forceClose:!0};new Timer(timerVars)}()}))}else APP.nlf.rails.log("this won't work, stupid")}else APP.nlf.rails.log("this won't work, stupid")}},this.manualMatch={selector:null,startBuilder:function(){var nlfTitle="Create Unscheduled Match",nlfWarning='\n\t\t\t\t<span class="bold text-red">Internet Connection Required</span><br /><br />\n\t\t\t\tOnly create a Unscheduled Match if you can\'t find your match in the match list.\n\t\t\t\t<br /><br />\n\t\t\t\t<span class="bold">Unscheduled matches must be approved by the league.</span>\n\t\t\t';APP.nlf.rails.isAdHocLeague()&&(nlfTitle="Create New League Match?",nlfWarning='\n\t\t\t\t\t<span class="bold text-red">Internet Connection Required</span><br /><br />\n\t\t\t\t\tPlease Select your Opponent for this match.\n\t\t\t\t'),APP.confirm.show({title:nlfTitle,msg:nlfWarning,ok_text:"Confirm",cancel_text:"Cancel",ok:function(){APP.nlf.displayPage(12)}})},init:function(){$("#rails-mm-intro-text").text("Select your Opponent"),this.buildPlayerList()},buildPlayerList:function(){var helperObj=APP.nlf.rails.getLeagueHelperObj();if(helperObj.oppoArr.length){this.selected=null;for(var spices=[],i=(helperObj.homeId,0);i<helperObj.oppoArr.length;i++){var oppo=helperObj.oppoArr[i],content=`\n\t\t\t\t\t${oppo.name}\n\t\t\t\t`;spices.push({content:content,class:"button button-white round-corners button-menu mMdBottom",name:oppo.id})}spices.length&&(this.selector=new SpiceSelector({id:"ps",ele:"#rails-mm",min:1,max:1,spices:spices,defaultClass:"button-white",highlightClass:"button-info",callbacks:{preInit:function(){},postInit:function(){},exit:function(self){},selected:function(self,selectedSpice){},deselected:function(self,selectedSpice){},complete:function(self){$("#rails-do-mm").removeClass("button-disabled")},incomplete:function(self){$("#rails-do-mm").addClass("button-disabled")}}}))}else{APP.alert.show("\n\t\t\t\t\t<h4>No Opponents Found</h4>\n\t\t\t\t\t<p>Please try again later</p>\n\t\t\t\t")}},createMatch:function(){var mm=APP.nlf.rails.manualMatch,oppo=mm.selector.returnSelected(),helperObj=APP.nlf.rails.getLeagueHelperObj();if(oppo&&Array.isArray(oppo)&&oppo.length&&(oppo=oppo[0]).name){var homeId=helperObj.homeId,seasonStatus=APP.nlf.data.league.season_status,data={season_id:APP.nlf.data.league.season_id,season_status:seasonStatus,home_id:homeId,away_id:oppo.name};APP.nlf.rails.isAdHocLeague()&&(data.ad_hoc_schedule_id=APP.nlf.data.league.ad_hoc_schedule_id);APP.device.showSpinnerOverlay(),APP.fns.doOldCall("/addScheduledMatch",data,mm.createSuccess,mm.createError)}},createSuccess:function(leagueMatchId){APP.nlf.updateLeagues((function(){APP.alert.show('\n\t\t\t\t\t<span class="bold">Match Successfully Created!</span><br />\n\t\t\t\t\tClick OK to start the match.\n\t\t\t\t',(function(){var matchId=leagueMatchId.league_match_id,helperObj=APP.nlf.rails.getLeagueHelperObj();helperObj.isProxy?APP.nlf.getScheduleServer(helperObj.homeId,(function(){APP.device.hideSpinnerOverlay(),window.setTimeout((function(){APP.nlf.rails.launchMatchById(matchId)}),100)}),APP.nlf.rails.createError):(APP.device.hideSpinnerOverlay(),APP.nlf.rails.launchMatchById(matchId))}))}))},createError:function(resp){APP.device.hideSpinnerOverlay(),APP.alert.show("Error creating match, please try again later")}},this.launchMatchById=function(id){try{var match=APP.findInObjArray("league_match_id",APP.nlf.data.league.league_schedule,id)[0];this.data.matchId=id,this.data.homePlayer=match.home_id,this.data.awayPlayer=match.away_id,this.data.rails=!0,this.parent.save(),this.launchRails()}catch(e){console.log(e),APP.alert.show("Error launching match, please try again later")}},this.checkWdfRules=function(single_event_id){try{var leagueId,tournaments=APP.nlf.rails.wdfTournaments;if(single_event_id)leagueId=single_event_id;else{if(!APP.nlf.data.league||!APP.nlf.data.league.league_id)return!1;leagueId=APP.nlf.data.league.league_id}if(-1!==tournaments.indexOf(leagueId))return!0}catch(e){}return!1},this.startPracticeMatch=function(btnId){var league,fakeMatch,data=_this.data,hasError=!1,errMsg="";try{var leagueId=btnId.split("-")[2];league=APP.findInObjArray("league_id",APP.user.league_associations,leagueId)[0];var divisionGuid=btnId.split("-")[3],division=APP.findInObjArray("league_division_guid",APP.user.league_associations,divisionGuid)[0];division&&(league=division),league||(hasError=!0,errMsg="Cannot create a Practice Match. Please contact your league administrator."),data.league=league}catch(e){hasError=!0,errMsg="There was an error loading the practice match. Please try again later.",APP.nlf.rails.logError(e.message,"loadPracticeMatch")}if(hasError)APP.alert.show(errMsg);else{var helperObj=APP.nlf.rails.getLeagueHelperObj();helperObj||(hasError=!0,errMsg="There was an error loading the practice match. Please try again later.");var isProxy=_this.parent.checkForProxy();if(isProxy&&!helperObj.homeId)return APP.nlf.data.railsPractice=!0,"TEAM"==isProxy?(APP.nlf.log("Proxy - Load Teams"),APP.nlf.displayPage(2),void APP.popup.hide("popup-league-menu")):(APP.nlf.log("Proxy - Load Singles"),APP.popup.hide("popup-league-menu"),void APP.nlf.displayPage(3));if(hasError)APP.alert.show(errMsg);else{var oppoArr=helperObj.oppoArr,oppo=oppoArr[Math.floor(Math.random()*oppoArr.length)],practiceId=data.league.league_id+"_PRACTICE",cMatch=APP.nlf.data.railsMatch;cMatch&&cMatch.practice_id?cMatch.practice_id:(fakeMatch={practice_id:practiceId,match_type:"scoring_app",league_match_id:-1,match_format_style:null,sched_date:(new Date).toISOString(),sched_time:"12:00",seq:1,round_label:null,extra_round:"N",home_label:helperObj.homeLabel,away_label:oppo.name,venue_label:"N/A",home_id:helperObj.homeId,away_id:oppo.id,venue_id:null,match_starter:0,venue_board_label:null,venue_board_label_abbrev:null,sched_match_start_time:"7:30 PM",status:"P",venue_board_sort_order:null,op0_league_points:null,op1_league_points:null,op0_score:null,op1_score:null,sched_start_month:1,sched_start_day:1,sched_start_year:2e3,sched_start_day_of_week:1,chapter_status:[]},_this.data.railsMatch=fakeMatch,cMatch=fakeMatch);var storedSets=!1;try{if(-1==_this.data.railsMatch.league_match_id){if(_this.data.league.league_guid!=league.league_guid)return;if(_this.data.league.season_status!=league.season_status)return;_this.data.railsFormat.sets&&(storedSets=_this.data.railsFormat.sets)}}catch(e){}_this.data.railsFormat=league.match_settings,storedSets&&(_this.data.railsFormat.sets=storedSets),_this.data.homePlayer=cMatch.home_id,_this.data.awayPlayer=cMatch.away_id,APP.popup.hide("popup-league-menu"),_this.data.rails=!0,_this.data.railsReturn={league_btn_id:btnId,league_id:league.league_id,match_id:-1,game_master:null},APP.nlf.data.railsPractice=!0,APP.nlf.data.railsPracticeId=league.league_id,_this.parent.checkForProxy()&&(data.railsReturn.selectedTeamId=_this.data.selectedTeamId,data.railsReturn.selectedTeamLabel=_this.data.selectedTeamLabel,data.railsReturn.selectedPlayerId=_this.data.selectedPlayerId,data.railsReturn.selectedPlayerLabel=_this.data.selectedPlayerLabel,data.railsReturn.leagueSchedule=_this.data.league.league_schedule),_this.parent.displayPage(5),APP.nlf.save()}}},this.wipePracticeMatch=function(){var seasonStatus="REG",data=this.data;data.league&&data.league.season_status&&(seasonStatus=data.league.season_status),this.parent.removeLocalRecord(seasonStatus+"--1")},this.isPracticeMatch=function(){var data=this.data;return!!data.rails&&!!data.railsPractice},this.isAdHocLeague=function(){try{var data=this.data;if(data.league&&data.league.ad_hoc)return!0}catch(e){}return!1},this.wdfRules={calculateStarter:function(setNumber){var newStarter=!1;if(APP.nlf.rails.checkWdfRules())try{var ogStart;APP.nlf.rails.getUniqueId();if(setNumber||(setNumber=APP.nlf.data.railsChapter.set_number),17==setNumber)return"CORK";if(APP.nlf.data.railsMatch){if("number"!=typeof APP.nlf.data.railsMatch.match_starter)return;ogStart=APP.nlf.data.railsMatch.match_starter}var originalStarter="home";ogStart&&(originalStarter="away"),newStarter=setNumber%2!=0?"home"==originalStarter?"HOME_STARTS":"AWAY_STARTS":"home"==originalStarter?"AWAY_STARTS":"HOME_STARTS"}catch(e){}return newStarter},getMatchUp:function(setNo){if(!setNo)return!1;var result=[[1,1],[2,2],[3,3],[4,4],[1,2],[2,3],[3,4],[4,1],[1,3],[2,4],[3,1],[4,2],[1,4],[2,1],[3,2],[4,3]][setNo-1];return result&&(result=result.reverse())||!1},getDoublesMatchUp:function(setNo){if(!setNo)return!1;var result=[[[1,2],[1,2]],[[3,4],[3,4]],[[3,4],[1,2]],[[1,2],[3,4]],[[1,3],[1,3]],[[2,4],[2,4]],[[2,4],[1,3]],[[1,3],[2,4]],[[1,4],[1,4]],[[2,3],[2,3]],[[2,3],[1,4]],[[1,4],[2,3]]][setNo-1];return result&&(result=result.reverse())||!1},getMatchPlayers:function(setNumber){var matchUp=this.getMatchUp(setNumber),playerLeft=matchUp[0],playerRight=matchUp[1],roster=APP.header.roster_left,playerList=APP.header.teams[roster.getTeamIndex()].players,homePlayer=APP.findInObjArray("wdf_rank",playerList,playerLeft)[0];return roster=APP.header.roster_right,playerList=APP.header.teams[roster.getTeamIndex()].players,[homePlayer,APP.findInObjArray("wdf_rank",playerList,playerRight)[0]]},getDoublesMatchPlayers:function(setNumber){var i,playerLeft,playerRight,homePlayer,roster,playerList,matchUp=this.getDoublesMatchUp(setNumber),homePlayerArr=[],awayPlayerArr=[],playerArrLeft=matchUp[0],playerArrRight=matchUp[1];for(roster=APP.header.roster_left,playerList=APP.header.teams[roster.getTeamIndex()].players,i=0;i<playerArrLeft.length;i++)playerLeft=playerArrLeft[i],(homePlayer=APP.findInObjArray("wdf_rank",playerList,playerLeft)[0])&&homePlayerArr.push(homePlayer);for(roster=APP.header.roster_right,playerList=APP.header.teams[roster.getTeamIndex()].players,i=0;i<playerArrRight.length;i++)playerRight=playerArrRight[i],awayPlayer=APP.findInObjArray("wdf_rank",playerList,playerRight)[0],awayPlayer&&awayPlayerArr.push(awayPlayer);return[homePlayerArr,awayPlayerArr]},applyWdfUserOptions:function(){var uo=APP.user_options;uo.auto_balance=!1,uo.fast_finish_flights=!0,uo.do_attempts=!1,uo.game_shot=!0,uo.notables=!1,APP.storeUserOptions()}},this.isTempTeamTournament=function(){var data=this.data;return!(!data.league||!data.league.league_audience||"GE"!=data.league.league_audience)},this.getTeamSizeText=function(teamSizeNumber){var railsTeamSize=!1;if(teamSizeNumber){switch(teamSizeNumber){case 1:case"1":railsTeamSize="Singles";break;case 2:case"2":railsTeamSize="Doubles";break;case 3:case"3":railsTeamSize="Triples";break;case 4:case"4":railsTeamSize="Quads"}return railsTeamSize}if(APP.nlf.data.rails){var set=APP.nlf.data.railsChapter;if(set&&set.player_format)switch(set.player_format){case"singles":railsTeamSize="Singles";break;case"doubles":railsTeamSize="Doubles";break;case"triples":railsTeamSize="Triples";break;case"quads":railsTeamSize="Quads"}}return railsTeamSize},this.filters={selector:null,filtersAvailable:function(){return!APP.nlf.rails.isSingles()},createQuickSelect:function(format){var filterObj={content:""};return filterObj.content='\n\t\t\t\t<h4 style="text-align: left">Quick Select</h4>\n\t\t\t\t<div class="grid-container">\n\t\t\t\t\t<div class="left-col-33">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid="rf-select-odd" \n\t\t\t\t\t\t\tclass="button-md button button-gray round-corners mSmRight mSmLeft"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tOdd Sets\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="left-col-33">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid="rf-select-even"\n\t\t\t\t\t\t\tclass="button-md button button-gray round-corners mSmRight mSmLeft"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tEven Sets\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="right-col-33">\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid="rf-reset-all"\n\t\t\t\t\t\t\tclass="button-md button button-red round-corners mSmRight mSmLeft"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tReset\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t',filterObj},getCurrentFilters:function(){var segArr;try{format=_this.data.railsFormat,sets=format.sets,segArr=_this.getSetSegmentArr(sets)}catch(e){}if(!segArr)return[];var filters=this.getData("filters");return filters.arr.length?this.compareMatchShape(segArr)?filters.arr:(this.resetFilters(),[]):[]},resetFilters:function(){this.clearData("arr"),APP.nlf.save()},applyFilters:function(){if(!this.selector)return _this.filters.resetFilters(),void APP.nlf.goBackFn();var selectedFilters=this.selector.returnSelected();if(selectedFilters.length){this.resetFilters();var i,filter,filters=[];for(i=0;i<selectedFilters.length;i++)filter=selectedFilters[i],filters.push(filter.name);this.setData("arr",filters),this.saveMatchShape(),APP.nlf.displayPage(18)}else APP.confirm.show({title:"Show All Sets?",msg:"You have not selected any sets. Do you want to show all sets?",ok:function(){_this.filters.resetFilters(),APP.nlf.goBackFn()}})},quickFilter:function(filter){var segArr=_this.getSetSegmentArr();if(segArr){var i,setList=[];for(i=0;i<segArr.length;i++){var sets=segArr[i].sets;setList=setList.concat(sets)}var filterList=[],spiceList=[];switch(filter){case"odd":for(i=0;i<setList.length;i++)set=setList[i],i%2==0&&(filterList.push(i+1),spiceList.push("ss_rf_"+(i+1)));this.setData("arr",filterList),APP.nlf.save(),this.selector.selectionArr=spiceList,this.selector.forceUpdate();break;case"even":for(i=0;i<setList.length;i++)set=setList[i],i%2!=0&&(filterList.push(i+1),spiceList.push("ss_rf_"+(i+1)));this.setData("arr",filterList),APP.nlf.save(),this.selector.selectionArr=spiceList,this.selector.forceUpdate();break;case"reset":this.resetFilters(),this.selector.selectionArr=[],this.selector.forceUpdate()}}},compareMatchShape:function(segArr){var i,matchShape=this.getData("matchShape");if(!matchShape)return!1;if(matchShape.length!=segArr.length)return!1;for(i=0;i<segArr.length;i++)if(segArr[i].sets.length!=matchShape[i])return!1;return!0},saveMatchShape:function(segArr){if(segArr||(segArr=_this.getSetSegmentArr())){var i,sets,matchShape=[];for(i=0;i<segArr.length;i++)sets=segArr[i].sets,matchShape.push(sets.length);this.setData("matchShape",matchShape),APP.nlf.save()}},createSpiceSelector:function(segs){var i,seg,spices=[];for(i=0;i<segs.length;i++){seg=segs[i],spices.push({content:i+1+": "+seg.segLabel,class:"mMdTop",isLabel:!0});var j,set,sets=seg.sets;for(j=0;j<sets.length;j++)set=sets[j],spices.push({content:"Set "+set.set_number,class:"button button-md button-inline button-gray round-corners mMdTop",name:set.set_number})}this.selector=new SpiceSelector({id:"rf",ele:"#ss-rails-filter",min:0,max:spices.length,spices:spices,defaultClass:"button-gray",highlightClass:"button-info",callbacks:{preInit:function(){},postInit:function(self){var filters=_this.filters.getData("arr");if(filters.length){var i,filter;for(i=0;i<filters.length;i++)(filter=filters[i])&&self.selectionArr.push("ss_rf_"+filter);self.forceUpdate()}},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){},deselected:function(self,selectedSpice){},complete:function(self){},incomplete:function(self){},disabled:function(self,selectedSpice){}}})},updateLabel:function(label){label?(this.setData("label",label),APP.nlf.save(),$("#rails-filter-tablet-label").text(label).removeClass("button-gray").addClass("button-white")):this.resetLabel()},resetLabel:function(){this.clearData("label"),APP.nlf.save(),$("#rails-filter-tablet-label").text("Set Label").removeClass("button-white").addClass("button-gray")},getData:function(varName){var data=APP.nlf.data;if(!data||!data.league)return!1;var uniqueId="rf-"+data.league.league_id+"-"+data.league.season_status,label=APP.nlf.getLocal(uniqueId,"label"),arr=APP.nlf.getLocal(uniqueId,"arr"),matchShape=APP.nlf.getLocal(uniqueId,"matchShape");if(varName)switch(varName){case"label":return-1==label?"":label;case"arr":return-1==arr?[]:arr;case"matchShape":return-1==matchShape?[]:matchShape}return{label:-1==label?"":label,arr:-1==arr?[]:arr,matchShape:-1==matchShape?[]:matchShape}},setData:function(varName,varValue){var data=APP.nlf.data;if(!data||!data.league)return!1;var uniqueId="rf-"+data.league.league_id+"-"+data.league.season_status;APP.nlf.setLocal(uniqueId,varName,varValue)},clearData:function(varName){var data=APP.nlf.data;if(!data||!data.league)return!1;var uniqueId="rf-"+data.league.league_id+"-"+data.league.season_status;varName?APP.nlf.removeLocal(uniqueId,varName):APP.nlf.removeLocalRecord(uniqueId)},showFilterDialog:function(){try{var data=APP.nlf.data;if(!data||!data.league)return;var schedBoards=data.league.sched_boards_required_per_match;if(!schedBoards)return;if(schedBoards&&1==schedBoards)return;var uniqueId="rf-"+data.league.league_id+"-"+data.league.season_status;if(-1!==APP.nlf.getLocal(uniqueId,"dialogSeen"))return;'\n\t\t\t\t\t<div class="button button-menu button-green round-corners"\n\t\t\t\t\t\tid="nlf-dialog-use"\n\t\t\t\t\t>\n\t\t\t\t\t\tUse Multiple Tablet Option\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="button button-menu button-red round-corners"\n\t\t\t\t\t\tid="nlf-dialog-cancel"\n\t\t\t\t\t>\n\t\t\t\t\t\tPlay All Matches on this Tablet\n\t\t\t\t\t</div>\n\t\t\t\t',APP.dialog.show({title:"Multiple Tablet Option",msg:'\n\t\t\t\t\t<div class="mMdTop mLgBottom mSmLeft mSmRight">\n\t\t\t\t\t\tDC can filter which sets are displayed when using multiple tablets for a league match.<br /><br />\n\t\t\t\t\t\tA tablet can be reset to show a different group of sets at any time.\n\t\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\t<div class="button button-menu button-green round-corners"\n\t\t\t\t\t\tid="nlf-dialog-use"\n\t\t\t\t\t>\n\t\t\t\t\t\tUse Multiple Tablet Option\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="button button-menu button-red round-corners"\n\t\t\t\t\t\tid="nlf-dialog-cancel"\n\t\t\t\t\t>\n\t\t\t\t\t\tPlay All Matches on this Tablet\n\t\t\t\t\t</div>\n\t\t\t\t',use_close_icon:!1,post_display:function(){APP.nlf.setLocal(uniqueId,"dialogSeen",!0),APP.lobby.activateBtn("nlf-dialog-use",(function(){APP.nlf.displayPage(17),APP.dialog.hide()})),APP.lobby.activateBtn("nlf-dialog-cancel",(function(){APP.dialog.hide()}))}})}catch(e){}}},_this.log("Initing"),_this.callbacks("postInit"))):this.log("vars not sent to class")};APP.nlf.rails||APP.nlf.load();var PlayerRails=function(vars){var _this=this;this.debugMode=!1,this.log=function(msg,force){if(this.debugMode||force){var message="PlayerRails: ";message+=msg,console.log(message)}},this.callbacks=function(cycle){if(vars.callbacks)try{vars.callbacks[cycle]&&(vars.callbacks[cycle](this),this.log(cycle+" callback ran"))}catch(e){this.log("Callback error - check sent data")}else this.log("No callbacks found")},vars?(this.vars=vars,function(){if(!_this.vars.id)return _this.log("required variable id not sent to class",!0),!1;return!0}()&&(this.parent=this.vars.parent,this.data=this.parent.data,this.rails=null,this.editData={activeTeam:null,teamLabel:null,size:null,players:[],mode:null,label:null,replaceInt:null,replacePlayer:null,teamLineUp:!1,lineUp:{selectedTeam:null,selectedSegment:null,scrollPos:0},reset:function(full){full&&(_this.editData.activeTeam=null,_this.editData.teamLabel=null,_this.editData.size=null,_this.editData.players=[],_this.editData.mode=null,_this.editData.lineUp.scrollPos=0),_this.editData.label=null,_this.editData.replaceInt=null,_this.editData.replacePlayer=null,_this.editData.teamLineUp=!1,_this.editData.lineUp.selectedTeam=null,_this.editData.lineUp.selectedSegment=null}},this.chapterPopUpShowing=!1,this.isPlayerRails=function(){try{var data=this.data.league;return"SINGLES"!=data.league_type&&(!data.match_settings||!data.match_settings.player_lineup_rule||"NONE"!=data.match_settings.player_lineup_rule)}catch(e){}return!1},this.selector=null,this.buildPlayerList=function(){var activeTeam=_this.editData.activeTeam,players=_this.getTeamPlayers(activeTeam),selectedTeam=_this.getLineUp(activeTeam);selectedTeam||(selectedTeam=[]);var expectedTeamSize=_this.getExpectedTeamSize(),disabledPlayerCount=0;if(players.length){var content,spices=[];content='\n\t\t\t<span class="player-order-icon"></span>\n\t\t\t<span class="bold">No<br /> Player</span>\n\t\t',spices.push({content:content,class:"dual-button-list round-corners button-white text-red",name:-1});var disabledPlayers=[];try{if(_this.islineUpOncePerSegment()){var segmentId=APP.nlf.data.railsChapter.segment_id,segmentPlayers=APP.nlf.playerRails.getLineUpSegmentPlayers(segmentId),isTiebreaker=!1;try{var setId=APP.nlf.data.railsChapter.set_id;isTiebreaker=APP.nlf.rails.tieBreaker.checkSetIsTiebreaker(setId)}catch(e){}isTiebreaker||(disabledPlayers=segmentPlayers[_this.editData.activeTeam])}}catch(e){}for(var i=0;i<players.length;i++){var player=players[i],fauxDisabled=!1,dataAttr=[],alreadyInSegment=!1,classList="dual-button-list round-corners button-white";-1!=selectedTeam.indexOf(player.player_guid)&&(disabledPlayerCount++,fauxDisabled=!0,dataAttr.push({"data-disabled":"selected"})),"POST"==this.data.league.season_status&&"I"==player.player_postseason_status&&(classList+=" button-faux-disabled",fauxDisabled=!0,dataAttr.push({"data-disabled":"post"})),-1!=disabledPlayers.indexOf(player.player_guid)&&(classList+=" button-faux-disabled",fauxDisabled=!0,dataAttr.push({"data-disabled":"segment"}),alreadyInSegment=!0),content=`\n\t\t\t\t<span class="player-order-icon"></span>\n\t\t\t\t<span class="bold">${player.first_name}</span><br />\n\t\t\t\t${player.last_name} ${player.player_rank?`(${player.player_rank})`:""} \n\t\t\t`,spices.push({content:content,class:classList,name:player.player_guid,attr:dataAttr,fauxDisabled:fauxDisabled,alreadyInSegment:alreadyInSegment})}var alreadyInSegmentSpices=[];for(i=spices.length-1;i>=0;i--){var spice=spices[i];spice.alreadyInSegment&&(alreadyInSegmentSpices.push(spice),spices.splice(i,1))}if(alreadyInSegmentSpices.length){spices.push({content:"Players already in this segment",class:"mMdBottom mMdTop",isLabel:!0});for(i=0;i<alreadyInSegmentSpices.length;i++)spices.push(alreadyInSegmentSpices[i])}if(spices.length){var max=expectedTeamSize;for(i=0;i<selectedTeam.length;i++)selectedTeam[i]&&max--;max<=0&&(max=1),this.selector=new SpiceSelector({id:"ps",ele:"#p-rails-player-selector",min:1,max:max,spices:spices,defaultClass:"button-white",highlightClass:"button-info",callbacks:{preInit:function(){"add"==APP.nlf.playerRails.editData.mode&&max!=expectedTeamSize&&$("#p-rails-edit-lineup-tip").empty()},postInit:function(){},exit:function(self){},maxReached:function(self){},selected:function(self,selectedSpice){"add"==APP.nlf.playerRails.editData.mode&&(max==expectedTeamSize&&APP.nlf.playerRails.displayLineUpOrder(self.selectionArr),"ss_ps_-1"==selectedSpice&&$("#"+selectedSpice).addClass("text-white").removeClass("text-red"))},deselected:function(self,selectedSpice){"ss_ps_-1"==selectedSpice&&$("#"+selectedSpice).addClass("text-red").removeClass("text-white"),"add"==APP.nlf.playerRails.editData.mode&&max==expectedTeamSize&&APP.nlf.playerRails.displayLineUpOrder(self.selectionArr)},complete:function(self){$("#p-rails-confirm-lineup").removeClass("button-disabled")},incomplete:function(self){$("#p-rails-confirm-lineup").addClass("button-disabled")},disabled:function(self,selectedSpice){switch($("#"+selectedSpice.eleId).attr("data-disabled")){case"selected":APP.alert.show("This Player is already selected for this Match");break;case"post":APP.alert.show("This Player is ineligible for post season");break;case"segment":APP.alert.show("This Player is already playing in this Segment")}}}})}if("add"==_this.editData.mode&&disabledPlayerCount){var remainingPlayerCount=expectedTeamSize-disabledPlayerCount,header=`\n\t\t\t\tSelect ${remainingPlayerCount} Player${1==remainingPlayerCount?"":"s"} from <span class="bold text-gold">${_this.editData.teamLabel}</span>\n\t\t\t`;$("#p-rails-edit-lineup-header").empty().append(header)}}else{APP.alert.show("\n\t\t\t\t<h4>No Players Found</h4>\n\t\t\t\t<p>Please use the standard player select menu and sync players</p>\n\t\t\t")}},this.displayLineUpOrder=function(lineUpArr,initial){$(".player-order-icon").empty();for(var i=0;i<lineUpArr.length;i++){var playerId=lineUpArr[i];if(playerId&&"missing"!=playerId){var btnId=playerId;initial&&(btnId="ss_ps_"+playerId),$("#"+btnId+" .player-order-icon").html(i+1)}}},this.buildLineUps=function(){var content="",homeTeam=_this.getLineUp("home"),awayTeam=_this.getLineUp("away"),teamSize=_this.getExpectedTeamSize();if(!teamSize)return _this.log("No team size found",!0),content='\n\t\t\t\t<div class="highlight-box danger">\n\t\t\t\t\tAn error has occurred, please select teams manually\n\t\t\t\t\t<div id="p-rails-start-match-err"\n\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\tContinue to Set\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t';var playerRailsObj=_this.getPlayerRailsObj(homeTeam,awayTeam,teamSize);switch("short"==playerRailsObj.home&&playerRailsObj.homeAllEmpty&&(playerRailsObj.home="empty","ready"==playerRailsObj.away&&(playerRailsObj.hideAway=!0)),"short"==playerRailsObj.away&&playerRailsObj.awayAllEmpty&&(playerRailsObj.away="empty","ready"==playerRailsObj.home&&(playerRailsObj.hideHome=!0)),content+='\n\t\t\t<div \n\t\t\t\tid="p-rails-reload-lineups" \n\t\t\t\tclass="button-info button-md mLgBottom round-corners button"\n\t\t\t>\n\t\t\t\tReload Lineups\n\t\t\t</div>\n\t\t',playerRailsObj.home){case"ready":playerRailsObj.hideHome?content+=_this.buildTeamLineUpBlock("home",playerRailsObj,"hide"):content+=_this.buildTeamLineUpBlock("home",playerRailsObj);break;case"error":content+=_this.buildTeamLineUpBlock("home",playerRailsObj,"error");break;case"empty":content+=_this.buildTeamLineUpBlock("home",!1);break;case"short":content+=_this.buildTeamLineUpBlock("home",playerRailsObj,"short")}switch(content+='\n\t\t\t<h4 class="text-gold subheading">Vs.</h4>\n\t\t',playerRailsObj.away){case"ready":playerRailsObj.hideAway?content+=_this.buildTeamLineUpBlock("away",playerRailsObj,"hide"):content+=_this.buildTeamLineUpBlock("away",playerRailsObj);break;case"error":content+=_this.buildTeamLineUpBlock("away",playerRailsObj,"error");break;case"empty":content+=_this.buildTeamLineUpBlock("away",!1);break;case"short":content+=_this.buildTeamLineUpBlock("away",playerRailsObj,"short")}return"ready"===playerRailsObj.home&&"ready"===playerRailsObj.away?content+='\n\t\t\t\t<div class="highlight-box rails-tip">\n\t\t\t\t\t<span class="bold">Pro Tip:</span> Missing Player? Use "Edit Player Lineup" to remove them before the match and keep stats accurate\n\t\t\t\t</div>\n\t\t\t':content+='\n\t\t\t\t<div class="highlight-box rails-tip">\n\t\t\t\t\t<span class="bold">Pro Tip:</span> Manage your Team Lineup on your phone and use the reload lineups button\n\t\t\t\t</div>\n\t\t\t',content},this.buildTeamLineUpBlock=function(team,playerRailsObj,status){var content="",match=_this.data.railsMatch,label="",playerList="",playerArr=[];"home"==team&&(label=match.home_label,playerRailsObj&&"error"==playerRailsObj.home&&(hasError=!0),playerArr=playerRailsObj.homePlayers),"away"==team&&(label=match.away_label,playerRailsObj&&"error"==playerRailsObj.away&&(hasError=!0),playerArr=playerRailsObj.awayPlayers);var shortPlayerFound=!1,missingPlayerRailsTeam=!1;if(playerRailsObj.allowShortOptions&&("home"==team&&playerRailsObj.homeAllEmpty&&(missingPlayerRailsTeam=!0),"away"==team&&playerRailsObj.awayAllEmpty&&(missingPlayerRailsTeam=!0)),!playerRailsObj||missingPlayerRailsTeam){var teamSize=_this.getExpectedTeamSize(),buttonLabel=`Select ${teamSize} Players`;return 1==teamSize&&(buttonLabel="Select Player"),`\n\t\t\t\t<div class="player-lineup-div highlight-box danger">\n\t\t\t\t\t<h4 class="text-gold">${label}</h4>\n\t\t\t\t\tLineup is missing\n\n\t\t\t\t\t<div id="p-rails-add-players-${team}"\n\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\t${buttonLabel}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`}for(var i=0;i<playerArr.length;i++){var player=playerArr[i];if(-1!=player)if("missing"!=player)playerList+=`\n\t\t\t\t\t<div class='player'>${APP.session.createPlayerName(player,1)}</div>\n\t\t\t\t`;else playerList+="\n\t\t\t\t\t\t<div class='player missing-player'>\n\t\t\t\t\t\t\tPlayer Not Found\n\t\t\t\t\t\t</div>\n\t\t\t\t\t";else shortPlayerFound=!0,playerList+="\n\t\t\t\t\t\t<div class='player empty-player'>\n\t\t\t\t\t\t\tNo Player (playing short)\n\t\t\t\t\t\t</div>\n\t\t\t\t\t"}switch("short"!=status||shortPlayerFound||(playerList+="\n\t\t\t\t<div class='player empty-player'>\n\t\t\t\t\tNo Player (playing short)\n\t\t\t\t</div>\n\t\t\t"),"home"==team&&"short"==status&&playerRailsObj.hideHome&&(playerList="\n\t\t\t\tTeam lineup hidden<br />\n\t\t\t\t<div class='player empty-player'>\n\t\t\t\t\tNo Player (playing short)\n\t\t\t\t</div>\n\t\t\t"),"away"==team&&"short"==status&&playerRailsObj.hideAway&&(playerList="\n\t\t\t\tTeam lineup hidden<br />\n\t\t\t\t<div class='player empty-player'>\n\t\t\t\t\tNo Player (playing short)\n\t\t\t\t</div>\n\t\t\t"),status){case"hide":content+=`\n\t\t\t\t\t<div class="player-lineup-div highlight-box primary">\n\t\t\t\t\t\t<h4 class="text-gold">${label}</h4>\n\t\t\t\t\t\tTeam lineup hidden\n\t\t\t\t\t\t<div id="p-rails-edit-players-${team}"\n\t\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\t\tEdit Lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;break;case"short":content+=`\n\t\t\t\t\t<div class="player-lineup-div highlight-box">\n\t\t\t\t\t\t<h4 class="text-gold">${label}</h4>\n\t\t\t\t\t\t${playerList}\n\t\t\t\t\t\t<div id="p-rails-edit-players-${team}"\n\t\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\t\tEdit Lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;break;case"error":content+=`\n\t\t\t\t\t<div class="player-lineup-div highlight-box danger">\n\t\t\t\t\t\t<h4 class="text-gold">${label}</h4>\n\t\t\t\t\t\t<div class="player missing-player">\n\t\t\t\t\t\t\tThere was an error loading the lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div id="p-rails-edit-players-${team}"\n\t\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\t\tEdit Lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`;break;default:content+=`\n\t\t\t\t\t<div class="player-lineup-div highlight-box primary">\n\t\t\t\t\t\t<h4 class="text-gold">${label}</h4>\n\t\t\t\t\t\t${playerList}\n\n\t\t\t\t\t\t<div id="p-rails-edit-players-${team}"\n\t\t\t\t\t\t\tclass="button-gold mLgTop round-corners button button-md">\n\t\t\t\t\t\t\tEdit Lineup\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t`}return content},this.getLineUpStatus=function(){function checkTeamReady(playerRailsObj){return{homeReady:!("missing"===playerRailsObj.home||"empty"===playerRailsObj.home||"error"===playerRailsObj.home),awayReady:!("missing"===playerRailsObj.away||"empty"===playerRailsObj.away||"error"===playerRailsObj.away)}}try{var lineUpRule=_this.data.railsFormat.player_lineup_rule;if("NONE"===lineUpRule)return{lineUpRule:"NONE",match:{awayAllEmpty:!1,awayAllReady:!1,homeAllEmpty:!1,homeAllReady:!1},segments:{},sessions:{},sets:{}};var data=_this.data,match=data.railsMatch,sets=data.railsFormat.sets||[],sessions=function(sets){for(var sessionMap={},currentSession=1,lastSegmentId=null,i=0;i<sets.length;i++){var set=sets[i],segmentId=set.segment_id,setId=set.set_id;null!==lastSegmentId&&lastSegmentId!==segmentId&&"Y"===sets[i-1].break_after_segment&&currentSession++,sessionMap[currentSession]||(sessionMap[currentSession]={sets:[],segments:[],homeAllReady:!0,homeAllEmpty:!0,awayAllReady:!0,awayAllEmpty:!0,completed:!0}),sessionMap[currentSession].sets.push(setId),-1===sessionMap[currentSession].segments.indexOf(segmentId)&&sessionMap[currentSession].segments.push(segmentId),lastSegmentId=segmentId}return sessionMap}(sets),returnObj={lineUpRule:lineUpRule,match:{homeAllReady:!0,homeAllEmpty:!0,awayAllReady:!0,awayAllEmpty:!0},segments:{},sessions:sessions,sets:{}};for(var sessionId in sessions)if(sessions.hasOwnProperty(sessionId)){for(var session=sessions[sessionId],j=0;j<session.segments.length;j++){for(var segmentId=session.segments[j],segmentSets=sets.filter((function(s){return s.segment_id===segmentId})),segmentObj={homeAllReady:!0,homeAllEmpty:!0,awayAllReady:!0,awayAllEmpty:!0,completed:!0},i=0;i<segmentSets.length;i++){var setId=segmentSets[i].set_id,teamReadyStatus=checkTeamReady(_this.getPlayerRailsObj(!1,!1,!1,setId)),setComplete="PLAYED"===APP.nlf.rails.getChapterStatus(match.chapter_status,setId),setObj={awayReady:teamReadyStatus.awayReady,homeReady:teamReadyStatus.homeReady,complete:setComplete,segmentId:segmentId,sessionId:sessionId};returnObj.sets[setId]=setObj,setComplete||(segmentObj.completed=!1),teamReadyStatus.homeReady||(segmentObj.homeAllReady=!1),teamReadyStatus.homeReady&&(segmentObj.homeAllEmpty=!1),teamReadyStatus.awayReady||(segmentObj.awayAllReady=!1),teamReadyStatus.awayReady&&(segmentObj.awayAllEmpty=!1)}returnObj.segments[segmentId]=segmentObj,segmentObj.homeAllReady||(session.homeAllReady=!1),segmentObj.homeAllEmpty||(session.homeAllEmpty=!1),segmentObj.awayAllReady||(session.awayAllReady=!1),segmentObj.awayAllEmpty||(session.awayAllEmpty=!1),segmentObj.completed||(session.completed=!1)}session.homeAllReady||(returnObj.match.homeAllReady=!1),session.homeAllEmpty||(returnObj.match.homeAllEmpty=!1),session.awayAllReady||(returnObj.match.awayAllReady=!1),session.awayAllEmpty||(returnObj.match.awayAllEmpty=!1)}return returnObj}catch(e){return newErrorReport(e,"Lineup Status Bug",!1),{lineUpRule:"NONE",match:{awayAllEmpty:!1,awayAllReady:!1,homeAllEmpty:!1,homeAllReady:!1},segments:{},sessions:{},sets:{}}}},this.isLineUpLocked=function(team,setId,segmentId){try{var lineUpStatus=_this.getLineUpStatus();switch(lineUpStatus.lineUpRule){case"NONE":return!1;case"ENTIRE":case"RANDOM":case"GRID_MAP":return(!lineUpStatus.match.homeAllReady||!lineUpStatus.match.awayAllReady)&&((!lineUpStatus.match.homeAllEmpty||!lineUpStatus.match.awayAllEmpty)&&("home"==team?!lineUpStatus.match.awayAllReady&&!!lineUpStatus.match.homeAllReady:"away"==team&&(!lineUpStatus.match.homeAllReady&&!!lineUpStatus.match.awayAllReady)));case"SEGMENT_START":var segment;if(setId){if(!(setObj=lineUpStatus.sets[setId]))return!1;if(!(segment=lineUpStatus.segments[setObj.segmentId]))return!1}return!(segmentId&&!(segment=lineUpStatus.segments[segmentId]))&&((!segment.homeAllReady||!segment.awayAllReady)&&((!segment.homeAllEmpty||!segment.awayAllEmpty)&&("home"==team?!segment.awayAllReady&&!!segment.homeAllReady:"away"==team&&(!segment.homeAllReady&&!!segment.awayAllReady))));case"MATCH_BREAKS":if(setId){var setObj;if(!(setObj=lineUpStatus.sets[setId]))return!1;if(!(session=lineUpStatus.sessions[setObj.sessionId]))return!1;if(session.homeAllReady&&session.awayAllReady)return!1;if(session.homeAllEmpty&&session.awayAllEmpty)return!1;if("home"==team)return!session.awayAllReady&&!!session.homeAllReady;if("away"==team)return!session.homeAllReady&&!!session.awayAllReady}else if(segmentId){var sessionFound=null;for(var sessionId in lineUpStatus.sessions){var session;if(lineUpStatus.sessions.hasOwnProperty(sessionId))if(-1!==(session=lineUpStatus.sessions[sessionId]).segments.indexOf(segmentId)){sessionFound=session;break}}if(!sessionFound)return!1;if(sessionFound.homeAllReady&&sessionFound.awayAllReady)return!1;if(sessionFound.homeAllEmpty&&sessionFound.awayAllEmpty)return!1;if("home"==team)return!sessionFound.awayAllReady&&!!sessionFound.homeAllReady;if("away"==team)return!sessionFound.homeAllReady&&!!sessionFound.awayAllReady}return!1}}catch(e){newErrorReport(e,"Lineup Status Bug",!1)}return!1},this.backgroundUpdater={timer:null,init:function(){_this.isPlayerRails()||this.stopUpdates(),this.startUpdates()},checkForUpdate:function(){5===APP.nlf.data.mode&&(APP.nlf.playerRails.updateLineUpPlatform(0,(function(){}),!0),window.setTimeout((function(){APP.nlf.playerRails.backgroundUpdater.startUpdates()}),2e3))},doUpdate:function(){this.stopUpdates();var scope=this,timerVars={name:"prBackgroundUpdater",runTime:19,callback:function(manualStop){manualStop||scope.checkForUpdate()},debugMode:!1};scope.timer=new Timer(timerVars)},startUpdates:function(){5===APP.nlf.data.mode&&(this.timer&&!this.timer.hasStopped||this.doUpdate())},stopUpdates:function(){this.timer&&_timers.removeTimer("prBackgroundUpdater"),this.timer=null}},this.buildLineUpManager=function(){var j,k,match=APP.nlf.data.railsMatch,teamLineUp=APP.nlf.playerRails.getTeamLineUpObj(),editData_selectedTeam=_this.editData.lineUp.selectedTeam,team=(_this.editData.lineUp.selectedSegment,!1);if("home"==editData_selectedTeam?(match.home_label,team="home"):(match.away_label,team="away"),!team)return"Team not found, please try again";var lineUpBlock,content='\n\t\t\t<div class="highlight-box danger">\n\t\t\t\t<p>Pro Tip: Use your phone to create your player lineup <span class="bold">BEFORE</span> the match at my.dartconnect.com</p>\n\t\t\t</div>\n\t\t',setDisplayCount=0,teamLineUpContent="",btnArr=[],segmentBlocks=[];for(i=0;i<teamLineUp.length;i++){var set,displayContent,segment=teamLineUp[i],header=`\n\t\t\t\t<h4 class="segment-header">${segment.segmentHeader}</h4>\n\t\t\t`,matchDisplayCount=0,matchContent="",isComplete=!0;if(segment.sets.length){var sets=segment.sets;try{if("Y"==segment.sets[0].tiebreaker&&!APP.nlf.rails.tieBreaker.tieBreakerActive)continue}catch(e){}var filters=APP.nlf.rails.filters.getCurrentFilters();for(j=0;j<sets.length;j++)if(set=sets[j],!filters||!filters.length||-1!=filters.indexOf(set.set_number)){var teamLineUpObj;if(matchDisplayCount++,matchContent+=`\n\t\t\t\t\t<div class="p-rails-line-up-row group">\n\t\t\t\t\t\t<div class="left-div">\n\t\t\t\t\t\t\tSet ${set.set_number}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,APP.nlf.rails.allowMidChapterPlayerChanges(set))matchContent+='\n\t\t\t\t\t\t\t<div class="right-div">\n\t\t\t\t\t\t\t\tPlayers must be manually selected\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t';else if("team"==set.player_format)matchContent+='\n\t\t\t\t\t\t\t\t<div class="right-div">\n\t\t\t\t\t\t\t\t\tTeam Match\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t';else if(_this.isLineUpLocked(team,set.set_id))matchContent+='\n\t\t\t\t\t\t\t\t<div class="right-div">\n\t\t\t\t\t\t\t\t\tLine up locked<br />\n\t\t\t\t\t\t\t\t\tOpponent\'s line up is not ready\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t';else switch(team){case"home":for(teamLineUpObj=set.playerRailsObj,(lineUpBlock=this.buildLineUpManagerBlock("home",teamLineUpObj,set.set_id)).isComplete||(isComplete=!1),k=0;k<lineUpBlock.btnArr.length;k++)btnArr.push(lineUpBlock.btnArr[k]);matchContent+=`\n\t\t\t\t\t\t\t\t\t\t<div class="right-div">\n\t\t\t\t\t\t\t\t\t\t\t${lineUpBlock.content}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`;break;case"away":for(teamLineUpObj=set.playerRailsObj,(lineUpBlock=this.buildLineUpManagerBlock("away",teamLineUpObj,set.set_id)).isComplete||(isComplete=!1),k=0;k<lineUpBlock.btnArr.length;k++)btnArr.push(lineUpBlock.btnArr[k]);matchContent+=`\n\t\t\t\t\t\t\t\t\t\t<div class="right-div">\n\t\t\t\t\t\t\t\t\t\t\t${lineUpBlock.content}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t`}matchContent+="<hr />"}}if(matchContent.length&&(matchContent=matchContent.substring(0,matchContent.length-6)),matchDisplayCount){if(isComplete){displayContent=`\n\t\t\t\t\t\t<div id="p-rails-segment-block-${segment.segmentId}">\n\t\t\t\t\t\t\t<h4 class="text-gold subheading">${header}</h4>\n\t\t\t\t\t\t\t<div class="highlight-box primary">\n\t\t\t\t\t\t\t\t<div class="p-rails-line-up-div">\n\t\t\t\t\t\t\t\t\t${matchContent}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;try{"Y"==set.break_after_segment&&(displayContent+='\n\t\t\t\t\t\t\t\t<div class="segment-break-div">\n\t\t\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t\t\tScheduled Break\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t')}catch(e){}segmentBlocks.push({content:displayContent})}else{displayContent=`\n\t\t\t\t\t\t<div id="p-rails-segment-block-${segment.segmentId}">\n\t\t\t\t\t\t\t<h4 class="text-gold subheading">${header}</h4>\n\t\t\t\t\t\t\t<div class="highlight-box">\n\t\t\t\t\t\t\t\t<div class="p-rails-line-up-div">\n\t\t\t\t\t\t\t\t\t${matchContent}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;try{"Y"==set.break_after_segment&&(displayContent+='\n\t\t\t\t\t\t\t\t<div class="segment-break-div">\n\t\t\t\t\t\t\t\t\t<h4>\n\t\t\t\t\t\t\t\t\t\tScheduled Break\n\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t')}catch(e){}segmentBlocks.push({content:displayContent})}setDisplayCount++}}if(setDisplayCount){for(var i=0;i<segmentBlocks.length;i++)teamLineUpContent+=segmentBlocks[i].content;content+=`\n\t\t\t\t<div id="p-rails-line-up-blocks">\n\t\t\t\t\t${teamLineUpContent}\n\t\t\t\t</div>\n\t\t\t`}else teamLineUpContent='\n\t\t\t\t<div class="highlight-box danger">\n\t\t\t\t\t<h4 class="text-gold">No Sets Found</h4>\n\t\t\t\t\t<p>Please use the standard player select menu to select players</p>\n\t\t\t\t</div>\n\t\t\t';return{content:content,btnArr:btnArr}},this.buildLineUpManagerBlock=function(team,playerRailsObj,setId){var i,match=_this.data.railsMatch,playerList="",playerArr=[],btnArr=[],isComplete=!0,teamSize=_this.getExpectedTeamSize(setId);"home"==team&&(label=match.home_label,playerRailsObj&&"error"==playerRailsObj.home&&(hasError=!0),playerArr=playerRailsObj.homePlayers),"away"==team&&(label=match.away_label,playerRailsObj&&"error"==playerRailsObj.away&&(hasError=!0),playerArr=playerRailsObj.awayPlayers);var buttonLabel=`Select ${teamSize} Players`;1==teamSize&&(buttonLabel="Select Player");var missingPlayerRailsTeam=!1;if(playerRailsObj.allowShortOptions&&("home"==team&&playerRailsObj.homeAllEmpty&&(missingPlayerRailsTeam=!0),"away"==team&&playerRailsObj.awayAllEmpty&&(missingPlayerRailsTeam=!0)),!playerRailsObj)return{isComplete:!1,content:`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="button button-gold round-corners team-lineup-btn"\n\t\t\t\t\t\tid="pr-lineup-btn-${setId}"\n\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\tdata-set-type="add"\n\t\t\t\t\t>\n\t\t\t\t\t\t${buttonLabel}\n\t\t\t\t\t</div>\n\t\t\t\t`,btnArr:["pr-lineup-btn-"+setId]};if(missingPlayerRailsTeam)return{isComplete:!0,content:`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass="button button-red round-corners team-lineup-btn"\n\t\t\t\t\t\tid="pr-lineup-btn-${setId}"\n\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\tdata-set-type="add"\n\t\t\t\t\t>\n\t\t\t\t\t\tTeam Lineup Missing\n\t\t\t\t\t</div>\n\t\t\t\t`,btnArr:["pr-lineup-btn-"+setId]};switch(playerRailsObj[team]){case"error":case"empty":case"missing":return{isComplete:!1,content:`\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tclass="button button-gold round-corners team-lineup-btn"\n\t\t\t\t\t\t\tid="pr-lineup-btn-${setId}"\n\t\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\t\tdata-set-type="add"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${buttonLabel}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,btnArr:["pr-lineup-btn-"+setId]};case"short":case"ready":for(i=0;i<teamSize;i++){var player=playerArr[i];if(player)if(-1!=player)playerList+=`\n\t\t\t\t\t\t<div \n\t\t\t\t\t\t\tclass="button button-info round-corners team-lineup-btn"\n\t\t\t\t\t\t\tid="pr-lineup-btn-${setId}-${i}"\n\t\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\t\tdata-player-pos="${i}"\n\t\t\t\t\t\t\tdata-set-type="player"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t${APP.session.createPlayerName(player,1)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`,btnArr.push("pr-lineup-btn-"+setId+"-"+i);else shortPlayerFound=!0,playerList+=`\n\t\t\t\t\t\t\t\t<div \n\t\t\t\t\t\t\t\tclass="button button-red round-corners team-lineup-btn"\n\t\t\t\t\t\t\t\tid="pr-lineup-btn-${setId}-${i}"\n\t\t\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\t\t\tdata-player-pos="${i}"\n\t\t\t\t\t\t\t\tdata-set-type="player"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tNo Player\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`,btnArr.push("pr-lineup-btn-"+setId+"-"+i);else"short"==playerRailsObj[team]?(playerList+=`\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-red round-corners team-lineup-btn"\n\t\t\t\t\t\t\t\t\tid="pr-lineup-btn-${setId}-${i}"\n\t\t\t\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\t\t\t\tdata-player-pos="${i}"\n\t\t\t\t\t\t\t\t\tdata-set-type="player"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\tNo Player\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`,btnArr.push("pr-lineup-btn-"+setId+"-"+i)):(playerList+=`\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclass="button button-gold round-corners team-lineup-btn"\n\t\t\t\t\t\t\t\t\tid="pr-lineup-btn-${setId}-${i}"\n\t\t\t\t\t\t\t\t\tdata-set-id="${setId}"\n\t\t\t\t\t\t\t\t\tdata-set-team="${team}"\n\t\t\t\t\t\t\t\t\tdata-player-pos="${i}"\n\t\t\t\t\t\t\t\t\tdata-set-type="player"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t${buttonLabel}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t`,btnArr.push("pr-lineup-btn-"+setId+"-"+i))}}return"home"==team?"ready"!=playerRailsObj.home&&("short"==playerRailsObj.home?playerRailsObj.homeAllEmpty&&(isComplete=!1):isComplete=!1):("ready"!=playerRailsObj.away||playerRailsObj.awayAllEmpty)&&(isComplete=!1),{isComplete:isComplete,content:playerList,btnArr:btnArr}},this.getLineUpSegmentData=function(){var i,j,set,setId,segmentId,segmentNumber,data=_this.data,format=data.railsFormat,match=data.railsMatch,returnArr=[],sets=format.sets;if(!sets)return!1;var segmentArr=[];for(i=0;i<sets.length;i++)segmentArr[segmentNumber=(set=sets[i]).segment_number-1]||(segmentArr[segmentNumber]=[]),segmentArr[segmentNumber].push(set);for(segmentArr=segmentArr.filter((function(el){return null!=el})),i=0;i<segmentArr.length;i++){var segment=segmentArr[i];segmentId=segment[0].segment_id;var segmentObj={segmentNumber:segmentNumber=segment[0].segment_number,segmentId:segmentId,home:!1,away:!1};for(j=0;j<segment.length;j++){if(setId=(set=segment[j]).set_id,"PLAYED"==APP.nlf.rails.getChapterStatus(match.chapter_status,setId)){segmentObj.home=!1,segmentObj.away=!1;break}var playerRailsObj=_this.getPlayerRailsObj(!1,!1,!1,setId);"missing"!=playerRailsObj.home&&"empty"!=playerRailsObj.home&&"error"!=playerRailsObj.home||(segmentObj.home=!0),"missing"!=playerRailsObj.away&&"empty"!=playerRailsObj.away&&"error"!=playerRailsObj.away||(segmentObj.away=!0)}returnArr.push(segmentObj)}return returnArr},this.getLineUpSegmentPlayers=function(segmentId){var format=_this.data.railsFormat,returnObj={home:[],away:[]};try{var i,j,set,setId,segmentNumber,sets=format.sets;if(!sets)return returnObj;var segmentArr=[];for(i=0;i<sets.length;i++)segmentArr[segmentNumber=(set=sets[i]).segment_number-1]||(segmentArr[segmentNumber]=[]),segmentArr[segmentNumber].push(set);if(!(segmentArr=segmentArr.filter((function(el){return el[0].segment_id==segmentId}))).length)return returnObj;var mySegment=segmentArr[0];for(i=0;i<mySegment.length;i++){setId=(set=mySegment[i]).set_id;var player,playerRailsObj=_this.getPlayerRailsObj(!1,!1,!1,setId);if(playerRailsObj.homePlayers)for(j=0;j<playerRailsObj.homePlayers.length;j++)player=playerRailsObj.homePlayers[j],returnObj.home.push(player.player_guid);if(playerRailsObj.awayPlayers)for(j=0;j<playerRailsObj.awayPlayers.length;j++)player=playerRailsObj.awayPlayers[j],returnObj.away.push(player.player_guid)}}catch(e){}return returnObj},this.launchLineUpManager=function(id){APP.nlf.playerRails.editData.reset();var btn=$("#"+id),team=btn.attr("data-team"),segment=btn.attr("data-segment");_this.editData.lineUp.selectedTeam=team,_this.editData.lineUp.selectedSegment=segment,APP.nlf.displayPage(16)},this.handlePlayerRailsBtn=function(btnId){var btn=$("#"+btnId),setId=btn.attr("data-set-id"),team=btn.attr("data-set-team"),playerPos=(btn.attr("data-set-type"),btn.attr("data-player-pos"));_this.editData.lineUp.scrollPos=document.getElementById("nlf-scroll-box").scrollTop;var sets=APP.nlf.data.league.match_settings.sets,set=APP.findInObjArray("set_id",sets,setId)[0];APP.nlf.data.railsChapter=set,APP.nlf.data.railsGameMenu=set.game_menu,_this.setEditData(team),_this.editData.activeTeam=team,_this.editData.players=_this.getLineUp(team),_this.editData.size=_this.getExpectedTeamSize(),_this.editData.teamLineUp=!0;var match=_this.data.railsMatch;_this.editData.teamLabel=match.home_label,"away"==team&&(_this.editData.teamLabel=match.away_label),APP.nlf.displayPage(14),_this.editData.players&&_this.editData.players.length||APP.nlf.playerRails.addPlayer(0),playerPos&&("0"==playerPos&&APP.nlf.playerRails.editPlayer(0),"1"==playerPos&&APP.nlf.playerRails.editPlayer(1),"2"==playerPos&&APP.nlf.playerRails.editPlayer(2),"3"==playerPos&&APP.nlf.playerRails.editPlayer(3))},this.scrollToLineUpBlock=function(setId){try{var scrollPos=_this.editData.lineUp.scrollPos;scrollPos||(scrollPos=0);var blockId="p-rails-segment-block-"+setId,block=document.getElementById(blockId);if(!block)return;if(document.getElementById("p-rails-line-up-blocks").firstElementChild==block)return;var headerHeight=0,headerEle=document.querySelector("#popup-nlf .popup-title");headerEle&&(headerHeight=headerEle.offsetHeight);var newPos=block.getBoundingClientRect().y-headerHeight-20;document.getElementById("nlf-scroll-box").scrollTop=newPos}catch(e){}},this.islineUpOncePerSegment=function(){try{if(APP.nlf.data.league.match_settings.player_lineup_segment_rule&&"ONCE_PER_SEGMENT"==APP.nlf.data.league.match_settings.player_lineup_segment_rule)return!0}catch(e){}return!1},this.getLineUp=function(team,setId){if(!team)return _this.log("No team sent to getLineUp",!0),!1;if("home"!==team&&"away"!==team)return _this.log("Invalid team sent to getLineUp",!0),!1;if(!_this.data.railsMatch)return _this.log("No match info found",!0),!1;if(!setId){var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;setId=chapterInfo.set_id}var uniqueId=_this.rails.getUniqueId(),localArr=_this.parent.getLocal(uniqueId,"playerRails");-1==localArr&&(localArr=[]);var localData=APP.findInObjArray("id",localArr,setId)[0],platformData=this.getPlatformLineUp(setId);if("home"==team){var homeTeam=!1;platformData&&platformData.home_team&&(homeTeam=platformData.home_team);var homeTeamLocal=!1;if(localData&&localData.home_team&&(homeTeamLocal=localData.home_team),homeTeamLocal){if(homeTeam){if(homeTeam.ts){if(!homeTeamLocal.ts)return homeTeam.players?homeTeam.players:[];try{var hlts=moment(homeTeamLocal.ts),hts=moment(homeTeam.ts);return hlts.isAfter(hts)?homeTeamLocal.players?homeTeamLocal.players:[]:homeTeam.players?homeTeam.players:[]}catch(e){}}return homeTeamLocal.ts?homeTeamLocal.players?homeTeamLocal.players:[]:homeTeam.players?homeTeam.players:[]}return homeTeamLocal.players?homeTeamLocal.players:[]}return!!homeTeam&&(homeTeam.players?homeTeam.players:[])}var awayTeam=!1;platformData&&platformData.away_team&&(awayTeam=platformData.away_team);var awayTeamLocal=!1;if(localData&&localData.away_team&&(awayTeamLocal=localData.away_team),awayTeamLocal){if(awayTeam){if(awayTeam.ts){if(!awayTeamLocal.ts)return awayTeam.players?awayTeam.players:[];try{var alts=moment(awayTeamLocal.ts),ats=moment(awayTeam.ts);return alts.isAfter(ats)?awayTeamLocal.players?awayTeamLocal.players:[]:awayTeam.players?awayTeam.players:[]}catch(e){}}return awayTeamLocal.ts?awayTeamLocal.players?awayTeam.players:[]:awayTeam.players?awayTeam.players:[]}return awayTeamLocal.players?awayTeamLocal.players:[]}return!!awayTeam&&(awayTeam.players?awayTeam.players:[])},this.setLineUp=function(team,lineUp,enableEmpty){var i;if(!team)return _this.log("No team sent to setLineUp",!0),!1;if("home"!==team&&"away"!==team)return _this.log("Invalid team sent to setLineUp",!0),!1;if(!lineUp)return _this.log("No lineUp sent to setLineUp",!0),!1;var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;var setId=chapterInfo.set_id,segmentId=chapterInfo.segment_id,myTimeStamp=moment().tz("America/New_York");myTimeStamp=myTimeStamp.toISOString();var uniqueId=_this.rails.getUniqueId(),teamDetails={players:lineUp,ts:myTimeStamp};lineUp.length||enableEmpty||delete teamDetails.ts;var localArr=_this.parent.getLocal(uniqueId,"playerRails");-1==localArr&&(localArr=[]);var teamId,platformData,players=[],localData=APP.findInObjArray("id",localArr,setId)[0];localData?"home"==team?localData.home_team=teamDetails:localData.away_team=teamDetails:(localData={id:setId,home_team:[],away_team:[]},"home"==team?(localData.home_team=teamDetails,(platformData=this.getPlatformLineUp()).away_team&&(localData.away_team=platformData.away_team)):(localData.away_team=teamDetails,(platformData=this.getPlatformLineUp()).home_team&&(localData.home_team=platformData.home_team)),localArr.push(localData));_this.parent.setLocal(uniqueId,"playerRails",localArr);var homePlayers=null,awayPlayers=null;try{homePlayers=localData.home_team.players,awayPlayers=localData.away_team.players}catch(e){}if("home"==team){for(i=0;i<homePlayers.length;i++)players.push({id:homePlayers[i],order:i+1});teamId=APP.nlf.data.railsMatch.home_id}if("away"==team){for(i=0;i<awayPlayers.length;i++)players.push({id:awayPlayers[i],order:i+1});teamId=APP.nlf.data.railsMatch.away_id}var callData={set_id:setId,segment_id:segmentId,ts:myTimeStamp,device_token:APP.device.token,member_id:APP.user.member_id,players:players,team_id:teamId},call={url:"league-amb-match-players/"+APP.nlf.data.railsMatch.league_match_id+"/"+APP.nlf.data.league.season_status,type:"POST",data:callData,useDefaultHeaders:!0,removeOnError:!0};APP.dcConnect.addCall(call)},this.getPlatformLineUp=function(setId){if(!setId){var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;setId=chapterInfo.set_id}if(!setId)return!1;var platformData=_this.data.railsMatch.player_lineup;if(!platformData||!platformData.length)return!1;var lineUp=APP.findInObjArray("set_id",platformData,setId)[0];return lineUp||!1},this.getTeamPlayers=function(team,getTeamObj){if(!team)return _this.log("No team sent to getTeamPlayers",!0),!1;var teamObj,leagueData=APP.nlf.data.league,homeId=APP.nlf.data.railsMatch.home_id,awayId=APP.nlf.data.railsMatch.away_id,leagueId=leagueData.league_division_guid;leagueId+="_",leagueId+=leagueData.season_status;var directory=BBAT.fetchData("directory_division_"+leagueId);return"home"==team?(teamObj=APP.findInObjArray("team_guid",directory.teams,homeId)[0])?getTeamObj?teamObj:teamObj.players:[]:(teamObj=APP.findInObjArray("team_guid",directory.teams,awayId)[0])?getTeamObj?teamObj:teamObj.players:[]},this.getExpectedTeamSize=function(setId){var chapterInfo=null;if(setId){var sets=APP.nlf.data.league.match_settings.sets,set=APP.findInObjArray("set_id",sets,setId)[0];set&&(chapterInfo=set)}else chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;var teamSize=chapterInfo.player_format;if(!teamSize)return 0;switch(teamSize){case"singles":return 1;case"doubles":return 2;case"triples":return 3;case"quads":return 4}return 0},this.getPlayerRailsObj=function(homeTeam,awayTeam,teamSize,setId){var i;if(!setId){var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;setId=chapterInfo.set_id}homeTeam||(homeTeam=_this.getLineUp("home",setId))||(homeTeam=[]),awayTeam||(awayTeam=_this.getLineUp("away",setId))||(awayTeam=[]),teamSize||(teamSize=_this.getExpectedTeamSize(setId));var teamPlayers,player,playerId,allEmpty,returnObj={home:null,away:null,hideHome:!1,hideAway:!1,homePlayers:[],awayPlayers:[],homeAllEmpty:!1,awayAllEmpty:!1};for(homeTeam.length,homeTeam.length==teamSize?returnObj.home="ready":0==homeTeam.length?returnObj.home="empty":returnObj.home="short",i=0;i<homeTeam.length;i++)if(-1==homeTeam[i]){returnObj.home="short";break}for(awayTeam.length,awayTeam.length==teamSize?returnObj.away="ready":0==awayTeam.length?returnObj.away="empty":returnObj.away="short",i=0;i<awayTeam.length;i++)if(-1==awayTeam[i]){returnObj.away="short";break}for(teamPlayers=_this.getTeamPlayers("home"),i=0;i<teamSize;i++)(playerId=homeTeam[i])&&(-1!=playerId?(player=APP.findInObjArray("player_guid",teamPlayers,playerId)[0])?returnObj.homePlayers.push(player):(returnObj.homePlayers.push("missing"),returnObj.home="error"):returnObj.homePlayers.push(-1));for(teamPlayers=_this.getTeamPlayers("away"),i=0;i<teamSize;i++)(playerId=awayTeam[i])&&(-1!=playerId?(player=APP.findInObjArray("player_guid",teamPlayers,playerId)[0])?returnObj.awayPlayers.push(player):(returnObj.awayPlayers.push("missing"),returnObj.away="error"):returnObj.awayPlayers.push(-1));if("short"==returnObj.home){for(allEmpty=!0,i=0;i<returnObj.homePlayers.length;i++)if(-1!=returnObj.homePlayers[i]){allEmpty=!1;break}allEmpty&&(returnObj.homeAllEmpty=!0)}if("short"==returnObj.away){for(allEmpty=!0,i=0;i<returnObj.awayPlayers.length;i++)if(-1!=returnObj.awayPlayers[i]){allEmpty=!1;break}allEmpty&&(returnObj.awayAllEmpty=!0)}var homeReady="ready"==returnObj.home||"short"==returnObj.home,awayReady="ready"==returnObj.away||"short"==returnObj.away;if(homeReady&&!awayReady&&(returnObj.hideHome=!0),awayReady&&!homeReady&&(returnObj.hideAway=!0),returnObj.allowShortOptions=!1,this.data.railsFormat&&this.data.railsFormat.player_lineup_rule)switch(this.data.railsFormat.player_lineup_rule){case"ENTIRE":case"SEGMENT_START":case"MATCH_BREAKS":returnObj.allowShortOptions=!0}return returnObj},this.getTeamLineUpObj=function(){var format=_this.data.railsFormat,match=_this.data.railsMatch,sets=format.sets,segmentArr=[];if(sets){for(i=0;i<sets.length;i++){var set=JSON.parse(JSON.stringify(sets[i]));segmentNumber=set.segment_number-1;var instructions=_this.parent.rails.createRailsInstructions(set),chapterStatus=_this.parent.rails.getChapterStatus(match.chapter_status,set.set_id),initialSet=set;segmentId=initialSet.segment_id,segmentNumber=initialSet.segment_number;var segmentLabel=initialSet.segment_label,segmentIcon="<svg class='svg-icon left' viewBox='0 0 25 25'>";switch(initialSet.player_format){case"singles":segmentIcon+="<use xlink:href='#icon-user'></use>";break;case"doubles":segmentIcon+="<use xlink:href='#icon-users'></use>";break;case"triples":case"quads":default:segmentIcon+="<use xlink:href='#icon-user-group'></use>"}var segmentHeader=(segmentIcon+="</svg>")+"Section "+segmentNumber;segmentLabel&&(segmentHeader=segmentIcon+segmentLabel);var playerRailsObj=_this.getPlayerRailsObj("","","",set.set_id);set.playerRailsObj=playerRailsObj;var setObj={sets:[],instructions:instructions,status:chapterStatus,segmentId:segmentId,segmentNumber:segmentNumber,segmentHeader:segmentHeader,segmentLabel:segmentLabel};"PLAYED"!=chapterStatus&&(segmentArr[segmentNumber]||(segmentArr[segmentNumber]=setObj),segmentArr[segmentNumber].sets.push(set))}return segmentArr=segmentArr.filter((function(el){return null!=el}))}},this.fixPlayerLineUp=function(team){if(team){this.getPlayerRailsObj(team);for(var expectedTeamSize=this.getExpectedTeamSize(),lineUp=this.getLineUp(team),teamPlayers=_this.getTeamPlayers(team),cleanLineUp=[],i=0;i<expectedTeamSize;i++){var player=lineUp[i];if(player){if(-1==player){cleanLineUp.push(-1);continue}if("missing"==player)continue;if(!APP.findInObjArray("player_guid",teamPlayers,player)[0])continue;cleanLineUp.push(player)}}this.setLineUp(team,cleanLineUp,!0)}},this.selectLineUp=function(team,preflight){team||(team="home");var isLocked=APP.nlf.playerRails.isLineUpLocked(team,APP.nlf.data.railsChapter.set_id);if("ready"==(playerRailsObj=_this.getPlayerRailsObj()).home&&"ready"==playerRailsObj.away&&(isLocked=!1),isLocked){var msg="Once a team has submitted their lineup, it cannot be accessed until the opposing team submits their lineup. Then either lineup can be reviewed or edited.<br /><br /> All changes are logged in the match report.";APP.alert.show(msg,"","","Lineup Locked")}else if(this.fixPlayerLineUp(team),_this.editData.activeTeam=team,_this.editData.players=_this.getLineUp(team),_this.editData.size=_this.getExpectedTeamSize(),preflight)APP.nlf.displayPage(14);else{var playerRailsObj,match=_this.data.railsMatch,teamLabel="";if("home"==team&&(teamLabel=match.home_label),"away"==team&&(teamLabel=match.away_label),_this.editData.teamLabel=teamLabel,"ready"==(playerRailsObj=_this.getPlayerRailsObj()).away&&"ready"==playerRailsObj.home)msg=`\n\t\t\t\tThis action should only be taken by a member of:<br /></br />\n\t\t\t\t<span class="bold text-red">${teamLabel}</span>\n\t\t\t`;else{msg=`\n\t\t\t\tThis action should only be taken by a member of:<br /></br />\n\t\t\t\t<span class="bold text-red">${teamLabel}</span>\n\t\t\t`;var showWarning=!1;"home"==team&&"empty"!=playerRailsObj.home&&(showWarning=!0),"away"==team&&"empty"!=playerRailsObj.away&&(showWarning=!0),showWarning&&(msg+='\n\t\t\t\t\t<br /><br />\n\t\t\t\t\t<span class="alert-warning-highlight">\n\t\t\t\t\t\tEditing this team\'s lineup will display the selected team.\n\t\t\t\t\t</span>\n\t\t\t\t')}APP.confirm.show({title:"Confirm!",msg:msg,ok:function(){APP.nlf.playerRails.selectLineUp(team,!0)}})}},this.buildSelectLineUp=function(){var content="",playerQty=_this.editData.size,match=_this.data.railsMatch,label="",team=_this.editData.activeTeam,playerArr=[],playerRailsObj=(_this.getTeamPlayers(team),_this.getPlayerRailsObj());"home"==team&&(label=match.home_label,playerArr=playerRailsObj&&"error"==playerRailsObj.home?[]:playerRailsObj.homePlayers),"away"==team&&(label=match.away_label,playerArr=playerRailsObj&&"error"==playerRailsObj.away?[]:playerRailsObj.awayPlayers),content+=`\n\t\t\t<h4 class="header">\n\t\t\t\t<span class="text-gold bold">${label}</span><br />\n\t\t\t\t${APP.nlf.rails.getTeamSizeText(playerQty)}\n\t\t\t</h4>\n\t\t`;for(var i=0;i<playerQty;i++)if("empty"!=playerRailsObj[team]){var player=playerArr[i];if(player){if(-1==player){content+=`\n\t\t\t\t\t\t<div class="button button-menu button-red round-corners" id="p-rails-edit-player-${i}">\n\t\t\t\t\t\t\tNo Player (playing short)\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;continue}if("missing"==player){content+=`\n\t\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="p-rails-add-player-${i}">\n\t\t\t\t\t\t\tSelect Player\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`;continue}content+=`\n\t\t\t\t\t<div class="button button-menu button-white round-corners" id="p-rails-edit-player-${i}">\n\t\t\t\t\t\t${APP.session.createPlayerName(player,1)}\n\t\t\t\t\t</div>\n\t\t\t\t`}else content+=`\n\t\t\t\t<div class="button button-menu button-gray round-corners" id="p-rails-add-player-${i}">\n\t\t\t\t\tSelect Player\n\t\t\t\t</div>\n\t\t\t`}else content+=`\n\t\t\t\t\t<div class="button button-menu button-gray round-corners" id="p-rails-add-player-${i}">\n\t\t\t\t\t\tSelect Player\n\t\t\t\t\t</div>\n\t\t\t\t`;return content},this.startMatch=function(preflight){if(preflight)_this.rails.startMatch();else{var msg="",playerRailsObj=_this.getPlayerRailsObj(),allowShorts=_this.allowShortLineUp(),matchReady="ready"==playerRailsObj.home&&"ready"==playerRailsObj.away,emptyTeam=!1;if(allowShorts&&((playerRailsObj.homeAllEmpty||playerRailsObj.awayAllEmpty)&&(emptyTeam=!0),"ready"!=playerRailsObj.home&&"short"!=playerRailsObj.home||"ready"!=playerRailsObj.away&&"short"!=playerRailsObj.away||emptyTeam||(matchReady=!0)),matchReady)_this.rails.startMatch();else{if("ready"!=playerRailsObj.home){switch(msg+=`<span class="bold">${APP.nlf.data.railsMatch.home_label}</span><br />`,playerRailsObj.home){case"empty":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tLineup is missing\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;case"short":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tLineup is short\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;case"error":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tThere is an issue with the lineup\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;default:msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tThere is an issue with the lineup\n\t\t\t\t\t\t</span>\n\t\t\t\t\t',APP.recordError("Line Up Error")}msg+="<br /><br />"}if("ready"!=playerRailsObj.away){switch(msg+=`<span class="bold">${APP.nlf.data.railsMatch.away_label}</span><br />`,playerRailsObj.away){case"empty":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tLineup is missing\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;case"short":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tLineup is short\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;case"error":msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tThere is an issue with the lineup\n\t\t\t\t\t\t</span>\n\t\t\t\t\t';break;default:msg+='\n\t\t\t\t\t\t<span class="text-red bold">\n\t\t\t\t\t\t\tThere is an issue with the lineup\n\t\t\t\t\t\t</span>\n\t\t\t\t\t',APP.recordError("Line Up Error")}msg+="<br /><br />"}msg+='\n\t\t\t<div class="alert-warning-highlight">\n\t\t\t\tAre you sure you want to start this match?\n\t\t\t</div>\n\t\t',APP.confirm.show({title:"Start Match?",msg:msg,ok:function(){APP.nlf.playerRails.startMatch(!0)},show_reload:!0})}}},this.addPlayer=function(playerInt){_this.editData.label=null,_this.editData.mode="add",_this.editData.replacePlayer=null,_this.editData.replaceInt=null,_this.parent.displayPage(15)},this.editPlayer=function(playerInt){var activeTeam=_this.editData.activeTeam,editPlayer=_this.editData.players[playerInt];if(-1==editPlayer)_this.editData.label="No Player",_this.editData.mode="edit",_this.editData.replacePlayer=editPlayer,_this.editData.replaceInt=playerInt;else{var players=_this.getTeamPlayers(activeTeam),player=APP.findInObjArray("player_guid",players,editPlayer)[0],label=APP.session.createPlayerName(player,1);_this.editData.label=label,_this.editData.mode="edit",_this.editData.replacePlayer=editPlayer,_this.editData.replaceInt=playerInt}var currentPlayerArr=_this.getLineUp(activeTeam);currentPlayerArr||(currentPlayerArr=[]),currentPlayerArr[playerInt]=null;for(var isFullOfNulls=!0,i=0;i<currentPlayerArr.length;i++)if(null!==currentPlayerArr[i]){isFullOfNulls=!1;break}isFullOfNulls&&(currentPlayerArr=[]),_this.setLineUp(activeTeam,currentPlayerArr,!0),_this.parent.displayPage(15)},this.cancelEditPlayer=function(){var ed=_this.editData;if("edit"==ed.mode){var playerArr=_this.getLineUp(ed.activeTeam);playerArr[ed.replaceInt]=ed.replacePlayer,_this.setLineUp(ed.activeTeam,playerArr),ed.players=playerArr}var editTeamLineUp=_this.editData.teamLineUp;_this.editData.teamLineUp?_this.parent.displayPage(16):(ed.reset(!0),editTeamLineUp&&(_this.editData.teamLineUp=!0),_this.parent.displayPage(13))},this.confirmEditPlayer=function(){var replaceArr,mySelected,ed=_this.editData,editMode=ed.mode,activeTeam=ed.activeTeam,replaceInt=ed.replaceInt,selected=(moment().tz("America/New_York"),!1);try{selected=_this.selector.returnSelected()}catch(e){}if("edit"!=editMode)if("add"!=editMode);else{(replaceArr=_this.getLineUp(activeTeam))||(replaceArr=[]);for(var i=0;i<selected.length;i++)mySelected=selected[i].name,replaceArr.push(mySelected);if(_this.setLineUp(activeTeam,replaceArr,!0),_this.editData.teamLineUp&&"ready"==_this.getPlayerRailsObj()[_this.editData.activeTeam])return void APP.nlf.displayPage(16);APP.nlf.displayPage(14)}else{if(mySelected=selected[0].name,(replaceArr=_this.getLineUp(activeTeam))||(replaceArr=[]),replaceArr[replaceInt]=mySelected,_this.setLineUp(activeTeam,replaceArr,!0),_this.editData.teamLineUp&&"ready"==_this.getPlayerRailsObj()[_this.editData.activeTeam])return void APP.nlf.displayPage(16);APP.nlf.displayPage(14)}},this.setEditData=function(team){team||(team=_this.editData.activeTeam),_this.editData.players=_this.getLineUp(team),_this.editData.size=_this.getExpectedTeamSize(),_this.editData.players.length==_this.editData.size?_this.editData.mode="edit":_this.editData.mode="add"},this.getMatchUp=function(setId){if(!setId){var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;setId=chapterInfo.set_id}var playerRailsObj=_this.getPlayerRailsObj("","","",setId);if(!playerRailsObj)return _this.log("No player rails obj found",!0),!1;var i,player,playerName,playerRank,returnObj={status:"error",home:[],away:[]};if("ready"==playerRailsObj.away&&"ready"==playerRailsObj.home){for(returnObj.status="ready",i=0;i<playerRailsObj.homePlayers.length;i++)player=playerRailsObj.homePlayers[i],playerName=APP.session.createPlayerName(player,1),1==playerRailsObj.homePlayers.length&&(playerRank=playerRailsObj.homePlayers[0].player_rank)&&(playerName=`<span class="bold">(${playerRank})</span> ${playerName}`),returnObj.home.push(playerName);for(i=0;i<playerRailsObj.awayPlayers.length;i++)player=playerRailsObj.awayPlayers[i],playerName=APP.session.createPlayerName(player,1),1==playerRailsObj.awayPlayers.length&&(playerRank=playerRailsObj.awayPlayers[0].player_rank)&&(playerName=`${playerName} <span class="bold">(${playerRank})</span>`),returnObj.away.push(playerName)}return returnObj},this.allowShortLineUp=function(setId){if(!setId){var chapterInfo=_this.data.railsChapter;if(!chapterInfo)return _this.log("No chapter info found",!0),!1;setId=chapterInfo.set_id}var allowShorts=!1;try{if(_this.isPlayerRails()){var playerRailsObj=_this.getPlayerRailsObj("","","",setId);playerRailsObj&&playerRailsObj.allowShortOptions&&(allowShorts=!0)}}catch(e){}return allowShorts},this.updateLineUpPlatform=function(timeout,errorFn,noLoader){if(!APP.nlf.playerRails.chapterPopUpShowing){noLoader||APP.device.showSpinnerOverlay();var data={season_status:APP.nlf.data.league.season_status,league_match_id:APP.nlf.data.railsMatch.league_match_id};errorFn||(errorFn=function(){APP.device.hideSpinnerOverlay()}),APP.fns.doOldCall("/getLeaguePlayerLineups",data,_this.updateSuccessPlatform,errorFn,"",timeout)}},this.updateSuccessPlatform=function(r){APP.device.hideSpinnerOverlay();try{if(r&&r.length&&Array.isArray(r))if(APP.nlf.data.railsMatch.player_lineup=APP.nlf.playerRails.mergePlayerLineup(r),5==APP.nlf.data.mode)APP.nlf.pages.chapterSelect.init(APP.nlf);else{var scrollTop=$("#nlf-scroll-box").scrollTop();APP.nlf.displayPage(APP.nlf.data.mode),window.setTimeout((function(){$("#nlf-scroll-box").animate({scrollTop:scrollTop},{duration:0,queue:!1})}),100)}}catch(e){}},this.updateErrorPlatform=function(){APP.device.hideSpinnerOverlay(),APP.alert.show("Couldn't reach DartConnect Platform.<br />Please check your Internet Connection and try again")},this.mergePlayerLineup=function(data){var matchSets=[];try{if(!data)return[];if(!Array.isArray(data))return[];if(!data.length)return[];if(!APP.nlf.data.railsFormat)return[];var i,set,setId,setObj,sets=APP.nlf.data.railsFormat.sets;for(i=0;i<sets.length;i++)setObj={set_id:setId=(set=sets[i]).set_id,home_team:{ts:null,players:[]},away_team:{ts:null,players:[]}},matchSets.push(setObj);for(i=0;i<data.length;i++)setId=(set=data[i]).set_id,APP.findInObjArray("set_id",matchSets,setId)[0]||(setObj={set_id:setId,home:{ts:null,players:[]},away:{ts:null,players:[]}},matchSets.push(setObj));var uniqueId=APP.nlf.rails.getUniqueId(),localData=APP.nlf.getLocal(uniqueId,"playerRails");for(i=0;i<matchSets.length;i++){setId=(set=matchSets[i]).set_id;var platformLineUp=APP.findInObjArray("set_id",data,setId)[0],localLineUp=APP.findInObjArray("id",localData,setId)[0];if(!(!platformLineUp&!localLineUp)){var platformHomeLineUp=null,platformAwayLineUp=null;platformLineUp&&platformLineUp.home_team&&(platformHomeLineUp=platformLineUp.home_team),platformLineUp&&platformLineUp.away_team&&(platformAwayLineUp=platformLineUp.away_team);var localHomeLineUp=null,localAwayLineUp=null;localLineUp&&localLineUp.home_team&&(localHomeLineUp=localLineUp.home_team),localLineUp&&localLineUp.away_team&&(localAwayLineUp=localLineUp.away_team);var mergeHomeLineUp=this.compareLineUp(localHomeLineUp,platformHomeLineUp);if(mergeHomeLineUp){set.home_team=mergeHomeLineUp;var mergeAwayLineUp=this.compareLineUp(localAwayLineUp,platformAwayLineUp);mergeAwayLineUp&&(set.away_team=mergeAwayLineUp)}}}}catch(e){}return matchSets.length&&this.saveMergedLocal(matchSets),matchSets},this.saveMergedLocal=function(data){var uniqueId=APP.nlf.rails.getUniqueId(),localArr=_this.parent.getLocal(uniqueId,"playerRails");-1==localArr&&(localArr=[]);for(var i=0;i<data.length;i++){var set=data[i],setId=set.set_id,newObj={id:setId,home_team:set.home_team,away_team:set.away_team},localData=APP.findInObjArray("id",localArr,setId)[0];localData?(localData.home_team=set.home_team,localData.away_team=set.away_team):localArr.push(newObj)}_this.parent.setLocal(uniqueId,"playerRails",localArr)},this.compareLineUp=function(local,platform){try{if(!local&&!platform)return!1;if(local&&!platform)return local;if(platform&&!local)return platform;if(local.ts&&!platform.ts)return local;if(platform.ts&&!local.ts)return platform;var localTs=moment(local.ts),platformTs=moment(platform.ts);return localTs.isAfter(platformTs)?local:platform}catch(e){newErrorReport(e,"Error in compareLineUp")}return!1},this.showWelcome=function(){},this.autoSelectPlayers=function(){if(this.isPlayerRails()){var playerRailsObj=APP.nlf.playerRails.getPlayerRailsObj();if(playerRailsObj){var i,player,homeTeam=playerRailsObj.homePlayers,awayTeam=playerRailsObj.awayPlayers;if(homeTeam&&homeTeam.length){if(APP.header.roster_left.getPlayerCount())return;for(i=0;i<homeTeam.length;i++)-1!=(player=homeTeam[i])&&"missing"!=player&&APP.header.handleOpponentChange("op-button-left-P"+player.player_guid)}if(awayTeam&&awayTeam.length){if(APP.header.roster_right.getPlayerCount())return;for(i=0;i<awayTeam.length;i++)-1!=(player=awayTeam[i])&&"missing"!=player&&APP.header.handleOpponentChange("op-button-right-P"+player.player_guid)}var stayOnPlayerSelectScreen=!1;try{var set=APP.nlf.data.railsChapter;APP.nlf.rails.allowMidChapterPlayerChanges(set)&&(stayOnPlayerSelectScreen=!0)}catch(e){}APP.nlf.rails.initialLaunch&&!stayOnPlayerSelectScreen&&(this.goToMatchStartScreen(),APP.reveal.setBackButton("EXIT"))}}},this.goToMatchStartScreen=function(){APP.header.handleOpponentChange("oph-bb-continue",!0),APP.fns.checkLegsAndSets()&&APP.header.handleSetSetup("pssm-continue"),$("#bb-e-new-players").html("Edit Players")},this.isSetTeamOrder=function(team){try{if(!this.isPlayerRails())return!1;if(!this.data.league||!this.data.league.match_settings)return!1;if("CAPTAIN"==this.data.league.match_settings.player_lineup_mode){if(team){var teamPlayers=this.getLineUp(team);if(!teamPlayers)return!1;if(!teamPlayers.length)return!1;var playerRailsObj=this.getPlayerRailsObj();return("home"!=team||!playerRailsObj.homeAllEmpty)&&("away"!=team||!playerRailsObj.awayAllEmpty)}return!0}}catch(e){}return!1},this.getMaxTeamSize=function(){var returnObj={active:!1};try{if("team"!==this.data.railsChapter.player_format)return returnObj;if(!this.isPlayerRails())return returnObj;returnObj.active=!0,this.data.railsChapter.max_team_players&&(returnObj.maxTeam=this.data.railsChapter.max_team_players)}catch(e){}return returnObj},this.getTeamTurnSetting=function(){var returnObj={active:!1};try{if("team"!==this.data.railsChapter.player_format)return returnObj;if(!this.isPlayerRails())return returnObj;returnObj.active=!0,this.data.railsChapter.team_turn_setting&&(returnObj.turnSetting=this.data.railsChapter.team_turn_setting)}catch(e){}return returnObj},_this.log("Initing"),_this.callbacks("preInit"),_this.callbacks("postInit"),_this.rails=_this.parent.rails,_this.rails.playerRails=_this)):this.log("vars not sent to class")};APP.nlf.playerRails||APP.nlf.load();var FastForward=function(vars){var _this=this;function generateUserInput(marks,cricket_targets){if(!marks||!cricket_targets||!marks.length)return["0"];var inputs=[],targetKeys=Object.keys(cricket_targets).sort((function(a,b){return a-b}));return marks.forEach((function(mark,i){if(mark>0&&i<targetKeys.length){var target=cricket_targets[targetKeys[i]];if("B"===target.l||25===target.v){for(var j=0;j<Math.floor(mark/2);j++)inputs.push(i+1+"D");mark%2==1&&inputs.push(i+1+"S")}else inputs.push(`${i+1}${mark>=3?"T":2===mark?"D":"S"}`)}})),inputs.length?inputs:["0"]}this.vars=vars||{},this.debugMode=!1,this.verboseErrors=!0,this.log=function(msg,force){if(_this.debugMode||force){var message="FFwd: ";message+="string"==typeof msg?msg:JSON.stringify(msg),console.log(message)}},this.callbacks=function(cycle,data){if(_this.vars.callbacks&&"object"==typeof _this.vars.callbacks){if(_this.vars.callbacks[cycle])try{_this.vars.callbacks[cycle](_this,data),_this.log(cycle+" callback executed")}catch(e){_this.log("Error in '"+cycle+"' callback: "+e.message,!0)}}else _this.log("No valid callbacks provided")},this.dctv=!1,_this.vars.dctv&&(_this.dctv=!0),this.playLeg=function(leg){var steps=[];if(_this.uiFixes(),"PRE-GAME"==APP.mode){try{APP.getMatch().match_guid||(APP.getMatch().match_guid=leg.match_id)}catch(e){}if(APP.game.name&&(APP.game_selector.selectGame(null),APP.session.showGameSelector()),!_this.selectMatchType(leg))return _this.log("Invalid match type: "+leg.game_data.type,!0),void _this.earlyExit("Invalid match type: "+leg.game_data.type,leg);steps.push((function(){return _this.log("Executing selectStarter"),_this.selectStarter(leg,(function(success){success?runNextStep(1):_this.log("selectStarter failed, stopping sequence")})),!1}))}steps.push((function(){return _this.log("Executing setPlayerOrder"),_this.setPlayerOrder(leg)})),steps.push((function(){return _this.log("Executing setUpTestBot"),!!_this.setUpTestBot(leg)&&(APP.user_options.game_shot=!1,!0)}));var runNextStep=function(index){index>=steps.length?_this.log("All playLeg steps completed"):window.setTimeout((function(){var result=steps[index]();!1!==result&&(!0===result?runNextStep(index+1):_this.log("Step "+index+" failed, stopping sequence"))}),10)};_this.log("Starting playLeg step sequence"),runNextStep(0)},this.selectMatchType=function(leg){try{var game,gameData=leg.game_data;if(!gameData)return _this.log("No game data found",!0),!1;var games=APP.session.lgs_list;if(!games)return _this.log("No games found",!0),!1;if(_this.dctv&&!gameData.options){var gameLabel=gameData.name;_this.log("DCTV Game Label: "+gameLabel);for(var i=0;i<games.length;i++)if(games[i].label&&games[i].label.toLowerCase()===gameLabel.toLowerCase()){game=games[i],_this.log("Found game by label: "+game.label);break}}else{if(!gameData.options||!gameData.options.id)return _this.log("No game options found",!0),!1;var gameId=gameData.options.id;for(i=0;i<games.length;i++)if(games[i].id==gameId){game=games[i];break}}return game?(APP.game_selector.selectGame(game.type,game,gameData.options),APP.game.plugin.initGamePanel(),game.starting_score&&APP.game.resetScores(game.starting_score),APP.game.options.double_in=!!game.double_in,APP.game.options.all_player_double_in=!!game.all_player_double_in,APP.game.options.double_out=!!game.double_out,$("#bs-set-format").html(APP.session.getMatchFormatSummary(!0)),$("#bs-game-info").html(APP.game.name?APP.game.getGameName(!0):"Game Menu"),APP.storeState({settings_change:!0}),APP.game.plugin.storeSettings(),APP.game.plugin.refreshGamePanel(),APP.header.refresh(),APP.popup.hide("league-game-selector"),APP.reveal.setBackButton("BACK"),!0):(_this.log("No game found with ID: "+gameId,!0),!1)}catch(e){return _this.log("Error in selectMatchType: "+e.message,!0),_this.earlyExit("Error in selectMatchType: "+e.message,leg),!1}},this.selectStarter=function(leg,callback){try{APP.reveal.force_no_animate=!0;var legStarter=leg.game_data.cork_winner;if(_this.dctv&&"number"==typeof _this.vars.data.start_player&&(legStarter=_this.vars.data.start_player),null==legStarter||""===legStarter){var winningOppo=leg.game_data.winning_opponent,oppo1Turns=leg.game_data.opponents[0].turns.length,oppo2Turns=leg.game_data.opponents[1].turns.length;if(0==winningOppo)legStarter=leg.game_data.opponents[1].turns[oppo2Turns-1].darts_thrown?1:0;else legStarter=leg.game_data.opponents[0].turns[oppo1Turns-1].darts_thrown?0:1}leg.game_data.opponent_order=[legStarter,1-legStarter],APP.session.handleBullShoot("bs-opponent-"+legStarter),window.setTimeout((function(){callback&&callback(!0)}),100)}catch(e){_this.log("Error in selectStarter: "+e.message,!0),_this.earlyExit("Error in selectStarter: "+e.message,leg),callback&&callback(!1)}},this.setPlayerOrder=function(leg){try{var i,pOrder,lPlayerOrder=leg.game_data.opponents[0].player_order,rPlayerOrderCount=leg.game_data.opponents[1].player_order;if(lPlayerOrder.length>0)for(i=0;i<lPlayerOrder.length-1;i++)pOrder=lPlayerOrder[i],APP.header.handlePlayerOrder("pml-button-"+pOrder);if(rPlayerOrderCount.length>0)for(i=0;i<rPlayerOrderCount.length-1;i++)pOrder=rPlayerOrderCount[i],APP.header.handlePlayerOrder("pmr-button-"+pOrder)}catch(e){return _this.log("Error in setPlayerOrder: "+e.message,!0),_this.earlyExit("Error in setPlayerOrder: "+e.message,leg),!1}return!0},this.playAction=function(leg){try{return!0}catch(e){return _this.log("Error in playAction: "+e.message,!0),_this.earlyExit("Error in playAction: "+e.message,leg),!1}},this.setUpTestBot=function(){return APP.ffwd.isActive=!0,testbot.isFastForward=!0,testbot.pbSpeed="instant",testbot.pbPlayer="both",testbot.matchData=_this.data.legs,testbot.prepData(),!0},this.earlyExit=function(msg,leg){leg||(leg=""),msg||(msg="An error has occurred. Please try again."),newErrorReport(leg,"FFwd Early Exit",!1),_this.removeSavedData(),APP.alert.show(msg),_this.hideLoader()},this.removeSavedData=function(){BBAT.flushData("ffwd_data"),BBAT.flushData("dctv_data")},this.showLoader=function(){if(_this.log("Showing loader"),_this.debugMode)_this.log("Debug mode enabled, not showing loader");else{var options={message:"Downloading Match - Please Wait;",waitMessage:`\n\t\t\t\tRestoring Leg <span class="bold">${testbot.pbLeg+1}</span> of <span class="bold">${_this.data.legs.length}</span>\n\t\t\t\t<br />\n\t\t\t\t<div id="ffwd-progress">\n\t\t\t\t</div>\n\t\t\t`,reloadBtn:!1,closeBtn:!0,closeFn:function(){APP.confirm.show({title:"Cancel Match Download?",msg:"Are you sure you want to cancel the Match Download?",ok:function(){_this.removeSavedData(),_this.hideLoader(),APP.reload()}})}};APP.fns.newLoader.show(options)}},this.hideLoader=function(){_this.log("Hiding loader"),APP.fns.newLoader.hide()},this.testbotError=function(msg){switch(msg){case"match_id":case"match_format":case"leg_type":case"starting_player":case"general_error":break;case"no_inputs":return _this.log("No inputs found, stopping testbot"),_this.hideLoader(),APP.alert.show("No valid inputs found for this turn."),void testbot.stop();case"inputs_complete":if(_this.dctv){_this.hideLoader();return APP.alert.show("\n\t\t\t\t\t\tMatch has synced with DCTV.\n\t\t\t\t\t\t<br /><br />\n\t\t\t\t\t\tConfirm with players that the most recent turns were recorded.\n\t\t\t\t\t",(function(){APP.reload()})),void testbot.stop()}}testbot.stop();var errorMsg="An error occurred trying to Download this match. It has been reported. Please exit the match and try again.";this.verboseErrors&&(errorMsg+="<br /><br />Error: "+msg),APP.alert.show(errorMsg,(function(){APP.reload()})),newErrorReport("FFwd Error",msg,!1),_this.removeSavedData()},this.setUpError=function(msg){switch(_this.log("Setting up error: "+msg),msg){case"wrongDCTVLeg":return _this.log("Wrong DCTV leg number"),APP.alert.show("We couldn't download the current leg from DCTV. If unexpected, please manually catch this match up.",(function(){APP.reload()})),void _this.removeSavedData();case"noLegs":_this.log("No legs found in data"),APP.alert.show("No legs found in the match data. If unexpected, please manually catch this match up.",(function(){APP.reload()}));break;case"noTurns":_this.log("No turns found in DCTV data"),APP.alert.show("No turns found in the DCTV data. If missing, please manually enter the scores from DCTV.",(function(){APP.reload()}));break;default:return _this.log("Unknown error: "+msg),APP.alert.show("An unknown error occurred while setting up the match download. Please try again.",(function(){APP.reload()})),void newErrorReport("","FFwd Set Up Error: "+msg,!1)}_this.removeSavedData(),_this.hideLoader()},this.cleanDCTVData=function(){try{var data=_this.data,isCricket=data.cricket||"Cricket"===data.game_options.type;function createPlayer(oppo){try{return{obj_id:`P_${oppo.first_name[0]}_${oppo.last_name[0]}`,player_guid:null,first_name:oppo.first_name[0],last_name:oppo.last_name[0],chalkboard_name:oppo.last_name[0],nickname:null,email:null,member_level:"U",member_id:null,is_default:!1,in_pool:!0,is_bot:!1,bot_skill:null,bot_level:null,has_doubled_in:!1,do_attempts:null,is_temp_player:!0,last_active_date:null,iso2_country:oppo.country_code[0],iso3_country:oppo.country_iso3[0],country_name:oppo.country_name[0],player_postseason_status:!1,wdf_rank:null}}catch(e){return _this.log("Error creating player: "+e.message,!0),{obj_id:"",player_guid:null,first_name:"",last_name:"",chalkboard_name:"",nickname:null,email:null,member_level:"U",member_id:null,is_default:!1,in_pool:!0,is_bot:!1,bot_skill:null,bot_level:null,has_doubled_in:!1,do_attempts:null,is_temp_player:!0,last_active_date:null,iso2_country:"",iso3_country:"",country_name:"",player_postseason_status:!1,wdf_rank:null}}}function createOpponent(oppo){try{return{chalkboard_name:`${oppo.first_name[0]} ${oppo.last_name[0]}`,starting_score:isCricket?0:data.game_options.starting_score,current_score:oppo.current_score,handicap:0,handicap_marks:isCricket?function(){for(var arr=[],i=0;i<8;i++)arr.push(0);return arr}():[],player_tracking:!0,player_order:[0],team:{obj_id:"TOURNAMENT",team_guid:null,team_name:null,chalkboard_name:null,email:null,is_default:!1,in_pool:!1,players:[createPlayer(oppo)]},turns:[]}}catch(e){return _this.log("Error creating opponent: "+e.message,!0),{chalkboard_name:"",starting_score:0,current_score:0,handicap:0,handicap_marks:[],player_tracking:!1,player_order:[],team:{obj_id:"",team_guid:null,team_name:null,chalkboard_name:null,email:null,is_default:!1,in_pool:!1,players:[]},turns:[]}}}function processTurns(oppo,isCricket){try{return oppo.turns.map((function(turn,index){if(isCricket){var totalMarks=turn.marks.reduce((function(sum,m){return sum+m}),0);return{current_score:0===index?oppo.current_score:null,do_attempts:null,darts_thrown:3,r3da:totalMarks,r1da:totalMarks/3,color:9===totalMarks?"ROUND OF 9":0===totalMarks?"MISS":turn.marks[6]>=2?"BIG BULL":null,player_index:0,marks_recorded:totalMarks,marks_scored:totalMarks,points:turn.points.reduce((function(sum,p){return sum+p}),0),target_marks:turn.marks.concat(0),target_points:turn.points.concat(0),user_input:generateUserInput(turn.marks,data.cricket.targets)}}return{current_score:0===index?oppo.current_score:null,do_attempts:null,darts_thrown:3,r3da:turn,r1da:turn/3,color:180===turn?"TON 80":turn>=100?"TON "+(turn-100):null,player_index:0,marks_recorded:null,marks_scored:null,points:turn,target_marks:[],target_points:[],user_input:[turn.toString()]}}))}catch(e){return this.log("Error processing turns: "+e.message,!0),[]}}var startOrder=[0,1];1==data.start_player&&(startOrder=[1,0]);var cleanData={match_id:data.match_guid,legs:[{_id:`leg_${data.match_guid}_${data.current_leg_number}`,member_id:null,game_data:{game_guid:null,abandoned:!1,remote_play:!1,reload_count:0,type:isCricket?"Cricket":data.game_options.type,name:isCricket?"Cricket":"501",start_time:null,elapsed_time:null,deepest_initiated_edit:0,winning_dart:data.winning_dart,winning_opponent:null,cork_winner:null,sudden_death_win:!1,leg_forfeit:null,opponent_count:2,opponent_order:startOrder,track_do_attempts:!1,opponents:[createOpponent(data.oppo_0),createOpponent(data.oppo_1)],score_edits:[],league_practice_game:!1,options:data.game_options,dyg_target:isCricket?[]:function(){for(var arr=[],i=0;i<3;i++)arr.push({label:""+(i+1),value:1,special:!1});return arr}(),target:isCricket?[{label:"",value:0,special:!1},{label:"20",value:20,special:!1},{label:"19",value:19,special:!1},{label:"18",value:18,special:!1},{label:"17",value:17,special:!1},{label:"16",value:16,special:!1},{label:"15",value:15,special:!1},{label:"B",value:25,special:!1}]:[]},match_id:data.match_guid,set_index:data.current_set_number,game_index:data.current_leg_number-1,device_token:null}]};try{cleanData.legs[0].game_data.opponents[0].turns=processTurns(data.oppo_0,isCricket),cleanData.legs[0].game_data.opponents[1].turns=processTurns(data.oppo_1,isCricket)}catch(e){}return cleanData}catch(e){}},this.uiFixes=function(){var tr=APP.tacticsResize;BBAT.storeData({tr_seen:!0}),tr.inited&&tr.active&&tr.toggle(!0),tr.active=!1,tr.forceOff=!0},_this.vars.data||(_this.log("Required variable 'data' not provided",!0),0)?(this.data=_this.vars.data,function(){if(_this.log("Initialising"),_this.callbacks("preInit"),_this.data){if(_this.dctv){if(APP.session.isSetPlay()){if(_this.data.current_set_number!==APP.session.getCurrentSetsPlayed())return _this.log("Current set number does not match data. Expected: "+APP.session.getCurrentSetNumber()+", Found: "+_this.data.current_set_number,!0),void _this.setUpError("wrongDCTVLeg");if(_this.data.current_leg_number!==APP.session.getCurrentSetLegsPlayed())return _this.log("Current leg number does not match data. Expected: "+APP.session.getCurrentSetLegsPlayed()+", Found: "+_this.data.current_leg_number,!0),void _this.setUpError("wrongDCTVLeg")}else if(APP.session.getLegsCount()!==_this.data.current_leg_number)return _this.log("Current leg number does not match data. Expected: "+APP.session.getLegsCount()+", Found: "+_this.data.current_leg_number,!0),void _this.setUpError("wrongDCTVLeg");_this.data=_this.cleanDCTVData()}if(!_this.data.legs||0===_this.data.legs.length)return _this.log("No legs found in data"),void _this.setUpError("noLegs");if(_this.dctv&&0===_this.data.legs[0].game_data.opponents[0].turns.length&&0===_this.data.legs[0].game_data.opponents[1].turns.length)return _this.log("No turns found in DCTV data"),void _this.setUpError("noTurns");if(!_this.dctv){var legCount=APP.session.getLegsCount();if(_this.log("Legs count: "+legCount),legCount>=_this.data.legs.length)return _this.log("Match is up to date",!0),_this.removeSavedData(),void _this.callbacks("mongoComplete")}_this.dctv&&(legCount=0,_this.removeSavedData()),_this.log("Starting FFWD"),_this.log("Leg to play:"),_this.log(_this.data.legs[legCount]),_this.showLoader(),window.setTimeout((function(){testbot.pbLeg=legCount,_this.playLeg(_this.data.legs[legCount])}),100),_this.callbacks("postInit")}else _this.log("No data provided")}()):_this.log("Initialization aborted due to invalid vars",!0)};