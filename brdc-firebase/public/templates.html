<!-- bracket.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Bracket | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { BracketDisplay } from '/components.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const eventId = new URLSearchParams(location.search).get('event_id');

    async function load() {
      const eventDoc = await getDoc(doc(db, 'events', eventId));
      const event = eventDoc.data();
      const tournamentDoc = await getDoc(doc(db, 'tournaments', event.tournament_id));
      const tournament = tournamentDoc.data();
      const matchesSnap = await getDocs(query(collection(db, 'matches'), where('event_id', '==', eventId)));
      const matches = matchesSnap.docs.map(d => d.data());
      
      document.title = `${event.event_name} Bracket | BRDC`;
      document.body.innerHTML = BracketDisplay({ matches, event, tournament });
      setTimeout(load, 10000); // Auto-refresh
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- register.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Register | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, addDoc, collection } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { RegistrationForm } from '/components.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const eventId = new URLSearchParams(location.search).get('event_id');

    async function load() {
      const eventDoc = await getDoc(doc(db, 'events', eventId));
      const event = eventDoc.data();
      const tournamentDoc = await getDoc(doc(db, 'tournaments', event.tournament_id));
      const tournament = tournamentDoc.data();
      
      document.body.innerHTML = RegistrationForm({ event, tournament });
      document.getElementById('registrationForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        await addDoc(collection(db, 'registrations'), {
          event_id: eventId,
          tournament_id: event.tournament_id,
          full_name_snapshot: formData.get('full_name'),
          email_snapshot: formData.get('email'),
          phone_snapshot: formData.get('phone'),
          sms_opt_in: formData.get('sms_opt_in') === 'on',
          status: 'active',
          created_at: new Date()
        });
        alert('Registered!');
      });
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- tournament.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Tournament | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { EventCard } from '/components.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const tournamentId = new URLSearchParams(location.search).get('id');

    async function load() {
      const tournamentDoc = await getDoc(doc(db, 'tournaments', tournamentId));
      const tournament = tournamentDoc.data();
      const eventsSnap = await getDocs(query(collection(db, 'events'), where('tournament_id', '==', tournamentId)));
      const events = eventsSnap.docs.map(d => d.data());
      
      document.title = `${tournament.tournament_name} | BRDC`;
      document.body.innerHTML = `
        <h1>${tournament.tournament_name}</h1>
        <p>${tournament.tournament_date.toDate().toLocaleDateString()} ‚Ä¢ ${tournament.venue_name}</p>
        <div class="events-grid">${events.map(e => EventCard({ event: e, tournament })).join('')}</div>
      `;
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- event.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Event | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const eventId = new URLSearchParams(location.search).get('id');

    async function load() {
      const eventDoc = await getDoc(doc(db, 'events', eventId));
      const event = eventDoc.data();
      const tournamentDoc = await getDoc(doc(db, 'tournaments', event.tournament_id));
      const tournament = tournamentDoc.data();
      
      document.body.innerHTML = `
        <h1>${event.event_name}</h1>
        <p>${tournament.tournament_name}</p>
        <p>üéØ ${event.game} ‚Ä¢ üèÜ ${event.format} ‚Ä¢ üí∞ $${event.entry_fee}</p>
        <a href="/register?event_id=${eventId}" class="btn">Register</a>
        ${event.status === 'in_progress' ? `<a href="/bracket?event_id=${eventId}" class="btn">View Bracket</a>` : ''}
      `;
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- league.html -->
<!DOCTYPE html>
<html>
<head>
  <title>League | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const leagueId = new URLSearchParams(location.search).get('id');

    async function load() {
      const leagueDoc = await getDoc(doc(db, 'leagues', leagueId));
      const league = leagueDoc.data();
      
      document.body.innerHTML = `
        <h1>${league.league_name}</h1>
        <p>${league.season} ‚Ä¢ ${league.league_type}</p>
        <a href="/standings?league_id=${leagueId}" class="btn">Standings</a>
        <a href="/schedule?league_id=${leagueId}" class="btn">Schedule</a>
      `;
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- standings.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Standings | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { StandingsTable } from '/components.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const leagueId = new URLSearchParams(location.search).get('league_id');

    async function load() {
      const teamsSnap = await getDocs(query(collection(db, 'leagueTeams'), where('league_id', '==', leagueId)));
      const teams = teamsSnap.docs.map(d => d.data());
      
      document.body.innerHTML = `<h1>Standings</h1>` + StandingsTable({ teams });
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- schedule.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Schedule | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { MatchCard } from '/components.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const leagueId = new URLSearchParams(location.search).get('league_id');

    async function load() {
      const matchesSnap = await getDocs(query(collection(db, 'leagueMatches'), where('league_id', '==', leagueId)));
      const matches = matchesSnap.docs.map(d => d.data());
      
      document.body.innerHTML = `<h1>Schedule</h1>${matches.map(m => MatchCard({ match: m })).join('')}`;
    }
    load();
  </script>
</head>
<body></body>
</html>

<!-- live-match.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Live Match | BRDC</title>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, doc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const app = initializeApp({/*config*/});
    const db = getFirestore(app);
    const matchId = new URLSearchParams(location.search).get('match_id');

    onSnapshot(doc(db, 'leagueMatches', matchId), (doc) => {
      const match = doc.data();
      document.body.innerHTML = `
        <h1>Live Match</h1>
        <div class="live-score">
          <div>${match.home_team_name}: ${match.home_score}</div>
          <div>${match.away_team_name}: ${match.away_score}</div>
        </div>
      `;
    });
  </script>
</head>
<body></body>
</html>
