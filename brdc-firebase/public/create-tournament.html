<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Tournament - BRDC</title>
    <link rel="stylesheet" href="/css/brdc-styles.css">
    <style>
        .form-container {
            max-width: 900px;
            margin: 40px auto;
        }
        .form-group {
            margin-bottom: 24px;
        }
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container form-container">
        <div class="brdc-card">
            <div class="brdc-card-header">
                <h1 class="brdc-title" style="font-size: 48px; color: white;">CREATE TOURNAMENT</h1>
                <p class="brdc-subtitle" style="color: white; margin-top: 10px;">Burning River Dart Club</p>
            </div>
            
            <div style="padding: 40px 30px;">
                <form id="tournamentForm">
                    <div class="form-group">
                        <label class="brdc-label">Tournament Name *</label>
                        <input type="text" id="name" class="brdc-input" required>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="brdc-label">Date *</label>
                            <input type="date" id="date" class="brdc-input" required>
                        </div>
                        <div class="form-group">
                            <label class="brdc-label">Venue</label>
                            <input type="text" id="venue" class="brdc-input" placeholder="e.g., Rookies">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="brdc-label">Format *</label>
                            <select id="format" class="brdc-select" required>
                                <option value="single_elimination">Single Elimination</option>
                                <option value="double_elimination">Double Elimination</option>
                                <option value="round_robin">Round Robin</option>
                                <option value="swiss">Swiss System</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="brdc-label">Entry Fee ($)</label>
                            <input type="number" id="entry_fee" class="brdc-input" value="10" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="brdc-label">Best of (Legs)</label>
                            <select id="best_of" class="brdc-select">
                                <option value="1">1</option>
                                <option value="3" selected>3</option>
                                <option value="5">5</option>
                                <option value="7">7</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="brdc-label">Starting Score</label>
                            <select id="starting_score" class="brdc-select">
                                <option value="301">301</option>
                                <option value="501" selected>501</option>
                                <option value="701">701</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin: 30px 0; padding: 20px; background: #f9fafb; border: 3px solid var(--black);">
                        <h3 style="font-family: 'Bebas Neue'; font-size: 20px; margin-bottom: 16px;">PAYOUT STRUCTURE (%)</h3>
                        <div class="grid-2">
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label class="brdc-label">1st Place</label>
                                <input type="number" id="payout_1st" class="brdc-input" value="50" min="0" max="100">
                            </div>
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label class="brdc-label">2nd Place</label>
                                <input type="number" id="payout_2nd" class="brdc-input" value="30" min="0" max="100">
                            </div>
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label class="brdc-label">3rd Place</label>
                                <input type="number" id="payout_3rd" class="brdc-input" value="20" min="0" max="100">
                            </div>
                            <div class="form-group" style="margin-bottom: 12px;">
                                <label class="brdc-label">4th Place</label>
                                <input type="number" id="payout_4th" class="brdc-input" value="0" min="0" max="100">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="brdc-btn" style="width: 100%; margin-top: 20px;">
                        CREATE TOURNAMENT
                    </button>
                </form>
                
                <div id="result" style="margin-top: 30px; display: none;"></div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { callFunction } from '/js/firebase-config.js';
        
        document.getElementById('tournamentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = e.target.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'CREATING...';
            
            try {
                const data = {
                    name: document.getElementById('name').value,
                    date: document.getElementById('date').value,
                    venue: document.getElementById('venue').value,
                    format: document.getElementById('format').value,
                    entry_fee: document.getElementById('entry_fee').value,
                    best_of: document.getElementById('best_of').value,
                    starting_score: document.getElementById('starting_score').value,
                    payout_1st: document.getElementById('payout_1st').value,
                    payout_2nd: document.getElementById('payout_2nd').value,
                    payout_3rd: document.getElementById('payout_3rd').value,
                    payout_4th: document.getElementById('payout_4th').value,
                };
                
                const result = await callFunction('createTournament', data);
                
                if (result.success) {
                    const resultDiv = document.getElementById('result');
                    resultDiv.className = 'brdc-alert brdc-alert-success';
                    resultDiv.innerHTML = `
                        <h3 style="font-family: 'Bebas Neue'; font-size: 24px; margin-bottom: 12px;">
                            TOURNAMENT CREATED!
                        </h3>
                        <p><strong>Tournament ID:</strong> ${result.tournament_id}</p>
                        <p><strong>Director PIN:</strong> <span style="font-size: 24px; color: var(--pink);">${result.pin}</span></p>
                        <p style="margin-top: 12px; font-size: 14px;">Save this PIN - you'll need it to manage your tournament!</p>
                        <a href="/director-dashboard.html?pin=${result.pin}" class="brdc-btn" style="margin-top: 20px; display: inline-block; text-decoration: none;">
                            GO TO DASHBOARD
                        </a>
                    `;
                    resultDiv.style.display = 'block';
                    document.getElementById('tournamentForm').style.display = 'none';
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                const resultDiv = document.getElementById('result');
                resultDiv.className = 'brdc-alert brdc-alert-error';
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = 'CREATE TOURNAMENT';
            }
        });
    </script>
</body>
</html>
