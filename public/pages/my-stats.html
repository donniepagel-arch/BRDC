<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRDC - My Stats</title>
    <link rel="icon" type="image/png" href="/images/favicon.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700;800&display=swap');

        :root {
            --pink: #FF469A;
            --teal: #91D7EB;
            --yellow: #FDD835;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --text-light: #f0f0f0;
            --text-dim: #8a8aa3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }

        body {
            background: linear-gradient(135deg, var(--bg-dark) 0%, #0f0f23 100%);
            min-height: 100vh;
            color: var(--text-light);
            padding: 20px;
        }

        .header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .back-btn {
            background: rgba(145, 215, 235, 0.2);
            border: 2px solid var(--teal);
            color: var(--teal);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
        }

        .back-btn:hover {
            background: var(--teal);
            color: var(--bg-dark);
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            letter-spacing: 3px;
            color: var(--pink);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(145, 215, 235, 0.2);
        }

        .stat-card h3 {
            font-family: 'Bebas Neue', cursive;
            font-size: 1.4rem;
            letter-spacing: 2px;
            color: var(--teal);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .stat-label {
            color: var(--text-dim);
        }

        .stat-value {
            font-weight: 700;
            color: var(--yellow);
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: var(--text-dim);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--text-dim);
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="/pages/dashboard.html" class="back-btn">&larr; Back</a>
        <h1>MY STATS</h1>
    </div>

    <div id="content" class="stats-grid">
        <div class="loading">Loading your stats...</div>
    </div>

    <script src="/js/firebase-config.js"></script>
    <script>
        async function loadStats() {
            const content = document.getElementById('content');

            // Get player ID from session/localStorage
            const playerId = localStorage.getItem('brdc_player_id');
            const playerPin = localStorage.getItem('brdc_player_pin');

            if (!playerId && !playerPin) {
                content.innerHTML = `
                    <div class="no-data">
                        <h3>Not logged in</h3>
                        <p>Please <a href="/pages/dashboard.html" style="color: var(--teal);">log in</a> to view your stats.</p>
                    </div>
                `;
                return;
            }

            try {
                const result = await callFunction('getPlayerProfile', {
                    player_id: playerId,
                    pin: playerPin
                });

                if (result.success && result.player) {
                    const p = result.player;
                    const stats = p.stats || {};
                    const x01 = stats.x01 || {};
                    const cricket = stats.cricket || {};

                    content.innerHTML = `
                        <div class="stat-card">
                            <h3>X01 Statistics</h3>
                            <div class="stat-row">
                                <span class="stat-label">Games Played</span>
                                <span class="stat-value">${x01.legs_played || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Games Won</span>
                                <span class="stat-value">${x01.legs_won || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Win Rate</span>
                                <span class="stat-value">${x01.legs_played ? ((x01.legs_won / x01.legs_played) * 100).toFixed(1) : 0}%</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Average</span>
                                <span class="stat-value">${x01.total_darts ? (x01.total_points / x01.total_darts * 3).toFixed(1) : 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">180s</span>
                                <span class="stat-value">${x01.ton_eighties || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">High Checkout</span>
                                <span class="stat-value">${x01.high_checkout || 0}</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Cricket Statistics</h3>
                            <div class="stat-row">
                                <span class="stat-label">Games Played</span>
                                <span class="stat-value">${cricket.legs_played || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Games Won</span>
                                <span class="stat-value">${cricket.legs_won || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Win Rate</span>
                                <span class="stat-value">${cricket.legs_played ? ((cricket.legs_won / cricket.legs_played) * 100).toFixed(1) : 0}%</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">MPR</span>
                                <span class="stat-value">${cricket.total_rounds ? (cricket.total_marks / cricket.total_rounds).toFixed(2) : 0}</span>
                            </div>
                        </div>

                        <div class="stat-card">
                            <h3>Overall</h3>
                            <div class="stat-row">
                                <span class="stat-label">Matches Played</span>
                                <span class="stat-value">${stats.matches_played || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Matches Won</span>
                                <span class="stat-value">${stats.matches_won || 0}</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Match Win Rate</span>
                                <span class="stat-value">${stats.matches_played ? ((stats.matches_won / stats.matches_played) * 100).toFixed(1) : 0}%</span>
                            </div>
                        </div>
                    `;
                } else {
                    content.innerHTML = `
                        <div class="no-data">
                            <h3>No stats yet</h3>
                            <p>Play some games to start tracking your stats!</p>
                        </div>
                    `;
                }
            } catch (error) {
                content.innerHTML = `
                    <div class="no-data">
                        <h3>Error loading stats</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        loadStats();
    </script>
</body>
</html>
